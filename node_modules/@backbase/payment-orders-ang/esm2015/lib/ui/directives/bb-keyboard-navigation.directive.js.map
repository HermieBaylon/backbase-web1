{"version":3,"file":"bb-keyboard-navigation.directive.js","sourceRoot":"","sources":["../../../../../../../libs/payment-orders-ang/src/lib/ui/directives/bb-keyboard-navigation.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  ContentChild,\n  ContentChildren,\n  Directive,\n  ElementRef,\n  forwardRef,\n  Inject,\n  QueryList,\n} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n\nexport abstract class KeyboardNavigationDirectiveBase {\n  abstract onKeyDown(event: KeyboardEvent): void;\n}\n\n@Directive({\n  selector: '[bbKeyboardNavigationItem]',\n})\nexport class KeyboardNavigationItemDirective {\n  constructor(\n    @Inject(forwardRef(() => KeyboardNavigationDirective))\n    public navigator: KeyboardNavigationDirectiveBase,\n    public elementRef: ElementRef<HTMLElement>\n  ) {}\n}\n\n@Directive({\n  selector: '[bbKeyboardNavigationAnchor]',\n  // eslint-disable-next-line @angular-eslint/no-host-metadata-property\n  host: {\n    '(keydown.ArrowLeft)': 'navigator.onKeyDown($event)',\n    '(keydown.ArrowRight)': 'navigator.onKeyDown($event)',\n    '(keydown.ArrowDown)': 'navigator.onKeyDown($event)',\n    '(keydown.Tab)': 'navigator.onKeyDown($event)',\n  },\n})\nexport class KeyboardNavigationAnchorDirective {\n  readonly nativeElement = this.elementRef.nativeElement;\n\n  constructor(\n    @Inject(forwardRef(() => KeyboardNavigationDirective))\n    public navigator: KeyboardNavigationDirectiveBase,\n    public elementRef: ElementRef<HTMLElement>\n  ) {}\n}\n\n@Directive({\n  selector: '[bbKeyboardNavigationList]',\n  // eslint-disable-next-line @angular-eslint/no-host-metadata-property\n  host: {\n    '(keydown.ArrowUp)': 'navigator.onKeyDown($event)',\n    '(keydown.ArrowDown)': 'navigator.onKeyDown($event)',\n    '(keydown.Shift)': 'navigator.onKeyDown($event)',\n    '(keydown.Tab)': 'navigator.onKeyDown($event)',\n    '(keydown.Shift.Tab)': 'navigator.onKeyDown($event)',\n    '(keydown.Space)': 'navigator.onKeyDown($event)',\n    '(keydown.Enter)': 'navigator.onKeyDown($event)',\n  },\n})\nexport class KeyboardNavigationListDirective {\n  readonly nativeElement = this.elementRef.nativeElement;\n  @ContentChildren(KeyboardNavigationItemDirective, { descendants: true })\n  items!: QueryList<KeyboardNavigationItemDirective>;\n\n  constructor(\n    @Inject(forwardRef(() => KeyboardNavigationDirective))\n    public navigator: KeyboardNavigationDirectiveBase,\n    public elementRef: ElementRef<HTMLElement>\n  ) {}\n}\n\n@Directive({\n  selector: '[bbKeyboardNavigation]',\n})\nexport class KeyboardNavigationDirective\n  implements KeyboardNavigationDirectiveBase\n{\n  @ContentChild(KeyboardNavigationListDirective, { static: false })\n  private list!: KeyboardNavigationListDirective;\n  @ContentChildren(KeyboardNavigationAnchorDirective, { descendants: true })\n  private anchorList!: QueryList<KeyboardNavigationAnchorDirective>;\n  private _document!: Document;\n\n  private static resetItem(position: number, itemElements: HTMLElement[]) {\n    if (position === -1) {\n      return;\n    }\n    itemElements[position].removeAttribute('tabindex');\n  }\n\n  private static resetTabItem(position: number, itemElements: HTMLElement[]) {\n    itemElements[position].setAttribute('tabindex', '-1');\n  }\n\n  private static setItemActive(position: number, itemElements: HTMLElement[]) {\n    itemElements[position].setAttribute('tabindex', '0');\n    itemElements[position].focus();\n  }\n\n  private static setPositionUp(position: number): number {\n    return Math.max(position - 1, 0);\n  }\n\n  private static setPositionDown(position: number, itemsLength: number) {\n    return Math.min(position + 1, itemsLength - 1);\n  }\n\n  private isEventFromAnchor($event: KeyboardEvent): boolean {\n    return !!this.anchorList?.find((el) =>\n      el.nativeElement.contains($event.target as HTMLElement)\n    );\n  }\n\n  private getListElements(): HTMLElement[] {\n    return this.list?.items.map((item) => item.elementRef.nativeElement);\n  }\n\n  private getListAnchor(): HTMLElement[] {\n    return this.anchorList?.map((item) => item.elementRef.nativeElement);\n  }\n\n  constructor(@Inject(DOCUMENT) private readonly document: any) {\n    this._document = this.document as Document;\n  }\n\n  onKeyDown(event: KeyboardEvent) {\n    const code = event.code;\n    const itemElements = this.getListElements();\n    const anchorElements = this.getListAnchor();\n    const isEventFromAnchor = this.isEventFromAnchor(event);\n    const horizontalNav = new Set(['ArrowRight', 'ArrowLeft']);\n    const selectedEvents = new Set(['Space', 'Enter']);\n\n    let itemPosition = -1;\n    let anchorPosition = 0;\n    let itemElement: HTMLElement | null = null;\n\n    if (code === 'ArrowDown' || code === 'Tab') {\n      if (isEventFromAnchor && itemElements?.length) {\n        KeyboardNavigationDirective.setItemActive(0, itemElements);\n        event.preventDefault();\n      }\n      if (code === 'Tab') {\n        return;\n      }\n    }\n\n    if (!isEventFromAnchor && itemElements?.length) {\n      itemElements.forEach((item, index) => {\n        if (item.contains(event.target as HTMLElement)) {\n          itemElement = item;\n        }\n\n        if (item === this._document.activeElement) {\n          itemPosition = index;\n        }\n      });\n    }\n\n    if (selectedEvents.has(code) && !isEventFromAnchor && itemElement) {\n      event.preventDefault();\n      (itemElement as HTMLElement).click();\n      return;\n    }\n\n    if (\n      isEventFromAnchor &&\n      anchorElements.length > 1 &&\n      horizontalNav.has(code)\n    ) {\n      anchorElements.forEach((item, index) => {\n        if (item === this._document.activeElement) {\n          anchorPosition = index;\n        }\n      });\n\n      switch (code) {\n        case 'ArrowRight':\n          KeyboardNavigationDirective.resetTabItem(\n            anchorPosition,\n            anchorElements\n          );\n          anchorPosition = KeyboardNavigationDirective.setPositionDown(\n            anchorPosition,\n            anchorElements.length\n          );\n          break;\n        case 'ArrowLeft':\n          KeyboardNavigationDirective.resetTabItem(\n            anchorPosition,\n            anchorElements\n          );\n          anchorPosition =\n            KeyboardNavigationDirective.setPositionUp(anchorPosition);\n          break;\n      }\n\n      KeyboardNavigationDirective.setItemActive(anchorPosition, anchorElements);\n      return;\n    }\n\n    if (!isEventFromAnchor && itemElement) {\n      switch (code) {\n        case 'ArrowDown':\n          KeyboardNavigationDirective.resetItem(itemPosition, itemElements);\n          itemPosition = KeyboardNavigationDirective.setPositionDown(\n            itemPosition,\n            itemElements.length\n          );\n          break;\n        case 'ArrowUp':\n          KeyboardNavigationDirective.resetItem(itemPosition, itemElements);\n          itemPosition =\n            KeyboardNavigationDirective.setPositionUp(itemPosition);\n          break;\n      }\n\n      KeyboardNavigationDirective.setItemActive(itemPosition, itemElements);\n\n      event.preventDefault();\n    }\n  }\n}\n"]}