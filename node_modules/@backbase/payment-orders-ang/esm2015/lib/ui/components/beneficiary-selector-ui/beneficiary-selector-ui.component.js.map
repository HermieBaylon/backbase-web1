{"version":3,"file":"beneficiary-selector-ui.component.js","sourceRoot":"","sources":["../../../../../../../../libs/payment-orders-ang/src/lib/ui/components/beneficiary-selector-ui/beneficiary-selector-ui.component.ts","../../../../../../../../libs/payment-orders-ang/src/lib/ui/components/beneficiary-selector-ui/beneficiary-selector-ui.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild,\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { ProductSummaryItem } from '@backbase/data-ang/arrangements';\nimport { NgbDropdown } from '@ng-bootstrap/ng-bootstrap';\nimport { Subject } from 'rxjs';\nimport {\n  debounceTime,\n  distinctUntilChanged,\n  takeUntil,\n  tap,\n} from 'rxjs/operators';\n\nimport {\n  BeneficiaryList,\n  BeneficiaryListState,\n  ListState,\n} from '../../constants';\nimport { DefaultDebounceTime } from '../../constants/constants';\nimport { ContactItem } from '../../models/types';\n\n@Component({\n  selector: 'bb-beneficiary-selector-ui',\n  templateUrl: './beneficiary-selector-ui.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class BeneficiarySelectorUiComponent implements OnDestroy, OnInit {\n  private _accounts!: ProductSummaryItem[];\n  private _contacts!: ContactItem[];\n\n  state: BeneficiaryListState = {\n    contacts: ListState.EMPTY,\n    accounts: ListState.EMPTY,\n  };\n\n  /**\n   * Total count of accounts\n   */\n  @Input() totalAccounts = 0;\n\n  /**\n   * Total count of contacts\n   */\n  @Input() totalContacts = 0;\n\n  /**\n   * Total count of contacts items before sub-accounts extract\n   */\n  @Input() totalContactsItemsCount = 0;\n\n  /**\n   * List of contacts\n   */\n  @Input() set contacts(value: ContactItem[]) {\n    if (this.state.contacts === ListState.FETCHING && value) {\n      this._contacts = [...this._contacts, ...value];\n    } else {\n      this._contacts = value;\n    }\n    this.updateListStateOnDataChange(BeneficiaryList.CONTACTS, this._contacts);\n  }\n\n  get contacts(): ContactItem[] {\n    return this._contacts;\n  }\n\n  /**\n   * List of own accounts\n   */\n  @Input() set accounts(value: ProductSummaryItem[]) {\n    if (this.state.accounts === ListState.FETCHING && value) {\n      this._accounts = [...this._accounts, ...value];\n    } else {\n      this._accounts = value;\n    }\n\n    this.updateListStateOnDataChange(BeneficiaryList.ACCOUNTS, this._accounts);\n  }\n\n  get accounts(): ProductSummaryItem[] {\n    return this._accounts;\n  }\n\n  /**\n   * Tabs configuration\n   */\n  @Input() tabs!: Array<BeneficiaryList>;\n\n  /**\n   * Pipe to initiate dropdown closure from outside\n   */\n  @Input() closeDropdownRequest$: Subject<boolean> = new Subject();\n\n  /**\n   * Placeholder for the search box\n   */\n  @Input() placeholder!: string;\n\n  /**\n   * Title for the beneficiary selector\n   */\n  @Input() title!: string;\n  /**\n   * Helper text for the beneficiary selector. Appears inline next to the label.\n   */\n  @Input() helperText!: string;\n\n  /**\n   * Flag to denote if the beneficiary selector has errors.\n   */\n  @Input() set hasError(error: boolean) {\n    if (error) {\n      if (!this.search.touched) {\n        this.search.markAsTouched();\n      }\n    }\n  }\n\n  /**\n   * aria-label for the search box arrow icon\n   */\n  @Input('aria-label') ariaLabel!: string;\n\n  /**\n   * Dropdown icon that would be shown alongside with textbox\n   */\n  @Input() dropdownIcon = 'toggle-down';\n\n  /**\n   * Selected account event emitter\n   */\n  @Output() selectedAccount = new EventEmitter();\n\n  /**\n   * Selected contact event emitter\n   */\n  @Output() selectedContact = new EventEmitter();\n\n  /**\n   * Search string\n   */\n  @Output() searchValue = new EventEmitter<string>();\n\n  /**\n   * Fetch more items event handler\n   */\n  @Output() fetchMoreItems = new EventEmitter<{\n    page: number;\n    type: BeneficiaryList;\n  }>();\n\n  /**\n   * Enter account detail event\n   */\n  @Output() manualEdit = new EventEmitter<string>();\n\n  /**\n   * Event emitted search is blurred\n   */\n  @Output() searchBlur = new EventEmitter<string>();\n\n  /**\n   * Clear search value\n   */\n  @Output() clear = new EventEmitter<string>();\n\n  /**\n   * Time delay between each search requests in milliseconds. Defaults to 300\n   */\n  @Input() debounceTime = DefaultDebounceTime;\n\n  /**\n   * Selected item, contact or account\n   */\n  @Input()\n  set selectedItem(selectedItem: ContactItem | ProductSummaryItem | undefined) {\n    if (selectedItem?.name) {\n      this.search.patchValue(selectedItem.name);\n      this._selectedItem = selectedItem;\n    }\n  }\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n\n  /**\n   * Form control for search value.\n   */\n  @Input() search = new FormControl();\n\n  /**\n   * Flag to denote if the account has only closed payment permission.\n   * Default value is `false`\n   */\n  @Input() isClosedPayment = false;\n\n  /**\n   * Flag to denote if the beneficiary field is disabled.\n   * Default value is `false`\n   */\n  @Input() isBeneficiaryDisabled = false;\n  /**\n   * Flag to denote if the manual edit feature is disabled.\n   * Default value is `false`\n   */\n  @Input() isManualEditDisabled = false;\n\n  searchIsFocused = false;\n  private _selectedItem?: ContactItem | ProductSummaryItem;\n  readonly debounceSearch$ = new Subject<string>();\n  readonly gc$ = new Subject();\n  private pageState = {\n    [BeneficiaryList.CONTACTS]: {\n      page: 0,\n      shouldLoadMore: () => this.totalContacts > this.totalContactsItemsCount,\n    },\n    [BeneficiaryList.ACCOUNTS]: {\n      page: 0,\n      shouldLoadMore: () => this.totalAccounts > this._accounts.length,\n    },\n  };\n\n  @ViewChild('dd') dropdownItem?: NgbDropdown;\n\n  constructor() {\n    this.debounceSearch$\n      .pipe(\n        debounceTime(this.debounceTime),\n        distinctUntilChanged(),\n        takeUntil(this.gc$),\n        tap(() => {\n          this.listStateReducer({\n            [BeneficiaryList.ACCOUNTS]: ListState.LOADING,\n            [BeneficiaryList.CONTACTS]: ListState.LOADING,\n          });\n        })\n      )\n      .subscribe((term: string) => {\n        this.searchValue.emit(term);\n      });\n  }\n\n  ngOnInit() {\n    this.closeDropdownRequest$\n      .pipe(takeUntil(this.gc$))\n      .subscribe((closeFlag: boolean) => {\n        if (closeFlag && this.dropdownItem) {\n          this.dropdownItem.close();\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.gc$.next();\n    this.gc$.complete();\n  }\n\n  private listStateReducer(update: { [key: string]: ListState }): void {\n    this.state = { ...this.state, ...update };\n  }\n\n  selectAccount(account: ProductSummaryItem) {\n    this.selectedAccount.emit(account);\n    this.search.patchValue(account.name);\n  }\n\n  selectContact(contact: ContactItem) {\n    this.selectedContact.emit(contact);\n    this.search.patchValue(contact.name);\n  }\n\n  handleSearch(searchString = '') {\n    if (this.searchIsFocused) {\n      this.debounceSearch$.next(searchString?.trim());\n\n      // reset page count in pageState when search is triggered\n      this.pageState[BeneficiaryList.ACCOUNTS].page = 0;\n      this.pageState[BeneficiaryList.CONTACTS].page = 0;\n    }\n  }\n\n  onBlur() {\n    this.searchIsFocused = false;\n    this.searchBlur.emit(this.search.value ? this.search.value.trim() : '');\n  }\n\n  focusHandler() {\n    this.searchIsFocused = true;\n    if (this.dropdownItem) {\n      this.dropdownItem.open();\n    }\n  }\n\n  onClear() {\n    this.handleSearch('');\n    this.search.reset();\n    this.clear.emit('');\n  }\n\n  handleDropdownClose(opened: boolean, dropdown: NgbDropdown) {\n    if (!opened && this.searchIsFocused) {\n      dropdown.open();\n    }\n  }\n\n  onManualEdit() {\n    if (!this.isManualEditDisabled) {\n      this.manualEdit.emit(this.search.value ? this.search.value.trim() : '');\n    }\n  }\n\n  fetchMoreItemsAction(listType: BeneficiaryList) {\n    const { shouldLoadMore } = this.pageState[listType];\n    let { page: _page } = this.pageState[listType];\n\n    if (shouldLoadMore() && this.state[listType] === ListState.LIST) {\n      this.listStateReducer({ [listType]: ListState.FETCHING });\n      this.fetchMoreItems.emit({ page: ++_page, type: listType });\n\n      // update page state after being incremented\n      this.pageState[listType].page = _page;\n    }\n  }\n\n  private updateListStateOnDataChange(\n    listType: BeneficiaryList,\n    value: any\n  ): void {\n    let _state = this.state[listType];\n    const {\n      FETCHING,\n      FETCHING_FAILURE,\n      ERROR,\n      NO_RESULT,\n      EMPTY,\n      LIST,\n      FULL_LIST,\n    } = ListState;\n\n    if (!value || value.error) {\n      _state === FETCHING ? (_state = FETCHING_FAILURE) : (_state = ERROR);\n    } else if (!value?.length) {\n      this.search.value ? (_state = NO_RESULT) : (_state = EMPTY);\n    } else if (!this.pageState[listType].shouldLoadMore()) {\n      _state = FULL_LIST;\n    } else {\n      _state = LIST;\n    }\n\n    this.listStateReducer({ [listType]: _state });\n  }\n}\n","<div\n  class=\"bb-beneficiary-selector-ui\"\n  ngbDropdown\n  #dd=\"ngbDropdown\"\n  display=\"static\"\n  (openChange)=\"handleDropdownClose($event, dd)\"\n>\n  <label *ngIf=\"title\" [for]=\"searchElem?.id\">{{ title }}</label>\n\n  <span\n    class=\"bb-dynamic-input__helper-text bb-text-support\"\n    *ngIf=\"helperText\"\n    [id]=\"searchElem?.id + '__helper-text'\"\n    [textContent]=\"helperText\"\n  >\n  </span>\n\n  <bb-search-box-ui\n    ngbDropdownAnchor\n    (focus)=\"focusHandler()\"\n    (blur)=\"onBlur()\"\n    [formControl]=\"search\"\n    (clear)=\"onClear()\"\n    data-role=\"beneficiary-account-input\"\n    (ngModelChange)=\"handleSearch(search.value)\"\n    [placeholder]=\"placeholder\"\n    [squareBorder]=\"true\"\n    [showClear]=\"!isBeneficiaryDisabled\"\n    [autocomplete]=\"'off'\"\n    [disabled]=\"isBeneficiaryDisabled\"\n    role=\"combobox\"\n    aria-haspopup=\"true\"\n    [attr.aria-owns]=\"tabsComponent.tabsId\"\n    #searchElem\n  >\n    <button\n      bbButton\n      ngbDropdownToggle\n      color=\"outline-secondary\"\n      [attr.aria-label]=\"ariaLabel\"\n      data-role=\"open-beneficiary-dropdown-list-button\"\n    >\n      <bb-icon-ui [name]=\"dropdownIcon\"></bb-icon-ui>\n    </button>\n  </bb-search-box-ui>\n\n  <div\n    ngbDropdownMenu\n    class=\"dropdown-menu dropdown-menu-right w-100 bb-beneficiary-selector-ui__list\"\n  >\n    <bb-beneficiary-tabs\n      #tabsComponent\n      class=\"bb-beneficiary-selector-ui__tabs\"\n      [accounts]=\"accounts\"\n      [contacts]=\"contacts\"\n      [listState]=\"state\"\n      [tabsConfig]=\"tabs\"\n      [totalAccounts]=\"totalAccounts\"\n      [totalContacts]=\"totalContacts\"\n      [canEditManually]=\"!isClosedPayment && !isManualEditDisabled\"\n      [isDropdownOpen]=\"dd.isOpen()\"\n      (selectedContact)=\"selectContact($event); dd.close()\"\n      (selectedAccount)=\"selectAccount($event); dd.close()\"\n      (fetchMoreItems)=\"fetchMoreItemsAction($event)\"\n      (manualEdit)=\"onManualEdit(); dd.close()\"\n    >\n    </bb-beneficiary-tabs>\n  </div>\n</div>\n"]}