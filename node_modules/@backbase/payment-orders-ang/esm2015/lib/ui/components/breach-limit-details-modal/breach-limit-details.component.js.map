{"version":3,"file":"breach-limit-details.component.js","sourceRoot":"","sources":["../../../../../../../../libs/payment-orders-ang/src/lib/ui/components/breach-limit-details-modal/breach-limit-details.component.ts","../../../../../../../../libs/payment-orders-ang/src/lib/ui/components/breach-limit-details-modal/breach-limit-details.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  Input,\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n} from '@angular/core';\nimport { BreachInfo } from '@backbase/data-ang/payment-order';\n\nimport { PaymentBaseFields } from '../../../configs/models/form-item-names.model';\nimport {\n  CounterPartyDetails,\n  InitiatorDetails,\n  PaymentDetails,\n} from '../../../configs/models/form-items.model';\nimport {\n  BreachedLimitType,\n  BreachType,\n  Period,\n} from '../../constants/constants';\nimport { BreachReportError } from '../../models/types';\n\ninterface PaymentDetailsExtend extends PaymentDetails {\n  [PaymentBaseFields.initiator]: InitiatorDetails & { IBAN: string };\n  [PaymentBaseFields.counterparty]: CounterPartyDetails & { IBAN: string };\n}\n\n@Component({\n  selector: 'bb-breach-limit-details',\n  templateUrl: 'breach-limit-details.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class BreachLimitDetailsModalComponent {\n  /**\n   * Payment details\n   */\n  @Input() paymentDetails!: PaymentDetailsExtend;\n\n  /**\n   * The breach limit report from the payment order that originated it.\n   */\n  @Input() error?: BreachReportError;\n\n  /**\n   * The flag that controls visibility of the breach limit report.\n   * By default is `false`.\n   */\n  @Input() isOpen = false;\n\n  /**\n   * Event emitted when user clicks on close icon.\n   */\n  // eslint-disable-next-line @angular-eslint/no-output-native\n  @Output() close = new EventEmitter();\n\n  get breachReportCurrency() {\n    return this.error?.breachReport?.[0]?.currency;\n  }\n\n  private normalizeBreachReportPeriod(\n    breachReportInfo: BreachInfo\n  ): BreachInfo {\n    return breachReportInfo.timeframe\n      ? {\n          ...breachReportInfo,\n          timeframe: {\n            ...breachReportInfo.timeframe,\n            period: breachReportInfo.timeframe.period.toUpperCase(),\n          },\n        }\n      : breachReportInfo;\n  }\n\n  private flattenBreachReports(): Array<BreachInfo> {\n    if (!this.error || !this.error.breachReport) {\n      return [];\n    }\n    return this.error.breachReport\n      .map((report) => report.breachInfo)\n      .reduce(\n        (prev, current) =>\n          prev.concat(...current.map(this.normalizeBreachReportPeriod)),\n        []\n      );\n  }\n\n  private compareByPeriod(left: BreachInfo, right: BreachInfo): number {\n    const leftPeriod = left.timeframe?.period;\n    const rightPeriod = right.timeframe?.period;\n    return (\n      (<any>Period)[<string>leftPeriod] - (<any>Period)[<string>rightPeriod]\n    );\n  }\n\n  get sortedBreaches(): Array<BreachInfo> {\n    const limits = this.flattenBreachReports();\n    const transactional = limits.filter((limit, index) => {\n      const isTransactional =\n        limit.breachedLimitType === BreachedLimitType.TRANSACTIONAL;\n      const hasPeriodicThreshold =\n        limit.breachType === BreachType.THRESHOLD &&\n        limit.breachedLimitType === BreachedLimitType.PERIODIC;\n\n      if (isTransactional || hasPeriodicThreshold) {\n        limits.splice(index, 1);\n      }\n\n      return isTransactional;\n    });\n\n    return [...transactional, ...limits.sort(this.compareByPeriod)];\n  }\n\n  onClose() {\n    this.close.emit();\n  }\n\n  print() {\n    window.print();\n  }\n}\n","<bb-modal-ui [isOpen]=\"isOpen\" (cancel)=\"onClose()\" (confirm)=\"onClose()\">\n  <bb-modal-header-ui role=\"heading\">\n    <ng-template bbCustomModalHeader>\n      <header\n        class=\"bb-stack bb-stack__item--fill\"\n        aria-labelledby=\"headerTitle\"\n      >\n        <bb-icon-ui\n          color=\"danger\"\n          name=\"error-outline\"\n          class=\"bb-stack__item bb-stack__item--spacing-sm\"\n        ></bb-icon-ui>\n\n        <span\n          id=\"headerTitle\"\n          class=\"bb-stack__item highlight text-large\"\n          data-role=\"limit-breach-modal-title\"\n          aria-label=\"Limits breach\"\n          i18n-aria-label=\"@bb-payord-breach-limit-modal-title\"\n        >\n          Limits breach\n        </span>\n        <div class=\"bb-stack__item bb-stack__item--push-right\">\n          <button\n            (click)=\"print()\"\n            type=\"button\"\n            class=\"bb-stack__item btn border-0 btn-circle\"\n          >\n            <!-- ACCESSIBILITY compliance: The style attributes' content is needed for NVDA to read content on hover -->\n            <span\n              class=\"sr-only\"\n              aria-label=\"Print breach limit report\"\n              i18n-aria-label=\"@bb-payord-breach-limit-print-action-aria-label\"\n              style=\"min-width: 10px; min-height: 10px\"\n            >\n              Print breach limit report\n            </span>\n            <bb-icon-ui name=\"print\"></bb-icon-ui>\n          </button>\n          <button\n            (click)=\"onClose()\"\n            type=\"button\"\n            class=\"bb-stack__item btn border-0 btn-circle\"\n          >\n            <span\n              class=\"sr-only\"\n              aria-label=\"Close breach limit report dialog\"\n              i18n-aria-label=\"@bb-payord-breach-limit-close-action-aria-label\"\n              style=\"min-width: 10px; min-height: 10px\"\n            >\n              Close breach limit report dialog\n            </span>\n            <bb-icon-ui name=\"clear\"></bb-icon-ui>\n          </button>\n        </div>\n      </header>\n    </ng-template>\n  </bb-modal-header-ui>\n  <bb-modal-body-ui role=\"main\">\n    <ng-template bbCustomModalBody>\n      <div\n        class=\"bb-block bb-block--lg\"\n        i18n=\"@bb-payord-breach-limit-details-heading\"\n        data-role=\"limit-breach-modal-message\"\n      >\n        Payment could not be submitted due to a limit breach. See details below:\n      </div>\n\n      <div class=\"table-responsive\">\n        <table class=\"table table-hover\">\n          <thead class=\"bb-table__head--highlight\">\n            <tr>\n              <th scope=\"col\" class=\"bb-table--text-start\"></th>\n              <th\n                scope=\"col\"\n                class=\"bb-table--text-end\"\n                data-role=\"breach-currency\"\n              >\n                <ng-container\n                  i18n=\"\n                    @bb-payord-breach-limit-details-breach-currency-table-heading\n                  \"\n                  >Limit</ng-container\n                >\n                <ng-container *ngIf=\"breachReportCurrency\"\n                  >({{ breachReportCurrency }})</ng-container\n                >\n              </th>\n              <th\n                scope=\"col\"\n                class=\"bb-table--text-end\"\n                i18n=\"@bb-payord-breach-limit-details-consumed-table-heading\"\n              >\n                Consumed\n              </th>\n            </tr>\n          </thead>\n\n          <tbody>\n            <tr\n              *ngFor=\"let breachInfo of sortedBreaches\"\n              data-role=\"limit-breach\"\n            >\n              <td class=\"bb-table--text-start\" data-role=\"limit-type\">\n                <span\n                  class=\"highlight\"\n                  *ngIf=\"breachInfo.breachedLimitType === 'TRANSACTIONAL'\"\n                  i18n=\"@bb-payord-breach-limit-details-per-transaction-label\"\n                >\n                  Per transaction\n                </span>\n                <ng-container\n                  *ngIf=\"breachInfo.breachedLimitType !== 'TRANSACTIONAL'\"\n                >\n                  <span\n                    class=\"highlight\"\n                    i18n=\"@bb-payord-breach-limit-details-time-frame\"\n                  >\n                    {breachInfo.timeframe.period, select, DAILY {Daily} WEEKLY\n                    {Weekly} MONTHLY {Monthly} QUARTERLY {Quarterly} YEARLY\n                    {Yearly} other\n                    {{{breachInfo.timeframe.period | titlecase}}}}\n                  </span>\n                  <ng-container *ngIf=\"breachInfo.timeframe.period !== 'DAILY'\">\n                    <div\n                      [ngSwitch]=\"breachInfo.timeframe.period\"\n                      class=\"text-muted\"\n                      data-role=\"period\"\n                    >\n                      <ng-container\n                        *ngSwitchCase=\"'WEEKLY'\"\n                        i18n=\"@@bb-payord-breach-limit-details-timeframe-weekly\"\n                      >\n                        Till\n                        {{ breachInfo.timeframe.endTime | date: 'mediumDate' }}\n                      </ng-container>\n                      <ng-container\n                        *ngSwitchCase=\"'MONTHLY'\"\n                        i18n=\"\n                          @@bb-payord-breach-limit-details-timeframe-monthly\"\n                      >\n                        Till\n                        {{ breachInfo.timeframe.endTime | date: 'mediumDate' }}\n                      </ng-container>\n                      <ng-container\n                        *ngSwitchCase=\"'QUARTERLY'\"\n                        i18n=\"\n                          @@bb-payord-breach-limit-details-timeframe-quarterly\"\n                      >\n                        {{\n                          breachInfo.timeframe.startTime | date: 'mediumDate'\n                        }}\n                        -\n                        {{ breachInfo.timeframe.endTime | date: 'mediumDate' }}\n                      </ng-container>\n                      <ng-container\n                        *ngSwitchCase=\"'YEARLY'\"\n                        i18n=\"@@bb-payord-breach-limit-details-timeframe-yearly\"\n                      >\n                        {{\n                          breachInfo.timeframe.startTime | date: 'mediumDate'\n                        }}\n                        -\n                        {{ breachInfo.timeframe.endTime | date: 'mediumDate' }}\n                      </ng-container>\n                    </div>\n                  </ng-container>\n                </ng-container>\n              </td>\n\n              <td class=\"bb-table--text-end\" data-role=\"limit-amount\">\n                <span class=\"d-md-none bb-text-bold\">\n                  <ng-container\n                    i18n=\"\n                      @bb-payord-breach-limit-details-breach-currency-table-heading.responsive\n                    \"\n                  >\n                    Limit\n                  </ng-container>\n                  <ng-container *ngIf=\"breachReportCurrency\"\n                    >({{ breachReportCurrency }})</ng-container\n                  >&nbsp;\n                </span>\n                <bb-amount-ui\n                  [amount]=\"breachInfo.currentThreshold\"\n                ></bb-amount-ui>\n              </td>\n\n              <td class=\"bb-table--text-end\" data-role=\"limit-consumed\">\n                <span\n                  class=\"d-md-none bb-text-bold\"\n                  i18n=\"\n                    @bb-payord-breach-limit-details-consumed-table-heading.responsive\n                  \"\n                >\n                  Consumed&nbsp;\n                </span>\n                <ng-container\n                  *ngIf=\"breachInfo.breachedLimitType === 'TRANSACTIONAL'\"\n                >\n                  &mdash;\n                </ng-container>\n                <ng-container\n                  *ngIf=\"breachInfo.breachedLimitType !== 'TRANSACTIONAL'\"\n                >\n                  <bb-amount-ui\n                    [amount]=\"breachInfo.currentConsumption\"\n                  ></bb-amount-ui>\n                </ng-container>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <div\n        class=\"card card-sm card--highlight card--shadowless\"\n        *ngIf=\"paymentDetails\"\n      >\n        <div class=\"card-body\">\n          <div class=\"row\">\n            <div class=\"col-md-6 bb-block bb-block--md\">\n              <div\n                class=\"bb-text-bold\"\n                i18n=\"@@bb-payord-breach-limit-details-payment-debtor-account\"\n              >\n                From\n              </div>\n              <div>\n                <div class=\"break-word\" data-role=\"debit-account-name\">\n                  {{\n                    paymentDetails.initiator?.alias ||\n                      paymentDetails.initiator?.name\n                  }}\n                </div>\n                <div\n                  class=\"bb-text-support bb-subtitle\"\n                  data-role=\"debit-account-number\"\n                >\n                  {{\n                    paymentDetails.initiator?.accountNumber ||\n                      paymentDetails.initiator?.IBAN\n                  }}\n                </div>\n              </div>\n            </div>\n\n            <div class=\"col-md-6 bb-block bb-block--md\">\n              <div\n                class=\"bb-text-bold\"\n                i18n=\"\n                  @@bb-payord-breach-limit-details-payment-counterparty-account\"\n              >\n                To\n              </div>\n              <div>\n                <div class=\"break-word\" data-role=\"credit-account-name\">\n                  {{\n                    paymentDetails.counterparty?.alias ||\n                      paymentDetails.counterparty?.name\n                  }}\n                </div>\n                <div\n                  class=\"bb-text-support bb-subtitle\"\n                  data-role=\"credit-account-number\"\n                >\n                  {{\n                    paymentDetails.counterparty?.accountNumber ||\n                      paymentDetails.counterparty?.IBAN\n                  }}\n                </div>\n              </div>\n            </div>\n\n            <div class=\"col-md-6 bb-block bb-block--md\">\n              <div\n                class=\"bb-text-bold\"\n                i18n=\"@@bb-payord-breach-limit-details-payment-execution-date\"\n              >\n                Execution date\n              </div>\n              <div>\n                {{ paymentDetails.schedule?.startDate | date: 'mediumDate' }}\n              </div>\n            </div>\n\n            <div class=\"col-md-6\">\n              <div\n                class=\"bb-text-bold\"\n                i18n=\"@@bb-payord-breach-limit-details-payment-amount\"\n              >\n                Amount\n              </div>\n              <div class=\"highlight\">\n                <bb-amount-ui\n                  class=\"bb-amount--currency-space\"\n                  data-role=\"total-amount\"\n                  [amount]=\"paymentDetails.remittanceInfo.amountGroup.amount\"\n                  [currency]=\"\n                    paymentDetails.remittanceInfo.amountGroup.currency\n                  \"\n                  [mapCurrency]=\"false\"\n                ></bb-amount-ui>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-template>\n  </bb-modal-body-ui>\n</bb-modal-ui>\n"]}