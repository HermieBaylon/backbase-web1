import { TitleCasePipe } from '@angular/common';
import { Component, Input } from '@angular/core';
import { Validators } from '@angular/forms';
import { RegexReplacePipe } from '../../../manage-pockets-common/pipes/regex-replace.pipe';
import { ManagePocketsCreateBaseStep } from '../manage-pockets-create-base-step/manage-pockets-create-base-step';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@backbase/foundation-ang/core";
import * as i3 from "@backbase/ui-ang/input-text";
import * as i4 from "@backbase/ui-ang/input-validation-message";
import * as i5 from "@backbase/ui-ang/modal";
import * as i6 from "@backbase/ui-ang/icon";
import * as i7 from "@backbase/ui-ang/button";
import * as i8 from "../../../manage-pockets-common/directives/dynamic-id.directive";
import * as i9 from "@angular/common";
import * as i10 from "../../../manage-pockets-common/directives/accessibility-keyboard.directive";
import * as i11 from "../../../manage-pockets-common/pipes/regex-replace.pipe";
export class ManagePocketsDetailsComponent extends ManagePocketsCreateBaseStep {
    constructor(formBuilder, assetsService) {
        super();
        this.formBuilder = formBuilder;
        this.assetsService = assetsService;
        this.showDialog = false;
        this.resolveAsset = this.assetsService.createAssetsResolver({
            widgetName: 'bb-manage-pockets-journey-ang',
            getURIFromAssetID: (assetId) => assetId,
        });
    }
    ngOnInit() {
        var _a, _b, _c, _d;
        const defaultImage = ((_a = this.pocketImageList) === null || _a === void 0 ? void 0 : _a[0]) || 'home';
        this.pocketDetailsForm = this.formBuilder.group({
            name: [((_b = this.partialPocket) === null || _b === void 0 ? void 0 : _b.name) || this.formatName(defaultImage), Validators.required],
            icon: [((_c = this.partialPocket) === null || _c === void 0 ? void 0 : _c.icon) || defaultImage, Validators.required],
        });
        this.selectedImageAssetUrl = this.resolveAsset(`${((_d = this.partialPocket) === null || _d === void 0 ? void 0 : _d.icon) || defaultImage}-img.webp`);
    }
    formatName(pocketName) {
        const titleCasePipe = new TitleCasePipe();
        const regexPipe = new RegexReplacePipe();
        let formatedTittle = pocketName;
        formatedTittle = regexPipe.transform(formatedTittle, '-', ' ');
        formatedTittle = titleCasePipe.transform(formatedTittle);
        return formatedTittle;
    }
    openDialog() {
        this.showDialog = true;
    }
    closeDialog() {
        this.showDialog = false;
    }
    changeType(img) {
        this.pocketDetailsForm.patchValue({ name: this.formatName(img), icon: img });
        this.selectedImageAssetUrl = this.resolveAsset(`${img}-img.webp`);
        this.closeDialog();
    }
    getImage(img) {
        return this.resolveAsset(`${img}-img.webp`);
    }
    isTypeSelected(img) {
        return this.pocketDetailsForm.get('icon').value === img;
    }
    save() {
        if (this.pocketDetailsForm.valid) {
            this.goNext(this.formatDetailsValues());
        }
        else {
            this.pocketDetailsForm.markAllAsTouched();
        }
    }
    formatDetailsValues() {
        const { name, icon } = this.pocketDetailsForm.value;
        return { name, icon };
    }
}
ManagePocketsDetailsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ManagePocketsDetailsComponent, deps: [{ token: i1.FormBuilder }, { token: i2.AssetsService }], target: i0.ɵɵFactoryTarget.Component });
ManagePocketsDetailsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: ManagePocketsDetailsComponent, selector: "bb-manage-pockets-details", inputs: { pocketImageList: "pocketImageList" }, usesInheritance: true, ngImport: i0, template: "<div class=\"bb-block bb-block--xl\">\n  <h2 i18n=\"Choose Your Pocket Image and Name@@managePockets.create.details.header\">\n    Choose Your Pocket Image and Name\n  </h2>\n</div>\n<form [formGroup]=\"pocketDetailsForm\" (submit)=\"save()\">\n  <div class=\"bb-block bb-block--xl\">\n    <div class=\"bb-stack bb-stack--wrap bb-stack--align-top\">\n      <div class=\"bb-stack__item bb-stack__item--spacing-xl bb-manage-pockets-create-details__pocket-image-container\">\n        <img \n          [src]=\"selectedImageAssetUrl | async\" \n          class=\"bb-manage-pockets-create-details__pocket-image bb-block bb-block--sm\" \n          alt=\"Representation of the selected pocket type\"\n          i18n-alt=\"Pocket image|changes according to the type of pocket@@managePockets.create.details.selectedImageAssetUrl\"\n          (click)=\"openDialog()\"\n        >\n        <div>\n          <button\n            #button\n            bbButton\n            buttonSize=\"sm\"\n            [block]=\"true\"\n            color=\"link-text\"\n            (click)=\"openDialog()\"\n            i18n=\"Change image button@@managePockets.create.details.button.changeImage\"\n          >\n            Change image\n          </button>\n        </div>\n      </div>\n      <div class=\"bb-stack__break bb-stack__break--xs-down\"></div>\n      <div class=\"bb-stack__item bb-manage-pockets-create-details__input-container\">\n        <bb-input-text-ui\n          formControlName=\"name\"\n          data-role=\"manage-pocket-creation-name\"\n          label=\"What's this Pocket for?\"\n          i18n-label=\"What's this Pocket for?@@managePockets.create.details.input.label\"\n          maxLength=\"50\"\n          [attr.aria-invalid]=\"!isFieldValid(pocketDetailsForm, 'name')\"\n          [attr.aria-describedby]=\"pocketNameError?.id\"\n        ></bb-input-text-ui>\n        <bb-input-validation-message-ui [showErrors]=\"!isFieldValid(pocketDetailsForm, 'name')\">\n          <span \n            #pocketNameError\n            bbDynamicId\n            data-role=\"user-details-phone-number-validation-msg\"\n            i18n=\"You need to specify a Pocket name@@managePockets.create.details.input.validationError.required\"\n          >\n            You need to specify a Pocket name\n          </span>\n        </bb-input-validation-message-ui>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"bb-button-bar\">    \n    <button \n      bbButton \n      i18n=\"Continue@@managePockets.create.details.button.continue\"\n      class=\"bb-button-bar__button\" \n      type=\"submit\"\n    >\n      Continue\n    </button>\n    <button \n      bbButton \n      color=\"link\"\n      class=\"bb-button-bar__button bb-button-bar__button--across\"\n      i18n=\"Cancel@@managePockets.create.details.button.cancel\"\n      (click)=\"abort()\"\n    >\n      Cancel\n    </button>\n  </div>\n</form>\n\n<bb-modal-ui [isOpen]=\"showDialog\" (cancel)=\"closeDialog()\">\n  <bb-modal-header-ui>\n    <ng-template bbCustomModalHeader>\n      <div class=\"bb-stack\">\n        <div class=\"bb-stack__item\">\n          <span class=\"modal-title\" i18n=\"Choose pocket image@@managePockets.create.details.modal.title\">\n            Choose Pocket Image\n          </span>\n        </div>\n        <div class=\"bb-stack__item--push-right\">\n          <button\n            bbButton\n            (click)=\"closeDialog()\"\n            class=\"bb-stack__item-sm\"\n            color=\"unstyled\"\n            aria-label=\"close dialog\"\n            i18n-aria-label=\"close dialog button@@managePockets.create.details.modal.button.close\"\n          >\n            <bb-icon-ui color=\"muted\" name=\"clear\"></bb-icon-ui>\n          </button>\n        </div>\n      </div>\n    </ng-template>\n  </bb-modal-header-ui>\n\n  <bb-modal-body-ui>\n    <ng-template bbCustomModalBody>\n      <div class=\"bb-stack bb-stack--wrap\">\n        <div class=\"bb-stack__box-item bb-manage-pockets-create-details__modal-image-item\" *ngFor=\"let imageName of pocketImageList\" bbAccessibilityKeyboard (click)=\"changeType(imageName)\">\n          <div class=\"bb-block bb-block--sm\">\n            <img\n              class=\"bb-manage-pockets-create-details__pocket-image\"\n              [ngClass]=\"{ 'active': isTypeSelected(imageName)}\"\n              [src]=\"getImage(imageName) | async\" \n              alt=\"\" \n            >\n          </div>\n          <p class=\"bb-text-align-center bb-subtitle bb-text-bold\" [ngClass]=\"isTypeSelected(imageName) ? 'bb-text-primary' : 'bb-text-support'\">\n            {{imageName | bbRegexReplace: '-' : ' ' | titlecase}}\n          </p>\n        </div>\n      </div>\n    </ng-template>\n  </bb-modal-body-ui>\n</bb-modal-ui>", components: [{ type: i3.InputTextComponent, selector: "bb-input-text-ui", inputs: ["placeholder", "maxLength", "minLength", "autocomplete", "readonly", "mask", "maskValidator", "showCharCounter"], outputs: ["valueChange"] }, { type: i4.InputValidationMessageComponent, selector: "bb-input-validation-message-ui", inputs: ["showErrors", "messageId"] }, { type: i5.ModalComponent, selector: "bb-modal-ui", inputs: ["isOpen", "aria-labelledby", "aria-describedby", "modalOptions"], outputs: ["confirm", "cancel", "isOpenChange"] }, { type: i5.ModalHeaderComponent, selector: "bb-modal-header-ui", inputs: ["title"], outputs: ["close"] }, { type: i6.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }, { type: i5.ModalBodyComponent, selector: "bb-modal-body-ui" }], directives: [{ type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i7.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i1.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i8.DynamicIdDirective, selector: "[bbDynamicId]", inputs: ["bbDynamicId"], exportAs: ["bbDynamicId"] }, { type: i5.CustomModalHeaderDirective, selector: "ng-template[bbCustomModalHeader]" }, { type: i5.CustomModalBodyDirective, selector: "ng-template[bbCustomModalBody]" }, { type: i9.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i10.AccessibilityKeyboardDirective, selector: "[bbAccessibilityKeyboard]" }, { type: i9.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], pipes: { "async": i9.AsyncPipe, "titlecase": i9.TitleCasePipe, "bbRegexReplace": i11.RegexReplacePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ManagePocketsDetailsComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-manage-pockets-details',
                    templateUrl: './manage-pockets-details.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }, { type: i2.AssetsService }]; }, propDecorators: { pocketImageList: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlLXBvY2tldHMtZGV0YWlscy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wb2NrZXRzLWpvdXJuZXkvc3JjL21hbmFnZS1wb2NrZXRzLWNyZWF0ZS9jb21wb25lbnRzL21hbmFnZS1wb2NrZXRzLWRldGFpbHMvbWFuYWdlLXBvY2tldHMtZGV0YWlscy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wb2NrZXRzLWpvdXJuZXkvc3JjL21hbmFnZS1wb2NrZXRzLWNyZWF0ZS9jb21wb25lbnRzL21hbmFnZS1wb2NrZXRzLWRldGFpbHMvbWFuYWdlLXBvY2tldHMtZGV0YWlscy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUEwQixVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUlwRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUMzRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxvRUFBb0UsQ0FBQzs7Ozs7Ozs7Ozs7OztBQU1qSCxNQUFNLE9BQU8sNkJBQThCLFNBQVEsMkJBQTJCO0lBaUU1RSxZQUE2QixXQUF3QixFQUFxQixhQUE0QjtRQUNwRyxLQUFLLEVBQUUsQ0FBQztRQURtQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFxQixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQTdEdEcsZUFBVSxHQUFHLEtBQUssQ0FBQztRQXdEWCxpQkFBWSxHQUFtQixJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDO1lBQzdFLFVBQVUsRUFBRSwrQkFBK0I7WUFDM0MsaUJB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QkFBQztvQkFDVCxRQUFRLEVBQUUsMkJBQTJCO29CQUNyQyxXQUFXLEVBQUUseUNBQXlDO2lCQUN2RDs4SEFFVSxlQUFlO3NCQUF2QixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGl0bGVDYXNlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBBc3NldHNSZXNvbHZlciwgQXNzZXRzU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE5ld1BvY2tldEl0ZW0gfSBmcm9tICcuLi8uLi8uLi9tYW5hZ2UtcG9ja2V0cy1jb21tb24vbW9kZWwvcG9ja2V0LWl0ZW0ubW9kZWwnO1xuaW1wb3J0IHsgUmVnZXhSZXBsYWNlUGlwZSB9IGZyb20gJy4uLy4uLy4uL21hbmFnZS1wb2NrZXRzLWNvbW1vbi9waXBlcy9yZWdleC1yZXBsYWNlLnBpcGUnO1xuaW1wb3J0IHsgTWFuYWdlUG9ja2V0c0NyZWF0ZUJhc2VTdGVwIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY3JlYXRlLWJhc2Utc3RlcC9tYW5hZ2UtcG9ja2V0cy1jcmVhdGUtYmFzZS1zdGVwJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItbWFuYWdlLXBvY2tldHMtZGV0YWlscycsXG4gIHRlbXBsYXRlVXJsOiAnLi9tYW5hZ2UtcG9ja2V0cy1kZXRhaWxzLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgTWFuYWdlUG9ja2V0c0RldGFpbHNDb21wb25lbnQgZXh0ZW5kcyBNYW5hZ2VQb2NrZXRzQ3JlYXRlQmFzZVN0ZXAgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBwb2NrZXRJbWFnZUxpc3Q/OiBzdHJpbmdbXTtcbiAgcG9ja2V0RGV0YWlsc0Zvcm0/OiBGb3JtR3JvdXA7XG4gIHNlbGVjdGVkSW1hZ2VBc3NldFVybD86IE9ic2VydmFibGU8c3RyaW5nPjtcbiAgc2hvd0RpYWxvZyA9IGZhbHNlO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IGRlZmF1bHRJbWFnZSA9IHRoaXMucG9ja2V0SW1hZ2VMaXN0Py5bMF0gfHwgJ2hvbWUnO1xuICAgIHRoaXMucG9ja2V0RGV0YWlsc0Zvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgIG5hbWU6IFt0aGlzLnBhcnRpYWxQb2NrZXQ/Lm5hbWUgfHwgdGhpcy5mb3JtYXROYW1lKGRlZmF1bHRJbWFnZSksIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgaWNvbjogW3RoaXMucGFydGlhbFBvY2tldD8uaWNvbiB8fCBkZWZhdWx0SW1hZ2UsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgIH0pO1xuICAgIHRoaXMuc2VsZWN0ZWRJbWFnZUFzc2V0VXJsID0gdGhpcy5yZXNvbHZlQXNzZXQoYCR7dGhpcy5wYXJ0aWFsUG9ja2V0Py5pY29uIHx8IGRlZmF1bHRJbWFnZX0taW1nLndlYnBgKTtcbiAgfVxuXG4gIGZvcm1hdE5hbWUocG9ja2V0TmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aXRsZUNhc2VQaXBlID0gbmV3IFRpdGxlQ2FzZVBpcGUoKTtcbiAgICBjb25zdCByZWdleFBpcGUgPSBuZXcgUmVnZXhSZXBsYWNlUGlwZSgpO1xuICAgIGxldCBmb3JtYXRlZFRpdHRsZSA9IHBvY2tldE5hbWU7XG4gICAgZm9ybWF0ZWRUaXR0bGUgPSByZWdleFBpcGUudHJhbnNmb3JtKGZvcm1hdGVkVGl0dGxlLCAnLScsICcgJyk7XG4gICAgZm9ybWF0ZWRUaXR0bGUgPSB0aXRsZUNhc2VQaXBlLnRyYW5zZm9ybShmb3JtYXRlZFRpdHRsZSk7XG5cbiAgICByZXR1cm4gZm9ybWF0ZWRUaXR0bGU7XG4gIH1cblxuICBvcGVuRGlhbG9nKCkge1xuICAgIHRoaXMuc2hvd0RpYWxvZyA9IHRydWU7XG4gIH1cblxuICBjbG9zZURpYWxvZygpIHtcbiAgICB0aGlzLnNob3dEaWFsb2cgPSBmYWxzZTtcbiAgfVxuXG4gIGNoYW5nZVR5cGUoaW1nOiBzdHJpbmcpIHtcbiAgICB0aGlzLnBvY2tldERldGFpbHNGb3JtIS5wYXRjaFZhbHVlKHsgbmFtZTogdGhpcy5mb3JtYXROYW1lKGltZyksIGljb246IGltZyB9KTtcbiAgICB0aGlzLnNlbGVjdGVkSW1hZ2VBc3NldFVybCA9IHRoaXMucmVzb2x2ZUFzc2V0KGAke2ltZ30taW1nLndlYnBgKTtcbiAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XG4gIH1cblxuICBnZXRJbWFnZShpbWc6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMucmVzb2x2ZUFzc2V0KGAke2ltZ30taW1nLndlYnBgKTtcbiAgfVxuXG4gIGlzVHlwZVNlbGVjdGVkKGltZzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucG9ja2V0RGV0YWlsc0Zvcm0hLmdldCgnaWNvbicpIS52YWx1ZSA9PT0gaW1nO1xuICB9XG5cbiAgc2F2ZSgpIHtcbiAgICBpZiAodGhpcy5wb2NrZXREZXRhaWxzRm9ybSEudmFsaWQpIHtcbiAgICAgIHRoaXMuZ29OZXh0KHRoaXMuZm9ybWF0RGV0YWlsc1ZhbHVlcygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wb2NrZXREZXRhaWxzRm9ybSEubWFya0FsbEFzVG91Y2hlZCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0RGV0YWlsc1ZhbHVlcygpOiBQYXJ0aWFsPE5ld1BvY2tldEl0ZW0+IHtcbiAgICBjb25zdCB7IG5hbWUsIGljb24gfSA9IHRoaXMucG9ja2V0RGV0YWlsc0Zvcm0hLnZhbHVlO1xuICAgIHJldHVybiB7IG5hbWUsIGljb24gfTtcbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZUFzc2V0OiBBc3NldHNSZXNvbHZlciA9IHRoaXMuYXNzZXRzU2VydmljZS5jcmVhdGVBc3NldHNSZXNvbHZlcih7XG4gICAgd2lkZ2V0TmFtZTogJ2JiLW1hbmFnZS1wb2NrZXRzLWpvdXJuZXktYW5nJyxcbiAgICBnZXRVUklGcm9tQXNzZXRJRDogKGFzc2V0SWQ6IHN0cmluZykgPT4gYXNzZXRJZCxcbiAgfSk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsIHByb3RlY3RlZCByZWFkb25seSBhc3NldHNTZXJ2aWNlOiBBc3NldHNTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS14bFwiPlxuICA8aDIgaTE4bj1cIkNob29zZSBZb3VyIFBvY2tldCBJbWFnZSBhbmQgTmFtZUBAbWFuYWdlUG9ja2V0cy5jcmVhdGUuZGV0YWlscy5oZWFkZXJcIj5cbiAgICBDaG9vc2UgWW91ciBQb2NrZXQgSW1hZ2UgYW5kIE5hbWVcbiAgPC9oMj5cbjwvZGl2PlxuPGZvcm0gW2Zvcm1Hcm91cF09XCJwb2NrZXREZXRhaWxzRm9ybVwiIChzdWJtaXQpPVwic2F2ZSgpXCI+XG4gIDxkaXYgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0teGxcIj5cbiAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2sgYmItc3RhY2stLXdyYXAgYmItc3RhY2stLWFsaWduLXRvcFwiPlxuICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YWNrX19pdGVtIGJiLXN0YWNrX19pdGVtLS1zcGFjaW5nLXhsIGJiLW1hbmFnZS1wb2NrZXRzLWNyZWF0ZS1kZXRhaWxzX19wb2NrZXQtaW1hZ2UtY29udGFpbmVyXCI+XG4gICAgICAgIDxpbWcgXG4gICAgICAgICAgW3NyY109XCJzZWxlY3RlZEltYWdlQXNzZXRVcmwgfCBhc3luY1wiIFxuICAgICAgICAgIGNsYXNzPVwiYmItbWFuYWdlLXBvY2tldHMtY3JlYXRlLWRldGFpbHNfX3BvY2tldC1pbWFnZSBiYi1ibG9jayBiYi1ibG9jay0tc21cIiBcbiAgICAgICAgICBhbHQ9XCJSZXByZXNlbnRhdGlvbiBvZiB0aGUgc2VsZWN0ZWQgcG9ja2V0IHR5cGVcIlxuICAgICAgICAgIGkxOG4tYWx0PVwiUG9ja2V0IGltYWdlfGNoYW5nZXMgYWNjb3JkaW5nIHRvIHRoZSB0eXBlIG9mIHBvY2tldEBAbWFuYWdlUG9ja2V0cy5jcmVhdGUuZGV0YWlscy5zZWxlY3RlZEltYWdlQXNzZXRVcmxcIlxuICAgICAgICAgIChjbGljayk9XCJvcGVuRGlhbG9nKClcIlxuICAgICAgICA+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgI2J1dHRvblxuICAgICAgICAgICAgYmJCdXR0b25cbiAgICAgICAgICAgIGJ1dHRvblNpemU9XCJzbVwiXG4gICAgICAgICAgICBbYmxvY2tdPVwidHJ1ZVwiXG4gICAgICAgICAgICBjb2xvcj1cImxpbmstdGV4dFwiXG4gICAgICAgICAgICAoY2xpY2spPVwib3BlbkRpYWxvZygpXCJcbiAgICAgICAgICAgIGkxOG49XCJDaGFuZ2UgaW1hZ2UgYnV0dG9uQEBtYW5hZ2VQb2NrZXRzLmNyZWF0ZS5kZXRhaWxzLmJ1dHRvbi5jaGFuZ2VJbWFnZVwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgQ2hhbmdlIGltYWdlXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2tfX2JyZWFrIGJiLXN0YWNrX19icmVhay0teHMtZG93blwiPjwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YWNrX19pdGVtIGJiLW1hbmFnZS1wb2NrZXRzLWNyZWF0ZS1kZXRhaWxzX19pbnB1dC1jb250YWluZXJcIj5cbiAgICAgICAgPGJiLWlucHV0LXRleHQtdWlcbiAgICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJuYW1lXCJcbiAgICAgICAgICBkYXRhLXJvbGU9XCJtYW5hZ2UtcG9ja2V0LWNyZWF0aW9uLW5hbWVcIlxuICAgICAgICAgIGxhYmVsPVwiV2hhdCdzIHRoaXMgUG9ja2V0IGZvcj9cIlxuICAgICAgICAgIGkxOG4tbGFiZWw9XCJXaGF0J3MgdGhpcyBQb2NrZXQgZm9yP0BAbWFuYWdlUG9ja2V0cy5jcmVhdGUuZGV0YWlscy5pbnB1dC5sYWJlbFwiXG4gICAgICAgICAgbWF4TGVuZ3RoPVwiNTBcIlxuICAgICAgICAgIFthdHRyLmFyaWEtaW52YWxpZF09XCIhaXNGaWVsZFZhbGlkKHBvY2tldERldGFpbHNGb3JtLCAnbmFtZScpXCJcbiAgICAgICAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cInBvY2tldE5hbWVFcnJvcj8uaWRcIlxuICAgICAgICA+PC9iYi1pbnB1dC10ZXh0LXVpPlxuICAgICAgICA8YmItaW5wdXQtdmFsaWRhdGlvbi1tZXNzYWdlLXVpIFtzaG93RXJyb3JzXT1cIiFpc0ZpZWxkVmFsaWQocG9ja2V0RGV0YWlsc0Zvcm0sICduYW1lJylcIj5cbiAgICAgICAgICA8c3BhbiBcbiAgICAgICAgICAgICNwb2NrZXROYW1lRXJyb3JcbiAgICAgICAgICAgIGJiRHluYW1pY0lkXG4gICAgICAgICAgICBkYXRhLXJvbGU9XCJ1c2VyLWRldGFpbHMtcGhvbmUtbnVtYmVyLXZhbGlkYXRpb24tbXNnXCJcbiAgICAgICAgICAgIGkxOG49XCJZb3UgbmVlZCB0byBzcGVjaWZ5IGEgUG9ja2V0IG5hbWVAQG1hbmFnZVBvY2tldHMuY3JlYXRlLmRldGFpbHMuaW5wdXQudmFsaWRhdGlvbkVycm9yLnJlcXVpcmVkXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICBZb3UgbmVlZCB0byBzcGVjaWZ5IGEgUG9ja2V0IG5hbWVcbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvYmItaW5wdXQtdmFsaWRhdGlvbi1tZXNzYWdlLXVpPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9XCJiYi1idXR0b24tYmFyXCI+ICAgIFxuICAgIDxidXR0b24gXG4gICAgICBiYkJ1dHRvbiBcbiAgICAgIGkxOG49XCJDb250aW51ZUBAbWFuYWdlUG9ja2V0cy5jcmVhdGUuZGV0YWlscy5idXR0b24uY29udGludWVcIlxuICAgICAgY2xhc3M9XCJiYi1idXR0b24tYmFyX19idXR0b25cIiBcbiAgICAgIHR5cGU9XCJzdWJtaXRcIlxuICAgID5cbiAgICAgIENvbnRpbnVlXG4gICAgPC9idXR0b24+XG4gICAgPGJ1dHRvbiBcbiAgICAgIGJiQnV0dG9uIFxuICAgICAgY29sb3I9XCJsaW5rXCJcbiAgICAgIGNsYXNzPVwiYmItYnV0dG9uLWJhcl9fYnV0dG9uIGJiLWJ1dHRvbi1iYXJfX2J1dHRvbi0tYWNyb3NzXCJcbiAgICAgIGkxOG49XCJDYW5jZWxAQG1hbmFnZVBvY2tldHMuY3JlYXRlLmRldGFpbHMuYnV0dG9uLmNhbmNlbFwiXG4gICAgICAoY2xpY2spPVwiYWJvcnQoKVwiXG4gICAgPlxuICAgICAgQ2FuY2VsXG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuPC9mb3JtPlxuXG48YmItbW9kYWwtdWkgW2lzT3Blbl09XCJzaG93RGlhbG9nXCIgKGNhbmNlbCk9XCJjbG9zZURpYWxvZygpXCI+XG4gIDxiYi1tb2RhbC1oZWFkZXItdWk+XG4gICAgPG5nLXRlbXBsYXRlIGJiQ3VzdG9tTW9kYWxIZWFkZXI+XG4gICAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2tcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YWNrX19pdGVtXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJtb2RhbC10aXRsZVwiIGkxOG49XCJDaG9vc2UgcG9ja2V0IGltYWdlQEBtYW5hZ2VQb2NrZXRzLmNyZWF0ZS5kZXRhaWxzLm1vZGFsLnRpdGxlXCI+XG4gICAgICAgICAgICBDaG9vc2UgUG9ja2V0IEltYWdlXG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YWNrX19pdGVtLS1wdXNoLXJpZ2h0XCI+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgYmJCdXR0b25cbiAgICAgICAgICAgIChjbGljayk9XCJjbG9zZURpYWxvZygpXCJcbiAgICAgICAgICAgIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW0tc21cIlxuICAgICAgICAgICAgY29sb3I9XCJ1bnN0eWxlZFwiXG4gICAgICAgICAgICBhcmlhLWxhYmVsPVwiY2xvc2UgZGlhbG9nXCJcbiAgICAgICAgICAgIGkxOG4tYXJpYS1sYWJlbD1cImNsb3NlIGRpYWxvZyBidXR0b25AQG1hbmFnZVBvY2tldHMuY3JlYXRlLmRldGFpbHMubW9kYWwuYnV0dG9uLmNsb3NlXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8YmItaWNvbi11aSBjb2xvcj1cIm11dGVkXCIgbmFtZT1cImNsZWFyXCI+PC9iYi1pY29uLXVpPlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIDwvYmItbW9kYWwtaGVhZGVyLXVpPlxuXG4gIDxiYi1tb2RhbC1ib2R5LXVpPlxuICAgIDxuZy10ZW1wbGF0ZSBiYkN1c3RvbU1vZGFsQm9keT5cbiAgICAgIDxkaXYgY2xhc3M9XCJiYi1zdGFjayBiYi1zdGFjay0td3JhcFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2tfX2JveC1pdGVtIGJiLW1hbmFnZS1wb2NrZXRzLWNyZWF0ZS1kZXRhaWxzX19tb2RhbC1pbWFnZS1pdGVtXCIgKm5nRm9yPVwibGV0IGltYWdlTmFtZSBvZiBwb2NrZXRJbWFnZUxpc3RcIiBiYkFjY2Vzc2liaWxpdHlLZXlib2FyZCAoY2xpY2spPVwiY2hhbmdlVHlwZShpbWFnZU5hbWUpXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS1zbVwiPlxuICAgICAgICAgICAgPGltZ1xuICAgICAgICAgICAgICBjbGFzcz1cImJiLW1hbmFnZS1wb2NrZXRzLWNyZWF0ZS1kZXRhaWxzX19wb2NrZXQtaW1hZ2VcIlxuICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7ICdhY3RpdmUnOiBpc1R5cGVTZWxlY3RlZChpbWFnZU5hbWUpfVwiXG4gICAgICAgICAgICAgIFtzcmNdPVwiZ2V0SW1hZ2UoaW1hZ2VOYW1lKSB8IGFzeW5jXCIgXG4gICAgICAgICAgICAgIGFsdD1cIlwiIFxuICAgICAgICAgICAgPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxwIGNsYXNzPVwiYmItdGV4dC1hbGlnbi1jZW50ZXIgYmItc3VidGl0bGUgYmItdGV4dC1ib2xkXCIgW25nQ2xhc3NdPVwiaXNUeXBlU2VsZWN0ZWQoaW1hZ2VOYW1lKSA/ICdiYi10ZXh0LXByaW1hcnknIDogJ2JiLXRleHQtc3VwcG9ydCdcIj5cbiAgICAgICAgICAgIHt7aW1hZ2VOYW1lIHwgYmJSZWdleFJlcGxhY2U6ICctJyA6ICcgJyB8IHRpdGxlY2FzZX19XG4gICAgICAgICAgPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctdGVtcGxhdGU+XG4gIDwvYmItbW9kYWwtYm9keS11aT5cbjwvYmItbW9kYWwtdWk+Il19