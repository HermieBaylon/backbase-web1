import { Component } from '@angular/core';
import { POCKET_LOCALIZATIONS } from '../manage-pockets-common/localization/manage-pockets-journey.localizations';
import { TransferTypeEnum } from '../manage-pockets-common/model/pocket-item.model';
import * as i0 from "@angular/core";
import * as i1 from "../manage-pockets-common/services/manage-pockets.service";
import * as i2 from "../manage-pockets-common/services/payment-order.service";
import * as i3 from "@angular/router";
import * as i4 from "@backbase/ui-ang/notification";
import * as i5 from "../manage-pockets-journey-config.service";
import * as i6 from "@backbase/ui-ang/header";
import * as i7 from "../manage-pockets-transfers/components/manage-pockets-transfers-wrapper/manage-pockets-transfers-wrapper.component";
import * as i8 from "@backbase/ui-ang/loading-indicator";
import * as i9 from "@angular/common";
export class ManagePocketsTransfersViewComponent {
    constructor(managePocketsService, paymentOrderService, router, route, cd, notificationService, configService) {
        this.managePocketsService = managePocketsService;
        this.paymentOrderService = paymentOrderService;
        this.router = router;
        this.route = route;
        this.cd = cd;
        this.notificationService = notificationService;
        this.configService = configService;
        this.awaitingTransferResponse = false;
        this.pocketLocalizations = POCKET_LOCALIZATIONS;
        this.transferTypesEnum = TransferTypeEnum;
        const nav = this.router.getCurrentNavigation();
        this.pocketInfo = nav === null || nav === void 0 ? void 0 : nav.extras.state;
    }
    ngOnInit() {
        if (!this.pocketInfo) {
            console.error(`"pocketInfo" input is required in "ManagePocketsTransfersViewComponent". Redirecting to Pocket List`);
            this.navigateToList();
        }
        this.refreshAccountList();
    }
    refreshAccountList() {
        this.accountList$ = this.managePocketsService.retrieveAccountList();
    }
    abort() {
        this.navigateToList();
    }
    performTransfer(paymentInfo) {
        this.awaitingTransferResponse = true;
        const notificationLocalizations = this.generateNotificationLocalizations(paymentInfo);
        const onSuccess = () => {
            this.awaitingTransferResponse = false;
            const notificationMessage = notificationLocalizations.success.message;
            const notificationHeader = notificationLocalizations.success.header;
            this.cd.markForCheck();
            this.pushNotification(notificationMessage, 'success', notificationHeader);
            this.navigateToList();
        };
        const onError = () => {
            this.awaitingTransferResponse = false;
            const notificationMessage = notificationLocalizations.error.message;
            const notificationHeader = notificationLocalizations.error.header;
            this.cd.markForCheck();
            this.pushNotification(notificationMessage, 'error', notificationHeader);
        };
        this.paymentOrderService.transferMoney(paymentInfo).subscribe(onSuccess, onError);
    }
    navigateToList() {
        this.router.navigate(['../list'], { relativeTo: this.route });
    }
    pushNotification(message, modifier, header) {
        this.notificationService.showNotification({
            header,
            message,
            modifier,
            dismissible: true,
            ttl: 5000,
        });
    }
    generateNotificationLocalizations(paymentInfo) {
        var _a, _b, _c;
        const addMoneyLocalizations = {
            success: {
                header: $localize `:Success pocket transfer toast header@@managePockets.transfer.toast.success.header:Transfer Successful!`,
                message: $localize `:Success pocket transfer toast message@@managePockets.transfer.toast.success.add.message:You've just transfered ${paymentInfo.currencyCode} ${paymentInfo.amount} to your '${(_a = paymentInfo.pocketInfo) === null || _a === void 0 ? void 0 : _a.pocket.name}' pocket.`,
            },
            error: {
                header: $localize `:Error pocket creation toast header@@managePockets.transfer.toast.error.header.add:Failed to Add Money`,
                message: $localize `:Error pocket creation toast message@@managePockets.transfer.toast.error.message.add:Unable to proceed, please try again.`,
            },
        };
        const withdrawMoneyLocalizations = {
            success: {
                header: $localize `:Success pocket withdraw toast header@@managePockets.transfer.toast.success.header:Withdrawal Successful!`,
                message: $localize `:Success pocket withdraw toast message@@managePockets.transfer.toast.success.withdraw.message:You've just withdrawn ${paymentInfo.currencyCode} ${paymentInfo.amount} from your '${(_b = paymentInfo.pocketInfo) === null || _b === void 0 ? void 0 : _b.pocket.name}' pocket.`,
            },
            error: {
                header: $localize `:Error pocket creation toast header@@managePockets.transfer.toast.error.header.withdraw:Failed to Withdraw Money`,
                message: $localize `:Error pocket creation toast message@@managePockets.transfer.toast.error.message.withdraw:Unable to proceed, please try again.`,
            },
        };
        return ((_c = paymentInfo === null || paymentInfo === void 0 ? void 0 : paymentInfo.pocketInfo) === null || _c === void 0 ? void 0 : _c.transferType) === this.transferTypesEnum.ADD
            ? addMoneyLocalizations
            : withdrawMoneyLocalizations;
    }
}
ManagePocketsTransfersViewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ManagePocketsTransfersViewComponent, deps: [{ token: i1.ManagePocketsService }, { token: i2.PaymentOrderService }, { token: i3.Router }, { token: i3.ActivatedRoute }, { token: i0.ChangeDetectorRef }, { token: i4.NotificationService }, { token: i5.ManagePocketsJourneyConfigService }], target: i0.ɵɵFactoryTarget.Component });
ManagePocketsTransfersViewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: ManagePocketsTransfersViewComponent, selector: "bb-manage-pockets-list-view", ngImport: i0, template: "<div class=\"heading-widget bb-heading-widget px-0\" *ngIf=\"configService.displayHeaders\">\n  <bb-header-ui\n    headingType=\"h1\"\n    headingClasses=\"bb-heading-widget__heading\"\n    [heading]=\"pocketInfo?.transferType === transferTypesEnum.ADD ? pocketLocalizations.views.transfers.addMoneyHeader : pocketLocalizations.views.transfers.withdrawMoneyHeader\"\n  ></bb-header-ui>\n</div>\n\n<div class=\"bb-card bb-card--lg\">\n  <div class=\"bb-card__body\">\n    <bb-manage-pockets-transfers-wrapper\n      *ngIf=\"accountList$ | async as accountList; else loadingState\"\n      [accountList]=\"accountList\"\n      [awaitingTransferResponse]=\"awaitingTransferResponse\"\n      [journeyCurrency]=\"configService.journeyCurrency\"\n      [pocketInfo]=\"pocketInfo\"\n      (cancel)=\"abort()\"\n      (newTransfer)=\"performTransfer($event)\"\n    ></bb-manage-pockets-transfers-wrapper>\n  </div>\n</div>\n\n<ng-template #loadingState>\n  <bb-loading-indicator-ui\n    loaderSize=\"lg\"\n    text=\"Loading...\"\n    i18n-text=\"Loading...|Text for the loading indicator@@managePockets.transfersView.loading.indicator.text\"    \n  ></bb-loading-indicator-ui>\n</ng-template>", components: [{ type: i6.HeaderComponent, selector: "bb-header-ui", inputs: ["headingClasses", "headingType", "heading"] }, { type: i7.ManagePocketsTransfersWrapperComponent, selector: "bb-manage-pockets-transfers-wrapper", inputs: ["accountList", "awaitingTransferResponse", "partialNewPayment", "pocketInfo"], outputs: ["newTransfer"] }, { type: i8.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }], directives: [{ type: i9.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i9.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ManagePocketsTransfersViewComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-manage-pockets-list-view',
                    templateUrl: './manage-pockets-transfers-view.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.ManagePocketsService }, { type: i2.PaymentOrderService }, { type: i3.Router }, { type: i3.ActivatedRoute }, { type: i0.ChangeDetectorRef }, { type: i4.NotificationService }, { type: i5.ManagePocketsJourneyConfigService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlLXBvY2tldHMtdHJhbnNmZXJzLXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9tYW5hZ2UtcG9ja2V0cy1qb3VybmV5L3NyYy92aWV3cy9tYW5hZ2UtcG9ja2V0cy10cmFuc2ZlcnMtdmlldy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wb2NrZXRzLWpvdXJuZXkvc3JjL3ZpZXdzL21hbmFnZS1wb2NrZXRzLXRyYW5zZmVycy12aWV3LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBcUIsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBSXJFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDRFQUE0RSxDQUFDO0FBSWxILE9BQU8sRUFBc0IsZ0JBQWdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQzs7Ozs7Ozs7Ozs7QUFTeEcsTUFBTSxPQUFPLG1DQUFtQztJQWlHOUMsWUFDbUIsb0JBQTBDLEVBQzFDLG1CQUF3QyxFQUN4QyxNQUFjLEVBQ2QsS0FBcUIsRUFDckIsRUFBcUIsRUFDckIsbUJBQXdDLEVBQ2hELGFBQWdEO1FBTnhDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFDMUMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUNoRCxrQkFBYSxHQUFiLGFBQWEsQ0FBbUM7UUF0RzNELDZCQUF3QixHQUFHLEtBQUssQ0FBQztRQUVqQyx3QkFBbUIsR0FBRyxvQkFBb0IsQ0FBQztRQUMzQyxzQkFBaUIsR0FBRyxnQkFBZ0IsQ0FBQztRQXFHbkMsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFD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O2FBQy9PO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLE1BQU0sRUFBRSxTQUFTLENBQUEsd0dBQXdHO2dCQUN6SCxPQUFPLEVBQUUsU0FBUyxDQUFBLDJIQUEySDthQUM5STtTQUNGLENBQUM7UUFFRixNQUFNLDBCQUEwQixHQUFHO1lBQ2pDLE9BQU8sRUFBRTtnQkFDUCxNQUFNLEVBQUUsU0FBUyxDQUFBLDJHQUEyRztnQkFDNUgsT0FBTyxFQUFFLFNBQVMsQ0FBQSx1SEFBdUgsV0FBVyxDQUFDLFlBQVksSUFBSSxXQUFXLENBQUMsTUFBTSxlQUFlLE1BQUEsV0FBVyxDQUFDLFVBQVUsMENBQUUsTUFBTSxDQUFDLElBQUksV0FBVzthQUNyUDtZQUNELEtBQUssRUFBRTtnQkFDTCxNQUFNLEVBQUUsU0FBUyxDQUFBLGtIQUFrSDtnQkFDbkksT0FBTyxFQUFFLFNBQVMsQ0FBQSxnSUFBZ0k7YUFDbko7U0FDRixDQUFDO1FBRUYsT0FBTyxDQUFBLE1BQUEsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLFVBQVUsMENBQUUsWUFBWSxNQUFLLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHO1lBQ3pFLENBQUMsQ0FBQyxxQkFBcUI7WUFDdkIsQ0FBQyxDQUFDLDBCQUEwQixDQUFDO0lBQ2pDLENBQUM7O2lJQS9GVSxtQ0FBbUM7cUhBQW5DLG1DQUFtQyxtRUNqQmhELGtxQ0E0QmM7NEZEWEQsbUNBQW1DO2tCQUovQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSw2QkFBNkI7b0JBQ3ZDLFdBQVcsRUFBRSxnREFBZ0Q7aUJBQzlEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL25vdGlmaWNhdGlvbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBQT0NLRVRfTE9DQUxJWkFUSU9OUyB9IGZyb20gJy4uL21hbmFnZS1wb2NrZXRzLWNvbW1vbi9sb2NhbGl6YXRpb24vbWFuYWdlLXBvY2tldHMtam91cm5leS5sb2NhbGl6YXRpb25zJztcbmltcG9ydCB7IEFjY291bnRJdGVtIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY29tbW9uL21vZGVsL2FjY291bnRzLm1vZGVsJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbk1lc3NhZ2UsIE5vdGlmaWNhdGlvbk1vZGlmaWVyIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY29tbW9uL21vZGVsL25vdGlmaWNhdGlvbnMubW9kZWwnO1xuaW1wb3J0IHsgUGF5bWVudEZvcm1JdGVtIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY29tbW9uL21vZGVsL3BheW1lbnQubW9kZWwnO1xuaW1wb3J0IHsgUG9ja2V0VHJhbnNmZXJJdGVtLCBUcmFuc2ZlclR5cGVFbnVtIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY29tbW9uL21vZGVsL3BvY2tldC1pdGVtLm1vZGVsJztcbmltcG9ydCB7IE1hbmFnZVBvY2tldHNTZXJ2aWNlIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtY29tbW9uL3NlcnZpY2VzL21hbmFnZS1wb2NrZXRzLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGF5bWVudE9yZGVyU2VydmljZSB9IGZyb20gJy4uL21hbmFnZS1wb2NrZXRzLWNvbW1vbi9zZXJ2aWNlcy9wYXltZW50LW9yZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTWFuYWdlUG9ja2V0c0pvdXJuZXlDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vbWFuYWdlLXBvY2tldHMtam91cm5leS1jb25maWcuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLW1hbmFnZS1wb2NrZXRzLWxpc3QtdmlldycsXG4gIHRlbXBsYXRlVXJsOiAnLi9tYW5hZ2UtcG9ja2V0cy10cmFuc2ZlcnMtdmlldy5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIE1hbmFnZVBvY2tldHNUcmFuc2ZlcnNWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgYWNjb3VudExpc3QkPzogT2JzZXJ2YWJsZTxBY2NvdW50SXRlbVtdPjtcbiAgYXdhaXRpbmdUcmFuc2ZlclJlc3BvbnNlID0gZmFsc2U7XG4gIHBvY2tldEluZm8/OiBQb2NrZXRUcmFuc2Zlckl0ZW07XG4gIHBvY2tldExvY2FsaXphdGlvbnMgPSBQT0NLRVRfTE9DQUxJWkFUSU9OUztcbiAgdHJhbnNmZXJUeXBlc0VudW0gPSBUcmFuc2ZlclR5cGVFbnVtO1xuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5wb2NrZXRJbmZvKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBgXCJwb2NrZXRJbmZvXCIgaW5wdXQgaXMgcmVxdWlyZWQgaW4gXCJNYW5hZ2VQb2NrZXRzVHJhbnNmZXJzVmlld0NvbXBvbmVudFwiLiBSZWRpcmVjdGluZyB0byBQb2NrZXQgTGlzdGAsXG4gICAgICApO1xuICAgICAgdGhpcy5uYXZpZ2F0ZVRvTGlzdCgpO1xuICAgIH1cbiAgICB0aGlzLnJlZnJlc2hBY2NvdW50TGlzdCgpO1xuICB9XG5cbiAgcmVmcmVzaEFjY291bnRMaXN0KCkge1xuICAgIHRoaXMuYWNjb3VudExpc3QkID0gdGhpcy5tYW5hZ2VQb2NrZXRzU2VydmljZS5yZXRyaWV2ZUFjY291bnRMaXN0KCk7XG4gIH1cblxuICBhYm9ydCgpIHtcbiAgICB0aGlzLm5hdmlnYXRlVG9MaXN0KCk7XG4gIH1cblxuICBwZXJmb3JtVHJhbnNmZXIocGF5bWVudEluZm86IFBheW1lbnRGb3JtSXRlbSkge1xuICAgIHRoaXMuYXdhaXRpbmdUcmFuc2ZlclJlc3BvbnNlID0gdHJ1ZTtcbiAgICBjb25zdCBub3RpZmljYXRpb25Mb2NhbGl6YXRpb25zID0gdGhpcy5nZW5lcmF0ZU5vdGlmaWNhdGlvbkxvY2FsaXphdGlvbnMocGF5bWVudEluZm8pO1xuXG4gICAgY29uc3Qgb25TdWNjZXNzID0gKCkgPT4ge1xuICAgICAgdGhpcy5hd2FpdGluZ1RyYW5zZmVyUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBub3RpZmljYXRpb25Mb2NhbGl6YXRpb25zLnN1Y2Nlc3MubWVzc2FnZTtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbkhlYWRlciA9IG5vdGlmaWNhdGlvbkxvY2FsaXphdGlvbnMuc3VjY2Vzcy5oZWFkZXI7XG5cbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICB0aGlzLnB1c2hOb3RpZmljYXRpb24obm90aWZpY2F0aW9uTWVzc2FnZSwgJ3N1Y2Nlc3MnLCBub3RpZmljYXRpb25IZWFkZXIpO1xuICAgICAgdGhpcy5uYXZpZ2F0ZVRvTGlzdCgpO1xuICAgIH07XG5cbiAgICBjb25zdCBvbkVycm9yID0gKCkgPT4ge1xuICAgICAgdGhpcy5hd2FpdGluZ1RyYW5zZmVyUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBub3RpZmljYXRpb25Mb2NhbGl6YXRpb25zLmVycm9yLm1lc3NhZ2U7XG4gICAgICBjb25zdCBub3RpZmljYXRpb25IZWFkZXIgPSBub3RpZmljYXRpb25Mb2NhbGl6YXRpb25zLmVycm9yLmhlYWRlcjtcblxuICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIHRoaXMucHVzaE5vdGlmaWNhdGlvbihub3RpZmljYXRpb25NZXNzYWdlLCAnZXJyb3InLCBub3RpZmljYXRpb25IZWFkZXIpO1xuICAgIH07XG5cbiAgICB0aGlzLnBheW1lbnRPcmRlclNlcnZpY2UudHJhbnNmZXJNb25leShwYXltZW50SW5mbykuc3Vic2NyaWJlKG9uU3VjY2Vzcywgb25FcnJvcik7XG4gIH1cblxuICBwcml2YXRlIG5hdmlnYXRlVG9MaXN0KCkge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnLi4vbGlzdCddLCB7IHJlbGF0aXZlVG86IHRoaXMucm91dGUgfSk7XG4gIH1cblxuICBwcml2YXRlIHB1c2hOb3RpZmljYXRpb24oXG4gICAgbWVzc2FnZTogTm90aWZpY2F0aW9uTWVzc2FnZSxcbiAgICBtb2RpZmllcj86IE5vdGlmaWNhdGlvbk1vZGlmaWVyLFxuICAgIGhlYWRlcj86IE5vdGlmaWNhdGlvbk1lc3NhZ2UsXG4gICkge1xuICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgIGhlYWRlcixcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBtb2RpZmllcixcbiAgICAgIGRpc21pc3NpYmxlOiB0cnVlLFxuICAgICAgdHRsOiA1MDAwLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU5vdGlmaWNhdGlvbkxvY2FsaXphdGlvbnMocGF5bWVudEluZm86IFBheW1lbnRGb3JtSXRlbSkge1xuICAgIGNvbnN0IGFkZE1vbmV5TG9jYWxpemF0aW9ucyA9IHtcbiAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgaGVhZGVyOiAkbG9jYWxpemVgOlN1Y2Nlc3MgcG9ja2V0IHRyYW5zZmVyIHRvYXN0IGhlYWRlckBAbWFuYWdlUG9ja2V0cy50cmFuc2Zlci50b2FzdC5zdWNjZXNzLmhlYWRlcjpUcmFuc2ZlciBTdWNjZXNzZnVsIWAsXG4gICAgICAgIG1lc3NhZ2U6ICRsb2NhbGl6ZWA6U3VjY2VzcyBwb2NrZXQgdHJhbnNmZXIgdG9hc3QgbWVzc2FnZUBAbWFuYWdlUG9ja2V0cy50cmFuc2Zlci50b2FzdC5zdWNjZXNzLmFkZC5tZXNzYWdlOllvdSd2ZSBqdXN0IHRyYW5zZmVyZWQgJHtwYXltZW50SW5mby5jdXJyZW5jeUNvZGV9ICR7cGF5bWVudEluZm8uYW1vdW50fSB0byB5b3VyICcke3BheW1lbnRJbmZvLnBvY2tldEluZm8/LnBvY2tldC5uYW1lfScgcG9ja2V0LmAsXG4gICAgICB9LFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgaGVhZGVyOiAkbG9jYWxpemVgOkVycm9yIHBvY2tldCBjcmVhdGlvbiB0b2FzdCBoZWFkZXJAQG1hbmFnZVBvY2tldHMudHJhbnNmZXIudG9hc3QuZXJyb3IuaGVhZGVyLmFkZDpGYWlsZWQgdG8gQWRkIE1vbmV5YCxcbiAgICAgICAgbWVzc2FnZTogJGxvY2FsaXplYDpFcnJvciBwb2NrZXQgY3JlYXRpb24gdG9hc3QgbWVzc2FnZUBAbWFuYWdlUG9ja2V0cy50cmFuc2Zlci50b2FzdC5lcnJvci5tZXNzYWdlLmFkZDpVbmFibGUgdG8gcHJvY2VlZCwgcGxlYXNlIHRyeSBhZ2Fpbi5gLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3Qgd2l0aGRyYXdNb25leUxvY2FsaXphdGlvbnMgPSB7XG4gICAgICBzdWNjZXNzOiB7XG4gICAgICAgIGhlYWRlcjogJGxvY2FsaXplYDpTdWNjZXNzIHBvY2tldCB3aXRoZHJhdyB0b2FzdCBoZWFkZXJAQG1hbmFnZVBvY2tldHMudHJhbnNmZXIudG9hc3Quc3VjY2Vzcy5oZWFkZXI6V2l0aGRyYXdhbCBTdWNjZXNzZnVsIWAsXG4gICAgICAgIG1lc3NhZ2U6ICRsb2NhbGl6ZWA6U3VjY2VzcyBwb2NrZXQgd2l0aGRyYXcgdG9hc3QgbWVzc2FnZUBAbWFuYWdlUG9ja2V0cy50cmFuc2Zlci50b2FzdC5zdWNjZXNzLndpdGhkcmF3Lm1lc3NhZ2U6WW91J3ZlIGp1c3Qgd2l0aGRyYXduICR7cGF5bWVudEluZm8uY3VycmVuY3lDb2RlfSAke3BheW1lbnRJbmZvLmFtb3VudH0gZnJvbSB5b3VyICcke3BheW1lbnRJbmZvLnBvY2tldEluZm8/LnBvY2tldC5uYW1lfScgcG9ja2V0LmAsXG4gICAgICB9LFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgaGVhZGVyOiAkbG9jYWxpemVgOkVycm9yIHBvY2tldCBjcmVhdGlvbiB0b2FzdCBoZWFkZXJAQG1hbmFnZVBvY2tldHMudHJhbnNmZXIudG9hc3QuZXJyb3IuaGVhZGVyLndpdGhkcmF3OkZhaWxlZCB0byBXaXRoZHJhdyBNb25leWAsXG4gICAgICAgIG1lc3NhZ2U6ICRsb2NhbGl6ZWA6RXJyb3IgcG9ja2V0IGNyZWF0aW9uIHRvYXN0IG1lc3NhZ2VAQG1hbmFnZVBvY2tldHMudHJhbnNmZXIudG9hc3QuZXJyb3IubWVzc2FnZS53aXRoZHJhdzpVbmFibGUgdG8gcHJvY2VlZCwgcGxlYXNlIHRyeSBhZ2Fpbi5gLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHBheW1lbnRJbmZvPy5wb2NrZXRJbmZvPy50cmFuc2ZlclR5cGUgPT09IHRoaXMudHJhbnNmZXJUeXBlc0VudW0uQUREXG4gICAgICA/IGFkZE1vbmV5TG9jYWxpemF0aW9uc1xuICAgICAgOiB3aXRoZHJhd01vbmV5TG9jYWxpemF0aW9ucztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWFuYWdlUG9ja2V0c1NlcnZpY2U6IE1hbmFnZVBvY2tldHNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGF5bWVudE9yZGVyU2VydmljZTogUGF5bWVudE9yZGVyU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbm90aWZpY2F0aW9uU2VydmljZTogTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICByZWFkb25seSBjb25maWdTZXJ2aWNlOiBNYW5hZ2VQb2NrZXRzSm91cm5leUNvbmZpZ1NlcnZpY2UsXG4gICkge1xuICAgIGNvbnN0IG5hdiA9IHRoaXMucm91dGVyLmdldEN1cnJlbnROYXZpZ2F0aW9uKCk7XG4gICAgdGhpcy5wb2NrZXRJbmZvID0gbmF2Py5leHRyYXMuc3RhdGUgYXMgUG9ja2V0VHJhbnNmZXJJdGVtO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiaGVhZGluZy13aWRnZXQgYmItaGVhZGluZy13aWRnZXQgcHgtMFwiICpuZ0lmPVwiY29uZmlnU2VydmljZS5kaXNwbGF5SGVhZGVyc1wiPlxuICA8YmItaGVhZGVyLXVpXG4gICAgaGVhZGluZ1R5cGU9XCJoMVwiXG4gICAgaGVhZGluZ0NsYXNzZXM9XCJiYi1oZWFkaW5nLXdpZGdldF9faGVhZGluZ1wiXG4gICAgW2hlYWRpbmddPVwicG9ja2V0SW5mbz8udHJhbnNmZXJUeXBlID09PSB0cmFuc2ZlclR5cGVzRW51bS5BREQgPyBwb2NrZXRMb2NhbGl6YXRpb25zLnZpZXdzLnRyYW5zZmVycy5hZGRNb25leUhlYWRlciA6IHBvY2tldExvY2FsaXphdGlvbnMudmlld3MudHJhbnNmZXJzLndpdGhkcmF3TW9uZXlIZWFkZXJcIlxuICA+PC9iYi1oZWFkZXItdWk+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz1cImJiLWNhcmQgYmItY2FyZC0tbGdcIj5cbiAgPGRpdiBjbGFzcz1cImJiLWNhcmRfX2JvZHlcIj5cbiAgICA8YmItbWFuYWdlLXBvY2tldHMtdHJhbnNmZXJzLXdyYXBwZXJcbiAgICAgICpuZ0lmPVwiYWNjb3VudExpc3QkIHwgYXN5bmMgYXMgYWNjb3VudExpc3Q7IGVsc2UgbG9hZGluZ1N0YXRlXCJcbiAgICAgIFthY2NvdW50TGlzdF09XCJhY2NvdW50TGlzdFwiXG4gICAgICBbYXdhaXRpbmdUcmFuc2ZlclJlc3BvbnNlXT1cImF3YWl0aW5nVHJhbnNmZXJSZXNwb25zZVwiXG4gICAgICBbam91cm5leUN1cnJlbmN5XT1cImNvbmZpZ1NlcnZpY2Uuam91cm5leUN1cnJlbmN5XCJcbiAgICAgIFtwb2NrZXRJbmZvXT1cInBvY2tldEluZm9cIlxuICAgICAgKGNhbmNlbCk9XCJhYm9ydCgpXCJcbiAgICAgIChuZXdUcmFuc2Zlcik9XCJwZXJmb3JtVHJhbnNmZXIoJGV2ZW50KVwiXG4gICAgPjwvYmItbWFuYWdlLXBvY2tldHMtdHJhbnNmZXJzLXdyYXBwZXI+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxuZy10ZW1wbGF0ZSAjbG9hZGluZ1N0YXRlPlxuICA8YmItbG9hZGluZy1pbmRpY2F0b3ItdWlcbiAgICBsb2FkZXJTaXplPVwibGdcIlxuICAgIHRleHQ9XCJMb2FkaW5nLi4uXCJcbiAgICBpMThuLXRleHQ9XCJMb2FkaW5nLi4ufFRleHQgZm9yIHRoZSBsb2FkaW5nIGluZGljYXRvckBAbWFuYWdlUG9ja2V0cy50cmFuc2ZlcnNWaWV3LmxvYWRpbmcuaW5kaWNhdG9yLnRleHRcIiAgICBcbiAgPjwvYmItbG9hZGluZy1pbmRpY2F0b3ItdWk+XG48L25nLXRlbXBsYXRlPiJdfQ==