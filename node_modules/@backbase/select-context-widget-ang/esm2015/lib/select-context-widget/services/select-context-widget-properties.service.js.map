{"version":3,"file":"select-context-widget-properties.service.js","sourceRoot":"","sources":["../../../../../../../libs/select-context-widget-ang/src/lib/select-context-widget/services/select-context-widget-properties.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Optional } from '@angular/core';\nimport { ItemModel } from '@backbase/foundation-ang/core';\nimport { Property } from '@backbase/foundation-ang/web-sdk';\n\nimport { Observable, combineLatest, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport const WidgetProperty = {\n  PAGE_SIZE: 'pageSize',\n  INCLUDE_CURRENT_CONTEXT: 'includeCurrentContext',\n  SHOW_SEARCH_AFTER: 'showSearchAfter',\n  REDIRECT_PAGE: 'selectContextRedirectPage',\n  BACK_OUTPUT: 'output.back',\n};\n\nexport interface WidgetProperties {\n  pageSize: number;\n  includeCurrentContext: boolean;\n  showSearchAfter: number;\n  selectContextRedirectPage: string;\n  backOutput: string;\n}\n\n@Injectable()\nexport class SelectContextWidgetPropertiesService {\n  constructor(@Optional() private readonly itemModel: ItemModel) {}\n\n  private readonly pageSizeSubject$ = new BehaviorSubject<number | undefined>(undefined);\n  private readonly includeCurrentContextSubject$ = new BehaviorSubject<boolean | undefined>(undefined);\n  private readonly showSearchAfterSubject$ = new BehaviorSubject<number | undefined>(undefined);\n  private readonly selectContextRedirectPageSubject$ = new BehaviorSubject<string | undefined>(undefined);\n  private readonly backOutputSubject$ = new BehaviorSubject<string | undefined>(undefined);\n\n  private readonly pageSize: Observable<number> =\n    this.itemModel\n      ?.property(WidgetProperty.PAGE_SIZE, '7')\n      .pipe(map(propertyValue => parseInt(<string>propertyValue, 10))) || of(7);\n\n  private readonly includeCurrentContext: Observable<boolean> =\n    this.itemModel\n      ?.property(WidgetProperty.INCLUDE_CURRENT_CONTEXT, 'false')\n      .pipe(map(propertyValue => `${propertyValue}` === 'true')) || of(false);\n\n  private readonly showSearchAfter: Observable<number> =\n    this.itemModel\n      ?.property(WidgetProperty.SHOW_SEARCH_AFTER, '7')\n      .pipe(map(propertyValue => parseInt(<string>propertyValue, 10))) || of(7);\n\n  private readonly selectContextRedirectPage: Observable<string> =\n    this.itemModel?.property(WidgetProperty.REDIRECT_PAGE, '') || of('');\n\n  private readonly backOutput: Observable<string> = this.itemModel?.property(WidgetProperty.BACK_OUTPUT, '') || of('');\n\n  readonly pageSize$ = this.getProperty<number>(this.pageSizeSubject$, this.pageSize).pipe(map(Number));\n\n  readonly includeCurrentContext$ = this.getProperty<boolean>(\n    this.includeCurrentContextSubject$,\n    this.includeCurrentContext,\n  ).pipe(map(this.toBoolean));\n\n  readonly showSearchAfter$ = this.getProperty<number>(this.showSearchAfterSubject$, this.showSearchAfter).pipe(\n    map(Number),\n  );\n\n  readonly selectContextRedirectPage$ = this.getProperty<string>(\n    this.selectContextRedirectPageSubject$,\n    this.selectContextRedirectPage,\n  );\n\n  readonly backOutput$ = this.getProperty<string>(this.backOutputSubject$, this.backOutput);\n\n  private getProperty<T>(input$: Observable<T | undefined>, itemModel: Observable<Property>): Observable<T> {\n    return combineLatest([input$, itemModel]).pipe(\n      map(([value, valueIM]) => (value === undefined ? valueIM : value) as T),\n    );\n  }\n\n  private toBoolean(value: string | boolean) {\n    return value === 'true' || value === true;\n  }\n\n  setPageSize(value: number) {\n    this.pageSizeSubject$.next(value);\n  }\n\n  setIncludeCurrentContext(value: boolean) {\n    this.includeCurrentContextSubject$.next(value);\n  }\n\n  setShowSearchAfter(value: number) {\n    this.showSearchAfterSubject$.next(value);\n  }\n\n  setSelectContextRedirectPage(value: string) {\n    this.selectContextRedirectPageSubject$.next(value);\n  }\n\n  setBackOutput(value: string) {\n    this.backOutputSubject$.next(value);\n  }\n\n  readonly properties: Observable<WidgetProperties> = combineLatest([\n    this.pageSize$,\n    this.includeCurrentContext$,\n    this.showSearchAfter$,\n    this.selectContextRedirectPage$,\n    this.backOutput$,\n  ]).pipe(\n    map(([pageSize, includeCurrentContext, showSearchAfter, selectContextRedirectPage, backOutput]) => ({\n      pageSize,\n      includeCurrentContext,\n      showSearchAfter,\n      selectContextRedirectPage,\n      backOutput,\n    })),\n  );\n}\n"]}