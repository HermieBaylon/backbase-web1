{"version":3,"file":"select-context-container.component.js","sourceRoot":"","sources":["../../../../../../../libs/select-context-widget-ang/src/lib/select-context-widget/select-context-container/select-context-container.component.ts","../../../../../../../libs/select-context-widget-ang/src/lib/select-context-widget/select-context-container/select-context-container.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Directive,\n  InjectionToken,\n  Inject,\n  EventEmitter,\n  Output,\n  OnDestroy,\n  OnInit,\n  Optional,\n} from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AvailableFeature, BbTemplate, DeprecationsService, FeaturesService } from '@backbase/foundation-ang/core';\nimport { Observable, of, BehaviorSubject, Subject } from 'rxjs';\nimport { switchMap, shareReplay, tap, map, take, takeUntil } from 'rxjs/operators';\n\nimport { LogoutService, LOGOUT, PageConfig, PAGE_CONFIG } from '@backbase/foundation-ang/web-sdk';\nimport { SelectContextService, Data, ServiceAgreement, RequestParams } from '../services/select-context.service';\nimport {\n  SelectContextWidgetPropertiesService,\n  WidgetProperties,\n} from '../services/select-context-widget-properties.service';\nimport {\n  SELECT_CONTEXT_URL_PROCESSOR_SERVICE_TOKEN,\n  SelectContextUrlProcessorService,\n  RedirectProtocol,\n} from '../services/default-select-context-redirect.service';\n\nexport interface SelectContextContainerCustomizableContext {\n  serviceAgreements: Data | null;\n  loading: boolean | null;\n  error: any | undefined | null;\n  saving: boolean | null;\n  params: RequestParams | null;\n  widgetProperties: WidgetProperties | null;\n  currentContext: ServiceAgreement | undefined | null;\n}\n\nexport const WINDOW = new InjectionToken<string>('Select Context :: WindowToken');\n\nexport const SELECT_CONTEXT_INNER_CONTAINER: AvailableFeature = {\n  name: 'SELECT_CONTEXT_INNER_CONTAINER',\n  description: 'Include a card container in the select context widget template',\n};\n\n@Component({\n  selector: 'bb-select-context-container',\n  templateUrl: './select-context-container.component.html',\n})\nexport class SelectContextContainerComponent implements OnInit, OnDestroy {\n  @Output() back = new EventEmitter<void>();\n  @Output() loadingChanged = new EventEmitter<boolean>();\n  private readonly destroy$ = new Subject<void>();\n  hostRef = this;\n  serviceAgreements: Observable<Data> = this.service.serviceAgreements.pipe(\n    tap((data: Data) => this.selectFirstIfOnlyOne(data)),\n  );\n  loading: Observable<boolean> = this.service.loading;\n  error: Observable<any | undefined> = this.service.error;\n  params: Observable<RequestParams> = this.service.params;\n  widgetProperties: Observable<WidgetProperties> = this.widgetPropertiesService.properties;\n  currentContext: Observable<ServiceAgreement | undefined> = this.widgetProperties.pipe(\n    switchMap(({ includeCurrentContext }: WidgetProperties) => {\n      if (includeCurrentContext) {\n        return this.service.currentContext;\n      }\n      return of(undefined);\n    }),\n    shareReplay(1),\n  );\n\n  searchValue = '';\n  saving = new BehaviorSubject(false);\n  savingError = false;\n\n  constructor(\n    private readonly service: SelectContextService,\n    private readonly widgetPropertiesService: SelectContextWidgetPropertiesService,\n    private readonly router: Router,\n    @Inject(WINDOW) private readonly localWindow: any,\n    @Inject(SELECT_CONTEXT_URL_PROCESSOR_SERVICE_TOKEN)\n    private readonly redirectUrlService: SelectContextUrlProcessorService,\n    @Optional() @Inject(PAGE_CONFIG) readonly pageConfig: PageConfig,\n    @Inject(LOGOUT) private readonly logoutService: LogoutService,\n    private readonly featuresService: FeaturesService,\n    private readonly deprecationsService: DeprecationsService,\n  ) {\n    this.loading.pipe(takeUntil(this.destroy$)).subscribe((event: boolean) => {\n      this.loadingChanged.emit(event);\n    });\n  }\n\n  get hasContainer() {\n    return this.featuresService.isEnabled(SELECT_CONTEXT_INNER_CONTAINER);\n  }\n\n  search(text: string) {\n    this.searchValue = text;\n    this.service.search(text);\n  }\n\n  loadMore() {\n    this.service.loadMore();\n  }\n\n  select(serviceAgreement: ServiceAgreement) {\n    this.savingError = false;\n    this.saving.next(true);\n    this.loadingChanged.emit(true);\n    this.service\n      .select(serviceAgreement)\n      .pipe(\n        switchMap(() => this.widgetProperties),\n        map(({ selectContextRedirectPage }: WidgetProperties): string => selectContextRedirectPage),\n        take(1),\n      )\n      .subscribe(\n        (selectContextRedirectPage: string) =>\n          this.afterSelectContextSuccess(serviceAgreement, selectContextRedirectPage),\n        () => {\n          /* error */\n          this.savingError = true;\n          this.saving.next(false);\n        },\n      );\n  }\n\n  goBack() {\n    this.logoutService\n      .logout()\n      .catch(() => {})\n      .then(() => {\n        this.back.emit();\n      });\n  }\n\n  private selectFirstIfOnlyOne(result: Data) {\n    if (result.totalCount === 1 && result.params.from === 0 && !result.params.query) {\n      this.select(result.items[0]);\n    }\n  }\n\n  private redirectToUrl(serviceAgreement: ServiceAgreement, url: string, spaMode: RedirectProtocol) {\n    this.redirectUrlService\n      .processUrl(serviceAgreement, url, spaMode)\n      .pipe(\n        tap(processedUrl => {\n          const bbWindow = this.localWindow;\n          const currentUrl = bbWindow.location.pathname;\n          const [newUrl] = processedUrl.replace(bbWindow.location.origin, '').split('#');\n          bbWindow.location.href = processedUrl;\n          if (currentUrl === newUrl) {\n            bbWindow.location.reload(true);\n          }\n        }),\n        take(1),\n      )\n      .subscribe();\n  }\n\n  private afterSelectContextSuccess(serviceAgreement: ServiceAgreement, urlModel = '') {\n    const spaMode = urlModel.substring(0, 4);\n    const urlToNavigate = urlModel.substring(4);\n    const bbWindow = this.localWindow;\n\n    switch (spaMode) {\n      case 'spa:':\n        if (bbWindow.reloadPage) {\n          bbWindow.reloadPage().then(() => {\n            this.redirectUrlService\n              .processUrl(serviceAgreement, urlToNavigate, spaMode)\n              .pipe(\n                tap(url => this.router.navigateByUrl(url)),\n                take(1),\n              )\n              .subscribe();\n          });\n        } else {\n          throw new Error('window.reloadPage() not available. SPA navigation is not supported');\n        }\n        break;\n\n      case 'mpa:':\n        const gatewayRoot = this.pageConfig.linkRoot || '';\n        const portalName = this.pageConfig.portalName || '';\n        const mpaUrl = `${gatewayRoot}${portalName ? '/' + portalName : ''}/${urlToNavigate}`.replace(/\\/{2,}/g, '/');\n        this.redirectToUrl(serviceAgreement, mpaUrl, spaMode);\n        break;\n\n      case 'abs:':\n        const linkRoot = this.pageConfig.linkRoot || '';\n        const absUrl = `${linkRoot}/${urlToNavigate}`.replace(/\\/{2,}/g, '/');\n        this.redirectToUrl(serviceAgreement, absUrl, spaMode);\n        break;\n    }\n  }\n\n  ngOnInit() {\n    if (!this.hasContainer) {\n      this.deprecationsService.logDeprecatedFeature(\n        'Select context widget will include card container in its template in the next major release. Please enable `SELECT_CONTEXT_INNER_CONTAINER` and adjust your page to support this change.',\n      );\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n}\n\n@Directive({\n  selector: '[bbSelectContextContainerCustomizable]',\n})\nexport class SelectContextContainerCustomizableDirective extends BbTemplate<\n  SelectContextContainerComponent,\n  SelectContextContainerCustomizableContext\n> {}\n\n@Directive({\n  selector: '[bbSelectContextContainerLoadingCustomizable]',\n})\nexport class SelectContextContainerLoadingCustomizableDirective extends BbTemplate<\n  SelectContextContainerComponent,\n  undefined\n> {}\n\n@Directive({\n  selector: '[bbSelectContextContainerSavingCustomizable]',\n})\nexport class SelectContextContainerSavingCustomizableDirective extends BbTemplate<\n  SelectContextContainerComponent,\n  undefined\n> {}\n","<ng-container\n  bbSelectContextContainerCustomizable\n  [bbHostRef]=\"hostRef\"\n  [bbTemplateContext]=\"{\n    serviceAgreements: serviceAgreements | async,\n    loading: loading | async,\n    error: error | async,\n    params: params | async,\n    widgetProperties: widgetProperties | async,\n    currentContext: currentContext | async,\n    saving: saving | async\n  }\">\n</ng-container>\n\n<ng-template\n  bbSelectContextContainerCustomizable\n  let-hostRef\n  let-serviceAgreements=\"context.serviceAgreements\"\n  let-loading=\"context.loading\"\n  let-error=\"context.error\"\n  let-params=\"context.params\"\n  let-widgetProperties=\"context.widgetProperties\"\n  let-currentContext=\"context.currentContext\"\n  let-saving=\"context.saving\">\n  <div class=\"bb-select-context\">\n    <ng-container *ngIf=\"serviceAgreements; else loadingTemplate\">\n      <ng-container *ngIf=\"!saving; else savingTemplate\">\n        <div class=\"bb-select-context__container\" [ngClass]=\"{ 'card card-body': hostRef.hasContainer }\">\n          <bb-header-ui\n            class=\"bb-block bb-block--md\"\n            headingType=\"h2\"\n            heading=\"Select context\"\n            data-role=\"select-context-header\"\n            i18n-heading=\"Select context|Select context label@@select-context.label.selectContext\"></bb-header-ui>\n\n          <bb-alert-ui\n            *ngIf=\"hostRef.savingError\"\n            title=\"Unknown error\"\n            i18n-title=\"Unknown Error|Unknown Error Label@@select-context.label.error.unknown\"\n            message=\"Try to make action again or contact your system administrator.\"\n            i18n-message=\"Try again|Try again error message@@select-context.label.error.tryAgain\"></bb-alert-ui>\n\n          <ng-container *ngIf=\"hostRef.searchValue || serviceAgreements.totalCount > widgetProperties.showSearchAfter\">\n            <bb-search-box-ui\n              class=\"bb-block bb-block--lg\"\n              searchLabel=\"Search button\"\n              i18n-searchLabel=\"Search button|Search button@@select-context.label.searchLabel\"\n              [showClear]=\"true\"\n              [showSearch]=\"true\"\n              placeholder=\"Search\"\n              i18n-placeholder=\"Search|Search placeholder@@select-context.label.search\"\n              aria-label=\"Search service agreements\"\n              i18n-aria-label=\"Search service agreements|Search service agreements@@select-context.aria-label.search\"\n              data-role=\"Search\"\n              (submit)=\"hostRef.search($event)\"\n              (clear)=\"hostRef.search('')\"></bb-search-box-ui>\n          </ng-container>\n\n          <ng-container *ngIf=\"!error; else errorTemplate\">\n            <ng-container *ngIf=\"!(loading && params.from === 0); else loadingIndicatorTemplate\">\n              <ng-container *ngIf=\"serviceAgreements.items.length > 0; else emptyTemplate\">\n                <bb-infinite-scroll-ui\n                  class=\"bb-infinite-scroll\"\n                  [offset]=\"5\"\n                  [disableScrollEnd]=\"loading || serviceAgreements.items.length === serviceAgreements.totalCount\"\n                  (scrollEnd)=\"loadMore()\">\n                  <bb-service-agreement-list\n                    [serviceAgreements]=\"serviceAgreements.items\"\n                    [loading]=\"loading\"\n                    [currentContext]=\"currentContext\"\n                    [searchValue]=\"hostRef.searchValue\"\n                    [totalCount]=\"serviceAgreements.totalCount\"\n                    [from]=\"params.from\"\n                    (loadMore)=\"hostRef.loadMore()\"\n                    (select)=\"hostRef.select($event)\"></bb-service-agreement-list>\n                </bb-infinite-scroll-ui>\n              </ng-container>\n            </ng-container>\n          </ng-container>\n\n          <ng-container *ngIf=\"widgetProperties.backOutput\">\n            <div class=\"bb-block bb-block--lg\"></div>\n            <div class=\"d-block\">\n              <div class=\"bb-button-bar bb-button-bar--reverse\">\n                <button\n                  bbButton\n                  (click)=\"hostRef.goBack()\"\n                  color=\"secondary\"\n                  class=\"bb-button-bar__button\"\n                  data-role=\"select-context-back-button\">\n                  <span i18n=\"Back button|Button to navigate back@@select-context.label.backButton\"> Back </span>\n                </button>\n              </div>\n            </div>\n          </ng-container>\n        </div>\n      </ng-container>\n    </ng-container>\n  </div>\n\n  <ng-template #loadingTemplate>\n    <ng-container bbSelectContextContainerLoadingCustomizable [bbHostRef]=\"hostRef\"></ng-container>\n    <ng-template bbSelectContextContainerLoadingCustomizable let-hostRef>\n      <div class=\"bb-select-context__container\" [ngClass]=\"{ 'card card-body': hostRef.hasContainer }\">\n        <ng-template [ngTemplateOutlet]=\"loadingIndicatorTemplate\"></ng-template>\n      </div>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #loadingIndicatorTemplate>\n    <div class=\"bb-state-container bb-select-context__state\">\n      <bb-loading-indicator-ui></bb-loading-indicator-ui>\n    </div>\n  </ng-template>\n\n  <ng-template #savingTemplate>\n    <ng-container bbSelectContextContainerSavingCustomizable [bbHostRef]=\"hostRef\"></ng-container>\n    <ng-template bbSelectContextContainerSavingCustomizable let-hostRef>\n      <div class=\"bb-select-context__container\" [ngClass]=\"{ 'card card-body': hostRef.hasContainer }\">\n        <div class=\"bb-state-container bb-select-context__state\">\n          <bb-loading-indicator-ui\n            text=\"Processing the request...\"\n            i18n-text=\"\n              Processing the request|Text to show while saving the selected context@@select-context.label.processing\"></bb-loading-indicator-ui>\n        </div>\n      </div>\n    </ng-template>\n  </ng-template>\n\n  <ng-template #errorTemplate>\n    <div class=\"bb-state-container bb-select-context__state\">\n      <bb-select-context-error [errorKind]=\"error?.kind\"></bb-select-context-error>\n    </div>\n  </ng-template>\n\n  <ng-template #emptyTemplate>\n    <div class=\"bb-state-container bb-select-context__state\">\n      <bb-empty-state-ui\n        *ngIf=\"hostRef.searchValue\"\n        title=\"No Results Found\"\n        i18n-title=\"\n          Search empty state title|Empty state label when there is no search results@@select-context.search.empty.title\"\n        subtitle=\"We can’t find what you’re looking for. Please try a different criteria.\"\n        i18n-subtitle=\"\n          Search empty state subtitle|Empty state subtitle when there is no search\n          results@@select-context.search.empty.subtitle\"\n        iconModifier=\"search\"\n        iconColor=\"muted\"\n        iconSize=\"xxl\"></bb-empty-state-ui>\n\n      <bb-empty-state-ui\n        *ngIf=\"!hostRef.searchValue\"\n        title=\"Permissions required.\"\n        i18n-title=\"\n          Permissions required|Empty state label when user has no permissions@@select-context.permissions.empty.title\"\n        subtitle=\"Please contact the administrator to activate your account.\"\n        i18n-subtitle=\"\n          Permissions required subtilte|Empty state subtitle when user has no\n          permissions@@select-context.permissions.empty.subtitle\"\n        iconModifier=\"lock\"\n        iconColor=\"muted\"\n        iconSize=\"xxl\"></bb-empty-state-ui>\n    </div>\n  </ng-template>\n</ng-template>\n"]}