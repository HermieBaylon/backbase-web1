{"version":3,"file":"hard-token.component.js","sourceRoot":"","sources":["../../../../../../../libs/identity-auth/transaction-signing/ui/hard-token/hard-token.component.ts","../../../../../../../libs/identity-auth/transaction-signing/ui/hard-token/hard-token.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';\nimport { AbstractControl, FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { ChallengeError, ChallengeHardTokenData, HardTokenResponse } from '../../util';\n\n@Component({\n  selector: 'bb-transaction-signing-hard-token',\n  templateUrl: 'hard-token.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TransactionSigningHardTokenComponent {\n  @Output() cancel = new EventEmitter<void>();\n  @Output() submitResponse = new EventEmitter<HardTokenResponse>();\n  @Output() acceptError = new EventEmitter<Error>();\n\n  @Input()\n  set data(value: ChallengeHardTokenData) {\n    this.challengeData = value;\n    this.displayAlert = false;\n    this.displayErrors = false;\n  }\n\n  get data() {\n    if (!this.challengeData) {\n      throw new Error('No challenge data set');\n    }\n    return this.challengeData;\n  }\n\n  @Input()\n  set error(value: ChallengeError | undefined) {\n    this.displayAlert = false;\n    this.displayErrors = false;\n    if (value && this.isRecognizedError(value)) {\n      this.displayAlert = true;\n    } else {\n      this.errorValue = value;\n    }\n  }\n\n  get error() {\n    return this.errorValue;\n  }\n\n  private readonly invalidRequestError = 'invalid_request';\n  private displayErrors = false;\n  readonly form: FormGroup = this.formBuilder.group({\n    otp: ['', [Validators.required, Validators.pattern(/^\\d{6}$/)]],\n  });\n  errorValue: ChallengeError | undefined;\n  challengeData: ChallengeHardTokenData | undefined;\n  displayAlert = false;\n\n  constructor(private readonly formBuilder: FormBuilder) {}\n\n  onSubmit() {\n    this.displayErrors = true;\n    if (this.form.valid) {\n      this.submitResponse.emit({\n        ...this.form.value,\n        code: this.data.data.code,\n      } as HardTokenResponse);\n    }\n  }\n\n  onCancel() {\n    this.cancel.emit();\n  }\n\n  onErrorClose(error: Error) {\n    this.acceptError.emit(error);\n  }\n\n  hasError(control: AbstractControl) {\n    return this.displayErrors && control.errors && (control.errors.required || control.errors.pattern);\n  }\n\n  private isRecognizedError(error: ChallengeError) {\n    return error.errorCode === this.invalidRequestError && error.errorDescription === this.invalidRequestError;\n  }\n}\n","<bb-transaction-signing-error\n  *ngIf=\"errorValue; else displayForm\"\n  [error]=\"errorValue\"\n  (closeModal)=\"onErrorClose($event)\"\n>\n</bb-transaction-signing-error>\n\n<ng-template #displayForm>\n  <bb-alert-ui\n    *ngIf=\"displayAlert\"\n    data-role=\"ts-hard-token-no-value-alert\"\n    i18n-title=\"No value alert title for hard token signing@@bb-hard-token-signing.alert.no-value.title\"\n    title=\"No value entered\"\n  >\n    <span i18n=\"No value alert message for hard token signing@@bb-hard-token-signing.alert.no-value.message\">\n      Please enter the value displayed on your {{ data.data.vendorDetails.model }} device.\n    </span>\n  </bb-alert-ui>\n  <bb-alert-ui\n    *ngIf=\"data.remainingAuthenticationAttempts !== undefined\"\n    data-role=\"ts-hard-token-remaining-alert\"\n    i18n-title=\"Remaining attempts alert title for hard token signing@@bb-hard-token-signing.alert.remaining.title\"\n    title=\"Authorization failed\"\n  >\n    <span i18n=\"Remaining attempts alert message for hard token signing@@bb-hard-token-signing.alert.remaining.message\">\n      The number you entered was incorrect. <br />\n      You have {{ data.remainingAuthenticationAttempts }} other {data.remainingAuthenticationAttempts, plural, =1\n      {attempt} other {attempts}} remaining.\n    </span>\n  </bb-alert-ui>\n  <div class=\"bb-block bb-block--md\" i18n=\"Instruction for hard token signing@@bb-hard-token-signing.instruction\">\n    Using your {{ data.data.vendorDetails.model }} device, follow these steps\n  </div>\n\n  <form [formGroup]=\"form\" (submit)=\"onSubmit()\" class=\"bb-block bb-block--md\">\n    <ol data-role=\"hard-token-txn-widget__form\" class=\"bb-ordered-list bb-block bb-block--md\">\n      <li data-role=\"hard-token-txn-widget__form-sign\" class=\"bb-block bb-block--sm\">\n        <span i18n=\"Step 1 for hard token signing@@bb-hard-token-signing.steps.1\">\n          Press '<strong>sign</strong>' on your device\n        </span>\n      </li>\n      <li data-role=\"hard-token-txn-widget__form-enter-pin\" class=\"bb-block bb-block--sm\">\n        <span i18n=\"Step 2 for hard token signing@@bb-hard-token-signing.steps.2\">\n          Enter your pin in to your device\n        </span>\n      </li>\n      <li data-role=\"hard-token-txn-widget__form-reference-number\" class=\"bb-block bb-block--sm\">\n        <span i18n=\"Step 3 for hard token signing@@bb-hard-token-signing.steps.3\"> Enter the `reference number` </span>\n        <br />\n        <span class=\"bb-hero\">\n          {{ data.data.code }}\n        </span>\n      </li>\n      <li\n        data-role=\"hard-token-txn-widget__form-transaction-amount\"\n        *ngIf=\"data.data.txnData.paymentAmount !== undefined\"\n        class=\"bb-block bb-block--sm\"\n      >\n        <span i18n=\"Step 4 (when amount present) for hard token signing@@bb-hard-token-signing.steps.4\">\n          Enter the transaction amount\n        </span>\n        <br />\n        <span class=\"bb-hero\">\n          {{ data | transactionAmount }}\n        </span>\n      </li>\n      <li data-role=\"hard-token-txn-widget__form-insert-number\" class=\"bb-block bb-block--sm\">\n        <span\n          data-role=\"hard-token-txn-widget__form-insert-number__financial\"\n          i18n=\"Step 5 (when amount present), or step 4 for hard token signing@@bb-hard-token-signing.steps.5\"\n        >\n          Insert the number produced on your {{ data.data.vendorDetails.model }} device\n        </span>\n        <br />\n        <div class=\"form-group\">\n          <bb-input-text-ui\n            data-role=\"ts-hard-token-otp\"\n            class=\"bb-form-field bb-form-field--xs\"\n            formControlName=\"otp\"\n            i18n-attr.aria-label=\"Aria label for otp field input@@bb-hard-token-signing.otp.aria-label\"\n            attr.aria-label=\"Insert the number produced on your {{ data.data.vendorDetails.model }} device\"\n            [maxLength]=\"6\"\n            [minLength]=\"6\"\n          >\n          </bb-input-text-ui>\n          <bb-input-validation-message-ui [showErrors]=\"hasError(form.controls.otp)\">\n            <span\n              data-role=\"ts-hard-token-otp-error\"\n              i18n=\"Otp input length error message@@bb-hard-token-signing.otp.errors.length\"\n            >\n              The value must be exactly 6 numbers.\n            </span>\n          </bb-input-validation-message-ui>\n        </div>\n      </li>\n    </ol>\n\n    <div class=\"bb-button-bar\">\n      <button\n        bbButton\n        data-role=\"ts-hard-token-complete\"\n        class=\"bb-button-bar__button\"\n        color=\"primary\"\n        type=\"submit\"\n        i18n=\"Complete button@@bb-hard-token-signing.complete\"\n      >\n        Complete\n      </button>\n      <button\n        bbButton\n        data-role=\"ts-hard-token-cancel\"\n        class=\"bb-button-bar__button\"\n        color=\"secondary\"\n        (click)=\"onCancel()\"\n        i18n=\"Cancel button@@bb-hard-token-signing.cancel\"\n      >\n        Cancel\n      </button>\n    </div>\n  </form>\n</ng-template>\n"]}