import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, HostListener, ViewContainerRef, ViewChild, } from '@angular/core';
import { DocumentViewerType, DOCUMENT_LOAD_DELAY_MS, } from '../../../model/UI/document-viewer-commons';
import { ReplaySubject, combineLatest, timer, BehaviorSubject, Subject } from 'rxjs';
import { catchError, distinctUntilChanged, finalize, map, share, switchMap, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../document-viewer-header/document-viewer-header.component";
import * as i2 from "../image-viewer/image-viewer.component";
import * as i3 from "@backbase/ui-ang/loading-indicator";
import * as i4 from "@backbase/ui-ang/empty-state";
import * as i5 from "@angular/cdk/a11y";
import * as i6 from "@angular/common";
export class DocumentViewerContainerComponent {
    constructor(elemRef) {
        this.elemRef = elemRef;
        this.documentRefSrcs = [];
        this.close = new EventEmitter();
        this.isLoading$ = new BehaviorSubject(false);
        this.isHttpError$ = new BehaviorSubject(false);
        this.documentType = DocumentViewerType;
        /**
         * Internal
         */
        this.activeDocumentRefIdx$ = new ReplaySubject(1);
        this.destroy$ = new Subject();
    }
    set activeDocumentRefIdx(idx) {
        this.activeDocumentRefIdx$.next(idx);
    }
    get containerStyles() {
        var _a, _b;
        return (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.container) === null || _b === void 0 ? void 0 : _b.styles;
    }
    get viewerScale() {
        var _a;
        return (_a = this.options) === null || _a === void 0 ? void 0 : _a.scale;
    }
    ngOnInit() {
        this.setDocumentRefChangeSources();
        this.setFocus();
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    onEscape() {
        this.close.emit();
    }
    closeDialog() {
        this.close.emit();
    }
    onNavigate(idx) {
        this.activeDocumentRefIdx$.next(idx);
    }
    setDocumentRefChangeSources() {
        this.documentSrc$ = this.activeDocumentRefIdx$.pipe(distinctUntilChanged(), tap(() => {
            this.isLoading$.next(true);
            this.isHttpError$.next(false);
        }), switchMap((idx) => combineLatest([this.documentRefSrcs[idx].src, timer(DOCUMENT_LOAD_DELAY_MS)]).pipe(map(([src]) => src), finalize(() => {
            this.isLoading$.next(false);
        }))), catchError((error) => {
            this.isHttpError$.next(true);
            throw error;
        }), share());
        this.documentFilename$ = this.activeDocumentRefIdx$.pipe(map((idx) => this.documentRefSrcs[idx].filename));
        this.documentFiletype$ = this.activeDocumentRefIdx$.pipe(map((idx) => this.documentRefSrcs[idx].filetype));
        this.navigationState$ = this.activeDocumentRefIdx$.pipe(map((idx) => ({ currIdx: idx, total: this.documentRefSrcs.length })));
    }
    setFocus() {
        this.elemRef.nativeElement.focus();
    }
}
DocumentViewerContainerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DocumentViewerContainerComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
DocumentViewerContainerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: DocumentViewerContainerComponent, selector: "bb-document-viewer-container", inputs: { documentRefSrcs: "documentRefSrcs", activeDocumentRefIdx: "activeDocumentRefIdx", options: "options" }, outputs: { close: "close" }, host: { listeners: { "document:keydown.escape": "onEscape()" } }, viewQueries: [{ propertyName: "viewContainer", first: true, predicate: ["viewerContainer"], descendants: true, read: ViewContainerRef, static: true }], ngImport: i0, template: "<div \n  class=\"bb-document-viewer-container show\" \n  role=\"dialog\" \n  aria-modal=\"true\" \n  tabindex=\"-1\" \n  [ngStyle]=\"containerStyles\" \n  cdkTrapFocus\n  cdkTrapFocusAutoCapture=\"true\"\n  >\n  <div class=\"bb-document-viewer-container__wrapper\">\n    <bb-document-viewer-header \n      data-role=\"document-viewer-header\"\n      [filename]=\"documentFilename$ | async\" \n      [source]=\"documentSrc$ | async\"\n      [filetype]=\"documentFiletype$ | async\" \n      [isLoading]=\"isLoading$ | async\" \n      (close)=\"close.emit()\"\n    ></bb-document-viewer-header>\n\n    <ng-container *ngIf=\"documentSrc$ | async as source\">\n      <ng-container *ngIf=\"!(isLoading$ | async) && !(isHttpError$ | async)\">\n        <div \n          class=\"bb-document-viewer-container-image\" \n          *ngIf=\"documentFiletype$ | async as documentFiletype\"\n          (click)=\"closeDialog()\"\n        >\n          <bb-image-viewer \n            data-role=\"document-viewer-image\"\n            [source]=\"source\" \n            [navigationState]=\"navigationState$ | async\"\n            (navigate)=\"onNavigate($event)\"\n          ></bb-image-viewer>\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <bb-loading-indicator-ui \n      *ngIf=\"isLoading$ | async\"\n      class=\"bb-document-viewer-container__state\" \n      data-role=\"document-viewer-loading-state\"\n      loaderSize=\"lg\">\n    </bb-loading-indicator-ui>\n\n    <bb-empty-state-ui \n      *ngIf=\"!(isLoading$ | async) && (isHttpError$ | async)\" \n      data-role=\"document-viewer-error-state\"\n      class=\"bb-document-viewer-container__state\" \n      iconColor=\"white\"\n      iconModifier=\"error-outline\"\n      iconSize=\"xxl\"\n      title=\"Unknown Error\" \n      i18n-title=\"Unknown http error title@@document-viewer-component.uknown-error-title\"\n      subtitle=\"Try to reload the page or contact the system administrator\" \n      i18n-subtitle=\"Try to reload the page or contact the system administrator@@document-viewer-component.uknown-error-subtitle\" \n    ></bb-empty-state-ui>\n  </div>\n</div>\n", components: [{ type: i1.DocumentViewerHeaderComponent, selector: "bb-document-viewer-header", inputs: ["filename", "filetype", "source", "isLoading"], outputs: ["close"] }, { type: i2.ImageViewerComponent, selector: "bb-image-viewer", inputs: ["source", "navigationState"], outputs: ["navigate"] }, { type: i3.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i4.EmptyStateComponent, selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }], directives: [{ type: i5.CdkTrapFocus, selector: "[cdkTrapFocus]", inputs: ["cdkTrapFocus", "cdkTrapFocusAutoCapture"], exportAs: ["cdkTrapFocus"] }, { type: i6.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i6.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DocumentViewerContainerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-document-viewer-container',
                    templateUrl: './document-viewer-container.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { documentRefSrcs: [{
                type: Input
            }], activeDocumentRefIdx: [{
                type: Input
            }], options: [{
                type: Input
            }], close: [{
                type: Output
            }], viewContainer: [{
                type: ViewChild,
                args: ['viewerContainer', { static: true, read: ViewContainerRef }]
            }], onEscape: [{
                type: HostListener,
                args: ['document:keydown.escape']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQtdmlld2VyLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3RyYW5zYWN0aW9ucy1jb21tb24tYW5nL3NyYy9jb21wb25lbnRzL2RvY3VtZW50LXZpZXdlci11aS9kb2N1bWVudC12aWV3ZXItY29udGFpbmVyL2RvY3VtZW50LXZpZXdlci1jb250YWluZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy90cmFuc2FjdGlvbnMtY29tbW9uLWFuZy9zcmMvY29tcG9uZW50cy9kb2N1bWVudC12aWV3ZXItdWkvZG9jdW1lbnQtdmlld2VyLWNvbnRhaW5lci9kb2N1bWVudC12aWV3ZXItY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUVOLFlBQVksRUFDWixnQkFBZ0IsRUFDaEIsU0FBUyxHQUVWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFHTCxrQkFBa0IsRUFDbEIsc0JBQXNCLEdBR3ZCLE1BQU0sMkNBQTJDLENBQUM7QUFDbkQsT0FBTyxFQUFjLGFBQWEsRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakcsT0FBTyxFQUFFLFVBQVUsRUFBRSxvQkFBb0IsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7O0FBT3hHLE1BQU0sT0FBTyxnQ0FBZ0M7SUFzQjNDLFlBQTZCLE9BQW1CO1FBQW5CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFyQnZDLG9CQUFlLEdBQXFCLEVBQUUsQ0FBQztRQUt0QyxVQUFLLEdB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QUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzNHLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUNyRCxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FDckUsQ0FBQztJQUNKLENBQUM7SUFFTyxRQUFRO1FBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDckMsQ0FBQzs7OEhBckZVLGdDQUFnQztrSEFBaEMsZ0NBQWdDLGtYQVFTLGdCQUFnQiwyQ0NyQ3RFLHlsRUF5REE7NEZENUJhLGdDQUFnQztrQkFMNUMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsOEJBQThCO29CQUN4QyxXQUFXLEVBQUUsNENBQTRDO29CQUN6RCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtpQkFDaEQ7aUdBRVUsZUFBZTtzQkFBdkIsS0FBSztnQkFDTyxvQkFBb0I7c0JBQWhDLEtBQUs7Z0JBR0csT0FBTztzQkFBZixLQUFLO2dCQUNJLEtBQUs7c0JBQWQsTUFBTTtnQkFFMEUsYUFBYTtzQkFBN0YsU0FBUzt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2dCQWtDN0IsUUFBUTtzQkFBaEQsWUFBWTt1QkFBQyx5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgRWxlbWVudFJlZixcbiAgSG9zdExpc3RlbmVyLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3Q2hpbGQsXG4gIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBEb2N1bWVudFJlZlNyYyxcbiAgRG9jdW1lbnRWaWV3ZXJPcHRpb25zLFxuICBEb2N1bWVudFZpZXdlclR5cGUsXG4gIERPQ1VNRU5UX0xPQURfREVMQVlfTVMsXG4gIE5hdmlnYXRpb25TdGF0ZSxcbiAgU3R5bGVzLFxufSBmcm9tICcuLi8uLi8uLi9tb2RlbC9VSS9kb2N1bWVudC12aWV3ZXItY29tbW9ucyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCB0aW1lciwgQmVoYXZpb3JTdWJqZWN0LCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmluYWxpemUsIG1hcCwgc2hhcmUsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1kb2N1bWVudC12aWV3ZXItY29udGFpbmVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RvY3VtZW50LXZpZXdlci1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRWaWV3ZXJDb250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpIGRvY3VtZW50UmVmU3JjczogRG9jdW1lbnRSZWZTcmNbXSA9IFtdO1xuICBASW5wdXQoKSBzZXQgYWN0aXZlRG9jdW1lbnRSZWZJZHgoaWR4OiBudW1iZXIpIHtcbiAgICB0aGlzLmFjdGl2ZURvY3VtZW50UmVmSWR4JC5uZXh0KGlkeCk7XG4gIH1cbiAgQElucHV0KCkgb3B0aW9ucz86IERvY3VtZW50Vmlld2VyT3B0aW9ucztcbiAgQE91dHB1dCgpIGNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQFZpZXdDaGlsZCgndmlld2VyQ29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUsIHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSkgcmVhZG9ubHkgdmlld0NvbnRhaW5lciE6IFZpZXdDb250YWluZXJSZWY7XG4gIGRvY3VtZW50U3JjJCE6IE9ic2VydmFibGU8c3RyaW5nPjtcbiAgZG9jdW1lbnRGaWxlbmFtZSQhOiBPYnNlcnZhYmxlPHN0cmluZz47XG4gIGRvY3VtZW50RmlsZXR5cGUkITogT2JzZXJ2YWJsZTxEb2N1bWVudFZpZXdlclR5cGU+O1xuICBuYXZpZ2F0aW9uU3RhdGUkITogT2JzZXJ2YWJsZTxOYXZpZ2F0aW9uU3RhdGU+O1xuICByZWFkb25seSBpc0xvYWRpbmckID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSk7XG4gIHJlYWRvbmx5IGlzSHR0cEVycm9yJCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xuICByZWFkb25seSBkb2N1bWVudFR5cGUgPSBEb2N1bWVudFZpZXdlclR5cGU7XG4gIC8qKlxuICAgKiBJbnRlcm5hbFxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBhY3RpdmVEb2N1bWVudFJlZklkeCQgPSBuZXcgUmVwbGF5U3ViamVjdDxudW1iZXI+KDEpO1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGVsZW1SZWY6IEVsZW1lbnRSZWYpIHt9XG5cbiAgZ2V0IGNvbnRhaW5lclN0eWxlcygpOiBTdHlsZXMgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnM/LmNvbnRhaW5lcj8uc3R5bGVzO1xuICB9XG5cbiAgZ2V0IHZpZXdlclNjYWxlKCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucz8uc2NhbGU7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnNldERvY3VtZW50UmVmQ2hhbmdlU291cmNlcygpO1xuICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmtleWRvd24uZXNjYXBlJykgb25Fc2NhcGUoKSB7XG4gICAgdGhpcy5jbG9zZS5lbWl0KCk7XG4gIH1cblxuICBjbG9zZURpYWxvZygpIHtcbiAgICB0aGlzLmNsb3NlLmVtaXQoKTtcbiAgfVxuXG4gIG9uTmF2aWdhdGUoaWR4OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmFjdGl2ZURvY3VtZW50UmVmSWR4JC5uZXh0KGlkeCk7XG4gIH1cblxuICBwcml2YXRlIHNldERvY3VtZW50UmVmQ2hhbmdlU291cmNlcygpOiB2b2lkIHtcbiAgICB0aGlzLmRvY3VtZW50U3JjJCA9IHRoaXMuYWN0aXZlRG9jdW1lbnRSZWZJZHgkLnBpcGUoXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmckLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMuaXNIdHRwRXJyb3IkLm5leHQoZmFsc2UpO1xuICAgICAgfSksXG4gICAgICBzd2l0Y2hNYXAoKGlkeCkgPT5cbiAgICAgICAgY29tYmluZUxhdGVzdChbdGhpcy5kb2N1bWVudFJlZlNyY3NbaWR4XS5zcmMsIHRpbWVyKERPQ1VNRU5UX0xPQURfREVMQVlfTVMpXSkucGlwZShcbiAgICAgICAgICBtYXAoKFtzcmNdKSA9PiBzcmMpLFxuICAgICAgICAgIGZpbmFsaXplKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nJC5uZXh0KGZhbHNlKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgKSxcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcikgPT4ge1xuICAgICAgICB0aGlzLmlzSHR0cEVycm9yJC5uZXh0KHRydWUpO1xuXG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSksXG4gICAgICBzaGFyZSgpLFxuICAgICk7XG4gICAgdGhpcy5kb2N1bWVudEZpbGVuYW1lJCA9IHRoaXMuYWN0aXZlRG9jdW1lbnRSZWZJZHgkLnBpcGUobWFwKChpZHgpID0+IHRoaXMuZG9jdW1lbnRSZWZTcmNzW2lkeF0uZmlsZW5hbWUpKTtcbiAgICB0aGlzLmRvY3VtZW50RmlsZXR5cGUkID0gdGhpcy5hY3RpdmVEb2N1bWVudFJlZklkeCQucGlwZShtYXAoKGlkeCkgPT4gdGhpcy5kb2N1bWVudFJlZlNyY3NbaWR4XS5maWxldHlwZSkpO1xuICAgIHRoaXMubmF2aWdhdGlvblN0YXRlJCA9IHRoaXMuYWN0aXZlRG9jdW1lbnRSZWZJZHgkLnBpcGUoXG4gICAgICBtYXAoKGlkeCkgPT4gKHsgY3VycklkeDogaWR4LCB0b3RhbDogdGhpcy5kb2N1bWVudFJlZlNyY3MubGVuZ3RoIH0pKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRGb2N1cygpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1SZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG59XG4iLCI8ZGl2IFxuICBjbGFzcz1cImJiLWRvY3VtZW50LXZpZXdlci1jb250YWluZXIgc2hvd1wiIFxuICByb2xlPVwiZGlhbG9nXCIgXG4gIGFyaWEtbW9kYWw9XCJ0cnVlXCIgXG4gIHRhYmluZGV4PVwiLTFcIiBcbiAgW25nU3R5bGVdPVwiY29udGFpbmVyU3R5bGVzXCIgXG4gIGNka1RyYXBGb2N1c1xuICBjZGtUcmFwRm9jdXNBdXRvQ2FwdHVyZT1cInRydWVcIlxuICA+XG4gIDxkaXYgY2xhc3M9XCJiYi1kb2N1bWVudC12aWV3ZXItY29udGFpbmVyX193cmFwcGVyXCI+XG4gICAgPGJiLWRvY3VtZW50LXZpZXdlci1oZWFkZXIgXG4gICAgICBkYXRhLXJvbGU9XCJkb2N1bWVudC12aWV3ZXItaGVhZGVyXCJcbiAgICAgIFtmaWxlbmFtZV09XCJkb2N1bWVudEZpbGVuYW1lJCB8IGFzeW5jXCIgXG4gICAgICBbc291cmNlXT1cImRvY3VtZW50U3JjJCB8IGFzeW5jXCJcbiAgICAgIFtmaWxldHlwZV09XCJkb2N1bWVudEZpbGV0eXBlJCB8IGFzeW5jXCIgXG4gICAgICBbaXNMb2FkaW5nXT1cImlzTG9hZGluZyQgfCBhc3luY1wiIFxuICAgICAgKGNsb3NlKT1cImNsb3NlLmVtaXQoKVwiXG4gICAgPjwvYmItZG9jdW1lbnQtdmlld2VyLWhlYWRlcj5cblxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJkb2N1bWVudFNyYyQgfCBhc3luYyBhcyBzb3VyY2VcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhKGlzTG9hZGluZyQgfCBhc3luYykgJiYgIShpc0h0dHBFcnJvciQgfCBhc3luYylcIj5cbiAgICAgICAgPGRpdiBcbiAgICAgICAgICBjbGFzcz1cImJiLWRvY3VtZW50LXZpZXdlci1jb250YWluZXItaW1hZ2VcIiBcbiAgICAgICAgICAqbmdJZj1cImRvY3VtZW50RmlsZXR5cGUkIHwgYXN5bmMgYXMgZG9jdW1lbnRGaWxldHlwZVwiXG4gICAgICAgICAgKGNsaWNrKT1cImNsb3NlRGlhbG9nKClcIlxuICAgICAgICA+XG4gICAgICAgICAgPGJiLWltYWdlLXZpZXdlciBcbiAgICAgICAgICAgIGRhdGEtcm9sZT1cImRvY3VtZW50LXZpZXdlci1pbWFnZVwiXG4gICAgICAgICAgICBbc291cmNlXT1cInNvdXJjZVwiIFxuICAgICAgICAgICAgW25hdmlnYXRpb25TdGF0ZV09XCJuYXZpZ2F0aW9uU3RhdGUkIHwgYXN5bmNcIlxuICAgICAgICAgICAgKG5hdmlnYXRlKT1cIm9uTmF2aWdhdGUoJGV2ZW50KVwiXG4gICAgICAgICAgPjwvYmItaW1hZ2Utdmlld2VyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPGJiLWxvYWRpbmctaW5kaWNhdG9yLXVpIFxuICAgICAgKm5nSWY9XCJpc0xvYWRpbmckIHwgYXN5bmNcIlxuICAgICAgY2xhc3M9XCJiYi1kb2N1bWVudC12aWV3ZXItY29udGFpbmVyX19zdGF0ZVwiIFxuICAgICAgZGF0YS1yb2xlPVwiZG9jdW1lbnQtdmlld2VyLWxvYWRpbmctc3RhdGVcIlxuICAgICAgbG9hZGVyU2l6ZT1cImxnXCI+XG4gICAgPC9iYi1sb2FkaW5nLWluZGljYXRvci11aT5cblxuICAgIDxiYi1lbXB0eS1zdGF0ZS11aSBcbiAgICAgICpuZ0lmPVwiIShpc0xvYWRpbmckIHwgYXN5bmMpICYmIChpc0h0dHBFcnJvciQgfCBhc3luYylcIiBcbiAgICAgIGRhdGEtcm9sZT1cImRvY3VtZW50LXZpZXdlci1lcnJvci1zdGF0ZVwiXG4gICAgICBjbGFzcz1cImJiLWRvY3VtZW50LXZpZXdlci1jb250YWluZXJfX3N0YXRlXCIgXG4gICAgICBpY29uQ29sb3I9XCJ3aGl0ZVwiXG4gICAgICBpY29uTW9kaWZpZXI9XCJlcnJvci1vdXRsaW5lXCJcbiAgICAgIGljb25TaXplPVwieHhsXCJcbiAgICAgIHRpdGxlPVwiVW5rbm93biBFcnJvclwiIFxuICAgICAgaTE4bi10aXRsZT1cIlVua25vd24gaHR0cCBlcnJvciB0aXRsZUBAZG9jdW1lbnQtdmlld2VyLWNvbXBvbmVudC51a25vd24tZXJyb3ItdGl0bGVcIlxuICAgICAgc3VidGl0bGU9XCJUcnkgdG8gcmVsb2FkIHRoZSBwYWdlIG9yIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbmlzdHJhdG9yXCIgXG4gICAgICBpMThuLXN1YnRpdGxlPVwiVHJ5IHRvIHJlbG9hZCB0aGUgcGFnZSBvciBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvckBAZG9jdW1lbnQtdmlld2VyLWNvbXBvbmVudC51a25vd24tZXJyb3Itc3VidGl0bGVcIiBcbiAgICA+PC9iYi1lbXB0eS1zdGF0ZS11aT5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==