import { Injectable, Optional } from '@angular/core';
import { defer, of } from 'rxjs';
import { catchError, map, publishReplay, refCount } from 'rxjs/operators';
import { deserialize, parseSortOptions } from '../constants';
import { TransactionsFilterOptions } from '../model/transactions-filter-options.model';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/foundation-ang/core";
const WidgetProperties = {
    pageSize: 'bb.transaction.pageSize',
    maxNavPages: 'bb.transaction.maxNavPages',
    paginationType: 'bb.transaction.paginationType',
    initialFilterOptions: 'bb.transaction.initialFilterOptions',
    initialSortOptions: 'bb.transaction.initialSortOptions',
    showControls: 'bb.transaction.showControls',
    showChangeCategory: 'bb.transaction.showChangeCategory',
    refreshTransactionsListEvents: 'event.refreshTransactionsList',
    showPendingTransactionsOnTop: 'bb.transaction.showPendingTransactionsOnTop',
    showCheckImage: 'bb.transaction.showCheckImage',
    gmapsAPIKey: 'bb.transaction.gmapsAPIKey',
    showManageNotes: 'bb.transaction.showManageNotes',
    getOrPostEndpoints: 'bb.transaction.getOrPostEndpoints',
    disputeByBillingStatus: 'disputeByBillingStatus',
    disputeEligibilityDays: 'disputeEligibilityDays',
    disputeTransactionTypes: 'disputeTransactionTypes',
    enableDisputeAndInquiry: 'enableDisputeAndInquiry',
    inquireTopicId: 'inquireTopicId',
    disputeTopicId: 'disputeTopicId',
};
export const defaultPageSize = 10;
export const defaultMaxNavPage = 3;
export const defaultInitialFilterOptions = '';
export const defaultInitialSortOptions = '';
export var PaginationType;
(function (PaginationType) {
    PaginationType["LOAD_MORE"] = "load-more";
    PaginationType["PAGINATION"] = "pagination";
    PaginationType["INFINITE_SCROLL"] = "infinite-scroll";
})(PaginationType || (PaginationType = {}));
export var EndpointType;
(function (EndpointType) {
    EndpointType["GET_REQUEST"] = "get-request";
    EndpointType["POST_REQUEST"] = "post-request";
})(EndpointType || (EndpointType = {}));
const defaultModelObservable = (value) => defer(() => of(value)).pipe(publishReplay(1), refCount());
export class WidgetPropertiesService {
    constructor(itemModel) {
        this.itemModel = itemModel;
    }
    get pageSize() {
        if (!this.itemModel) {
            return defaultModelObservable(defaultPageSize);
        }
        return this.itemModel.property(WidgetProperties.pageSize).pipe(map((propertyValue) => parseInt(propertyValue, 10)), map((pageSize) => (pageSize > 0 ? pageSize : defaultPageSize)));
    }
    get maxNavPages() {
        if (!this.itemModel) {
            return defaultModelObservable(defaultMaxNavPage);
        }
        return this.itemModel
            .property(WidgetProperties.maxNavPages)
            .pipe(map((propertyValue) => parseInt(propertyValue, 10)));
    }
    get paginationType() {
        if (!this.itemModel) {
            return defaultModelObservable(PaginationType.LOAD_MORE);
        }
        return this.itemModel
            .property(WidgetProperties.paginationType)
            .pipe(map((propertyValue) => propertyValue));
    }
    get initialFilterOptions() {
        if (!this.itemModel) {
            return defaultModelObservable({});
        }
        return this.itemModel.property(WidgetProperties.initialFilterOptions, defaultInitialFilterOptions).pipe(map(deserialize), map((params) => TransactionsFilterOptions.fromHttpGetParams(params)));
    }
    get initialSortOptions() {
        if (!this.itemModel) {
            return defaultModelObservable(parseSortOptions(defaultInitialSortOptions));
        }
        return this.itemModel.property(WidgetProperties.initialSortOptions, defaultInitialSortOptions).pipe(map(parseSortOptions), catchError((err) => {
            console.warn(`initialSortOptions property ignored: ${err}`);
            return of(undefined);
        }));
    }
    get showControls() {
        if (!this.itemModel) {
            return defaultModelObservable(true);
        }
        return this.itemModel
            .property(WidgetProperties.showControls)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get showChangeCategory() {
        if (!this.itemModel) {
            return defaultModelObservable(true);
        }
        return this.itemModel
            .property(WidgetProperties.showChangeCategory)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get refreshTransactionsListEvents() {
        if (!this.itemModel) {
            return defaultModelObservable('');
        }
        return this.itemModel
            .property(WidgetProperties.refreshTransactionsListEvents)
            .pipe(map((propertyValue) => propertyValue));
    }
    get showPendingTransactionsOnTop() {
        if (!this.itemModel) {
            return defaultModelObservable(false);
        }
        return this.itemModel
            .property(WidgetProperties.showPendingTransactionsOnTop)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get showCheckImage() {
        if (!this.itemModel) {
            return defaultModelObservable(true);
        }
        return this.itemModel
            .property(WidgetProperties.showCheckImage)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get showManageNotes() {
        if (!this.itemModel) {
            return defaultModelObservable(true);
        }
        return this.itemModel
            .property(WidgetProperties.showManageNotes)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get getOrPostEndpoints() {
        if (!this.itemModel) {
            return defaultModelObservable(EndpointType.POST_REQUEST);
        }
        return this.itemModel
            .property(WidgetProperties.getOrPostEndpoints)
            .pipe(map((propertyValue) => propertyValue));
    }
    get gmapsAPIKey() {
        if (!this.itemModel) {
            return defaultModelObservable('');
        }
        return this.itemModel.property(WidgetProperties.gmapsAPIKey).pipe(map((propertyValue) => propertyValue));
    }
    get disputeByBillingStatus() {
        if (!this.itemModel) {
            return defaultModelObservable(true);
        }
        return this.itemModel
            .property(WidgetProperties.disputeByBillingStatus)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get disputeEligibilityDays() {
        if (!this.itemModel) {
            return defaultModelObservable(120);
        }
        return this.itemModel
            .property(WidgetProperties.disputeEligibilityDays, '120')
            .pipe(map((propertyValue) => parseInt(propertyValue, 10)));
    }
    get disputeTransactionTypes() {
        if (!this.itemModel) {
            return defaultModelObservable(['Credit/Debit Card']);
        }
        return this.itemModel
            .property(WidgetProperties.disputeTransactionTypes, 'Credit/Debit Card')
            .pipe(map((propertyValue) => propertyValue.split(',')));
    }
    get enableDisputeAndInquiry() {
        if (!this.itemModel) {
            return defaultModelObservable(false);
        }
        return this.itemModel
            .property(WidgetProperties.enableDisputeAndInquiry)
            .pipe(map((propertyValue) => (typeof propertyValue === 'boolean' ? propertyValue : propertyValue === 'true')));
    }
    get inquireTopicId() {
        if (!this.itemModel) {
            return defaultModelObservable('');
        }
        return this.itemModel
            .property(WidgetProperties.inquireTopicId)
            .pipe(map((propertyValue) => propertyValue));
    }
    get disputeTopicId() {
        if (!this.itemModel) {
            return defaultModelObservable('');
        }
        return this.itemModel
            .property(WidgetProperties.disputeTopicId)
            .pipe(map((propertyValue) => propertyValue));
    }
}
WidgetPropertiesService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: WidgetPropertiesService, deps: [{ token: i1.ItemModel, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
WidgetPropertiesService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: WidgetPropertiesService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: WidgetPropertiesService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.ItemModel, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0LXByb3BlcnRpZXMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvdHJhbnNhY3Rpb25zLWNvbW1vbi1hbmcvc3JjL3NlcnZpY2VzL3dpZGdldC1wcm9wZXJ0aWVzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckQsT0FBTyxFQUFFLEtBQUssRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFN0QsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNENBQTRDLENBQUM7OztBQUd2RixNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLFFBQVEsRUFBRSx5QkFBeUI7SUFDbkMsV0FBVyxFQUFFLDRCQUE0QjtJQUN6QyxjQUFjLEVBQUUsK0JBQStCO0lBQy9DLG9CQUFvQixFQUFFLHFDQUFxQztJQUMzRCxrQkFBa0IsRUFBRSxtQ0FBbUM7SUFDdkQsWUFBWSxFQUFFLDZCQUE2QjtJQUMzQyxrQkFBa0IsRUFBRSxtQ0FBbUM7SUFDdkQsNkJBQTZCLEVBQUUsK0JBQStCO0lBQzlELDRCQUE0QixFQUFFLDZDQUE2QztJQUMzRSxjQUFjLEVBQUUsK0JBQStCO0lBQy9DLFdBQVcsRUFBRSw0QkFBNEI7SUFDekMsZUFBZSxFQUFFLGdDQUFnQztJQUNqRCxrQkFBa0IsRUFBRSxtQ0FBbUM7SUFDdkQsc0JBQXNCLEVBQUUsd0JBQXdCO0lBQ2hELHNCQUFzQixFQUFFLHdCQUF3QjtJQUNoRCx1QkFBdUIsRUFBRSx5QkFBeUI7SUFDbEQsdUJBQXVCLEVBQUUseUJBQXlC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QUMsQ0FBQztJQUMzRCxDQUFDOztxSEFsTVUsdUJBQXVCO3lIQUF2Qix1QkFBdUI7NEZBQXZCLHVCQUF1QjtrQkFEbkMsVUFBVTs7MEJBcU1JLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSXRlbU1vZGVsIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgZGVmZXIsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIHB1Ymxpc2hSZXBsYXksIHJlZkNvdW50IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZGVzZXJpYWxpemUsIHBhcnNlU29ydE9wdGlvbnMgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuXG5pbXBvcnQgeyBUcmFuc2FjdGlvbnNGaWx0ZXJPcHRpb25zIH0gZnJvbSAnLi4vbW9kZWwvdHJhbnNhY3Rpb25zLWZpbHRlci1vcHRpb25zLm1vZGVsJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uc1NvcnRPcHRpb25zIH0gZnJvbSAnLi4vbW9kZWwvdHJhbnNhY3Rpb25zLXNvcnQtb3B0aW9ucy5tb2RlbCc7XG5cbmNvbnN0IFdpZGdldFByb3BlcnRpZXMgPSB7XG4gIHBhZ2VTaXplOiAnYmIudHJhbnNhY3Rpb24ucGFnZVNpemUnLFxuICBtYXhOYXZQYWdlczogJ2JiLnRyYW5zYWN0aW9uLm1heE5hdlBhZ2VzJyxcbiAgcGFnaW5hdGlvblR5cGU6ICdiYi50cmFuc2FjdGlvbi5wYWdpbmF0aW9uVHlwZScsXG4gIGluaXRpYWxGaWx0ZXJPcHRpb25zOiAnYmIudHJhbnNhY3Rpb24uaW5pdGlhbEZpbHRlck9wdGlvbnMnLFxuICBpbml0aWFsU29ydE9wdGlvbnM6ICdiYi50cmFuc2FjdGlvbi5pbml0aWFsU29ydE9wdGlvbnMnLFxuICBzaG93Q29udHJvbHM6ICdiYi50cmFuc2FjdGlvbi5zaG93Q29udHJvbHMnLFxuICBzaG93Q2hhbmdlQ2F0ZWdvcnk6ICdiYi50cmFuc2FjdGlvbi5zaG93Q2hhbmdlQ2F0ZWdvcnknLFxuICByZWZyZXNoVHJhbnNhY3Rpb25zTGlzdEV2ZW50czogJ2V2ZW50LnJlZnJlc2hUcmFuc2FjdGlvbnNMaXN0JyxcbiAgc2hvd1BlbmRpbmdUcmFuc2FjdGlvbnNPblRvcDogJ2JiLnRyYW5zYWN0aW9uLnNob3dQZW5kaW5nVHJhbnNhY3Rpb25zT25Ub3AnLFxuICBzaG93Q2hlY2tJbWFnZTogJ2JiLnRyYW5zYWN0aW9uLnNob3dDaGVja0ltYWdlJyxcbiAgZ21hcHNBUElLZXk6ICdiYi50cmFuc2FjdGlvbi5nbWFwc0FQSUtleScsXG4gIHNob3dNYW5hZ2VOb3RlczogJ2JiLnRyYW5zYWN0aW9uLnNob3dNYW5hZ2VOb3RlcycsXG4gIGdldE9yUG9zdEVuZHBvaW50czogJ2JiLnRyYW5zYWN0aW9uLmdldE9yUG9zdEVuZHBvaW50cycsXG4gIGRpc3B1dGVCeUJpbGxpbmdTdGF0dXM6ICdkaXNwdXRlQnlCaWxsaW5nU3RhdHVzJyxcbiAgZGlzcHV0ZUVsaWdpYmlsaXR5RGF5czogJ2Rpc3B1dGVFbGlnaWJpbGl0eURheXMnLFxuICBkaXNwdXRlVHJhbnNhY3Rpb25UeXBlczogJ2Rpc3B1dGVUcmFuc2FjdGlvblR5cGVzJyxcbiAgZW5hYmxlRGlzcHV0ZUFuZElucXVpcnk6ICdlbmFibGVEaXNwdXRlQW5kSW5xdWlyeScsXG4gIGlucXVpcmVUb3BpY0lkOiAnaW5xdWlyZVRvcGljSWQnLFxuICBkaXNwdXRlVG9waWNJZDogJ2Rpc3B1dGVUb3BpY0lkJyxcbn07XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0UGFnZVNpemUgPSAxMDtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRNYXhOYXZQYWdlID0gMztcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRJbml0aWFsRmlsdGVyT3B0aW9ucyA9ICcnO1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdEluaXRpYWxTb3J0T3B0aW9ucyA9ICcnO1xuXG5leHBvcnQgZW51bSBQYWdpbmF0aW9uVHlwZSB7XG4gIExPQURfTU9SRSA9ICdsb2FkLW1vcmUnLFxuICBQQUdJTkFUSU9OID0gJ3BhZ2luYXRpb24nLFxuICBJTkZJTklURV9TQ1JPTEwgPSAnaW5maW5pdGUtc2Nyb2xsJyxcbn1cblxuZXhwb3J0IGVudW0gRW5kcG9pbnRUeXBlIHtcbiAgR0VUX1JFUVVFU1QgPSAnZ2V0LXJlcXVlc3QnLFxuICBQT1NUX1JFUVVFU1QgPSAncG9zdC1yZXF1ZXN0Jyxcbn1cblxuY29uc3QgZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSA9IDxUPih2YWx1ZTogVCk6IE9ic2VydmFibGU8VD4gPT5cbiAgZGVmZXIoKCkgPT4gb2YodmFsdWUpKS5waXBlKHB1Ymxpc2hSZXBsYXkoMSksIHJlZkNvdW50KCkpO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgV2lkZ2V0UHJvcGVydGllc1NlcnZpY2Uge1xuICBnZXQgcGFnZVNpemUoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZShkZWZhdWx0UGFnZVNpemUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLnBhZ2VTaXplKS5waXBlKFxuICAgICAgbWFwKChwcm9wZXJ0eVZhbHVlKSA9PiBwYXJzZUludChwcm9wZXJ0eVZhbHVlIGFzIHN0cmluZywgMTApKSxcbiAgICAgIG1hcCgocGFnZVNpemUpID0+IChwYWdlU2l6ZSA+IDAgPyBwYWdlU2l6ZSA6IGRlZmF1bHRQYWdlU2l6ZSkpLFxuICAgICk7XG4gIH1cblxuICBnZXQgbWF4TmF2UGFnZXMoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZShkZWZhdWx0TWF4TmF2UGFnZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsXG4gICAgICAucHJvcGVydHkoV2lkZ2V0UHJvcGVydGllcy5tYXhOYXZQYWdlcylcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gcGFyc2VJbnQocHJvcGVydHlWYWx1ZSBhcyBzdHJpbmcsIDEwKSkpO1xuICB9XG5cbiAgZ2V0IHBhZ2luYXRpb25UeXBlKCk6IE9ic2VydmFibGU8UGFnaW5hdGlvblR5cGU+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZShQYWdpbmF0aW9uVHlwZS5MT0FEX01PUkUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMucGFnaW5hdGlvblR5cGUpXG4gICAgICAucGlwZShtYXAoKHByb3BlcnR5VmFsdWUpID0+IHByb3BlcnR5VmFsdWUgYXMgUGFnaW5hdGlvblR5cGUpKTtcbiAgfVxuXG4gIGdldCBpbml0aWFsRmlsdGVyT3B0aW9ucygpOiBPYnNlcnZhYmxlPFRyYW5zYWN0aW9uc0ZpbHRlck9wdGlvbnM+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSh7fSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuaW5pdGlhbEZpbHRlck9wdGlvbnMsIGRlZmF1bHRJbml0aWFsRmlsdGVyT3B0aW9ucykucGlwZShcbiAgICAgIG1hcChkZXNlcmlhbGl6ZSksXG4gICAgICBtYXAoKHBhcmFtcykgPT4gVHJhbnNhY3Rpb25zRmlsdGVyT3B0aW9ucy5mcm9tSHR0cEdldFBhcmFtcyhwYXJhbXMpKSxcbiAgICApO1xuICB9XG5cbiAgZ2V0IGluaXRpYWxTb3J0T3B0aW9ucygpOiBPYnNlcnZhYmxlPFRyYW5zYWN0aW9uc1NvcnRPcHRpb25zIHwgdW5kZWZpbmVkPiB7XG4gICAgaWYgKCF0aGlzLml0ZW1Nb2RlbCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbE9ic2VydmFibGUocGFyc2VTb3J0T3B0aW9ucyhkZWZhdWx0SW5pdGlhbFNvcnRPcHRpb25zKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuaW5pdGlhbFNvcnRPcHRpb25zLCBkZWZhdWx0SW5pdGlhbFNvcnRPcHRpb25zKS5waXBlKFxuICAgICAgbWFwKHBhcnNlU29ydE9wdGlvbnMpLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKGBpbml0aWFsU29ydE9wdGlvbnMgcHJvcGVydHkgaWdub3JlZDogJHtlcnJ9YCk7XG5cbiAgICAgICAgcmV0dXJuIG9mKHVuZGVmaW5lZCk7XG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgZ2V0IHNob3dDb250cm9scygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSh0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWxcbiAgICAgIC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLnNob3dDb250cm9scylcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gKHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBwcm9wZXJ0eVZhbHVlIDogcHJvcGVydHlWYWx1ZSA9PT0gJ3RydWUnKSkpO1xuICB9XG5cbiAgZ2V0IHNob3dDaGFuZ2VDYXRlZ29yeSgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSh0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWxcbiAgICAgIC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLnNob3dDaGFuZ2VDYXRlZ29yeSlcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gKHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBwcm9wZXJ0eVZhbHVlIDogcHJvcGVydHlWYWx1ZSA9PT0gJ3RydWUnKSkpO1xuICB9XG5cbiAgZ2V0IHJlZnJlc2hUcmFuc2FjdGlvbnNMaXN0RXZlbnRzKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLml0ZW1Nb2RlbCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbE9ic2VydmFibGUoJycpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMucmVmcmVzaFRyYW5zYWN0aW9uc0xpc3RFdmVudHMpXG4gICAgICAucGlwZShtYXAoKHByb3BlcnR5VmFsdWUpID0+IHByb3BlcnR5VmFsdWUgYXMgc3RyaW5nKSk7XG4gIH1cblxuICBnZXQgc2hvd1BlbmRpbmdUcmFuc2FjdGlvbnNPblRvcCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZShmYWxzZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsXG4gICAgICAucHJvcGVydHkoV2lkZ2V0UHJvcGVydGllcy5zaG93UGVuZGluZ1RyYW5zYWN0aW9uc09uVG9wKVxuICAgICAgLnBpcGUobWFwKChwcm9wZXJ0eVZhbHVlKSA9PiAodHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdib29sZWFuJyA/IHByb3BlcnR5VmFsdWUgOiBwcm9wZXJ0eVZhbHVlID09PSAndHJ1ZScpKSk7XG4gIH1cblxuICBnZXQgc2hvd0NoZWNrSW1hZ2UoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLml0ZW1Nb2RlbCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbE9ic2VydmFibGUodHJ1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsXG4gICAgICAucHJvcGVydHkoV2lkZ2V0UHJvcGVydGllcy5zaG93Q2hlY2tJbWFnZSlcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gKHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBwcm9wZXJ0eVZhbHVlIDogcHJvcGVydHlWYWx1ZSA9PT0gJ3RydWUnKSkpO1xuICB9XG5cbiAgZ2V0IHNob3dNYW5hZ2VOb3RlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSh0cnVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWxcbiAgICAgIC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLnNob3dNYW5hZ2VOb3RlcylcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gKHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBwcm9wZXJ0eVZhbHVlIDogcHJvcGVydHlWYWx1ZSA9PT0gJ3RydWUnKSkpO1xuICB9XG5cbiAgZ2V0IGdldE9yUG9zdEVuZHBvaW50cygpOiBPYnNlcnZhYmxlPEVuZHBvaW50VHlwZT4ge1xuICAgIGlmICghdGhpcy5pdGVtTW9kZWwpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWxPYnNlcnZhYmxlKEVuZHBvaW50VHlwZS5QT1NUX1JFUVVFU1QpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuZ2V0T3JQb3N0RW5kcG9pbnRzKVxuICAgICAgLnBpcGUobWFwKChwcm9wZXJ0eVZhbHVlKSA9PiBwcm9wZXJ0eVZhbHVlIGFzIEVuZHBvaW50VHlwZSkpO1xuICB9XG5cbiAgZ2V0IGdtYXBzQVBJS2V5KCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLml0ZW1Nb2RlbCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRNb2RlbE9ic2VydmFibGUoJycpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLmdtYXBzQVBJS2V5KS5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gcHJvcGVydHlWYWx1ZSBhcyBzdHJpbmcpKTtcbiAgfVxuXG4gIGdldCBkaXNwdXRlQnlCaWxsaW5nU3RhdHVzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5pdGVtTW9kZWwpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWxPYnNlcnZhYmxlKHRydWUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuZGlzcHV0ZUJ5QmlsbGluZ1N0YXR1cylcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gKHR5cGVvZiBwcm9wZXJ0eVZhbHVlID09PSAnYm9vbGVhbicgPyBwcm9wZXJ0eVZhbHVlIDogcHJvcGVydHlWYWx1ZSA9PT0gJ3RydWUnKSkpO1xuICB9XG5cbiAgZ2V0IGRpc3B1dGVFbGlnaWJpbGl0eURheXMoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSgxMjApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuZGlzcHV0ZUVsaWdpYmlsaXR5RGF5cywgJzEyMCcpXG4gICAgICAucGlwZShtYXAoKHByb3BlcnR5VmFsdWUpID0+IHBhcnNlSW50KHByb3BlcnR5VmFsdWUgYXMgc3RyaW5nLCAxMCkpKTtcbiAgfVxuXG4gIGdldCBkaXNwdXRlVHJhbnNhY3Rpb25UeXBlcygpOiBPYnNlcnZhYmxlPEFycmF5PHN0cmluZz4+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZShbJ0NyZWRpdC9EZWJpdCBDYXJkJ10pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLml0ZW1Nb2RlbFxuICAgICAgLnByb3BlcnR5KFdpZGdldFByb3BlcnRpZXMuZGlzcHV0ZVRyYW5zYWN0aW9uVHlwZXMsICdDcmVkaXQvRGViaXQgQ2FyZCcpXG4gICAgICAucGlwZShtYXAoKHByb3BlcnR5VmFsdWUpID0+IChwcm9wZXJ0eVZhbHVlIGFzIHN0cmluZykuc3BsaXQoJywnKSkpO1xuICB9XG5cbiAgZ2V0IGVuYWJsZURpc3B1dGVBbmRJbnF1aXJ5KCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5pdGVtTW9kZWwpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWxPYnNlcnZhYmxlKGZhbHNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWxcbiAgICAgIC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLmVuYWJsZURpc3B1dGVBbmRJbnF1aXJ5KVxuICAgICAgLnBpcGUobWFwKChwcm9wZXJ0eVZhbHVlKSA9PiAodHlwZW9mIHByb3BlcnR5VmFsdWUgPT09ICdib29sZWFuJyA/IHByb3BlcnR5VmFsdWUgOiBwcm9wZXJ0eVZhbHVlID09PSAndHJ1ZScpKSk7XG4gIH1cblxuICBnZXQgaW5xdWlyZVRvcGljSWQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMuaXRlbU1vZGVsKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdE1vZGVsT2JzZXJ2YWJsZSgnJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsXG4gICAgICAucHJvcGVydHkoV2lkZ2V0UHJvcGVydGllcy5pbnF1aXJlVG9waWNJZClcbiAgICAgIC5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gcHJvcGVydHlWYWx1ZSBhcyBzdHJpbmcpKTtcbiAgfVxuXG4gIGdldCBkaXNwdXRlVG9waWNJZCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5pdGVtTW9kZWwpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0TW9kZWxPYnNlcnZhYmxlKCcnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWxcbiAgICAgIC5wcm9wZXJ0eShXaWRnZXRQcm9wZXJ0aWVzLmRpc3B1dGVUb3BpY0lkKVxuICAgICAgLnBpcGUobWFwKChwcm9wZXJ0eVZhbHVlKSA9PiBwcm9wZXJ0eVZhbHVlIGFzIHN0cmluZykpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSByZWFkb25seSBpdGVtTW9kZWw/OiBJdGVtTW9kZWwpIHt9XG59XG4iXX0=