import { map, pluck } from 'rxjs/operators';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { TransactionsFilterOptions } from '../model/transactions-filter-options.model';
import { Input, Directive, Output, EventEmitter } from '@angular/core';
import { defaultAvailableFiltersConfig, deserialize, filterInputParameters, parseSortOptions } from '../constants';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../services/widget-properties.service";
/* eslint-disable */
export class BaseTransactionsWidget {
    constructor(route, widgetProperties) {
        this.route = route;
        this.widgetProperties = widgetProperties;
        this.enableDisputeAndInquiry = false;
        this.availableFiltersConfig = defaultAvailableFiltersConfig;
        this.transactionSelected = new EventEmitter();
        this.transactionsLoaded = new EventEmitter();
        this.initialFilterOptionsSubject = new BehaviorSubject(undefined);
        this.initialSortOptionsSubject = new BehaviorSubject(undefined);
        this.selectedAccount = this.getRouteParam(this.route, 'selectedAccount').pipe(map((selectedAccount) => selectedAccount), map((selectedAccount) => typeof selectedAccount !== 'undefined' && selectedAccount.includes(',')
            ? selectedAccount.split(',')
            : selectedAccount));
    }
    set initialFilterOptionsValue(value) {
        const deseralizedValue = deserialize(value);
        this.initialFilterOptionsSubject.next(TransactionsFilterOptions.fromHttpGetParams(deseralizedValue));
    }
    set initialSortOptionsValue(value) {
        const options = parseSortOptions(value);
        this.initialSortOptionsSubject.next(options);
    }
    getRouteParam(route, param) {
        const paramValue = route.paramMap.pipe(pluck('params', param));
        if (!route.parent) {
            return paramValue;
        }
        // Ensure that level that has actual value keeps it from being cleared.
        return combineLatest([paramValue, this.getRouteParam(route.parent, param)]).pipe(map((params) => params[0] || params[1]));
    }
    get initialFilterOptions() {
        return filterInputParameters(this.initialFilterOptionsSubject.asObservable(), this.widgetProperties.initialFilterOptions);
    }
    get initialSortOptions() {
        return filterInputParameters(this.initialSortOptionsSubject.asObservable(), this.widgetProperties.initialSortOptions);
    }
    onDetailOpen(transaction) {
        this.transactionSelected.emit(transaction);
    }
    onTransactionsLoaded(transactionsList) {
        this.transactionsLoaded.emit(transactionsList);
    }
}
BaseTransactionsWidget.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BaseTransactionsWidget, deps: [{ token: i1.ActivatedRoute }, { token: i2.WidgetPropertiesService }], target: i0.ɵɵFactoryTarget.Directive });
BaseTransactionsWidget.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: BaseTransactionsWidget, inputs: { googleAPIKey: "googleAPIKey", initialFilterOptionsValue: ["initialFilterOptions", "initialFilterOptionsValue"], initialSortOptionsValue: ["initialSortOptions", "initialSortOptionsValue"], pageSize: "pageSize", maxNavPages: "maxNavPages", paginationType: "paginationType", showControls: "showControls", showChangeCategory: "showChangeCategory", showPendingTransactionsOnTop: "showPendingTransactionsOnTop", showCheckImage: "showCheckImage", showManageNotes: "showManageNotes", getOrPostEndpoints: "getOrPostEndpoints", enableDisputeAndInquiry: "enableDisputeAndInquiry", disputeByBillingStatus: "disputeByBillingStatus", disputeEligibilityDays: "disputeEligibilityDays", disputeTransactionTypes: "disputeTransactionTypes", inquireTopicId: "inquireTopicId", disputeTopicId: "disputeTopicId", availableFiltersConfig: "availableFiltersConfig" }, outputs: { transactionSelected: "transactionSelected", transactionsLoaded: "transactionsLoaded" }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BaseTransactionsWidget, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: i1.ActivatedRoute }, { type: i2.WidgetPropertiesService }]; }, propDecorators: { googleAPIKey: [{
                type: Input
            }], initialFilterOptionsValue: [{
                type: Input,
                args: ['initialFilterOptions']
            }], initialSortOptionsValue: [{
                type: Input,
                args: ['initialSortOptions']
            }], pageSize: [{
                type: Input
            }], maxNavPages: [{
                type: Input
            }], paginationType: [{
                type: Input
            }], showControls: [{
                type: Input
            }], showChangeCategory: [{
                type: Input
            }], showPendingTransactionsOnTop: [{
                type: Input
            }], showCheckImage: [{
                type: Input
            }], showManageNotes: [{
                type: Input
            }], getOrPostEndpoints: [{
                type: Input
            }], enableDisputeAndInquiry: [{
                type: Input
            }], disputeByBillingStatus: [{
                type: Input
            }], disputeEligibilityDays: [{
                type: Input
            }], disputeTransactionTypes: [{
                type: Input
            }], inquireTopicId: [{
                type: Input
            }], disputeTopicId: [{
                type: Input
            }], availableFiltersConfig: [{
                type: Input
            }], transactionSelected: [{
                type: Output
            }], transactionsLoaded: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS10cmFuc2FjdGlvbnMtd2lkZ2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy90cmFuc2FjdGlvbnMtY29tbW9uLWFuZy9zcmMvY29tcG9uZW50cy9iYXNlLXRyYW5zYWN0aW9ucy13aWRnZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU1QyxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNsRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUd2RixPQUFPLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxXQUFXLEVBQUUscUJBQXFCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxjQUFjLENBQUM7Ozs7QUFLbkgsb0JBQW9CO0FBRXBCLE1BQU0sT0FBTyxzQkFBc0I7SUEwRWpDLFlBQStCLEtBQXFCLEVBQXFCLGdCQUF5QztRQUFuRixVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUFxQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXlCO1FBbER6Ryw0QkFBdUIsR0FBWSxLQUFLLENBQUM7UUFNekMsMkJBQXNCLEdBQTJCLDZCQUE2QixDQUFDO1FBRTlFLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUFDdEQsdUJBQWtCLEdBQUcsSUFBSSxZQUFZLEVBQTJCLENBQUM7UUFFMUQsZ0NBQTJCLEdBQUcsSUFBSSxlQUFlLENBQXdDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BHLDhCQUF5QixHQUFHLElBQUksZUFBZSxDQUFzQyxTQUFTLENBQUMsQ0FBQztRQUV4RyxvQkFBZSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFD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QTFCLEtBQUs7Z0JBQ0csdUJBQXVCO3NCQUEvQixLQUFLO2dCQUNHLHNCQUFzQjtzQkFBOUIsS0FBSztnQkFDRyxzQkFBc0I7c0JBQTlCLEtBQUs7Z0JBQ0csdUJBQXVCO3NCQUEvQixLQUFLO2dCQUNHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFDRyxzQkFBc0I7c0JBQTlCLEtBQUs7Z0JBRUksbUJBQW1CO3NCQUE1QixNQUFNO2dCQUNHLGtCQUFrQjtzQkFBM0IsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcCwgcGx1Y2sgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUGFyYW1NYXAgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBUcmFuc2FjdGlvbnNGaWx0ZXJPcHRpb25zIH0gZnJvbSAnLi4vbW9kZWwvdHJhbnNhY3Rpb25zLWZpbHRlci1vcHRpb25zLm1vZGVsJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uc1NvcnRPcHRpb25zIH0gZnJvbSAnLi4vbW9kZWwvdHJhbnNhY3Rpb25zLXNvcnQtb3B0aW9ucy5tb2RlbCc7XG5pbXBvcnQgeyBXaWRnZXRQcm9wZXJ0aWVzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3dpZGdldC1wcm9wZXJ0aWVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgSW5wdXQsIERpcmVjdGl2ZSwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGRlZmF1bHRBdmFpbGFibGVGaWx0ZXJzQ29uZmlnLCBkZXNlcmlhbGl6ZSwgZmlsdGVySW5wdXRQYXJhbWV0ZXJzLCBwYXJzZVNvcnRPcHRpb25zIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcbmltcG9ydCB7IEF2YWlsYWJsZUZpbHRlcnNDb25maWcgfSBmcm9tICcuLi9tb2RlbC9hdmFpbGFibGUtZmlsdGVycy5tb2RlbCc7XG5pbXBvcnQgeyBUcmFuc2FjdGlvbiB9IGZyb20gJy4uL21vZGVsL3RyYW5zYWN0aW9uLm1vZGVsJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uc0xpc3QgfSBmcm9tICcuLi9tb2RlbC90cmFuc2FjdGlvbnMtbGlzdC5tb2RlbCc7XG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5ARGlyZWN0aXZlKClcbmV4cG9ydCBjbGFzcyBCYXNlVHJhbnNhY3Rpb25zV2lkZ2V0IHtcbiAgLyoqXG4gICAqIEFQSSBrZXkgbmVlZGVkIGZvciB0aGUgZ29vZ2xlIG1hcHMgdG8gd29yay5cbiAgICovXG4gIEBJbnB1dCgpIGdvb2dsZUFQSUtleTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgnaW5pdGlhbEZpbHRlck9wdGlvbnMnKSBzZXQgaW5pdGlhbEZpbHRlck9wdGlvbnNWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgY29uc3QgZGVzZXJhbGl6ZWRWYWx1ZSA9IGRlc2VyaWFsaXplKHZhbHVlKTtcbiAgICB0aGlzLmluaXRpYWxGaWx0ZXJPcHRpb25zU3ViamVjdC5uZXh0KFRyYW5zYWN0aW9uc0ZpbHRlck9wdGlvbnMuZnJvbUh0dHBHZXRQYXJhbXMoZGVzZXJhbGl6ZWRWYWx1ZSkpO1xuICB9XG4gIEBJbnB1dCgnaW5pdGlhbFNvcnRPcHRpb25zJykgc2V0IGluaXRpYWxTb3J0T3B0aW9uc1ZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBvcHRpb25zID0gcGFyc2VTb3J0T3B0aW9ucyh2YWx1ZSk7XG4gICAgdGhpcy5pbml0aWFsU29ydE9wdGlvbnNTdWJqZWN0Lm5leHQob3B0aW9ucyk7XG4gIH1cblxuICBASW5wdXQoKSBwYWdlU2l6ZTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBASW5wdXQoKSBtYXhOYXZQYWdlczogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBASW5wdXQoKSBwYWdpbmF0aW9uVHlwZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBASW5wdXQoKSBzaG93Q29udHJvbHM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIEBJbnB1dCgpIHNob3dDaGFuZ2VDYXRlZ29yeTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgc2hvd1BlbmRpbmdUcmFuc2FjdGlvbnNPblRvcDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgc2hvd0NoZWNrSW1hZ2U6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIEBJbnB1dCgpIHNob3dNYW5hZ2VOb3RlczogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgZ2V0T3JQb3N0RW5kcG9pbnRzOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIEBJbnB1dCgpIGVuYWJsZURpc3B1dGVBbmRJbnF1aXJ5OiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIGRpc3B1dGVCeUJpbGxpbmdTdGF0dXM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIEBJbnB1dCgpIGRpc3B1dGVFbGlnaWJpbGl0eURheXM6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgZGlzcHV0ZVRyYW5zYWN0aW9uVHlwZXM6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgaW5xdWlyZVRvcGljSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgZGlzcHV0ZVRvcGljSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgYXZhaWxhYmxlRmlsdGVyc0NvbmZpZzogQXZhaWxhYmxlRmlsdGVyc0NvbmZpZyA9IGRlZmF1bHRBdmFpbGFibGVGaWx0ZXJzQ29uZmlnO1xuXG4gIEBPdXRwdXQoKSB0cmFuc2FjdGlvblNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxUcmFuc2FjdGlvbj4oKTtcbiAgQE91dHB1dCgpIHRyYW5zYWN0aW9uc0xvYWRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8VHJhbnNhY3Rpb25zTGlzdCB8IG51bGw+KCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBpbml0aWFsRmlsdGVyT3B0aW9uc1N1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFRyYW5zYWN0aW9uc0ZpbHRlck9wdGlvbnMgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgaW5pdGlhbFNvcnRPcHRpb25zU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VHJhbnNhY3Rpb25zU29ydE9wdGlvbnMgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbiAgcmVhZG9ubHkgc2VsZWN0ZWRBY2NvdW50ID0gdGhpcy5nZXRSb3V0ZVBhcmFtKHRoaXMucm91dGUsICdzZWxlY3RlZEFjY291bnQnKS5waXBlKFxuICAgIG1hcCgoc2VsZWN0ZWRBY2NvdW50KSA9PiBzZWxlY3RlZEFjY291bnQgYXMgc3RyaW5nKSxcbiAgICBtYXAoKHNlbGVjdGVkQWNjb3VudCkgPT5cbiAgICAgIHR5cGVvZiBzZWxlY3RlZEFjY291bnQgIT09ICd1bmRlZmluZWQnICYmIHNlbGVjdGVkQWNjb3VudC5pbmNsdWRlcygnLCcpXG4gICAgICAgID8gc2VsZWN0ZWRBY2NvdW50LnNwbGl0KCcsJylcbiAgICAgICAgOiBzZWxlY3RlZEFjY291bnQsXG4gICAgKSxcbiAgKTtcblxuICBwcml2YXRlIGdldFJvdXRlUGFyYW0ocm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwYXJhbTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgcGFyYW1WYWx1ZSA9IHJvdXRlLnBhcmFtTWFwLnBpcGUocGx1Y2s8UGFyYW1NYXAsIHN0cmluZyB8IG51bGw+KCdwYXJhbXMnLCBwYXJhbSkpO1xuXG4gICAgaWYgKCFyb3V0ZS5wYXJlbnQpIHtcbiAgICAgIHJldHVybiBwYXJhbVZhbHVlO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSB0aGF0IGxldmVsIHRoYXQgaGFzIGFjdHVhbCB2YWx1ZSBrZWVwcyBpdCBmcm9tIGJlaW5nIGNsZWFyZWQuXG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW3BhcmFtVmFsdWUsIHRoaXMuZ2V0Um91dGVQYXJhbShyb3V0ZS5wYXJlbnQsIHBhcmFtKV0pLnBpcGUoXG4gICAgICBtYXAoKHBhcmFtcykgPT4gcGFyYW1zWzBdIHx8IHBhcmFtc1sxXSksXG4gICAgKTtcbiAgfVxuXG4gIGdldCBpbml0aWFsRmlsdGVyT3B0aW9ucygpOiBPYnNlcnZhYmxlPFRyYW5zYWN0aW9uc0ZpbHRlck9wdGlvbnM+IHtcbiAgICByZXR1cm4gZmlsdGVySW5wdXRQYXJhbWV0ZXJzKFxuICAgICAgdGhpcy5pbml0aWFsRmlsdGVyT3B0aW9uc1N1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgICB0aGlzLndpZGdldFByb3BlcnRpZXMuaW5pdGlhbEZpbHRlck9wdGlvbnMsXG4gICAgKTtcbiAgfVxuXG4gIGdldCBpbml0aWFsU29ydE9wdGlvbnMoKTogT2JzZXJ2YWJsZTxUcmFuc2FjdGlvbnNTb3J0T3B0aW9ucyB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgICB0aGlzLmluaXRpYWxTb3J0T3B0aW9uc1N1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgICB0aGlzLndpZGdldFByb3BlcnRpZXMuaW5pdGlhbFNvcnRPcHRpb25zLFxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcmVhZG9ubHkgcm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwcm90ZWN0ZWQgcmVhZG9ubHkgd2lkZ2V0UHJvcGVydGllczogV2lkZ2V0UHJvcGVydGllc1NlcnZpY2UpIHt9XG5cbiAgb25EZXRhaWxPcGVuKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbikge1xuICAgIHRoaXMudHJhbnNhY3Rpb25TZWxlY3RlZC5lbWl0KHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIG9uVHJhbnNhY3Rpb25zTG9hZGVkKHRyYW5zYWN0aW9uc0xpc3Q6IFRyYW5zYWN0aW9uc0xpc3QpIHtcbiAgICB0aGlzLnRyYW5zYWN0aW9uc0xvYWRlZC5lbWl0KHRyYW5zYWN0aW9uc0xpc3QpO1xuICB9XG59XG4vKiBlc2xpbnQtZW5hYmxlICovXG4iXX0=