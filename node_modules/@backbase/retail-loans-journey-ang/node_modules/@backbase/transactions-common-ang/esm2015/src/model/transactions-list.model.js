import { sortFieldsDirectionHeader, totalCountHeader, availableExportTypes, unvailableExportTypesReasons, BillingStatusEnum, } from '../constants';
/* eslint-disable no-redeclare*/
export var TransactionsList;
(function (TransactionsList) {
    // eslint-disable-next-line complexity
    const processTransaction = (transaction) => {
        const amountSign = transaction.creditDebitIndicator === 'DBIT' ? -1 : 1;
        const formattedTransaction = Object.assign(Object.assign(Object.assign({}, transaction), { isPending: (function isPending(data) {
                let result = false;
                if (data && data.billingStatus) {
                    const billingStatus = data.billingStatus.toUpperCase();
                    result = billingStatus === BillingStatusEnum.pending || billingStatus === BillingStatusEnum.unbilled;
                }
                return result;
            })(transaction) }), (transaction.merchant
            ? {
                merchant: Object.assign(Object.assign({ id: transaction.merchant.id, name: transaction.merchant.name }, (transaction.merchant.logo ? { logo: transaction.merchant.logo } : {})), (transaction.merchant.website ? { website: transaction.merchant.website } : {})),
            }
            : {}));
        if (transaction.transactionAmountCurrency) {
            const amountNumber = parseFloat(transaction.transactionAmountCurrency.amount);
            formattedTransaction.transactionAmountCurrency = Object.assign(Object.assign({}, transaction.transactionAmountCurrency), { unsignedAmount: amountNumber, amount: (amountSign * (amountNumber || 0)).toString() });
        }
        if (transaction.instructedAmountCurrency) {
            const amountNumber = parseFloat(transaction.instructedAmountCurrency.amount);
            formattedTransaction.instructedAmountCurrency = Object.assign(Object.assign({}, transaction.instructedAmountCurrency), { unsignedAmount: amountNumber, amount: (amountSign * (amountNumber || 0)).toString() });
        }
        formattedTransaction.currencyExchangeAvailability =
            !!transaction.instructedAmountCurrency &&
                !!transaction.transactionAmountCurrency &&
                !!transaction.currencyExchangeRate;
        return formattedTransaction;
    };
    const processTransactions = (transactionsList) => (Object.assign(Object.assign({}, transactionsList), { items: transactionsList.items.map(processTransaction) }));
    const processTotalCountHeader = (totalCount) => (totalCount ? parseInt(totalCount, 10) : 0);
    const processAvailableExportTypes = (availableExports) => availableExports || '';
    const processUnavailableExportTypesReasons = (unavilableExportTypesReasonsValue) => JSON.parse(unavilableExportTypesReasonsValue || '{}');
    const processSortFieldsDirectionHeader = (sortFieldsDirection) => {
        if (sortFieldsDirection === null || !sortFieldsDirection.length) {
            return undefined;
        }
        const sortOption = sortFieldsDirection
            .split(',')[0]
            .trim()
            .replace(/\s{2,}/g, ' ');
        const [orderBy, direction] = sortOption.split(' ');
        if (!orderBy || (direction !== 'ASC' && direction !== 'DESC')) {
            throw new Error(`Invalid value for "initialSortOptions" property.
        Please use "<orderBy> <direction>" format, e.g., "bookingDate DESC",
        or leave it empty.`);
        }
        return {
            orderBy,
            direction,
        };
    };
    function padValueWithZeros(value, size = 2) {
        return (value + '').padStart(size, '0');
    }
    function formatDate(date) {
        const safeDate = date || '';
        if (/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}/.exec(safeDate)) {
            const localDate = new Date(safeDate);
            const month = padValueWithZeros(localDate.getMonth() + 1);
            const day = padValueWithZeros(localDate.getDate());
            const year = localDate.getFullYear();
            return `${year}-${month}-${day}`;
        }
        else if (date !== undefined) {
            console.error(`invalid date provided ${date}`);
        }
        return undefined;
    }
    TransactionsList.fromHttpResponse = (response) => {
        const totalCount = processTotalCountHeader(response.headers.get(totalCountHeader));
        const sort = processSortFieldsDirectionHeader(response.headers.get(sortFieldsDirectionHeader));
        const availableExportTypesHeader = processAvailableExportTypes(response.headers.get(availableExportTypes));
        const unavailableExportTypesReasonsHeader = processUnavailableExportTypesReasons(response.headers.get(unvailableExportTypesReasons));
        return processTransactions(Object.assign(Object.assign({ items: response.body || [], totalCount }, (sort ? { sort } : {})), { availableExportTypesHeader,
            unavailableExportTypesReasonsHeader }));
    };
    TransactionsList.concat = (transactionsList1, transactionsList2) => {
        if (transactionsList2.httpResponseError) {
            return Object.assign(Object.assign({}, transactionsList1), { items: [...transactionsList1.items], httpResponseError: transactionsList2.httpResponseError });
        }
        return Object.assign(Object.assign(Object.assign(Object.assign({ items: [...transactionsList1.items, ...transactionsList2.items], totalCount: transactionsList1.totalCount }, (transactionsList2.sort ? { sort: transactionsList2.sort } : {})), (transactionsList2.availableExportTypesHeader
            ? { availableExportTypesHeader: transactionsList2.availableExportTypesHeader }
            : {})), (transactionsList2.unavailableExportTypesReasonsHeader
            ? { unavailableExportTypesReasonsHeader: transactionsList2.unavailableExportTypesReasonsHeader }
            : {})), { httpResponseError: transactionsList2.httpResponseError });
    };
    TransactionsList.hasLoadedAll = (transactionsList) => transactionsList.items.length === transactionsList.totalCount;
    TransactionsList.toHttpRequest = (listOptions) => {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2;
        const turnIntoArrayObject = (value, name, fn) => {
            if (!value) {
                return {};
            }
            return Array.isArray(value) ? { [name]: fn(value) } : { [name]: [fn(value)] };
        };
        const optionalItem = (name, value) => (value !== undefined ? { [name]: value } : {});
        const isTransactionListOption = (data) => Object.prototype.hasOwnProperty.call(data, 'pagination');
        const isTransactionExportOptions = (data) => Object.prototype.hasOwnProperty.call(data, 'exportType');
        return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, turnIntoArrayObject(listOptions.account.arrangementId, 'arrangementsIds', (value) => value)), optionalItem('query', (_a = listOptions.search) === null || _a === void 0 ? void 0 : _a.query)), optionalItem('amountGreaterThan', (_c = (_b = listOptions.filter) === null || _b === void 0 ? void 0 : _b.amount) === null || _c === void 0 ? void 0 : _c.from)), optionalItem('amountLessThan', (_e = (_d = listOptions.filter) === null || _d === void 0 ? void 0 : _d.amount) === null || _e === void 0 ? void 0 : _e.to)), optionalItem('bookingDateGreaterThan', ((_g = (_f = listOptions.filter) === null || _f === void 0 ? void 0 : _f.date) === null || _g === void 0 ? void 0 : _g.from) === '' ? undefined : formatDate((_j = (_h = listOptions.filter) === null || _h === void 0 ? void 0 : _h.date) === null || _j === void 0 ? void 0 : _j.from))), optionalItem('bookingDateLessThan', ((_l = (_k = listOptions.filter) === null || _k === void 0 ? void 0 : _k.date) === null || _l === void 0 ? void 0 : _l.to) === '' ? undefined : formatDate((_o = (_m = listOptions.filter) === null || _m === void 0 ? void 0 : _m.date) === null || _o === void 0 ? void 0 : _o.to))), optionalItem('categories', (_p = listOptions.filter) === null || _p === void 0 ? void 0 : _p.categories)), optionalItem('fromCheckSerialNumber', (_r = (_q = listOptions.filter) === null || _q === void 0 ? void 0 : _q.checkSerialNumber) === null || _r === void 0 ? void 0 : _r.from)), optionalItem('toCheckSerialNumber', (_t = (_s = listOptions.filter) === null || _s === void 0 ? void 0 : _s.checkSerialNumber) === null || _t === void 0 ? void 0 : _t.to)), optionalItem('orderBy', (_u = listOptions.sort) === null || _u === void 0 ? void 0 : _u.orderBy)), optionalItem('direction', (_v = listOptions.sort) === null || _v === void 0 ? void 0 : _v.direction)), optionalItem('state', isTransactionListOption(listOptions) ? listOptions.state : undefined)), optionalItem('from', isTransactionListOption(listOptions) ? (_w = listOptions.pagination) === null || _w === void 0 ? void 0 : _w.from : undefined)), optionalItem('size', isTransactionListOption(listOptions) ? (_x = listOptions.pagination) === null || _x === void 0 ? void 0 : _x.size : undefined)), optionalItem('billingStatus', (_z = (_y = listOptions.filter) === null || _y === void 0 ? void 0 : _y.billingStatus) === null || _z === void 0 ? void 0 : _z.value)), optionalItem('creditDebitIndicator', (_1 = (_0 = listOptions.filter) === null || _0 === void 0 ? void 0 : _0.creditDebitIndicator) === null || _1 === void 0 ? void 0 : _1.value)), optionalItem('exportType', isTransactionExportOptions(listOptions) ? listOptions.exportType : undefined)), optionalItem('locale', isTransactionExportOptions(listOptions) ? listOptions.locale : undefined)), turnIntoArrayObject((_2 = listOptions.filter) === null || _2 === void 0 ? void 0 : _2.types, 'types', (value) => value.value));
    };
})(TransactionsList || (TransactionsList = {}));
/* eslint-enable no-redeclare*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNhY3Rpb25zLWxpc3QubW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL3RyYW5zYWN0aW9ucy1jb21tb24tYW5nL3NyYy9tb2RlbC90cmFuc2FjdGlvbnMtbGlzdC5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLQSxPQUFPLEVBQ0wseUJBQXlCLEVBQ3pCLGdCQUFnQixFQUNoQixvQkFBb0IsRUFDcEIsNEJBQTRCLEVBQzVCLGlCQUFpQixHQUNsQixNQUFNLGNBQWMsQ0FBQztBQWN0QixnQ0FBZ0M7QUFDaEMsTUFBTSxLQUFXLGdCQUFnQixDQTZNaEM7QUE3TUQsV0FBaUIsZ0JBQWdCO0lBQy9CLHNDQUFzQztJQUN0QyxNQUFNLGtCQUFrQixHQUFHLENBQUMsV0FBd0IsRUFBRSxFQUFFO1FBQ3RELE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQyxvQkFBb0IsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEUsTUFBTSxvQkFBb0IsaURBQ3JCLFdBQVcsS0FDZCxTQUFTLEVBQUUsQ0FBQyxTQUFTLFNBQVMsQ0FBQyxJQUFJO2dCQUNqQyxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7Z0JBQ25CLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7b0JBQzlCLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQ3ZELE1BQU0sR0FBRyxhQUFhLEtBQUssaUJBQWlCLENBQUMsT0FBTyxJQUFJLGFBQWEsS0FBSyxpQkFBaUIsQ0FBQyxRQUFRLENBQUM7aUJBQ3RHO2dCQUVELE9BQU8sTUFBTSxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUNaLENBQUMsV0FBVyxDQUFDLFFBQVE7WUFDdEIsQ0FBQyxDQUFDO2dCQUNFLFFBQVEsZ0NBQ04sRUFB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QVcsQ0FBQyxNQUFNLDBDQUFFLG9CQUFvQiwwQ0FBRSxLQUFLLENBQUMsR0FDckYsWUFBWSxDQUFDLFlBQVksRUFBRSwwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQ3hHLFlBQVksQ0FBQyxRQUFRLEVBQUUsMEJBQTBCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUNoRyxtQkFBbUIsQ0FBQyxNQUFBLFdBQVcsQ0FBQyxNQUFNLDBDQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxLQUE0QixFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQ3pHO0lBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxFQTdNZ0IsZ0JBQWdCLEtBQWhCLGdCQUFnQixRQTZNaEM7QUFDRCwrQkFBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSwgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgR2V0VHJhbnNhY3Rpb25zUmVxdWVzdFBhcmFtcywgVHJhbnNhY3Rpb25JdGVtIH0gZnJvbSAnQGJhY2tiYXNlL2RhdGEtYW5nL3RyYW5zYWN0aW9ucyc7XG5cbmltcG9ydCB7IFRyYW5zYWN0aW9uIH0gZnJvbSAnLi90cmFuc2FjdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBUcmFuc2FjdGlvbnNTb3J0T3B0aW9ucyB9IGZyb20gJy4vdHJhbnNhY3Rpb25zLXNvcnQtb3B0aW9ucy5tb2RlbCc7XG5pbXBvcnQge1xuICBzb3J0RmllbGRzRGlyZWN0aW9uSGVhZGVyLFxuICB0b3RhbENvdW50SGVhZGVyLFxuICBhdmFpbGFibGVFeHBvcnRUeXBlcyxcbiAgdW52YWlsYWJsZUV4cG9ydFR5cGVzUmVhc29ucyxcbiAgQmlsbGluZ1N0YXR1c0VudW0sXG59IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBUcmFuc2FjdGlvbnNFeHBvcnRPcHRpb25zLCBVbmF2YWlsYWJsZUV4cG9ydFR5cGVSZWFzb25zIH0gZnJvbSAnLi90cmFuc2FjdGlvbnMtZXhwb3J0LW9wdGlvbnMubW9kZWwnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb25zTGlzdE9wdGlvbnMgfSBmcm9tICcuL3RyYW5zYWN0aW9ucy1saXN0LW9wdGlvbnMubW9kZWwnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb25zRW51bVZhbHVlIH0gZnJvbSAnLi90cmFuc2FjdGlvbnMtZW51bS12YWx1ZS5tb2RlbCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNhY3Rpb25zTGlzdCB7XG4gIGl0ZW1zOiBUcmFuc2FjdGlvbltdO1xuICB0b3RhbENvdW50OiBudW1iZXI7XG4gIHNvcnQ/OiBUcmFuc2FjdGlvbnNTb3J0T3B0aW9ucztcbiAgYXZhaWxhYmxlRXhwb3J0VHlwZXNIZWFkZXI/OiBzdHJpbmc7XG4gIGh0dHBSZXNwb25zZUVycm9yPzogSHR0cEVycm9yUmVzcG9uc2U7XG4gIHVuYXZhaWxhYmxlRXhwb3J0VHlwZXNSZWFzb25zSGVhZGVyPzogVW5hdmFpbGFibGVFeHBvcnRUeXBlUmVhc29ucztcbiAgaW5pdGlhbFJlcXVlc3Q/OiBib29sZWFuO1xufVxuLyogZXNsaW50LWRpc2FibGUgbm8tcmVkZWNsYXJlKi9cbmV4cG9ydCBuYW1lc3BhY2UgVHJhbnNhY3Rpb25zTGlzdCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5XG4gIGNvbnN0IHByb2Nlc3NUcmFuc2FjdGlvbiA9ICh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pID0+IHtcbiAgICBjb25zdCBhbW91bnRTaWduID0gdHJhbnNhY3Rpb24uY3JlZGl0RGViaXRJbmRpY2F0b3IgPT09ICdEQklUJyA/IC0xIDogMTtcbiAgICBjb25zdCBmb3JtYXR0ZWRUcmFuc2FjdGlvbjogVHJhbnNhY3Rpb24gPSB7XG4gICAgICAuLi50cmFuc2FjdGlvbixcbiAgICAgIGlzUGVuZGluZzogKGZ1bmN0aW9uIGlzUGVuZGluZyhkYXRhKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5iaWxsaW5nU3RhdHVzKSB7XG4gICAgICAgICAgY29uc3QgYmlsbGluZ1N0YXR1cyA9IGRhdGEuYmlsbGluZ1N0YXR1cy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgIHJlc3VsdCA9IGJpbGxpbmdTdGF0dXMgPT09IEJpbGxpbmdTdGF0dXNFbnVtLnBlbmRpbmcgfHwgYmlsbGluZ1N0YXR1cyA9PT0gQmlsbGluZ1N0YXR1c0VudW0udW5iaWxsZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSkodHJhbnNhY3Rpb24pLFxuICAgICAgLi4uKHRyYW5zYWN0aW9uLm1lcmNoYW50XG4gICAgICAgID8ge1xuICAgICAgICAgICAgbWVyY2hhbnQ6IHtcbiAgICAgICAgICAgICAgaWQ6IHRyYW5zYWN0aW9uLm1lcmNoYW50LmlkLFxuICAgICAgICAgICAgICBuYW1lOiB0cmFuc2FjdGlvbi5tZXJjaGFudC5uYW1lLFxuICAgICAgICAgICAgICAuLi4odHJhbnNhY3Rpb24ubWVyY2hhbnQubG9nbyA/IHsgbG9nbzogdHJhbnNhY3Rpb24ubWVyY2hhbnQubG9nbyB9IDoge30pLFxuICAgICAgICAgICAgICAuLi4odHJhbnNhY3Rpb24ubWVyY2hhbnQud2Vic2l0ZSA/IHsgd2Vic2l0ZTogdHJhbnNhY3Rpb24ubWVyY2hhbnQud2Vic2l0ZSB9IDoge30pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9XG4gICAgICAgIDoge30pLFxuICAgIH07XG5cbiAgICBpZiAodHJhbnNhY3Rpb24udHJhbnNhY3Rpb25BbW91bnRDdXJyZW5jeSkge1xuICAgICAgY29uc3QgYW1vdW50TnVtYmVyID0gcGFyc2VGbG9hdCh0cmFuc2FjdGlvbi50cmFuc2FjdGlvbkFtb3VudEN1cnJlbmN5LmFtb3VudCk7XG5cbiAgICAgIGZvcm1hdHRlZFRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uQW1vdW50Q3VycmVuY3kgPSB7XG4gICAgICAgIC4uLnRyYW5zYWN0aW9uLnRyYW5zYWN0aW9uQW1vdW50Q3VycmVuY3ksXG4gICAgICAgIHVuc2lnbmVkQW1vdW50OiBhbW91bnROdW1iZXIsXG4gICAgICAgIGFtb3VudDogKGFtb3VudFNpZ24gKiAoYW1vdW50TnVtYmVyIHx8IDApKS50b1N0cmluZygpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAodHJhbnNhY3Rpb24uaW5zdHJ1Y3RlZEFtb3VudEN1cnJlbmN5KSB7XG4gICAgICBjb25zdCBhbW91bnROdW1iZXIgPSBwYXJzZUZsb2F0KHRyYW5zYWN0aW9uLmluc3RydWN0ZWRBbW91bnRDdXJyZW5jeS5hbW91bnQpO1xuXG4gICAgICBmb3JtYXR0ZWRUcmFuc2FjdGlvbi5pbnN0cnVjdGVkQW1vdW50Q3VycmVuY3kgPSB7XG4gICAgICAgIC4uLnRyYW5zYWN0aW9uLmluc3RydWN0ZWRBbW91bnRDdXJyZW5jeSxcbiAgICAgICAgdW5zaWduZWRBbW91bnQ6IGFtb3VudE51bWJlcixcbiAgICAgICAgYW1vdW50OiAoYW1vdW50U2lnbiAqIChhbW91bnROdW1iZXIgfHwgMCkpLnRvU3RyaW5nKCksXG4gICAgICB9O1xuICAgIH1cblxuICAgIGZvcm1hdHRlZFRyYW5zYWN0aW9uLmN1cnJlbmN5RXhjaGFuZ2VBdmFpbGFiaWxpdHkgPVxuICAgICAgISF0cmFuc2FjdGlvbi5pbnN0cnVjdGVkQW1vdW50Q3VycmVuY3kgJiZcbiAgICAgICEhdHJhbnNhY3Rpb24udHJhbnNhY3Rpb25BbW91bnRDdXJyZW5jeSAmJlxuICAgICAgISF0cmFuc2FjdGlvbi5jdXJyZW5jeUV4Y2hhbmdlUmF0ZTtcblxuICAgIHJldHVybiBmb3JtYXR0ZWRUcmFuc2FjdGlvbjtcbiAgfTtcblxuICBjb25zdCBwcm9jZXNzVHJhbnNhY3Rpb25zID0gKHRyYW5zYWN0aW9uc0xpc3Q6IFRyYW5zYWN0aW9uc0xpc3QpID0+ICh7XG4gICAgLi4udHJhbnNhY3Rpb25zTGlzdCxcbiAgICBpdGVtczogdHJhbnNhY3Rpb25zTGlzdC5pdGVtcy5tYXAocHJvY2Vzc1RyYW5zYWN0aW9uKSxcbiAgfSk7XG5cbiAgY29uc3QgcHJvY2Vzc1RvdGFsQ291bnRIZWFkZXIgPSAodG90YWxDb3VudDogc3RyaW5nIHwgbnVsbCkgPT4gKHRvdGFsQ291bnQgPyBwYXJzZUludCh0b3RhbENvdW50LCAxMCkgOiAwKTtcblxuICBjb25zdCBwcm9jZXNzQXZhaWxhYmxlRXhwb3J0VHlwZXMgPSAoYXZhaWxhYmxlRXhwb3J0czogc3RyaW5nIHwgbnVsbCkgPT4gYXZhaWxhYmxlRXhwb3J0cyB8fCAnJztcblxuICBjb25zdCBwcm9jZXNzVW5hdmFpbGFibGVFeHBvcnRUeXBlc1JlYXNvbnMgPSAodW5hdmlsYWJsZUV4cG9ydFR5cGVzUmVhc29uc1ZhbHVlOiBzdHJpbmcgfCBudWxsKSA9PlxuICAgIEpTT04ucGFyc2UodW5hdmlsYWJsZUV4cG9ydFR5cGVzUmVhc29uc1ZhbHVlIHx8ICd7fScpO1xuXG4gIGNvbnN0IHByb2Nlc3NTb3J0RmllbGRzRGlyZWN0aW9uSGVhZGVyID0gKFxuICAgIHNvcnRGaWVsZHNEaXJlY3Rpb246IHN0cmluZyB8IG51bGwsXG4gICk6IFRyYW5zYWN0aW9uc1NvcnRPcHRpb25zIHwgdW5kZWZpbmVkID0+IHtcbiAgICBpZiAoc29ydEZpZWxkc0RpcmVjdGlvbiA9PT0gbnVsbCB8fCAhc29ydEZpZWxkc0RpcmVjdGlvbi5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3Qgc29ydE9wdGlvbiA9IHNvcnRGaWVsZHNEaXJlY3Rpb25cbiAgICAgIC5zcGxpdCgnLCcpWzBdXG4gICAgICAudHJpbSgpXG4gICAgICAucmVwbGFjZSgvXFxzezIsfS9nLCAnICcpO1xuXG4gICAgY29uc3QgW29yZGVyQnksIGRpcmVjdGlvbl0gPSBzb3J0T3B0aW9uLnNwbGl0KCcgJyk7XG5cbiAgICBpZiAoIW9yZGVyQnkgfHwgKGRpcmVjdGlvbiAhPT0gJ0FTQycgJiYgZGlyZWN0aW9uICE9PSAnREVTQycpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBJbnZhbGlkIHZhbHVlIGZvciBcImluaXRpYWxTb3J0T3B0aW9uc1wiIHByb3BlcnR5LlxuICAgICAgICBQbGVhc2UgdXNlIFwiPG9yZGVyQnk+IDxkaXJlY3Rpb24+XCIgZm9ybWF0LCBlLmcuLCBcImJvb2tpbmdEYXRlIERFU0NcIixcbiAgICAgICAgb3IgbGVhdmUgaXQgZW1wdHkuYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG9yZGVyQnksXG4gICAgICBkaXJlY3Rpb24sXG4gICAgfTtcbiAgfTtcblxuICBmdW5jdGlvbiBwYWRWYWx1ZVdpdGhaZXJvcyh2YWx1ZTogbnVtYmVyLCBzaXplID0gMikge1xuICAgIHJldHVybiAodmFsdWUgKyAnJykucGFkU3RhcnQoc2l6ZSwgJzAnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZTogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gICAgY29uc3Qgc2FmZURhdGUgPSBkYXRlIHx8ICcnO1xuICAgIGlmICgvXlswLTldezR9XFwtWzAtOV17Mn1cXC1bMC05XXsyfS8uZXhlYyhzYWZlRGF0ZSkpIHtcbiAgICAgIGNvbnN0IGxvY2FsRGF0ZSA9IG5ldyBEYXRlKHNhZmVEYXRlKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gcGFkVmFsdWVXaXRoWmVyb3MobG9jYWxEYXRlLmdldE1vbnRoKCkgKyAxKTtcbiAgICAgIGNvbnN0IGRheSA9IHBhZFZhbHVlV2l0aFplcm9zKGxvY2FsRGF0ZS5nZXREYXRlKCkpO1xuICAgICAgY29uc3QgeWVhciA9IGxvY2FsRGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgICByZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YDtcbiAgICB9IGVsc2UgaWYgKGRhdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY29uc29sZS5lcnJvcihgaW52YWxpZCBkYXRlIHByb3ZpZGVkICR7ZGF0ZX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZXhwb3J0IGNvbnN0IGZyb21IdHRwUmVzcG9uc2UgPSAocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxUcmFuc2FjdGlvbkl0ZW1bXT4pOiBUcmFuc2FjdGlvbnNMaXN0ID0+IHtcbiAgICBjb25zdCB0b3RhbENvdW50ID0gcHJvY2Vzc1RvdGFsQ291bnRIZWFkZXIocmVzcG9uc2UuaGVhZGVycy5nZXQodG90YWxDb3VudEhlYWRlcikpO1xuICAgIGNvbnN0IHNvcnQgPSBwcm9jZXNzU29ydEZpZWxkc0RpcmVjdGlvbkhlYWRlcihyZXNwb25zZS5oZWFkZXJzLmdldChzb3J0RmllbGRzRGlyZWN0aW9uSGVhZGVyKSk7XG4gICAgY29uc3QgYXZhaWxhYmxlRXhwb3J0VHlwZXNIZWFkZXIgPSBwcm9jZXNzQXZhaWxhYmxlRXhwb3J0VHlwZXMocmVzcG9uc2UuaGVhZGVycy5nZXQoYXZhaWxhYmxlRXhwb3J0VHlwZXMpKTtcbiAgICBjb25zdCB1bmF2YWlsYWJsZUV4cG9ydFR5cGVzUmVhc29uc0hlYWRlciA9IHByb2Nlc3NVbmF2YWlsYWJsZUV4cG9ydFR5cGVzUmVhc29ucyhcbiAgICAgIHJlc3BvbnNlLmhlYWRlcnMuZ2V0KHVudmFpbGFibGVFeHBvcnRUeXBlc1JlYXNvbnMpLFxuICAgICk7XG5cbiAgICByZXR1cm4gcHJvY2Vzc1RyYW5zYWN0aW9ucyh7XG4gICAgICBpdGVtczogKHJlc3BvbnNlLmJvZHkgYXMgVHJhbnNhY3Rpb25bXSkgfHwgW10sXG4gICAgICB0b3RhbENvdW50LFxuICAgICAgLi4uKHNvcnQgPyB7IHNvcnQgfSA6IHt9KSxcbiAgICAgIGF2YWlsYWJsZUV4cG9ydFR5cGVzSGVhZGVyLFxuICAgICAgdW5hdmFpbGFibGVFeHBvcnRUeXBlc1JlYXNvbnNIZWFkZXIsXG4gICAgfSk7XG4gIH07XG5cbiAgZXhwb3J0IGNvbnN0IGNvbmNhdCA9ICh0cmFuc2FjdGlvbnNMaXN0MTogVHJhbnNhY3Rpb25zTGlzdCwgdHJhbnNhY3Rpb25zTGlzdDI6IFRyYW5zYWN0aW9uc0xpc3QpID0+IHtcbiAgICBpZiAodHJhbnNhY3Rpb25zTGlzdDIuaHR0cFJlc3BvbnNlRXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRyYW5zYWN0aW9uc0xpc3QxLFxuICAgICAgICBpdGVtczogWy4uLnRyYW5zYWN0aW9uc0xpc3QxLml0ZW1zXSxcbiAgICAgICAgaHR0cFJlc3BvbnNlRXJyb3I6IHRyYW5zYWN0aW9uc0xpc3QyLmh0dHBSZXNwb25zZUVycm9yLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXRlbXM6IFsuLi50cmFuc2FjdGlvbnNMaXN0MS5pdGVtcywgLi4udHJhbnNhY3Rpb25zTGlzdDIuaXRlbXNdLFxuICAgICAgdG90YWxDb3VudDogdHJhbnNhY3Rpb25zTGlzdDEudG90YWxDb3VudCxcbiAgICAgIC4uLih0cmFuc2FjdGlvbnNMaXN0Mi5zb3J0ID8geyBzb3J0OiB0cmFuc2FjdGlvbnNMaXN0Mi5zb3J0IH0gOiB7fSksXG4gICAgICAuLi4odHJhbnNhY3Rpb25zTGlzdDIuYXZhaWxhYmxlRXhwb3J0VHlwZXNIZWFkZXJcbiAgICAgICAgPyB7IGF2YWlsYWJsZUV4cG9ydFR5cGVzSGVhZGVyOiB0cmFuc2FjdGlvbnNMaXN0Mi5hdmFpbGFibGVFeHBvcnRUeXBlc0hlYWRlciB9XG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKHRyYW5zYWN0aW9uc0xpc3QyLnVuYXZhaWxhYmxlRXhwb3J0VHlwZXNSZWFzb25zSGVhZGVyXG4gICAgICAgID8geyB1bmF2YWlsYWJsZUV4cG9ydFR5cGVzUmVhc29uc0hlYWRlcjogdHJhbnNhY3Rpb25zTGlzdDIudW5hdmFpbGFibGVFeHBvcnRUeXBlc1JlYXNvbnNIZWFkZXIgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIGh0dHBSZXNwb25zZUVycm9yOiB0cmFuc2FjdGlvbnNMaXN0Mi5odHRwUmVzcG9uc2VFcnJvcixcbiAgICB9O1xuICB9O1xuXG4gIGV4cG9ydCBjb25zdCBoYXNMb2FkZWRBbGwgPSAodHJhbnNhY3Rpb25zTGlzdDogVHJhbnNhY3Rpb25zTGlzdCkgPT5cbiAgICB0cmFuc2FjdGlvbnNMaXN0Lml0ZW1zLmxlbmd0aCA9PT0gdHJhbnNhY3Rpb25zTGlzdC50b3RhbENvdW50O1xuXG4gIGV4cG9ydCBjb25zdCB0b0h0dHBSZXF1ZXN0ID0gKFxuICAgIGxpc3RPcHRpb25zOiBUcmFuc2FjdGlvbnNMaXN0T3B0aW9ucyB8IFRyYW5zYWN0aW9uc0V4cG9ydE9wdGlvbnMsXG4gICk6IEdldFRyYW5zYWN0aW9uc1JlcXVlc3RQYXJhbXMgPT4ge1xuICAgIGNvbnN0IHR1cm5JbnRvQXJyYXlPYmplY3QgPSAodmFsdWU6IGFueSwgbmFtZTogYW55LCBmbjogKHBhcmFtOiBhbnkpID0+IGFueSkgPT4ge1xuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHsgW25hbWVdOiBmbih2YWx1ZSkgfSA6IHsgW25hbWVdOiBbZm4odmFsdWUpXSB9O1xuICAgIH07XG5cbiAgICBjb25zdCBvcHRpb25hbEl0ZW0gPSA8VD4obmFtZTogc3RyaW5nLCB2YWx1ZTogVCkgPT4gKHZhbHVlICE9PSB1bmRlZmluZWQgPyB7IFtuYW1lXTogdmFsdWUgfSA6IHt9KTtcblxuICAgIGNvbnN0IGlzVHJhbnNhY3Rpb25MaXN0T3B0aW9uID0gKGRhdGE6IGFueSk6IGRhdGEgaXMgVHJhbnNhY3Rpb25zTGlzdE9wdGlvbnMgPT5cbiAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCAncGFnaW5hdGlvbicpO1xuXG4gICAgY29uc3QgaXNUcmFuc2FjdGlvbkV4cG9ydE9wdGlvbnMgPSAoZGF0YTogYW55KTogZGF0YSBpcyBUcmFuc2FjdGlvbnNFeHBvcnRPcHRpb25zID0+XG4gICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwgJ2V4cG9ydFR5cGUnKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi50dXJuSW50b0FycmF5T2JqZWN0KGxpc3RPcHRpb25zLmFjY291bnQuYXJyYW5nZW1lbnRJZCwgJ2FycmFuZ2VtZW50c0lkcycsICh2YWx1ZSkgPT4gdmFsdWUpLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdxdWVyeScsIGxpc3RPcHRpb25zLnNlYXJjaD8ucXVlcnkpLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdhbW91bnRHcmVhdGVyVGhhbicsIGxpc3RPcHRpb25zLmZpbHRlcj8uYW1vdW50Py5mcm9tKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgnYW1vdW50TGVzc1RoYW4nLCBsaXN0T3B0aW9ucy5maWx0ZXI/LmFtb3VudD8udG8pLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKFxuICAgICAgICAnYm9va2luZ0RhdGVHcmVhdGVyVGhhbicsXG4gICAgICAgIGxpc3RPcHRpb25zLmZpbHRlcj8uZGF0ZT8uZnJvbSA9PT0gJycgPyB1bmRlZmluZWQgOiBmb3JtYXREYXRlKGxpc3RPcHRpb25zLmZpbHRlcj8uZGF0ZT8uZnJvbSksXG4gICAgICApLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKFxuICAgICAgICAnYm9va2luZ0RhdGVMZXNzVGhhbicsXG4gICAgICAgIGxpc3RPcHRpb25zLmZpbHRlcj8uZGF0ZT8udG8gPT09ICcnID8gdW5kZWZpbmVkIDogZm9ybWF0RGF0ZShsaXN0T3B0aW9ucy5maWx0ZXI/LmRhdGU/LnRvKSxcbiAgICAgICksXG4gICAgICAuLi5vcHRpb25hbEl0ZW0oJ2NhdGVnb3JpZXMnLCBsaXN0T3B0aW9ucy5maWx0ZXI/LmNhdGVnb3JpZXMpLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdmcm9tQ2hlY2tTZXJpYWxOdW1iZXInLCBsaXN0T3B0aW9ucy5maWx0ZXI/LmNoZWNrU2VyaWFsTnVtYmVyPy5mcm9tKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgndG9DaGVja1NlcmlhbE51bWJlcicsIGxpc3RPcHRpb25zLmZpbHRlcj8uY2hlY2tTZXJpYWxOdW1iZXI/LnRvKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgnb3JkZXJCeScsIGxpc3RPcHRpb25zLnNvcnQ/Lm9yZGVyQnkpLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdkaXJlY3Rpb24nLCBsaXN0T3B0aW9ucy5zb3J0Py5kaXJlY3Rpb24pLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdzdGF0ZScsIGlzVHJhbnNhY3Rpb25MaXN0T3B0aW9uKGxpc3RPcHRpb25zKSA/IGxpc3RPcHRpb25zLnN0YXRlIDogdW5kZWZpbmVkKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgnZnJvbScsIGlzVHJhbnNhY3Rpb25MaXN0T3B0aW9uKGxpc3RPcHRpb25zKSA/IGxpc3RPcHRpb25zLnBhZ2luYXRpb24/LmZyb20gOiB1bmRlZmluZWQpLFxuICAgICAgLi4ub3B0aW9uYWxJdGVtKCdzaXplJywgaXNUcmFuc2FjdGlvbkxpc3RPcHRpb24obGlzdE9wdGlvbnMpID8gbGlzdE9wdGlvbnMucGFnaW5hdGlvbj8uc2l6ZSA6IHVuZGVmaW5lZCksXG4gICAgICAuLi5vcHRpb25hbEl0ZW0oJ2JpbGxpbmdTdGF0dXMnLCBsaXN0T3B0aW9ucy5maWx0ZXI/LmJpbGxpbmdTdGF0dXM/LnZhbHVlKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgnY3JlZGl0RGViaXRJbmRpY2F0b3InLCBsaXN0T3B0aW9ucy5maWx0ZXI/LmNyZWRpdERlYml0SW5kaWNhdG9yPy52YWx1ZSksXG4gICAgICAuLi5vcHRpb25hbEl0ZW0oJ2V4cG9ydFR5cGUnLCBpc1RyYW5zYWN0aW9uRXhwb3J0T3B0aW9ucyhsaXN0T3B0aW9ucykgPyBsaXN0T3B0aW9ucy5leHBvcnRUeXBlIDogdW5kZWZpbmVkKSxcbiAgICAgIC4uLm9wdGlvbmFsSXRlbSgnbG9jYWxlJywgaXNUcmFuc2FjdGlvbkV4cG9ydE9wdGlvbnMobGlzdE9wdGlvbnMpID8gbGlzdE9wdGlvbnMubG9jYWxlIDogdW5kZWZpbmVkKSxcbiAgICAgIC4uLnR1cm5JbnRvQXJyYXlPYmplY3QobGlzdE9wdGlvbnMuZmlsdGVyPy50eXBlcywgJ3R5cGVzJywgKHZhbHVlOiBUcmFuc2FjdGlvbnNFbnVtVmFsdWUpID0+IHZhbHVlLnZhbHVlKSxcbiAgICB9O1xuICB9O1xufVxuLyogZXNsaW50LWVuYWJsZSBuby1yZWRlY2xhcmUqL1xuIl19