import { publishReplay, refCount, switchMap } from 'rxjs/operators';
import { combineLatest } from 'rxjs';
import { map, pluck } from 'rxjs/operators';
import { CardProductKindName, DefaultProductKindNameList } from '../model/constants';
export const toKebabCase = (accountType = '') => accountType ? accountType.trim().toLowerCase().split(' ').join('-') : '';
export const isCardNumber = (account) => Boolean(account.productKindName && CardProductKindName.includes(account.productKindName.toLowerCase()));
export const modelItemToBoolean = (value) => {
    if (typeof value === 'boolean') {
        return value;
    }
    return value === 'true';
};
export const isFavorite = (account) => {
    const accountPreferencesFavoriteValue = account.userPreferences && account.userPreferences.favorite;
    const accountFavoriteValue = 'favorite' in account ? account.favorite : undefined;
    return accountPreferencesFavoriteValue !== null && accountPreferencesFavoriteValue !== void 0 ? accountPreferencesFavoriteValue : accountFavoriteValue;
};
export const isProductVisible = (product) => {
    if (product.userPreferences && product.userPreferences.visible !== undefined) {
        return product.userPreferences.visible;
    }
    else if (product.visible !== undefined) {
        return product.visible;
    }
    return true;
};
export const isFunction = (param) => typeof param === 'function';
export const findBy = (collection, key, value) => collection.find(item => item && item[key] === value);
export const findByName = (collection, name) => findBy(collection, 'name', name);
export const getAccountAlias = (account) => {
    if (account.userPreferences) {
        return account.userPreferences.alias ? account.userPreferences.alias : account.bankAlias || account.name;
    }
    else {
        return account.bankAlias || account.name || ''; // todo: replace with `??` typesScript is upgraded to 3.7.0
    }
};
export const getProductKindIconName = (productKindName) => {
    let iconName = toKebabCase(productKindName);
    const isDefaultProductKindName = Object.values(DefaultProductKindNameList).some(name => iconName === name);
    if (!isDefaultProductKindName) {
        iconName = 'account';
    }
    return `${iconName}s`;
};
/**
 * Gets a valid product number type for a given product
 *
 * @param product
 *
 * for CreditCard/DebitCard:
 * - returns `number` if exists
 * - else `IBAN` if exists
 * - otherwise `BBAN`
 * for other products:
 * - returns `IBAN` if exists
 * - else `BBAN` if exists
 * - otherwise `number`
 */
export const getProductNumberType = (product) => {
    const isCardFormat = isCardNumber(product);
    if (isCardFormat && 'number' in product) {
        return 'cardNumber';
    }
    else if ('IBAN' in product) {
        return 'iban';
    }
    else if ('BBAN' in product || isCardFormat) {
        return 'bban';
    }
    else {
        return 'cardNumber';
    }
};
export const processErrorMessages = (messages) => messages ? messages.join(' ') : undefined;
/**
 * Sets the passed unmasked attribute to the item
 *
 * @param item
 * @param attributeName
 * @param attributeValue
 */
// eslint-disable-next-line @typescript-eslint/ban-types
export const setAttribute = (item, attributeName, attributeValue) => (Object.assign(Object.assign({}, (item ? item : {})), (attributeName ? { [attributeName]: attributeValue } : {})));
/**
 * Verifies if values is defined (not null and not undefined)
 *
 * @param value
 */
// eslint-disable-next-line no-null/no-null
export const isDefined = (value) => value !== null && value !== undefined;
/**
 * Returns configuration property based on the priority
 */
export const filterInputParameters = (input, prop) => combineLatest([input, prop]).pipe(map(([inputVal, propVal]) => (inputVal !== undefined ? inputVal : propVal)));
/**
 * Caches the request (shares between subscribers)
 *
 * @param request
 */
export const cacheRequest = (request) => (source) => source.pipe(switchMap(request), publishReplay(1), refCount());
/**
 * Returns route parameter
 * takes parameter from component route if parameter exists, otherwise looks for parameter in parent routes
 *
 * @param route
 * @param param
 */
export const getRouteParameter = (route, param) => {
    const routeParam = route.paramMap.pipe(pluck('params', param));
    const allParams = route.parent ? [routeParam, getRouteParameter(route.parent, param)] : [routeParam];
    return combineLatest(allParams).pipe(map(params => params[0] || params[1]), map(value => value !== null && value !== void 0 ? value : ''));
};
/**
 * Returns true if product has external info (external logo, alias, etc.)
 *
 * @param product
 */
export const hasExternalInfo = (product) => product.financialInstitutionId !== undefined;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcHJvZHVjdC1zdW1tYXJ5LWNvbW1vbi1hbmcvc3JjL2hlbHBlcnMvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRSxPQUFPLEVBQWMsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLDBCQUEwQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFLckYsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUMsV0FBVyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQzlDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUUzRSxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxPQUFvQixFQUFXLEVBQUUsQ0FDNUQsT0FBTyxDQUFDLE9BQU8sQ0FBQyxlQUFlLElBQUksbUJBQW1CLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRTFHLE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLENBQUMsS0FBdUIsRUFBVyxFQUFFO0lBQ3JFLElBQUksT0FBTyxLQUFLLEtBQUssU0FBUyxFQUFFO1FBQzlCLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFDRCxPQUFPLEtBQUssS0FBSyxNQUFNLENBQUM7QUFDMUIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFD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cmVmQ291bnQsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9ic2VydmFibGUsIGNvbWJpbmVMYXRlc3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgcGx1Y2sgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDYXJkUHJvZHVjdEtpbmROYW1lLCBEZWZhdWx0UHJvZHVjdEtpbmROYW1lTGlzdCB9IGZyb20gJy4uL21vZGVsL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBBY2NvdW50TnVtYmVyVHlwZSB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvYWNjb3VudC1udW1iZXItcGlwZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUGFyYW1NYXAgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQXJyYW5nZW1lbnQgfSBmcm9tICcuLi9tb2RlbC9wcm9kdWN0LXN1bW1hcnktdHlwZXMnO1xuXG5leHBvcnQgY29uc3QgdG9LZWJhYkNhc2UgPSAoYWNjb3VudFR5cGUgPSAnJykgPT5cbiAgYWNjb3VudFR5cGUgPyBhY2NvdW50VHlwZS50cmltKCkudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpLmpvaW4oJy0nKSA6ICcnO1xuXG5leHBvcnQgY29uc3QgaXNDYXJkTnVtYmVyID0gKGFjY291bnQ6IEFycmFuZ2VtZW50KTogYm9vbGVhbiA9PlxuICBCb29sZWFuKGFjY291bnQucHJvZHVjdEtpbmROYW1lICYmIENhcmRQcm9kdWN0S2luZE5hbWUuaW5jbHVkZXMoYWNjb3VudC5wcm9kdWN0S2luZE5hbWUudG9Mb3dlckNhc2UoKSkpO1xuXG5leHBvcnQgY29uc3QgbW9kZWxJdGVtVG9Cb29sZWFuID0gKHZhbHVlOiBzdHJpbmcgfCBib29sZWFuKTogYm9vbGVhbiA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICByZXR1cm4gdmFsdWUgPT09ICd0cnVlJztcbn07XG5cbmV4cG9ydCBjb25zdCBpc0Zhdm9yaXRlID0gKGFjY291bnQ6IEFycmFuZ2VtZW50KSA9PiB7XG4gIGNvbnN0IGFjY291bnRQcmVmZXJlbmNlc0Zhdm9yaXRlVmFsdWUgPSBhY2NvdW50LnVzZXJQcmVmZXJlbmNlcyAmJiBhY2NvdW50LnVzZXJQcmVmZXJlbmNlcy5mYXZvcml0ZTtcbiAgY29uc3QgYWNjb3VudEZhdm9yaXRlVmFsdWUgPSAnZmF2b3JpdGUnIGluIGFjY291bnQgPyBhY2NvdW50LmZhdm9yaXRlIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiBhY2NvdW50UHJlZmVyZW5jZXNGYXZvcml0ZVZhbHVlID8/IGFjY291bnRGYXZvcml0ZVZhbHVlO1xufTtcblxuZXhwb3J0IGNvbnN0IGlzUHJvZHVjdFZpc2libGUgPSAocHJvZHVjdDogQXJyYW5nZW1lbnQpOiBib29sZWFuID0+IHtcbiAgaWYgKHByb2R1Y3QudXNlclByZWZlcmVuY2VzICYmIHByb2R1Y3QudXNlclByZWZlcmVuY2VzLnZpc2libGUgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBwcm9kdWN0LnVzZXJQcmVmZXJlbmNlcy52aXNpYmxlO1xuICB9IGVsc2UgaWYgKHByb2R1Y3QudmlzaWJsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHByb2R1Y3QudmlzaWJsZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCBpc0Z1bmN0aW9uID0gKHBhcmFtOiBhbnkpID0+IHR5cGVvZiBwYXJhbSA9PT0gJ2Z1bmN0aW9uJztcblxuZXhwb3J0IGNvbnN0IGZpbmRCeSA9IDxUID0gYW55Pihjb2xsZWN0aW9uOiBUW10sIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCA9PlxuICBjb2xsZWN0aW9uLmZpbmQoaXRlbSA9PiBpdGVtICYmIChpdGVtIGFzIGFueSlba2V5XSA9PT0gdmFsdWUpIGFzIFQ7XG5cbmV4cG9ydCBjb25zdCBmaW5kQnlOYW1lID0gPFQgPSBhbnk+KGNvbGxlY3Rpb246IFRbXSwgbmFtZTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCA9PiBmaW5kQnkoY29sbGVjdGlvbiwgJ25hbWUnLCBuYW1lKTtcblxuZXhwb3J0IGNvbnN0IGdldEFjY291bnRBbGlhcyA9IChhY2NvdW50OiBhbnkpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuICBpZiAoYWNjb3VudC51c2VyUHJlZmVyZW5jZXMpIHtcbiAgICByZXR1cm4gYWNjb3VudC51c2VyUHJlZmVyZW5jZXMuYWxpYXMgPyBhY2NvdW50LnVzZXJQcmVmZXJlbmNlcy5hbGlhcyA6IGFjY291bnQuYmFua0FsaWFzIHx8IGFjY291bnQubmFtZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYWNjb3VudC5iYW5rQWxpYXMgfHwgYWNjb3VudC5uYW1lIHx8ICcnOyAvLyB0b2RvOiByZXBsYWNlIHdpdGggYD8/YCB0eXBlc1NjcmlwdCBpcyB1cGdyYWRlZCB0byAzLjcuMFxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0UHJvZHVjdEtpbmRJY29uTmFtZSA9IChwcm9kdWN0S2luZE5hbWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIGxldCBpY29uTmFtZSA9IHRvS2ViYWJDYXNlKHByb2R1Y3RLaW5kTmFtZSk7XG4gIGNvbnN0IGlzRGVmYXVsdFByb2R1Y3RLaW5kTmFtZSA9IE9iamVjdC52YWx1ZXMoRGVmYXVsdFByb2R1Y3RLaW5kTmFtZUxpc3QpLnNvbWUobmFtZSA9PiBpY29uTmFtZSA9PT0gbmFtZSk7XG5cbiAgaWYgKCFpc0RlZmF1bHRQcm9kdWN0S2luZE5hbWUpIHtcbiAgICBpY29uTmFtZSA9ICdhY2NvdW50JztcbiAgfVxuXG4gIHJldHVybiBgJHtpY29uTmFtZX1zYDtcbn07XG5cbi8qKlxuICogR2V0cyBhIHZhbGlkIHByb2R1Y3QgbnVtYmVyIHR5cGUgZm9yIGEgZ2l2ZW4gcHJvZHVjdFxuICpcbiAqIEBwYXJhbSBwcm9kdWN0XG4gKlxuICogZm9yIENyZWRpdENhcmQvRGViaXRDYXJkOlxuICogLSByZXR1cm5zIGBudW1iZXJgIGlmIGV4aXN0c1xuICogLSBlbHNlIGBJQkFOYCBpZiBleGlzdHNcbiAqIC0gb3RoZXJ3aXNlIGBCQkFOYFxuICogZm9yIG90aGVyIHByb2R1Y3RzOlxuICogLSByZXR1cm5zIGBJQkFOYCBpZiBleGlzdHNcbiAqIC0gZWxzZSBgQkJBTmAgaWYgZXhpc3RzXG4gKiAtIG90aGVyd2lzZSBgbnVtYmVyYFxuICovXG5leHBvcnQgY29uc3QgZ2V0UHJvZHVjdE51bWJlclR5cGUgPSAocHJvZHVjdDogQXJyYW5nZW1lbnQpOiBBY2NvdW50TnVtYmVyVHlwZSA9PiB7XG4gIGNvbnN0IGlzQ2FyZEZvcm1hdCA9IGlzQ2FyZE51bWJlcihwcm9kdWN0KTtcblxuICBpZiAoaXNDYXJkRm9ybWF0ICYmICdudW1iZXInIGluIHByb2R1Y3QpIHtcbiAgICByZXR1cm4gJ2NhcmROdW1iZXInO1xuICB9IGVsc2UgaWYgKCdJQkFOJyBpbiBwcm9kdWN0KSB7XG4gICAgcmV0dXJuICdpYmFuJztcbiAgfSBlbHNlIGlmICgnQkJBTicgaW4gcHJvZHVjdCB8fCBpc0NhcmRGb3JtYXQpIHtcbiAgICByZXR1cm4gJ2JiYW4nO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAnY2FyZE51bWJlcic7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwcm9jZXNzRXJyb3JNZXNzYWdlcyA9IChtZXNzYWdlczogc3RyaW5nW10gfCB1bmRlZmluZWQpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT5cbiAgbWVzc2FnZXMgPyBtZXNzYWdlcy5qb2luKCcgJykgOiB1bmRlZmluZWQ7XG5cbi8qKlxuICogU2V0cyB0aGUgcGFzc2VkIHVubWFza2VkIGF0dHJpYnV0ZSB0byB0aGUgaXRlbVxuICpcbiAqIEBwYXJhbSBpdGVtXG4gKiBAcGFyYW0gYXR0cmlidXRlTmFtZVxuICogQHBhcmFtIGF0dHJpYnV0ZVZhbHVlXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG5leHBvcnQgY29uc3Qgc2V0QXR0cmlidXRlID0gPFQgPSBPYmplY3Q+KGl0ZW06IFQsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgYXR0cmlidXRlVmFsdWU6IGFueSk6IFQgPT4gKHtcbiAgLi4uKGl0ZW0gPyBpdGVtIDogKHt9IGFzIFQpKSxcbiAgLi4uKGF0dHJpYnV0ZU5hbWUgPyB7IFthdHRyaWJ1dGVOYW1lXTogYXR0cmlidXRlVmFsdWUgfSA6IHt9KSxcbn0pO1xuXG4vKipcbiAqIFZlcmlmaWVzIGlmIHZhbHVlcyBpcyBkZWZpbmVkIChub3QgbnVsbCBhbmQgbm90IHVuZGVmaW5lZClcbiAqXG4gKiBAcGFyYW0gdmFsdWVcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW51bGwvbm8tbnVsbFxuZXhwb3J0IGNvbnN0IGlzRGVmaW5lZCA9ICh2YWx1ZTogYW55KTogYm9vbGVhbiA9PiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkO1xuLyoqXG4gKiBSZXR1cm5zIGNvbmZpZ3VyYXRpb24gcHJvcGVydHkgYmFzZWQgb24gdGhlIHByaW9yaXR5XG4gKi9cbmV4cG9ydCBjb25zdCBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMgPSA8VD4oaW5wdXQ6IE9ic2VydmFibGU8VCB8IHVuZGVmaW5lZD4sIHByb3A6IE9ic2VydmFibGU8VD4pOiBPYnNlcnZhYmxlPFQ+ID0+XG4gIGNvbWJpbmVMYXRlc3QoW2lucHV0LCBwcm9wXSkucGlwZShtYXAoKFtpbnB1dFZhbCwgcHJvcFZhbF0pID0+IChpbnB1dFZhbCAhPT0gdW5kZWZpbmVkID8gaW5wdXRWYWwgOiBwcm9wVmFsKSkpO1xuXG4vKipcbiAqIENhY2hlcyB0aGUgcmVxdWVzdCAoc2hhcmVzIGJldHdlZW4gc3Vic2NyaWJlcnMpXG4gKlxuICogQHBhcmFtIHJlcXVlc3RcbiAqL1xuZXhwb3J0IGNvbnN0IGNhY2hlUmVxdWVzdCA9IDxQYXJhbXMsIFJlc3VsdD4ocmVxdWVzdDogKHBhcmFtczogUGFyYW1zKSA9PiBPYnNlcnZhYmxlPFJlc3VsdD4pID0+IChcbiAgc291cmNlOiBPYnNlcnZhYmxlPFBhcmFtcz4sXG4pOiBPYnNlcnZhYmxlPFJlc3VsdD4gPT4gc291cmNlLnBpcGUoc3dpdGNoTWFwKHJlcXVlc3QpLCBwdWJsaXNoUmVwbGF5KDEpLCByZWZDb3VudCgpKTtcblxuLyoqXG4gKiBSZXR1cm5zIHJvdXRlIHBhcmFtZXRlclxuICogdGFrZXMgcGFyYW1ldGVyIGZyb20gY29tcG9uZW50IHJvdXRlIGlmIHBhcmFtZXRlciBleGlzdHMsIG90aGVyd2lzZSBsb29rcyBmb3IgcGFyYW1ldGVyIGluIHBhcmVudCByb3V0ZXNcbiAqXG4gKiBAcGFyYW0gcm91dGVcbiAqIEBwYXJhbSBwYXJhbVxuICovXG5leHBvcnQgY29uc3QgZ2V0Um91dGVQYXJhbWV0ZXIgPSAocm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwYXJhbTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+ID0+IHtcbiAgY29uc3Qgcm91dGVQYXJhbSA9IHJvdXRlLnBhcmFtTWFwLnBpcGUocGx1Y2s8UGFyYW1NYXAsIHN0cmluZyB8IG51bGw+KCdwYXJhbXMnLCBwYXJhbSkpO1xuICBjb25zdCBhbGxQYXJhbXMgPSByb3V0ZS5wYXJlbnQgPyBbcm91dGVQYXJhbSwgZ2V0Um91dGVQYXJhbWV0ZXIocm91dGUucGFyZW50LCBwYXJhbSldIDogW3JvdXRlUGFyYW1dO1xuXG4gIHJldHVybiBjb21iaW5lTGF0ZXN0KGFsbFBhcmFtcykucGlwZShcbiAgICBtYXAocGFyYW1zID0+IHBhcmFtc1swXSB8fCBwYXJhbXNbMV0pLFxuICAgIG1hcCh2YWx1ZSA9PiB2YWx1ZSA/PyAnJyksXG4gICk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBwcm9kdWN0IGhhcyBleHRlcm5hbCBpbmZvIChleHRlcm5hbCBsb2dvLCBhbGlhcywgZXRjLilcbiAqXG4gKiBAcGFyYW0gcHJvZHVjdFxuICovXG5leHBvcnQgY29uc3QgaGFzRXh0ZXJuYWxJbmZvID0gKHByb2R1Y3Q6IEFycmFuZ2VtZW50KTogYm9vbGVhbiA9PiBwcm9kdWN0LmZpbmFuY2lhbEluc3RpdHV0aW9uSWQgIT09IHVuZGVmaW5lZDtcbiJdfQ==