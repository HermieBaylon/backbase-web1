{"version":3,"file":"payment-schedule-wrapper.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/retail-loans-journey/src/lib/components/loan-details/tabs/payment-schedule-wrapper/payment-schedule-wrapper.component.ts","../../../../../../../../../libs/retail-loans-journey/src/lib/components/loan-details/tabs/payment-schedule-wrapper/payment-schedule-wrapper.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component } from '@angular/core';\nimport { ActivatedRoute, ActivatedRouteSnapshot, Router } from '@angular/router';\nimport { combineLatest, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { PresentationAmortizationPayment } from '@backbase/data-ang/loans';\n\nimport { LoadMoreParams } from '@backbase/ui-ang/load-button';\nimport { MediaQueryService } from '@backbase/ui-ang/media-query-lib';\n\nimport { loanIdParamKey } from '../../../../config/route-params.model';\nimport { isErrorState, isLoadingState, stateMap } from '../../../../utils/call-state.util';\nimport { LoansJourneyConfigurationService } from '../../../../loans-journey-configuration';\nimport { PaymentScheduleStoreService } from '../../../../store/payment-schedule/store.service';\nimport { GetAmortizationScheduleParams } from '../../../../store/payment-schedule/store.model';\nimport { LoansJourneyLoansPaymentScheduleConfig } from '../../../../models/journey-configuration.model';\nimport { RemoteConfigService } from '@backbase/remote-config-ang';\nimport { RetailAppRemoteConfig } from '../../../../models/remote-config.model';\n\n// TODO: move to separate and reorganize the flow\n@Component({\n  selector: 'bb-payment-schedule-wrapper',\n  templateUrl: './payment-schedule-wrapper.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PaymentScheduleWrapperComponent {\n  /**\n   * Stream of Amortized Payments\n   */\n  readonly amortizedPayments$: Observable<PresentationAmortizationPayment[]> = this.storeService.amortizedPayments$;\n  /**\n   * Payment schedule configuration\n   */\n  readonly scheduleConfig: LoansJourneyLoansPaymentScheduleConfig = this.configurationService.paymentSchedule;\n\n  /**\n   * Hide or show payment status in the table\n   */\n  readonly showPaymentStatus = this.remoteConfig.getValue('show_payment_status_retail_loans');\n\n  /**\n   * Flag represents error state\n   */\n  readonly isErrorState$: Observable<boolean> = this.storeService.amortizedPaymentsCallState$.pipe(\n    stateMap(isErrorState),\n  );\n\n  /**\n   * Stream represents total amount of the pages\n   */\n  readonly amortizedPaymentsTotalCount$: Observable<number> = this.storeService.amortizedPaymentsTotalCount$;\n\n  /**\n   * Stream represent current loaded page number\n   */\n  readonly amortizedPaymentsCurrentPage$: Observable<number> = this.storeService.amortizedPaymentsCurrentPage$;\n\n  /**\n   * Flag represents the tablet screen resolution\n   */\n  readonly isTabletResolution$: Observable<boolean> = this.mediaQueryService.isMediaBreakpointMatches(\n    'max-width',\n    'lg',\n  );\n\n  private readonly _isLoading$ = combineLatest([\n    this.isTabletResolution$,\n    this.storeService.amortizedPaymentsCallState$,\n    this.amortizedPaymentsCurrentPage$,\n  ]);\n  /**\n   * Flag represents page loading state\n   */\n  readonly isPageLoading$: Observable<boolean> = this._isLoading$.pipe(\n    map(\n      ([isTabletResolution, callState, currentPage]) =>\n        isLoadingState(callState) && !(isTabletResolution && currentPage > 0),\n    ),\n  );\n  /**\n   * Flag represents load more button loading state\n   */\n  readonly isButtonLoading$: Observable<boolean> = this._isLoading$.pipe(\n    map(\n      ([isTabletResolution, callState, currentPage]) =>\n        isLoadingState(callState) && isTabletResolution && currentPage > 0,\n    ),\n  );\n  /**\n   * Flag represents visibility of load more button\n   */\n  readonly isLoadMoreVisible$: Observable<boolean> = combineLatest([\n    this.amortizedPaymentsCurrentPage$,\n    this.amortizedPaymentsTotalCount$,\n    this.amortizedPayments$,\n  ]).pipe(map(([page, total, { length }]) => !(page === 0 && length === total)));\n\n  /**\n   * Flag represents empty state\n   */\n  readonly isEmptyState$: Observable<boolean> = this.storeService.amortizedPaymentsTotalCount$.pipe(\n    map((totalCount) => totalCount === 0),\n  );\n\n  private readonly baseReqParams: GetAmortizationScheduleParams = {\n    loanId: (this.activatedRoute.snapshot.parent as ActivatedRouteSnapshot).params[loanIdParamKey],\n    size: this.scheduleConfig.itemsPerPage,\n    from: 0,\n    append: false,\n  };\n\n  constructor(\n    private readonly configurationService: LoansJourneyConfigurationService,\n    private readonly storeService: PaymentScheduleStoreService,\n    private readonly mediaQueryService: MediaQueryService,\n    private readonly activatedRoute: ActivatedRoute,\n    private readonly router: Router,\n    private readonly remoteConfig: RemoteConfigService<RetailAppRemoteConfig>,\n  ) {\n    this.storeService.fetchAmortizationSchedule(this.baseReqParams);\n  }\n\n  /**\n   * Load loans on pagination page changes\n   *\n   * @param page\n   */\n  onPageChange(page: number): void {\n    this.storeService.fetchAmortizationSchedule({ ...this.baseReqParams, from: page });\n  }\n\n  /**\n   * Load loans on load more button click\n   *\n   * @param from\n   */\n  onLoadMore({ from }: LoadMoreParams): void {\n    this.storeService.fetchAmortizationSchedule({ ...this.baseReqParams, from, append: true });\n  }\n\n  /**\n   * Emits in item select\n   */\n  onItemSelect({ id }: PresentationAmortizationPayment): void {\n    this.router.navigate([id], { relativeTo: this.activatedRoute });\n  }\n}\n","<bb-loans-main-container\n  [isLoadingState]=\"isPageLoading$ | async\"\n  [isErrorState]=\"isErrorState$ | async\"\n  [isEmptyState]=\"isEmptyState$ | async\"\n  [customEmptyState]=\"customEmptyState\"\n  rootWrapperClasses=\"\"\n  contentWrapperClasses=\"\"\n>\n  <div class=\"bb-card\">\n    <div class=\"bb-card__body\">\n      <ng-container *ngIf=\"isTabletResolution$ | async; else desktop\">\n        <bb-loan-amortized-payment-schedule-list\n          [items]=\"(amortizedPayments$ | async)!\"\n          (selectItem)=\"onItemSelect($event)\"\n        ></bb-loan-amortized-payment-schedule-list>\n      </ng-container>\n\n      <bb-load-button-ui\n        *ngIf=\"isLoadMoreVisible$ | async\"\n        [from]=\"(amortizedPaymentsCurrentPage$ | async)!\"\n        [size]=\"scheduleConfig.itemsPerPage\"\n        [totalCount]=\"(amortizedPaymentsTotalCount$ | async)!\"\n        [isLoading]=\"(isButtonLoading$ | async)!\"\n        (paramChange)=\"onLoadMore($event)\"\n        class=\"bb-stack bb-stack--center\"\n        i18n=\"Load more button@loans.payment-schedule.load-more.btn\"\n        color=\"link\"\n        data-role=\"payment-schedule-wrapper__load-more-btn\"\n      >\n        Load more\n      </bb-load-button-ui>\n\n      <ng-template #desktop>\n        <bb-loan-amortized-payment-schedule-table\n          [items]=\"(amortizedPayments$ | async)!\"\n          (selectItem)=\"onItemSelect($event)\"\n          [showPaymentStatus]=\"showPaymentStatus\"\n        >\n        </bb-loan-amortized-payment-schedule-table>\n      </ng-template>\n    </div>\n  </div>\n  <router-outlet></router-outlet>\n</bb-loans-main-container>\n\n<ng-template #customEmptyState>\n  <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"payment-schedule-wrapper__empty-state\">\n    <bb-empty-state-ui\n      title=\"No Upcoming Payments\"\n      i18n-title=\"Payment schedule empty state title@loans.payment-schedule.empty-state.title\"\n      subtitle=\"You don't have any upcoming payments to be displayed.\"\n      i18n-subtitle=\"Payment schedule empty state subtitle@loans.payment-schedule.empty-state.subtitle\"\n      iconModifier=\"loans\"\n      iconSize=\"xxl\"\n    >\n    </bb-empty-state-ui>\n  </div>\n</ng-template>\n"]}