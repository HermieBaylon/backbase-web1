{"version":3,"sources":["node_modules/tslib/tslib.es6.js","node_modules/vendor-bb-cookie-js/scripts/vendor-bb-cookie-js.js","libs/lib-bb-auth/scripts/session.ts","libs/lib-bb-auth/scripts/redirect.ts","libs/lib-bb-auth/scripts/utils.ts","libs/lib-bb-auth/scripts/xsrf.ts","libs/lib-bb-auth/scripts/countdown.ts","libs/lib-bb-auth/scripts/activity.ts","libs/lib-bb-auth/scripts/index.ts","node_modules/base64-js/index.js","node_modules/js-sha256/src/sha256.js","node_modules/vendor-bb-keycloak/scripts/vendor-bb-keycloak.js","libs/lib-bb-auth-hybrid/scripts/keycloak-init.ts","libs/lib-bb-auth-hybrid/scripts/locales.ts","libs/lib-bb-auth-hybrid/scripts/cx-strategy.ts","libs/lib-bb-auth-hybrid/scripts/reauthentication.ts","libs/lib-bb-auth-hybrid/scripts/cdn-strategy.ts","libs/lib-bb-auth-hybrid/scripts/impersonation.ts","libs/lib-bb-page-config/scripts/auth-config.ts","libs/lib-bb-auth-hybrid/scripts/index.ts","libs/lib-bb-page-config/scripts/feature-toggles.ts","libs/lib-bb-page-config/scripts/index.ts","libs/lib-bb-http/scripts/utils.ts","libs/lib-bb-http/scripts/request-provider.ts","libs/lib-bb-http/scripts/index.ts","libs/lib-bb-http-interceptors/scripts/index.ts","libs/lib-bb-set-locale-cdn/scripts/index.ts","libs/lib-bb-conditions/scripts/index.ts","libs/lib-bb-entitlements/scripts/index.ts","libs/lib-bb-page-render/scripts/bootstrap-item.ts","libs/lib-bb-page-render/scripts/remove-item.ts","libs/lib-bb-page-render/scripts/refresh.ts","libs/lib-bb-page-render/scripts/update.ts","libs/lib-bb-page-render/scripts/traverse-utils.ts","libs/lib-bb-page-render/scripts/strategy-provider.ts","libs/lib-bb-page-render/scripts/can-render.ts","libs/lib-bb-page-render/scripts/index.ts","libs/lib-bb-property-resolver/scripts/triplet-conversion.ts","libs/lib-bb-property-resolver/scripts/index.ts","libs/lib-bb-pubsub/scripts/index.ts","libs/lib-bb-navigation-cdn/scripts/navigation.ts","libs/lib-bb-navigation-cdn/scripts/utils.ts","libs/lib-bb-content-services/scripts/types/content-mime-types.ts","libs/lib-bb-content-services/scripts/types/content-properties.ts","libs/lib-bb-content-services/scripts/types/content-types.ts","libs/lib-bb-portal-content-handler/scripts/types/content-item.ts","libs/lib-bb-navigation-cdn/scripts/index.ts","libs/lib-bb-portal-content-cdn/scripts/index.ts","libs/render-bb-widget-3/scripts/index.ts","libs/lib-bb-page-bootstrap-cdn/scripts/index.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","o","c","document","path","defaults","expires","Date","setMilliseconds","getMilliseconds","toUTCString","test","JSON","stringify","write","encodeURIComponent","String","replace","decodeURIComponent","escape","cookie","split","u","l","C","slice","join","json","charAt","read","parse","set","get","getJSON","remove","withConverter","module","exports","parseJwt","token","base64","window","atob","BB_AUTH","createAuthSession","storage","linkRoot","cookieOptions","getSession","sessionStringified","getItem","storedSession","getTtl","isSessionValid","bbSession","now","Math","floor","accessExpiry","timeSkew","sessionInfo","options","expiryDate","forceSessionCookie","isImpersonated","parsedToken","exp","secure","location","protocol","undefined","refreshToken","setItem","destroy","removeItem","redirectTreshold","REPLACE_LOCATION_PREFIX","isInfiniteLoop","url","REPLACE_LOCATION_KEY","stringifiedDate","sessionStorage","utcStringfied","dateLastReplace","getTime","isUrlAbsolute","getOrigin","createElement","href","origin_1","origin","isExternal","normalizeRedirectUrl","redirectUrl","host","port","redirect","onInfiniteLoop","console","error","normalizedUrl","messageOnExternalRedirectIntent","resolveRedirectUri","loginPageUrl","redirectPageUrl","warn","createUtils","httpRequest","setLocale","request","encode","getQueryStringValue","entries","obj","keys","map","key","isValueDefined","entry","hash","filter","_a","encodedKey","search","RegExp","runEverySecond","callback","setTimeout","CXP5_XSRF_COOKIE","CXP5_XSRF_HEADER","CXP6_XSRF_COOKIE","CXP6_XSRF_HEADER","createXsrfInterceptor","addXsrfToken","httpConfig","headers","createXsrfInterceptor$1","getCookie","token5","token6","_b","initTimers","duration","countdown","run","listenCountdown","repeat","ttl","tick","end","listenForCountdownStart","reset","start","createCountdown","countdownDuration","hasRegistered","Error","addListeners","supportsPassive","opts","defineProperty","addEventListener","removeEventListener","passive","capture","createActivityMonitor","maxInactivityDuration","refresh","logout","lastActive","refreshInProgress","getInactivityTtl","last","createAuth","authConfig","strategyFactory","httpInterceptors","envConfig","pubsub","utils","add","cookie.get","strategy","cookiePath","interceptor","authApi","config","timeToLive","isAnonymousUser","inactivityTtl","register","ERROR","WINDOW","root","JS_SHA256_NO_WINDOW","WEB_WORKER","self","NODE_JS","JS_SHA256_NO_NODE_JS","process","versions","node","global","COMMON_JS","JS_SHA256_NO_COMMON_JS","ARRAY_BUFFER","JS_SHA256_NO_ARRAY_BUFFER","ArrayBuffer","HEX_CHARS","EXTRA","SHIFT","K","OUTPUT_TYPES","blocks","isArray","toString","JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW","isView","buffer","createOutputMethod","outputType","is224","message","Sha256","update","createMethod","method","nodeWrap","type","crypto","eval","Buffer","algorithm","nodeMethod","createHash","digest","Uint8Array","createHmacOutputMethod","HmacSha256","createHmacMethod","sharedMemory","h0","h1","h2","h3","h4","h5","h6","h7","block","bytes","hBytes","finalized","hashed","first","code","index","charCodeAt","array","oKeyPad","iKeyPad","inner","notString","lastByteIndex","finalize","s0","s1","maj","t1","ab","da","cd","bc","h","hex","arr","arrayBuffer","dataView","DataView","setUint32","innerHash","sha256","sha224","hmac","byteLength_1","byteLength","toByteArray_1","toByteArray","fromByteArray_1","fromByteArray","lookup","revLookup","Arr","len","getLens","b64","validLen","lens","placeHoldersLen","_byteLength","tmp","curByte","tripletToBase64","num","encodeChunk","uint8","output","extraBytes","parts","maxChunkLength","len2","sha256_imported","base64js_imported","loggedPromiseDeprecation","logPromiseDeprecation","Keycloak","adapter","callbackStorage","kc","refreshQueue","loginIframe","enable","callbackList","interval","scripts","getElementsByTagName","src","iframeVersion","substring","useNonce","logInfo","createLogger","info","logWarn","generateRandomData","msCrypto","getRandomValues","random","generateCodeVerifier","generateRandomString","alphabet","randomData","chars","fromCharCode","generatePkceChallenge","pkceMethod","codeVerifier","hashBytes","getRealmUrl","authServerUrl","realm","hostname","processCallback","oauth","promise","prompt","timeLocal","onActionUpdate","errorData","error_description","onAuthError","setError","setSuccess","flow","access_token","id_token","authSuccess","params","endpoints","req","XMLHttpRequest","open","setRequestHeader","clientId","redirectUri","pkceCodeVerifier","withCredentials","onreadystatechange","readyState","status","tokenResponse","responseText","scheduleCheckIframe","send","accessToken","idToken","fulfillPromise","setToken","tokenParsed","nonce","storedNonce","refreshTokenParsed","idTokenParsed","clearToken","onAuthSuccess","loadConfig","configUrl","createPromise","setupOidcEndoints","oidcConfiguration","authorize","authorization_endpoint","token_endpoint","end_session_endpoint","checkSessionIframe","check_session_iframe","userinfo","userinfo_endpoint","thirdPartyCookiesIframe","fileLoaded","oidcProvider","oidcProviderConfigUrl","match","substr","xhr","responseURL","startsWith","tokenTimeoutHandle","clearTimeout","decodeToken","sessionId","session_state","authenticated","subject","sub","realmAccess","realm_access","resourceAccess","resource_access","iat","onTokenExpired","expiresIn","round","str","createUUID","hexDigits","parseCallback","parseCallbackUrl","oauthState","state","valid","supportedParams","newUrl","parsed","queryIndex","fragmentIndex","responseMode","parseCallbackParams","paramsString","oauthParams","success","catch","applyTimeoutToPromise","timeout","errorMessage","timeoutHandle","timeoutPromise","race","finally","setupCheckLoginIframe","iframe","onload","authUrl","iframeOrigin","setAttribute","style","display","appendChild","messageCallback","event","contentWindow","source","data","callbacks","splice","checkLoginIframe","unchanged","msg","postMessage","check3pCookiesSupported","silentCheckSsoRedirectUri","silentCheckSsoFallback","removeChild","messageReceiveTimeout","loadAdapter","login","createLoginUrl","createLogoutUrl","createRegisterUrl","accountManagement","accountUrl","createAccountUrl","encodeHash","cordovaOpenWindowWrapper","loginUrl","target","cordova","InAppBrowser","shallowCloneCordovaOptions","userOptions","cordovaOptions","reduce","optionName","formatCordovaOptions","createCordovaOptions","hidden","ref","completed","closed","closeBrowser","close","reason","logoutUrl","registerUrl","universalLinks","subscribe","unsubscribe","plugins","browsertab","openUrl","init","initOptions","createCallbackStorage","Cordova","checkLoginIframeInterval","onLoad","loginRequired","responseType","enableLogging","scope","initPromise","onReady","configPromise","doLogin","checkSsoSilently","ifrm","processInit","history","replaceState","updateToken","domReady","checkReadyState","baseUrl","callbackState","action","maxAge","loginHint","idpHint","locale","hasRealmRole","role","access","roles","hasResourceRole","resource","loadUserProfile","profile","loadUserInfo","userInfo","isTokenExpired","minValidity","ceil","isNaN","exec","onAuthRefreshSuccess","onAuthRefreshError","onAuthLogout","bbProcessAuthCallback","LocalStorage","localStorage","cs","clearExpired","time","err","CookieStorage","setCookie","cookieExpiration","minutes","setTime","name","ca","expirationDate","fn","factory","require$$0","require$$1","initKeycloak","keycloak","session","authPubSub","win","loginOptions","initToken","getOptions","isAuthenticated","getPayload","kcLocale","currentAccessToken","raw","currentRefreshToken","publish","laDate","millis","Number","reLogin","cb","waitForRefreshToken","createLocaleHandler","locales","currentLocale","handleLocaleChange","keycloakLocale","matchingLocale","trim","find","supportedLocale","getOrderedLocales","removedCurrent","loc","concat","REDIRECT_URL_COOKIE_NAME","string","testingString","ReauthErrorCodes","getCxDesignModeApi","reauthenticate","goToLoginPage","createCxSessionHandler","getAuthTokens","tokens","createCxStrategy","keycloakFacade","localesHandler","isLoginPage","stateExists","redirectToLogin","landingPage","landingPageUrl","localePromise","Reauthentication","acrValues","reauthConfig","getErrorResponse","UNAVAILABLE","performReauthentication","performRequest","onSuccess","response","_this","locationHeader","getLocationHeader","hasCodeInLocation","TOKEN_ERROR","onError","getChallenge","errorParams","getErrorParams","description","CHALLENGE_ERROR","createChallengeResponseFunction","errorResponse","challenges","challengeType","actionUrl","challengeData","challengeUrl","postChallengeResponse","errorCode","UNKNOWN","errorDescription","locationUrl","URL","searchParams","Location","Accept","X-Convert-Redirects","createCdnSessionHandler","createCdnStrategy","IMPERSONATION_PARAM","AuthKind","stripImpersonationCodeFromUrl","delete","createImpersonation","apiRoot","client","impersonationToken","hasImpersonatedToken","Boolean","Content-Type","refresh_token","createAuthStrategy","designmode","isCDN","sessionHandler","reauthentication","bind","createGetFullUrl","normalizeAuthConfig","pageConfig","rawCxConfig","defaultRawBasConfig","parseInt","kind","Custom","Hybrid","getFullUrl","portalPath","portalName","Basic","refreshUrl","statusUrl","isEntitlementsEnabled","entitlementsEnable","designMode","getFeatureToggles","features","entitlements","enabled","entitlementsEnabled","entitlementsUri","uri","defaultLoadModule","systemImport","System","import","defaultRawPageConfig","version","staticResourcesRoot","pageName","currentLinkUUID","currentLink","cspNonce","isAdmin","isManager","userId","createPageConfig","rawPageConfig","normalizePageConfig","cx","auth","moduleLoader","loadModule","featureToggles","spacesRegEx","webSdkVersion","HEADER_VALUE_SPLIT_STR","getQueryString","query","getHeaders","headersStr","rawHeader","headerSegments","acc","header","HttpError","_super","httpErrParams","statusText","newName","parseResponse","currentTarget","getAllResponseHeaders","createRequest","forEach","requestHandler","log","queryString","sendRequest","createHttpInterceptors","interceptors","getHandler","allInterceptors","lastHandler","cookiejs","COOKIE_NAME","LogicalOperator","createSetLocale","createConditions","resolvers","resolveResolutions","resolutions","final","resolution","logic","AND","NOT","resolveConditions","conditions","resolutionPromises","condition","resolveCondition","all","resolveConditionalValue","conditionalValues","resolveValue","dynamicValue","conditionalValue","defaultValue","addResolver","resolver","getRawData","removeWhiteSpace","item","function","createEntitlements","rawDataPromise","entitlement","rawData","rawEntitlement","permissions","privilege","createBootstrapItem","loadStrategy","getRenderStrategy","getRequiredStrategy","itemLocation","loadAndBootstrap","bootstrap","primaryStrategyName","requiredStrategyName","createRemoveItem","loadAndRemove","strategyName","createRefresh","createUpdate","properties","getUpdateFunc","updateFunc","createTraverseUtils","forEachChild","traverse","children","child","parentName","createTraverseFromRootToLeafs","bootstrapCallback","traverseFromRootToLeafs","stopTraversing","createTraverseFromLeafsToRoot","removeCallback","traverseFromLeafsToRoot","StrategyPropertyNames","CommonRenderingStrategies","createStrategyProvider","renderStrategyFactories","strategies","Map","Required","SSR","renderingStrategy","newStrategy","Main","extension","WC2","isManageableArea","createCanRender","container","itemRequiredStrategy","createPageRender","previousRendering","canRender","traverseUtils","bootstrapItemCallback","removeItemCallback","queue","renderingFunction","_i","tripletToEntitlement","triplet","tripletArray","separateLogicalOperators","splitBySpaces","OR","convertEntitlementFromString","stringDef","spaced","CONDITION_PROPERTY_PREFIX","FILTER_PROPERTY_NAME","isConditionalProperty","createPropertyResolver","resolveEntitlements","entitlementDefinition","entitlementCondition","resolveProperties","asyncValues","propertyName","propertyValue","resolvedProperty","configValue","resolveConditionalProperty","resolvedProps","newProps","renameResolvedProperties","resolveItem","resolvedChildren","resolvedChild","newChildren","resolveChildren","createPubsub","logger","listenersMap","getListeners","eventName","listener","newListeners","currentListener","payload","unsubscribeAll","clear","getBreadcrumbs","createGetTree","filterTree","store","id","val","isCurrent","isInPath","childId","uuid","uuidWithoutRoot","suffix","createStaticNavigation","getTree","applyConditions","depth","resolvedItem","ContentMimeType","ContentProperty","ContentType","StructuredContentType","ContentTypes","createNavigation","navigation","createPortalContentHandler","contentRef","getContent","content","res","getContentItem","mimeType","IMAGE","DOCUMENT","subscribeContentUpdate","itemName","subscribeContentItemUpdate","portalContent","itemRefresher","propertyResolver","ngApp","getApi","BB","startSingleApp","eventBus","forms","formsConfig","ngApi","checkPageItem","pageItem","withoutChildren","innerHTML","render","pageModel","pageRender","resolvedModel","pageChildren","childRenders","cdnToRawPageConfig","initialise","cdnPageConfig","createHttpRequest","conditionsService","createHybridClient","createWidget3Renderer"],"mappings":";;;;;;;;;;;;;;oFAgBA,IAAIA,cAAgB,SAASC,EAAGC,GAI5B,OAHAF,cAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,MACpDN,EAAGC,IAGrB,SAASO,UAAUR,EAAGC,GAEzB,SAASQ,IAAOC,KAAKC,YAAcX,EADnCD,cAAcC,EAAGC,GAEjBD,EAAEY,UAAkB,OAANX,EAAaC,OAAOW,OAAOZ,IAAMQ,EAAGG,UAAYX,EAAEW,UAAW,IAAIH,GAG5E,IAAIK,SAAW,WAQlB,OAPAA,SAAWZ,OAAOa,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIZ,KADTW,EAAIG,UAAUF,GACOhB,OAAOU,UAAUL,eAAee,KAAKL,EAAGX,KAAIU,EAAEV,GAAKW,EAAEX,IAE9E,OAAOU,IAEKO,MAAMb,KAAMU,YAGzB,SAASI,OAAOP,EAAGQ,GACtB,IAAIT,EAAI,GACR,IAAK,IAAIV,KAAKW,EAAOf,OAAOU,UAAUL,eAAee,KAAKL,EAAGX,IAAMmB,EAAEC,QAAQpB,GAAK,IAC9EU,EAAEV,GAAKW,EAAEX,IACb,GAAS,MAALW,GAAqD,mBAAjCf,OAAOyB,sBACtB,CAAA,IAAIT,EAAI,EAAb,IAAgBZ,EAAIJ,OAAOyB,sBAAsBV,GAAIC,EAAIZ,EAAEe,OAAQH,IAC3DO,EAAEC,QAAQpB,EAAEY,IAAM,GAAKhB,OAAOU,UAAUgB,qBAAqBN,KAAKL,EAAGX,EAAEY,MACvEF,EAAEV,EAAEY,IAAMD,EAAEX,EAAEY,KAE1B,OAAOF,EAkBJ,SAASa,UAAUC,EAASC,EAAYC,EAAGC,GAE9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOb,GAAKW,EAAOX,IACpF,SAASgB,EAASH,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOb,GAAKW,EAAOX,IACvF,SAASc,EAAKG,GAJlB,IAAeJ,EAIaI,EAAOC,KAAOR,EAAQO,EAAOJ,QAJ1CA,EAIyDI,EAAOJ,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITM,KAAKP,EAAWI,GAClGF,GAAMN,EAAYA,EAAUV,MAAMO,EAASC,GAAc,KAAKS,WAI/D,SAASK,YAAYf,EAASgB,GACjC,IAAsGC,EAAGC,EAAGhC,EAAGiC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPpC,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOqC,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAET,KAAMe,EAAK,GAAIC,MAASD,EAAK,GAAIE,OAAUF,EAAK,IAAwB,mBAAXG,SAA0BT,EAAES,OAAOC,UAAY,WAAa,OAAOjD,OAAUuC,EACvJ,SAASM,EAAKpC,GAAK,OAAO,SAAUyC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOZ,OACH,GAAIH,EAAI,EAAGC,IAAMhC,EAAY,EAAR6C,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOhC,EAAIgC,EAAU,SAAMhC,EAAEM,KAAK0B,GAAI,GAAKA,EAAER,SAAWxB,EAAIA,EAAEM,KAAK0B,EAAGa,EAAG,KAAKlB,KAAM,OAAO3B,EAE3J,OADIgC,EAAI,EAAGhC,IAAG6C,EAAK,CAAS,EAARA,EAAG,GAAQ7C,EAAEsB,QACzBuB,EAAG,IACP,KAAK,EAAG,KAAK,EAAG7C,EAAI6C,EAAI,MACxB,KAAK,EAAc,OAAXX,EAAEC,QAAgB,CAAEb,MAAOuB,EAAG,GAAIlB,MAAM,GAChD,KAAK,EAAGO,EAAEC,QAASH,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKX,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,KAAM/C,EAAIkC,EAAEG,MAAMrC,EAAIA,EAAEK,OAAS,GAAKL,EAAEA,EAAEK,OAAS,KAAkB,IAAVwC,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEX,EAAI,EAAG,SACjG,GAAc,IAAVW,EAAG,MAAc7C,GAAM6C,EAAG,GAAK7C,EAAE,IAAM6C,EAAG,GAAK7C,EAAE,IAAM,CAAEkC,EAAEC,MAAQU,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYX,EAAEC,MAAQnC,EAAE,GAAI,CAAEkC,EAAEC,MAAQnC,EAAE,GAAIA,EAAI6C,EAAI,MAC7D,GAAI7C,GAAKkC,EAAEC,MAAQnC,EAAE,GAAI,CAAEkC,EAAEC,MAAQnC,EAAE,GAAIkC,EAAEI,IAAIU,KAAKH,GAAK,MACvD7C,EAAE,IAAIkC,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBF,EAAKf,EAAKxB,KAAKQ,EAASoB,GAC1B,MAAOzB,GAAKoC,EAAK,CAAC,EAAGpC,GAAIuB,EAAI,EAAI,QAAWD,EAAI/B,EAAI,EACtD,GAAY,EAAR6C,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEvB,MAAOuB,EAAG,GAAKA,EAAG,QAAK,EAAQlB,MAAM,GArB9BJ,CAAK,CAACpB,EAAGyC,MAqEtD,SAASK,iBACZ,IAAK,IAAIhD,EAAI,EAAGC,EAAI,EAAGgD,EAAK9C,UAAUC,OAAQH,EAAIgD,EAAIhD,IAAKD,GAAKG,UAAUF,GAAGG,OACxE,IAAI8C,EAAI9D,MAAMY,GAAImD,EAAI,EAA3B,IAA8BlD,EAAI,EAAGA,EAAIgD,EAAIhD,IACzC,IAAK,IAAImD,EAAIjD,UAAUF,GAAIoD,EAAI,EAAGC,EAAKF,EAAEhD,OAAQiD,EAAIC,EAAID,IAAKF,IAC1DD,EAAEC,GAAKC,EAAEC,GACjB,OAAOH,8eC1JV,IAAS1C,EAAAA,EAAuP,WAAW,SAASA,IAAI,IAAI,IAAIA,EAAE,EAAEN,EAAE,GAAGM,EAAEL,UAAUC,OAAOI,IAAI,CAAC,IAAI+C,EAAEpD,UAAUK,GAAG,IAAI,IAAIT,KAAKwD,EAAErD,EAAEH,GAAGwD,EAAExD,GAAG,OAAOG,EAAoyC,OAAlyC,SAASA,EAAEqD,GAAG,SAASxD,EAAEG,EAAEgD,EAAEjD,GAAG,IAAIuD,EAAE,GAAG,oBAAoBC,SAAS,CAAC,GAAGtD,UAAUC,OAAO,EAAE,CAAC,GAAG,iBAAiBH,EAAEO,EAAE,CAACkD,KAAK,KAAK3D,EAAE4D,SAAS1D,IAAI2D,QAAQ,CAAC,IAAIR,EAAE,IAAIS,KAAKT,EAAEU,gBAAgBV,EAAEW,kBAAkB,MAAM9D,EAAE2D,SAAS3D,EAAE2D,QAAQR,EAAEnD,EAAE2D,QAAQ3D,EAAE2D,QAAQ3D,EAAE2D,QAAQI,cAAc,GAAG,IAAI,UAAUC,KAAKT,EAAEU,KAAKC,UAAUjB,MAAMA,EAAEM,GAAG,MAAMhD,IAAI0C,EAAEK,EAAEa,MAAMb,EAAEa,MAAMlB,EAAEhD,GAAGmE,mBAAmBC,OAAOpB,IAAIqB,QAAQ,4DAA4DC,oBAAoBtE,GAAGA,GAAGA,EAAEmE,mBAAmBC,OAAOpE,KAAKqE,QAAQ,2BAA2BC,qBAAqBD,QAAQ,UAAUE,QAAQ,IAAIzE,EAAE,GAAG,IAAI,IAAI8B,KAAK7B,EAAEA,EAAE6B,KAAK9B,GAAG,KAAK8B,GAAE,IAAK7B,EAAE6B,KAAK9B,GAAG,IAAIC,EAAE6B,KAAK,OAAO2B,SAASiB,OAAOxE,EAAE,IAAIgD,EAAElD,EAAEE,IAAIsD,EAAE,IAAI,IAAI,IAAInE,EAAEoE,SAASiB,OAAOjB,SAASiB,OAAOC,MAAM,MAAM,GAAG5F,EAAE,mBAAmB6F,EAAE,EAAEA,EAAEvF,EAAEe,OAAOwE,IAAI,CAAC,IAAIC,EAAExF,EAAEuF,GAAGD,MAAM,KAAKG,EAAED,EAAEE,MAAM,GAAGC,KAAK,KAAKvF,KAAKwF,MAAM,MAAMH,EAAEI,OAAO,KAAKJ,EAAEA,EAAEC,MAAM,GAAG,IAAI,IAAI,IAAI/C,EAAE6C,EAAE,GAAGN,QAAQxF,EAAEyF,oBAAoB,GAAGM,EAAEvB,EAAE4B,KAAK5B,EAAE4B,KAAKL,EAAE9C,GAAGuB,EAAEuB,EAAE9C,IAAI8C,EAAEP,QAAQxF,EAAEyF,oBAAoB/E,KAAKwF,KAAK,IAAIH,EAAEZ,KAAKkB,MAAMN,GAAG,MAAMtE,IAAI,GAAGN,IAAI8B,EAAE,CAACwB,EAAEsB,EAAE,MAAM5E,IAAIsD,EAAExB,GAAG8C,GAAG,MAAMtE,KAAK,OAAOgD,GAAG,OAAOzD,EAAEsF,IAAItF,EAAEA,EAAEuF,IAAI,SAAS9E,GAAG,OAAOT,EAAEM,KAAKN,EAAES,IAAIT,EAAEwF,QAAQ,WAAW,OAAOxF,EAAEO,MAAM,CAAC2E,MAAK,GAAI,GAAGF,MAAM1E,KAAKF,aAAaJ,EAAE4D,SAAS,GAAG5D,EAAEyF,OAAO,SAAStF,EAAEqD,GAAGxD,EAAEG,EAAE,GAAGM,EAAE+C,EAAE,CAACK,SAAS,MAAM7D,EAAE0F,cAAcvF,EAAEH,EAASG,EAAE,gBAA7hDwF,EAAAC,QAAenF,4GC0C9IoF,SAAW,SAACC,GAChB,IACMC,EADYD,EAAMlB,MAAM,KAAK,GACVJ,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAC1D,OAAOL,KAAKkB,MAAMW,OAAOC,KAAKF,KAG1BG,QAAU,UAEhBC,kBAAA,SAAgBC,EAAkBzB,EAAgB0B,GAChD,IAwBIC,EAnBEC,EAAa,WACjB,IAAMC,EAAqBJ,EAAQK,QAAQP,SAC3C,GAAIM,EAAoB,CACtB,IAAME,EAA+BvC,KAAKkB,MAAMmB,GAChD,GATmB,SAACE,GAEtB,OADYC,EAAOD,GACN,EAOPE,CAAeF,GACjB,OAAA5G,SAAAA,SAAA,GAAY4G,GAAa,CAAEZ,MAAOnB,EAAOY,IAAI,mBAIjD,OAAO,MA6CHoB,EAAS,SAACE,GACd,QADc,IAAAA,IAAAA,EAAkCN,MAC3CM,EACH,OAAQ,EAEV,IAAMC,EAAMC,KAAKC,MAAMlD,KAAKgD,MAAQ,KACpC,OAAOC,KAAKC,MAAOH,EAAUI,aAAeH,EAAOD,EAAUK,WAQ/D,MAAO,CACLX,WAAUA,EACV1G,OAhDa,SACbsH,EACAC,GAEA,IAGItB,EACAmB,EAhBoBI,EAAkBC,EAYpCC,EAAkBH,GAAWA,EAAQG,iBAAmB,EACxDL,GAAWE,MAAAA,OAAO,EAAPA,EAASF,WAAY,EAKtC,GAA2B,iBAAhBC,EAA0B,CAEnC,IAAMK,EAAc3B,SADpBC,EAAQqB,GAERF,EAAeO,EAAYC,IArBLJ,EAuBW,IAAIvD,KAAuB,IAAlB0D,EAAYC,KAvBdH,EAuB2BF,MAAAA,OAAO,EAAPA,EAASE,mBAA5EhB,EAvBqF,CACvF3C,KAAO0C,GAAuB,IAC9BqB,OAAqC,WAA7B1B,OAAO2B,SAASC,SACxB/D,QAASyD,OAAqBO,EAAYR,GAqBxC1C,EAAOW,IAAI,gBAAiBQ,EAAOQ,QAGnCR,OAAQ+B,EACRZ,EAAeE,EAGjB,IAAMT,EAA+B,CACnCO,aAAYA,EACZC,SAAQA,EACRY,aAAcV,MAAAA,OAAO,EAAPA,EAASU,aACvBP,eAAcA,GAGhB,OADAnB,EAAQ2B,QAAQ7B,QAAS/B,KAAKC,UAAUsC,IACxC5G,SAAAA,SAAA,GAAY4G,GAAa,CAAEZ,MAAKA,KAmBhCa,OAAMA,EACNqB,QATc,WACd5B,EAAQ6B,WAAW/B,SACnBvB,EAAOc,OAAO,gBAAiBa,MCpH7B4B,iBAAmB,IACnBC,wBAA0B,oBAEhC,SAASC,eAAeC,GACtB,IAAMC,EAAuBH,wBAA0BE,EACjDE,EAAkBC,eAAe/B,QAAQ6B,GACzCxB,EAAM,IAAIhD,KACV2E,EAAgB3B,EAAI7C,cAC1B,GAAIsE,EAAiB,CACnB,IAAMG,EAAkB,IAAI5E,KAAKyE,GACjC,GAAIzB,EAAI6B,UAAYD,EAAgBC,UAAYT,iBAE9C,OADAM,eAAeP,WAAWK,IACnB,EAIX,OADAE,eAAeT,QAAQO,EAAsBG,IACtC,EAGT,SAASG,cAAcP,GACrB,OAA0B,IAAtBA,EAAI3H,QAAQ,QACY,IAAxB2H,EAAI3H,QAAQ,UACU,IAAtB2H,EAAI3H,QAAQ,QACU,IAAtB2H,EAAI3H,QAAQ,SACZ2H,EAAI3H,QAAQ,KAAO2H,EAAI3H,QAAQ,OAC/B2H,EAAI3H,QAAQ,OAAS2H,EAAI3H,QAAQ,QAIvC,SAASmI,UAAUR,EAAaV,GAC9B,QAD8B,IAAAA,IAAAA,EAAqB3B,OAAO2B,UACtDiB,cAAcP,GAAM,CACtB,IAAMhF,EAAI2C,OAAOtC,SAASoF,cAAc,KACxCzF,EAAE0F,KAAOV,EACT,IAAMW,EAAS3F,EAAE4F,OAEjB,OADA5F,EAAEoC,SACKuD,EAET,OAAOrB,EAASsB,OAGX,IAAMC,WAAa,SAACb,EAAaV,GAEtC,YAFsC,IAAAA,IAAAA,EAAqB3B,OAAO2B,UACnDkB,UAAUR,EAAKV,KACZA,EAASsB,iBAGbE,qBAAqBC,EAAqBzB,GACxD,QADwD,IAAAA,IAAAA,EAAqB3B,OAAO2B,WAChFuB,WAAWE,EAAazB,IAA6B,KAAhByB,EAAzC,CAGA,IAAM/F,EAAI2C,OAAOtC,SAASoF,cAAc,KACxCzF,EAAE0F,KAAOK,EACT/F,EAAEuE,SAAWD,EAASC,SACtBvE,EAAEgG,KAAO1B,EAAS0B,KAEd1B,EAAS2B,OACXjG,EAAEiG,KAAO3B,EAAS2B,MAEpB,IAAMP,EAAO1F,EAAE0F,KAEf,OADA1F,EAAEoC,SACKsD,GAGF,IAAMQ,SAAqB,SAChCH,EACAI,EACA7B,GAEA,QAHA,IAAA6B,IAAAA,EAAA,mBACA,IAAA7B,IAAAA,EAAqB3B,OAAO2B,UAExBS,eAAegB,GASjB,OARAK,QAAQC,MACN,oBACEN,EACA,+CACAlB,iBACA,sDAEJsB,IAKF,IAAMG,EAAgBR,qBAAqBC,EAAazB,GACnDgC,EAILhC,EAASnD,QAAQmF,GAHfF,QAAQC,MAAME,kCAMZA,gCACJ,8EAEWC,mBAAqB,SAACC,EAAsBC,GACvD,IAAIb,WAAWa,GAIf,OAAUD,GAAgBA,EAAapJ,QAAQ,MAAQ,EAAI,IAAM,KAAI,YAAYqJ,EAH/EN,QAAQO,KAAKJ,2CChFDK,YAAYC,EAA0BC,EAAsBxF,GAC1E,MAAO,CACLyF,QAASF,EACTG,OAAMA,OACNC,oBAAmBA,oBACnBH,UAASA,EACTxF,OAAMA,EACN4E,SAAQA,SACRM,mBAAkBA,mBAClBX,WAAUA,YAId,IAAMqB,QAAU,SAACC,GACf,OAAAtL,OAAOuL,KAAKD,GAAKE,KAAkC,SAACC,GAAQ,MAAA,CAACA,EAAKH,EAAIG,QAElEC,eAAiB,SAACC,GACtB,YAAahD,IAAbgD,EAAM,IAEKR,OAAS,SAACS,GAMrB,OALcP,QAAQO,GACKC,OAAyBH,gBACvBF,KAAI,SAACM,OAACL,EAAGK,EAAA,GAAE1J,EAAK0J,EAAA,GAC3C,OAAG1G,mBAAmBqG,GAAI,IAAIrG,mBAAmBhD,MAEpC2D,KAAK,MAGTqF,oBAAsB,SAACK,GAClC,IAAMM,EAAa3G,mBAAmBqG,GAAKnG,QAAQ,YAAa,QAChE,OAAOC,mBACLuB,OAAO2B,SAASuD,OAAO1G,QACrB,IAAI2G,OACF,eAAeF,EAAU,uBAAwB,KAChD,QAOIG,eAAiB,SAACC,GAC7BC,YAAW,WACTD,GAAS,WACPD,eAAeC,QAEhB,MCzDCE,iBAAmB,SACnBC,iBAAmB,WAEnBC,iBAAmB,aACnBC,iBAAmB,eAEnBC,sBAAwB,SAC5BC,EAA6C1C,GAC7C,OAAO,SAAC2C,EAA+BrK,GACrC,OAAIqK,EAAWxD,KAAOa,EAAW2C,EAAWxD,KACnC7G,EAAKqK,GAEPrK,EAAI1B,SAAAA,SAAA,GACN+L,GAAU,CACbC,QAASF,EAAaC,EAAWC,SAAW,SAKlDC,wBAAA,SAAgBC,EAAsB9C,GAoBpC,OAAOyC,uBAnBc,SAACG,WACdG,EAA6BD,EAAUT,kBAC7C,GAAIU,EACF,OAAAnM,SAAAA,SAAA,GACKgM,KAAOd,EAAA,IACTQ,kBAAmBS,EAAMjB,IAI9B,IAAMkB,EAA6BF,EAAUP,kBAC7C,OAAIS,EACFpM,SAAAA,SAAA,GACKgM,KAAOK,EAAA,IACTT,kBAAmBQ,EAAMC,IAIvBL,IAEkC5C,IClCvCkD,WAAa,SACjBC,EACAC,EACA3F,EACA4F,GAGA,IAAMC,EAAkC,SAACC,GACvC,IAAMC,EAAM/F,IACR+F,EAAML,EACJK,EAAM,GACJJ,EAAUK,MACZL,EAAUK,KAAKD,GAEjBD,MAEAH,EAAUM,MACVL,EAAIM,KAGNP,EAAUQ,QACVP,EAAIM,KAKFA,EAA0C,SAACJ,GAC/C,IAAMC,EAAM/F,IACR+F,GAAO,GAAKA,GAAOL,GACrBC,EAAUS,QACNT,EAAUK,MACZL,EAAUK,KAAKD,GAEjBH,EAAIC,IAEJC,KAIJF,EAAIM,IAGNG,gBAAA,SACErG,EACAsG,GAEA,IAAIC,GAAgB,EAEpB,OAAO,SAACZ,GACN,GAAIY,EACF,MAAM,IAAIC,MAAM,0CAElBD,GAAgB,EAChB,IAAMb,EACJY,GACGX,EAAUD,UACV,GAUL,OAFAD,WAAWC,EAAUC,EAAW3F,GANpB,SAAC0E,GACP6B,GACF9B,eAAeC,MAMZ,WACL6B,GAAgB,KC3EhBE,aAAe,SAAC/B,EAAsBrF,GAC1C,IAAIqH,GAAkB,EACtB,IACE,IAAMC,EAAOpO,OAAOqO,eAAe,GAAI,UAAW,CAChDhI,IAAK,WACH8H,GAAkB,KAGtBrH,EAAOwH,iBAAiB,cAAeF,EAAMA,GAC7CtH,EAAOyH,oBAAoB,cAAeH,EAAMA,GAChD,MAAO7M,IACT,IAAM2G,GAAUiG,GAAkB,CAAEK,SAAS,EAAMC,SAAS,GAE5D3H,EAAOtC,SAAS8J,iBAAiB,YAAanC,EAAUjE,GACxDpB,EAAOtC,SAAS8J,iBAAiB,YAAanC,EAAUjE,GACxDpB,EAAOtC,SAAS8J,iBAAiB,UAAWnC,EAAUjE,GACtDpB,EAAOtC,SAAS8J,iBAAiB,aAAcnC,EAAUjE,GACzDpB,EAAOtC,SAAS8J,iBAAiB,YAAanC,EAAUjE,IAG1DwG,sBAAA,SACEjH,EACAkH,EACAC,EACAC,EACA/H,GAEA,IAAIgI,EAAqBlK,KAAKgD,MAC1BmH,GAAoB,EAQlBC,EAAmB,WAAe,OAAAL,GALhC/G,EAAuBC,KAAKC,MAAMlD,KAAKgD,MAAQ,KAC/CqH,EAAwBpH,KAAKC,MAAMgH,EAAa,KAC/CjH,KAAKC,MAAMF,EAAMqH,IAHI,IACtBrH,EACAqH,GA+BR,OArBAf,cAJkB,WAChBY,EAAalK,KAAKgD,QAGId,GAExBoF,gBAAe,SAACqB,GACVyB,KAAsB,EACxBH,EAAO/H,EAAO2B,SAASoB,OAIrBpC,IAAW,GACRsH,IACHA,GAAoB,EACpBH,KAGFG,GAAoB,EAElBtH,IAAW,GACb8F,QAIGyB,YC+GOE,WACdC,EACAC,EACAC,EACArE,EACAC,EACAqE,EACAC,GAEA,IAAMC,EAAQzE,YAAYC,EAAaC,EAAWxF,QAClD4J,EAAiBI,IAAIhD,wBAAsBiD,iBAAAA,IAAYF,EAAMxF,aAE7D,IACM2F,EAAWP,EAAgBD,EADjBlI,kBAAkBqC,eAAgB7D,OAAQ6J,EAAUM,YACdJ,EAAOF,EAAWC,GAEpEI,EAASE,aACXR,EAAiBI,IAAIE,EAASE,aAGhC,IAAMC,EAAUlP,SAAAA,SAAA,GACX+O,GAAQ,CACXI,OAAQZ,IAGV,GAAIQ,EAASK,WAEX,IADwBV,EAAUW,iBACVd,EAAWR,uBAAyBgB,EAASf,SAAWe,EAASd,OAAQ,CAC/F,IAAMqB,EAAgBxB,sBACpBiB,EAASK,WACTb,EAAWR,sBACXgB,EAASf,QACTe,EAASd,OACT/H,QAEFgJ,EAAQK,SAAWrC,gBAAgBoC,EAAef,EAAWpB,wBAE7D+B,EAAQK,SAAWrC,gBAAgB6B,EAASK,WAAYb,EAAWpB,mBAIvE,OAAO+B,EC9MT;;;;;;;;;CCFA,WAGE,IAAIM,MAAQ,wBACRC,OAA2B,iBAAXvJ,OAChBwJ,KAAOD,OAASvJ,OAAS,GACzBwJ,KAAKC,sBACPF,QAAS,GAEX,IAAIG,YAAcH,QAA0B,iBAATI,KAC/BC,SAAWJ,KAAKK,sBAA2C,iBAAZC,SAAwBA,QAAQC,UAAYD,QAAQC,SAASC,KAC5GJ,QACFJ,KAAOS,eACEP,aACTF,KAAOG,MAET,IAAIO,WAAaV,KAAKW,wBAAwDxK,OAAOC,QAEjFwK,cAAgBZ,KAAKa,2BAAoD,oBAAhBC,YACzDC,UAAY,mBAAmB3L,MAAM,IACrC4L,MAAQ,EAAE,WAAY,QAAS,MAAO,KACtCC,MAAQ,CAAC,GAAI,GAAI,EAAG,GACpBC,EAAI,CACN,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WACpF,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UACpF,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UACpF,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WACpF,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAElFC,aAAe,CAAC,MAAO,QAAS,SAAU,eAE1CC,OAAS,IAETpB,KAAKK,sBAAyBxQ,MAAMwR,UACtCxR,MAAMwR,QAAU,SAAUrG,GACxB,MAA+C,mBAAxCtL,OAAOU,UAAUkR,SAASxQ,KAAKkK,MAItC4F,eAAiBZ,KAAKuB,mCAAsCT,YAAYU,SAC1EV,YAAYU,OAAS,SAAUxG,GAC7B,MAAsB,iBAARA,GAAoBA,EAAIyG,QAAUzG,EAAIyG,OAAOtR,cAAgB2Q,cAI/E,IAAIY,mBAAqB,SAAUC,EAAYC,GAC7C,OAAO,SAAUC,GACf,OAAO,IAAIC,OAAOF,GAAO,GAAMG,OAAOF,GAASF,OAI/CK,aAAe,SAAUJ,GAC3B,IAAIK,EAASP,mBAAmB,MAAOE,GACnCxB,UACF6B,EAASC,SAASD,EAAQL,IAE5BK,EAAO5R,OAAS,WACd,OAAO,IAAIyR,OAAOF,IAEpBK,EAAOF,OAAS,SAAUF,GACxB,OAAOI,EAAO5R,SAAS0R,OAAOF,IAEhC,IAAK,IAAInR,EAAI,EAAGA,EAAIyQ,aAAatQ,SAAUH,EAAG,CAC5C,IAAIyR,EAAOhB,aAAazQ,GACxBuR,EAAOE,GAAQT,mBAAmBS,EAAMP,GAE1C,OAAOK,GAGLC,SAAW,SAAUD,OAAQL,OAC/B,IAAIQ,OAASC,KAAK,qBACdC,OAASD,KAAK,4BACdE,UAAYX,MAAQ,SAAW,SAC/BY,WAAa,SAAUX,GACzB,GAAuB,iBAAZA,EACT,OAAOO,OAAOK,WAAWF,WAAWR,OAAOF,EAAS,QAAQa,OAAO,OAEnE,GAAIb,MAAAA,EACF,MAAM,IAAIlE,MAAMmC,OAKpB,OAJa+B,EAAQ1R,cAAgB2Q,cACjCe,EAAU,IAAIc,WAAWd,IAGzBhS,MAAMwR,QAAQQ,IAAYf,YAAYU,OAAOK,IAC/CA,EAAQ1R,cAAgBmS,OACjBF,OAAOK,WAAWF,WAAWR,OAAO,IAAIO,OAAOT,IAAUa,OAAO,OAEhET,OAAOJ,IAGlB,OAAOW,YAGLI,uBAAyB,SAAUjB,EAAYC,GACjD,OAAO,SAAUzG,EAAK0G,GACpB,OAAO,IAAIgB,WAAW1H,EAAKyG,GAAO,GAAMG,OAAOF,GAASF,OAIxDmB,iBAAmB,SAAUlB,GAC/B,IAAIK,EAASW,uBAAuB,MAAOhB,GAC3CK,EAAO5R,OAAS,SAAU8K,GACxB,OAAO,IAAI0H,WAAW1H,EAAKyG,IAE7BK,EAAOF,OAAS,SAAU5G,EAAK0G,GAC7B,OAAOI,EAAO5R,OAAO8K,GAAK4G,OAAOF,IAEnC,IAAK,IAAInR,EAAI,EAAGA,EAAIyQ,aAAatQ,SAAUH,EAAG,CAC5C,IAAIyR,EAAOhB,aAAazQ,GACxBuR,EAAOE,GAAQS,uBAAuBT,EAAMP,GAE9C,OAAOK,GAGT,SAASH,OAAOF,EAAOmB,GACjBA,GACF3B,OAAO,GAAKA,OAAO,IAAMA,OAAO,GAAKA,OAAO,GAAKA,OAAO,GACtDA,OAAO,GAAKA,OAAO,GAAKA,OAAO,GAAKA,OAAO,GAC3CA,OAAO,GAAKA,OAAO,GAAKA,OAAO,IAAMA,OAAO,IAC5CA,OAAO,IAAMA,OAAO,IAAMA,OAAO,IAAMA,OAAO,IAAM,EACtDlR,KAAKkR,OAASA,QAEdlR,KAAKkR,OAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAG7DQ,GACF1R,KAAK8S,GAAK,WACV9S,KAAK+S,GAAK,UACV/S,KAAKgT,GAAK,UACVhT,KAAKiT,GAAK,WACVjT,KAAKkT,GAAK,WACVlT,KAAKmT,GAAK,WACVnT,KAAKoT,GAAK,WACVpT,KAAKqT,GAAK,aAEVrT,KAAK8S,GAAK,WACV9S,KAAK+S,GAAK,WACV/S,KAAKgT,GAAK,WACVhT,KAAKiT,GAAK,WACVjT,KAAKkT,GAAK,WACVlT,KAAKmT,GAAK,WACVnT,KAAKoT,GAAK,UACVpT,KAAKqT,GAAK,YAGZrT,KAAKsT,MAAQtT,KAAKqN,MAAQrN,KAAKuT,MAAQvT,KAAKwT,OAAS,EACrDxT,KAAKyT,UAAYzT,KAAK0T,QAAS,EAC/B1T,KAAK2T,OAAQ,EACb3T,KAAK0R,MAAQA,EA4Qf,SAASiB,WAAW1H,EAAKyG,EAAOmB,GAC9B,IAAIrS,EAAGyR,SAAchH,EACrB,GAAa,WAATgH,EAAmB,CACrB,IAAgD2B,EAA5CL,EAAQ,GAAI5S,EAASsK,EAAItK,OAAQkT,EAAQ,EAC7C,IAAKrT,EAAI,EAAGA,EAAIG,IAAUH,GACxBoT,EAAO3I,EAAI6I,WAAWtT,IACX,IACT+S,EAAMM,KAAWD,EACRA,EAAO,MAChBL,EAAMM,KAAY,IAAQD,GAAQ,EAClCL,EAAMM,KAAY,IAAe,GAAPD,GACjBA,EAAO,OAAUA,GAAQ,OAClCL,EAAMM,KAAY,IAAQD,GAAQ,GAClCL,EAAMM,KAAY,IAASD,GAAQ,EAAK,GACxCL,EAAMM,KAAY,IAAe,GAAPD,IAE1BA,EAAO,QAAoB,KAAPA,IAAiB,GAA6B,KAAtB3I,EAAI6I,aAAatT,IAC7D+S,EAAMM,KAAY,IAAQD,GAAQ,GAClCL,EAAMM,KAAY,IAASD,GAAQ,GAAM,GACzCL,EAAMM,KAAY,IAASD,GAAQ,EAAK,GACxCL,EAAMM,KAAY,IAAe,GAAPD,GAG9B3I,EAAMsI,MACD,CACL,GAAa,WAATtB,EAWF,MAAM,IAAIxE,MAAMmC,OAVhB,GAAY,OAAR3E,EACF,MAAM,IAAIwC,MAAMmC,OACX,GAAIc,cAAgBzF,EAAIhL,cAAgB2Q,YAC7C3F,EAAM,IAAIwH,WAAWxH,QAChB,KAAKtL,MAAMwR,QAAQlG,IACnByF,cAAiBE,YAAYU,OAAOrG,IACvC,MAAM,IAAIwC,MAAMmC,OAQpB3E,EAAItK,OAAS,KACfsK,EAAM,IAAK2G,OAAOF,GAAO,GAAOG,OAAO5G,GAAK8I,SAG9C,IAAIC,EAAU,GAAIC,EAAU,GAC5B,IAAKzT,EAAI,EAAGA,EAAI,KAAMA,EAAG,CACvB,IAAIjB,EAAI0L,EAAIzK,IAAM,EAClBwT,EAAQxT,GAAK,GAAOjB,EACpB0U,EAAQzT,GAAK,GAAOjB,EAGtBqS,OAAOhR,KAAKZ,KAAM0R,EAAOmB,GAEzB7S,KAAK6R,OAAOoC,GACZjU,KAAKgU,QAAUA,EACfhU,KAAKkU,OAAQ,EACblU,KAAK6S,aAAeA,EAjUtBjB,OAAO1R,UAAU2R,OAAS,SAAUF,GAClC,IAAI3R,KAAKyT,UAAT,CAGA,IAAIU,EAAWlC,SAAcN,EAC7B,GAAa,WAATM,EAAmB,CACrB,GAAa,WAATA,EAWF,MAAM,IAAIxE,MAAMmC,OAVhB,GAAgB,OAAZ+B,EACF,MAAM,IAAIlE,MAAMmC,OACX,GAAIc,cAAgBiB,EAAQ1R,cAAgB2Q,YACjDe,EAAU,IAAIc,WAAWd,QACpB,KAAKhS,MAAMwR,QAAQQ,IACnBjB,cAAiBE,YAAYU,OAAOK,IACvC,MAAM,IAAIlE,MAAMmC,OAMtBuE,GAAY,EAId,IAFA,IAAIP,EAAiBpT,EAAXqT,EAAQ,EAAMlT,EAASgR,EAAQhR,OAAQuQ,EAASlR,KAAKkR,OAExD2C,EAAQlT,GAAQ,CAUrB,GATIX,KAAK0T,SACP1T,KAAK0T,QAAS,EACdxC,EAAO,GAAKlR,KAAKsT,MACjBpC,EAAO,IAAMA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC1CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC3CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,IAAMA,EAAO,IAC5CA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAM,GAGpDiD,EACF,IAAK3T,EAAIR,KAAKqN,MAAOwG,EAAQlT,GAAUH,EAAI,KAAMqT,EAC/C3C,EAAO1Q,GAAK,IAAMmR,EAAQkC,IAAU9C,MAAY,EAANvQ,UAG5C,IAAKA,EAAIR,KAAKqN,MAAOwG,EAAQlT,GAAUH,EAAI,KAAMqT,GAC/CD,EAAOjC,EAAQmC,WAAWD,IACf,IACT3C,EAAO1Q,GAAK,IAAMoT,GAAQ7C,MAAY,EAANvQ,KACvBoT,EAAO,MAChB1C,EAAO1Q,GAAK,KAAO,IAAQoT,GAAQ,IAAO7C,MAAY,EAANvQ,KAChD0Q,EAAO1Q,GAAK,KAAO,IAAe,GAAPoT,IAAiB7C,MAAY,EAANvQ,MACzCoT,EAAO,OAAUA,GAAQ,OAClC1C,EAAO1Q,GAAK,KAAO,IAAQoT,GAAQ,KAAQ7C,MAAY,EAANvQ,KACjD0Q,EAAO1Q,GAAK,KAAO,IAASoT,GAAQ,EAAK,KAAU7C,MAAY,EAANvQ,KACzD0Q,EAAO1Q,GAAK,KAAO,IAAe,GAAPoT,IAAiB7C,MAAY,EAANvQ,OAElDoT,EAAO,QAAoB,KAAPA,IAAiB,GAAqC,KAA9BjC,EAAQmC,aAAaD,IACjE3C,EAAO1Q,GAAK,KAAO,IAAQoT,GAAQ,KAAQ7C,MAAY,EAANvQ,KACjD0Q,EAAO1Q,GAAK,KAAO,IAASoT,GAAQ,GAAM,KAAU7C,MAAY,EAANvQ,KAC1D0Q,EAAO1Q,GAAK,KAAO,IAASoT,GAAQ,EAAK,KAAU7C,MAAY,EAANvQ,KACzD0Q,EAAO1Q,GAAK,KAAO,IAAe,GAAPoT,IAAiB7C,MAAY,EAANvQ,MAKxDR,KAAKoU,cAAgB5T,EACrBR,KAAKuT,OAAS/S,EAAIR,KAAKqN,MACnB7M,GAAK,IACPR,KAAKsT,MAAQpC,EAAO,IACpBlR,KAAKqN,MAAQ7M,EAAI,GACjBR,KAAKoL,OACLpL,KAAK0T,QAAS,GAEd1T,KAAKqN,MAAQ7M,EAOjB,OAJIR,KAAKuT,MAAQ,aACfvT,KAAKwT,QAAUxT,KAAKuT,MAAQ,YAAc,EAC1CvT,KAAKuT,MAAQvT,KAAKuT,MAAQ,YAErBvT,OAGT4R,OAAO1R,UAAUmU,SAAW,WAC1B,IAAIrU,KAAKyT,UAAT,CAGAzT,KAAKyT,WAAY,EACjB,IAAIvC,EAASlR,KAAKkR,OAAQ1Q,EAAIR,KAAKoU,cACnClD,EAAO,IAAMlR,KAAKsT,MAClBpC,EAAO1Q,GAAK,IAAMsQ,MAAU,EAAJtQ,GACxBR,KAAKsT,MAAQpC,EAAO,IAChB1Q,GAAK,KACFR,KAAK0T,QACR1T,KAAKoL,OAEP8F,EAAO,GAAKlR,KAAKsT,MACjBpC,EAAO,IAAMA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC1CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAC3CA,EAAO,GAAKA,EAAO,GAAKA,EAAO,IAAMA,EAAO,IAC5CA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAM,GAExDA,EAAO,IAAMlR,KAAKwT,QAAU,EAAIxT,KAAKuT,QAAU,GAC/CrC,EAAO,IAAMlR,KAAKuT,OAAS,EAC3BvT,KAAKoL,SAGPwG,OAAO1R,UAAUkL,KAAO,WACtB,IACqCxH,EAAG0Q,EAAIC,EAAIC,EAAKC,EAAYC,EAAIC,EAAIC,EAAIC,EADzElR,EAAI3D,KAAK8S,GAAIvT,EAAIS,KAAK+S,GAAIhP,EAAI/D,KAAKgT,GAAI1T,EAAIU,KAAKiT,GAAIlS,EAAIf,KAAKkT,GAAI7Q,EAAIrC,KAAKmT,GAAI5Q,EAAIvC,KAAKoT,GACzF0B,EAAI9U,KAAKqT,GAAInC,EAASlR,KAAKkR,OAE7B,IAAKtN,EAAI,GAAIA,EAAI,KAAMA,EAGrB0Q,IADAG,EAAKvD,EAAOtN,EAAI,OACF,EAAM6Q,GAAM,KAASA,IAAO,GAAOA,GAAM,IAAQA,IAAO,EAEtEF,IADAE,EAAKvD,EAAOtN,EAAI,MACF,GAAO6Q,GAAM,KAASA,IAAO,GAAOA,GAAM,IAAQA,IAAO,GACvEvD,EAAOtN,GAAKsN,EAAOtN,EAAI,IAAM0Q,EAAKpD,EAAOtN,EAAI,GAAK2Q,GAAM,EAI1D,IADAM,EAAKtV,EAAIwE,EACJH,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACnB5D,KAAK2T,OACH3T,KAAK0R,OACPgD,EAAK,OAELI,GADAL,EAAKvD,EAAO,GAAK,YACR,WAAa,EACtB5R,EAAImV,EAAK,UAAY,IAErBC,EAAK,UAELI,GADAL,EAAKvD,EAAO,GAAK,WACR,YAAc,EACvB5R,EAAImV,EAAK,WAAa,GAExBzU,KAAK2T,OAAQ,IAEbW,GAAO3Q,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAG9E6Q,GADAE,EAAK/Q,EAAIpE,GACGoE,EAAII,EAAK8Q,EAIrBC,EAAIxV,GAFJmV,EAAKK,GAJLP,GAAOxT,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAGxEA,EAAIsB,GAAOtB,EAAIwB,GACFyO,EAAEpN,GAAKsN,EAAOtN,KAEnB,EACdtE,EAAImV,GAFCH,EAAKE,IAEK,GAEjBF,GAAOhV,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAG9EkV,GADAG,EAAKrV,EAAIqE,GACGrE,EAAIC,EAAKmV,EAIrBnS,EAAIwB,GAFJ0Q,EAAKlS,GAJLgS,GAAOO,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAGxEA,EAAI/T,GAAO+T,EAAIzS,GACF2O,EAAEpN,EAAI,GAAKsN,EAAOtN,EAAI,KAE3B,EAEd0Q,IADAvQ,EAAI0Q,GAFCH,EAAKE,IAEK,KACF,EAAMzQ,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAG9EyQ,GADAI,EAAK7Q,EAAIzE,GACGyE,EAAIJ,EAAKgR,EAIrBtS,EAAI9C,GAFJkV,EAAKpS,GAJLkS,GAAOhS,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAGxEA,EAAIuS,GAAOvS,EAAIxB,GACFiQ,EAAEpN,EAAI,GAAKsN,EAAOtN,EAAI,KAE3B,EAEd0Q,IADA/U,EAAIkV,GAFCH,EAAKE,IAEK,KACF,EAAMjV,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,IAG9EiV,GADAK,EAAKtV,EAAIwE,GACGxE,EAAID,EAAKsV,EAIrB7T,EAAI4C,GAFJ8Q,EAAK1T,GAJLwT,GAAOlS,IAAM,EAAMA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAASA,IAAM,GAAOA,GAAK,KAGxEA,EAAIE,GAAOF,EAAIyS,GACF9D,EAAEpN,EAAI,GAAKsN,EAAOtN,EAAI,KAE3B,EACdD,EAAI8Q,GAFCH,EAAKE,IAEK,EAGjBxU,KAAK8S,GAAK9S,KAAK8S,GAAKnP,GAAK,EACzB3D,KAAK+S,GAAK/S,KAAK+S,GAAKxT,GAAK,EACzBS,KAAKgT,GAAKhT,KAAKgT,GAAKjP,GAAK,EACzB/D,KAAKiT,GAAKjT,KAAKiT,GAAK3T,GAAK,EACzBU,KAAKkT,GAAKlT,KAAKkT,GAAKnS,GAAK,EACzBf,KAAKmT,GAAKnT,KAAKmT,GAAK9Q,GAAK,EACzBrC,KAAKoT,GAAKpT,KAAKoT,GAAK7Q,GAAK,EACzBvC,KAAKqT,GAAKrT,KAAKqT,GAAKyB,GAAK,GAG3BlD,OAAO1R,UAAU6U,IAAM,WACrB/U,KAAKqU,WAEL,IAAIvB,EAAK9S,KAAK8S,GAAIC,EAAK/S,KAAK+S,GAAIC,EAAKhT,KAAKgT,GAAIC,EAAKjT,KAAKiT,GAAIC,EAAKlT,KAAKkT,GAAIC,EAAKnT,KAAKmT,GAClFC,EAAKpT,KAAKoT,GAAIC,EAAKrT,KAAKqT,GAEtB0B,EAAMlE,UAAWiC,GAAM,GAAM,IAAQjC,UAAWiC,GAAM,GAAM,IAC9DjC,UAAWiC,GAAM,GAAM,IAAQjC,UAAWiC,GAAM,GAAM,IACtDjC,UAAWiC,GAAM,GAAM,IAAQjC,UAAWiC,GAAM,EAAK,IACrDjC,UAAWiC,GAAM,EAAK,IAAQjC,UAAe,GAALiC,GACxCjC,UAAWkC,GAAM,GAAM,IAAQlC,UAAWkC,GAAM,GAAM,IACtDlC,UAAWkC,GAAM,GAAM,IAAQlC,UAAWkC,GAAM,GAAM,IACtDlC,UAAWkC,GAAM,GAAM,IAAQlC,UAAWkC,GAAM,EAAK,IACrDlC,UAAWkC,GAAM,EAAK,IAAQlC,UAAe,GAALkC,GACxClC,UAAWmC,GAAM,GAAM,IAAQnC,UAAWmC,GAAM,GAAM,IACtDnC,UAAWmC,GAAM,GAAM,IAAQnC,UAAWmC,GAAM,GAAM,IACtDnC,UAAWmC,GAAM,GAAM,IAAQnC,UAAWmC,GAAM,EAAK,IACrDnC,UAAWmC,GAAM,EAAK,IAAQnC,UAAe,GAALmC,GACxCnC,UAAWoC,GAAM,GAAM,IAAQpC,UAAWoC,GAAM,GAAM,IACtDpC,UAAWoC,GAAM,GAAM,IAAQpC,UAAWoC,GAAM,GAAM,IACtDpC,UAAWoC,GAAM,GAAM,IAAQpC,UAAWoC,GAAM,EAAK,IACrDpC,UAAWoC,GAAM,EAAK,IAAQpC,UAAe,GAALoC,GACxCpC,UAAWqC,GAAM,GAAM,IAAQrC,UAAWqC,GAAM,GAAM,IACtDrC,UAAWqC,GAAM,GAAM,IAAQrC,UAAWqC,GAAM,GAAM,IACtDrC,UAAWqC,GAAM,GAAM,IAAQrC,UAAWqC,GAAM,EAAK,IACrDrC,UAAWqC,GAAM,EAAK,IAAQrC,UAAe,GAALqC,GACxCrC,UAAWsC,GAAM,GAAM,IAAQtC,UAAWsC,GAAM,GAAM,IACtDtC,UAAWsC,GAAM,GAAM,IAAQtC,UAAWsC,GAAM,GAAM,IACtDtC,UAAWsC,GAAM,GAAM,IAAQtC,UAAWsC,GAAM,EAAK,IACrDtC,UAAWsC,GAAM,EAAK,IAAQtC,UAAe,GAALsC,GACxCtC,UAAWuC,GAAM,GAAM,IAAQvC,UAAWuC,GAAM,GAAM,IACtDvC,UAAWuC,GAAM,GAAM,IAAQvC,UAAWuC,GAAM,GAAM,IACtDvC,UAAWuC,GAAM,GAAM,IAAQvC,UAAWuC,GAAM,EAAK,IACrDvC,UAAWuC,GAAM,EAAK,IAAQvC,UAAe,GAALuC,GAO1C,OANKpT,KAAK0R,QACRqD,GAAOlE,UAAWwC,GAAM,GAAM,IAAQxC,UAAWwC,GAAM,GAAM,IAC3DxC,UAAWwC,GAAM,GAAM,IAAQxC,UAAWwC,GAAM,GAAM,IACtDxC,UAAWwC,GAAM,GAAM,IAAQxC,UAAWwC,GAAM,EAAK,IACrDxC,UAAWwC,GAAM,EAAK,IAAQxC,UAAe,GAALwC,IAErC0B,GAGTnD,OAAO1R,UAAUkR,SAAWQ,OAAO1R,UAAU6U,IAE7CnD,OAAO1R,UAAUsS,OAAS,WACxBxS,KAAKqU,WAEL,IAAIvB,EAAK9S,KAAK8S,GAAIC,EAAK/S,KAAK+S,GAAIC,EAAKhT,KAAKgT,GAAIC,EAAKjT,KAAKiT,GAAIC,EAAKlT,KAAKkT,GAAIC,EAAKnT,KAAKmT,GAClFC,EAAKpT,KAAKoT,GAAIC,EAAKrT,KAAKqT,GAEtB2B,EAAM,CACPlC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,EACvDC,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,GAK1D,OAHKpT,KAAK0R,OACRsD,EAAI1R,KAAM+P,GAAM,GAAM,IAAOA,GAAM,GAAM,IAAOA,GAAM,EAAK,IAAW,IAALA,GAE5D2B,GAGTpD,OAAO1R,UAAU6T,MAAQnC,OAAO1R,UAAUsS,OAE1CZ,OAAO1R,UAAU+U,YAAc,WAC7BjV,KAAKqU,WAEL,IAAI9C,EAAS,IAAIX,YAAY5Q,KAAK0R,MAAQ,GAAK,IAC3CwD,EAAW,IAAIC,SAAS5D,GAW5B,OAVA2D,EAASE,UAAU,EAAGpV,KAAK8S,IAC3BoC,EAASE,UAAU,EAAGpV,KAAK+S,IAC3BmC,EAASE,UAAU,EAAGpV,KAAKgT,IAC3BkC,EAASE,UAAU,GAAIpV,KAAKiT,IAC5BiC,EAASE,UAAU,GAAIpV,KAAKkT,IAC5BgC,EAASE,UAAU,GAAIpV,KAAKmT,IAC5B+B,EAASE,UAAU,GAAIpV,KAAKoT,IACvBpT,KAAK0R,OACRwD,EAASE,UAAU,GAAIpV,KAAKqT,IAEvB9B,GA6DToB,WAAWzS,UAAY,IAAI0R,OAE3Be,WAAWzS,UAAUmU,SAAW,WAE9B,GADAzC,OAAO1R,UAAUmU,SAASzT,KAAKZ,MAC3BA,KAAKkU,MAAO,CACdlU,KAAKkU,OAAQ,EACb,IAAImB,EAAYrV,KAAK+T,QACrBnC,OAAOhR,KAAKZ,KAAMA,KAAK0R,MAAO1R,KAAK6S,cACnC7S,KAAK6R,OAAO7R,KAAKgU,SACjBhU,KAAK6R,OAAOwD,GACZzD,OAAO1R,UAAUmU,SAASzT,KAAKZ,QAInC,IAAIkG,QAAU4L,eACd5L,QAAQoP,OAASpP,QACjBA,QAAQqP,OAASzD,cAAa,GAC9B5L,QAAQoP,OAAOE,KAAO5C,mBACtB1M,QAAQqP,OAAOC,KAAO5C,kBAAiB,GAEnCpC,UACFvK,OAAAC,QAAiBA,SAEjB4J,KAAKwF,OAASpP,QAAQoP,OACtBxF,KAAKyF,OAASrP,QAAQqP,SArf1B,MDPAE,aAAqBC,WACrBC,cAAsBC,YACtBC,gBAAwBC,cAEpBC,OAAS,GACTC,UAAY,GACZC,IAA4B,oBAAfxD,WAA6BA,WAAa9S,MAEvDiU,KAAO,mEACFpT,EAAI,EAAG0V,IAAMtC,KAAKjT,OAAQH,EAAI0V,MAAO1V,EAC5CuV,OAAOvV,GAAKoT,KAAKpT,GACjBwV,UAAUpC,KAAKE,WAAWtT,IAAMA,EAQlC,SAAS2V,QAASC,GAChB,IAAIF,EAAME,EAAIzV,OAEd,GAAIuV,EAAM,EAAI,EACZ,MAAM,IAAIzI,MAAM,kDAKlB,IAAI4I,EAAWD,EAAIpV,QAAQ,KAO3B,OANkB,IAAdqV,IAAiBA,EAAWH,GAMzB,CAACG,EAJcA,IAAaH,EAC/B,EACA,EAAKG,EAAW,GAMtB,SAASX,WAAYU,GACnB,IAAIE,EAAOH,QAAQC,GACfC,EAAWC,EAAK,GAChBC,EAAkBD,EAAK,GAC3B,OAAuC,GAA9BD,EAAWE,GAAuB,EAAKA,EAGlD,SAASC,YAAaJ,EAAKC,EAAUE,GACnC,OAAuC,GAA9BF,EAAWE,GAAuB,EAAKA,EAGlD,SAASX,YAAaQ,GACpB,IAAIK,EAcAjW,EAbA8V,EAAOH,QAAQC,GACfC,EAAWC,EAAK,GAChBC,EAAkBD,EAAK,GAEvBtB,EAAM,IAAIiB,IAAIO,YAAYJ,EAAKC,EAAUE,IAEzCG,EAAU,EAGVR,EAAMK,EAAkB,EACxBF,EAAW,EACXA,EAGJ,IAAK7V,EAAI,EAAGA,EAAI0V,EAAK1V,GAAK,EACxBiW,EACGT,UAAUI,EAAItC,WAAWtT,KAAO,GAChCwV,UAAUI,EAAItC,WAAWtT,EAAI,KAAO,GACpCwV,UAAUI,EAAItC,WAAWtT,EAAI,KAAO,EACrCwV,UAAUI,EAAItC,WAAWtT,EAAI,IAC/BwU,EAAI0B,KAAcD,GAAO,GAAM,IAC/BzB,EAAI0B,KAAcD,GAAO,EAAK,IAC9BzB,EAAI0B,KAAmB,IAAND,EAmBnB,OAhBwB,IAApBF,IACFE,EACGT,UAAUI,EAAItC,WAAWtT,KAAO,EAChCwV,UAAUI,EAAItC,WAAWtT,EAAI,KAAO,EACvCwU,EAAI0B,KAAmB,IAAND,GAGK,IAApBF,IACFE,EACGT,UAAUI,EAAItC,WAAWtT,KAAO,GAChCwV,UAAUI,EAAItC,WAAWtT,EAAI,KAAO,EACpCwV,UAAUI,EAAItC,WAAWtT,EAAI,KAAO,EACvCwU,EAAI0B,KAAcD,GAAO,EAAK,IAC9BzB,EAAI0B,KAAmB,IAAND,GAGZzB,EAGT,SAAS2B,gBAAiBC,GACxB,OAAOb,OAAOa,GAAO,GAAK,IACxBb,OAAOa,GAAO,GAAK,IACnBb,OAAOa,GAAO,EAAI,IAClBb,OAAa,GAANa,GAGX,SAASC,YAAaC,EAAOzJ,EAAOH,GAGlC,IAFA,IAAIuJ,EACAM,EAAS,GACJvW,EAAI6M,EAAO7M,EAAI0M,EAAK1M,GAAK,EAChCiW,GACIK,EAAMtW,IAAM,GAAM,WAClBsW,EAAMtW,EAAI,IAAM,EAAK,QACP,IAAfsW,EAAMtW,EAAI,IACbuW,EAAOzT,KAAKqT,gBAAgBF,IAE9B,OAAOM,EAAOxR,KAAK,IAGrB,SAASuQ,cAAegB,GAQtB,IAPA,IAAIL,EACAP,EAAMY,EAAMnW,OACZqW,EAAad,EAAM,EACnBe,EAAQ,GACRC,EAAiB,MAGZ1W,EAAI,EAAG2W,EAAOjB,EAAMc,EAAYxW,EAAI2W,EAAM3W,GAAK0W,EACtDD,EAAM3T,KAAKuT,YAAYC,EAAOtW,EAAIA,EAAI0W,EAAkBC,EAAOA,EAAQ3W,EAAI0W,IAqB7E,OAjBmB,IAAfF,GACFP,EAAMK,EAAMZ,EAAM,GAClBe,EAAM3T,KACJyS,OAAOU,GAAO,GACdV,OAAQU,GAAO,EAAK,IACpB,OAEsB,IAAfO,IACTP,GAAOK,EAAMZ,EAAM,IAAM,GAAKY,EAAMZ,EAAM,GAC1Ce,EAAM3T,KACJyS,OAAOU,GAAO,IACdV,OAAQU,GAAO,EAAK,IACpBV,OAAQU,GAAO,EAAK,IACpB,MAIGQ,EAAM1R,KAAK,IAlIpByQ,UAAU,IAAIlC,WAAW,IAAM,GAC/BkC,UAAU,IAAIlC,WAAW,IAAM,uJE2C5BxN,OA1CSL,EAAAC,QA0CD,SAAUkR,EAAiBC,GAClC,GAAuB,oBAAZ7V,QACP,MAAMiM,MAAM,iHAGhB,IAAI6J,GAA2B,EAE/B,SAASC,IACAD,IACDA,GAA2B,EAC3BvN,QAAQO,KAAK,yOAIrB,SAASkN,EAAUjI,GACf,KAAMvP,gBAAgBwX,GAClB,OAAO,IAAIA,EAASjI,GAexB,IAZA,IACIkI,EAEAC,EAHAC,EAAK3X,KAEL4X,EAAe,GAGfC,EAAc,CACdC,QAAQ,EACRC,aAAc,GACdC,SAAU,GAGVC,EAAUjU,SAASkU,qBAAqB,UACnC1X,EAAI,EAAGA,EAAIyX,EAAQtX,OAAQH,KACgB,IAA3CyX,EAAQzX,GAAG2X,IAAInX,QAAQ,iBAAwE,IAA/CiX,EAAQzX,GAAG2X,IAAInX,QAAQ,qBAAsE,IAAxCiX,EAAQzX,GAAG2X,IAAInX,QAAQ,cAC7H2W,EAAGS,cAAgBH,EAAQzX,GAAG2X,IAAIE,UAAUJ,EAAQzX,GAAG2X,IAAInX,QAAQ,YAAc,GAAGkE,MAAM,KAAK,IAIvG,IAAIoT,GAAW,EACXC,EAAUC,EAAazO,QAAQ0O,MAC/BC,EAAUF,EAAazO,QAAQO,MAoRnC,SAASqO,EAAmBzC,GAExB,IAAInC,EAAQ,KACR7B,EAAS5L,OAAO4L,QAAU5L,OAAOsS,SACrC,GAAI1G,GAAUA,EAAO2G,iBAAmBvS,OAAOmM,WAG3C,OAFAsB,EAAQ,IAAItB,WAAWyD,GACvBhE,EAAO2G,gBAAgB9E,GAChBA,EAIXA,EAAQ,IAAIpU,MAAMuW,GAClB,IAAK,IAAItS,EAAI,EAAGA,EAAImQ,EAAMpT,OAAQiD,IAC9BmQ,EAAMnQ,GAAKyD,KAAKC,MAAM,IAAMD,KAAKyR,UAErC,OAAO/E,EAGX,SAASgF,EAAqB7C,GAC1B,OAAO8C,EAAqB9C,EAAK,kEAGrC,SAAS8C,EAAqB9C,EAAK+C,GAG/B,IAFA,IAAIC,EAAaP,EAAmBzC,GAChCiD,EAAQ,IAAIxZ,MAAMuW,GACb1V,EAAI,EAAGA,EAAI0V,EAAK1V,IACrB2Y,EAAM3Y,GAAKyY,EAASnF,WAAWoF,EAAW1Y,GAAKyY,EAAStY,QAE5D,OAAOkE,OAAOuU,aAAavY,MAAM,KAAMsY,GAG3C,SAASE,EAAsBC,EAAYC,GACvC,OAAQD,GAEJ,IAAK,OAED,IAAIE,EAAY,IAAI/G,WAAW2E,EAAgBnC,YAAYsE,IAK3D,OAJkBlC,EAAkBvB,cAAc0D,GAC7C1U,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,IAExB,QACI,KAAM,gCAuTlB,SAAS2U,IACL,YAAgC,IAArB9B,EAAG+B,cACkD,KAAxD/B,EAAG+B,cAAcjU,OAAOkS,EAAG+B,cAAc/Y,OAAS,GAC3CgX,EAAG+B,cAAgB,UAAY9U,mBAAmB+S,EAAGgC,OAErDhC,EAAG+B,cAAgB,WAAa9U,mBAAmB+S,EAAGgC,YAGpE,EAIL,SAASxQ,IACL,OAAK7C,OAAO2B,SAASsB,OAGVjD,OAAO2B,SAASsB,OAFhBjD,OAAO2B,SAASC,SAAW,KAAO5B,OAAO2B,SAAS2R,UAAYtT,OAAO2B,SAAS2B,KAAO,IAAMtD,OAAO2B,SAAS2B,KAAM,IAMhI,SAASiQ,EAAgBC,EAAOC,GAC5B,IAAInG,EAAOkG,EAAMlG,KACb5J,EAAQ8P,EAAM9P,MACdgQ,EAASF,EAAME,OAEfC,GAAY,IAAI7V,MAAO6E,UAM3B,GAJI6Q,EAAwB,kBACxBnC,EAAGuC,gBAAkBvC,EAAGuC,eAAeJ,EAAwB,kBAG/D9P,EACA,GAAc,QAAVgQ,EAAkB,CAClB,IAAIG,EAAY,CAAEnQ,MAAOA,EAAOoQ,kBAAmBN,EAAMM,mBACzDzC,EAAG0C,aAAe1C,EAAG0C,YAAYF,GACjCJ,GAAWA,EAAQO,SAASH,QAE5BJ,GAAWA,EAAQQ,kBAO3B,GAJuB,YAAX5C,EAAG6C,OAAwBV,EAAMW,cAAgBX,EAAMY,WAC/DC,EAAYb,EAAMW,aAAc,KAAMX,EAAMY,UAAU,GAG1C,YAAX/C,EAAG6C,MAAuB5G,EAAM,CACjC,IAAIgH,EAAS,QAAUhH,EAAO,iCAC1BjL,EAAMgP,EAAGkD,UAAUzU,QAEnB0U,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAQrS,GAAK,GACtBmS,EAAIG,iBAAiB,eAAgB,qCAErCL,GAAU,cAAgBhW,mBAAmB+S,EAAGuD,UAChDN,GAAU,iBAAmBd,EAAMqB,YAE/BrB,EAAMsB,mBACNR,GAAU,kBAAoBd,EAAMsB,kBAGxCN,EAAIO,iBAAkB,EAEtBP,EAAIQ,mBAAqB,WACrB,GAAsB,GAAlBR,EAAIS,WACJ,GAAkB,KAAdT,EAAIU,OAAe,CAEnB,IAAIC,EAAgBhX,KAAKkB,MAAMmV,EAAIY,cACnCf,EAAYc,EAA4B,aAAGA,EAA6B,cAAGA,EAAwB,SAAe,aAAZ9D,EAAG6C,MACzGmB,SAEAhE,EAAG0C,aAAe1C,EAAG0C,cACrBN,GAAWA,EAAQO,YAK/BQ,EAAIc,KAAKhB,GAGb,SAASD,EAAYkB,EAAazT,EAAc0T,EAASC,GAGrDC,EAASH,EAAazT,EAAc0T,EAFpC7B,GAAaA,GAAY,IAAI7V,MAAO6E,WAAa,GAI7CqP,IAAcX,EAAGsE,aAAetE,EAAGsE,YAAYC,OAASpC,EAAMqC,aAC7DxE,EAAGyE,oBAAsBzE,EAAGyE,mBAAmBF,OAASpC,EAAMqC,aAC9DxE,EAAG0E,eAAiB1E,EAAG0E,cAAcH,OAASpC,EAAMqC,cAErD5D,EAAQ,4CACRZ,EAAG2E,aACHvC,GAAWA,EAAQO,YAEfyB,IACApE,EAAG4E,eAAiB5E,EAAG4E,gBACvBxC,GAAWA,EAAQQ,eAOnC,SAASiC,EAAW7T,GAChB,IACI8T,EADA1C,EAAU2C,IASd,SAASC,EAAkBC,GAkCnBjF,EAAGkD,UAjCD+B,EAiCa,CACXC,UAAW,WACP,OAAOD,EAAkBE,wBAE7B1W,MAAO,WACH,OAAOwW,EAAkBG,gBAE7B1O,OAAQ,WACJ,IAAKuO,EAAkBI,qBACnB,KAAM,mCAEV,OAAOJ,EAAkBI,sBAE7BC,mBAAoB,WAChB,IAAKL,EAAkBM,qBACnB,KAAM,mCAEV,OAAON,EAAkBM,sBAE7BvN,SAAU,WACN,KAAM,2EAEVwN,SAAU,WACN,IAAKP,EAAkBQ,kBACnB,KAAM,mCAEV,OAAOR,EAAkBQ,oBA1DlB,CACXP,UAAW,WACP,OAAOpD,IAAgB,iCAE3BrT,MAAO,WACH,OAAOqT,IAAgB,kCAE3BpL,OAAQ,WACJ,OAAOoL,IAAgB,mCAE3BwD,mBAAoB,WAChB,IAAI9E,EAAMsB,IAAgB,oDAI1B,OAHI9B,EAAGS,gBACLD,EAAMA,EAAM,YAAcR,EAAGS,eAExBD,GAEXkF,wBAAyB,WACrB,IAAIlF,EAAMsB,IAAgB,iDAI1B,OAHI9B,EAAGS,gBACHD,EAAMA,EAAM,YAAcR,EAAGS,eAE1BD,GAEXxI,SAAU,WACN,OAAO8J,IAAgB,0CAE3B0D,SAAU,WACN,OAAO1D,IAAgB,sCAoCvC,GAxEKlK,EAEwB,iBAAXA,IACdkN,EAAYlN,GAFZkN,EAAY,gBAuEZA,GACI3B,EAAM,IAAIC,gBACVC,KAAK,MAAOyB,GAAW,GAC3B3B,EAAIG,iBAAiB,SAAU,oBAE/BH,EAAIQ,mBAAqB,WACrB,GAAsB,GAAlBR,EAAIS,WACJ,GAAkB,KAAdT,EAAIU,QAAiB8B,EAAWxC,GAAM,CACtC,IAAIvL,EAAS9K,KAAKkB,MAAMmV,EAAIY,cAE5B/D,EAAG+B,cAAgBnK,EAAO,mBAC1BoI,EAAGgC,MAAQpK,EAAc,MACzBoI,EAAGuD,SAAW3L,EAAiB,SAC/BoN,EAAkB,MAClB5C,EAAQQ,kBAERR,EAAQO,YAKpBQ,EAAIc,WACD,CACH,IAAKrM,EAAO2L,SACR,KAAM,mBAGVvD,EAAGuD,SAAW3L,EAAO2L,SAErB,IAAIqC,EAAehO,EAAqB,aACxC,GAAKgO,EAkBE,CAEC,IAAIC,EAMA1C,EAPoB,iBAAjByC,GAGHC,EADgD,KAAhDD,EAAa9X,OAAO8X,EAAa5c,OAAS,GAClB4c,EAAe,mCAEfA,EAAe,qCAEvCzC,EAAM,IAAIC,gBACVC,KAAK,MAAOwC,GAAuB,GACvC1C,EAAIG,iBAAiB,SAAU,oBAE/BH,EAAIQ,mBAAqB,WACC,GAAlBR,EAAIS,aACc,KAAdT,EAAIU,QAAiB8B,EAAWxC,IAEhC6B,EADyBlY,KAAKkB,MAAMmV,EAAIY,eAExC3B,EAAQQ,cAERR,EAAQO,aAKpBQ,EAAIc,SAEJe,EAAkBY,GAClBxD,EAAQQ,kBA7CG,CACf,IAAKhL,EAAY,IAEb,IADA,IAAI0I,EAAUjU,SAASkU,qBAAqB,UACnC1X,EAAI,EAAGA,EAAIyX,EAAQtX,OAAQH,IAChC,GAAIyX,EAAQzX,GAAG2X,IAAIsF,MAAM,kBAAmB,CACxClO,EAAO5G,IAAMsP,EAAQzX,GAAG2X,IAAIuF,OAAO,EAAGzF,EAAQzX,GAAG2X,IAAInX,QAAQ,oBAC7D,MAIZ,IAAKuO,EAAOoK,MACR,KAAM,gBAGVhC,EAAG+B,cAAgBnK,EAAO5G,IAC1BgP,EAAGgC,MAAQpK,EAAOoK,MAClBgD,EAAkB,MAClB5C,EAAQQ,cAiChB,OAAOR,EAAQA,QAGnB,SAASuD,EAAWK,GAChB,OAAqB,GAAdA,EAAInC,QAAemC,EAAIjC,cAAgBiC,EAAIC,YAAYC,WAAW,SAG7E,SAAS7B,EAAS5V,EAAOgC,EAAc0T,EAAS7B,GAsB5C,GArBItC,EAAGmG,qBACHC,aAAapG,EAAGmG,oBAChBnG,EAAGmG,mBAAqB,MAGxB1V,GACAuP,EAAGvP,aAAeA,EAClBuP,EAAGyE,mBAAqB4B,EAAY5V,YAE7BuP,EAAGvP,oBACHuP,EAAGyE,oBAGVN,GACAnE,EAAGmE,QAAUA,EACbnE,EAAG0E,cAAgB2B,EAAYlC,YAExBnE,EAAGmE,eACHnE,EAAG0E,eAGVjW,GAaA,GAZAuR,EAAGvR,MAAQA,EACXuR,EAAGsE,YAAc+B,EAAY5X,GAC7BuR,EAAGsG,UAAYtG,EAAGsE,YAAYiC,cAC9BvG,EAAGwG,eAAgB,EACnBxG,EAAGyG,QAAUzG,EAAGsE,YAAYoC,IAC5B1G,EAAG2G,YAAc3G,EAAGsE,YAAYsC,aAChC5G,EAAG6G,eAAiB7G,EAAGsE,YAAYwC,gBAE/BxE,IACAtC,EAAGnQ,SAAWH,KAAKC,MAAM2S,EAAY,KAAQtC,EAAGsE,YAAYyC,KAG7C,MAAf/G,EAAGnQ,WACH+Q,EAAQ,sEAAwEZ,EAAGnQ,SAAW,YAE1FmQ,EAAGgH,gBAAgB,CACnB,IAAIC,EAAoF,KAAvEjH,EAAGsE,YAAiB,KAAK,IAAI7X,MAAO6E,UAAY,IAAQ0O,EAAGnQ,UAC5E+Q,EAAQ,+BAAiClR,KAAKwX,MAAMD,EAAY,KAAQ,MACpEA,GAAa,EACbjH,EAAGgH,iBAEHhH,EAAGmG,mBAAqBlS,WAAW+L,EAAGgH,eAAgBC,gBAK3DjH,EAAGvR,aACHuR,EAAGsE,mBACHtE,EAAGyG,eACHzG,EAAG2G,mBACH3G,EAAG6G,eAEV7G,EAAGwG,eAAgB,EAI3B,SAASH,EAAYc,GAKjB,QADAA,GADAA,GAFAA,EAAMA,EAAI5Z,MAAM,KAAK,IAEXJ,QAAQ,KAAM,MACdA,QAAQ,KAAM,MACZnE,OAAS,GACjB,KAAK,EACD,MACJ,KAAK,EACDme,GAAO,KACP,MACJ,KAAK,EACDA,GAAO,IACP,MACJ,QACI,KAAM,gBAMd,OAHAA,EAAM/Z,mBAAmBC,OAAOuB,KAAKuY,KAErCA,EAAMra,KAAKkB,MAAMmZ,GAIrB,SAASC,IACL,IAAIC,EAAY,mBACZze,EAAIyY,EAAqB,GAAIgG,GAAW9Z,MAAM,IAKlD,OAJA3E,EAAE,IAAM,IACRA,EAAE,IAAMye,EAAUtB,OAAgB,EAARnd,EAAE,IAAa,EAAK,GAC9CA,EAAE,GAAKA,EAAE,IAAMA,EAAE,IAAMA,EAAE,IAAM,IACpBA,EAAEgF,KAAK,IAItB,SAAS0Z,EAActW,GACnB,IAAImR,EAAQoF,EAAiBvW,GAC7B,GAAKmR,EAAL,CAIA,IAAIqF,EAAazH,EAAgB7R,IAAIiU,EAAMsF,OAU3C,OARID,IACArF,EAAMuF,OAAQ,EACdvF,EAAMqB,YAAcgE,EAAWhE,YAC/BrB,EAAMqC,YAAcgD,EAAWjD,MAC/BpC,EAAME,OAASmF,EAAWnF,OAC1BF,EAAMsB,iBAAmB+D,EAAW/D,kBAGjCtB,GAGX,SAASoF,EAAiBvW,GACtB,IAAI2W,EACJ,OAAQ3H,EAAG6C,MACP,IAAK,WACD8E,EAAkB,CAAC,OAAQ,QAAS,gBAAiB,oBACrD,MACJ,IAAK,WACDA,EAAkB,CAAC,eAAgB,aAAc,WAAY,QAAS,gBAAiB,aAAc,oBACrG,MACJ,IAAK,SACDA,EAAkB,CAAC,eAAgB,aAAc,WAAY,OAAQ,QAAS,gBAAiB,aAAc,oBAIrHA,EAAgBhc,KAAK,SACrBgc,EAAgBhc,KAAK,qBACrBgc,EAAgBhc,KAAK,aAErB,IAGIic,EACAC,EAJAC,EAAa9W,EAAI3H,QAAQ,KACzB0e,EAAgB/W,EAAI3H,QAAQ,KAsBhC,GAjBwB,UAApB2W,EAAGgI,eAA4C,IAAhBF,GAC/BF,EAAS5W,EAAI0P,UAAU,EAAGoH,GAEE,MAD5BD,EAASI,EAAoBjX,EAAI0P,UAAUoH,EAAa,GAAsB,IAAnBC,EAAuBA,EAAgB/W,EAAIhI,QAAS2e,IACpGO,eACPN,GAAU,IAAMC,EAAOK,eAEJ,IAAnBH,IACAH,GAAU5W,EAAI0P,UAAUqH,KAED,aAApB/H,EAAGgI,eAAkD,IAAnBD,IACzCH,EAAS5W,EAAI0P,UAAU,EAAGqH,GAEE,MAD5BF,EAASI,EAAoBjX,EAAI0P,UAAUqH,EAAgB,GAAIJ,IACpDO,eACPN,GAAU,IAAMC,EAAOK,eAI3BL,GAAUA,EAAOM,YACjB,GAAgB,aAAZnI,EAAG6C,MAAmC,WAAZ7C,EAAG6C,MAC7B,IAAKgF,EAAOM,YAAYlM,MAAQ4L,EAAOM,YAAY9V,QAAUwV,EAAOM,YAAYV,MAE5E,OADAI,EAAOM,YAAYP,OAASA,EACrBC,EAAOM,iBAEf,GAAgB,aAAZnI,EAAG6C,OACLgF,EAAOM,YAAYrF,cAAgB+E,EAAOM,YAAY9V,QAAUwV,EAAOM,YAAYV,MAEpF,OADAI,EAAOM,YAAYP,OAASA,EACrBC,EAAOM,YAM9B,SAASF,EAAoBC,EAAcP,GAMvC,IALA,IAAI1f,EAAIigB,EAAa3a,MAAM,KACvBlD,EAAS,CACT6d,aAAc,GACdC,YAAa,IAERtf,EAAI,EAAGA,EAAIZ,EAAEe,OAAQH,IAAK,CAC/B,IAAI0E,EAAQtF,EAAEY,GAAGQ,QAAQ,KACrBiK,EAAMrL,EAAEY,GAAG8E,MAAM,EAAGJ,IACc,IAAlCoa,EAAgBte,QAAQiK,GACxBjJ,EAAO8d,YAAY7U,GAAOrL,EAAEY,GAAG8E,MAAMJ,EAAQ,IAEjB,KAAxBlD,EAAO6d,eACP7d,EAAO6d,cAAgB,KAE3B7d,EAAO6d,cAAgBjgB,EAAEY,IAGjC,OAAOwB,EAGX,SAAS0a,IAGL,IAAI9c,EAAI,CACJ2a,WAAY,SAASvY,GACjBpC,EAAE6B,QAAQO,IAGdsY,SAAU,SAAStY,GACfpC,EAAE8B,OAAOM,KA4BjB,OAzBApC,EAAEma,QAAU,IAAIvY,SAAQ,SAASC,EAASC,GACtC9B,EAAE6B,QAAUA,EACZ7B,EAAE8B,OAASA,KAGf9B,EAAEma,QAAQgG,QAAU,SAASpU,GAOzB,OANA4L,IAEAvX,KAAKkC,MAAK,SAAuBN,GAC7B+J,EAAS/J,MAGN5B,MAGXJ,EAAEma,QAAQ/P,MAAQ,SAAS2B,GAOvB,OANA4L,IAEAvX,KAAKggB,OAAM,SAAqBhW,GAC5B2B,EAAS3B,MAGNhK,MAGJJ,EAIX,SAASqgB,EAAsBlG,EAASmG,EAASC,GAC7C,IAAIC,EAAgB,KAChBC,EAAiB,IAAI7e,SAAQ,SAAUC,EAASC,GAChD0e,EAAgBxU,YAAW,WACvBlK,EAAO,CAAEsI,MAASmW,GAAgB,4CAA8CD,EAAU,SAC3FA,MAGP,OAAO1e,QAAQ8e,KAAK,CAACvG,EAASsG,IAAiBE,SAAQ,WACnDxC,aAAaqC,MAIrB,SAASI,IACL,IAAIzG,EAAU2C,IAEd,IAAK7E,EAAYC,OAEb,OADAiC,EAAQQ,aACDR,EAAQA,QAGnB,GAAIlC,EAAY4I,OAEZ,OADA1G,EAAQQ,aACDR,EAAQA,QAGnB,IAAI0G,EAASzc,SAASoF,cAAc,UACpCyO,EAAY4I,OAASA,EAErBA,EAAOC,OAAS,WACZ,IAAIC,EAAUhJ,EAAGkD,UAAUgC,YACD,MAAtB8D,EAAQlb,OAAO,GACfoS,EAAY+I,aAAezX,IAE3B0O,EAAY+I,aAAeD,EAAQtI,UAAU,EAAGsI,EAAQ3f,QAAQ,IAAK,IAEzE+Y,EAAQQ,cAGZ,IAAIpC,EAAMR,EAAGkD,UAAUoC,qBACvBwD,EAAOI,aAAa,MAAO1I,GAC3BsI,EAAOI,aAAa,QAAS,2BAC7BJ,EAAOK,MAAMC,QAAU,OACvB/c,SAAS5B,KAAK4e,YAAYP,GAE1B,IAAIQ,EAAkB,SAASC,GAC3B,GAAKA,EAAM3X,SAAWsO,EAAY+I,cAAkB/I,EAAY4I,OAAOU,gBAAkBD,EAAME,SAI3E,aAAdF,EAAMG,MAAqC,WAAdH,EAAMG,MAAmC,SAAdH,EAAMG,MAApE,CAKkB,aAAdH,EAAMG,MACN1J,EAAG2E,aAKP,IAFA,IAAIgF,EAAYzJ,EAAYE,aAAawJ,OAAO,EAAG1J,EAAYE,aAAapX,QAEnEH,EAAI8gB,EAAU3gB,OAAS,EAAGH,GAAK,IAAKA,EAAG,CAC5C,IAAIuZ,EAAUuH,EAAU9gB,GACN,SAAd0gB,EAAMG,KACNtH,EAAQO,WAERP,EAAQQ,WAAyB,aAAd2G,EAAMG,SAOrC,OAFA/a,OAAOwH,iBAAiB,UAAWmT,GAAiB,GAE7ClH,EAAQA,QAGnB,SAAS4B,IACD9D,EAAYC,QACRH,EAAGvR,OACHwF,YAAW,WACP4V,IAAmBtf,MAAK,SAASuf,GACzBA,GACA9F,SAGc,IAAvB9D,EAAYG,UAK3B,SAASwJ,IACL,IAAIzH,EAAU2C,IAEd,GAAI7E,EAAY4I,QAAU5I,EAAY+I,aAAe,CACjD,IAAIc,EAAM/J,EAAGuD,SAAW,KAAOvD,EAAGsG,UAAYtG,EAAGsG,UAAY,IAC7DpG,EAAYE,aAAazU,KAAKyW,GAC9B,IAAIxQ,EAASsO,EAAY+I,aACc,GAAnC/I,EAAYE,aAAapX,QACzBkX,EAAY4I,OAAOU,cAAcQ,YAAYD,EAAKnY,QAGtDwQ,EAAQQ,aAGZ,OAAOR,EAAQA,QAGnB,SAAS6H,IACL,IAAI7H,EAAU2C,IAEd,GAAI7E,EAAYC,QAAUH,EAAGkK,0BAA2B,CACpD,IAAIpB,EAASzc,SAASoF,cAAc,UACpCqX,EAAOI,aAAa,MAAOlJ,EAAGkD,UAAUwC,2BACxCoD,EAAOI,aAAa,QAAS,4BAC7BJ,EAAOK,MAAMC,QAAU,OACvB/c,SAAS5B,KAAK4e,YAAYP,GAE1B,IAAIQ,EAAkB,SAASC,GACvBT,EAAOU,gBAAkBD,EAAME,SAIhB,cAAfF,EAAMG,MAAuC,gBAAfH,EAAMG,OAEd,gBAAfH,EAAMG,OACbxJ,EAAYC,QAAS,EACjBH,EAAGmK,yBACHnK,EAAGkK,2BAA4B,GAEnCnJ,EAAQ,4HAIZ1U,SAAS5B,KAAK2f,YAAYtB,GAC1Bna,OAAOyH,oBAAoB,UAAWkT,GACtClH,EAAQQ,gBAGZjU,OAAOwH,iBAAiB,UAAWmT,GAAiB,QAEpDlH,EAAQQ,aAGZ,OAAO0F,EAAsBlG,EAAQA,QAASpC,EAAGqK,sBAAuB,4DAG5E,SAASC,EAAYhQ,GACjB,IAAKA,GAAgB,WAARA,EACT,MAAO,CACHiQ,MAAO,SAASxa,GAEZ,OADApB,OAAO2B,SAASnD,QAAQ6S,EAAGwK,eAAeza,IACnCgV,IAAgB3C,SAG3B1L,OAAQ,SAAS3G,GAEb,OADApB,OAAO2B,SAASnD,QAAQ6S,EAAGyK,gBAAgB1a,IACpCgV,IAAgB3C,SAG3BpK,SAAU,SAASjI,GAEf,OADApB,OAAO2B,SAASnD,QAAQ6S,EAAG0K,kBAAkB3a,IACtCgV,IAAgB3C,SAG3BuI,kBAAoB,WAChB,IAAIC,EAAa5K,EAAG6K,mBACpB,QAA0B,IAAfD,EAGP,KAAM,mCAEV,OAJIjc,OAAO2B,SAASoB,KAAOkZ,EAIpB7F,IAAgB3C,SAG3BoB,YAAa,SAASzT,EAAS+a,GAK3B,OAAI/a,GAAWA,EAAQyT,YACZzT,EAAQyT,YACRxD,EAAGwD,YACHxD,EAAGwD,YAEHlT,SAASoB,OAMhC,GAAY,WAAR4I,EAAmB,CACnB4F,EAAYC,QAAS,EACrB,IAAI4K,EAA2B,SAASC,EAAUC,EAAQlb,GACtD,OAAIpB,OAAOuc,SAAWvc,OAAOuc,QAAQC,aAE1Bxc,OAAOuc,QAAQC,aAAa9H,KAAK2H,EAAUC,EAAQlb,GAEnDpB,OAAO0U,KAAK2H,EAAUC,EAAQlb,IAIzCqb,EAA6B,SAAUC,GACvC,OAAIA,GAAeA,EAAYC,eACpBzjB,OAAOuL,KAAKiY,EAAYC,gBAAgBC,QAAO,SAAUxb,EAASyb,GAErE,OADAzb,EAAQyb,GAAcH,EAAYC,eAAeE,GAC1Czb,IACR,IAEI,IAIX0b,EAAuB,SAAUH,GACjC,OAAOzjB,OAAOuL,KAAKkY,GAAgBC,QAAO,SAAUxb,EAASyb,GAEzD,OADAzb,EAAQpE,KAAK6f,EAAW,IAAIF,EAAeE,IACpCzb,IACR,IAAInC,KAAK,MAGZ8d,EAAuB,SAAUL,GACjC,IAAIC,EAAiBF,EAA2BC,GAKhD,OAJAC,EAAehb,SAAW,KACtB+a,GAAqC,QAAtBA,EAAYhJ,SAC3BiJ,EAAeK,OAAS,OAErBF,EAAqBH,IAGhC,MAAO,CACHf,MAAO,SAASxa,GACZ,IAAIqS,EAAU2C,IAEVuG,EAAiBI,EAAqB3b,GACtCib,EAAWhL,EAAGwK,eAAeza,GAC7B6b,EAAMb,EAAyBC,EAAU,SAAUM,GACnDO,GAAY,EAEZC,GAAS,EACTC,EAAe,WACfD,GAAS,EACTF,EAAII,SAkCR,OA/BAJ,EAAIzV,iBAAiB,aAAa,SAASoT,GACM,GAAzCA,EAAMvY,IAAI3H,QAAQ,sBAElB6Y,EADeoF,EAAciC,EAAMvY,KACToR,GAC1B2J,IACAF,GAAY,MAIpBD,EAAIzV,iBAAiB,aAAa,SAASoT,GAClCsC,IAC4C,GAAzCtC,EAAMvY,IAAI3H,QAAQ,qBAElB6Y,EADeoF,EAAciC,EAAMvY,KACToR,GAC1B2J,IACAF,GAAY,IAEZzJ,EAAQO,WACRoJ,SAKZH,EAAIzV,iBAAiB,QAAQ,SAASoT,GAC7BuC,GACD1J,EAAQO,SAAS,CACbsJ,OAAQ,sBAKb7J,EAAQA,SAGnB1L,OAAQ,SAAS3G,GACb,IAKIsC,EALA+P,EAAU2C,IAEVmH,EAAYlM,EAAGyK,gBAAgB1a,GAC/B6b,EAAMb,EAAyBmB,EAAW,SAAU,yCA4BxD,OAxBAN,EAAIzV,iBAAiB,aAAa,SAASoT,GACM,GAAzCA,EAAMvY,IAAI3H,QAAQ,qBAClBuiB,EAAII,WAIZJ,EAAIzV,iBAAiB,aAAa,SAASoT,GACM,GAAzCA,EAAMvY,IAAI3H,QAAQ,sBAGlBgJ,GAAQ,GAFRuZ,EAAII,WAOZJ,EAAIzV,iBAAiB,QAAQ,SAASoT,GAC9BlX,EACA+P,EAAQO,YAER3C,EAAG2E,aACHvC,EAAQQ,iBAITR,EAAQA,SAGnBpK,SAAW,SAASjI,GAChB,IAAIqS,EAAU2C,IACVoH,EAAcnM,EAAG0K,oBACjBY,EAAiBI,EAAqB3b,GACtC6b,EAAMb,EAAyBoB,EAAa,SAAUb,GAQ1D,OAPAM,EAAIzV,iBAAiB,aAAa,SAASoT,GACM,GAAzCA,EAAMvY,IAAI3H,QAAQ,sBAClBuiB,EAAII,QAEJ9J,EADYoF,EAAciC,EAAMvY,KACToR,OAGxBA,EAAQA,SAGnBuI,kBAAoB,WAChB,IAAIC,EAAa5K,EAAG6K,mBACpB,QAA0B,IAAfD,EAQP,KAAM,mCAPN,IAAIgB,EAAMb,EAAyBH,EAAY,SAAU,eACzDgB,EAAIzV,iBAAiB,aAAa,SAASoT,GACM,GAAzCA,EAAMvY,IAAI3H,QAAQ,qBAClBuiB,EAAII,YAQpBxI,YAAa,SAASzT,GAClB,MAAO,qBAKnB,GAAY,kBAARuK,EAGA,OAFA4F,EAAYC,QAAS,EAEd,CACHoK,MAAO,SAASxa,GACZ,IAAIqS,EAAU2C,IACViG,EAAWhL,EAAGwK,eAAeza,GAUjC,OARAqc,eAAeC,UAAU,YAAY,SAAS9C,GAC1C6C,eAAeE,YAAY,YAC3B3d,OAAOuc,QAAQqB,QAAQC,WAAWR,QAElC9J,EADYoF,EAAciC,EAAMvY,KACToR,MAG3BzT,OAAOuc,QAAQqB,QAAQC,WAAWC,QAAQzB,GACnC5I,EAAQA,SAGnB1L,OAAQ,SAAS3G,GACb,IAAIqS,EAAU2C,IACVmH,EAAYlM,EAAGyK,gBAAgB1a,GAUnC,OARAqc,eAAeC,UAAU,YAAY,SAAS9C,GAC1C6C,eAAeE,YAAY,YAC3B3d,OAAOuc,QAAQqB,QAAQC,WAAWR,QAClChM,EAAG2E,aACHvC,EAAQQ,gBAGZjU,OAAOuc,QAAQqB,QAAQC,WAAWC,QAAQP,GACnC9J,EAAQA,SAGnBpK,SAAW,SAASjI,GAChB,IAAIqS,EAAU2C,IACVoH,EAAcnM,EAAG0K,kBAAkB3a,GAQvC,OAPAqc,eAAeC,UAAU,YAAa,SAAS9C,GAC3C6C,eAAeE,YAAY,YAC3B3d,OAAOuc,QAAQqB,QAAQC,WAAWR,QAElC9J,EADYoF,EAAciC,EAAMvY,KACToR,MAE3BzT,OAAOuc,QAAQqB,QAAQC,WAAWC,QAAQN,GACnC/J,EAAQA,SAInBuI,kBAAoB,WAChB,IAAIC,EAAa5K,EAAG6K,mBACpB,QAA0B,IAAfD,EAGP,KAAM,mCAFNjc,OAAOuc,QAAQqB,QAAQC,WAAWC,QAAQ7B,IAMlDpH,YAAa,SAASzT,GAClB,OAAIA,GAAWA,EAAQyT,YACZzT,EAAQyT,YACRxD,EAAGwD,YACHxD,EAAGwD,YAEH,qBAMvB,KAAM,yBAA2BlJ,EAjgDrC0F,EAAG0M,KAAO,SAAUC,GAkBhB,GAjBA3M,EAAGwG,eAAgB,EAEnBzG,EAAkB6M,IAId9M,EADA6M,GAFW,CAAC,UAAW,UAAW,kBAEVtjB,QAAQsjB,EAAY7M,UAAY,EAC9CwK,EAAYqC,EAAY7M,SAC3B6M,GAA8C,iBAAxBA,EAAY7M,QAC/B6M,EAAY7M,QAElBnR,OAAOke,SAAWle,OAAOuc,QACfZ,EAAY,WAEZA,IAIdqC,EAAa,CAiBb,QAhBoC,IAAzBA,EAAYhM,WACnBA,EAAWgM,EAAYhM,eAGiB,IAAjCgM,EAAY9C,mBACnB3J,EAAYC,OAASwM,EAAY9C,kBAGjC8C,EAAYG,2BACZ5M,EAAYG,SAAWsM,EAAYG,0BAGZ,mBAAvBH,EAAYI,SACZ/M,EAAGgN,eAAgB,GAGnBL,EAAY3E,aAAc,CAC1B,GAAiC,UAA7B2E,EAAY3E,cAAyD,aAA7B2E,EAAY3E,aAGpD,KAAM,iCAFNhI,EAAGgI,aAAe2E,EAAY3E,aAMtC,GAAI2E,EAAY9J,KAAM,CAClB,OAAQ8J,EAAY9J,MAChB,IAAK,WACD7C,EAAGiN,aAAe,OAClB,MACJ,IAAK,WACDjN,EAAGiN,aAAe,iBAClB,MACJ,IAAK,SACDjN,EAAGiN,aAAe,sBAClB,MACJ,QACI,KAAM,yBAEdjN,EAAG6C,KAAO8J,EAAY9J,KAqB1B,GAlB4B,MAAxB8J,EAAY9c,WACZmQ,EAAGnQ,SAAW8c,EAAY9c,UAG3B8c,EAAYnJ,cACXxD,EAAGwD,YAAcmJ,EAAYnJ,aAG7BmJ,EAAYzC,4BACZlK,EAAGkK,0BAA4ByC,EAAYzC,2BAGG,kBAAvCyC,EAAYxC,uBACnBnK,EAAGmK,uBAAyBwC,EAAYxC,uBAExCnK,EAAGmK,wBAAyB,EAG5BwC,EAAYhL,WAAY,CACxB,GAA+B,SAA3BgL,EAAYhL,WACZ,KAAM,+BAEV3B,EAAG2B,WAAagL,EAAYhL,WAGS,kBAA9BgL,EAAYO,cACnBlN,EAAGkN,cAAgBP,EAAYO,cAE/BlN,EAAGkN,eAAgB,EAGU,iBAAtBP,EAAYQ,QACnBnN,EAAGmN,MAAQR,EAAYQ,OAGsB,iBAAtCR,EAAYtC,uBAAsCsC,EAAYtC,sBAAwB,EAC7FrK,EAAGqK,sBAAwBsC,EAAYtC,sBAEvCrK,EAAGqK,sBAAwB,IAI9BrK,EAAGgI,eACJhI,EAAGgI,aAAe,YAEjBhI,EAAGiN,eACJjN,EAAGiN,aAAe,OAClBjN,EAAG6C,KAAO,YAGd,IAAIT,EAAU2C,IAEVqI,EAAcrI,IAClBqI,EAAYhL,QAAQ7X,MAAK,WACrByV,EAAGqN,SAAWrN,EAAGqN,QAAQrN,EAAGwG,eAC5BpE,EAAQQ,WAAW5C,EAAGwG,kBACvB6B,OAAM,SAAShW,GACd+P,EAAQO,SAAStQ,MAGrB,IAAIib,EAAgBzI,IAEpB,SAASkI,IACL,IAAIQ,EAAU,SAASlL,GACdA,IACDtS,EAAQsS,OAAS,QAGrBrC,EAAGuK,MAAMxa,GAASxF,MAAK,WACnB6iB,EAAYxK,gBACbyF,OAAM,SAAUhW,GACf+a,EAAYzK,SAAStQ,OAIzBmb,EAAmB,WACnB,IAAIC,EAAOphB,SAASoF,cAAc,UAC9B+O,EAAMR,EAAGwK,eAAe,CAACnI,OAAQ,OAAQmB,YAAaxD,EAAGkK,4BAC7DuD,EAAKvE,aAAa,MAAO1I,GACzBiN,EAAKvE,aAAa,QAAS,6BAC3BuE,EAAKtE,MAAMC,QAAU,OACrB/c,SAAS5B,KAAK4e,YAAYoE,GAE1B,IAAInE,EAAkB,SAASC,GACvBA,EAAM3X,SAAWjD,OAAO2B,SAASsB,QAAU6b,EAAKjE,gBAAkBD,EAAME,SAK5EvH,EADYoF,EAAciC,EAAMG,MACT0D,GAEvB/gB,SAAS5B,KAAK2f,YAAYqD,GAC1B9e,OAAOyH,oBAAoB,UAAWkT,KAG1C3a,OAAOwH,iBAAiB,UAAWmT,IAGnCvZ,EAAU,GACd,OAAQ4c,EAAYI,QAChB,IAAK,YACG7M,EAAYC,OACZ0I,IAAwBte,MAAK,WACzBsf,IAAmBtf,MAAK,SAAUuf,GACzBA,EAGDsD,EAAYxK,aAFZ5C,EAAGkK,0BAA4BsD,IAAqBD,GAAQ,MAIjElF,OAAM,SAAUhW,GACf+a,EAAYzK,SAAStQ,SAI7B2N,EAAGkK,0BAA4BsD,IAAqBD,GAAQ,GAEhE,MACJ,IAAK,iBACDA,GAAQ,GACR,MACJ,QACI,KAAM,4BAIlB,SAASG,IACL,IAAI1Z,EAAWsT,EAAc3Y,OAAO2B,SAASoB,MAM7C,GAJIsC,GACArF,OAAOgf,QAAQC,aAAajf,OAAOgf,QAAQlG,MAAO,KAAMzT,EAAS4T,QAGjE5T,GAAYA,EAAS0T,MACrB,OAAOmB,IAAwBte,MAAK,WAChC2X,EAAgBlO,EAAUoZ,MAC3B/E,OAAM,SAAUhW,GACf+a,EAAYzK,SAAStQ,MAElBsa,EACHA,EAAYle,OAASke,EAAYlc,cACjC4T,EAASsI,EAAYle,MAAOke,EAAYlc,aAAckc,EAAYxI,SAE9DjE,EAAYC,OACZ0I,IAAwBte,MAAK,WACzBsf,IAAmBtf,MAAK,SAAUuf,GAC1BA,GACA9J,EAAG4E,eAAiB5E,EAAG4E,gBACvBwI,EAAYxK,aACZoB,KAEAoJ,EAAYxK,gBAEjByF,OAAM,SAAUhW,GACf+a,EAAYzK,SAAStQ,SAI7B2N,EAAG6N,aAAa,GAAGtjB,MAAK,WACpByV,EAAG4E,eAAiB5E,EAAG4E,gBACvBwI,EAAYxK,gBACbyF,OAAM,SAAShW,GACd2N,EAAG0C,aAAe1C,EAAG0C,cACjBiK,EAAYI,OACZA,IAEAK,EAAYzK,SAAStQ,OAI1Bsa,EAAYI,OACnBA,IAEAK,EAAYxK,aAGhBwK,EAAYxK,aAIpB,SAASkL,IACL,IAAI1L,EAAU2C,IAEVgJ,EAAkB,WACU,gBAAxB1hB,SAASuX,YAAwD,aAAxBvX,SAASuX,aAClDvX,SAAS+J,oBAAoB,mBAAoB2X,GACjD3L,EAAQQ,eAOhB,OAJAvW,SAAS8J,iBAAiB,mBAAoB4X,GAE9CA,IAEO3L,EAAQA,QAenB,OAZAkL,EAAc/iB,MAAK,WACfujB,IACKvjB,KAAK0f,GACL1f,KAAKmjB,GACLrF,OAAM,SAAUhW,GACb+P,EAAQO,SAAStQ,SAG7Bib,EAAcjF,OAAM,SAAUhW,GAC1B+P,EAAQO,SAAStQ,MAGd+P,EAAQA,SAGnBpC,EAAGuK,MAAQ,SAAUxa,GACjB,OAAO+P,EAAQyK,MAAMxa,IAkDzBiQ,EAAGwK,eAAiB,SAASza,GACzB,IAeIie,EAfAvG,EAAQL,IACR7C,EAAQ6C,IAER5D,EAAc1D,EAAQ0D,YAAYzT,GAElCke,EAAgB,CAChBxG,MAAOA,EACPlD,MAAOA,EACPf,YAAavW,mBAAmBuW,IAGhCzT,GAAWA,EAAQsS,SACnB4L,EAAc5L,OAAStS,EAAQsS,QAK/B2L,EADAje,GAA6B,YAAlBA,EAAQme,OACTlO,EAAGkD,UAAUlL,WAEbgI,EAAGkD,UAAUgC,YAG3B,IAAIiI,EAAQpd,GAAWA,EAAQod,OAASnN,EAAGmN,MACtCA,GAGmC,IAA7BA,EAAM9jB,QAAQ,YAErB8jB,EAAQ,UAAYA,GAHpBA,EAAQ,SAMZ,IAAInc,EAAMgd,EACJ,cAAgB/gB,mBAAmB+S,EAAGuD,UACtC,iBAAmBtW,mBAAmBuW,GACtC,UAAYvW,mBAAmBwa,GAC/B,kBAAoBxa,mBAAmB+S,EAAGgI,cAC1C,kBAAoB/a,mBAAmB+S,EAAGiN,cAC1C,UAAYhgB,mBAAmBkgB,GA6BrC,GA5BIxM,IACA3P,EAAMA,EAAM,UAAY/D,mBAAmBsX,IAG3CxU,GAAWA,EAAQsS,SACnBrR,GAAO,WAAa/D,mBAAmB8C,EAAQsS,SAG/CtS,GAAWA,EAAQoe,SACnBnd,GAAO,YAAc/D,mBAAmB8C,EAAQoe,SAGhDpe,GAAWA,EAAQqe,YACnBpd,GAAO,eAAiB/D,mBAAmB8C,EAAQqe,YAGnDre,GAAWA,EAAQse,UACnBrd,GAAO,gBAAkB/D,mBAAmB8C,EAAQse,UAGpDte,GAAWA,EAAQme,QAA4B,YAAlBne,EAAQme,SACrCld,GAAO,cAAgB/D,mBAAmB8C,EAAQme,SAGlDne,GAAWA,EAAQue,SACnBtd,GAAO,eAAiB/D,mBAAmB8C,EAAQue,SAGnDtO,EAAG2B,WAAY,CACf,IAAIC,EAAeR,EAAqB,IACxC6M,EAAcxK,iBAAmB7B,EAEjC5Q,GAAO,mBADa0Q,EAAsB1B,EAAG2B,WAAYC,GAEzD5Q,GAAO,0BAA4BgP,EAAG2B,WAK1C,OAFA5B,EAAgBzI,IAAI2W,GAEbjd,GAGXgP,EAAGtJ,OAAS,SAAS3G,GACjB,OAAO+P,EAAQpJ,OAAO3G,IAG1BiQ,EAAGyK,gBAAkB,SAAS1a,GAI1B,OAHUiQ,EAAGkD,UAAUxM,SACjB,iBAAmBzJ,mBAAmB6S,EAAQ0D,YAAYzT,GAAS,KAK7EiQ,EAAGhI,SAAW,SAAUjI,GACpB,OAAO+P,EAAQ9H,SAASjI,IAG5BiQ,EAAG0K,kBAAoB,SAAS3a,GAK5B,OAJKA,IACDA,EAAU,IAEdA,EAAQme,OAAS,WACVlO,EAAGwK,eAAeza,IAG7BiQ,EAAG6K,iBAAmB,SAAS9a,GAC3B,IAAIiS,EAAQF,IACR9Q,OAAMR,EAOV,YANqB,IAAVwR,IACPhR,EAAMgR,EAAAA,qBAEW/U,mBAAmB+S,EAAGuD,UACrC,iBAAmBtW,mBAAmB6S,EAAQ0D,YAAYzT,KAEzDiB,GAGXgP,EAAG2K,kBAAoB,WACnB,OAAO7K,EAAQ6K,qBAGnB3K,EAAGuO,aAAe,SAAUC,GACxB,IAAIC,EAASzO,EAAG2G,YAChB,QAAS8H,GAAUA,EAAOC,MAAMrlB,QAAQmlB,IAAS,GAGrDxO,EAAG2O,gBAAkB,SAASH,EAAMI,GAChC,IAAK5O,EAAG6G,eACJ,OAAO,EAGX,IAAI4H,EAASzO,EAAG6G,eAAe+H,GAAY5O,EAAGuD,UAC9C,QAASkL,GAAUA,EAAOC,MAAMrlB,QAAQmlB,IAAS,GAGrDxO,EAAG6O,gBAAkB,WACjB,IAAI7d,EAAM8Q,IAAgB,WACtBqB,EAAM,IAAIC,eACdD,EAAIE,KAAK,MAAOrS,GAAK,GACrBmS,EAAIG,iBAAiB,SAAU,oBAC/BH,EAAIG,iBAAiB,gBAAiB,UAAYtD,EAAGvR,OAErD,IAAI2T,EAAU2C,IAed,OAbA5B,EAAIQ,mBAAqB,WACC,GAAlBR,EAAIS,aACc,KAAdT,EAAIU,QACJ7D,EAAG8O,QAAUhiB,KAAKkB,MAAMmV,EAAIY,cAC5B3B,EAAQQ,WAAW5C,EAAG8O,UAEtB1M,EAAQO,aAKpBQ,EAAIc,OAEG7B,EAAQA,SAGnBpC,EAAG+O,aAAe,WACd,IAAI/d,EAAMgP,EAAGkD,UAAUsC,WACnBrC,EAAM,IAAIC,eACdD,EAAIE,KAAK,MAAOrS,GAAK,GACrBmS,EAAIG,iBAAiB,SAAU,oBAC/BH,EAAIG,iBAAiB,gBAAiB,UAAYtD,EAAGvR,OAErD,IAAI2T,EAAU2C,IAed,OAbA5B,EAAIQ,mBAAqB,WACC,GAAlBR,EAAIS,aACc,KAAdT,EAAIU,QACJ7D,EAAGgP,SAAWliB,KAAKkB,MAAMmV,EAAIY,cAC7B3B,EAAQQ,WAAW5C,EAAGgP,WAEtB5M,EAAQO,aAKpBQ,EAAIc,OAEG7B,EAAQA,SAGnBpC,EAAGiP,eAAiB,SAASC,GACzB,IAAKlP,EAAGsE,cAAiBtE,EAAGvP,cAA2B,YAAXuP,EAAG6C,KAC3C,KAAM,oBAGV,GAAmB,MAAf7C,EAAGnQ,SAEH,OADA+Q,EAAQ,8EACD,EAGX,IAAIqG,EAAYjH,EAAGsE,YAAiB,IAAI5U,KAAKyf,MAAK,IAAI1iB,MAAO6E,UAAY,KAAQ0O,EAAGnQ,SACpF,GAAIqf,EAAa,CACb,GAAIE,MAAMF,GACN,KAAM,sBAEVjI,GAAaiI,EAEjB,OAAOjI,EAAY,GAGvBjH,EAAG6N,YAAc,SAASqB,GACtB,IAAI9M,EAAU2C,IAEd,IAAK/E,EAAGvP,aAEJ,OADA2R,EAAQO,WACDP,EAAQA,QAGnB8M,EAAcA,GAAe,EAE7B,IAAIG,EAAO,WACP,IAAI5e,GAAe,EASnB,IARoB,GAAhBye,GACAze,GAAe,EACfmQ,EAAQ,gDACAZ,EAAGsE,cAAetE,EAAGiP,eAAeC,KAC5Cze,GAAe,EACfmQ,EAAQ,+CAGPnQ,EAEE,CACH,IAAIwS,EAAS,0CAAiDjD,EAAGvP,aAC7DO,EAAMgP,EAAGkD,UAAUzU,QAIvB,GAFAwR,EAAatU,KAAKyW,GAES,GAAvBnC,EAAajX,OAAa,CAC1B,IAAIma,EAAM,IAAIC,eACdD,EAAIE,KAAK,OAAQrS,GAAK,GACtBmS,EAAIG,iBAAiB,eAAgB,qCACrCH,EAAIO,iBAAkB,EAEtBT,GAAU,cAAgBhW,mBAAmB+S,EAAGuD,UAEhD,IAAIjB,GAAY,IAAI7V,MAAO6E,UAE3B6R,EAAIQ,mBAAqB,WACrB,GAAsB,GAAlBR,EAAIS,WACJ,GAAkB,KAAdT,EAAIU,OAAe,CACnBjD,EAAQ,8BAER0B,GAAaA,GAAY,IAAI7V,MAAO6E,WAAa,EAEjD,IAAIwS,EAAgBhX,KAAKkB,MAAMmV,EAAIY,cAEnCM,EAASP,EAA4B,aAAGA,EAA6B,cAAGA,EAAwB,SAAGxB,GAEnGtC,EAAGsP,sBAAwBtP,EAAGsP,uBAC9B,IAAK,IAAIrnB,EAAIgY,EAAavU,MAAY,MAALzD,EAAWA,EAAIgY,EAAavU,MACzDzD,EAAE2a,YAAW,QAUjB,IAPA7B,EAAQ,sCAEU,KAAdoC,EAAIU,QACJ7D,EAAG2E,aAGP3E,EAAGuP,oBAAsBvP,EAAGuP,qBACnBtnB,EAAIgY,EAAavU,MAAY,MAALzD,EAAWA,EAAIgY,EAAavU,MACzDzD,EAAE0a,UAAS,IAM3BQ,EAAIc,KAAKhB,SA/Cbb,EAAQQ,YAAW,IA+D3B,OAXI1C,EAAYC,OACQ0J,IACNtf,MAAK,WACf8kB,OACDhH,OAAM,SAAShW,GACd+P,EAAQO,SAAStQ,MAGrBgd,IAGGjN,EAAQA,SAGnBpC,EAAG2E,WAAa,WACR3E,EAAGvR,QACH4V,EAAS,KAAM,KAAM,MACrBrE,EAAGwP,cAAgBxP,EAAGwP,eAClBxP,EAAGgN,eACHhN,EAAGuK,UAKfvK,EAAGyP,sBAAwB,SAAUze,GACjC,MAAMoR,EAAU2C,IAGhB,OADA7C,EADiBoF,EAActW,GACLoR,GACnBA,EAAQA,SAm5BnB,IAAIsN,EAAe,WACf,KAAMrnB,gBAAgBqnB,GAClB,OAAO,IAAIA,EAGfC,aAAajf,QAAQ,UAAW,QAChCif,aAAa/e,WAAW,WAExB,IAAIgf,EAAKvnB,KAET,SAASwnB,IAEL,IADA,IAAIC,GAAO,IAAIrjB,MAAO6E,UACbzI,EAAI,EAAGA,EAAI8mB,aAAa3mB,OAAQH,IAAM,CAC3C,IAAIyK,EAAMqc,aAAarc,IAAIzK,GAC3B,GAAIyK,GAAsC,GAA/BA,EAAIjK,QAAQ,gBAAsB,CACzC,IAAIY,EAAQ0lB,aAAavgB,QAAQkE,GACjC,GAAIrJ,EACA,IACI,IAAIuC,EAAUM,KAAKkB,MAAM/D,GAAOuC,UAC3BA,GAAWA,EAAUsjB,IACtBH,aAAa/e,WAAW0C,GAE9B,MAAOyc,GACLJ,aAAa/e,WAAW0C,MAO5Csc,EAAG1hB,IAAM,SAASuZ,GACd,GAAKA,EAAL,CAIA,IAAInU,EAAM,eAAiBmU,EACvBxd,EAAQ0lB,aAAavgB,QAAQkE,GAOjC,OANIrJ,IACA0lB,aAAa/e,WAAW0C,GACxBrJ,EAAQ6C,KAAKkB,MAAM/D,IAGvB4lB,IACO5lB,IAGX2lB,EAAGtY,IAAM,SAASmQ,GACdoI,IAEA,IAAIvc,EAAM,eAAiBmU,EAAMA,MACjCA,EAAMjb,SAAU,IAAIC,MAAO6E,UAAS,KACpCqe,aAAajf,QAAQ4C,EAAKxG,KAAKC,UAAU0a,MAI7CuI,EAAgB,WAChB,KAAM3nB,gBAAgB2nB,GAClB,OAAO,IAAIA,EAGf,IAAIJ,EAAKvnB,KAETunB,EAAG1hB,IAAM,SAASuZ,GACd,GAAKA,EAAL,CAIA,IAAIxd,EAAQ0K,EAAU,eAAiB8S,GAEvC,OADAwI,EAAU,eAAiBxI,EAAO,GAAIyI,GAAkB,MACpDjmB,EACO6C,KAAKkB,MAAM/D,QADtB,IAKJ2lB,EAAGtY,IAAM,SAASmQ,GACdwI,EAAU,eAAiBxI,EAAMA,MAAO3a,KAAKC,UAAU0a,GAAQyI,EAAiB,MAGpFN,EAAGhf,WAAa,SAAS0C,GACrB2c,EAAU3c,EAAK,GAAI4c,GAAkB,OAGzC,IAAIA,EAAmB,SAAUC,GAC7B,IAAI/f,EAAM,IAAI3D,KAEd,OADA2D,EAAIggB,QAAQhgB,EAAIkB,UAAqB,GAAR6e,EAAW,KACjC/f,GAGPuE,EAAY,SAAUrB,GAGtB,IAFA,IAAI+c,EAAO/c,EAAM,IACbgd,EAAKjkB,SAASiB,OAAOC,MAAM,KACtB1E,EAAI,EAAGA,EAAIynB,EAAGtnB,OAAQH,IAAK,CAEhC,IADA,IAAIuD,EAAIkkB,EAAGznB,GACW,KAAfuD,EAAE0B,OAAO,IACZ1B,EAAIA,EAAEsU,UAAU,GAEpB,GAAuB,GAAnBtU,EAAE/C,QAAQgnB,GACV,OAAOjkB,EAAEsU,UAAU2P,EAAKrnB,OAAQoD,EAAEpD,QAG1C,MAAO,IAGPinB,EAAY,SAAU3c,EAAKrJ,EAAOsmB,GAClC,IAAIjjB,EAASgG,EAAM,IAAMrJ,EAAZqJ,aACMid,EAAe3jB,cAAgB,KAClDP,SAASiB,OAASA,IAI1B,SAASsf,IACL,IACI,OAAO,IAAI8C,EACb,MAAOK,IAGT,OAAO,IAAIC,EAGf,SAASnP,EAAa2P,GAClB,OAAO,WACCxQ,EAAGkN,eACHsD,EAAGtnB,MAAMkJ,QAASpK,MAAMO,UAAUoF,MAAM1E,KAAKF,cAM7D,OAAO8W,EAvtDkB4Q,CAASC,OAAsBC,sBCe5CC,aACdC,EACAC,EACAC,EACA7gB,EACA8gB,GAEA,SAASzG,EAAM0G,GACb,OAAIJ,EAASrK,eACXpU,QAAQC,MAAM,qDACPxI,QAAQC,WAEV+mB,EACJtG,MAAM0G,GACN5I,OAAM,WACL,MAAM,IAAIvS,MAAM,2BAVtB,IAAAkb,IAAAA,EAAAriB,QA0CA,IAAMge,EAAmC,CACvC9J,KAAM,SACNgH,kBAAkB,EAClBlI,WAAY,QAERuP,EAAyCJ,EAAQK,aACpD5mB,MAAK,SAACwF,GAAY,OAAA8gB,EAASnE,KAAIjkB,SAAAA,SAAA,GAAMkkB,GAAgB5c,OACrDxF,MAAK,SAAC6mB,GAA6B,OAACA,EAAkBC,SAAe7gB,KA4FxE,SAAS6gB,IACP,IAAMC,EAAWT,EAASvM,aAAgBuM,EAASvM,YAAoBgK,OACvE,MAAO,CACLiD,mBAAoB,CAClBC,IAAKX,EAASpiB,MACdoZ,OAAQgJ,EAASvM,aAEnBmN,oBAAqBZ,EAASpgB,aAC9B6d,OAAQgD,GAIZ,OArFAT,EAASxD,QAAU,SAAC+D,GACdA,EACFL,EAAWW,QAAQ,YAAaL,KACtBnhB,GAlBd,SAAiB8D,EAAsBV,QAAA,IAAAA,IAAAA,EAAA,oBACrC,IAAMqe,EAASX,EAAI7f,eAAe/B,QAAQkE,GAC1C,GAAIqe,EAAQ,CACV,IAAMC,EAASnlB,KAAKgD,MAAQoiB,OAAOF,GAEnC,GADgBjiB,KAAKC,MAAMiiB,EAAS,KACtB,GAGZ,OAFAZ,EAAI7f,eAAeP,WAAW0C,QAC9BU,IAIJgd,EAAI7f,eAAeT,QAAQ4C,EAAK7G,KAAKgD,MAAMgK,YAC3C8Q,EAAM,IAOJuH,EAAQ,WACNf,EAAWW,QAAQ,iBAAalhB,OAKtCqgB,EAASjM,cAAgB,WAmDzB,IAAwBmN,EAChBC,EADgBD,EAlDP,WACTlB,EAASpiB,YAA+B+B,IAAtBqgB,EAAShhB,WAC7BihB,EAAQtoB,OAAOqoB,EAASpiB,MAAO,CAC7BoB,SAAUghB,EAAShhB,SACnBY,aAAcogB,EAASpgB,aACvBR,oBAAoB,EACpBC,eAAcA,IAEhB6gB,EAAWW,QAAQ,eAAgBL,QA2CjCW,EAAsB,WAC1B,OAAA/d,YAAW,WACL4c,EAASpgB,aACXshB,IAEAC,MAED,UA7CPnB,EAASvB,qBAAuB,WAC1BuB,EAASpiB,YAA+B+B,IAAtBqgB,EAAShhB,eAAoDW,IAA1BqgB,EAASpgB,eAChEqgB,EAAQtoB,OAAOqoB,EAASpiB,MAAO,CAC7BoB,SAAUghB,EAAShhB,SACnBY,aAAcogB,EAASpgB,aACvBR,oBAAoB,EACpBC,eAAcA,IAEhB6gB,EAAWW,QAAQ,eAAgBL,OAIvCR,EAAS7J,eAAiB,WACxB8J,EAAQngB,UACRogB,EAAWW,QAAQ,WAAY,KAGjCb,EAASnO,YAAc,SAACrQ,GACtB0e,EAAWW,QAAQ,aAAc,CAC/BrB,KAAOhe,GAASA,EAAMA,OAAU,uBAChC2H,QAAU3H,GAASA,EAAMoQ,mBAAsB,kCAInDoO,EAAStB,mBAAqB,WAC5BwB,EAAWW,QAAQ,aAAc,CAC/BrB,KAAM,+BACNrW,QAAS,sCAkCN,CACLuQ,MAAKA,EACL7T,OA9IF,SAAgB8M,GACd,OAAOqN,EACJna,OAAO,CAAE8M,YAAWA,IACpB6E,OAAM,WACL,MAAM,IAAIvS,MAAM,wBA2IpBW,QAvIF,WACE,OAAOoa,EACJhD,aAAa,GACbtjB,MAAK,eACL8d,OAAM,WACL,MAAM,IAAIvS,MAAM,+BAmIpB+B,WA/HF,WACE,OAAIgZ,EAASvM,aAAeuM,EAASvM,YAAYlU,IACxCygB,EAASvM,YAAYlU,IAAMV,KAAKyf,MAAK,IAAI1iB,MAAO6E,UAAY,MAASuf,EAAShhB,UAAY,IAG3F,GA2HRqhB,UAASA,YC/LGe,oBAAoB3D,EAAgB4D,EAAmBpf,GACrE,IAAIqf,EAAgB7D,EA2BpB,MAAO,CACL8D,mBArBF,SAA4BC,GAC1B,IANyBf,EAMnBgB,GANmBhB,EAMgBe,EAAeE,OALjDL,EAAQM,MAAK,SAACC,GAA4B,OAAAnB,IAAamB,MACzDP,EAAQM,MAAK,SAACC,GAA4B,OAAsC,IAAtCA,EAAgBppB,QAAQioB,OAMvE,OAAIgB,GAAkBA,IAAmBH,EAChCrf,EAAUwf,GAAgB/nB,MAAK,WACpC4nB,EAAgBG,KAGXzoB,QAAQC,WAcjB4oB,kBATF,WACE,IAAMC,EAAiBT,EAAQxe,QAAO,SAACkf,GAAgB,OAAAA,IAAQT,KAC/D,MAAO,CAACA,GACLU,OAAOF,GACP/kB,KAAK,OChBL,IAAMklB,yBAA2B,cAOlC5M,WAAa,SAAC6M,EAAgBC,GAClC,OAAyC,IAAlCD,EAAO1pB,QAAQ2pB,ICbZC,0BDgBIC,qBACd,MAAO,CACLzc,QAAS,WAAM,OAAA5M,QAAQC,WACvB+N,WAAY,WAAM,OAAA,KAClBsb,eAAgB,WAAM,OAAAtpB,QAAQC,WAC9BspB,cAAe,aACf1c,OAAQ,WAAM,OAAA7M,QAAQC,WACtBoG,eAAgB,WAAM,OAAA,GACtBghB,UAAWrnB,QAAQC,aAAQ0G,aAIf6iB,uBACdC,EACAxC,EACA5e,GA6BA,OAAAzJ,SAAAA,SAAA,GACKqoB,GAAO,CACVK,WA7BiB,WAAM,OAAAmC,IACtB/oB,MAAK,SAACgpB,GACL,IAAMxjB,EAAwC,GAC9C,GAAIwjB,GAAUA,EAAO9kB,MACnBqiB,EAAQtoB,OAAO+qB,EAAO9kB,MAAO,CAC3BgC,aAAc8iB,EAAO9iB,aACrBR,oBAAoB,EACpBC,gBAAgB,IAKlBgC,QACK,CACL,IAAM1C,EAAYshB,EAAQ5hB,aACtBM,IACFO,EAAQF,SAAWL,EAAUK,SACzBL,EAAUiB,eACZV,EAAQU,aAAejB,EAAUiB,cAE/BjB,EAAUf,QACZsB,EAAQtB,MAAQe,EAAUf,QAIhC,OAAOsB,iBAQGyjB,iBACdC,EACAjc,EACAsZ,EACAlZ,EACA8b,EACArc,EACA0Z,EACAzgB,QAAA,IAAAA,IAAAA,EAAyB3B,OAAO2B,UAEhC,IAAMqjB,EAAczN,WAAW5V,EAASoB,KAAMkG,EAAOnF,cAC/CmhB,EAActjB,EAASmD,KAAKpK,QAAQ,UAAY,EAChD6G,EAAiBsH,EAAStH,gBAAkBsH,EAAStH,mBAAoB,EAgB/E,SAAS2jB,IACP,IAAMC,EAAczc,EAAM/J,OAAOY,IAAI4kB,2BAA6Blb,EAAOmc,eACzE1c,EAAM/J,OAAOc,OAAO0kB,0BACpBzb,EAAMnF,SAAS4hB,GAAa,WAAM,OAAAL,EAAe/c,YAcnD,SAAS0c,EAAc1gB,GACrB,IAAMX,EAAcW,GAAmB2E,EAAM/J,OAAOY,IAAI4kB,0BAEpD/gB,IAAgBsF,EAAMxF,WAAWE,IACnCsF,EAAM/J,OAAOW,IAAI6kB,yBAA0B/gB,GAE7C,IAAMkf,EAA8C,CAClDzN,YAAa5L,EAAOnF,cAEtBwe,EAAa3C,OAASoF,EAAehB,oBACrCe,EAAelJ,MAAM0G,GAGvB,OA7CgC0C,IAAgBC,IAAgB1jB,GAAkBujB,EAAe5b,aAAe,GAG9GL,EAAS0Z,UAAU3mB,MAAK,SAACgpB,KAClBA,GAAWA,IAAWA,EAAOhC,qBAChC6B,EAAc/b,EAAMpE,oBAAoB,gBAEzCoV,OAAM,WACP+K,EAAc/b,EAAMpE,oBAAoB,gBAa5C8d,EAAW1E,UAAU,gBAAgB,SAAC1Y,OAAE2a,EAAM3a,EAAA2a,OACxC0F,EAAgBnqB,QAAQC,UACxBwkB,GAAUsF,IACZI,EAAgBN,EAAetB,mBAAmB9D,IAGhDqF,GACFK,EAAczpB,KAAKspB,GAAiBxL,MAAMwL,MAiB9CprB,SAAAA,SAAA,GACK+O,GAAQ,CACX4b,cAAaA,EACb1c,OAAQ,SAAChE,GACPoe,EAAQngB,UAER,IAAM6S,EAAcnM,EAAM7E,mBAAmBoF,EAAOnF,aAAcC,GAAmBkF,EAAOmc,gBAC5F,OAAON,EAAe/c,OAAO8M,MCnIvByP,iBAAAA,QAAAA,mBAAAA,QAAAA,iBAAgB,IAC1BA,iBAAA,YAAA,qBACAA,iBAAA,QAAA,gBACAA,iBAAA,gBAAA,kBACAA,iBAAA,YAAA,cAaF,IAAAgB,iBAAA,WACE,SAAAA,EACmBjL,EACAjW,EACA5F,QAAA,IAAAA,IAAAA,EAA+BwB,OAAO2B,SAASnD,SAF/C9E,KAAA2gB,QAAAA,EACA3gB,KAAA0K,QAAAA,EACA1K,KAAA8E,QAAAA,EAyIrB,OAtIE8mB,EAAA1rB,UAAA4qB,eAAA,SAAehG,EAAe+G,EAAmBC,GAC/C,IAAK9rB,KAAK2gB,QAAQjH,cAChB,OAAOlY,QAAQE,OAAO1B,KAAK+rB,iBAAiBnB,QAAAA,iBAAiBoB,cAE/D,IAAM7Q,EAAc2Q,EAAeA,EAAa3Q,iBAAchT,EACxD0B,EAAYiiB,GAAgBA,EAAajiB,WAAa,EACtD8W,EAAU3gB,KAAK2gB,QAAQwB,eAAe,CAAE2C,MAAKA,EAAE3J,YAAWA,IAAM,eAAe0Q,EACrF,OAAIhiB,GACF7J,KAAK8E,QAAQ6b,GACNnf,QAAQC,WAEVzB,KAAKisB,wBAAwBtL,GAASze,QAGvC0pB,EAAA1rB,UAAA+rB,wBAAR,SAAgCtL,GAC9B,OAAO3gB,KAAKksB,eAAe,MAAOvL,IAG5BiL,EAAA1rB,UAAAisB,UAAR,SAAkBC,GAAlB,IAAAC,EAAArsB,KACQssB,EAAiBtsB,KAAKusB,kBAAkBH,GAC9C,OAAIE,GAAkBtsB,KAAKwsB,kBAAkBF,GACpCtsB,KAAKwlB,YAAY8G,GACrBtM,OAAM,WACL,MAAMqM,EAAKN,iBAAiBnB,QAAAA,iBAAiB6B,gBAG5CjrB,QAAQE,OAAO1B,KAAK+rB,qBAGrBH,EAAA1rB,UAAAwsB,QAAR,SAAgB1iB,GACd,GAAqB,MAAjBA,EAAMwR,OAYR,OAAOxb,KAAK+rB,mBAXZ,IACE,OAAO/rB,KAAK2sB,aAAa3iB,EAAMoiB,UAC/B,MAAA9gB,GACA,IAAMshB,EAAc5sB,KAAK6sB,eAAe7iB,GACxC,OAAI4iB,EAEK5sB,KAAK+rB,iBAAiBa,EAAY5iB,MAAO4iB,EAAYE,aAEvD9sB,KAAK+rB,iBAAiBnB,QAAAA,iBAAiBmC,mBAO5CnB,EAAA1rB,UAAA8sB,gCAAR,SAAwCrkB,GAAxC,IAAA0jB,EAAArsB,KACE,OAAO,SAACqhB,GACN,OAAOgL,EAAKH,eAAe,OAAQvjB,EAAK0Y,KAIpCuK,EAAA1rB,UAAAysB,aAAR,SAAqBM,GACnB,IACM3hB,EADoB7G,KAAKkB,MAAMsnB,GACoCC,WAAW,GAA5EC,EAAa7hB,EAAA6hB,cAAEC,EAAS9hB,EAAA8hB,UAAKC,EAAavsB,OAAAwK,EAA5C,CAAA,gBAAA,cACAgiB,EAAeF,EAAUvP,WAAW,SACtC7d,KAAK2gB,QAAQjH,cAAgB0T,EAAU1P,OAAO,GAC9C1d,KAAK2gB,QAAQjH,cAAgB0T,EACjC,MAAO,CACLD,cAAaA,EACbE,cAAaA,EACbE,sBAAuBvtB,KAAKgtB,gCAAgCM,KAIxD1B,EAAA1rB,UAAAssB,kBAAR,SAA0BvkB,GACxB,IAAM2S,EAAS3S,EAASwV,MAAM,0BAA4B,GAC1D,OAAO7C,GAAUA,EAAO,IAGlBgR,EAAA1rB,UAAA6rB,iBAAR,SAAyBnY,EAAekZ,GACtC,MAAO,CACL9iB,MAAO,CACLwjB,UAAW5Z,GAAQgX,QAAAA,iBAAiB6C,QACpCC,iBAAkBZ,KAKhBlB,EAAA1rB,UAAA2sB,eAAR,SAAuB7iB,GACrB,IAAMsiB,EAAiBtsB,KAAKusB,kBAAkBviB,GAC9C,GAAKsiB,EAAL,CAIA,IAAMqB,EAAc,IAAIC,IAAItB,GAC5B,GAAKqB,EAAYniB,OAAjB,CAIA,IAAMoP,EAAS+S,EAAYE,aAC3B,MAAO,CACL7jB,MAAO4Q,EAAO/U,IAAI,eAAYsC,EAC9B2kB,YAAalS,EAAO/U,IAAI,2BAAwBsC,MAI5CyjB,EAAA1rB,UAAAqsB,kBAAR,SAA0BH,GACxB,OAAOA,GAAYA,EAAShgB,UAAYggB,EAAShgB,QAAQnE,UAAYmkB,EAAShgB,QAAQ0hB,WAGhFlC,EAAA1rB,UAAAgsB,eAAR,SAAuBna,EAAoBpJ,EAAa0Y,GAAxD,IAAAgL,EAAArsB,KACQ0K,EAAU,CACdqH,OAAMA,EACNpJ,IAAGA,EACHyD,QAAS,CACP2hB,OAAQ,MACRC,sBAAuB,QAEzB3M,KAAM5c,KAAKC,UAAU2c,SAASlZ,EAC9BkT,iBAAiB,GAEnB,OAAOrb,KAAK0K,QAAQA,GAEjBsV,OAAM,SAAChW,GACN,MAAMqiB,EAAKK,QAAQ1iB,MAEpB9H,MAAK,SAACkqB,GAA2B,OAAAC,EAAKF,UAAUC,OAG7CR,EAAA1rB,UAAAslB,YAAR,SAAoB7c,GAQlB,OAAO3I,KAAK2gB,QACTyG,sBAAsBze,GACtBqX,OAAM,WACL,MAAM,IAAIvS,MAAM,4CAGxBme,EA7IA,YCvBgBqC,wBACdhD,GAEA,MAAO,CACL9qB,OAAQ,aACRmI,QAAS,aACTwgB,WAAYmC,YAIAiD,kBACd/e,EACAkc,EACAD,EACA3C,GAEA,OAAAroB,SAAAA,SAAA,GACK+O,GAAQ,CACX4b,cAAe,SAAC5P,GACd,IAAMyN,EAA8C,CAClDzN,YAAWA,GAEbyN,EAAa3C,OAASoF,EAAehB,oBACrCe,EAAelJ,MAAM0G,IAEvBva,OAAQ,SAAC8M,GAEP,OADAsN,EAAQngB,UACD8iB,EAAe/c,OAAO8M,MC7B5B,IAAMgT,oBAAsB,qBCMvBC,SDJZ,SAASC,gCACP,IAAM1lB,EAAM,IAAIilB,IAAItnB,OAAO2B,SAASoB,MACpCV,EAAIklB,aAAaS,OAAOH,qBACxB7nB,OAAOgf,QAAQC,aAAajf,OAAOgf,QAAQlG,MAAO,GAAIzW,EAAIyI,qBAG5Cmd,oBACd7jB,EACAE,EACA4jB,EACA7U,EACA8U,EACAhG,GAEA,IAAMiG,EAAqB9jB,EAAoBujB,2BAAwBhmB,EACjEwmB,EAAuBC,QAAQF,GAwDrC,MAAO,CACL7mB,eAxDqB8mB,GAAyBlG,GAAWA,EAAQ5gB,iBAAmB,EAyDpFojB,cAbiE,WAKjE,OAAI0D,GAxCE7T,EAAyB,CAC7B/I,OAAQ,OACRpJ,IAAK,GAAGrC,OAAO2B,SAASsB,OAASilB,EAAO,mDACxCnN,KAAM5c,KAAKC,UAAU,CACnBiV,MAAKA,EACL8U,OAAMA,EACNlL,IAAKmL,IAEPtiB,QAAS,CACPyiB,eAAgB,qBAIbnkB,EAAQoQ,GAAK5Y,MAClB,SAACkqB,GACCiC,gCACA,IAAMjsB,EAGFqC,KAAKkB,MAAMymB,EAAShqB,MACxB,MAAO,CACLgE,MAAOhE,EAAKqY,aACZrS,aAAchG,EAAK0sB,kBAGvB9O,OAAM,SAACjf,GAMP,OALAgJ,QAAQC,MAAM,2CAA2CjJ,GAKlD,OAYFS,QAAQC,QAAQ,IA5CzB,IACQqZ,aE4CMiU,mBACdxf,EACAkZ,EACAzZ,EACAF,EACAC,GAEA,GAAID,EAAUkgB,WACZ,OAAOnE,qBAGH,IAAAvf,EAGFijB,oBACFvf,EAAMtE,QACNsE,EAAMpE,oBACNkE,EAAU0f,QACVjf,EAAOoK,MACPpK,EAAO2L,SACPuN,EAAQ5hB,cARRgB,EAAcyD,EAAAzD,eACdojB,EAAa3f,EAAA2f,cAUTgE,EAAgC,KAAxB1f,EAAOnF,cAAiD,KAA1BmF,EAAOmc,eAC7CwD,EAAiBD,EACnBhB,wBAAwBhD,GACxBD,uBAAuBC,EAAexC,GAAS,WAAM,OAAAzZ,EAAMnF,SAAS0F,EAAOmc,mBAEzElD,EAA6BhR,iBAAS,CAC1C7O,IAAK4G,EAAOoR,QACZzF,SAAU3L,EAAO2L,SACjBvB,MAAOpK,EAAOoK,QAEVyR,EAAiB7C,aAAaC,EAAU0G,EAAgBngB,EAAQlH,QAAkBM,GAClFgnB,EAAmB,IAAIvD,iBAAiBpD,EAAUxZ,EAAMtE,SAExDyE,EAA2B,CAC/Bf,QAASgd,EAAehd,QACxBoB,WAAY4b,EAAe5b,WAC3Bsb,eAAgBqE,EAAiBrE,eAAesE,KAAKD,GACrDtnB,eAAgB,WAAM,OAAAA,GACtBghB,UAAWuC,EAAevC,WAEtBwC,EAAiBzB,oBAAoB9a,EAAUmX,OAAQnX,EAAU+a,QAAS7a,EAAMvE,WAEtF,OAAIwkB,EACKf,kBAAkB/e,EAAUkc,EAAgBD,EAAgB8D,GAG9D/D,iBACLC,EACAjc,EACA+f,EACA3f,EACA8b,EACArc,EACAD,GDzHQqf,SAAAA,QAAAA,WAAAA,QAAAA,SAAQ,IAElBA,SAAA,MAAA,MAEAA,SAAA,OAAA,SAEAA,SAAA,OAAA,SAwEF,IAAMiB,iBAAmB,WAAM,OAAA,SAACprB,GAAiB,OAAGgE,SAASC,SAAQ,KAAKD,SAAS0B,KAAO1F,IAE7EqrB,oBAAsB,SAACC,EAAwBC,GAC1D,QAAoBrnB,IAAhBqnB,EACF,OAAOC,oBAAoBF,GAQ7B,OANIC,EAAYrhB,wBACdqhB,EAAYrhB,sBAAwBuhB,SAASF,EAAYrhB,sBAAuB,KAE9EqhB,EAAYjiB,oBACdiiB,EAAYjiB,kBAAoBmiB,SAASF,EAAYjiB,kBAAmB,KAElEiiB,EAAYG,MAClB,KAAKvB,QAAAA,SAASwB,OAKZ,OAJkBxvB,SAAAA,SAAA,GACbovB,GAAW,CACdG,KAAMvB,QAAAA,SAASwB,SAGnB,KAAKxB,QAAAA,SAASyB,OAWZ,OAVkBzvB,SAAAA,SAAA,GACbovB,GAAW,CACdG,KAAMvB,QAAAA,SAASyB,OACfnE,eAAgB8D,EAAY9D,eAC5BthB,aAAcolB,EAAYplB,aAC1BuW,QAAS6O,EAAY7O,QACrBzF,SAAUsU,EAAYtU,SACtB4J,MAAO0K,EAAY1K,MACnBnL,MAAO6V,EAAY7V,QAGvB,QACE,OAAOvZ,SAAAA,SAAA,GAAKqvB,oBAAoBF,IAAgBC,KAIzCC,oBAAsB,SAACF,GAClC,IAAMO,EAAaT,mBACbU,EAAgBR,EAAW5oB,SAAQ,IAAI4oB,EAAWS,WACxD,MAAO,CACLL,KAAMvB,QAAAA,SAAS6B,MACfvE,eAAgBoE,EAAcC,EAAU,UACxC3lB,aAAc0lB,EAAcC,EAAU,UACtCpP,QAASmP,EAAcP,EAAWf,QAAO,eACzC0B,WAAYJ,EAAcP,EAAWf,QAAO,iBAC5C3K,UAAWiM,EAAcP,EAAWf,QAAO,gBAC3C2B,UAAWL,EAAcP,EAAWf,QAAO,kBE5HzC4B,sBAAwB,SAACC,EAAyBC,GAGtD,GAAIA,EACF,OAAO,EAGT,cANsCD,GAOpC,IAAK,SAAU,MAA8B,SAAvBA,EACtB,IAAK,UAAW,OAAOA,EACvB,QAAS,OAAO,IAIPE,kBAAoB,SAAChhB,EAAiCigB,GACjE,IAAMgB,EAA2B,CAC/BC,aAAc,CACZC,SAAS,IAIb,IAAKlB,EACH,OAAOgB,EAGT,IAAMG,EAAsBP,sBAAsBZ,EAAYa,mBAAoB9gB,EAAOyf,YAQzF,OAPI2B,IACFH,EAASC,aAAaC,SAAU,GAE9BC,GAAuBnB,EAAYoB,kBACrCJ,EAASC,aAAaI,IAAMrB,EAAYoB,iBAGnCJ,GC8HHM,kBAAoB,WACxB,IAAMC,EAAgBzqB,OAAe0qB,OAAOC,OAC5C,GAAIF,EACF,OAAOA,EAAa3B,KAAM9oB,OAAe0qB,QAE3C,MAAM,IAAIvjB,MAAM,kCAGZyjB,qBAAsC,CAC1CC,QAAS,IACT3C,QAAS,GACT4C,oBAAqB,GACrBpB,WAAY,GACZqB,SAAU,GACVrC,WAAY,QACZsC,gBAAiB,GACjBC,YAAa,GACbtL,OAAQ,QACR4D,QAAS,QACTljB,SAAU,GACV6qB,SAAU,GACVC,QAAS,QACTC,UAAW,QACXC,OAAQ,aAkBMC,iBAAiBC,GAC/B,IAAMtC,EAAauC,oBAAmB1xB,SAAAA,SAAA,GAAM8wB,sBAAyBW,IAKrE,MAAO,CACLtC,WAAUA,EACV5gB,WALiB2gB,oBAAoBC,EAAYsC,EAAcE,IAAMF,EAAcG,MAMnFC,aALmBJ,EAAcK,YAAcpB,oBAM/CqB,eALqB5B,kBAAkBhB,EAAYsC,EAAcE,KAYrE,IAAMK,YAAc,MAOpB,SAASN,oBAAoBD,GAmB3B,MAlB+B,CAC7BV,QAASU,EAAcV,QACvB3C,QAASqD,EAAcrD,QACvB4C,oBAAqBS,EAAcT,oBACnCpB,WAAY6B,EAAc7B,WAC1BqB,SAAUQ,EAAcR,SACxBrC,WAAgD,SAApC6C,EAAc7C,WAAW9E,OACrCoH,gBAAiBO,EAAcP,gBAC/BC,YAAaM,EAAcN,YAC3BtL,OAAQ4L,EAAc5L,OACtB4D,QAASgI,EAAchI,QAAQ/kB,QAAQstB,YAAa,IAAIltB,MAAM,KAC9DyB,SAAUkrB,EAAclrB,SACxB6qB,SAAUK,EAAcL,SACxBa,cAAe,gBACfZ,UAAWI,EAAcJ,SAA4C,SAAjCI,EAAcJ,QAAQvH,OAC1DwH,YAAaG,EAAcH,WAAgD,SAAnCG,EAAcH,UAAUxH,OAChEyH,OAAQE,EAAcF,QC3O1B,IAAMW,uBAAyB,KAEzBC,eAAiB,SAACC,GACtB,OAAAhzB,OAAOuL,KAAKynB,GAAOxnB,KACjB,SAACC,GAAgB,OAAGrG,mBAAmBqG,GAAI,IAAIrG,mBAAmB4tB,EAAMvnB,OACxE1F,KAAK,MAEHktB,WAAa,SAACC,GAAgC,OAAAA,EACjDxtB,MAAM,QACNmG,QAAO,SAACsnB,GAAc,MAAc,KAAdA,KACtB3nB,KAAI,SAAC2nB,SACEC,EAAiBD,EAAUztB,MAAMotB,wBACjCtK,EAAO4K,EAAe,GACtBhxB,EAAQgxB,EAAettB,MAAM,GAAGC,KAAK+sB,wBAE3C,OAAAhnB,EAAA,IAAU0c,GAAOpmB,EAAK0J,KACrB4X,QACD,SAAC2P,EAAKC,GAAW,OAAA1yB,SAAAA,SAAA,GAAMyyB,GAAQC,KAC/B,KCqCJC,UAAA,SAAAC,GAUE,SAAAD,EAAYE,GAAZ,IAAA5G,EACE2G,EAAApyB,KAAAZ,KAAMizB,EAActhB,UAAQ3R,YAC5BqsB,EAAKD,SAAW6G,EAAc7wB,KAC9BiqB,EAAK6G,WAAaD,EAAcC,WAChC7G,EAAK7Q,OAASyX,EAAczX,OAC5B6Q,EAAKjgB,QAAU6mB,EAAc7mB,UAEjC,OAjB+BtM,UAAAizB,EAAAC,GAC7BxzB,OAAAqO,eAAIklB,EAAA7yB,UAAA,OAAI,KAAR,WACE,MAAO,iBAET,SAASizB,qCAaXJ,EAjBA,CAA+BtlB,OAmBzB2lB,cAAgB,SAAClS,GACrB,IAAMvD,EAAMuD,EAAMmS,eAAiBnS,EAAM0B,OACnCpH,EAASmC,EAAInC,OACb0X,EAAavV,EAAIuV,WACjB9wB,EAAOub,EAAIyO,SACXzjB,EAAMgV,EAAIC,aAAe,gBACzBxR,EAAUqmB,WAAW9U,EAAI2V,yBAA2B,IAE1D,GAAI9X,EAAS,KAAOA,EAAS,IAG3B,MAAM,IAAIuX,UAAU,CAClBphB,QAHc,6BAA6BhJ,EAAG,KAAK6S,EAAM,IAAI0X,EAI7D1X,OAAMA,EACN0X,WAAUA,EACV9wB,KAAIA,EACJgK,QAAOA,IAIX,MAAO,CACLoP,OAAMA,EACN0X,WAAUA,EACV9mB,QAAOA,EACPhK,KAAIA,IAIFmxB,cAAgB,SAACjtB,GAAgB,OAAA,SAACqC,EAAajB,GACnD,OAAA,IAAIlG,SAAQ,SAACC,EAASC,GACpB,IAAMic,EAAsB,IAAIrX,EAAOyU,eACjC3O,EAAU1E,EAAQ0E,SAAW,GAEnCuR,EAAI3C,KAAKtT,EAAQqK,QAAU,MAAOpJ,GAClCgV,EAAIiH,aAAeld,EAAQkd,cAAgB,GAC3CplB,OAAOuL,KAAKqB,GAASonB,SAAQ,SAACxL,GAAS,OAAArK,EAAI1C,iBAAiB+M,EAAiB5b,EAAS4b,OACtFrK,EAAItC,kBAAoB3T,EAAQ2T,gBAEhCsC,EAAI7P,iBAAiB,OAAQrM,GAC7Bkc,EAAI7P,iBAAiB,QAASpM,GAC9Bic,EAAI7P,iBAAiB,QAASpM,GAE9Bic,EAAI/B,KAAKlU,EAAQ2Z,SAChBnf,KAAKkxB,iBC/GJK,eAAiB,SAACC,GAA2B,OAAA,SAACvnB,GAClD,IAAMwnB,EAAcxnB,EAAWqmB,MAAQD,eAAepmB,EAAWqmB,YAASrqB,EACpEQ,EAAMgrB,EAAiBxnB,EAAWxD,IAAG,IAAIgrB,EAAiBxnB,EAAWxD,KAAO,GAE5EirB,EAAcL,cAAcjtB,QAMlC,OAJIotB,GACFA,EAAI,eAActzB,SAAAA,SAAA,GAAO+L,GAAU,CAAExD,IAAGA,KAGnCirB,EAAYjrB,EAAKwD,cAsBVzB,QAAQmE,GAItB,OAHA,SAA8BU,EAA2BmkB,GACvD,OAAO7kB,EAAiBhC,IAAI0C,EAAQkkB,eAAeC,cClBvCG,yBACd,IAAMC,EAAkC,GAKlCC,EAAa,SAACC,EAAoCngB,GACtD,OAAA,SAAC1H,GAAkC,OAAA6nB,EAAgBngB,GAAO1H,EAAY4nB,EAAWC,EAAiBngB,EAAQ,MAU5G,MAAO,CACL5E,IAhBU,SAACI,GACXykB,EAAaxwB,KAAK+L,IAgBlBxC,IAVU,SAACV,EAA+B8nB,GAC1C,GAA4B,IAAxBH,EAAanzB,OACf,OAAOszB,EAAY9nB,GAErB,IAAM6nB,EAAezwB,eAAOuwB,EAAY,CAAEG,IAC1C,OAAOD,EAAgB,GAAG7nB,EAAY4nB,EAAWC,EAAiB,MC3CtE,IAAM/uB,SAAiBivB,iBAIjBC,YAAc,YCLRC,yBD0BIC,kBAAhB,IAAAhI,EAAArsB,KACE,OAAO,SAAOimB,GAAc,OAAA9kB,UAAAkrB,OAAA,OAAA,GAAA,gDAE1B,OADApnB,SAAOW,IAAIuuB,YAAalO,GACxB,CAAA,EAAOzkB,QAAQC,QAAQ,CACrB+Z,OAAQ,IACR0X,WAAY,KACZ9mB,QAAS,GACThK,KAAM,cCjCZ,SAAYgyB,GACVA,EAAA,IAAA,MACAA,EAAA,GAAA,KACAA,EAAA,IAAA,MAHF,CAAYA,kBAAAA,gBAAe,KAgDpB,IAAME,iBAAmB,WAC9B,IAAMC,EAA0C,GAiB1CC,EAAqB,SAACC,GAC1B,OAAOA,EAAYvR,QAAO,SAACwR,EAAgBC,GACzC,OAAIA,EAAWC,QAAUR,gBAAgBS,IAChCH,GAASC,EAAW/yB,MAClB+yB,EAAWC,QAAUR,gBAAgBU,IACvCJ,IAAUC,EAAW/yB,MAGvB8yB,GAASC,EAAW/yB,SAC1B,IAGCmzB,EAAoB,SAACC,GACzB,GAA0B,IAAtBA,EAAWr0B,OACb,OAAOa,QAAQC,SAAQ,GAEzB,IAAMwzB,EAAqBD,EAAWhqB,KAAI,SAACkqB,GACzC,OAAIA,EAAUr1B,eAAe,QA5BR,SAACq1B,GACxB,OAAIX,EAAUW,EAAUvF,MACf4E,EAAUW,EAAUvF,MAAMuF,GAAWhzB,MAAK,SAACN,GAAmB,MAAA,CACnEA,MAAKA,EACLgzB,MAAOM,EAAUN,UAIdpzB,QAAQE,OAAO,oDAAoDwzB,EAAUvF,KAAI,KAqB7EwF,CAAiBD,GAGnBH,EAAkBG,EAAUF,YAAY9yB,MAAK,SAACN,GAAmB,MAAA,CACtEA,MAAKA,EACLgzB,MAAOM,EAAUN,aAIrB,OAAOpzB,QAAQ4zB,IAAIH,GAAoB/yB,KAAKsyB,IAGxCa,EAA0B,SAAOC,GAAqC,OAAAn0B,eAAA,OAAA,OAAA,GAAA,uEAC1E,OAAKm0B,EAAkB30B,OAGF,CAAA,EAAMo0B,EAAkBO,EAAkB,GAAGJ,YAFhE,CAAA,OAAO/sB,UAGT,OADqBmD,EAAA5I,OAKrB,CAAA,EAAO4yB,EAAkB,GAAG1zB,OAH1B,CAAA,EAAOyzB,EAAwBC,EAAkBhwB,MAAM,aAc3D,MAAO,CACLyvB,kBAAiBA,EACjBQ,aAVmB,SAAOC,GAAgC,OAAAr0B,eAAA,OAAA,OAAA,GAAA,6EACjC,MAAA,CAAA,EAAMk0B,EAAwBG,EAAaF,2BAEpE,MAAA,CAAA,OAA6BntB,KAFvBstB,EAAmBnqB,EAAA5I,QAGrB8yB,EAAaE,aACbD,WAMJE,YApEkB,SAAChG,EAAciG,GACjCrB,EAAU5E,GAAQiG,KC/BhBC,WAAa,SAACnrB,EAAsB8jB,EAAiBjf,GAGzD,OAAO7E,EAAQ,CAAEqH,OAAQ,MAAOpJ,IADpB6lB,GAAWjf,EAAOshB,KADX,4FAGhB3uB,MAAK,SAACmf,GAAS,OAAA5c,KAAKkB,MAAM0b,EAAKjf,SAC/BF,MAAK,SAACinB,GAAQ,OAAAA,EAAIne,IAAI8qB,qBACtB9V,OAAM,WAAM,MAAA,OAGX8V,iBAAmB,SAAmDC,GAC1E,OAAA31B,SAAAA,SAAA,GACK21B,GAAI,CACPxP,SAAUwP,EAAKxP,SAASzhB,QAAQ,KAAM,IACtCkxB,SAAUD,EAAKC,SAASlxB,QAAQ,KAAM,OAI7BmxB,mBAAqB,SAChCvrB,EACA6E,EACAihB,GAEA,IAAM0F,EAAiBL,WAAWnrB,EAAS6E,EAAOif,QAASgC,EAASC,cAkBpE,MAAO,CACLhvB,QAjBc,SAAC00B,GACf,OAAOD,EAAeh0B,MACpB,SAACk0B,GACC,IAAM/U,EAAO+U,EAAQjM,MAAK,SAACkM,GACzB,OAAOA,EAAe9P,WAAa4P,EAAY5P,UAC1C8P,EAAeL,WAAaG,EAAYH,YAG/C,SAAI3U,IAAQA,EAAKiV,YAAYH,EAAYI,aAChClV,EAAKiV,YAAYH,EAAYI,iBCvDxCC,oBAAsB,SAC1BC,EACAC,EACAC,GAiBA,OAhBqD,SAACZ,EAAYa,GAChE,IAAMC,EAAmB,SAAC7O,GACxB,OAAAyO,EAAazO,GACV9lB,MAAK,SAACiN,GAAa,OAAAA,EAAS2nB,UAAUf,EAAMa,OAE3CG,EAA8BL,EAAkBX,GAChDiB,EAA+BL,EAAoBZ,GAEzD,OAAIiB,IAAyBD,EACpBF,EAAiBE,GAGnBF,EAAiBG,GACrB90B,MAAK,WAAM,OAAA20B,EAAiBE,QCjB7BE,iBAAmB,SACvBR,EACAC,EACAC,GACA,OAAA,SAACZ,EAAYa,GACX,IAAMM,EAAgB,SAACC,GACrB,OAAAV,EAAaU,GACVj1B,MAAK,SAACiN,GAAa,MACS,mBAApBA,EAASpJ,OACdoJ,EAASpJ,OAAOgwB,EAAMa,QACtBzuB,KAEHjG,MAAK,gBAEJ60B,EAAsBL,EAAkBX,GACxCiB,EAAuBL,EAAoBZ,GAEjD,OAAIgB,IAAwBC,EACnBE,EAAcH,GAGhBG,EAAcH,GAClB70B,MAAK,WAAM,OAAAg1B,EAAcF,QCxB1BI,cAAgB,SAACN,EAA0B/wB,GAK/C,OAJgB,SAACgwB,EAAYa,GAC3B,OAAA7wB,EAAOgwB,EAAMa,GACV10B,MAAK,WAAM,OAAA40B,EAAUf,EAAMa,QCQ5BS,aAAe,SACnBjpB,EACAqoB,EACAC,GAYA,OARe,SAACX,EAAYa,EAA4BU,GACtD,OAAAb,EAAaC,EAAkBX,IAC5B7zB,MAAK,SAACiN,GAEL,OAPgB,SAACA,GACrB,OAAAA,EAAS0C,QAAUzD,EAKImpB,CAAcpoB,EAC1BqoB,CAAWzB,EAAMa,EAAcU,MAEvCp1B,MAAK,iBCJNu1B,oBAAsB,WAC1B,IAAMC,EAAe,SAAC3B,EAAY4B,GAChC,OAAAn2B,QAAQ4zB,KAAMW,EAAmB6B,UAAY,IAAI5sB,KAAI,SAAC6sB,EAAahkB,GACjE,OAAA8jB,EAASE,EAAO,CAAEC,WAAY/B,EAAK/N,KAAMnU,MAAKA,SA2BlD,MAAO,CACLkkB,8BAfoC,SAACC,GACrC,IAAMC,EAAyC,SAAClC,EAAYa,GAC1D,OAAAoB,EAAkBjC,EAAMa,GACrB10B,MAAK,SAACg2B,GACL,IAAKA,EACH,OAAOR,EAAa3B,EAAMkC,GAAyB/1B,MAAK,mBAIhE,OAAO,SAAC6zB,EAAYa,GAClB,OAAAqB,EAAwBlC,EAAMa,GAC3B10B,MAAK,iBAKVi2B,8BA1BoC,SAACC,GACrC,IAAMC,EAAsC,SAACtC,EAAYa,GACvD,OAAAc,EAAa3B,EAAMsC,GAChBn2B,MAAK,WAAM,OAAAk2B,EAAerC,EAAMa,OAErC,OAAO,SAACb,EAAYa,GAClB,OAAAyB,EAAwBtC,EAAMa,GAC3B10B,MAAK,mBClCFo2B,sBAIAC,2BAJZ,SAAYD,GACVA,EAAA,SAAA,kBACAA,EAAA,KAAA,kBAFF,CAAYA,wBAAAA,sBAAqB,KAIjC,SAAYC,GACVA,EAAA,IAAA,gBACAA,EAAA,IAAA,qBACAA,EAAA,IAAA,qBAHF,CAAYA,4BAAAA,0BAAyB,KAsCrC,IAAMC,uBAAyB,SAACC,GAC9B,IAAMC,EAAa,IAAIC,IAajBhC,EAAsB,SAACZ,GACnB,IAAAuB,EAAevB,EAAIuB,WAI3B,OAH0BA,GAAcA,EAAWgB,sBAAsBM,WACvEL,0BAA0BM,KA0B9B,MAAO,CACLpC,aAzCmB,SAACzO,GACpB,IAAM7Y,EAAWupB,EAAW7yB,IAAImiB,GAChC,IAAK7Y,EAAU,CACb,IAAM2pB,EAAoBL,EAAwBzQ,KAC5C+Q,EAAcv3B,QAAQC,QAAOrB,SAAAA,SAAA,GAAM04B,GAAiB,CAAE9Q,KAAIA,KAEhE,OADA0Q,EAAW9yB,IAAIoiB,EAAM+Q,GACdA,EAET,OAAO5pB,GAkCPwnB,oBAAmBA,EACnBD,kBAxBwB,SAACX,GACjB,IAAAuB,EAAevB,EAAIuB,WAG3B,OAAIA,GAAcA,EAAWgB,sBAAsBU,MAC1C1B,EAAWgB,sBAAsBU,MAItC1B,GAAcA,EAAW2B,UACpBV,0BAA0BW,IAI/B5B,GAAcA,EAAW6B,iBACpBZ,0BAA0BM,IAG5BlC,EAAoBZ,MC3EzBqD,gBAAkB,SAAC1C,EAAsCC,GAU7D,OATkB,SAAC0C,EAAiBtD,GAClC,IAAMuD,EAAuB3C,EAAoBZ,GAEjD,OACEuD,IAAyB5C,EAAkB2C,IAC3CC,IAAyB3C,EAAoB0C,cCyCnCE,iBAAiBd,GACzB,IAwBAe,EAxBAluB,EAIFktB,uBAAuBC,GAHzBhC,EAAYnrB,EAAAmrB,aACZC,EAAiBprB,EAAAorB,kBACjBC,EAAmBrrB,EAAAqrB,oBAGf8C,EAAuBL,gBAAgB1C,EAAmBC,GAE1D+C,EAA+BjC,sBAE/BkC,EACJnD,oBAAoBC,EAAcC,EAAmBC,GACjDG,EAA2B4C,EAAc3B,8BAA8B4B,GAEvEC,EAAyC3C,iBAAiBR,EAAcC,EAAmBC,GAC3F5wB,EAAqB2zB,EAAcvB,8BAA8ByB,GAEjExrB,EAAyBgpB,cAAcN,EAAW/wB,GAClD8L,EAAqBwlB,aAAajpB,EAASqoB,EAAcC,GAKzDmD,GACAL,EAAoBh4B,QAAQC,UACzB,SAACq4B,GACN,OAAO,eAAC,IAAAlf,EAAA,GAAAmf,EAAA,EAAAA,EAAAr5B,UAAAC,OAAAo5B,IAAAnf,EAAAmf,GAAAr5B,UAAAq5B,GAEN,OADAP,EAAoBA,EAAkBt3B,MAAK,WAAM,OAAA43B,EAAiBj5B,WAAA,EAAI+Z,SAM5E,MAAO,CACL6e,UAASA,EACTrrB,QAASyrB,EAAMzrB,GACf0oB,UAAW+C,EAAM/C,GACjBjlB,OAAQgoB,EAAMhoB,GACd9L,OAAQ8zB,EAAM9zB,ICxFX,IAAM+vB,mBAAmB,SAAmDC,GACjF,OAAA31B,SAAAA,SAAA,GACK21B,GAAI,CACPxP,SAAUwP,EAAKxP,SAASzhB,QAAQ,KAAM,IACtCkxB,SAAUD,EAAKC,SAASlxB,QAAQ,KAAM,OAIpCk1B,qBAAuB,SAACC,GAC5B,IAAMC,EAAeD,EAAQ/0B,MAAM,KAAK8F,KAAI,SAAC8T,GAAgB,OAAAA,EAAIoL,UACjE,GAA4B,IAAxBgQ,EAAav5B,OACf,MAAM8M,MAAM,IAAIwsB,EAAO,qCAGzB,OAAOnE,mBAAiB,CACtBvP,SAAU2T,EAAa,GACvBlE,SAAUkE,EAAa,GACvB3D,UAAW2D,EAAa,MAItBC,yBAA2B,SAACC,GAGhC,IAFA,IAAMpF,EAA2D,GAExDx0B,EAAI,EAAGA,EAAI45B,EAAcz5B,OAAQH,GAAK,EAAG,CAChD,IAAMo0B,EAAQwF,EAAc55B,GAC5B,GAAIo0B,IAAUR,gBAAgBS,KAAOD,IAAUR,gBAAgBiG,GAC7D,MAAM5sB,MAAM,IAAImnB,EAAK,mCAGvB,IAAMqF,EAAUG,EAAc55B,EAAI,GACR,MAAtBy5B,EAAQx0B,OAAO,GACjBuvB,EAAW1xB,KAAK,CACdsxB,MAAKA,EACLI,WAAY,CAAA50B,SAAAA,SAAA,GACP45B,qBAAqBC,EAAQvc,OAAO,KAAG,CAC1CkX,MAAOR,gBAAgBU,IACvBnF,KAAM,mBAIVqF,EAAW1xB,KAAIlD,SAAAA,SAAA,GACV45B,qBAAqBC,IAAQ,CAChCrF,MAAKA,EACLjF,KAAM,iBAKZ,OAAOqF,GAKIsF,6BAA+B,SAACC,GAC3C,IAAMH,EAAgBG,EACnBrQ,OACAhlB,MAAM,KACNmG,QAAO,SAACmvB,GAAmB,MAAW,KAAXA,KAE9B,OAAOL,yBAAyB,CAAC,OAAO3P,OAAO4P,KCnD3CK,0BAA4B,UAC5BC,qBAAuB,UAEvBC,sBAAwB,SAAC3S,EAAcpmB,GAC3C,OAAOomB,EAAKnK,WAAW4c,4BAA+C,iBAAV74B,GAajDg5B,uBAAyB,SAAC5F,EAAwBxE,GAC7D,IAAMqK,EAAsB,SAACC,GAC3B,IAAMC,EAAuBT,6BAA6BQ,GAC1D,OAAO9F,EAAWD,kBAAkBgG,IAuChCC,EAAoB,SAAC1D,GACzB,IAAM2D,EAAcz7B,OAAOuL,KAAKusB,GAAYpU,QAC1C,SAAC2P,EAAuCqI,GACtC,IAAMC,EAAgB7D,EAAW4D,GACjC,GAAIP,sBAAsBO,EAAcC,GAAgB,CACtD,IAAMC,EAzCqB,SAACD,GAClC,IACE,IAAME,EAAc52B,KAAKkB,MAAMw1B,GAC/B,OAAOnG,EAAWO,aAAa8F,GAC/B,MAAOt6B,GACP,GAAIyvB,EAASC,aAAaC,QACxB,IACE,OAAOmK,EAAoBM,GAC3B,MAAOp6B,GACP,OAAOS,QAAQC,SAAQ,GAI3B,OAAOD,QAAQC,QAAQ05B,IA4BMG,CAA2BH,GACjDj5B,MAAK,SAACyyB,GACL,MAAO,CACLuG,aAAYA,EACZvG,WAAUA,MAGhB9B,EAAIvvB,KAAK83B,GAEX,OAAOvI,IAET,IAEF,OAAOrxB,QAAQ4zB,IAAI6F,GAAa/4B,KArCD,SAACo1B,GAA2B,OAAA,SAACiE,GAC5D,OAAOA,EAAcrY,QAAO,SAACsY,EAAsBJ,SAC3CpT,EAAOoT,EAAiBF,aAC9B,GAAI5D,EAAWtP,KAAUoT,EAAiBzG,WACxC,OAAO6G,SAEFA,EAASxT,GAChB,IAAMmL,EAAUnL,EAAKtK,OAAO+c,0BAA0B95B,QACtD,GAAI66B,EAAS37B,eAAeszB,GAC1B,MAAM1lB,MAAM,2BAA2Bua,EAAI,SAASmL,EAAO,+CAE7D,OAAA/yB,SAAAA,SAAA,GACKo7B,KAAQlwB,EAAA,IACV6nB,GAAUiI,EAAiBzG,WAAUrpB,MAEzClL,SAAA,GACIk3B,KAqBgCmE,CAAyBnE,KAmB1DoE,EAAc,SAA4C3F,GAC9D,OAAOiF,EAAkBjF,EAAKuB,YAC3Bp1B,MAAK,SAACo1B,GACL,GAAIA,EAAWz3B,eAAe66B,sBAAuB,CACnD,IAAyC,IAArCpD,EAAWoD,sBACb,OAAOl5B,QAAQC,aAAQ0G,UAElBmvB,EAAWoD,sBAGpB,OA1BkB,SAA4C3E,GAClE,IAAM6B,EAAW7B,EAAK6B,SACtB,OAAIA,GAAYA,EAASj3B,OAChBa,QAAQ4zB,IAAIwC,EAAS5sB,IAAI0wB,IAC7Bx5B,MAAK,SAACy5B,GAAqB,OAAAA,EAAiBtwB,QAC3C,SAACuwB,GAAmD,QAAEA,QAEvD15B,MAAK,SAAC25B,GAAgB,OAAAz7B,SAAAA,SAAA,GAClB21B,GAAI,CACP6B,SAAUiE,OAITr6B,QAAQC,QAAQs0B,GAaZ+F,CAAe17B,SAAAA,SAAA,GAAS21B,GAAI,CAAEuB,WAAUA,SAIrD,MAAO,CACLoE,YAAWA,EACXb,oBAAmBA,aCtDPkB,aAAaC,QAAA,IAAAA,IAAAA,EAAAjyB,SAC3B,IAAMkyB,EAAe,IAAItD,IAEnBuD,EAAe,SAACC,GACpB,OAAAF,EAAap2B,IAAIs2B,IAAc,IAsBjC,SAASlY,EAAekY,EAAsBC,GAC5C,IACMC,EADYH,EAAaC,GACA9wB,QAAO,SAACixB,GAAoB,OAAAA,IAAoBF,KAC/EH,EAAar2B,IAAIu2B,EAAWE,GAO9B,MAAO,CACLhT,QA/BF,SAAoB8S,EAAsBI,GACtBL,EAAaC,GACrB3I,SAAQ,SAAC4I,GACjB,IACEA,EAASG,GACT,MAAOvyB,GACPgyB,EAAOhyB,MAAMA,QA0BjBga,UArBF,SAAsBmY,EAAsBC,GAC1C,IACMC,EAAY94B,eADA24B,EAAaC,GACG,CAAEC,IAEpC,OADAH,EAAar2B,IAAIu2B,EAAWE,GACrB,WACLpY,EAAekY,EAAWC,KAiB5BnY,YAAWA,EACXuY,eARF,WACEP,EAAaQ,UCtGjB,SAASC,iBACP,OAAOl7B,QAAQC,QAAQ,IAGzB,SAASk7B,cAAcnyB,EAA0BsF,EAAcmW,GAA/D,IAAAoG,EAAArsB,KACE,SAAS48B,EAAWC,EAAkBC,GACpC,IAAMC,EAAWF,EAAMC,GAGvB,OAFAC,EAAIC,WAAY,EAChBD,EAAIE,UAAW,EACXF,EAAInF,SAASj3B,OACfP,SAAAA,SAAA,GACK28B,GAAG,CACNnF,SAAUmF,EAAInF,SAAS5sB,KAAI,SAACkyB,GAAoB,OAAAN,EAAWC,EAAOK,QAG/DH,EAGT,OAAO,SAAOI,GAAY,OAAAh8B,UAAAkrB,OAAA,OAAA,GAAA,iFAClB+Q,EAAkBD,EAAK73B,MAAM63B,EAAKn8B,QAAQ,KAAO,GACjDq8B,EAASpX,EAAS,IAAIA,EAAW,oBAI5B,6BAAA,CAAA,EAAMzb,EAAY,CACzBuH,OAAQ,MACRpJ,IAAQmH,EAAI,cAAcutB,EAAM,yBAFlCr7B,EAASsJ,EAAA5I,oBAKA,gBAAA,CAAA,EAAM8H,EAAY,CACzBuH,OAAQ,MACRpJ,IAAQmH,EAAI,oCAFd9N,EAASsJ,EAAA5I,oBAKX,MAAA,CAAA,EAAOk6B,EAAWn4B,KAAKkB,MAAM3D,EAAOI,MAAOg7B,qBAI/BE,uBAAuB9yB,EAA0BsF,EAAcmW,GAC7E,MAAO,CACLsX,QAASZ,cAAcnyB,EAAasF,EAAMmW,GAC1CyW,eAAcA,gBCpCX,IAAMc,gBAAkB,SAACD,EAAkB7B,GAChD,OAAO,SAACyB,EAAcM,GAAkB,OAAAF,EAAQJ,EAAMM,GACnDv7B,MAAK,SAAC6zB,GAAuB,OAAA2F,EAAY3F,MACzC7zB,MAAK,SAACw7B,GACL,QAAqBv1B,IAAjBu1B,EACF,MAAM,IAAIjwB,MAAM,qCAGlB,OAAOiwB,OChBDC,gBCAAC,gBCAAC,YAWAC,sBCTAC,sBCwCIC,iBACd5M,EACA5mB,EACAkxB,EACAzV,GAEA,IAAMgY,EAAaX,uBAAuB9yB,EAAa4mB,EAAqBnL,GAEtEsX,EAAU7B,EACZ8B,gBAAgBS,EAAWV,QAAS7B,GACpCuC,EAAWV,QAEf,OAAAn9B,SAAAA,SAAA,GACK69B,GAAU,CACbV,QAAOA,aCpBKW,2BAA2BxzB,GA0CzC,MAzCsC,CACpC7E,IAAK,SAACs4B,GACJ,OAAO38B,QAAQC,QAAQgD,KAAKkB,MAAMw4B,KAEpCC,WAAY,SACVD,EACAz2B,GAEA,IAAM22B,EAAU55B,KAAKkB,MAAMw4B,GAC3B,OAAOzzB,EAAQ,CACbqH,OAAQ,MACRpJ,IAAK01B,EAAQ11B,MACZzG,MAAK,SAACo8B,GAAsB,OAAA75B,KAAKkB,MAAM24B,EAAIl8B,UAOhDm8B,eAAgB,SACdJ,EACAz2B,GAEA,IAAM22B,EAAU55B,KAAKkB,MAAMw4B,GACrBpI,EAAO,CACX9jB,KAA4C,IAAtCosB,EAAQG,SAASx9B,QAAQ,SAAiB+8B,QAAAA,aAAaU,MAAQV,QAAAA,aAAaW,SAClFL,QAAOA,GAET,OAAO78B,QAAQC,QAAQs0B,IAEzB4I,uBAAwB,SACtBC,EACA1D,EACArpB,GACG,OAAA,cACLgtB,2BAA4B,SAC1BD,EACA1D,EACArpB,GACG,OAAA,wBCzBO1R,OACdovB,EACA2C,EACAnjB,EACAkvB,EACAa,EACA9M,EACAnjB,EACAkwB,EACAt0B,EACAu0B,GACA,IAAIC,EAEEC,EAAS,WACb,OAAID,IAGA34B,OAAO64B,IAAM74B,OAAO64B,GAAGC,eACzBH,EAAQ34B,OAAO64B,GAAGC,eAAe,CAC/BpN,KAAM,WAAM,OAAAA,GACZnjB,iBAAkB,WAAM,OAAAA,GACxB0gB,WAAY,WAAM,OAAAA,GAClB8P,SAAU,WAAM,OAAAtwB,GAChBkvB,WAAY,WAAM,OAAAA,GAClBa,cAAe,WAAM,OAAAA,GACrBQ,MAAO,WAAM,OAAA,SAACC,GACZ,OAAA/9B,QAAQ4zB,IAAI,CAAClD,EAAW,gBAAiBgN,MAAWh9B,MAAK,SAACoJ,OAACrF,EAAMqF,EAAA,GAAEk0B,EAAKl0B,EAAA,GACtE,OAAArF,EAAO9F,OAAOq/B,EAAOD,QAEzBnxB,QAAS,WAAM,OAAA2wB,EAAc3wB,QAAQghB,KAAK2P,IAC1Ct0B,UAAW,WAAM,OAAAA,GACjBuqB,WAAY,WAAM,MAAA,CAChB6F,oBAAqBmE,EAAiBnE,wBAOrCr5B,QAAQE,OAAO,IAAI+L,MAAM,wCAGlC,MAAO,CACLqpB,UAAW,SAACf,EAAYa,GACtB,OAAAsI,IACGh9B,MAAK,SAACs9B,GAA6B,OAAAA,EAAM1I,UAAUf,EAAMa,MACzD10B,MAAK,WAAM,OAAA,MAEhB2P,OAAQ,SAACkkB,EAAYa,EAA4BU,GAC/C,OAAA4H,IAASh9B,MAAK,SAACs9B,GAA6B,OAAAA,EAAM3tB,OAAOkkB,EAAMa,EAAcU,OAE/EvxB,OAAQ,SAACgwB,EAAYa,GACnB,OAAAsI,IAASh9B,MAAK,SAACs9B,GAA6B,OAAAA,EAAMz5B,OAAOgwB,EAAMa,SNvGrE,SAAY+G,GACVA,EAAA,IAAA,kBACAA,EAAA,KAAA,aACAA,EAAA,KAAA,YAHF,CAAYA,kBAAAA,gBAAe,KCA3B,SAAYC,GACVA,EAAA,SAAA,aACAA,EAAA,WAAA,iBACAA,EAAA,cAAA,oBACAA,EAAA,OAAA,YACAA,EAAA,uBAAA,4BACAA,EAAA,iBAAA,sBACAA,EAAA,OAAA,YACAA,EAAA,KAAA,YACAA,EAAA,qBAAA,wBACAA,EAAA,MAAA,WAVF,CAAYA,kBAAAA,gBAAe,KCAfC,YAAAA,QAAAA,cAAAA,QAAAA,YAAW,IACrBA,YAAA,SAAA,gBACAA,YAAA,OAAA,cACAA,YAAA,MAAA,WACAA,YAAA,mBAAA,uBACAA,YAAA,UAAA,iBAMUC,sBAAAA,QAAAA,wBAAAA,QAAAA,sBAAqB,IAC/BA,sBAAA,WAAA,oBACAA,sBAAA,UAAA,mBCXUC,aAAAA,QAAAA,eAAAA,QAAAA,aAAY,IACtBA,aAAA,SAAA,gBACAA,aAAA,MAAA,WACAA,aAAA,mBAAA,2BI8BW0B,cAA+B,SAAOC,EAAqBV,GAAkC,OAAA79B,eAAA,OAAA,OAAA,GAAA,+EAK3F,OAJPw+B,EAAkB,CACtB3X,KAAM0X,EAAS1X,KACfsP,WAAYoI,EAASpI,YAEV,CAAA,EAAM0H,EAAiBtD,YAAkBiE,WACtD,OADar0B,EAAA5I,OAMb,CAAA,GAAO,IAJCiP,EAAU,SAAS+tB,EAAS1X,KAAI,qCACtChkB,SAAS5B,KAAKw9B,UAAY,OAAOjuB,EAAO,QACxC,CAAA,GAAO,YAKX,SAAekuB,OAAOC,EAAsBd,EAAoCe,yHAC1D,MAAA,CAAA,EAAMN,cAAcK,EAAWd,WACnD,OADoB1zB,EAAA5I,OAIE,CAAA,EAAMs8B,EAAiBtD,YAAuBoE,IAFlE,CAAA,EAAO,WAST,OAPME,EAAgB10B,EAAA5I,OAChBu9B,EAAeD,EAAgBA,EAAcpI,SAAW,GAExDsI,EAAeD,EAAaj1B,KAAI,SAAC+qB,EAAYliB,GACjD,IAAM+iB,EAAe,CAAEkB,WAAYgI,EAAU9X,KAAMnU,MAAKA,GACxD,OAAOksB,EAAWjJ,UAAUf,EAAMa,MAEpC,CAAA,EAAOp1B,QAAQ4zB,IAAI8K,WAYrB,SAASC,mBAAmB5wB,GAC1B,IAAMsa,EAAUta,EAAOsa,SAAWta,EAAO0W,OACzC,OAAA7lB,SAAAA,SAAA,GACKmP,GAAM,CACT4hB,QAAS,IACTnB,WAAY,GACZqB,SAAU,GACVrC,WAAY,QACZsC,gBAAiB,GACjBC,YAAa,GACb5qB,SAAU,GACV6qB,SAAU,GACVG,OAAQ,GACR9H,QAAOA,EACPqI,WAAY,WAAM,OAAA1wB,QAAQC,sBAId2+B,WAAWC,SACnB9wB,EAA2BqiB,iBAAiBuO,mBAAmBE,IAC/D9Q,EAAyBhgB,EAAOggB,WAChC4C,EAAiC5iB,EAAO4iB,eACxCxjB,EAA0BY,EAAOZ,WAEjCE,EAAqCglB,yBACrCrpB,EAA2B81B,QAAkBzxB,GAE7C0xB,EAAgCjM,mBACtC,GAAInC,EAAe1B,aAAaC,QAAS,CACvC,IAAMD,EAA6BwF,mBAAmBzrB,EAAa+kB,EAAY4C,GAC/EoO,EAAkB5K,YAAY,cAAelF,EAAahvB,SAG5D,IAAMgJ,EAAuB4pB,kBACvBtlB,EAAiBgtB,eAEjBjtB,EAA+B,CACnCmX,OAAQsJ,EAAWtJ,OACnB4D,QAAS0F,EAAW1F,QACpBza,WAAY,IACZ4f,YAAY,EACZvf,iBAAiB,EACjB+e,QAASe,EAAWf,SAEhBwD,EAAqBtjB,WAAWC,EAAY6xB,mBAChD3xB,EAAkBrE,EAAaC,EAAWqE,EAAWC,GAEjDiwB,EAAqCpE,uBAAuB2F,EAAmBpO,GAC/E6C,EAA4D,CAChE6F,oBAAqBmE,EAAiBnE,qBAGlCoD,EACJD,iBAAiBzO,EAAW6B,oBAAqB5mB,EAAaw0B,EAAiBtD,YAAanM,EAAWtJ,QAGnG6Y,EAA+BZ,2BAA2B1zB,GAI1Du0B,EAA+B,CACnC3wB,QAAO,WAAS,OAAA5M,QAAQC,YAGpBs+B,EAAyBxG,mBAAgBjuB,EAAA,IAC5C,sBAAuB,WAAM,OAAAm1B,OAAsBlR,GAClD,WAAM,OAAA/tB,QAAQC,YAAWsN,EAAQkvB,EACjCa,EAAe9M,EAAMnjB,EAAkBkwB,EAAet0B,EAAWu0B,IACnE1zB,EAAC,iBAAkB,WAAyB,MAAA,CAC1CwrB,UAAW,WAAM,OAAAt1B,QAAQC,WACzBoQ,OAAQ,WAAM,OAAArQ,QAAQC,WACtBsE,OAAQ,WAAM,OAAAvE,QAAQC,iBAI1B,MAAO,CACLu9B,iBAAgBA,EAChBe,WAAUA,EACVxQ,WAAUA,EACVxgB,OAAMA,EACNkvB,WAAUA,EACVa,cAAaA,EACb9M,KAAIA,EACJnjB,iBAAgBA,EAChBkwB,cAAaA,EACbt0B,UAASA,EACTuqB,WAAUA,YAIQ8B,UAAUuJ,EAA8BP,kGAM5D,OALMx0B,EAGF80B,WAAWC,GAFbrB,EAAgB1zB,EAAA0zB,iBAChBe,EAAUz0B,EAAAy0B,WAGZ,CAAA,EAAOF,OAAOC,EAAWd,EAAkBe","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","!function(e){var n=!1;if(\"function\"==typeof define&&define.amd&&(define('vendor-bb-cookie-js',[],e),n=!0),\"object\"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,r,i){var c;if(\"undefined\"!=typeof document){if(arguments.length>1){if(\"number\"==typeof(i=e({path:\"/\"},t.defaults,i)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():\"\";try{/^[\\{\\[]/.test(c=JSON.stringify(r))&&(r=c)}catch(e){}r=o.write?o.write(r,n):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\\(\\)]/g,escape);var s=\"\";for(var f in i)i[f]&&(s+=\"; \"+f,!0!==i[f]&&(s+=\"=\"+i[f]));return document.cookie=n+\"=\"+r+s}n||(c={});for(var p=document.cookie?document.cookie.split(\"; \"):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<p.length;u++){var l=p[u].split(\"=\"),C=l.slice(1).join(\"=\");this.json||'\"'!==C.charAt(0)||(C=C.slice(1,-1));try{var g=l[0].replace(d,decodeURIComponent);if(C=o.read?o.read(C,g):o(C,g)||C.replace(d,decodeURIComponent),this.json)try{C=JSON.parse(C)}catch(e){}if(n===g){c=C;break}n||(c[g]=C)}catch(e){}}return c}}return t.set=t,t.get=function(e){return t.call(t,e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,\"\",e(o,{expires:-1}))},t.withConverter=n,t}return n(function(){})});","export type UnixTimeSeconds = number;\nexport type Seconds = number;\nexport type Base64Jwt = string;\n\nexport interface StoredSession {\n  accessExpiry: UnixTimeSeconds;\n  timeSkew: Seconds;\n  refreshToken?: Base64Jwt;\n  isImpersonated: boolean;\n}\n\nexport interface SessionOptions {\n  timeSkew?: number;\n  refreshToken?: Base64Jwt;\n  forceSessionCookie?: true;\n  isImpersonated?: true;\n}\n\nexport type BackbaseSession = StoredSession & { token?: Base64Jwt };\n\nexport interface AuthSession {\n  getSession: () => BackbaseSession | null;\n  create: (\n    sessionInfo: Base64Jwt | number,\n    options?: SessionOptions,\n  ) => BackbaseSession;\n  getTtl: () => Seconds;\n  destroy: () => void;\n}\n\nexport interface CookieOptions {\n  path: string;\n  expires?: Date;\n  secure: boolean;\n}\n\nexport declare interface Cookie {\n  set: (name: string, token: Base64Jwt, options?: CookieOptions) => void;\n  remove: (name: string, options?: CookieOptions) => void;\n  get: (name: string) => string | undefined;\n}\n\nconst parseJwt = (token: string): any => {\n  const base64Url = token.split('.')[1];\n  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  return JSON.parse(window.atob(base64));\n};\n\nconst BB_AUTH = 'BB-Auth';\n\nexport default (storage: Storage, cookie: Cookie, linkRoot?: string): AuthSession => {\n  const isSessionValid = (storedSession: StoredSession): boolean => {\n    const ttl = getTtl(storedSession);\n    return ttl > 0;\n  };\n\n  const getSession = (): BackbaseSession | null => {\n    const sessionStringified = storage.getItem(BB_AUTH);\n    if (sessionStringified) {\n      const storedSession: StoredSession = JSON.parse(sessionStringified);\n      if (isSessionValid(storedSession)) {\n        return { ...storedSession, token: cookie.get('Authorization') };\n      }\n    }\n    /* tslint:disable no-null-keyword */\n    return null;\n    /* tslint:enable no-null-keyword */\n  };\n\n  const getCookieOptions = (expiryDate: Date, forceSessionCookie?: true): CookieOptions => ({\n    path: (linkRoot as string) || '/',\n    secure: window.location.protocol === 'https:',\n    expires: forceSessionCookie ? undefined : expiryDate,\n  });\n\n  let cookieOptions: CookieOptions;\n\n  const create = (\n    sessionInfo: Base64Jwt | UnixTimeSeconds,\n    options?: SessionOptions,\n  ): BackbaseSession => {\n    const isImpersonated = (options && options.isImpersonated) || false;\n    const timeSkew = options?.timeSkew || 0;\n\n    let token: string | undefined;\n    let accessExpiry: number;\n    // CX / Identity session\n    if (typeof sessionInfo === 'string') {\n      token = sessionInfo;\n      const parsedToken = parseJwt(token);\n      accessExpiry = parsedToken.exp;\n\n      cookieOptions = getCookieOptions(new Date(parsedToken.exp * 1000), options?.forceSessionCookie);\n      cookie.set('Authorization', token, cookieOptions);\n    // CX / bas session\n    } else {\n      token = undefined;\n      accessExpiry = sessionInfo;\n    }\n\n    const storedSession: StoredSession = {\n      accessExpiry,\n      timeSkew,\n      refreshToken: options?.refreshToken,\n      isImpersonated,\n    };\n    storage.setItem(BB_AUTH, JSON.stringify(storedSession));\n    return { ...storedSession, token };\n  };\n\n  const getTtl = (bbSession: StoredSession | null = getSession()): Seconds => {\n    if (!bbSession) {\n      return -1;\n    }\n    const now = Math.floor(Date.now() / 1000);\n    return Math.floor((bbSession.accessExpiry - now) + bbSession.timeSkew);\n  };\n\n  const destroy = () => {\n    storage.removeItem(BB_AUTH);\n    cookie.remove('Authorization', cookieOptions);\n  };\n\n  return {\n    getSession,\n    create,\n    getTtl,\n    destroy,\n  };\n};\n","export type ResolveRedirectPageUrl = (loginPageUrl: string, redirectPageUrl: string) => string | undefined;\nexport type Redirect = (url: string, onInfiniteLoop?: () => void) => void;\nexport type IsExternal = (url: string) => boolean;\n\nconst redirectTreshold = 10000;\nconst REPLACE_LOCATION_PREFIX = 'REPLACE_LOCATION_';\n\nfunction isInfiniteLoop(url: string): boolean {\n  const REPLACE_LOCATION_KEY = REPLACE_LOCATION_PREFIX + url;\n  const stringifiedDate = sessionStorage.getItem(REPLACE_LOCATION_KEY);\n  const now = new Date();\n  const utcStringfied = now.toUTCString();\n  if (stringifiedDate) {\n    const dateLastReplace = new Date(stringifiedDate);\n    if (now.getTime() - dateLastReplace.getTime() < redirectTreshold) {\n      sessionStorage.removeItem(REPLACE_LOCATION_KEY);\n      return true;\n    }\n  }\n  sessionStorage.setItem(REPLACE_LOCATION_KEY, utcStringfied);\n  return false;\n}\n\nfunction isUrlAbsolute(url: string) {\n  if (url.indexOf('//') === 0) {return true; } // URL is protocol-relative (= absolute)\n  if (url.indexOf('://') === -1) {return false; } // URL has no protocol (= relative)\n  if (url.indexOf('.') === -1) {return false; } // URL does not contain a dot, i.e. no TLD (= relative, possibly REST)\n  if (url.indexOf('/') === -1) {return false; } // URL does not contain a single slash (= relative)\n  if (url.indexOf(':') > url.indexOf('/')) {return false; } // The first colon comes after the first slash (= relative)\n  if (url.indexOf('://') < url.indexOf('.')) {return true; } // Protocol is defined before first dot (= absolute)\n  return false; // Anything else must be relative\n}\n\nfunction getOrigin(url: string, location: Location = window.location): string {\n  if (isUrlAbsolute(url)) {\n    const a = window.document.createElement('a');\n    a.href = url;\n    const origin = a.origin;\n    a.remove();\n    return origin;\n  }\n  return location.origin;\n}\n\nexport const isExternal = (url: string, location: Location = window.location): boolean => {\n  const origin = getOrigin(url, location);\n  return origin !== location.origin;\n};\n\nexport function normalizeRedirectUrl(redirectUrl: string, location: Location = window.location): string | undefined {\n  if (isExternal(redirectUrl, location) || redirectUrl === '') {\n    return;\n  }\n  const a = window.document.createElement('a');\n  a.href = redirectUrl;\n  a.protocol = location.protocol;\n  a.host = location.host;\n  // In IE11 if port is empty string then browser will append port 0 on assignment.\n  if (location.port) {\n    a.port = location.port;\n  }\n  const href = a.href;\n  a.remove();\n  return href;\n}\n\nexport const redirect: Redirect = (\n  redirectUrl: string,\n  onInfiniteLoop: () => void = () => {},\n  location: Location = window.location,\n) => {\n  if (isInfiniteLoop(redirectUrl)) {\n    console.error(\n      'Redirect to url: ' +\n        redirectUrl +\n        ' is requested too many times in a period of ' +\n        redirectTreshold +\n        ', please check your experience configuration.',\n    );\n    onInfiniteLoop();\n    return;\n  }\n  // avoid reliance on isExternal implemenation\n  // and always enforce current location origin!\n  const normalizedUrl = normalizeRedirectUrl(redirectUrl, location);\n  if (!normalizedUrl) {\n    console.error(messageOnExternalRedirectIntent);\n    return;\n  }\n  location.replace(normalizedUrl);\n};\n\nconst messageOnExternalRedirectIntent =\n  'User cannot be redirected to external url. Please check your configuration.';\n\nexport const resolveRedirectUri = (loginPageUrl: string, redirectPageUrl: string) => {\n  if (isExternal(redirectPageUrl)) {\n    console.warn(messageOnExternalRedirectIntent);\n    return;\n  }\n  return `${loginPageUrl}${(loginPageUrl.indexOf('?') > -1 ? '&' : '?')}redirect=${redirectPageUrl}`;\n};\n","import { HttpRequest } from 'lib-bb-http';\nimport { Cookie } from './session';\nimport { Redirect, IsExternal, ResolveRedirectPageUrl,\n  isExternal, resolveRedirectUri, redirect } from './redirect';\nimport { SetLocale } from 'lib-bb-set-locale';\n\nexport interface AuthUtils {\n  request: HttpRequest;\n  encode: (hash: { [key: string]: string | undefined }) => string;\n  getQueryStringValue: (key: string) => string;\n  setLocale: SetLocale;\n  cookie: Cookie;\n  redirect: Redirect;\n  isExternal: IsExternal;\n  resolveRedirectUri: ResolveRedirectPageUrl;\n}\n\nexport function createUtils(httpRequest: HttpRequest, setLocale: SetLocale, cookie: Cookie): AuthUtils {\n  return {\n    request: httpRequest,\n    encode,\n    getQueryStringValue,\n    setLocale,\n    cookie,\n    redirect,\n    resolveRedirectUri,\n    isExternal,\n  };\n}\n\nconst entries = (obj: { [key: string]: string | undefined }): Array<[string, string | undefined]> =>\n  Object.keys(obj).map<[string, string | undefined]>((key) => [key, obj[key]]);\n\nconst isValueDefined = (entry: [string, string | undefined]): entry is [string, string] =>\n  entry[1] !== undefined;\n\nexport const encode = (hash: { [key: string]: string | undefined }): string => {\n  const pairs = entries(hash);\n  const definedPairs = pairs.filter<[string, string]>(isValueDefined);\n  const encoded = definedPairs.map(([key, value]) =>\n    `${encodeURIComponent(key)}=${encodeURIComponent(value)}`,\n  );\n  return encoded.join('&');\n};\n\nexport const getQueryStringValue = (key: string): string => {\n  const encodedKey = encodeURIComponent(key).replace(/[\\.\\+\\*]/g, '\\\\$&');\n  return decodeURIComponent(\n    window.location.search.replace(\n      new RegExp(\n        `^(?:.*[&\\\\?]${encodedKey}(?:\\\\=([^&]*))?)?.*$`, 'i',\n      ), '$1',\n    ),\n  );\n};\n\nexport type RepeatCallback = (repeat: () => void) => void;\n\nexport const runEverySecond = (callback: RepeatCallback) => {\n  setTimeout(() => {\n    callback(() => {\n      runEverySecond(callback);\n    });\n  }, 1000);\n};\n","import { HttpRequestConfig, Headers } from 'lib-bb-http';\nimport { HttpInterceptor, HttpHandler } from 'lib-bb-http-interceptors';\nimport { IsExternal } from './redirect';\n\ntype GetCookie = (name: string) => string | undefined;\n\nconst CXP5_XSRF_COOKIE = 'BBXSRF';\nconst CXP5_XSRF_HEADER = 'X-BBXSRF';\n\nconst CXP6_XSRF_COOKIE = 'XSRF-TOKEN';\nconst CXP6_XSRF_HEADER = 'X-XSRF-TOKEN';\n\nconst createXsrfInterceptor = (\n  addXsrfToken: (headers: Headers) => Headers, isExternal: IsExternal): HttpInterceptor => {\n  return (httpConfig: HttpRequestConfig, next: HttpHandler) => {\n    if (httpConfig.url && isExternal(httpConfig.url)) {\n      return next(httpConfig);\n    }\n    return next({\n      ...httpConfig,\n      headers: addXsrfToken(httpConfig.headers || {}),\n    });\n  };\n};\n\nexport default (getCookie: GetCookie, isExternal: IsExternal): HttpInterceptor => {\n  const addXsrfToken = (headers: Headers) => {\n    const token5: string | undefined = getCookie(CXP5_XSRF_COOKIE);\n    if (token5) {\n      return {\n        ...headers,\n        [CXP5_XSRF_HEADER]: token5,\n      };\n    }\n\n    const token6: string | undefined = getCookie(CXP6_XSRF_COOKIE);\n    if (token6) {\n      return {\n        ...headers,\n        [CXP6_XSRF_HEADER]: token6,\n      };\n    }\n\n    return headers;\n  };\n  return createXsrfInterceptor(addXsrfToken, isExternal);\n};\n","import { Seconds } from './session';\nimport { RepeatCallback, runEverySecond } from './utils';\n\nexport interface Countdown {\n  start: () => void;\n  reset: () => void;\n  end: () => void;\n  tick?: (remaining: Seconds) => void;\n  duration?: Seconds;\n}\n\nconst initTimers = (\n  duration: Seconds,\n  countdown: Countdown,\n  getTtl: () => Seconds,\n  run: (callback: RepeatCallback) => void,\n) => {\n  // runs every second when ttl is within countdown duration\n  const listenCountdown: RepeatCallback = (repeat: () => void) => {\n    const ttl = getTtl();\n    if (ttl < duration) {\n      if (ttl > 0) {\n        if (countdown.tick) {\n          countdown.tick(ttl);\n        }\n        repeat();\n      } else {\n        countdown.end();\n        run(listenForCountdownStart);\n      }\n    } else {\n      countdown.reset();\n      run(listenForCountdownStart);\n    }\n  };\n\n  // runs every second when ttl is ouside countdown duration\n  const listenForCountdownStart: RepeatCallback = (repeat: () => void) => {\n    const ttl = getTtl();\n    if (ttl > -1 && ttl <= duration) {\n      countdown.start();\n      if (countdown.tick) {\n        countdown.tick(ttl);\n      }\n      run(listenCountdown);\n    } else {\n      repeat();\n    }\n  };\n\n  run(listenForCountdownStart);\n};\n\nexport default (\n  getTtl: () => Seconds,\n  countdownDuration?: Seconds,\n): (countdown: Countdown) => () => void => {\n  let hasRegistered = false;\n\n  return (countdown: Countdown) => {\n    if (hasRegistered) {\n      throw new Error('Session handler is already registered!');\n    }\n    hasRegistered = true;\n    const duration =\n      countdownDuration\n      || countdown.duration\n      || 30;\n\n    const run = (callback: RepeatCallback) => {\n      if (hasRegistered) {\n        runEverySecond(callback);\n      }\n    };\n\n    initTimers(duration, countdown, getTtl, run);\n\n    return () => {\n      hasRegistered = false;\n    };\n  };\n};\n","import { Seconds, UnixTimeSeconds } from './session';\nimport { runEverySecond } from './utils';\n\nconst addListeners = (callback: () => void, window: Window) => {\n  let supportsPassive = false;\n  try {\n    const opts = Object.defineProperty({}, 'passive', {\n      get: () => {\n        supportsPassive = true;\n      },\n    });\n    window.addEventListener('testPassive', opts, opts);\n    window.removeEventListener('testPassive', opts, opts);\n  } catch (e) { }\n  const options = supportsPassive ? { passive: true, capture: true } : true;\n\n  window.document.addEventListener('mousemove', callback, options);\n  window.document.addEventListener('mousedown', callback, options);\n  window.document.addEventListener('keydown', callback, options);\n  window.document.addEventListener('mousewheel', callback, options);\n  window.document.addEventListener('touchmove', callback, options);\n};\n\nexport default (\n  getTtl: () => Seconds,\n  maxInactivityDuration: Seconds,\n  refresh: () => Promise<void>,\n  logout: (redirectPageUrl?: string) => Promise<void>,\n  window: Window,\n): () => Seconds => {\n  let lastActive: number = Date.now();\n  let refreshInProgress = false;\n\n  const getInactivityDuration = (): Seconds => {\n    const now: UnixTimeSeconds = Math.floor(Date.now() / 1000);\n    const last: UnixTimeSeconds = Math.floor(lastActive / 1000);\n    return Math.floor(now - last);\n  };\n\n  const getInactivityTtl = (): Seconds => maxInactivityDuration - getInactivityDuration();\n\n  const setActive = () => {\n    lastActive = Date.now();\n  };\n\n  addListeners(setActive, window);\n\n  runEverySecond((repeat: () => void) => {\n    if (getInactivityTtl() <= 0) {\n      logout(window.location.href);\n      return;\n    }\n\n    if (getTtl() < 10) {\n      if (!refreshInProgress) {\n        refreshInProgress = true;\n        refresh();\n      }\n    } else {\n      refreshInProgress = false;\n    }\n    if (getTtl() > 0) {\n      repeat();\n    }\n  });\n\n  return getInactivityTtl;\n};\n","/**\n * @module lib-bb-auth\n * @description Library to abstract Authentication\n */\nimport type { AuthConfigs } from 'lib-bb-page-config';\nimport type { HttpRequest } from 'lib-bb-http';\nimport type { HttpInterceptor, HttpInterceptors } from 'lib-bb-http-interceptors';\n// @ts-ignore\nimport * as cookie from 'vendor-bb-cookie-js';\n\nimport createAuthSession from './session';\nimport type { AuthSession, Seconds } from './session';\nimport { createUtils } from './utils';\nimport type { AuthUtils } from './utils';\nimport createXsrfInterceptor from './xsrf';\nimport createCountdown from './countdown';\nimport type { Countdown } from './countdown';\nimport createActivityMonitor from './activity';\nimport type { ReauthConfig } from './reauthentication';\nimport type { SetLocale } from 'lib-bb-set-locale';\nimport type { Pubsub } from 'lib-bb-pubsub';\n\nexport type { AuthUtils } from './utils';\nexport type { BackbaseSession, StoredSession,\n  AuthSession, Seconds, UnixTimeSeconds, Base64Jwt, Cookie, CookieOptions, SessionOptions } from './session';\nexport type { Countdown } from './countdown';\nexport type { Redirect, IsExternal } from './redirect';\nexport type {\n  ReauthConfig,\n  ChallengeResponse,\n  ChallengeError,\n  ChallengeResponseBody,\n  Challenge,\n  ChallengeResponseFunction,\n  ChallengeResolve,\n  ChallengeReject,\n} from './reauthentication';\n\nexport interface EnvironmentConfig {\n  locale?: string;\n  locales?: string[];\n  designmode: boolean;\n  cookiePath: string;\n  isAnonymousUser: boolean;\n  apiRoot: string;\n}\n\n/**\n * Login function type\n */\nexport type Login = (username: string, password: string) => Promise<void>;\n/**\n * Logout function type\n */\nexport type Logout = (redirectUri?: string) => Promise<void>;\n/**\n * RefreshSession function type\n */\nexport type RefreshSession = () => Promise<void>;\n/**\n * Returns time to live in seconds\n */\nexport type TimeToLive = () => Seconds;\n/**\n * Redirects to login page\n */\nexport type GoToLoginPage = (redirectUri?: string) => void;\n/**\n * Re-authenticates a user\n */\nexport type Reauthenticate = (scope: string, acrValues: string, reauthConfig?: ReauthConfig) => Promise<void>;\n\nexport interface AuthStrategy {\n  /**\n   * Optional method that will login the user if the username and password are correct\n   */\n  login?: Login;\n  /**\n   * Optional method that will logout the user\n   */\n  logout?: Logout;\n  /**\n   * Optional method\n   */\n  refresh?: RefreshSession;\n  /**\n   * Optional method that will return time to live\n   */\n  timeToLive?: TimeToLive;\n  /**\n   * Optional method that will redirect to login page\n   */\n  goToLoginPage?: GoToLoginPage;\n  /**\n   * Optional method that allows to intercept any call done to the server to modify it before being sent.\n   */\n  interceptor?: HttpInterceptor;\n  /**\n   * Optional method that will reauthenticate a user\n   */\n  reauthenticate?: Reauthenticate;\n  /**\n   * Optional method that determines whether the user is being impersonated\n   */\n  isImpersonated?: () => boolean;\n}\n\n/**\n * BackbaseAuth interface\n */\nexport interface BackbaseAuth {\n  /**\n   * Authorization config\n   */\n  config: AuthConfigs;\n  /**\n   * Optional method that will login the user if the username and password are correct\n   */\n  login?: Login;\n  /**\n   * Optional method that will logout the user\n   */\n  logout?: Logout;\n  /**\n   * Optional method that will force session refresh\n   */\n  refresh?: RefreshSession;\n  /**\n   * Optional method that will return time to live\n   */\n  timeToLive?: TimeToLive;\n  /**\n   * Optional method that will redirect to login page\n   */\n  goToLoginPage?: GoToLoginPage;\n  /**\n   * Optional method to allow registering a session countdown\n   */\n  register?: (countdown: Countdown) => () => void;\n  /**\n   * Optional method that will reauthenticate a user\n   */\n  reauthenticate?: Reauthenticate;\n  /**\n   * Optional method that determines whether the user is being impersonated\n   */\n  isImpersonated?: () => boolean;\n}\n\n/**\n * CreateStrategy type\n */\nexport type CreateStrategy<T = AuthConfigs> = (\n  config: T,\n  session: AuthSession,\n  utils: AuthUtils,\n  envConfig: EnvironmentConfig,\n  pubsub: Pubsub,\n) => AuthStrategy;\n\n/**\n * Creates a BackbaseAuth instance\n *\n * @param authConfig Authorization Config\n * @param strategyFactory Factory that will return the strategy regarding the configuration\n * @param httpInterceptors Set of http interceptors that are required for this authorization\n * @param httpRequest HttpRequest instance.\n * @param pageConfig? Page Config\n * @returns BackbaseAuth instance\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createAuth, AUTH, AUTH_STRATEGY } from 'lib-bb-auth';\n * ```\n */\nexport function createAuth(\n  authConfig: AuthConfigs,\n  strategyFactory: CreateStrategy<AuthConfigs>,\n  httpInterceptors: HttpInterceptors,\n  httpRequest: HttpRequest,\n  setLocale: SetLocale,\n  envConfig: EnvironmentConfig,\n  pubsub: Pubsub,\n): BackbaseAuth {\n  const utils = createUtils(httpRequest, setLocale, cookie);\n  httpInterceptors.add(createXsrfInterceptor(cookie.get, utils.isExternal));\n\n  const session = createAuthSession(sessionStorage, cookie, envConfig.cookiePath);\n  const strategy = strategyFactory(authConfig, session, utils, envConfig, pubsub);\n\n  if (strategy.interceptor) {\n    httpInterceptors.add(strategy.interceptor);\n  }\n\n  const authApi = {\n    ...strategy,\n    config: authConfig,\n  } as BackbaseAuth; // newer version of TS do not require this\n\n  if (strategy.timeToLive) {\n    const isAnonymousUser = envConfig.isAnonymousUser;\n    if (!isAnonymousUser && authConfig.maxInactivityDuration && strategy.refresh && strategy.logout) {\n      const inactivityTtl = createActivityMonitor(\n        strategy.timeToLive,\n        authConfig.maxInactivityDuration,\n        strategy.refresh,\n        strategy.logout,\n        window,\n      );\n      authApi.register = createCountdown(inactivityTtl, authConfig.countdownDuration);\n    } else {\n      authApi.register = createCountdown(strategy.timeToLive, authConfig.countdownDuration);\n    }\n  }\n\n  return authApi;\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/**\n * [js-sha256]{@link https://github.com/emn178/js-sha256}\n *\n * @version 0.9.0\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2014-2017\n * @license MIT\n */\n/*jslint bitwise: true */\n(function () {\n  'use strict';\n\n  var ERROR = 'input is invalid type';\n  var WINDOW = typeof window === 'object';\n  var root = WINDOW ? window : {};\n  if (root.JS_SHA256_NO_WINDOW) {\n    WINDOW = false;\n  }\n  var WEB_WORKER = !WINDOW && typeof self === 'object';\n  var NODE_JS = !root.JS_SHA256_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;\n  if (NODE_JS) {\n    root = global;\n  } else if (WEB_WORKER) {\n    root = self;\n  }\n  var COMMON_JS = !root.JS_SHA256_NO_COMMON_JS && typeof module === 'object' && module.exports;\n  var AMD = typeof define === 'function' && define.amd;\n  var ARRAY_BUFFER = !root.JS_SHA256_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';\n  var HEX_CHARS = '0123456789abcdef'.split('');\n  var EXTRA = [-2147483648, 8388608, 32768, 128];\n  var SHIFT = [24, 16, 8, 0];\n  var K = [\n    0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n    0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n    0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n    0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n    0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n    0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n    0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n    0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n  ];\n  var OUTPUT_TYPES = ['hex', 'array', 'digest', 'arrayBuffer'];\n\n  var blocks = [];\n\n  if (root.JS_SHA256_NO_NODE_JS || !Array.isArray) {\n    Array.isArray = function (obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n  }\n\n  if (ARRAY_BUFFER && (root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {\n    ArrayBuffer.isView = function (obj) {\n      return typeof obj === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;\n    };\n  }\n\n  var createOutputMethod = function (outputType, is224) {\n    return function (message) {\n      return new Sha256(is224, true).update(message)[outputType]();\n    };\n  };\n\n  var createMethod = function (is224) {\n    var method = createOutputMethod('hex', is224);\n    if (NODE_JS) {\n      method = nodeWrap(method, is224);\n    }\n    method.create = function () {\n      return new Sha256(is224);\n    };\n    method.update = function (message) {\n      return method.create().update(message);\n    };\n    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {\n      var type = OUTPUT_TYPES[i];\n      method[type] = createOutputMethod(type, is224);\n    }\n    return method;\n  };\n\n  var nodeWrap = function (method, is224) {\n    var crypto = eval(\"require('crypto')\");\n    var Buffer = eval(\"require('buffer').Buffer\");\n    var algorithm = is224 ? 'sha224' : 'sha256';\n    var nodeMethod = function (message) {\n      if (typeof message === 'string') {\n        return crypto.createHash(algorithm).update(message, 'utf8').digest('hex');\n      } else {\n        if (message === null || message === undefined) {\n          throw new Error(ERROR);\n        } else if (message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        }\n      }\n      if (Array.isArray(message) || ArrayBuffer.isView(message) ||\n        message.constructor === Buffer) {\n        return crypto.createHash(algorithm).update(new Buffer(message)).digest('hex');\n      } else {\n        return method(message);\n      }\n    };\n    return nodeMethod;\n  };\n\n  var createHmacOutputMethod = function (outputType, is224) {\n    return function (key, message) {\n      return new HmacSha256(key, is224, true).update(message)[outputType]();\n    };\n  };\n\n  var createHmacMethod = function (is224) {\n    var method = createHmacOutputMethod('hex', is224);\n    method.create = function (key) {\n      return new HmacSha256(key, is224);\n    };\n    method.update = function (key, message) {\n      return method.create(key).update(message);\n    };\n    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {\n      var type = OUTPUT_TYPES[i];\n      method[type] = createHmacOutputMethod(type, is224);\n    }\n    return method;\n  };\n\n  function Sha256(is224, sharedMemory) {\n    if (sharedMemory) {\n      blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n        blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n        blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n        blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      this.blocks = blocks;\n    } else {\n      this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    }\n\n    if (is224) {\n      this.h0 = 0xc1059ed8;\n      this.h1 = 0x367cd507;\n      this.h2 = 0x3070dd17;\n      this.h3 = 0xf70e5939;\n      this.h4 = 0xffc00b31;\n      this.h5 = 0x68581511;\n      this.h6 = 0x64f98fa7;\n      this.h7 = 0xbefa4fa4;\n    } else { // 256\n      this.h0 = 0x6a09e667;\n      this.h1 = 0xbb67ae85;\n      this.h2 = 0x3c6ef372;\n      this.h3 = 0xa54ff53a;\n      this.h4 = 0x510e527f;\n      this.h5 = 0x9b05688c;\n      this.h6 = 0x1f83d9ab;\n      this.h7 = 0x5be0cd19;\n    }\n\n    this.block = this.start = this.bytes = this.hBytes = 0;\n    this.finalized = this.hashed = false;\n    this.first = true;\n    this.is224 = is224;\n  }\n\n  Sha256.prototype.update = function (message) {\n    if (this.finalized) {\n      return;\n    }\n    var notString, type = typeof message;\n    if (type !== 'string') {\n      if (type === 'object') {\n        if (message === null) {\n          throw new Error(ERROR);\n        } else if (ARRAY_BUFFER && message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        } else if (!Array.isArray(message)) {\n          if (!ARRAY_BUFFER || !ArrayBuffer.isView(message)) {\n            throw new Error(ERROR);\n          }\n        }\n      } else {\n        throw new Error(ERROR);\n      }\n      notString = true;\n    }\n    var code, index = 0, i, length = message.length, blocks = this.blocks;\n\n    while (index < length) {\n      if (this.hashed) {\n        this.hashed = false;\n        blocks[0] = this.block;\n        blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n          blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n          blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n          blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      }\n\n      if (notString) {\n        for (i = this.start; index < length && i < 64; ++index) {\n          blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];\n        }\n      } else {\n        for (i = this.start; index < length && i < 64; ++index) {\n          code = message.charCodeAt(index);\n          if (code < 0x80) {\n            blocks[i >> 2] |= code << SHIFT[i++ & 3];\n          } else if (code < 0x800) {\n            blocks[i >> 2] |= (0xc0 | (code >> 6)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else if (code < 0xd800 || code >= 0xe000) {\n            blocks[i >> 2] |= (0xe0 | (code >> 12)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else {\n            code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));\n            blocks[i >> 2] |= (0xf0 | (code >> 18)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 12) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          }\n        }\n      }\n\n      this.lastByteIndex = i;\n      this.bytes += i - this.start;\n      if (i >= 64) {\n        this.block = blocks[16];\n        this.start = i - 64;\n        this.hash();\n        this.hashed = true;\n      } else {\n        this.start = i;\n      }\n    }\n    if (this.bytes > 4294967295) {\n      this.hBytes += this.bytes / 4294967296 << 0;\n      this.bytes = this.bytes % 4294967296;\n    }\n    return this;\n  };\n\n  Sha256.prototype.finalize = function () {\n    if (this.finalized) {\n      return;\n    }\n    this.finalized = true;\n    var blocks = this.blocks, i = this.lastByteIndex;\n    blocks[16] = this.block;\n    blocks[i >> 2] |= EXTRA[i & 3];\n    this.block = blocks[16];\n    if (i >= 56) {\n      if (!this.hashed) {\n        this.hash();\n      }\n      blocks[0] = this.block;\n      blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n        blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n        blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n        blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n    }\n    blocks[14] = this.hBytes << 3 | this.bytes >>> 29;\n    blocks[15] = this.bytes << 3;\n    this.hash();\n  };\n\n  Sha256.prototype.hash = function () {\n    var a = this.h0, b = this.h1, c = this.h2, d = this.h3, e = this.h4, f = this.h5, g = this.h6,\n      h = this.h7, blocks = this.blocks, j, s0, s1, maj, t1, t2, ch, ab, da, cd, bc;\n\n    for (j = 16; j < 64; ++j) {\n      // rightrotate\n      t1 = blocks[j - 15];\n      s0 = ((t1 >>> 7) | (t1 << 25)) ^ ((t1 >>> 18) | (t1 << 14)) ^ (t1 >>> 3);\n      t1 = blocks[j - 2];\n      s1 = ((t1 >>> 17) | (t1 << 15)) ^ ((t1 >>> 19) | (t1 << 13)) ^ (t1 >>> 10);\n      blocks[j] = blocks[j - 16] + s0 + blocks[j - 7] + s1 << 0;\n    }\n\n    bc = b & c;\n    for (j = 0; j < 64; j += 4) {\n      if (this.first) {\n        if (this.is224) {\n          ab = 300032;\n          t1 = blocks[0] - 1413257819;\n          h = t1 - 150054599 << 0;\n          d = t1 + 24177077 << 0;\n        } else {\n          ab = 704751109;\n          t1 = blocks[0] - 210244248;\n          h = t1 - 1521486534 << 0;\n          d = t1 + 143694565 << 0;\n        }\n        this.first = false;\n      } else {\n        s0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^ ((a >>> 22) | (a << 10));\n        s1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^ ((e >>> 25) | (e << 7));\n        ab = a & b;\n        maj = ab ^ (a & c) ^ bc;\n        ch = (e & f) ^ (~e & g);\n        t1 = h + s1 + ch + K[j] + blocks[j];\n        t2 = s0 + maj;\n        h = d + t1 << 0;\n        d = t1 + t2 << 0;\n      }\n      s0 = ((d >>> 2) | (d << 30)) ^ ((d >>> 13) | (d << 19)) ^ ((d >>> 22) | (d << 10));\n      s1 = ((h >>> 6) | (h << 26)) ^ ((h >>> 11) | (h << 21)) ^ ((h >>> 25) | (h << 7));\n      da = d & a;\n      maj = da ^ (d & b) ^ ab;\n      ch = (h & e) ^ (~h & f);\n      t1 = g + s1 + ch + K[j + 1] + blocks[j + 1];\n      t2 = s0 + maj;\n      g = c + t1 << 0;\n      c = t1 + t2 << 0;\n      s0 = ((c >>> 2) | (c << 30)) ^ ((c >>> 13) | (c << 19)) ^ ((c >>> 22) | (c << 10));\n      s1 = ((g >>> 6) | (g << 26)) ^ ((g >>> 11) | (g << 21)) ^ ((g >>> 25) | (g << 7));\n      cd = c & d;\n      maj = cd ^ (c & a) ^ da;\n      ch = (g & h) ^ (~g & e);\n      t1 = f + s1 + ch + K[j + 2] + blocks[j + 2];\n      t2 = s0 + maj;\n      f = b + t1 << 0;\n      b = t1 + t2 << 0;\n      s0 = ((b >>> 2) | (b << 30)) ^ ((b >>> 13) | (b << 19)) ^ ((b >>> 22) | (b << 10));\n      s1 = ((f >>> 6) | (f << 26)) ^ ((f >>> 11) | (f << 21)) ^ ((f >>> 25) | (f << 7));\n      bc = b & c;\n      maj = bc ^ (b & d) ^ cd;\n      ch = (f & g) ^ (~f & h);\n      t1 = e + s1 + ch + K[j + 3] + blocks[j + 3];\n      t2 = s0 + maj;\n      e = a + t1 << 0;\n      a = t1 + t2 << 0;\n    }\n\n    this.h0 = this.h0 + a << 0;\n    this.h1 = this.h1 + b << 0;\n    this.h2 = this.h2 + c << 0;\n    this.h3 = this.h3 + d << 0;\n    this.h4 = this.h4 + e << 0;\n    this.h5 = this.h5 + f << 0;\n    this.h6 = this.h6 + g << 0;\n    this.h7 = this.h7 + h << 0;\n  };\n\n  Sha256.prototype.hex = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,\n      h6 = this.h6, h7 = this.h7;\n\n    var hex = HEX_CHARS[(h0 >> 28) & 0x0F] + HEX_CHARS[(h0 >> 24) & 0x0F] +\n      HEX_CHARS[(h0 >> 20) & 0x0F] + HEX_CHARS[(h0 >> 16) & 0x0F] +\n      HEX_CHARS[(h0 >> 12) & 0x0F] + HEX_CHARS[(h0 >> 8) & 0x0F] +\n      HEX_CHARS[(h0 >> 4) & 0x0F] + HEX_CHARS[h0 & 0x0F] +\n      HEX_CHARS[(h1 >> 28) & 0x0F] + HEX_CHARS[(h1 >> 24) & 0x0F] +\n      HEX_CHARS[(h1 >> 20) & 0x0F] + HEX_CHARS[(h1 >> 16) & 0x0F] +\n      HEX_CHARS[(h1 >> 12) & 0x0F] + HEX_CHARS[(h1 >> 8) & 0x0F] +\n      HEX_CHARS[(h1 >> 4) & 0x0F] + HEX_CHARS[h1 & 0x0F] +\n      HEX_CHARS[(h2 >> 28) & 0x0F] + HEX_CHARS[(h2 >> 24) & 0x0F] +\n      HEX_CHARS[(h2 >> 20) & 0x0F] + HEX_CHARS[(h2 >> 16) & 0x0F] +\n      HEX_CHARS[(h2 >> 12) & 0x0F] + HEX_CHARS[(h2 >> 8) & 0x0F] +\n      HEX_CHARS[(h2 >> 4) & 0x0F] + HEX_CHARS[h2 & 0x0F] +\n      HEX_CHARS[(h3 >> 28) & 0x0F] + HEX_CHARS[(h3 >> 24) & 0x0F] +\n      HEX_CHARS[(h3 >> 20) & 0x0F] + HEX_CHARS[(h3 >> 16) & 0x0F] +\n      HEX_CHARS[(h3 >> 12) & 0x0F] + HEX_CHARS[(h3 >> 8) & 0x0F] +\n      HEX_CHARS[(h3 >> 4) & 0x0F] + HEX_CHARS[h3 & 0x0F] +\n      HEX_CHARS[(h4 >> 28) & 0x0F] + HEX_CHARS[(h4 >> 24) & 0x0F] +\n      HEX_CHARS[(h4 >> 20) & 0x0F] + HEX_CHARS[(h4 >> 16) & 0x0F] +\n      HEX_CHARS[(h4 >> 12) & 0x0F] + HEX_CHARS[(h4 >> 8) & 0x0F] +\n      HEX_CHARS[(h4 >> 4) & 0x0F] + HEX_CHARS[h4 & 0x0F] +\n      HEX_CHARS[(h5 >> 28) & 0x0F] + HEX_CHARS[(h5 >> 24) & 0x0F] +\n      HEX_CHARS[(h5 >> 20) & 0x0F] + HEX_CHARS[(h5 >> 16) & 0x0F] +\n      HEX_CHARS[(h5 >> 12) & 0x0F] + HEX_CHARS[(h5 >> 8) & 0x0F] +\n      HEX_CHARS[(h5 >> 4) & 0x0F] + HEX_CHARS[h5 & 0x0F] +\n      HEX_CHARS[(h6 >> 28) & 0x0F] + HEX_CHARS[(h6 >> 24) & 0x0F] +\n      HEX_CHARS[(h6 >> 20) & 0x0F] + HEX_CHARS[(h6 >> 16) & 0x0F] +\n      HEX_CHARS[(h6 >> 12) & 0x0F] + HEX_CHARS[(h6 >> 8) & 0x0F] +\n      HEX_CHARS[(h6 >> 4) & 0x0F] + HEX_CHARS[h6 & 0x0F];\n    if (!this.is224) {\n      hex += HEX_CHARS[(h7 >> 28) & 0x0F] + HEX_CHARS[(h7 >> 24) & 0x0F] +\n        HEX_CHARS[(h7 >> 20) & 0x0F] + HEX_CHARS[(h7 >> 16) & 0x0F] +\n        HEX_CHARS[(h7 >> 12) & 0x0F] + HEX_CHARS[(h7 >> 8) & 0x0F] +\n        HEX_CHARS[(h7 >> 4) & 0x0F] + HEX_CHARS[h7 & 0x0F];\n    }\n    return hex;\n  };\n\n  Sha256.prototype.toString = Sha256.prototype.hex;\n\n  Sha256.prototype.digest = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,\n      h6 = this.h6, h7 = this.h7;\n\n    var arr = [\n      (h0 >> 24) & 0xFF, (h0 >> 16) & 0xFF, (h0 >> 8) & 0xFF, h0 & 0xFF,\n      (h1 >> 24) & 0xFF, (h1 >> 16) & 0xFF, (h1 >> 8) & 0xFF, h1 & 0xFF,\n      (h2 >> 24) & 0xFF, (h2 >> 16) & 0xFF, (h2 >> 8) & 0xFF, h2 & 0xFF,\n      (h3 >> 24) & 0xFF, (h3 >> 16) & 0xFF, (h3 >> 8) & 0xFF, h3 & 0xFF,\n      (h4 >> 24) & 0xFF, (h4 >> 16) & 0xFF, (h4 >> 8) & 0xFF, h4 & 0xFF,\n      (h5 >> 24) & 0xFF, (h5 >> 16) & 0xFF, (h5 >> 8) & 0xFF, h5 & 0xFF,\n      (h6 >> 24) & 0xFF, (h6 >> 16) & 0xFF, (h6 >> 8) & 0xFF, h6 & 0xFF\n    ];\n    if (!this.is224) {\n      arr.push((h7 >> 24) & 0xFF, (h7 >> 16) & 0xFF, (h7 >> 8) & 0xFF, h7 & 0xFF);\n    }\n    return arr;\n  };\n\n  Sha256.prototype.array = Sha256.prototype.digest;\n\n  Sha256.prototype.arrayBuffer = function () {\n    this.finalize();\n\n    var buffer = new ArrayBuffer(this.is224 ? 28 : 32);\n    var dataView = new DataView(buffer);\n    dataView.setUint32(0, this.h0);\n    dataView.setUint32(4, this.h1);\n    dataView.setUint32(8, this.h2);\n    dataView.setUint32(12, this.h3);\n    dataView.setUint32(16, this.h4);\n    dataView.setUint32(20, this.h5);\n    dataView.setUint32(24, this.h6);\n    if (!this.is224) {\n      dataView.setUint32(28, this.h7);\n    }\n    return buffer;\n  };\n\n  function HmacSha256(key, is224, sharedMemory) {\n    var i, type = typeof key;\n    if (type === 'string') {\n      var bytes = [], length = key.length, index = 0, code;\n      for (i = 0; i < length; ++i) {\n        code = key.charCodeAt(i);\n        if (code < 0x80) {\n          bytes[index++] = code;\n        } else if (code < 0x800) {\n          bytes[index++] = (0xc0 | (code >> 6));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        } else if (code < 0xd800 || code >= 0xe000) {\n          bytes[index++] = (0xe0 | (code >> 12));\n          bytes[index++] = (0x80 | ((code >> 6) & 0x3f));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        } else {\n          code = 0x10000 + (((code & 0x3ff) << 10) | (key.charCodeAt(++i) & 0x3ff));\n          bytes[index++] = (0xf0 | (code >> 18));\n          bytes[index++] = (0x80 | ((code >> 12) & 0x3f));\n          bytes[index++] = (0x80 | ((code >> 6) & 0x3f));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        }\n      }\n      key = bytes;\n    } else {\n      if (type === 'object') {\n        if (key === null) {\n          throw new Error(ERROR);\n        } else if (ARRAY_BUFFER && key.constructor === ArrayBuffer) {\n          key = new Uint8Array(key);\n        } else if (!Array.isArray(key)) {\n          if (!ARRAY_BUFFER || !ArrayBuffer.isView(key)) {\n            throw new Error(ERROR);\n          }\n        }\n      } else {\n        throw new Error(ERROR);\n      }\n    }\n\n    if (key.length > 64) {\n      key = (new Sha256(is224, true)).update(key).array();\n    }\n\n    var oKeyPad = [], iKeyPad = [];\n    for (i = 0; i < 64; ++i) {\n      var b = key[i] || 0;\n      oKeyPad[i] = 0x5c ^ b;\n      iKeyPad[i] = 0x36 ^ b;\n    }\n\n    Sha256.call(this, is224, sharedMemory);\n\n    this.update(iKeyPad);\n    this.oKeyPad = oKeyPad;\n    this.inner = true;\n    this.sharedMemory = sharedMemory;\n  }\n  HmacSha256.prototype = new Sha256();\n\n  HmacSha256.prototype.finalize = function () {\n    Sha256.prototype.finalize.call(this);\n    if (this.inner) {\n      this.inner = false;\n      var innerHash = this.array();\n      Sha256.call(this, this.is224, this.sharedMemory);\n      this.update(this.oKeyPad);\n      this.update(innerHash);\n      Sha256.prototype.finalize.call(this);\n    }\n  };\n\n  var exports = createMethod();\n  exports.sha256 = exports;\n  exports.sha224 = createMethod(true);\n  exports.sha256.hmac = createHmacMethod();\n  exports.sha224.hmac = createHmacMethod(true);\n\n  if (COMMON_JS) {\n    module.exports = exports;\n  } else {\n    root.sha256 = exports.sha256;\n    root.sha224 = exports.sha224;\n    if (AMD) {\n      define(function () {\n        return exports;\n      });\n    }\n  }\n})();\n","/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n(function(root, factory) {\n    if ( typeof exports === 'object' ) {\n        if ( typeof module === 'object' ) {\n            module.exports = factory( require(\"js-sha256\"), require(\"base64-js\") );\n        } else {\n            exports[\"keycloak\"] = factory( require(\"js-sha256\"), require(\"base64-js\") );\n        }\n    } else {\n        /**\n        * [js-sha256]{@link https://github.com/emn178/js-sha256}\n        *\n        * @version 0.9.0\n        * @author Chen, Yi-Cyuan [emn178@gmail.com]\n        * @copyright Chen, Yi-Cyuan 2014-2017\n        * @license MIT\n        */\n        !function () { \"use strict\"; function t(t, i) { i ? (d[0] = d[16] = d[1] = d[2] = d[3] = d[4] = d[5] = d[6] = d[7] = d[8] = d[9] = d[10] = d[11] = d[12] = d[13] = d[14] = d[15] = 0, this.blocks = d) : this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], t ? (this.h0 = 3238371032, this.h1 = 914150663, this.h2 = 812702999, this.h3 = 4144912697, this.h4 = 4290775857, this.h5 = 1750603025, this.h6 = 1694076839, this.h7 = 3204075428) : (this.h0 = 1779033703, this.h1 = 3144134277, this.h2 = 1013904242, this.h3 = 2773480762, this.h4 = 1359893119, this.h5 = 2600822924, this.h6 = 528734635, this.h7 = 1541459225), this.block = this.start = this.bytes = this.hBytes = 0, this.finalized = this.hashed = !1, this.first = !0, this.is224 = t } function i(i, r, s) { var e, n = typeof i; if (\"string\" === n) { var o, a = [], u = i.length, c = 0; for (e = 0; e < u; ++e)(o = i.charCodeAt(e)) < 128 ? a[c++] = o : o < 2048 ? (a[c++] = 192 | o >> 6, a[c++] = 128 | 63 & o) : o < 55296 || o >= 57344 ? (a[c++] = 224 | o >> 12, a[c++] = 128 | o >> 6 & 63, a[c++] = 128 | 63 & o) : (o = 65536 + ((1023 & o) << 10 | 1023 & i.charCodeAt(++e)), a[c++] = 240 | o >> 18, a[c++] = 128 | o >> 12 & 63, a[c++] = 128 | o >> 6 & 63, a[c++] = 128 | 63 & o); i = a } else { if (\"object\" !== n) throw new Error(h); if (null === i) throw new Error(h); if (f && i.constructor === ArrayBuffer) i = new Uint8Array(i); else if (!(Array.isArray(i) || f && ArrayBuffer.isView(i))) throw new Error(h) } i.length > 64 && (i = new t(r, !0).update(i).array()); var y = [], p = []; for (e = 0; e < 64; ++e) { var l = i[e] || 0; y[e] = 92 ^ l, p[e] = 54 ^ l } t.call(this, r, s), this.update(p), this.oKeyPad = y, this.inner = !0, this.sharedMemory = s } var h = \"input is invalid type\", r = \"object\" == typeof window, s = r ? window : {}; s.JS_SHA256_NO_WINDOW && (r = !1); var e = !r && \"object\" == typeof self, n = !s.JS_SHA256_NO_NODE_JS && \"object\" == typeof process && process.versions && process.versions.node; n ? s = global : e && (s = self); var o = !s.JS_SHA256_NO_COMMON_JS && \"object\" == typeof module && module.exports, a = \"function\" == typeof define && define.amd, f = !s.JS_SHA256_NO_ARRAY_BUFFER && \"undefined\" != typeof ArrayBuffer, u = \"0123456789abcdef\".split(\"\"), c = [-2147483648, 8388608, 32768, 128], y = [24, 16, 8, 0], p = [1116352408, 1899447441, 3049323471, 3921009573, 961987163, 1508970993, 2453635748, 2870763221, 3624381080, 310598401, 607225278, 1426881987, 1925078388, 2162078206, 2614888103, 3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986, 2554220882, 2821834349, 2952996808, 3210313671, 3336571891, 3584528711, 113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700, 1986661051, 2177026350, 2456956037, 2730485921, 2820302411, 3259730800, 3345764771, 3516065817, 3600352804, 4094571909, 275423344, 430227734, 506948616, 659060556, 883997877, 958139571, 1322822218, 1537002063, 1747873779, 1955562222, 2024104815, 2227730452, 2361852424, 2428436474, 2756734187, 3204031479, 3329325298], l = [\"hex\", \"array\", \"digest\", \"arrayBuffer\"], d = []; !s.JS_SHA256_NO_NODE_JS && Array.isArray || (Array.isArray = function (t) { return \"[object Array]\" === Object.prototype.toString.call(t) }), !f || !s.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW && ArrayBuffer.isView || (ArrayBuffer.isView = function (t) { return \"object\" == typeof t && t.buffer && t.buffer.constructor === ArrayBuffer }); var A = function (i, h) { return function (r) { return new t(h, !0).update(r)[i]() } }, w = function (i) { var h = A(\"hex\", i); n && (h = b(h, i)), h.create = function () { return new t(i) }, h.update = function (t) { return h.create().update(t) }; for (var r = 0; r < l.length; ++r) { var s = l[r]; h[s] = A(s, i) } return h }, b = function (t, i) { var r = eval(\"require('crypto')\"), s = eval(\"require('buffer').Buffer\"), e = i ? \"sha224\" : \"sha256\", n = function (i) { if (\"string\" == typeof i) return r.createHash(e).update(i, \"utf8\").digest(\"hex\"); if (null === i || void 0 === i) throw new Error(h); return i.constructor === ArrayBuffer && (i = new Uint8Array(i)), Array.isArray(i) || ArrayBuffer.isView(i) || i.constructor === s ? r.createHash(e).update(new s(i)).digest(\"hex\") : t(i) }; return n }, v = function (t, h) { return function (r, s) { return new i(r, h, !0).update(s)[t]() } }, _ = function (t) { var h = v(\"hex\", t); h.create = function (h) { return new i(h, t) }, h.update = function (t, i) { return h.create(t).update(i) }; for (var r = 0; r < l.length; ++r) { var s = l[r]; h[s] = v(s, t) } return h }; t.prototype.update = function (t) { if (!this.finalized) { var i, r = typeof t; if (\"string\" !== r) { if (\"object\" !== r) throw new Error(h); if (null === t) throw new Error(h); if (f && t.constructor === ArrayBuffer) t = new Uint8Array(t); else if (!(Array.isArray(t) || f && ArrayBuffer.isView(t))) throw new Error(h); i = !0 } for (var s, e, n = 0, o = t.length, a = this.blocks; n < o;) { if (this.hashed && (this.hashed = !1, a[0] = this.block, a[16] = a[1] = a[2] = a[3] = a[4] = a[5] = a[6] = a[7] = a[8] = a[9] = a[10] = a[11] = a[12] = a[13] = a[14] = a[15] = 0), i) for (e = this.start; n < o && e < 64; ++n)a[e >> 2] |= t[n] << y[3 & e++]; else for (e = this.start; n < o && e < 64; ++n)(s = t.charCodeAt(n)) < 128 ? a[e >> 2] |= s << y[3 & e++] : s < 2048 ? (a[e >> 2] |= (192 | s >> 6) << y[3 & e++], a[e >> 2] |= (128 | 63 & s) << y[3 & e++]) : s < 55296 || s >= 57344 ? (a[e >> 2] |= (224 | s >> 12) << y[3 & e++], a[e >> 2] |= (128 | s >> 6 & 63) << y[3 & e++], a[e >> 2] |= (128 | 63 & s) << y[3 & e++]) : (s = 65536 + ((1023 & s) << 10 | 1023 & t.charCodeAt(++n)), a[e >> 2] |= (240 | s >> 18) << y[3 & e++], a[e >> 2] |= (128 | s >> 12 & 63) << y[3 & e++], a[e >> 2] |= (128 | s >> 6 & 63) << y[3 & e++], a[e >> 2] |= (128 | 63 & s) << y[3 & e++]); this.lastByteIndex = e, this.bytes += e - this.start, e >= 64 ? (this.block = a[16], this.start = e - 64, this.hash(), this.hashed = !0) : this.start = e } return this.bytes > 4294967295 && (this.hBytes += this.bytes / 4294967296 << 0, this.bytes = this.bytes % 4294967296), this } }, t.prototype.finalize = function () { if (!this.finalized) { this.finalized = !0; var t = this.blocks, i = this.lastByteIndex; t[16] = this.block, t[i >> 2] |= c[3 & i], this.block = t[16], i >= 56 && (this.hashed || this.hash(), t[0] = this.block, t[16] = t[1] = t[2] = t[3] = t[4] = t[5] = t[6] = t[7] = t[8] = t[9] = t[10] = t[11] = t[12] = t[13] = t[14] = t[15] = 0), t[14] = this.hBytes << 3 | this.bytes >>> 29, t[15] = this.bytes << 3, this.hash() } }, t.prototype.hash = function () { var t, i, h, r, s, e, n, o, a, f = this.h0, u = this.h1, c = this.h2, y = this.h3, l = this.h4, d = this.h5, A = this.h6, w = this.h7, b = this.blocks; for (t = 16; t < 64; ++t)i = ((s = b[t - 15]) >>> 7 | s << 25) ^ (s >>> 18 | s << 14) ^ s >>> 3, h = ((s = b[t - 2]) >>> 17 | s << 15) ^ (s >>> 19 | s << 13) ^ s >>> 10, b[t] = b[t - 16] + i + b[t - 7] + h << 0; for (a = u & c, t = 0; t < 64; t += 4)this.first ? (this.is224 ? (e = 300032, w = (s = b[0] - 1413257819) - 150054599 << 0, y = s + 24177077 << 0) : (e = 704751109, w = (s = b[0] - 210244248) - 1521486534 << 0, y = s + 143694565 << 0), this.first = !1) : (i = (f >>> 2 | f << 30) ^ (f >>> 13 | f << 19) ^ (f >>> 22 | f << 10), r = (e = f & u) ^ f & c ^ a, w = y + (s = w + (h = (l >>> 6 | l << 26) ^ (l >>> 11 | l << 21) ^ (l >>> 25 | l << 7)) + (l & d ^ ~l & A) + p[t] + b[t]) << 0, y = s + (i + r) << 0), i = (y >>> 2 | y << 30) ^ (y >>> 13 | y << 19) ^ (y >>> 22 | y << 10), r = (n = y & f) ^ y & u ^ e, A = c + (s = A + (h = (w >>> 6 | w << 26) ^ (w >>> 11 | w << 21) ^ (w >>> 25 | w << 7)) + (w & l ^ ~w & d) + p[t + 1] + b[t + 1]) << 0, i = ((c = s + (i + r) << 0) >>> 2 | c << 30) ^ (c >>> 13 | c << 19) ^ (c >>> 22 | c << 10), r = (o = c & y) ^ c & f ^ n, d = u + (s = d + (h = (A >>> 6 | A << 26) ^ (A >>> 11 | A << 21) ^ (A >>> 25 | A << 7)) + (A & w ^ ~A & l) + p[t + 2] + b[t + 2]) << 0, i = ((u = s + (i + r) << 0) >>> 2 | u << 30) ^ (u >>> 13 | u << 19) ^ (u >>> 22 | u << 10), r = (a = u & c) ^ u & y ^ o, l = f + (s = l + (h = (d >>> 6 | d << 26) ^ (d >>> 11 | d << 21) ^ (d >>> 25 | d << 7)) + (d & A ^ ~d & w) + p[t + 3] + b[t + 3]) << 0, f = s + (i + r) << 0; this.h0 = this.h0 + f << 0, this.h1 = this.h1 + u << 0, this.h2 = this.h2 + c << 0, this.h3 = this.h3 + y << 0, this.h4 = this.h4 + l << 0, this.h5 = this.h5 + d << 0, this.h6 = this.h6 + A << 0, this.h7 = this.h7 + w << 0 }, t.prototype.hex = function () { this.finalize(); var t = this.h0, i = this.h1, h = this.h2, r = this.h3, s = this.h4, e = this.h5, n = this.h6, o = this.h7, a = u[t >> 28 & 15] + u[t >> 24 & 15] + u[t >> 20 & 15] + u[t >> 16 & 15] + u[t >> 12 & 15] + u[t >> 8 & 15] + u[t >> 4 & 15] + u[15 & t] + u[i >> 28 & 15] + u[i >> 24 & 15] + u[i >> 20 & 15] + u[i >> 16 & 15] + u[i >> 12 & 15] + u[i >> 8 & 15] + u[i >> 4 & 15] + u[15 & i] + u[h >> 28 & 15] + u[h >> 24 & 15] + u[h >> 20 & 15] + u[h >> 16 & 15] + u[h >> 12 & 15] + u[h >> 8 & 15] + u[h >> 4 & 15] + u[15 & h] + u[r >> 28 & 15] + u[r >> 24 & 15] + u[r >> 20 & 15] + u[r >> 16 & 15] + u[r >> 12 & 15] + u[r >> 8 & 15] + u[r >> 4 & 15] + u[15 & r] + u[s >> 28 & 15] + u[s >> 24 & 15] + u[s >> 20 & 15] + u[s >> 16 & 15] + u[s >> 12 & 15] + u[s >> 8 & 15] + u[s >> 4 & 15] + u[15 & s] + u[e >> 28 & 15] + u[e >> 24 & 15] + u[e >> 20 & 15] + u[e >> 16 & 15] + u[e >> 12 & 15] + u[e >> 8 & 15] + u[e >> 4 & 15] + u[15 & e] + u[n >> 28 & 15] + u[n >> 24 & 15] + u[n >> 20 & 15] + u[n >> 16 & 15] + u[n >> 12 & 15] + u[n >> 8 & 15] + u[n >> 4 & 15] + u[15 & n]; return this.is224 || (a += u[o >> 28 & 15] + u[o >> 24 & 15] + u[o >> 20 & 15] + u[o >> 16 & 15] + u[o >> 12 & 15] + u[o >> 8 & 15] + u[o >> 4 & 15] + u[15 & o]), a }, t.prototype.toString = t.prototype.hex, t.prototype.digest = function () { this.finalize(); var t = this.h0, i = this.h1, h = this.h2, r = this.h3, s = this.h4, e = this.h5, n = this.h6, o = this.h7, a = [t >> 24 & 255, t >> 16 & 255, t >> 8 & 255, 255 & t, i >> 24 & 255, i >> 16 & 255, i >> 8 & 255, 255 & i, h >> 24 & 255, h >> 16 & 255, h >> 8 & 255, 255 & h, r >> 24 & 255, r >> 16 & 255, r >> 8 & 255, 255 & r, s >> 24 & 255, s >> 16 & 255, s >> 8 & 255, 255 & s, e >> 24 & 255, e >> 16 & 255, e >> 8 & 255, 255 & e, n >> 24 & 255, n >> 16 & 255, n >> 8 & 255, 255 & n]; return this.is224 || a.push(o >> 24 & 255, o >> 16 & 255, o >> 8 & 255, 255 & o), a }, t.prototype.array = t.prototype.digest, t.prototype.arrayBuffer = function () { this.finalize(); var t = new ArrayBuffer(this.is224 ? 28 : 32), i = new DataView(t); return i.setUint32(0, this.h0), i.setUint32(4, this.h1), i.setUint32(8, this.h2), i.setUint32(12, this.h3), i.setUint32(16, this.h4), i.setUint32(20, this.h5), i.setUint32(24, this.h6), this.is224 || i.setUint32(28, this.h7), t }, i.prototype = new t, i.prototype.finalize = function () { if (t.prototype.finalize.call(this), this.inner) { this.inner = !1; var i = this.array(); t.call(this, this.is224, this.sharedMemory), this.update(this.oKeyPad), this.update(i), t.prototype.finalize.call(this) } }; var B = w(); B.sha256 = B, B.sha224 = w(!0), B.sha256.hmac = _(), B.sha224.hmac = _(!0), o ? module.exports = B : (s.sha256 = B.sha256, s.sha224 = B.sha224, a && define(function () { return B })) }();\n\n        /**\n         * [base64-js]{@link https://github.com/beatgammit/base64-js}\n         *\n         * @version v1.3.0\n         * @author Kirill, Fomichev\n         * @copyright Kirill, Fomichev 2014\n         * @license MIT\n         */\n        (function (r) { if (typeof exports === \"object\" && typeof module !== \"undefined\") { module.exports = r() } else if (typeof define === \"function\" && define.amd) { define([], r) } else { var e; if (typeof window !== \"undefined\") { e = window } else if (typeof global !== \"undefined\") { e = global } else if (typeof self !== \"undefined\") { e = self } else { e = this } e.base64js = r() } })(function () { var r, e, n; return function () { function r(e, n, t) { function o(f, i) { if (!n[f]) { if (!e[f]) { var u = \"function\" == typeof require && require; if (!i && u) return u(f, !0); if (a) return a(f, !0); var v = new Error(\"Cannot find module '\" + f + \"'\"); throw v.code = \"MODULE_NOT_FOUND\", v } var d = n[f] = { exports: {} }; e[f][0].call(d.exports, function (r) { var n = e[f][1][r]; return o(n || r) }, d, d.exports, r, e, n, t) } return n[f].exports } for (var a = \"function\" == typeof require && require, f = 0; f < t.length; f++)o(t[f]); return o } return r }()({ \"/\": [function (r, e, n) { \"use strict\"; n.byteLength = d; n.toByteArray = h; n.fromByteArray = p; var t = []; var o = []; var a = typeof Uint8Array !== \"undefined\" ? Uint8Array : Array; var f = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"; for (var i = 0, u = f.length; i < u; ++i) { t[i] = f[i]; o[f.charCodeAt(i)] = i } o[\"-\".charCodeAt(0)] = 62; o[\"_\".charCodeAt(0)] = 63; function v(r) { var e = r.length; if (e % 4 > 0) { throw new Error(\"Invalid string. Length must be a multiple of 4\") } var n = r.indexOf(\"=\"); if (n === -1) n = e; var t = n === e ? 0 : 4 - n % 4; return [n, t] } function d(r) { var e = v(r); var n = e[0]; var t = e[1]; return (n + t) * 3 / 4 - t } function c(r, e, n) { return (e + n) * 3 / 4 - n } function h(r) { var e; var n = v(r); var t = n[0]; var f = n[1]; var i = new a(c(r, t, f)); var u = 0; var d = f > 0 ? t - 4 : t; for (var h = 0; h < d; h += 4) { e = o[r.charCodeAt(h)] << 18 | o[r.charCodeAt(h + 1)] << 12 | o[r.charCodeAt(h + 2)] << 6 | o[r.charCodeAt(h + 3)]; i[u++] = e >> 16 & 255; i[u++] = e >> 8 & 255; i[u++] = e & 255 } if (f === 2) { e = o[r.charCodeAt(h)] << 2 | o[r.charCodeAt(h + 1)] >> 4; i[u++] = e & 255 } if (f === 1) { e = o[r.charCodeAt(h)] << 10 | o[r.charCodeAt(h + 1)] << 4 | o[r.charCodeAt(h + 2)] >> 2; i[u++] = e >> 8 & 255; i[u++] = e & 255 } return i } function s(r) { return t[r >> 18 & 63] + t[r >> 12 & 63] + t[r >> 6 & 63] + t[r & 63] } function l(r, e, n) { var t; var o = []; for (var a = e; a < n; a += 3) { t = (r[a] << 16 & 16711680) + (r[a + 1] << 8 & 65280) + (r[a + 2] & 255); o.push(s(t)) } return o.join(\"\") } function p(r) { var e; var n = r.length; var o = n % 3; var a = []; var f = 16383; for (var i = 0, u = n - o; i < u; i += f) { a.push(l(r, i, i + f > u ? u : i + f)) } if (o === 1) { e = r[n - 1]; a.push(t[e >> 2] + t[e << 4 & 63] + \"==\") } else if (o === 2) { e = (r[n - 2] << 8) + r[n - 1]; a.push(t[e >> 10] + t[e >> 4 & 63] + t[e << 2 & 63] + \"=\") } return a.join(\"\") } }, {}] }, {}, [])(\"/\") });\n\n        /**\n         * [promise-polyfill]{@link https://github.com/taylorhakes/promise-polyfill}\n         *\n         * @version v8.1.3\n         * @author Hakes, Taylor\n         * @copyright Hakes, Taylor 2014\n         * @license MIT\n         */\n        !function(e,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?n():\"function\"==typeof define&&define.amd?define(n):n()}(0,function(){\"use strict\";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(e){return!(!e||\"undefined\"==typeof e.length)}function t(){}function o(e){if(!(this instanceof o))throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!=typeof e)throw new TypeError(\"not a function\");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],c(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(r){return void f(n.promise,r)}i(n.promise,o)}else(1===e._state?i:f)(n.promise,e._value)})):e._deferreds.push(n)}function i(e,n){try{if(n===e)throw new TypeError(\"A promise cannot be resolved with itself.\");if(n&&(\"object\"==typeof n||\"function\"==typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if(\"function\"==typeof t)return void c(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,u(e)}catch(r){f(e,r)}}function f(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;t>n;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,f(n,e))})}catch(o){if(t)return;t=!0,f(n,o)}}var a=setTimeout;o.prototype[\"catch\"]=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return r(this,new function(e,n,t){this.onFulfilled=\"function\"==typeof e?e:null,this.onRejected=\"function\"==typeof n?n:null,this.promise=t}(e,n,o)),o},o.prototype[\"finally\"]=e,o.all=function(e){return new o(function(t,o){function r(e,n){try{if(n&&(\"object\"==typeof n||\"function\"==typeof n)){var u=n.then;if(\"function\"==typeof u)return void u.call(n,function(n){r(e,n)},o)}i[e]=n,0==--f&&t(i)}catch(c){o(c)}}if(!n(e))return o(new TypeError(\"Promise.all accepts an array\"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var f=i.length,u=0;i.length>u;u++)r(u,i[u])})},o.resolve=function(e){return e&&\"object\"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(t,r){if(!n(e))return r(new TypeError(\"Promise.race accepts an array\"));for(var i=0,f=e.length;f>i;i++)o.resolve(e[i]).then(t,r)})},o._immediateFn=\"function\"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn(\"Possible Unhandled Promise Rejection:\",e)};var l=function(){if(\"undefined\"!=typeof self)return self;if(\"undefined\"!=typeof window)return window;if(\"undefined\"!=typeof global)return global;throw Error(\"unable to locate global object\")}();\"Promise\"in l?l.Promise.prototype[\"finally\"]||(l.Promise.prototype[\"finally\"]=e):l.Promise=o});\n\n        var Keycloak = factory( root[\"sha256\"], root[\"base64js\"] );\n        root[\"Keycloak\"] = Keycloak;\n\n        if ( typeof define === \"function\" && define.amd ) {\n            define( \"vendor-bb-keycloak\", [], function () { return Keycloak; } );\n        }\n    }\n})(window, function (sha256_imported, base64js_imported) {\n    if (typeof Promise === 'undefined') {\n        throw Error('Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.');\n    }\n\n    var loggedPromiseDeprecation = false;\n\n    function logPromiseDeprecation() {\n        if (!loggedPromiseDeprecation) {\n            loggedPromiseDeprecation = true;\n            console.warn('[KEYCLOAK] Usage of legacy style promise methods such as `.error()` and `.success()` has been deprecated and support will be removed in future versions. Use standard style promise methods such as `.then() and `.catch()` instead.');\n        }\n    }\n\n    function Keycloak (config) {\n        if (!(this instanceof Keycloak)) {\n            return new Keycloak(config);\n        }\n\n        var kc = this;\n        var adapter;\n        var refreshQueue = [];\n        var callbackStorage;\n\n        var loginIframe = {\n            enable: true,\n            callbackList: [],\n            interval: 5\n        };\n\n        var scripts = document.getElementsByTagName('script');\n        for (var i = 0; i < scripts.length; i++) {\n            if ((scripts[i].src.indexOf('keycloak.js') !== -1 || scripts[i].src.indexOf('keycloak.min.js') !== -1) && scripts[i].src.indexOf('version=') !== -1) {\n                kc.iframeVersion = scripts[i].src.substring(scripts[i].src.indexOf('version=') + 8).split('&')[0];\n            }\n        }\n\n        var useNonce = true;\n        var logInfo = createLogger(console.info);\n        var logWarn = createLogger(console.warn);\n\n        kc.init = function (initOptions) {\n            kc.authenticated = false;\n\n            callbackStorage = createCallbackStorage();\n            var adapters = ['default', 'cordova', 'cordova-native'];\n\n            if (initOptions && adapters.indexOf(initOptions.adapter) > -1) {\n                adapter = loadAdapter(initOptions.adapter);\n            } else if (initOptions && typeof initOptions.adapter === \"object\") {\n                adapter = initOptions.adapter;\n            } else {\n                if (window.Cordova || window.cordova) {\n                    adapter = loadAdapter('cordova');\n                } else {\n                    adapter = loadAdapter();\n                }\n            }\n\n            if (initOptions) {\n                if (typeof initOptions.useNonce !== 'undefined') {\n                    useNonce = initOptions.useNonce;\n                }\n\n                if (typeof initOptions.checkLoginIframe !== 'undefined') {\n                    loginIframe.enable = initOptions.checkLoginIframe;\n                }\n\n                if (initOptions.checkLoginIframeInterval) {\n                    loginIframe.interval = initOptions.checkLoginIframeInterval;\n                }\n\n                if (initOptions.onLoad === 'login-required') {\n                    kc.loginRequired = true;\n                }\n\n                if (initOptions.responseMode) {\n                    if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n                        kc.responseMode = initOptions.responseMode;\n                    } else {\n                        throw 'Invalid value for responseMode';\n                    }\n                }\n\n                if (initOptions.flow) {\n                    switch (initOptions.flow) {\n                        case 'standard':\n                            kc.responseType = 'code';\n                            break;\n                        case 'implicit':\n                            kc.responseType = 'id_token token';\n                            break;\n                        case 'hybrid':\n                            kc.responseType = 'code id_token token';\n                            break;\n                        default:\n                            throw 'Invalid value for flow';\n                    }\n                    kc.flow = initOptions.flow;\n                }\n\n                if (initOptions.timeSkew != null) {\n                    kc.timeSkew = initOptions.timeSkew;\n                }\n\n                if(initOptions.redirectUri) {\n                    kc.redirectUri = initOptions.redirectUri;\n                }\n\n                if (initOptions.silentCheckSsoRedirectUri) {\n                    kc.silentCheckSsoRedirectUri = initOptions.silentCheckSsoRedirectUri;\n                }\n\n                if (typeof initOptions.silentCheckSsoFallback === 'boolean') {\n                    kc.silentCheckSsoFallback = initOptions.silentCheckSsoFallback;\n                } else {\n                    kc.silentCheckSsoFallback = true;\n                }\n\n                if (initOptions.pkceMethod) {\n                    if (initOptions.pkceMethod !== \"S256\") {\n                        throw 'Invalid value for pkceMethod';\n                    }\n                    kc.pkceMethod = initOptions.pkceMethod;\n                }\n\n                if (typeof initOptions.enableLogging === 'boolean') {\n                    kc.enableLogging = initOptions.enableLogging;\n                } else {\n                    kc.enableLogging = false;\n                }\n\n                if (typeof initOptions.scope === 'string') {\n                    kc.scope = initOptions.scope;\n                }\n\n                if (typeof initOptions.messageReceiveTimeout === 'number' && initOptions.messageReceiveTimeout > 0) {\n                    kc.messageReceiveTimeout = initOptions.messageReceiveTimeout;\n                } else {\n                    kc.messageReceiveTimeout = 10000;\n                }\n            }\n\n            if (!kc.responseMode) {\n                kc.responseMode = 'fragment';\n            }\n            if (!kc.responseType) {\n                kc.responseType = 'code';\n                kc.flow = 'standard';\n            }\n\n            var promise = createPromise();\n\n            var initPromise = createPromise();\n            initPromise.promise.then(function() {\n                kc.onReady && kc.onReady(kc.authenticated);\n                promise.setSuccess(kc.authenticated);\n            }).catch(function(error) {\n                promise.setError(error);\n            });\n\n            var configPromise = loadConfig(config);\n\n            function onLoad() {\n                var doLogin = function(prompt) {\n                    if (!prompt) {\n                        options.prompt = 'none';\n                    }\n\n                    kc.login(options).then(function () {\n                        initPromise.setSuccess();\n                    }).catch(function (error) {\n                        initPromise.setError(error);\n                    });\n                }\n\n                var checkSsoSilently = function() {\n                    var ifrm = document.createElement(\"iframe\");\n                    var src = kc.createLoginUrl({prompt: 'none', redirectUri: kc.silentCheckSsoRedirectUri});\n                    ifrm.setAttribute(\"src\", src);\n                    ifrm.setAttribute(\"title\", \"keycloak-silent-check-sso\");\n                    ifrm.style.display = \"none\";\n                    document.body.appendChild(ifrm);\n\n                    var messageCallback = function(event) {\n                        if (event.origin !== window.location.origin || ifrm.contentWindow !== event.source) {\n                            return;\n                        }\n\n                        var oauth = parseCallback(event.data);\n                        processCallback(oauth, initPromise);\n\n                        document.body.removeChild(ifrm);\n                        window.removeEventListener(\"message\", messageCallback);\n                    };\n\n                    window.addEventListener(\"message\", messageCallback);\n                };\n\n                var options = {};\n                switch (initOptions.onLoad) {\n                    case 'check-sso':\n                        if (loginIframe.enable) {\n                            setupCheckLoginIframe().then(function() {\n                                checkLoginIframe().then(function (unchanged) {\n                                    if (!unchanged) {\n                                        kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n                                    } else {\n                                        initPromise.setSuccess();\n                                    }\n                                }).catch(function (error) {\n                                    initPromise.setError(error);\n                                });\n                            });\n                        } else {\n                            kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n                        }\n                        break;\n                    case 'login-required':\n                        doLogin(true);\n                        break;\n                    default:\n                        throw 'Invalid value for onLoad';\n                }\n            }\n\n            function processInit() {\n                var callback = parseCallback(window.location.href);\n\n                if (callback) {\n                    window.history.replaceState(window.history.state, null, callback.newUrl);\n                }\n\n                if (callback && callback.valid) {\n                    return setupCheckLoginIframe().then(function() {\n                        processCallback(callback, initPromise);\n                    }).catch(function (error) {\n                        initPromise.setError(error);\n                    });\n                } else if (initOptions) {\n                    if (initOptions.token && initOptions.refreshToken) {\n                        setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken);\n\n                        if (loginIframe.enable) {\n                            setupCheckLoginIframe().then(function() {\n                                checkLoginIframe().then(function (unchanged) {\n                                    if (unchanged) {\n                                        kc.onAuthSuccess && kc.onAuthSuccess();\n                                        initPromise.setSuccess();\n                                        scheduleCheckIframe();\n                                    } else {\n                                        initPromise.setSuccess();\n                                    }\n                                }).catch(function (error) {\n                                    initPromise.setError(error);\n                                });\n                            });\n                        } else {\n                            kc.updateToken(-1).then(function() {\n                                kc.onAuthSuccess && kc.onAuthSuccess();\n                                initPromise.setSuccess();\n                            }).catch(function(error) {\n                                kc.onAuthError && kc.onAuthError();\n                                if (initOptions.onLoad) {\n                                    onLoad();\n                                } else {\n                                    initPromise.setError(error);\n                                }\n                            });\n                        }\n                    } else if (initOptions.onLoad) {\n                        onLoad();\n                    } else {\n                        initPromise.setSuccess();\n                    }\n                } else {\n                    initPromise.setSuccess();\n                }\n            }\n\n            function domReady() {\n                var promise = createPromise();\n\n                var checkReadyState = function () {\n                    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n                        document.removeEventListener('readystatechange', checkReadyState);\n                        promise.setSuccess();\n                    }\n                }\n                document.addEventListener('readystatechange', checkReadyState);\n\n                checkReadyState(); // just in case the event was already fired and we missed it (in case the init is done later than at the load time, i.e. it's done from code)\n\n                return promise.promise;\n            }\n\n            configPromise.then(function () {\n                domReady()\n                    .then(check3pCookiesSupported)\n                    .then(processInit)\n                    .catch(function (error) {\n                        promise.setError(error);\n                    });\n            });\n            configPromise.catch(function (error) {\n                promise.setError(error);\n            });\n\n            return promise.promise;\n        }\n\n        kc.login = function (options) {\n            return adapter.login(options);\n        }\n\n        function generateRandomData(len) {\n            // use web crypto APIs if possible\n            var array = null;\n            var crypto = window.crypto || window.msCrypto;\n            if (crypto && crypto.getRandomValues && window.Uint8Array) {\n                array = new Uint8Array(len);\n                crypto.getRandomValues(array);\n                return array;\n            }\n\n            // fallback to Math random\n            array = new Array(len);\n            for (var j = 0; j < array.length; j++) {\n                array[j] = Math.floor(256 * Math.random());\n            }\n            return array;\n        }\n\n        function generateCodeVerifier(len) {\n            return generateRandomString(len, 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789');\n        }\n\n        function generateRandomString(len, alphabet){\n            var randomData = generateRandomData(len);\n            var chars = new Array(len);\n            for (var i = 0; i < len; i++) {\n                chars[i] = alphabet.charCodeAt(randomData[i] % alphabet.length);\n            }\n            return String.fromCharCode.apply(null, chars);\n        }\n\n        function generatePkceChallenge(pkceMethod, codeVerifier) {\n            switch (pkceMethod) {\n                // The use of the \"plain\" method is considered insecure and therefore not supported.\n                case \"S256\":\n                    // hash codeVerifier, then encode as url-safe base64 without padding\n                    var hashBytes = new Uint8Array(sha256_imported.arrayBuffer(codeVerifier));\n                    var encodedHash = base64js_imported.fromByteArray(hashBytes)\n                        .replace(/\\+/g, '-')\n                        .replace(/\\//g, '_')\n                        .replace(/\\=/g, '');\n                    return encodedHash;\n                default:\n                    throw 'Invalid value for pkceMethod';\n            }\n        }\n\n        kc.createLoginUrl = function(options) {\n            var state = createUUID();\n            var nonce = createUUID();\n\n            var redirectUri = adapter.redirectUri(options);\n\n            var callbackState = {\n                state: state,\n                nonce: nonce,\n                redirectUri: encodeURIComponent(redirectUri)\n            };\n\n            if (options && options.prompt) {\n                callbackState.prompt = options.prompt;\n            }\n\n            var baseUrl;\n            if (options && options.action == 'register') {\n                baseUrl = kc.endpoints.register();\n            } else {\n                baseUrl = kc.endpoints.authorize();\n            }\n\n            var scope = options && options.scope || kc.scope;\n            if (!scope) {\n                // if scope is not set, default to \"openid\"\n                scope = \"openid\";\n            } else if (scope.indexOf(\"openid\") === -1) {\n                // if openid scope is missing, prefix the given scopes with it\n                scope = \"openid \" + scope;\n            }\n\n            var url = baseUrl\n                + '?client_id=' + encodeURIComponent(kc.clientId)\n                + '&redirect_uri=' + encodeURIComponent(redirectUri)\n                + '&state=' + encodeURIComponent(state)\n                + '&response_mode=' + encodeURIComponent(kc.responseMode)\n                + '&response_type=' + encodeURIComponent(kc.responseType)\n                + '&scope=' + encodeURIComponent(scope);\n            if (useNonce) {\n                url = url + '&nonce=' + encodeURIComponent(nonce);\n            }\n\n            if (options && options.prompt) {\n                url += '&prompt=' + encodeURIComponent(options.prompt);\n            }\n\n            if (options && options.maxAge) {\n                url += '&max_age=' + encodeURIComponent(options.maxAge);\n            }\n\n            if (options && options.loginHint) {\n                url += '&login_hint=' + encodeURIComponent(options.loginHint);\n            }\n\n            if (options && options.idpHint) {\n                url += '&kc_idp_hint=' + encodeURIComponent(options.idpHint);\n            }\n\n            if (options && options.action && options.action != 'register') {\n                url += '&kc_action=' + encodeURIComponent(options.action);\n            }\n\n            if (options && options.locale) {\n                url += '&ui_locales=' + encodeURIComponent(options.locale);\n            }\n\n            if (kc.pkceMethod) {\n                var codeVerifier = generateCodeVerifier(96);\n                callbackState.pkceCodeVerifier = codeVerifier;\n                var pkceChallenge = generatePkceChallenge(kc.pkceMethod, codeVerifier);\n                url += '&code_challenge=' + pkceChallenge;\n                url += '&code_challenge_method=' + kc.pkceMethod;\n            }\n\n            callbackStorage.add(callbackState);\n\n            return url;\n        }\n\n        kc.logout = function(options) {\n            return adapter.logout(options);\n        }\n\n        kc.createLogoutUrl = function(options) {\n            var url = kc.endpoints.logout()\n                + '?redirect_uri=' + encodeURIComponent(adapter.redirectUri(options, false));\n\n            return url;\n        }\n\n        kc.register = function (options) {\n            return adapter.register(options);\n        }\n\n        kc.createRegisterUrl = function(options) {\n            if (!options) {\n                options = {};\n            }\n            options.action = 'register';\n            return kc.createLoginUrl(options);\n        }\n\n        kc.createAccountUrl = function(options) {\n            var realm = getRealmUrl();\n            var url = undefined;\n            if (typeof realm !== 'undefined') {\n                url = realm\n                + '/account'\n                + '?referrer=' + encodeURIComponent(kc.clientId)\n                + '&referrer_uri=' + encodeURIComponent(adapter.redirectUri(options));\n            }\n            return url;\n        }\n\n        kc.accountManagement = function() {\n            return adapter.accountManagement();\n        }\n\n        kc.hasRealmRole = function (role) {\n            var access = kc.realmAccess;\n            return !!access && access.roles.indexOf(role) >= 0;\n        }\n\n        kc.hasResourceRole = function(role, resource) {\n            if (!kc.resourceAccess) {\n                return false;\n            }\n\n            var access = kc.resourceAccess[resource || kc.clientId];\n            return !!access && access.roles.indexOf(role) >= 0;\n        }\n\n        kc.loadUserProfile = function() {\n            var url = getRealmUrl() + '/account';\n            var req = new XMLHttpRequest();\n            req.open('GET', url, true);\n            req.setRequestHeader('Accept', 'application/json');\n            req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n            var promise = createPromise();\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        kc.profile = JSON.parse(req.responseText);\n                        promise.setSuccess(kc.profile);\n                    } else {\n                        promise.setError();\n                    }\n                }\n            }\n\n            req.send();\n\n            return promise.promise;\n        }\n\n        kc.loadUserInfo = function() {\n            var url = kc.endpoints.userinfo();\n            var req = new XMLHttpRequest();\n            req.open('GET', url, true);\n            req.setRequestHeader('Accept', 'application/json');\n            req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n            var promise = createPromise();\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n                        kc.userInfo = JSON.parse(req.responseText);\n                        promise.setSuccess(kc.userInfo);\n                    } else {\n                        promise.setError();\n                    }\n                }\n            }\n\n            req.send();\n\n            return promise.promise;\n        }\n\n        kc.isTokenExpired = function(minValidity) {\n            if (!kc.tokenParsed || (!kc.refreshToken && kc.flow != 'implicit' )) {\n                throw 'Not authenticated';\n            }\n\n            if (kc.timeSkew == null) {\n                logInfo('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set');\n                return true;\n            }\n\n            var expiresIn = kc.tokenParsed['exp'] - Math.ceil(new Date().getTime() / 1000) + kc.timeSkew;\n            if (minValidity) {\n                if (isNaN(minValidity)) {\n                    throw 'Invalid minValidity';\n                }\n                expiresIn -= minValidity;\n            }\n            return expiresIn < 0;\n        }\n\n        kc.updateToken = function(minValidity) {\n            var promise = createPromise();\n\n            if (!kc.refreshToken) {\n                promise.setError();\n                return promise.promise;\n            }\n\n            minValidity = minValidity || 5;\n\n            var exec = function() {\n                var refreshToken = false;\n                if (minValidity == -1) {\n                    refreshToken = true;\n                    logInfo('[KEYCLOAK] Refreshing token: forced refresh');\n                } else if (!kc.tokenParsed || kc.isTokenExpired(minValidity)) {\n                    refreshToken = true;\n                    logInfo('[KEYCLOAK] Refreshing token: token expired');\n                }\n\n                if (!refreshToken) {\n                    promise.setSuccess(false);\n                } else {\n                    var params = 'grant_type=refresh_token&' + 'refresh_token=' + kc.refreshToken;\n                    var url = kc.endpoints.token();\n\n                    refreshQueue.push(promise);\n\n                    if (refreshQueue.length == 1) {\n                        var req = new XMLHttpRequest();\n                        req.open('POST', url, true);\n                        req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n                        req.withCredentials = true;\n\n                        params += '&client_id=' + encodeURIComponent(kc.clientId);\n\n                        var timeLocal = new Date().getTime();\n\n                        req.onreadystatechange = function () {\n                            if (req.readyState == 4) {\n                                if (req.status == 200) {\n                                    logInfo('[KEYCLOAK] Token refreshed');\n\n                                    timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n                                    var tokenResponse = JSON.parse(req.responseText);\n\n                                    setToken(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], timeLocal);\n\n                                    kc.onAuthRefreshSuccess && kc.onAuthRefreshSuccess();\n                                    for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                        p.setSuccess(true);\n                                    }\n                                } else {\n                                    logWarn('[KEYCLOAK] Failed to refresh token');\n\n                                    if (req.status == 400) {\n                                        kc.clearToken();\n                                    }\n\n                                    kc.onAuthRefreshError && kc.onAuthRefreshError();\n                                    for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                        p.setError(true);\n                                    }\n                                }\n                            }\n                        };\n\n                        req.send(params);\n                    }\n                }\n            }\n\n            if (loginIframe.enable) {\n                var iframePromise = checkLoginIframe();\n                iframePromise.then(function() {\n                    exec();\n                }).catch(function(error) {\n                    promise.setError(error);\n                });\n            } else {\n                exec();\n            }\n\n            return promise.promise;\n        }\n\n        kc.clearToken = function() {\n            if (kc.token) {\n                setToken(null, null, null);\n                kc.onAuthLogout && kc.onAuthLogout();\n                if (kc.loginRequired) {\n                    kc.login();\n                }\n            }\n        }\n\n        kc.bbProcessAuthCallback = function (url) {\n            const promise = createPromise();\n            const callback = parseCallback(url);\n            processCallback(callback, promise);\n            return promise.promise;\n        }\n\n        function getRealmUrl() {\n            if (typeof kc.authServerUrl !== 'undefined') {\n                if (kc.authServerUrl.charAt(kc.authServerUrl.length - 1) == '/') {\n                    return kc.authServerUrl + 'realms/' + encodeURIComponent(kc.realm);\n                } else {\n                    return kc.authServerUrl + '/realms/' + encodeURIComponent(kc.realm);\n                }\n            } else {\n            \treturn undefined;\n            }\n        }\n\n        function getOrigin() {\n            if (!window.location.origin) {\n                return window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');\n            } else {\n                return window.location.origin;\n            }\n        }\n\n        function processCallback(oauth, promise) {\n            var code = oauth.code;\n            var error = oauth.error;\n            var prompt = oauth.prompt;\n\n            var timeLocal = new Date().getTime();\n\n            if (oauth['kc_action_status']) {\n                kc.onActionUpdate && kc.onActionUpdate(oauth['kc_action_status']);\n            }\n\n            if (error) {\n                if (prompt != 'none') {\n                    var errorData = { error: error, error_description: oauth.error_description };\n                    kc.onAuthError && kc.onAuthError(errorData);\n                    promise && promise.setError(errorData);\n                } else {\n                    promise && promise.setSuccess();\n                }\n                return;\n            } else if ((kc.flow != 'standard') && (oauth.access_token || oauth.id_token)) {\n                authSuccess(oauth.access_token, null, oauth.id_token, true);\n            }\n\n            if ((kc.flow != 'implicit') && code) {\n                var params = 'code=' + code + '&grant_type=authorization_code';\n                var url = kc.endpoints.token();\n\n                var req = new XMLHttpRequest();\n                req.open('POST', url, true);\n                req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\n                params += '&client_id=' + encodeURIComponent(kc.clientId);\n                params += '&redirect_uri=' + oauth.redirectUri;\n\n                if (oauth.pkceCodeVerifier) {\n                    params += '&code_verifier=' + oauth.pkceCodeVerifier;\n                }\n\n                req.withCredentials = true;\n\n                req.onreadystatechange = function() {\n                    if (req.readyState == 4) {\n                        if (req.status == 200) {\n\n                            var tokenResponse = JSON.parse(req.responseText);\n                            authSuccess(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], kc.flow === 'standard');\n                            scheduleCheckIframe();\n                        } else {\n                            kc.onAuthError && kc.onAuthError();\n                            promise && promise.setError();\n                        }\n                    }\n                };\n\n                req.send(params);\n            }\n\n            function authSuccess(accessToken, refreshToken, idToken, fulfillPromise) {\n                timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n                setToken(accessToken, refreshToken, idToken, timeLocal);\n\n                if (useNonce && ((kc.tokenParsed && kc.tokenParsed.nonce != oauth.storedNonce) ||\n                    (kc.refreshTokenParsed && kc.refreshTokenParsed.nonce != oauth.storedNonce) ||\n                    (kc.idTokenParsed && kc.idTokenParsed.nonce != oauth.storedNonce))) {\n\n                    logInfo('[KEYCLOAK] Invalid nonce, clearing token');\n                    kc.clearToken();\n                    promise && promise.setError();\n                } else {\n                    if (fulfillPromise) {\n                        kc.onAuthSuccess && kc.onAuthSuccess();\n                        promise && promise.setSuccess();\n                    }\n                }\n            }\n\n        }\n\n        function loadConfig(url) {\n            var promise = createPromise();\n            var configUrl;\n\n            if (!config) {\n                configUrl = 'keycloak.json';\n            } else if (typeof config === 'string') {\n                configUrl = config;\n            }\n\n            function setupOidcEndoints(oidcConfiguration) {\n                if (! oidcConfiguration) {\n                    kc.endpoints = {\n                        authorize: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/auth';\n                        },\n                        token: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/token';\n                        },\n                        logout: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/logout';\n                        },\n                        checkSessionIframe: function() {\n                            var src = getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html';\n                            if (kc.iframeVersion) {\n                              src = src + '?version=' + kc.iframeVersion;\n                            }\n                            return src;\n                        },\n                        thirdPartyCookiesIframe: function() {\n                            var src = getRealmUrl() + '/protocol/openid-connect/3p-cookies/step1.html';\n                            if (kc.iframeVersion) {\n                                src = src + '?version=' + kc.iframeVersion;\n                            }\n                            return src;\n                        },\n                        register: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/registrations';\n                        },\n                        userinfo: function() {\n                            return getRealmUrl() + '/protocol/openid-connect/userinfo';\n                        }\n                    };\n                } else {\n                    kc.endpoints = {\n                        authorize: function() {\n                            return oidcConfiguration.authorization_endpoint;\n                        },\n                        token: function() {\n                            return oidcConfiguration.token_endpoint;\n                        },\n                        logout: function() {\n                            if (!oidcConfiguration.end_session_endpoint) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.end_session_endpoint;\n                        },\n                        checkSessionIframe: function() {\n                            if (!oidcConfiguration.check_session_iframe) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.check_session_iframe;\n                        },\n                        register: function() {\n                            throw 'Redirection to \"Register user\" page not supported in standard OIDC mode';\n                        },\n                        userinfo: function() {\n                            if (!oidcConfiguration.userinfo_endpoint) {\n                                throw \"Not supported by the OIDC server\";\n                            }\n                            return oidcConfiguration.userinfo_endpoint;\n                        }\n                    }\n                }\n            }\n\n            if (configUrl) {\n                var req = new XMLHttpRequest();\n                req.open('GET', configUrl, true);\n                req.setRequestHeader('Accept', 'application/json');\n\n                req.onreadystatechange = function () {\n                    if (req.readyState == 4) {\n                        if (req.status == 200 || fileLoaded(req)) {\n                            var config = JSON.parse(req.responseText);\n\n                            kc.authServerUrl = config['auth-server-url'];\n                            kc.realm = config['realm'];\n                            kc.clientId = config['resource'];\n                            setupOidcEndoints(null);\n                            promise.setSuccess();\n                        } else {\n                            promise.setError();\n                        }\n                    }\n                };\n\n                req.send();\n            } else {\n                if (!config.clientId) {\n                    throw 'clientId missing';\n                }\n\n                kc.clientId = config.clientId;\n\n                var oidcProvider = config['oidcProvider'];\n                if (!oidcProvider) {\n                    if (!config['url']) {\n                        var scripts = document.getElementsByTagName('script');\n                        for (var i = 0; i < scripts.length; i++) {\n                            if (scripts[i].src.match(/.*keycloak\\.js/)) {\n                                config.url = scripts[i].src.substr(0, scripts[i].src.indexOf('/js/keycloak.js'));\n                                break;\n                            }\n                        }\n                    }\n                    if (!config.realm) {\n                        throw 'realm missing';\n                    }\n\n                    kc.authServerUrl = config.url;\n                    kc.realm = config.realm;\n                    setupOidcEndoints(null);\n                    promise.setSuccess();\n                } else {\n                    if (typeof oidcProvider === 'string') {\n                        var oidcProviderConfigUrl;\n                        if (oidcProvider.charAt(oidcProvider.length - 1) == '/') {\n                            oidcProviderConfigUrl = oidcProvider + '.well-known/openid-configuration';\n                        } else {\n                            oidcProviderConfigUrl = oidcProvider + '/.well-known/openid-configuration';\n                        }\n                        var req = new XMLHttpRequest();\n                        req.open('GET', oidcProviderConfigUrl, true);\n                        req.setRequestHeader('Accept', 'application/json');\n\n                        req.onreadystatechange = function () {\n                            if (req.readyState == 4) {\n                                if (req.status == 200 || fileLoaded(req)) {\n                                    var oidcProviderConfig = JSON.parse(req.responseText);\n                                    setupOidcEndoints(oidcProviderConfig);\n                                    promise.setSuccess();\n                                } else {\n                                    promise.setError();\n                                }\n                            }\n                        };\n\n                        req.send();\n                    } else {\n                        setupOidcEndoints(oidcProvider);\n                        promise.setSuccess();\n                    }\n                }\n            }\n\n            return promise.promise;\n        }\n\n        function fileLoaded(xhr) {\n            return xhr.status == 0 && xhr.responseText && xhr.responseURL.startsWith('file:');\n        }\n\n        function setToken(token, refreshToken, idToken, timeLocal) {\n            if (kc.tokenTimeoutHandle) {\n                clearTimeout(kc.tokenTimeoutHandle);\n                kc.tokenTimeoutHandle = null;\n            }\n\n            if (refreshToken) {\n                kc.refreshToken = refreshToken;\n                kc.refreshTokenParsed = decodeToken(refreshToken);\n            } else {\n                delete kc.refreshToken;\n                delete kc.refreshTokenParsed;\n            }\n\n            if (idToken) {\n                kc.idToken = idToken;\n                kc.idTokenParsed = decodeToken(idToken);\n            } else {\n                delete kc.idToken;\n                delete kc.idTokenParsed;\n            }\n\n            if (token) {\n                kc.token = token;\n                kc.tokenParsed = decodeToken(token);\n                kc.sessionId = kc.tokenParsed.session_state;\n                kc.authenticated = true;\n                kc.subject = kc.tokenParsed.sub;\n                kc.realmAccess = kc.tokenParsed.realm_access;\n                kc.resourceAccess = kc.tokenParsed.resource_access;\n\n                if (timeLocal) {\n                    kc.timeSkew = Math.floor(timeLocal / 1000) - kc.tokenParsed.iat;\n                }\n\n                if (kc.timeSkew != null) {\n                    logInfo('[KEYCLOAK] Estimated time difference between browser and server is ' + kc.timeSkew + ' seconds');\n\n                    if (kc.onTokenExpired) {\n                        var expiresIn = (kc.tokenParsed['exp'] - (new Date().getTime() / 1000) + kc.timeSkew) * 1000;\n                        logInfo('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s');\n                        if (expiresIn <= 0) {\n                            kc.onTokenExpired();\n                        } else {\n                            kc.tokenTimeoutHandle = setTimeout(kc.onTokenExpired, expiresIn);\n                        }\n                    }\n                }\n            } else {\n                delete kc.token;\n                delete kc.tokenParsed;\n                delete kc.subject;\n                delete kc.realmAccess;\n                delete kc.resourceAccess;\n\n                kc.authenticated = false;\n            }\n        }\n\n        function decodeToken(str) {\n            str = str.split('.')[1];\n\n            str = str.replace(/-/g, '+');\n            str = str.replace(/_/g, '/');\n            switch (str.length % 4) {\n                case 0:\n                    break;\n                case 2:\n                    str += '==';\n                    break;\n                case 3:\n                    str += '=';\n                    break;\n                default:\n                    throw 'Invalid token';\n            }\n\n            str = decodeURIComponent(escape(atob(str)));\n\n            str = JSON.parse(str);\n            return str;\n        }\n\n        function createUUID() {\n            var hexDigits = '0123456789abcdef';\n            var s = generateRandomString(36, hexDigits).split(\"\");\n            s[14] = '4';\n            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\n            s[8] = s[13] = s[18] = s[23] = '-';\n            var uuid = s.join('');\n            return uuid;\n        }\n\n        function parseCallback(url) {\n            var oauth = parseCallbackUrl(url);\n            if (!oauth) {\n                return;\n            }\n\n            var oauthState = callbackStorage.get(oauth.state);\n\n            if (oauthState) {\n                oauth.valid = true;\n                oauth.redirectUri = oauthState.redirectUri;\n                oauth.storedNonce = oauthState.nonce;\n                oauth.prompt = oauthState.prompt;\n                oauth.pkceCodeVerifier = oauthState.pkceCodeVerifier;\n            }\n\n            return oauth;\n        }\n\n        function parseCallbackUrl(url) {\n            var supportedParams;\n            switch (kc.flow) {\n                case 'standard':\n                    supportedParams = ['code', 'state', 'session_state', 'kc_action_status'];\n                    break;\n                case 'implicit':\n                    supportedParams = ['access_token', 'token_type', 'id_token', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n                    break;\n                case 'hybrid':\n                    supportedParams = ['access_token', 'token_type', 'id_token', 'code', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n                    break;\n            }\n\n            supportedParams.push('error');\n            supportedParams.push('error_description');\n            supportedParams.push('error_uri');\n\n            var queryIndex = url.indexOf('?');\n            var fragmentIndex = url.indexOf('#');\n\n            var newUrl;\n            var parsed;\n\n            if (kc.responseMode === 'query' && queryIndex !== -1) {\n                newUrl = url.substring(0, queryIndex);\n                parsed = parseCallbackParams(url.substring(queryIndex + 1, fragmentIndex !== -1 ? fragmentIndex : url.length), supportedParams);\n                if (parsed.paramsString !== '') {\n                    newUrl += '?' + parsed.paramsString;\n                }\n                if (fragmentIndex !== -1) {\n                    newUrl += url.substring(fragmentIndex);\n                }\n            } else if (kc.responseMode === 'fragment' && fragmentIndex !== -1) {\n                newUrl = url.substring(0, fragmentIndex);\n                parsed = parseCallbackParams(url.substring(fragmentIndex + 1), supportedParams);\n                if (parsed.paramsString !== '') {\n                    newUrl += '#' + parsed.paramsString;\n                }\n            }\n\n            if (parsed && parsed.oauthParams) {\n                if (kc.flow === 'standard' || kc.flow === 'hybrid') {\n                    if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                        parsed.oauthParams.newUrl = newUrl;\n                        return parsed.oauthParams;\n                    }\n                } else if (kc.flow === 'implicit') {\n                    if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                        parsed.oauthParams.newUrl = newUrl;\n                        return parsed.oauthParams;\n                    }\n                }\n            }\n        }\n\n        function parseCallbackParams(paramsString, supportedParams) {\n            var p = paramsString.split('&');\n            var result = {\n                paramsString: '',\n                oauthParams: {}\n            }\n            for (var i = 0; i < p.length; i++) {\n                var split = p[i].indexOf(\"=\");\n                var key = p[i].slice(0, split);\n                if (supportedParams.indexOf(key) !== -1) {\n                    result.oauthParams[key] = p[i].slice(split + 1);\n                } else {\n                    if (result.paramsString !== '') {\n                        result.paramsString += '&';\n                    }\n                    result.paramsString += p[i];\n                }\n            }\n            return result;\n        }\n\n        function createPromise() {\n            // Need to create a native Promise which also preserves the\n            // interface of the custom promise type previously used by the API\n            var p = {\n                setSuccess: function(result) {\n                    p.resolve(result);\n                },\n\n                setError: function(result) {\n                    p.reject(result);\n                }\n            };\n            p.promise = new Promise(function(resolve, reject) {\n                p.resolve = resolve;\n                p.reject = reject;\n            });\n\n            p.promise.success = function(callback) {\n                logPromiseDeprecation();\n\n                this.then(function handleSuccess(value) {\n                    callback(value);\n                });\n\n                return this;\n            }\n\n            p.promise.error = function(callback) {\n                logPromiseDeprecation();\n\n                this.catch(function handleError(error) {\n                    callback(error);\n                });\n\n                return this;\n            }\n\n            return p;\n        }\n\n        // Function to extend existing native Promise with timeout\n        function applyTimeoutToPromise(promise, timeout, errorMessage) {\n            var timeoutHandle = null;\n            var timeoutPromise = new Promise(function (resolve, reject) {\n                timeoutHandle = setTimeout(function () {\n                    reject({ \"error\": errorMessage || \"Promise is not settled within timeout of \" + timeout + \"ms\" });\n                }, timeout);\n            });\n\n            return Promise.race([promise, timeoutPromise]).finally(function () {\n                clearTimeout(timeoutHandle);\n            });\n        }\n\n        function setupCheckLoginIframe() {\n            var promise = createPromise();\n\n            if (!loginIframe.enable) {\n                promise.setSuccess();\n                return promise.promise;\n            }\n\n            if (loginIframe.iframe) {\n                promise.setSuccess();\n                return promise.promise;\n            }\n\n            var iframe = document.createElement('iframe');\n            loginIframe.iframe = iframe;\n\n            iframe.onload = function() {\n                var authUrl = kc.endpoints.authorize();\n                if (authUrl.charAt(0) === '/') {\n                    loginIframe.iframeOrigin = getOrigin();\n                } else {\n                    loginIframe.iframeOrigin = authUrl.substring(0, authUrl.indexOf('/', 8));\n                }\n                promise.setSuccess();\n            }\n\n            var src = kc.endpoints.checkSessionIframe();\n            iframe.setAttribute('src', src );\n            iframe.setAttribute('title', 'keycloak-session-iframe' );\n            iframe.style.display = 'none';\n            document.body.appendChild(iframe);\n\n            var messageCallback = function(event) {\n                if ((event.origin !== loginIframe.iframeOrigin) || (loginIframe.iframe.contentWindow !== event.source)) {\n                    return;\n                }\n\n                if (!(event.data == 'unchanged' || event.data == 'changed' || event.data == 'error')) {\n                    return;\n                }\n\n\n                if (event.data != 'unchanged') {\n                    kc.clearToken();\n                }\n\n                var callbacks = loginIframe.callbackList.splice(0, loginIframe.callbackList.length);\n\n                for (var i = callbacks.length - 1; i >= 0; --i) {\n                    var promise = callbacks[i];\n                    if (event.data == 'error') {\n                        promise.setError();\n                    } else {\n                        promise.setSuccess(event.data == 'unchanged');\n                    }\n                }\n            };\n\n            window.addEventListener('message', messageCallback, false);\n\n            return promise.promise;\n        }\n\n        function scheduleCheckIframe() {\n            if (loginIframe.enable) {\n                if (kc.token) {\n                    setTimeout(function() {\n                        checkLoginIframe().then(function(unchanged) {\n                            if (unchanged) {\n                                scheduleCheckIframe();\n                            }\n                        });\n                    }, loginIframe.interval * 1000);\n                }\n            }\n        }\n\n        function checkLoginIframe() {\n            var promise = createPromise();\n\n            if (loginIframe.iframe && loginIframe.iframeOrigin ) {\n                var msg = kc.clientId + ' ' + (kc.sessionId ? kc.sessionId : '');\n                loginIframe.callbackList.push(promise);\n                var origin = loginIframe.iframeOrigin;\n                if (loginIframe.callbackList.length == 1) {\n                    loginIframe.iframe.contentWindow.postMessage(msg, origin);\n                }\n            } else {\n                promise.setSuccess();\n            }\n\n            return promise.promise;\n        }\n\n        function check3pCookiesSupported() {\n            var promise = createPromise();\n\n            if (loginIframe.enable || kc.silentCheckSsoRedirectUri) {\n                var iframe = document.createElement('iframe');\n                iframe.setAttribute('src', kc.endpoints.thirdPartyCookiesIframe());\n                iframe.setAttribute('title', 'keycloak-3p-check-iframe' );\n                iframe.style.display = 'none';\n                document.body.appendChild(iframe);\n\n                var messageCallback = function(event) {\n                    if (iframe.contentWindow !== event.source) {\n                        return;\n                    }\n\n                    if (event.data !== \"supported\" && event.data !== \"unsupported\") {\n                        return;\n                    } else if (event.data === \"unsupported\") {\n                        loginIframe.enable = false;\n                        if (kc.silentCheckSsoFallback) {\n                            kc.silentCheckSsoRedirectUri = false;\n                        }\n                        logWarn(\"[KEYCLOAK] 3rd party cookies aren't supported by this browser. checkLoginIframe and \" +\n                            \"silent check-sso are not available.\")\n                    }\n\n                    document.body.removeChild(iframe);\n                    window.removeEventListener(\"message\", messageCallback);\n                    promise.setSuccess();\n                };\n\n                window.addEventListener('message', messageCallback, false);\n            } else {\n                promise.setSuccess();\n            }\n\n            return applyTimeoutToPromise(promise.promise, kc.messageReceiveTimeout, \"Timeout when waiting for 3rd party check iframe message.\");\n        }\n\n        function loadAdapter(type) {\n            if (!type || type == 'default') {\n                return {\n                    login: function(options) {\n                        window.location.replace(kc.createLoginUrl(options));\n                        return createPromise().promise;\n                    },\n\n                    logout: function(options) {\n                        window.location.replace(kc.createLogoutUrl(options));\n                        return createPromise().promise;\n                    },\n\n                    register: function(options) {\n                        window.location.replace(kc.createRegisterUrl(options));\n                        return createPromise().promise;\n                    },\n\n                    accountManagement : function() {\n                        var accountUrl = kc.createAccountUrl();\n                        if (typeof accountUrl !== 'undefined') {\n                            window.location.href = accountUrl;\n                        } else {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                        return createPromise().promise;\n                    },\n\n                    redirectUri: function(options, encodeHash) {\n                        if (arguments.length == 1) {\n                            encodeHash = true;\n                        }\n\n                        if (options && options.redirectUri) {\n                            return options.redirectUri;\n                        } else if (kc.redirectUri) {\n                            return kc.redirectUri;\n                        } else {\n                            return location.href;\n                        }\n                    }\n                };\n            }\n\n            if (type == 'cordova') {\n                loginIframe.enable = false;\n                var cordovaOpenWindowWrapper = function(loginUrl, target, options) {\n                    if (window.cordova && window.cordova.InAppBrowser) {\n                        // Use inappbrowser for IOS and Android if available\n                        return window.cordova.InAppBrowser.open(loginUrl, target, options);\n                    } else {\n                        return window.open(loginUrl, target, options);\n                    }\n                };\n\n                var shallowCloneCordovaOptions = function (userOptions) {\n                    if (userOptions && userOptions.cordovaOptions) {\n                        return Object.keys(userOptions.cordovaOptions).reduce(function (options, optionName) {\n                            options[optionName] = userOptions.cordovaOptions[optionName];\n                            return options;\n                        }, {});\n                    } else {\n                        return {};\n                    }\n                };\n\n                var formatCordovaOptions = function (cordovaOptions) {\n                    return Object.keys(cordovaOptions).reduce(function (options, optionName) {\n                        options.push(optionName+\"=\"+cordovaOptions[optionName]);\n                        return options;\n                    }, []).join(\",\");\n                };\n\n                var createCordovaOptions = function (userOptions) {\n                    var cordovaOptions = shallowCloneCordovaOptions(userOptions);\n                    cordovaOptions.location = 'no';\n                    if (userOptions && userOptions.prompt == 'none') {\n                        cordovaOptions.hidden = 'yes';\n                    }\n                    return formatCordovaOptions(cordovaOptions);\n                };\n\n                return {\n                    login: function(options) {\n                        var promise = createPromise();\n\n                        var cordovaOptions = createCordovaOptions(options);\n                        var loginUrl = kc.createLoginUrl(options);\n                        var ref = cordovaOpenWindowWrapper(loginUrl, '_blank', cordovaOptions);\n                        var completed = false;\n\n                        var closed = false;\n                        var closeBrowser = function() {\n                            closed = true;\n                            ref.close();\n                        };\n\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                var callback = parseCallback(event.url);\n                                processCallback(callback, promise);\n                                closeBrowser();\n                                completed = true;\n                            }\n                        });\n\n                        ref.addEventListener('loaderror', function(event) {\n                            if (!completed) {\n                                if (event.url.indexOf('http://localhost') == 0) {\n                                    var callback = parseCallback(event.url);\n                                    processCallback(callback, promise);\n                                    closeBrowser();\n                                    completed = true;\n                                } else {\n                                    promise.setError();\n                                    closeBrowser();\n                                }\n                            }\n                        });\n\n                        ref.addEventListener('exit', function(event) {\n                            if (!closed) {\n                                promise.setError({\n                                    reason: \"closed_by_user\"\n                                });\n                            }\n                        });\n\n                        return promise.promise;\n                    },\n\n                    logout: function(options) {\n                        var promise = createPromise();\n\n                        var logoutUrl = kc.createLogoutUrl(options);\n                        var ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes,clearcache=yes');\n\n                        var error;\n\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                            }\n                        });\n\n                        ref.addEventListener('loaderror', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                            } else {\n                                error = true;\n                                ref.close();\n                            }\n                        });\n\n                        ref.addEventListener('exit', function(event) {\n                            if (error) {\n                                promise.setError();\n                            } else {\n                                kc.clearToken();\n                                promise.setSuccess();\n                            }\n                        });\n\n                        return promise.promise;\n                    },\n\n                    register : function(options) {\n                        var promise = createPromise();\n                        var registerUrl = kc.createRegisterUrl();\n                        var cordovaOptions = createCordovaOptions(options);\n                        var ref = cordovaOpenWindowWrapper(registerUrl, '_blank', cordovaOptions);\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf('http://localhost') == 0) {\n                                ref.close();\n                                var oauth = parseCallback(event.url);\n                                processCallback(oauth, promise);\n                            }\n                        });\n                        return promise.promise;\n                    },\n\n                    accountManagement : function() {\n                        var accountUrl = kc.createAccountUrl();\n                        if (typeof accountUrl !== 'undefined') {\n                            var ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no');\n                            ref.addEventListener('loadstart', function(event) {\n                                if (event.url.indexOf('http://localhost') == 0) {\n                                    ref.close();\n                                }\n                            });\n                        } else {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                    },\n\n                    redirectUri: function(options) {\n                        return 'http://localhost';\n                    }\n                }\n            }\n\n            if (type == 'cordova-native') {\n                loginIframe.enable = false;\n\n                return {\n                    login: function(options) {\n                        var promise = createPromise();\n                        var loginUrl = kc.createLoginUrl(options);\n\n                        universalLinks.subscribe('keycloak', function(event) {\n                            universalLinks.unsubscribe('keycloak');\n                            window.cordova.plugins.browsertab.close();\n                            var oauth = parseCallback(event.url);\n                            processCallback(oauth, promise);\n                        });\n\n                        window.cordova.plugins.browsertab.openUrl(loginUrl);\n                        return promise.promise;\n                    },\n\n                    logout: function(options) {\n                        var promise = createPromise();\n                        var logoutUrl = kc.createLogoutUrl(options);\n\n                        universalLinks.subscribe('keycloak', function(event) {\n                            universalLinks.unsubscribe('keycloak');\n                            window.cordova.plugins.browsertab.close();\n                            kc.clearToken();\n                            promise.setSuccess();\n                        });\n\n                        window.cordova.plugins.browsertab.openUrl(logoutUrl);\n                        return promise.promise;\n                    },\n\n                    register : function(options) {\n                        var promise = createPromise();\n                        var registerUrl = kc.createRegisterUrl(options);\n                        universalLinks.subscribe('keycloak' , function(event) {\n                            universalLinks.unsubscribe('keycloak');\n                            window.cordova.plugins.browsertab.close();\n                            var oauth = parseCallback(event.url);\n                            processCallback(oauth, promise);\n                        });\n                        window.cordova.plugins.browsertab.openUrl(registerUrl);\n                        return promise.promise;\n\n                    },\n\n                    accountManagement : function() {\n                        var accountUrl = kc.createAccountUrl();\n                        if (typeof accountUrl !== 'undefined') {\n                            window.cordova.plugins.browsertab.openUrl(accountUrl);\n                        } else {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                    },\n\n                    redirectUri: function(options) {\n                        if (options && options.redirectUri) {\n                            return options.redirectUri;\n                        } else if (kc.redirectUri) {\n                            return kc.redirectUri;\n                        } else {\n                            return \"http://localhost\";\n                        }\n                    }\n                }\n            }\n\n            throw 'invalid adapter type: ' + type;\n        }\n\n        var LocalStorage = function() {\n            if (!(this instanceof LocalStorage)) {\n                return new LocalStorage();\n            }\n\n            localStorage.setItem('kc-test', 'test');\n            localStorage.removeItem('kc-test');\n\n            var cs = this;\n\n            function clearExpired() {\n                var time = new Date().getTime();\n                for (var i = 0; i < localStorage.length; i++)  {\n                    var key = localStorage.key(i);\n                    if (key && key.indexOf('kc-callback-') == 0) {\n                        var value = localStorage.getItem(key);\n                        if (value) {\n                            try {\n                                var expires = JSON.parse(value).expires;\n                                if (!expires || expires < time) {\n                                    localStorage.removeItem(key);\n                                }\n                            } catch (err) {\n                                localStorage.removeItem(key);\n                            }\n                        }\n                    }\n                }\n            }\n\n            cs.get = function(state) {\n                if (!state) {\n                    return;\n                }\n\n                var key = 'kc-callback-' + state;\n                var value = localStorage.getItem(key);\n                if (value) {\n                    localStorage.removeItem(key);\n                    value = JSON.parse(value);\n                }\n\n                clearExpired();\n                return value;\n            };\n\n            cs.add = function(state) {\n                clearExpired();\n\n                var key = 'kc-callback-' + state.state;\n                state.expires = new Date().getTime() + (60 * 60 * 1000);\n                localStorage.setItem(key, JSON.stringify(state));\n            };\n        };\n\n        var CookieStorage = function() {\n            if (!(this instanceof CookieStorage)) {\n                return new CookieStorage();\n            }\n\n            var cs = this;\n\n            cs.get = function(state) {\n                if (!state) {\n                    return;\n                }\n\n                var value = getCookie('kc-callback-' + state);\n                setCookie('kc-callback-' + state, '', cookieExpiration(-100));\n                if (value) {\n                    return JSON.parse(value);\n                }\n            };\n\n            cs.add = function(state) {\n                setCookie('kc-callback-' + state.state, JSON.stringify(state), cookieExpiration(60));\n            };\n\n            cs.removeItem = function(key) {\n                setCookie(key, '', cookieExpiration(-100));\n            };\n\n            var cookieExpiration = function (minutes) {\n                var exp = new Date();\n                exp.setTime(exp.getTime() + (minutes*60*1000));\n                return exp;\n            };\n\n            var getCookie = function (key) {\n                var name = key + '=';\n                var ca = document.cookie.split(';');\n                for (var i = 0; i < ca.length; i++) {\n                    var c = ca[i];\n                    while (c.charAt(0) == ' ') {\n                        c = c.substring(1);\n                    }\n                    if (c.indexOf(name) == 0) {\n                        return c.substring(name.length, c.length);\n                    }\n                }\n                return '';\n            };\n\n            var setCookie = function (key, value, expirationDate) {\n                var cookie = key + '=' + value + '; '\n                    + 'expires=' + expirationDate.toUTCString() + '; ';\n                document.cookie = cookie;\n            }\n        };\n\n        function createCallbackStorage() {\n            try {\n                return new LocalStorage();\n            } catch (err) {\n            }\n\n            return new CookieStorage();\n        }\n\n        function createLogger(fn) {\n            return function() {\n                if (kc.enableLogging) {\n                    fn.apply(console, Array.prototype.slice.call(arguments));\n                }\n            };\n        }\n    }\n\n    return Keycloak;\n})","import type { Base64Jwt, Seconds, SessionOptions } from 'lib-bb-auth';\nimport { Pubsub } from 'lib-bb-pubsub';\nimport type { KeycloakInitOptions, KeycloakInstance, KeycloakLoginOptions, KeycloakError, KeycloakTokenParsed } from 'vendor-bb-keycloak';\n\nexport type KeycloakPick = Pick<KeycloakInstance,\n  'init' | 'onReady' | 'onAuthSuccess' | 'onAuthRefreshSuccess' | 'onAuthLogout' | 'onTokenExpired' |\n  'token' | 'refreshToken' | 'tokenParsed' | 'timeSkew' | 'login' | 'logout' | 'updateToken' |\n  'authenticated' | 'onAuthRefreshError' | 'onAuthError'>;\n\nexport interface Tokens {\n  currentAccessToken: {\n    raw: string;\n    parsed: KeycloakTokenParsed;\n  };\n  currentRefreshToken?: string;\n  locale: string;\n}\n\nexport interface SessionHandler {\n  create: (\n    sessionInfo: Base64Jwt | number,\n    options?: SessionOptions,\n  ) => void;\n  destroy: () => void;\n  getOptions: () => Promise<Partial<KeycloakInitOptions>>;\n}\n\nexport interface KeycloakFacade {\n  login: (opts: KeycloakLoginOptions) => Promise<void>;\n  logout: (redirectUri?: string) => Promise<void>;\n  refresh: () => Promise<void>;\n  timeToLive: () => Seconds;\n  initToken: Promise<Tokens | undefined>;\n}\n\nexport function initKeycloak(\n  keycloak: KeycloakPick,\n  session: SessionHandler,\n  authPubSub: Pubsub,\n  isImpersonated?: true,\n  win: Window = window,\n): KeycloakFacade {\n  function login(loginOptions: KeycloakLoginOptions): Promise<void> {\n    if (keycloak.authenticated) {\n      console.error('Failed to go to login page, already authenticated');\n      return Promise.resolve();\n    }\n    return keycloak\n      .login(loginOptions)\n      .catch(() => {\n        throw new Error('Failed to login');\n      });\n  }\n  function logout(redirectUri?: string): Promise<void> {\n    return keycloak\n      .logout({ redirectUri })\n      .catch(() => {\n        throw new Error('Failed to logout');\n      });\n  }\n\n  function refresh(): Promise<void> {\n    return keycloak\n      .updateToken(-1)\n      .then(() => {})\n      .catch(() => {\n        throw new Error('Failed to refresh token');\n      });\n  }\n\n  function timeToLive(): Seconds {\n    if (keycloak.tokenParsed && keycloak.tokenParsed.exp) {\n      return keycloak.tokenParsed.exp - Math.ceil(new Date().getTime() / 1000) + (keycloak.timeSkew || 0);\n    }\n\n    return -1;\n  }\n\n  /**\n   * onLoad: set to 'login-required' as modern browsers are removing support for check-sso setting.\n   * checkLoginIframe: set to false to remove the call to open an iframe.\n   */\n  const initOptions: KeycloakInitOptions = {\n    flow: 'hybrid',\n    checkLoginIframe: false,\n    pkceMethod: 'S256',\n  };\n  const initToken: Promise<Tokens | undefined> = session.getOptions()\n    .then((options) => keycloak.init({ ...initOptions, ...options }))\n    .then((isAuthenticated: boolean) => (isAuthenticated ? getPayload() : undefined));\n\n  // MAINT-12100 when PKCE is enabled and if user bookmarks keycloak login page\n  // authentication will fail, but login again will issue new valid PKCE code verifier\n  function reLogin(callback: () => void, key: string = 'kc-login-attempt') {\n    const laDate = win.sessionStorage.getItem(key);\n    if (laDate) {\n      const millis = Date.now() - Number(laDate);\n      const elapsed = Math.floor(millis / 1000);\n      if (elapsed < 10) {\n        win.sessionStorage.removeItem(key);\n        callback();\n        return;\n      }\n    }\n    win.sessionStorage.setItem(key, Date.now().toString());\n    login({});\n  }\n\n  keycloak.onReady = (isAuthenticated: boolean) => {\n    if (isAuthenticated) {\n      authPubSub.publish('auth:init', getPayload());\n    } else if (!isImpersonated) {\n      reLogin(() => {\n        authPubSub.publish('auth:init', undefined);\n      });\n    }\n  };\n\n  keycloak.onAuthSuccess = () => {\n    onRefreshToken(() => {\n      if (keycloak.token && keycloak.timeSkew !== undefined) {\n        session.create(keycloak.token, {\n          timeSkew: keycloak.timeSkew,\n          refreshToken: keycloak.refreshToken,\n          forceSessionCookie: true,\n          isImpersonated,\n        });\n        authPubSub.publish('auth:success', getPayload());\n      }\n    });\n  };\n\n  keycloak.onAuthRefreshSuccess = () => {\n    if (keycloak.token && keycloak.timeSkew !== undefined && keycloak.refreshToken !== undefined) {\n      session.create(keycloak.token, {\n        timeSkew: keycloak.timeSkew,\n        refreshToken: keycloak.refreshToken,\n        forceSessionCookie: true,\n        isImpersonated,\n      });\n      authPubSub.publish('auth:success', getPayload());\n    }\n  };\n\n  keycloak.onTokenExpired = () => {\n    session.destroy();\n    authPubSub.publish('auth:end', {});\n  };\n\n  keycloak.onAuthError = (error?: KeycloakError) => {\n    authPubSub.publish('auth:error', {\n      name: (error && error.error) || 'authentication error',\n      message: (error && error.error_description) || 'Unknown authentication error',\n    });\n  };\n\n  keycloak.onAuthRefreshError = () => {\n    authPubSub.publish('auth:error', {\n      name: 'authentication refresh error',\n      message: 'Error while refreshing the token',\n    });\n  };\n\n  /**\n   * Checks for updates in keycloak refreshToken property.\n   * The keycloak init flow will call 'onAuthSuccess' when token is found, but will not call again\n   * after secondary request gets refreshToken.\n   * @param cb callback once refreshToken is found\n   */\n  function onRefreshToken(cb: () => void) {\n    const waitForRefreshToken = () =>\n      setTimeout(() => {\n        if (keycloak.refreshToken) {\n          cb();\n        } else {\n          waitForRefreshToken();\n        }\n      }, 100);\n    waitForRefreshToken();\n  }\n\n  function getPayload(): Tokens {\n    const kcLocale = keycloak.tokenParsed && (keycloak.tokenParsed as any).locale;\n    return {\n      currentAccessToken: {\n        raw: keycloak.token as string,\n        parsed: keycloak.tokenParsed as KeycloakTokenParsed,\n      },\n      currentRefreshToken: keycloak.refreshToken,\n      locale: kcLocale,\n    };\n  }\n\n  return {\n    login,\n    logout,\n    refresh,\n    timeToLive,\n    initToken,\n  };\n}\n","import type { SetLocale } from 'lib-bb-set-locale';\n\nexport interface LocalesHandler {\n  handleLocaleChange: (kcLocale: string) => Promise<void>;\n  getOrderedLocales: () => string;\n}\n\nexport function createLocaleHandler(locale: string, locales: string[], setLocale: SetLocale): LocalesHandler {\n  let currentLocale = locale;\n\n  function getMatchingLocale(kcLocale: string): string | undefined {\n    return locales.find((supportedLocale: string) => kcLocale === supportedLocale)\n      || locales.find((supportedLocale: string) => supportedLocale.indexOf(kcLocale) === 0);\n  }\n\n  function handleLocaleChange(keycloakLocale: string): Promise<void> {\n    const matchingLocale = getMatchingLocale(keycloakLocale.trim());\n\n    if (matchingLocale && matchingLocale !== currentLocale) {\n      return setLocale(matchingLocale).then(() => {\n        currentLocale = matchingLocale;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  // make sure that first locale sent to keycloak is current active\n  function getOrderedLocales(): string {\n    const removedCurrent = locales.filter((loc: string) => loc !== currentLocale);\n    return [currentLocale]\n      .concat(removedCurrent)\n      .join(' ');\n  }\n\n  return {\n    handleLocaleChange,\n    getOrderedLocales,\n  };\n}\n","import type { AuthSession, AuthUtils } from 'lib-bb-auth';\nimport { Pubsub } from 'lib-bb-pubsub';\nimport type { KeycloakInitOptions, KeycloakInstance } from 'vendor-bb-keycloak';\nimport type { Config, HybridStrategy } from '.';\nimport { KeycloakFacade, SessionHandler, Tokens } from './keycloak-init';\nimport type { LocalesHandler } from './locales';\n\nexport type InitUtils = Pick<AuthUtils, 'cookie' | 'isExternal' | 'redirect' | 'resolveRedirectUri' | 'getQueryStringValue'>;\n\nexport type KeycloakPick = Pick<KeycloakInstance,\n  'login' | 'logout' | 'updateToken' | 'tokenParsed' | 'authenticated' | 'timeSkew'>;\n\nexport type InitConfig = Pick<Config, 'loginPageUrl' | 'landingPageUrl'>;\n\nexport type InitLocation = Pick<Location, 'href' | 'hash'>;\n\nexport const REDIRECT_URL_COOKIE_NAME = 'redirectUrl';\n\n/**\n * This function tests if the testingString is the same or a portion of string.\n * @param string\n * @param testingString\n */\nconst startsWith = (string: string, testingString: string): boolean => {\n  return string.indexOf(testingString) === 0;\n};\n\nexport function getCxDesignModeApi(): HybridStrategy {\n  return {\n    refresh: () => Promise.resolve(),\n    timeToLive: () => 3000,\n    reauthenticate: () => Promise.resolve(),\n    goToLoginPage: () => {},\n    logout: () => Promise.resolve(),\n    isImpersonated: () => false,\n    initToken: Promise.resolve(undefined),\n  };\n}\n\nexport function createCxSessionHandler(\n  getAuthTokens: () => Promise<Partial<KeycloakInitOptions>>,\n  session: AuthSession,\n  redirect: () => void,\n) {\n  const getOptions = () => getAuthTokens()\n    .then((tokens?: { token?: string | undefined, refreshToken?: string | undefined }) => {\n      const options: Partial<KeycloakInitOptions> = {};\n      if (tokens && tokens.token) {\n        session.create(tokens.token, {\n          refreshToken: tokens.refreshToken,\n          forceSessionCookie: true,\n          isImpersonated: true,\n        });\n        /**\n         * Redirect to landing page because we've been sent to the login page with impersonation code.\n         */\n        redirect();\n      } else {\n        const bbSession = session.getSession();\n        if (bbSession) {\n          options.timeSkew = bbSession.timeSkew;\n          if (bbSession.refreshToken) {\n            options.refreshToken = bbSession.refreshToken;\n          }\n          if (bbSession.token) {\n            options.token = bbSession.token;\n          }\n        }\n      }\n      return options;\n    });\n  return {\n    ...session,\n    getOptions,\n  };\n}\n\nexport function createCxStrategy(\n  keycloakFacade: KeycloakFacade,\n  strategy: HybridStrategy,\n  session: SessionHandler,\n  config: InitConfig,\n  localesHandler: LocalesHandler,\n  utils: InitUtils,\n  authPubSub: Pubsub,\n  location: InitLocation = window.location,\n) {\n  const isLoginPage = startsWith(location.href, config.loginPageUrl);\n  const stateExists = location.hash.indexOf('state') > -1;\n  const isImpersonated = strategy.isImpersonated && strategy.isImpersonated() || false;\n  const isLoginPageWithoutState = isLoginPage && !stateExists && !isImpersonated && keycloakFacade.timeToLive() < 0;\n\n  if (isLoginPageWithoutState) {\n    strategy.initToken.then((tokens?: Tokens) => {\n      if (!tokens || (tokens && !tokens.currentAccessToken)) {\n        goToLoginPage(utils.getQueryStringValue('redirect'));\n      }\n    }).catch(() => {\n      goToLoginPage(utils.getQueryStringValue('redirect'));\n    });\n  }\n\n  /**\n   * Redirects the user to cookie redirectUrl or configured landingPageUrl.\n   */\n  function redirectToLogin() {\n    const landingPage = utils.cookie.get(REDIRECT_URL_COOKIE_NAME) || config.landingPageUrl;\n    utils.cookie.remove(REDIRECT_URL_COOKIE_NAME);\n    utils.redirect(landingPage, () => keycloakFacade.logout());\n  }\n\n  authPubSub.subscribe('auth:success', ({ locale }: { locale?: string }) => {\n    let localePromise = Promise.resolve();\n    if (locale && stateExists) {\n      localePromise = localesHandler.handleLocaleChange(locale);\n    }\n\n    if (isLoginPage) {\n      localePromise.then(redirectToLogin).catch(redirectToLogin);\n    }\n  });\n\n  function goToLoginPage(redirectPageUrl?: string): void {\n    const redirectUrl = redirectPageUrl || utils.cookie.get(REDIRECT_URL_COOKIE_NAME);\n\n    if (redirectUrl && !utils.isExternal(redirectUrl)) {\n      utils.cookie.set(REDIRECT_URL_COOKIE_NAME, redirectUrl);\n    }\n    const loginOptions: Keycloak.KeycloakLoginOptions = {\n      redirectUri: config.loginPageUrl,\n    };\n    loginOptions.locale = localesHandler.getOrderedLocales();\n    keycloakFacade.login(loginOptions);\n  }\n\n  return {\n    ...strategy,\n    goToLoginPage,\n    logout: (redirectPageUrl?: string) => {\n      session.destroy();\n\n      const redirectUri = utils.resolveRedirectUri(config.loginPageUrl, redirectPageUrl || config.landingPageUrl);\n      return keycloakFacade.logout(redirectUri);\n    },\n  };\n}\n","import type {\n  ChallengeResponse,\n  ChallengeResponseBody,\n  ChallengeResponseFunction,\n  ReauthConfig,\n} from 'lib-bb-auth';\nimport type { HttpError, HttpMethod, HttpRequest, HttpResponse } from 'lib-bb-http';\n\n/**\n * A set of error codes generated within the reauthentication flow\n */\nexport enum ReauthErrorCodes {\n  UNAVAILABLE = 'reauth_unavailable',\n  UNKNOWN = 'unknown_error',\n  CHALLENGE_ERROR = 'challenge_error',\n  TOKEN_ERROR = 'token_error',\n}\n\ninterface Custom {\n  [key: string]: string | undefined;\n}\n\nexport interface AuthUrl {\n  authServerUrl?: string;\n  createLoginUrl: (options: Partial<{ scope: string, redirectUri: string }>) => string;\n  bbProcessAuthCallback: (url: string) => Promise<void>;\n}\n\nexport class Reauthentication {\n  constructor(\n    private readonly authUrl: AuthUrl,\n    private readonly request: HttpRequest,\n    private readonly replace: Location['replace'] = window.location.replace,\n  ) {}\n\n  reauthenticate(scope: string, acrValues: string, reauthConfig?: ReauthConfig): Promise<void> {\n    if (!this.authUrl.authServerUrl) {\n      return Promise.reject(this.getErrorResponse(ReauthErrorCodes.UNAVAILABLE));\n    }\n    const redirectUri = reauthConfig ? reauthConfig.redirectUri : undefined;\n    const redirect = (reauthConfig && reauthConfig.redirect) || false;\n    const authUrl = this.authUrl.createLoginUrl({ scope, redirectUri }) + `&acr_values=${acrValues}`;\n    if (redirect) {\n      this.replace(authUrl);\n      return Promise.resolve();\n    }\n    return this.performReauthentication(authUrl).then();\n  }\n\n  private performReauthentication(authUrl: string): Promise<void | ChallengeResponse> {\n    return this.performRequest('GET', authUrl);\n  }\n\n  private onSuccess(response: HttpResponse): Promise<void | ChallengeResponse> {\n    const locationHeader = this.getLocationHeader(response);\n    if (locationHeader && this.hasCodeInLocation(locationHeader)) {\n      return this.updateToken(locationHeader)\n        .catch(() => {\n          throw this.getErrorResponse(ReauthErrorCodes.TOKEN_ERROR);\n        });\n    }\n    return Promise.reject(this.getErrorResponse());\n  }\n\n  private onError(error: HttpError): ChallengeResponse {\n    if (error.status === 401) {\n      try {\n        return this.getChallenge(error.response);\n      } catch {\n        const errorParams = this.getErrorParams(error);\n        if (errorParams) {\n          // Error has occurred, add error data\n          return this.getErrorResponse(errorParams.error, errorParams.description);\n        }\n        return this.getErrorResponse(ReauthErrorCodes.CHALLENGE_ERROR);\n      }\n    } else {\n      return this.getErrorResponse();\n    }\n  }\n\n  private createChallengeResponseFunction(url: string): ChallengeResponseFunction {\n    return (data: any) => {\n      return this.performRequest('POST', url, data);\n    };\n  }\n\n  private getChallenge(errorResponse: string): ChallengeResponse {\n    const challengeResponse = JSON.parse(errorResponse) as ChallengeResponseBody;\n    const { challengeType, actionUrl, ...challengeData } = challengeResponse.challenges[0];\n    const challengeUrl = actionUrl.startsWith('/auth')\n      ? this.authUrl.authServerUrl + actionUrl.substr(5)\n      : this.authUrl.authServerUrl + actionUrl;\n    return {\n      challengeType,\n      challengeData,\n      postChallengeResponse: this.createChallengeResponseFunction(challengeUrl),\n    };\n  }\n\n  private hasCodeInLocation(location: string) {\n    const params = location.match(/code(=([^&#]*)|&|#|$)/) || [];\n    return params && params[2];\n  }\n\n  private getErrorResponse(code?: string, description?: string): ChallengeResponse {\n    return {\n      error: {\n        errorCode: code || ReauthErrorCodes.UNKNOWN,\n        errorDescription: description,\n      },\n    };\n  }\n\n  private getErrorParams(error: HttpError): Custom | undefined {\n    const locationHeader = this.getLocationHeader(error);\n    if (!locationHeader) {\n      return;\n    }\n\n    const locationUrl = new URL(locationHeader);\n    if (!locationUrl.search) {\n      return;\n    }\n\n    const params = locationUrl.searchParams;\n    return {\n      error: params.get('error') || undefined,\n      description: params.get('error_description') || undefined,\n    };\n  }\n\n  private getLocationHeader(response: void | HttpResponse | HttpError) {\n    return response && response.headers && (response.headers.location || response.headers.Location);\n  }\n\n  private performRequest(method: HttpMethod, url: string, data?: any) {\n    const request = {\n      method,\n      url,\n      headers: {\n        Accept: '*/*',\n        'X-Convert-Redirects': 'true',\n      },\n      data: JSON.stringify(data) || undefined,\n      withCredentials: true,\n    };\n    return this.request(request)\n      // catch must go first because onSuccess can throw\n      .catch((error: HttpError) => {\n        throw this.onError(error);\n      })\n      .then((response: HttpResponse) => this.onSuccess(response));\n  }\n\n  private updateToken(url: string): Promise<void> {\n    /**\n     * bbProcessAuthCallback\n     * Calls the keycloak adapter to process the url input.\n     * The processing uses the code paramter in the url input to call for a keycloak auth token.\n     * This in turn will call onAuthSuccess listed above.\n     * This should be migrated when we update the keycloak adapter.\n     */\n    return this.authUrl\n      .bbProcessAuthCallback(url)\n      .catch(() => {\n        throw new Error('Failed to process authorization code');\n      });\n  }\n}\n","import { KeycloakInitOptions } from 'vendor-bb-keycloak';\nimport { HybridStrategy } from '.';\nimport { KeycloakFacade, SessionHandler } from './keycloak-init';\nimport { LocalesHandler } from './locales';\n\nexport function createCdnSessionHandler(\n  getAuthTokens: () => Promise<Partial<KeycloakInitOptions>>,\n): SessionHandler {\n  return {\n    create: () => {},\n    destroy: () => {},\n    getOptions: getAuthTokens,\n  };\n}\n\nexport function createCdnStrategy(\n  strategy: HybridStrategy,\n  localesHandler: LocalesHandler,\n  keycloakFacade: KeycloakFacade,\n  session: SessionHandler,\n) {\n  return {\n    ...strategy,\n    goToLoginPage: (redirectUri?: string) => {\n      const loginOptions: Keycloak.KeycloakLoginOptions = {\n        redirectUri,\n      };\n      loginOptions.locale = localesHandler.getOrderedLocales();\n      keycloakFacade.login(loginOptions);\n    },\n    logout: (redirectUri?: string) => {\n      session.destroy();\n      return keycloakFacade.logout(redirectUri);\n    },\n  };\n}\n","import { AuthUtils, BackbaseSession, HttpRequest, HttpRequestConfig } from 'lib-bb-page-bootstrap-cdn';\nimport { KeycloakInitOptions } from 'vendor-bb-keycloak';\n\nexport const IMPERSONATION_PARAM = 'impersonation_code';\n\nfunction stripImpersonationCodeFromUrl() {\n  const url = new URL(window.location.href);\n  url.searchParams.delete(IMPERSONATION_PARAM);\n  window.history.replaceState(window.history.state, '', url.toString());\n}\n\nexport function createImpersonation(\n  request: HttpRequest,\n  getQueryStringValue: AuthUtils['getQueryStringValue'],\n  apiRoot: string,\n  realm: string,\n  client: string,\n  session: BackbaseSession | null,\n) {\n  const impersonationToken = getQueryStringValue(IMPERSONATION_PARAM) || undefined;\n  const hasImpersonatedToken = Boolean(impersonationToken);\n  const isImpersonated = hasImpersonatedToken || (session && session.isImpersonated) || false;\n\n  /**\n   * Function to retrieve auth and refresh tokens for an impersonated user when impersonation code\n   * is found in URL. In CX we expect this to occur on the login page, so after these tokens are set\n   * we redirect to the landing page set on the config.\n   * @returns Promise<void> will return promise in CDN strategy or when impersonation service call errors.\n   */\n  function exchangeImpersonationToken(): Promise<Partial<KeycloakInitOptions>> {\n    const req: HttpRequestConfig = {\n      method: 'POST',\n      url: `${window.location.origin}${apiRoot}/orchestration/client-api/v1/impersonation/token`,\n      data: JSON.stringify({\n        realm,\n        client,\n        ref: impersonationToken,\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    return request(req).then(\n      (response) => {\n        stripImpersonationCodeFromUrl();\n        const body: {\n          access_token: string;\n          refresh_token: string;\n        } = JSON.parse(response.body);\n        return {\n          token: body.access_token,\n          refreshToken: body.refresh_token,\n        };\n      },\n    ).catch((e: Error) => {\n      console.error(`Error while exchanging emulation token\\n${e}`);\n      /**\n       * Returning an empty object, if the token exchange fails. This should kick\n       * the user out to login if they have no session already.\n       */\n      return {};\n    });\n  }\n\n  const getAuthTokens: () => Promise<Partial<KeycloakInitOptions>> = () => {\n    /**\n     * We should only return access and refresh tokens if we've made an exchange.\n     * Otherwise these should be read from the existing session.\n     */\n    if (hasImpersonatedToken) {\n      return exchangeImpersonationToken();\n    }\n    return Promise.resolve({});\n  };\n\n  return {\n    isImpersonated,\n    getAuthTokens,\n  };\n}\n","import { PageConfig } from '.';\nimport { Seconds } from 'lib-bb-auth';\n\n/**\n * AuthKind Enumeration\n *\n * This enumeration is used to choose what kind of authentication\n * we want to use.\n */\nexport enum AuthKind {\n  /** Basic Authentication */\n  Basic = 'bas',\n  /** Hybrid Authentication */\n  Hybrid = 'hybrid',\n  /** Custom Authentication */\n  Custom = 'custom',\n}\n\n/**\n * BAS Authentication Config Interface\n */\nexport interface BasConfig {\n  /** Basic Authentication is set */\n  kind: AuthKind.Basic;\n  /** Url used for the landing page */\n  landingPageUrl?: string;\n  /** Url used for the login page */\n  loginPageUrl?: string;\n  /** Url to authenticate the user */\n  authUrl?: string;\n  /** On getting authenticated this is the url to refresh */\n  refreshUrl?: string;\n  /** Url to logout */\n  logoutUrl?: string;\n  /** Url to check the status */\n  statusUrl?: string;\n  /** Time in seconds before session expiry that countdown will start */\n  countdownDuration?: Seconds;\n  /** Time in seconds of maximum user inactivity before session is terminated */\n  maxInactivityDuration?: Seconds;\n  /** Time in seconds of keeping alive session in CX5 */\n  sessionTTL?: Seconds;\n}\n\n/**\n * Hybrid Authentication Config Interface\n */\nexport interface HybridConfig {\n  /** Hybrid Authentication is set */\n  kind: AuthKind.Hybrid;\n  /** Url used for the landing page */\n  landingPageUrl: string;\n  /** Url used for the login page */\n  loginPageUrl: string;\n  /** Url to authenticate the user */\n  authUrl: string;\n  /** ClientId hash for the app we want to get authenticated*/\n  clientId: string;\n  /** App Scope */\n  scope: string;\n  /** App Realm */\n  realm: string;\n  /** Time in seconds before session expiry that countdown will start */\n  countdownDuration?: Seconds;\n  /** Time in seconds of maximum user inactivity before session is terminated */\n  maxInactivityDuration?: Seconds;\n}\n\n/**\n * Custom Authentication Config Interface\n */\nexport interface CustomConfig {\n  /** Custom Authentication is set */\n  kind: AuthKind.Custom;\n  /** Time in seconds before session expiry that countdown will start */\n  countdownDuration?: Seconds;\n  /** Time in seconds of maximum user inactivity before session is terminated */\n  maxInactivityDuration?: Seconds;\n  [key: string]: any;\n}\n\n/**\n * AuthConfigs Union type.\n * It can only be one of these types.\n */\nexport type AuthConfigs = BasConfig | HybridConfig | CustomConfig;\n\nconst createGetFullUrl = () => (path: string) => `${location.protocol}//${location.host}${path}`;\n\nexport const normalizeAuthConfig = (pageConfig: PageConfig, rawCxConfig?: any): AuthConfigs => {\n  if (rawCxConfig === undefined) {\n    return defaultRawBasConfig(pageConfig);\n  }\n  if (rawCxConfig.maxInactivityDuration) {\n    rawCxConfig.maxInactivityDuration = parseInt(rawCxConfig.maxInactivityDuration, 10);\n  }\n  if (rawCxConfig.countdownDuration) {\n    rawCxConfig.countdownDuration = parseInt(rawCxConfig.countdownDuration, 10);\n  }\n  switch (rawCxConfig.kind) {\n    case AuthKind.Custom:\n      const customConfig: CustomConfig = {\n        ...rawCxConfig,\n        kind: AuthKind.Custom,\n      };\n      return customConfig;\n    case AuthKind.Hybrid:\n      const hybridConfig: HybridConfig = {\n        ...rawCxConfig,\n        kind: AuthKind.Hybrid,\n        landingPageUrl: rawCxConfig.landingPageUrl,\n        loginPageUrl: rawCxConfig.loginPageUrl,\n        authUrl: rawCxConfig.authUrl,\n        clientId: rawCxConfig.clientId,\n        scope: rawCxConfig.scope,\n        realm: rawCxConfig.realm,\n      };\n      return hybridConfig;\n    default:\n      return { ...defaultRawBasConfig(pageConfig), ...rawCxConfig } as BasConfig;\n  }\n};\n\nexport const defaultRawBasConfig = (pageConfig: PageConfig): BasConfig => {\n  const getFullUrl = createGetFullUrl();\n  const portalPath = `${pageConfig.linkRoot}/${pageConfig.portalName}`;\n  return {\n    kind: AuthKind.Basic,\n    landingPageUrl: getFullUrl(`${portalPath}/index`),\n    loginPageUrl: getFullUrl(`${portalPath}/login`),\n    authUrl: getFullUrl(`${pageConfig.apiRoot}/auth/login`),\n    refreshUrl: getFullUrl(`${pageConfig.apiRoot}/auth/refresh`),\n    logoutUrl: getFullUrl(`${pageConfig.apiRoot}/auth/logout`),\n    statusUrl: getFullUrl(`${pageConfig.apiRoot}/auth/status`),\n  };\n};\n","/**\n * @module lib-bb-auth-hybrid\n * @description Library to create Hybrid Authentication\n */\nimport type { AuthSession, AuthStrategy, AuthUtils } from 'lib-bb-auth';\nimport Keycloak, { KeycloakInstance } from 'vendor-bb-keycloak';\nimport type { Pubsub } from 'lib-bb-pubsub';\nimport { initKeycloak, KeycloakFacade } from './keycloak-init';\nimport { createLocaleHandler } from './locales';\nimport { createCxStrategy, getCxDesignModeApi, createCxSessionHandler } from './cx-strategy';\nimport { Reauthentication } from './reauthentication';\nimport { createCdnSessionHandler, createCdnStrategy } from './cdn-strategy';\nimport { createImpersonation } from './impersonation';\n\nexport { ReauthErrorCodes } from './reauthentication';\n\n/**\n * Config interface\n */\nexport interface Config {\n  /** Config Type */\n  kind: 'hybrid';\n  /**\n   * Url for landing page\n   */\n  landingPageUrl: string;\n  /**\n   * Url for login page\n   */\n  loginPageUrl: string;\n  /**\n   * Url for authentication\n   */\n  authUrl: string;\n  /**\n   * ClientId to get JWT Token\n   */\n  clientId: string;\n  /**\n   * Scope of app to get JWT Token\n   */\n  scope: string;\n  /**\n   * Realm of app to get JWT Token\n   */\n  realm: string;\n}\n\nexport interface HybridEnvironmentConfig {\n  locale: string;\n  locales: string[];\n  designmode: boolean;\n  apiRoot: string;\n}\n\nexport type HybridStrategy = Exclude<AuthStrategy, 'login' | 'goToLoginpage'>\n  & { initToken: KeycloakFacade['initToken'] };\n\n/**\n * Creates a Hybrid Authorization Strategy\n *\n * @param config Hybrid Auth config\n * @param session Authorization Session\n * @param utils Authorization Utils\n * @returns AuthStrategy\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { AUTH, AUTH_STRATEGY } from 'lib-bb-bb-auth';\n * import { createHybridAuth } from 'lib-bb-bb-auth-hybrid';\n * ```\n */\nexport function createAuthStrategy(\n  config: Config,\n  session: AuthSession,\n  utils: AuthUtils,\n  envConfig: HybridEnvironmentConfig,\n  pubsub: Pubsub,\n): AuthStrategy {\n  if (envConfig.designmode) {\n    return getCxDesignModeApi();\n  }\n\n  const {\n    isImpersonated,\n    getAuthTokens,\n  } = createImpersonation(\n    utils.request,\n    utils.getQueryStringValue,\n    envConfig.apiRoot,\n    config.realm,\n    config.clientId,\n    session.getSession(),\n  );\n\n  const isCDN = config.loginPageUrl === '' && config.landingPageUrl === '';\n  const sessionHandler = isCDN\n    ? createCdnSessionHandler(getAuthTokens)\n    : createCxSessionHandler(getAuthTokens, session, () => utils.redirect(config.landingPageUrl));\n\n  const keycloak: KeycloakInstance = Keycloak({\n    url: config.authUrl,\n    clientId: config.clientId,\n    realm: config.realm,\n  });\n  const keycloakFacade = initKeycloak(keycloak, sessionHandler, pubsub, isImpersonated || undefined);\n  const reauthentication = new Reauthentication(keycloak, utils.request);\n\n  const strategy: HybridStrategy = {\n    refresh: keycloakFacade.refresh,\n    timeToLive: keycloakFacade.timeToLive,\n    reauthenticate: reauthentication.reauthenticate.bind(reauthentication),\n    isImpersonated: () => isImpersonated,\n    initToken: keycloakFacade.initToken,\n  };\n  const localesHandler = createLocaleHandler(envConfig.locale, envConfig.locales, utils.setLocale);\n\n  if (isCDN) {\n    return createCdnStrategy(strategy, localesHandler, keycloakFacade, sessionHandler);\n  }\n\n  return createCxStrategy(\n    keycloakFacade,\n    strategy,\n    sessionHandler,\n    config,\n    localesHandler,\n    utils,\n    pubsub,\n  );\n}\n","export interface FeatureToggles {\n  entitlements: EntitlementsConfig;\n}\n\nexport interface EntitlementsConfig {\n  enabled: boolean;\n  uri?: string;\n}\n\nconst isEntitlementsEnabled = (entitlementsEnable: any, designMode: boolean) => {\n  const entitlementsEnableType = typeof entitlementsEnable;\n\n  if (designMode) {\n    return false;\n  }\n\n  switch (entitlementsEnableType) {\n    case 'string': return entitlementsEnable === 'true';\n    case 'boolean': return entitlementsEnable;\n    default: return false;\n  }\n};\n\nexport const getFeatureToggles = (config: { designmode: boolean }, rawCxConfig?: any): FeatureToggles => {\n  const features: FeatureToggles = {\n    entitlements: {\n      enabled: false,\n    },\n  };\n\n  if (!rawCxConfig) {\n    return features;\n  }\n\n  const entitlementsEnabled = isEntitlementsEnabled(rawCxConfig.entitlementsEnable, config.designmode);\n  if (entitlementsEnabled) {\n    features.entitlements.enabled = true;\n  }\n  if (entitlementsEnabled && rawCxConfig.entitlementsUri) {\n    features.entitlements.uri = rawCxConfig.entitlementsUri;\n  }\n\n  return features;\n};\n","/**\n * @module lib-bb-page-config\n * @description Backbase server side rendered page configuration\n */\nimport { normalizeAuthConfig, AuthConfigs } from './auth-config';\nimport { getFeatureToggles, FeatureToggles } from './feature-toggles';\n\nexport { AuthConfigs, AuthKind, BasConfig, HybridConfig, CustomConfig } from './auth-config';\n\nexport { FeatureToggles, EntitlementsConfig } from './feature-toggles';\n\nexport type ModuleLoader = (name: string) => { [key: string]: any };\n\n/**\n * PageConfig interface\n */\nexport interface PageConfig {\n  /**\n   * Major version of CXP (5 or 6)\n   */\n  version: string;\n  /**\n   * Portal gateway API path\n   */\n  apiRoot: string;\n  /**\n   * URI where the resources of imported catalog items are located\n   */\n  staticResourcesRoot: string;\n  /**\n   * Name of the portal that current page belongs to\n   */\n  portalName: string;\n  /**\n   * Name of the current page item\n   */\n  pageName: string;\n  /**\n   * True if page is rendered inside CXP Manager\n   */\n  designmode: boolean;\n  /**\n   * Uuid of the current link\n   */\n  currentLinkUUID: string;\n  /**\n   * Uuid of the current link\n   */\n  currentLink: string;\n  /**\n   * Current page locale\n   */\n  locale: string;\n  /**\n   * Array of available locale ISO values\n   */\n  locales: string[];\n  /**\n   * Portal link path\n   */\n  linkRoot: string;\n  /**\n   * CSP nonce\n   */\n  cspNonce: string;\n  /**\n   * web-sdk version\n   */\n  webSdkVersion: string;\n  /**\n   * Flag to detect if user is manager\n   */\n  isManager?: boolean;\n  /**\n   * Flag to detect if user is admin\n   */\n  isAdmin?: boolean;\n  /**\n   * Current user id\n   */\n  userId: string;\n}\n\n/**\n * RawPageConfig interface\n */\nexport interface RawPageConfig {\n  /**\n   * Major version of CXP (5 or 6)\n   */\n  version: string;\n  /**\n   * Portal gateway API path\n   */\n  apiRoot: string;\n  /**\n   * URI where the resources of imported catalog items are located\n   */\n  staticResourcesRoot: string;\n  /**\n   * Name of the portal that current page belongs to\n   */\n  portalName: string;\n  /**\n   * Name of the current page item\n   */\n  pageName: string;\n  /**\n   * 'true' if page is rendered inside CXP Manager\n   */\n  designmode: string;\n  /**\n   * Uuid of the current link\n   */\n  currentLinkUUID: string;\n  /**\n   * Uuid of the current link\n   */\n  currentLink: string;\n  /**\n   * Current page locale\n   */\n  locale: string;\n  /**\n   * Comma separated string of available locale ISO values\n   */\n  locales: string;\n  /**\n   * Portal link path\n   */\n  linkRoot: string;\n  /**\n   * CSP nonce\n   */\n  cspNonce: string;\n  /**\n   * Module loader\n   */\n  loadModule?: ModuleLoader;\n  /**\n   * Experience configuration\n   */\n  cx?: any;\n  /**\n  * Authentication configuration\n  */\n  auth?: any;\n  /**\n   * Flag to detect if user is manager\n   */\n  isManager?: string;\n  /**\n   * Flag to detect if user is admin\n   */\n  isAdmin?: string;\n  /**\n   * Current user id\n   */\n  userId: string;\n}\n\nexport interface NormalizedConfig {\n  pageConfig: PageConfig;\n  authConfig: AuthConfigs;\n  moduleLoader: ModuleLoader;\n  featureToggles: FeatureToggles;\n}\n\nconst defaultLoadModule = (): ModuleLoader => {\n  const systemImport = (window as any).System.import;\n  if (systemImport) {\n    return systemImport.bind((window as any).System);\n  }\n  throw new Error(`Module loader is not defined!`);\n};\n\nconst defaultRawPageConfig: RawPageConfig = {\n  version: '6',\n  apiRoot: '',\n  staticResourcesRoot: '',\n  portalName: '',\n  pageName: '',\n  designmode: 'false',\n  currentLinkUUID: '',\n  currentLink: '',\n  locale: 'en-US',\n  locales: 'en-US',\n  linkRoot: '',\n  cspNonce: '',\n  isAdmin: 'false',\n  isManager: 'false',\n  userId: '',\n};\n\n/**\n * Function to create PageConfig DI instance\n *\n * @param rawPageConfig RawPageConfig reference\n * @returns void\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createPageConfig } from 'lib-bb-page-config';\n *\n * const pageConfig = createPageConfig(rawPageConfig);\n * ```\n */\nexport function createPageConfig(rawPageConfig: RawPageConfig): NormalizedConfig {\n  const pageConfig = normalizePageConfig({ ...defaultRawPageConfig, ...rawPageConfig });\n  // TODO: remove auth once it is safe, we keep it with compatibility with 6.0.23\n  const authConfig = normalizeAuthConfig(pageConfig, rawPageConfig.cx || rawPageConfig.auth);\n  const moduleLoader = rawPageConfig.loadModule || defaultLoadModule();\n  const featureToggles = getFeatureToggles(pageConfig, rawPageConfig.cx);\n  return {\n    pageConfig,\n    authConfig,\n    moduleLoader,\n    featureToggles,\n  };\n}\n\n/**\n * Regular Expression to match spaces.\n */\nconst spacesRegEx = /\\s/g;\n/**\n * Function to normalize raw Page Config to the expected to be served by service.\n *\n * @param rawPageConfig RawPageConfig instance\n * @returns PageConfig instance\n */\nfunction normalizePageConfig(rawPageConfig: RawPageConfig): PageConfig {\n  const pageConfig: PageConfig = {\n    version: rawPageConfig.version,\n    apiRoot: rawPageConfig.apiRoot,\n    staticResourcesRoot: rawPageConfig.staticResourcesRoot,\n    portalName: rawPageConfig.portalName,\n    pageName: rawPageConfig.pageName,\n    designmode: rawPageConfig.designmode.trim() === 'true',\n    currentLinkUUID: rawPageConfig.currentLinkUUID,\n    currentLink: rawPageConfig.currentLink,\n    locale: rawPageConfig.locale,\n    locales: rawPageConfig.locales.replace(spacesRegEx, '').split(','),\n    linkRoot: rawPageConfig.linkRoot,\n    cspNonce: rawPageConfig.cspNonce,\n    webSdkVersion: '<placeholder>',\n    isAdmin: !!rawPageConfig.isAdmin && rawPageConfig.isAdmin.trim() === 'true',\n    isManager: !!rawPageConfig.isManager && rawPageConfig.isManager.trim() === 'true',\n    userId: rawPageConfig.userId,\n  };\n  return pageConfig;\n}\n","/**\n * Object Headers type.\n * It can have any member if the key and the value are of type string\n */\nexport interface Headers {\n  [key: string]: string;\n}\n/**\n * Object Query type.\n * It can have any member if the key and the value are of type string\n */\nexport interface Query {\n  [key: string]: string;\n}\n\nconst HEADER_VALUE_SPLIT_STR = ': ';\n\nconst getQueryString = (query: Query): string =>\n  Object.keys(query).map(\n    (key: string) => `${encodeURIComponent(key)}=${encodeURIComponent(query[key])}`,\n  ).join('&');\n\nconst getHeaders = (headersStr: string): Headers => headersStr\n  .split('\\r\\n')\n  .filter((rawHeader) => rawHeader !== '')\n  .map((rawHeader) => {\n    const headerSegments = rawHeader.split(HEADER_VALUE_SPLIT_STR);\n    const name = headerSegments[0];\n    const value = headerSegments.slice(1).join(HEADER_VALUE_SPLIT_STR);\n\n    return { [name]: value };\n  }).reduce(\n    (acc, header) => ({ ...acc, ...header }),\n    {},\n  );\n\nexport {\n  getQueryString,\n  getHeaders,\n};\n","import { getHeaders, Headers, Query } from './utils';\n\n/**\n * HttpMethod union type\n * Accepts as value only these values.\n */\nexport type HttpMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'HEAD' | 'CONNECT' | 'OPTIONS' | 'TRACE' | 'PATCH';\n\n/**\n * HttpRequestConfig interface\n */\nexport interface HttpRequestConfig {\n  /**\n   * Method used to communicate to the server\n   *\n   * @see HttpMethod\n   */\n  method: HttpMethod;\n  /**\n   * Url to send the request\n   */\n  url: string;\n  /**\n   * Query Data if it's a GET request\n   * @see Query\n   */\n  query?: Query;\n  /**\n   * Headers to be sent with our request\n   *\n   * @see Headers\n   */\n  headers?: Headers;\n  /**\n   * This is the expected response type\n   * @see XMLHttpRequestResponseType\n   */\n  responseType?: XMLHttpRequestResponseType;\n  /**\n   * Data to be sent to the server if method is different from GET\n   */\n  data?: Document | BodyInit;\n  /**\n   * Whether to include credentials in a cross origin request.\n   */\n  withCredentials?: boolean;\n}\n\n/**\n * Generic HttpResponse\n */\nexport interface HttpResponse<T = any> {\n  /**\n   * Response status number\n   */\n  status: number;\n  /**\n   * Response status text is the data fetched from server\n   */\n  statusText: string;\n  /**\n   * Headers sent by server\n   */\n  headers: Headers;\n  /**\n   * Body of the response.\n   */\n  body: T;\n}\n\nexport class HttpError extends Error {\n  get name() {\n    return 'HttpError';\n  }\n  set name(newName: string) {}\n  response: string;\n  statusText: string;\n  status: number;\n  headers: Headers;\n\n  constructor(httpErrParams: { message: string; status: number; statusText: string; body: string; headers: Headers }) {\n    super(httpErrParams.message);\n    this.response = httpErrParams.body;\n    this.statusText = httpErrParams.statusText;\n    this.status = httpErrParams.status;\n    this.headers = httpErrParams.headers;\n  }\n}\n\nconst parseResponse = (event: any): HttpResponse => {\n  const xhr = event.currentTarget || event.target;\n  const status = xhr.status;\n  const statusText = xhr.statusText;\n  const body = xhr.response;\n  const url = xhr.responseURL || '(unknown url)';\n  const headers = getHeaders(xhr.getAllResponseHeaders() || '');\n\n  if (status < 200 || status > 299) {\n    const message = `Http failure response for ${url}: ${status} ${statusText}`;\n\n    throw new HttpError({\n      message,\n      status,\n      statusText,\n      body,\n      headers,\n    });\n  }\n\n  return {\n    status,\n    statusText,\n    headers,\n    body,\n  };\n};\n\nconst createRequest = (window: any) => (url: string, options: HttpRequestConfig): Promise<HttpResponse> =>\n  new Promise((resolve, reject) => {\n    const xhr: XMLHttpRequest = new window.XMLHttpRequest();\n    const headers = options.headers || {};\n\n    xhr.open(options.method || 'GET', url);\n    xhr.responseType = options.responseType || '';\n    Object.keys(headers).forEach((name) => xhr.setRequestHeader(name, (<Headers> headers)[name]));\n    xhr.withCredentials = !!options.withCredentials;\n\n    xhr.addEventListener('load', resolve);\n    xhr.addEventListener('error', reject);\n    xhr.addEventListener('abort', reject);\n\n    xhr.send(options.data);\n  }).then(parseResponse);\n\nexport default createRequest;\n","/**\n * @module lib-bb-http\n * @description AJAX HTTP library\n */\nimport { HttpInterceptors, HttpHandler } from 'lib-bb-http-interceptors';\n\nimport { getQueryString } from './utils';\nimport createRequest, { HttpRequestConfig, HttpResponse } from './request-provider';\n\nexport { HttpRequestConfig, HttpMethod, HttpError, HttpResponse } from './request-provider';\nexport { Headers, Query } from './utils';\n\n/**\n * Log function type\n */\nexport type Log = (label: string, obj: any) => void;\n/**\n * Generic HttpRequest type.\n */\nexport type HttpRequest<T = any> = (config: HttpRequestConfig, log?: Log) => Promise<HttpResponse<T>>;\n\nconst requestHandler = (log?: Log): HttpHandler => (httpConfig: HttpRequestConfig) => {\n  const queryString = httpConfig.query ? getQueryString(httpConfig.query) : undefined;\n  const url = queryString ? `${httpConfig.url}?${queryString}` : (httpConfig.url || '');\n\n  const sendRequest = createRequest(window);\n\n  if (log) {\n    log('HTTP Request', { ...httpConfig, url });\n  }\n\n  return sendRequest(url, httpConfig);\n};\n\n/**\n * Creates HttpRequest instance\n *\n * @param httpInterceptors HttpInterceptors to be executed before sending request.\n * @returns HttpRequest instance\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { request } from 'lib-bb-http';\n *\n * request({\n *   method: 'get',\n *   url: 'http://my.backbase.com',\n *   query: { page: 2 }\n * }).then(response => console.log(response.body));\n * ```\n */\nexport function request(httpInterceptors: HttpInterceptors): HttpRequest {\n  function httpRequest<T = any>(config: HttpRequestConfig, log?: Log): Promise<HttpResponse<T>> {\n    return httpInterceptors.run(config, requestHandler(log));\n  }\n  return httpRequest;\n}\n","/**\n * @module lib-bb-http-interceptors\n * @description Backbase http interceptors\n */\nimport { HttpRequestConfig, HttpResponse } from 'lib-bb-http';\n\nexport type HttpHandler = (httpConfig: HttpRequestConfig) => Promise<HttpResponse>;\nexport type HttpInterceptor = (httpConfig: HttpRequestConfig, next: HttpHandler) => Promise<HttpResponse>;\n\n/**\n * HttpInterceptors interface\n */\nexport interface HttpInterceptors {\n  /** Function called to add a new interceptor */\n  add: (interceptor: HttpInterceptor) => void;\n  /** Function called to run the interceptors */\n  run: (httpConfig: HttpRequestConfig, lastHandler: HttpHandler) => Promise<HttpResponse>;\n}\n\n/**\n * Creates HttpInterceptors instance\n *\n * @returns HttpInterceptors instance\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { HTTP_INTERCEPTORS, HttpInterceptors } from 'lib-bb-http-interceptors';\n * import { injector } from 'lib-bb-injector';\n *\n * const useInterceptors = (httpInterceptors: HttpInterceptors) => {\n *   const finalHttpConfig = httpInterceptors.runInterceptors(myHttpConfig);\n * }\n * injector.invoke(useInterceptors, [HTTP_INTERCEPTORS]);\n * ```\n */\nexport function createHttpInterceptors(): HttpInterceptors {\n  const interceptors: HttpInterceptor[] = [];\n  const add = (interceptor: HttpInterceptor): void => {\n    interceptors.push(interceptor);\n  };\n\n  const getHandler = (allInterceptors: HttpInterceptor[], index: number): HttpHandler =>\n    (httpConfig: HttpRequestConfig) => allInterceptors[index](httpConfig, getHandler(allInterceptors, index + 1));\n\n  const run = (httpConfig: HttpRequestConfig, lastHandler: HttpHandler): Promise<HttpResponse> => {\n    if (interceptors.length === 0) {\n      return lastHandler(httpConfig);\n    }\n    const allInterceptors = [...interceptors, lastHandler];\n    return allInterceptors[0](httpConfig, getHandler(allInterceptors, 1));\n  };\n\n  return {\n    add,\n    run,\n  };\n}\n","/**\n * @module lib-bb-set-locale-cdn\n * @description Lean Client setLocale service\n */\nimport type { CXResponse } from 'lib-bb-portal-rest';\nimport type { Cookie } from 'lib-bb-auth';\n// @ts-ignore\nimport cookiejs from 'vendor-bb-cookie-js';\nconst cookie: Cookie = cookiejs;\n\nexport type SetLocale = (locale: string) => Promise<CXResponse>;\n\nconst COOKIE_NAME = 'bb-locale';\n\n/**\n * Creates SetLocale service\n *\n * @param pageConfig PageConfig instance provided by DI\n * @param PortalRest PortalRest instance provided by DI\n * @returns SetLocale\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createSetLocale } from 'lib-bb-set-locale';\n *\n * const setLocale = createSetLocale(pageConfig, portalRest);\n * setLocale('nl-NL').then(() => {\n *   // do something\n * })\n * ```\n */\nexport function createSetLocale(): SetLocale {\n  return async (locale: string) => {\n    cookie.set(COOKIE_NAME, locale);\n    return Promise.resolve({\n      status: 200,\n      statusText: 'OK',\n      headers: {},\n      body: '',\n    });\n  };\n}\n\nexport function getCookieLocale() {\n  return cookie.get(COOKIE_NAME);\n}\n","import { Property } from 'lib-bb-render-model-parser';\n\n/**\n * @module lib-bb-conditions\n * @description Library to resolve conditional properties\n */\n\nexport enum LogicalOperator {\n  AND = 'AND',\n  OR = 'OR',\n  NOT = 'NOT',\n}\n\nexport interface Condition {\n  kind: string;\n  logic: LogicalOperator;\n  [key: string]: any;\n}\n\nexport interface ConditionGroup {\n  logic: LogicalOperator;\n  conditions: Condition[];\n}\n\nexport type Resolver = (conditionConfig?: any) => Promise<boolean>;\n\nexport type AddConditionResolver = (\n  kind: string,\n  resolver: Resolver,\n) => void;\n\nexport interface ConditionalValue {\n  value: Property;\n  condition: Array<Condition | ConditionGroup>;\n}\n\nexport interface DynamicValueConfig {\n  defaultValue: Property;\n  conditionalValues: ConditionalValue[];\n}\n\nexport type ResolveConditions = (conditions: Array<Condition | ConditionGroup>) => Promise<boolean>;\nexport type ResolveValue = (dynamicValue: DynamicValueConfig) => Promise<Property>;\n\nexport interface Conditions {\n  resolveConditions: ResolveConditions;\n  resolveValue: ResolveValue;\n  addResolver: AddConditionResolver;\n}\n\ninterface Resolution {\n  value: boolean;\n  logic: LogicalOperator;\n}\n\nexport const createConditions = (): Conditions => {\n  const resolvers: { [kind: string]: Resolver } = {};\n\n  const addResolver = (kind: string, resolver: Resolver) => {\n    resolvers[kind] = resolver;\n  };\n\n  const resolveCondition = (condition: Condition): Promise<Resolution> => {\n    if (resolvers[condition.kind]) {\n      return resolvers[condition.kind](condition).then((value: boolean) => ({\n        value,\n        logic: condition.logic,\n      }));\n    }\n\n    return Promise.reject(`Conditions Error: There is no resolver for kind '${condition.kind}'`);\n  };\n\n  const resolveResolutions = (resolutions: Resolution[]) => {\n    return resolutions.reduce((final: boolean, resolution: Resolution) => {\n      if (resolution.logic === LogicalOperator.AND) {\n        return final && resolution.value;\n      } else if (resolution.logic === LogicalOperator.NOT) {\n        return final && !resolution.value;\n      }\n\n      return final || resolution.value;\n    }, true);\n  };\n\n  const resolveConditions = (conditions: Array<Condition | ConditionGroup>): Promise<boolean> => {\n    if (conditions.length === 0) {\n      return Promise.resolve(true);\n    }\n    const resolutionPromises = conditions.map((condition: Condition | ConditionGroup) => {\n      if (condition.hasOwnProperty('kind')) {\n        return resolveCondition(condition as Condition);\n      }\n\n      return resolveConditions(condition.conditions).then((value: boolean) => ({\n        value,\n        logic: condition.logic,\n      }));\n    });\n\n    return Promise.all(resolutionPromises).then(resolveResolutions);\n  };\n\n  const resolveConditionalValue = async (conditionalValues: ConditionalValue[]): Promise<Property | undefined> => {\n    if (!conditionalValues.length) {\n      return undefined;\n    }\n    const conditionMet = await resolveConditions(conditionalValues[0].condition);\n    if (!conditionMet) {\n      return resolveConditionalValue(conditionalValues.slice(1));\n    }\n\n    return conditionalValues[0].value;\n  };\n\n  const resolveValue = async (dynamicValue: DynamicValueConfig): Promise<Property> => {\n    const conditionalValue = await resolveConditionalValue(dynamicValue.conditionalValues);\n\n    return (conditionalValue === undefined)\n      ? dynamicValue.defaultValue\n      : conditionalValue;\n  };\n\n  return {\n    resolveConditions,\n    resolveValue,\n    addResolver,\n  };\n};\n","/**\n * @module lib-bb-entitlements\n * @description Library to resolve entitlements\n */\n\nimport { HttpRequest } from 'lib-bb-http';\nimport { FeatureToggles, EntitlementsConfig } from 'lib-bb-page-config';\n\nexport interface Entitlement {\n  resource: string;\n  function: string;\n  privilege: string;\n}\n\ninterface RawEntitlement {\n  resource: string;\n  function: string;\n  permissions: { [key: string]: boolean };\n}\n\nexport interface Entitlements {\n  resolve: (entitlement: Entitlement) => Promise<boolean>;\n}\n\n// this request will be executed on every page load when entitlements are enabled\n// even for anonymous user! Because there is no way to figure out if user is anonymous because of bas strategy\n// with bas, we would need to hit status endpoint on every page load, and then auth.timeToLeave() should be async!\n// with hybrid is fine because ttl is based on exp value in access token\nconst getRawData = (request: HttpRequest, apiRoot: string, config: EntitlementsConfig): Promise<RawEntitlement[]> => {\n  const defaultUri = '/accessgroup-presentation-service/client-api/v2/accessgroups/users/permissions/summary';\n  const url = apiRoot + (config.uri || defaultUri);\n  return request({ method: 'GET', url })\n    .then((data) => JSON.parse(data.body))\n    .then((raw) => raw.map(removeWhiteSpace))\n    .catch(() => []);\n};\n\nconst removeWhiteSpace = <T extends { resource: string, function: string }>(item: T): T => {\n  return {\n    ...item,\n    resource: item.resource.replace(/ /g, ''),\n    function: item.function.replace(/ /g, ''),\n  };\n};\n\nexport const createEntitlements = (\n  request: HttpRequest,\n  config: { apiRoot: string },\n  features: FeatureToggles,\n): Entitlements => {\n  const rawDataPromise = getRawData(request, config.apiRoot, features.entitlements);\n\n  const resolve = (entitlement: Entitlement) => {\n    return rawDataPromise.then(\n      (rawData) => {\n        const data = rawData.find((rawEntitlement: RawEntitlement) => {\n          return rawEntitlement.resource === entitlement.resource\n            && rawEntitlement.function === entitlement.function;\n        });\n\n        if (data && data.permissions[entitlement.privilege]) {\n          return data.permissions[entitlement.privilege];\n        }\n\n        return false;\n      });\n  };\n\n  return {\n    resolve,\n  };\n};\n","import { Item } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\nimport { LoadStrategy, GetRenderStrategy, GetRequiredStrategy } from './strategy-provider';\n\nexport type BootstrapItemCallback = (item: Item, itemLocation: ItemLocation) => Promise<boolean | void>;\n\nconst createBootstrapItem = (\n  loadStrategy: LoadStrategy,\n  getRenderStrategy: GetRenderStrategy,\n  getRequiredStrategy: GetRequiredStrategy): BootstrapItemCallback => {\n  const bootstrapItemCallback: BootstrapItemCallback = (item: Item, itemLocation: ItemLocation) => {\n    const loadAndBootstrap = (name: string) =>\n      loadStrategy(name)\n        .then((strategy) => strategy.bootstrap(item, itemLocation));\n\n    const primaryStrategyName: string = getRenderStrategy(item);\n    const requiredStrategyName: string = getRequiredStrategy(item);\n\n    if (requiredStrategyName === primaryStrategyName) {\n      return loadAndBootstrap(primaryStrategyName);\n    }\n\n    return loadAndBootstrap(requiredStrategyName)\n      .then(() => loadAndBootstrap(primaryStrategyName));\n  };\n\n  return bootstrapItemCallback;\n};\n\nexport default createBootstrapItem;\n","import { LoadStrategy, GetRenderStrategy, GetRequiredStrategy } from './strategy-provider';\nimport { Item } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\n\nexport type RemoveItemCallback = (item: Item, itemLocation: ItemLocation) => Promise<void>;\n\nconst createRemoveItem = (\n  loadStrategy: LoadStrategy,\n  getRenderStrategy: GetRenderStrategy,\n  getRequiredStrategy: GetRequiredStrategy): RemoveItemCallback =>\n  (item: Item, itemLocation: ItemLocation) => {\n    const loadAndRemove = (strategyName: string) =>\n      loadStrategy(strategyName)\n        .then((strategy) => (\n          typeof strategy.remove === 'function' ?\n            strategy.remove(item, itemLocation) :\n            undefined\n        ))\n        .then(() => undefined);\n\n    const primaryStrategyName = getRenderStrategy(item);\n    const requiredStrategyName = getRequiredStrategy(item);\n\n    if (primaryStrategyName === requiredStrategyName) {\n      return loadAndRemove(primaryStrategyName);\n    }\n\n    return loadAndRemove(primaryStrategyName)\n      .then(() => loadAndRemove(requiredStrategyName));\n  };\n\nexport default createRemoveItem;\n","import { BootstrapItem, RemoveItem } from './traverse-utils';\nimport { Item } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\n\nconst createRefresh = (bootstrap: BootstrapItem, remove: RemoveItem): BootstrapItem => {\n  const refresh = (item: Item, itemLocation: ItemLocation) =>\n    remove(item, itemLocation)\n      .then(() => bootstrap(item, itemLocation));\n\n  return refresh;\n};\nexport default createRefresh;\n","import { BootstrapItem } from './traverse-utils';\nimport { LoadStrategy, GetRenderStrategy, Strategy } from './strategy-provider';\nimport { Item } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\nimport { Properties } from 'lib-bb-render-model-parser';\n\n/**\n * UpdateItem function type\n *\n * This function updates an item properties and or ItemLocation\n * and returns a Promise<void> that gets resolved when the item\n * has been updated.\n */\nexport type UpdateItem = (item: Item, itemLocation: ItemLocation, properties: Partial<Properties>) => Promise<void>;\n\nconst createUpdate = (\n  refresh: BootstrapItem,\n  loadStrategy: LoadStrategy,\n  getRenderStrategy: GetRenderStrategy): UpdateItem => {\n  const getUpdateFunc = (strategy: Strategy) =>\n    strategy.update || refresh;\n\n  const update = (item: Item, itemLocation: ItemLocation, properties: Partial<Properties>) =>\n    loadStrategy(getRenderStrategy(item))\n      .then((strategy) => {\n        const updateFunc = getUpdateFunc(strategy);\n        return updateFunc(item, itemLocation, properties);\n      })\n      .then(() => undefined);\n\n  return update;\n};\nexport default createUpdate;\n","import { Item, Container } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\nimport { BootstrapItemCallback } from './bootstrap-item';\nimport { RemoveItemCallback } from './remove-item';\n\nexport interface TraverseUtils {\n  createTraverseFromRootToLeafs: (bootstrapCallback: BootstrapItemCallback) => BootstrapItem;\n  createTraverseFromLeafsToRoot: (removeCallback: RemoveItemCallback) => RemoveItem;\n}\n/**\n * RemoveItem function type.\n *\n * This function receives an item and the item location where it should be removed from and\n * returns a Promise<void> that resolves when item has been removed.\n */\nexport type RemoveItem = (item: Item, itemLocation: ItemLocation) => Promise<void>;\n/**\n * BootstrapItem function type.\n *\n * This function receives an item and the item location where it should be rendered and\n * returns a Promise<void> that resolves when item has been rendered.\n */\nexport type BootstrapItem = (item: Item, itemLocation: ItemLocation) => Promise<void>;\n\nconst createTraverseUtils = (): TraverseUtils => {\n  const forEachChild = (item: Item, traverse: RemoveItem | BootstrapItem) =>\n    Promise.all(((item as Container).children || []).map((child: Item, index: number) =>\n      traverse(child, { parentName: item.name, index }),\n    ));\n\n  const createTraverseFromLeafsToRoot = (removeCallback: RemoveItemCallback): RemoveItem => {\n    const traverseFromLeafsToRoot: RemoveItem = (item: Item, itemLocation: ItemLocation) =>\n      forEachChild(item, traverseFromLeafsToRoot)\n        .then(() => removeCallback(item, itemLocation));\n\n    return (item: Item, itemLocation: ItemLocation) =>\n      traverseFromLeafsToRoot(item, itemLocation)\n        .then(() => { });\n  };\n\n  const createTraverseFromRootToLeafs = (bootstrapCallback: BootstrapItemCallback): BootstrapItem => {\n    const traverseFromRootToLeafs: BootstrapItem = (item: Item, itemLocation: ItemLocation) =>\n      bootstrapCallback(item, itemLocation)\n        .then((stopTraversing: boolean | void) => {\n          if (!stopTraversing) {\n            return forEachChild(item, traverseFromRootToLeafs).then(() => { });\n          }\n        });\n\n    return (item: Item, itemLocation: ItemLocation) =>\n      traverseFromRootToLeafs(item, itemLocation)\n        .then(() => { });\n  };\n\n  return {\n    createTraverseFromRootToLeafs,\n    createTraverseFromLeafsToRoot,\n  };\n};\n\nexport default createTraverseUtils;\n","import { Item, Properties } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\n\nexport enum StrategyPropertyNames {\n  Required = 'render.requires',\n  Main = 'render.strategy',\n}\nexport enum CommonRenderingStrategies {\n  SSR = 'render-bb-ssr',\n  WC2 = 'render-bb-widget-2',\n  WC3 = 'render-bb-widget-3',\n}\n\n/**\n * RenderingStrategy interface\n *\n * Abstraction of the rendering strategy so it can be redefined because of developer needs.\n */\nexport interface RenderingStrategy {\n  /** Function executed to render an item */\n  bootstrap(item: Item, itemLocation: ItemLocation): Promise<boolean | void>;\n  /** Function executed to update properties of an item and perform the changes in view*/\n  update(item: Item, itemLocation: ItemLocation, changes: Partial<Properties>): Promise<void>;\n  /** Function executed to remove an item of the view */\n  remove(item: Item, itemLocation: ItemLocation): Promise<void>;\n}\nexport interface Strategy extends RenderingStrategy {\n  name: string;\n}\n\nexport interface RenderStrategyFactories {\n  [renderingStrategyName: string]: () => RenderingStrategy;\n}\n\nexport type LoadStrategy = (name: string) => Promise<Strategy>;\nexport type GetRequiredStrategy = (item: Item) => string;\nexport type GetRenderStrategy = (item: Item) => string;\nexport interface StrategyProvider {\n  loadStrategy: LoadStrategy;\n  getRequiredStrategy: GetRequiredStrategy;\n  getRenderStrategy: GetRenderStrategy;\n}\n\ndeclare const System: any;\n\nconst createStrategyProvider = (renderStrategyFactories: RenderStrategyFactories): StrategyProvider => {\n  const strategies = new Map<string, Promise<Strategy>>();\n\n  const loadStrategy = (name: string): Promise<Strategy> => {\n    const strategy = strategies.get(name);\n    if (!strategy) {\n      const renderingStrategy = renderStrategyFactories[name]();\n      const newStrategy = Promise.resolve({ ...renderingStrategy, name });\n      strategies.set(name, newStrategy);\n      return newStrategy;\n    }\n    return strategy;\n  };\n\n  const getRequiredStrategy = (item: Item): string => {\n    const { properties } = item;\n    const requiredStrategy = (properties && properties[StrategyPropertyNames.Required]) ||\n      CommonRenderingStrategies.SSR;\n\n    return requiredStrategy as string;\n  };\n\n  const getRenderStrategy = (item: Item): string => {\n    const { properties } = item;\n\n    // Always return the defined strategy if set\n    if (properties && properties[StrategyPropertyNames.Main]) {\n      return properties[StrategyPropertyNames.Main] as string;\n    }\n\n    // Widget collection 2\n    if (properties && properties.extension) {\n      return CommonRenderingStrategies.WC2;\n    }\n\n    // Manegable area should be SSR\n    if (properties && properties.isManageableArea) {\n      return CommonRenderingStrategies.SSR;\n    }\n\n    return getRequiredStrategy(item);\n  };\n\n  return {\n    loadStrategy,\n    getRequiredStrategy,\n    getRenderStrategy,\n  };\n};\n\nexport default createStrategyProvider;\n","import { Container, Item } from 'lib-bb-render-model-parser';\nimport { GetRenderStrategy, GetRequiredStrategy } from './strategy-provider';\n\n/**\n * CanRender function type.\n *\n * This function receives a possible container and an item and returns if item can be rendered or not\n */\nexport type CanRender = (container: Item, item: Item) => boolean;\n\nconst createCanRender = (getRenderStrategy: GetRenderStrategy, getRequiredStrategy: GetRequiredStrategy): CanRender => {\n  const canRender = (container: Item, item: Item): boolean => {\n    const itemRequiredStrategy = getRequiredStrategy(item);\n\n    return (\n      itemRequiredStrategy === getRenderStrategy(container) ||\n      itemRequiredStrategy === getRequiredStrategy(container)\n    );\n  };\n\n  return canRender;\n};\n\nexport default createCanRender;\n","/**\n * @module lib-bb-page-render\n * @description Backbase page strategy renderer\n */\n\nimport createBootstrapItem, { BootstrapItemCallback } from './bootstrap-item';\nimport createRemoveItem, { RemoveItemCallback } from './remove-item';\nimport createRefresh from './refresh';\nimport createUpdate, { UpdateItem } from './update';\nimport createTraverseUtils, { TraverseUtils, BootstrapItem, RemoveItem } from './traverse-utils';\nimport createStrategyProvider, { RenderStrategyFactories } from './strategy-provider';\nimport createCanRender, { CanRender } from './can-render';\n\nexport { RenderingStrategy, RenderStrategyFactories } from './strategy-provider';\n\n/** RenderApi interface\n * Object returned from a rendering strategy that contains methods for rendering items and containers\n*/\nexport interface RenderApi {\n  /** Function to run to bootstrap the widget / container */\n  bootstrap: BootstrapItem;\n  /** Function to run to update the widget / container */\n  update: UpdateItem;\n  /** Function to run to remove the widget / container */\n  remove: RemoveItem;\n}\n\n/**\n * PageRender interface\n */\nexport interface PageRender extends RenderApi {\n  /** Function that checks if a container rendering strategy can render an item being dropped on it */\n  canRender: CanRender;\n  /** Function called to refresh a widget or container (remove and bootstrap) */\n  refresh: BootstrapItem;\n}\n\nexport { BootstrapItem, RemoveItem } from './traverse-utils';\nexport { CanRender } from './can-render';\nexport { UpdateItem } from './update';\n\n/**\n * Generates a PageRender instance\n *\n * @returns PageRender\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createPageRender } from 'lib-bb-page-render';\n *\n * const { bootstrap } = createPageRender();\n * bootstrap(item, itemLocation)\n *   .then(() => console.log('Done'));\n * ```\n */\nexport function createPageRender(renderStrategyFactories: RenderStrategyFactories): PageRender {\n  const {\n    loadStrategy,\n    getRenderStrategy,\n    getRequiredStrategy,\n  } = createStrategyProvider(renderStrategyFactories);\n\n  const canRender: CanRender = createCanRender(getRenderStrategy, getRequiredStrategy);\n\n  const traverseUtils: TraverseUtils = createTraverseUtils();\n\n  const bootstrapItemCallback: BootstrapItemCallback =\n    createBootstrapItem(loadStrategy, getRenderStrategy, getRequiredStrategy);\n  const bootstrap: BootstrapItem = traverseUtils.createTraverseFromRootToLeafs(bootstrapItemCallback);\n\n  const removeItemCallback: RemoveItemCallback = createRemoveItem(loadStrategy, getRenderStrategy, getRequiredStrategy);\n  const remove: RemoveItem = traverseUtils.createTraverseFromLeafsToRoot(removeItemCallback);\n\n  const refresh: BootstrapItem = createRefresh(bootstrap, remove);\n  const update: UpdateItem = createUpdate(refresh, loadStrategy, getRenderStrategy);\n\n  type RenderingFunction = (...args: any[]) => Promise<void>;\n\n  // run render function only when previous one is finished\n  const queue = (() => {\n    let previousRendering = Promise.resolve();\n    return (renderingFunction: RenderingFunction) => {\n      return (...params: any[]): Promise<any> => {\n        previousRendering = previousRendering.then(() => renderingFunction(...params));\n        return previousRendering;\n      };\n    };\n  })();\n\n  return {\n    canRender,\n    refresh: queue(refresh),\n    bootstrap: queue(bootstrap),\n    update: queue(update),\n    remove: queue(remove),\n  };\n}\n","import { LogicalOperator, Condition, ConditionGroup } from 'lib-bb-conditions';\nimport { Entitlement } from 'lib-bb-entitlements';\n\nexport interface EntitlementCondition extends Condition {\n  kind: 'entitlement';\n  logic: LogicalOperator;\n}\n\nexport const removeWhiteSpace = <T extends { resource: string, function: string }>(item: T): T => {\n  return {\n    ...item,\n    resource: item.resource.replace(/ /g, ''),\n    function: item.function.replace(/ /g, ''),\n  };\n};\n\nconst tripletToEntitlement = (triplet: string): Entitlement => {\n  const tripletArray = triplet.split('.').map((str: string) => str.trim());\n  if (tripletArray.length !== 3) {\n    throw Error(`'${triplet}' is not valid entitlement string`);\n  }\n\n  return removeWhiteSpace({\n    resource: tripletArray[0],\n    function: tripletArray[1],\n    privilege: tripletArray[2],\n  });\n};\n\nconst separateLogicalOperators = (splitBySpaces: string[]): Array<EntitlementCondition | ConditionGroup> => {\n  const conditions: Array<EntitlementCondition | ConditionGroup> = [];\n\n  for (let i = 0; i < splitBySpaces.length; i += 2) {\n    const logic = splitBySpaces[i];\n    if (logic !== LogicalOperator.AND && logic !== LogicalOperator.OR) {\n      throw Error(`'${logic}' is not valid logical operator`);\n    }\n\n    const triplet = splitBySpaces[i + 1];\n    if (triplet.charAt(0) === '!') {\n      conditions.push({\n        logic,\n        conditions: [{\n          ...tripletToEntitlement(triplet.substr(1)),\n          logic: LogicalOperator.NOT,\n          kind: 'entitlement',\n        }],\n      });\n    } else {\n      conditions.push({\n        ...tripletToEntitlement(triplet),\n        logic,\n        kind: 'entitlement',\n      });\n    }\n  }\n\n  return conditions;\n};\n\n// grouping of entitlement triplet strings is not supported\n// but it could be added later if needed\nexport const convertEntitlementFromString = (stringDef: string): Array<EntitlementCondition | ConditionGroup> => {\n  const splitBySpaces = stringDef\n    .trim()\n    .split(' ')\n    .filter((spaced: string) => spaced !== '');\n\n  return separateLogicalOperators(['AND'].concat(splitBySpaces));\n};\n","/**\n * @module lib-bb-property-resolver\n * @description Library to resolve conditional properties\n */\nimport { Properties, Property } from 'lib-bb-render-model-parser';\nimport { Conditions } from 'lib-bb-conditions';\nimport { FeatureToggles } from 'lib-bb-page-config';\nimport { convertEntitlementFromString } from './triplet-conversion';\n\nexport interface ResolvableItem {\n  properties: Properties;\n  children?: ResolvableItem[];\n}\n\nexport type ResolveItem = <T extends ResolvableItem = ResolvableItem>(item: T) => Promise<T | undefined>;\nexport type ResolveEntitlements = (entitlementDefinition: string) => Promise<boolean>;\n\nconst CONDITION_PROPERTY_PREFIX = 'config.';\nconst FILTER_PROPERTY_NAME = 'canView';\n\nconst isConditionalProperty = (name: string, value: Property) => {\n  return name.startsWith(CONDITION_PROPERTY_PREFIX) && typeof value === 'string';\n};\n\ninterface ResolvedProperty {\n  propertyName: string;\n  resolution: Property;\n}\n\nexport interface PropertyResolver {\n  resolveItem: ResolveItem;\n  resolveEntitlements: ResolveEntitlements;\n}\n\nexport const createPropertyResolver = (conditions: Conditions, features: FeatureToggles): PropertyResolver => {\n  const resolveEntitlements = (entitlementDefinition: string) => {\n    const entitlementCondition = convertEntitlementFromString(entitlementDefinition);\n    return conditions.resolveConditions(entitlementCondition);\n  };\n\n  const resolveConditionalProperty = (propertyValue: string) => {\n    try {\n      const configValue = JSON.parse(propertyValue);\n      return conditions.resolveValue(configValue);\n    } catch (e) {\n      if (features.entitlements.enabled) {\n        try {\n          return resolveEntitlements(propertyValue);\n        } catch (e) {\n          return Promise.resolve(false);\n        }\n      }\n\n      return Promise.resolve(propertyValue);\n    }\n  };\n\n  const renameResolvedProperties = (properties: Properties) => (resolvedProps: ResolvedProperty[]) => {\n    return resolvedProps.reduce((newProps: Properties, resolvedProperty: ResolvedProperty) => {\n      const name = resolvedProperty.propertyName;\n      if (properties[name] === resolvedProperty.resolution) {\n        return newProps;\n      }\n      delete newProps[name];\n      const newName = name.substr(CONDITION_PROPERTY_PREFIX.length);\n      if (newProps.hasOwnProperty(newName)) {\n        throw Error(`Cannot rename property '${name}' to '${newName}' as property with that name already exists`);\n      }\n      return {\n        ...newProps,\n        [newName]: resolvedProperty.resolution,\n      };\n    },\n    { ...properties });\n  };\n\n  const resolveProperties = (properties: Properties): Promise<Properties> => {\n    const asyncValues = Object.keys(properties).reduce(\n      (acc: Array<Promise<ResolvedProperty>>, propertyName: string) => {\n        const propertyValue = properties[propertyName];\n        if (isConditionalProperty(propertyName, propertyValue)) {\n          const resolvedProperty = resolveConditionalProperty(propertyValue as string)\n            .then((resolution: Property) => {\n              return {\n                propertyName,\n                resolution,\n              };\n            });\n          acc.push(resolvedProperty);\n        }\n        return acc;\n      },\n      [],\n    );\n    return Promise.all(asyncValues).then(renameResolvedProperties(properties));\n  };\n\n  const resolveChildren = <T extends ResolvableItem = ResolvableItem>(item: T): Promise<T> => {\n    const children = item.children;\n    if (children && children.length) {\n      return Promise.all(children.map(resolveItem))\n        .then((resolvedChildren) => resolvedChildren.filter(\n          (resolvedChild): resolvedChild is ResolvableItem => !!resolvedChild,\n        ))\n        .then((newChildren) => ({\n          ...item,\n          children: newChildren,\n        }));\n    }\n\n    return Promise.resolve(item);\n  };\n\n  const resolveItem = <T extends ResolvableItem = ResolvableItem>(item: T): Promise<T | undefined> => {\n    return resolveProperties(item.properties)\n      .then((properties: Properties) => {\n        if (properties.hasOwnProperty(FILTER_PROPERTY_NAME)) {\n          if (properties[FILTER_PROPERTY_NAME] === false) {\n            return Promise.resolve(undefined);\n          }\n          delete properties[FILTER_PROPERTY_NAME];\n        }\n\n        return resolveChildren<T>({ ...item, properties });\n      });\n  };\n\n  return {\n    resolveItem,\n    resolveEntitlements,\n  };\n};\n","/**\n * @module lib-bb-pubsub\n * @description Pubsub Backbase event system\n */\n\n/**\n * PubsubListener interface\n *\n * This is a generic function type and it requires to configured\n * the listener setting what type of value it will receive.\n */\nexport type PubsubListener<T> = (eventPayload: T) => void;\n/**\n * EventName alias type\n *\n * Used to be sure that event name is a string\n */\nexport type EventName = string;\n\n/**\n * Unsubscribe function type\n *\n * Used to get unsubscribed to any event.\n */\nexport type Unsubscribe = () => void;\n\n/**\n * Pubsub interface\n */\nexport interface Pubsub {\n  /**\n   * Function used to publish/trigger any event\n   * @param eventName Event name to publish\n   * @param payload Data to pass to all the event listeners\n   * @returns void\n   */\n  publish<T>(eventName: EventName, payload: T): void;\n  /**\n   * Function used to start listening to events.\n   * @param eventName Event name to get subscribed to\n   * @param listener Function to execute every time this event is triggered/published.\n   * @returns Unsubscribe function\n   */\n  subscribe<T>(eventName: EventName, listener: PubsubListener<T>): Unsubscribe;\n  /**\n   * Function to get unsubscribed only from a specific event name and listener\n   * @param eventName Event name to get unsubscribed to\n   * @param listener Function to remove.\n   */\n  unsubscribe(eventName: EventName, listener: PubsubListener<any>): void;\n  /**\n   * Function to unsubscribe for every single eventName and listener\n   */\n  unsubscribeAll(): void;\n}\n\n/**\n * Creates Event Bus instance\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createPubsub } from 'lib-bb-pubsub';\n *\n * const pubsub = createPubsub();\n *\n * const helloListener = (data) => console.log(`Hello, ${data.name}!`)\n *\n * pubsub.subscribe('hello', helloListener);\n * pubsub.publish('hello', { name: 'world'});\n * pubsub.unsubscribe('hello', helloListener);\n * pubsub.unsubscribeAll();\n * ```\n */\nexport function createPubsub(logger: Console = console): Pubsub {\n  const listenersMap = new Map<EventName, Array<PubsubListener<any>>>();\n\n  const getListeners = (eventName: EventName): Array<PubsubListener<any>> =>\n    listenersMap.get(eventName) || [];\n\n  function publish<T>(eventName: EventName, payload: T): void {\n    const listeners = getListeners(eventName);\n    listeners.forEach((listener) => {\n      try {\n        listener(payload);\n      } catch (error) {\n        logger.error(error);\n      }\n    });\n  }\n\n  function subscribe<T>(eventName: EventName, listener: PubsubListener<T>): Unsubscribe {\n    const listeners = getListeners(eventName);\n    const newListeners = [...listeners, listener];\n    listenersMap.set(eventName, newListeners);\n    return () => {\n      unsubscribe<T>(eventName, listener);\n    };\n  }\n\n  function unsubscribe<T>(eventName: EventName, listener: PubsubListener<T>): void {\n    const listeners = getListeners(eventName);\n    const newListeners = listeners.filter((currentListener) => currentListener !== listener);\n    listenersMap.set(eventName, newListeners);\n  }\n\n  function unsubscribeAll(): void {\n    listenersMap.clear();\n  }\n\n  return {\n    publish,\n    subscribe,\n    unsubscribe,\n    unsubscribeAll,\n  };\n}\n","import { HttpRequest, HttpResponse } from 'lib-bb-http';\nimport { LinkTreeItem, Breadcrumb } from 'lib-bb-navigation';\n\ntype LinkTree = Omit<LinkTreeItem, 'isCurrent' | 'isInPath'>;\nexport interface LinkStore { [path: string]: LinkTree; }\n\nfunction getBreadcrumbs() {\n  return Promise.resolve([] as Breadcrumb[]);\n}\n\nfunction createGetTree(httpRequest: HttpRequest, root: string, locale?: string) {\n  function filterTree(store: LinkStore, id: string): LinkTreeItem {\n    const val: any = store[id];\n    val.isCurrent = false;\n    val.isInPath = false;\n    if (val.children.length) {\n      return {\n        ...val,\n        children: val.children.map((childId: string) => filterTree(store, childId)),\n      };\n    }\n    return val as LinkTreeItem;\n  }\n\n  return async (uuid: string) => {\n    const uuidWithoutRoot = uuid.slice(uuid.indexOf('/') + 1);\n    const suffix = locale ? `-${locale}` : '';\n    let result: HttpResponse<any>;\n\n    try {\n      result = await httpRequest({\n        method: 'GET',\n        url: `${root}/navigation${suffix}.json`,\n      });\n    } catch (err) {\n      result = await httpRequest({ // retry without suffix if navigation not found\n        method: 'GET',\n        url: `${root}/navigation.json`,\n      });\n    }\n    return filterTree(JSON.parse(result.body), uuidWithoutRoot);\n  };\n}\n\nexport function createStaticNavigation(httpRequest: HttpRequest, root: string, locale?: string) {\n  return {\n    getTree: createGetTree(httpRequest, root, locale),\n    getBreadcrumbs,\n  };\n}\n","import { ResolveItem } from 'lib-bb-property-resolver';\nimport { GetTree, LinkTreeItem } from 'lib-bb-navigation';\n\nexport const getCorrectUrl = (rawUrl: string, designMode: boolean): string => {\n  let url: string = rawUrl;\n  if (designMode) {\n    url += '?designmode=true';\n  }\n  return url;\n};\n\nexport const applyConditions = (getTree: GetTree, resolveItem: ResolveItem) => {\n  return (uuid: string, depth: number) => getTree(uuid, depth)\n    .then((item: LinkTreeItem) => resolveItem(item))\n    .then((resolvedItem: LinkTreeItem | undefined) => {\n      if (resolvedItem === undefined) {\n        throw new Error(`Root link item cannot be rendered`);\n      }\n\n      return resolvedItem;\n    });\n};\n","/**\n * MIME types of content document items\n */\nexport enum ContentMimeType {\n  PDF = 'application/pdf',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n}\n","/**\n * Common properties for content items\n */\nexport enum ContentProperty {\n  ALT_TEXT = 'bb:altText',\n  CREATED_BY = 'cmis:createdBy',\n  CREATION_DATE = 'cmis:creationDate',\n  HEIGHT = 'bb:height',\n  LAST_MODIFICATION_DATE = 'cmis:lastModificationDate',\n  LAST_MODIFIED_BY = 'cmis:lastModifiedBy',\n  LOCALE = 'bb:locale',\n  NAME = 'cmis:name',\n  TYPE_DEFINITION_NAME = 'bb:typeDefinitionName',\n  WIDTH = 'bb:width',\n}\n\n/**\n * Legacy date object used for CX 6.1 date properties\n * In CX 6.2 these dates are available on the content document itself\n */\nexport interface LegacyDateObject {\n  dayOfMonth: number;\n  /** Month is zero based */\n  month: number;\n  year: number;\n  hourOfDay: number;\n  minute: number;\n}\n\n/**\n * Common content item properties\n */\nexport interface ContentProperties {\n  [ContentProperty.LOCALE]?: string;\n  [ContentProperty.NAME]: string;\n  [ContentProperty.CREATION_DATE]?: string | LegacyDateObject;\n  [ContentProperty.LAST_MODIFICATION_DATE]?: string | LegacyDateObject;\n  [name: string]: any;\n}\n\n/**\n * Image content items properties\n */\nexport interface ImageContentProperties extends ContentProperties {\n  [ContentProperty.ALT_TEXT]: string;\n  [ContentProperty.HEIGHT]: number;\n  [ContentProperty.WIDTH]: number;\n}\n\n/**\n * Structred content items properties\n */\nexport interface StructuredContentProperties extends ContentProperties {\n  [ContentProperty.TYPE_DEFINITION_NAME]: string;\n}\n","/**\n * Common types of content items\n */\nexport enum ContentType {\n  DOCUMENT = 'cmis:document',\n  FOLDER = 'cmis:folder',\n  IMAGE = 'bb:image',\n  STRUCTURED_CONTENT = 'bb:structuredcontent',\n  THUMBNAIL = 'cmis:thumbnail',\n}\n\n/**\n * Common types of structured content items\n */\nexport enum StructuredContentType {\n  PLAIN_TEXT = 'SC_Unit_PlainText',\n  RICH_TEXT = 'SC_Unit_RichText',\n}\n","import { ContentType } from 'lib-bb-content-services';\n\n/**\n * ContentTypes of RawContentItem\n */\nexport enum ContentTypes {\n  DOCUMENT = ContentType.DOCUMENT,\n  IMAGE = ContentType.IMAGE,\n  STRUCTURED_CONTENT = ContentType.STRUCTURED_CONTENT,\n}\n\n/**\n * Simplified ContentItem of a Content Services' content item\n */\nexport interface ContentItem<T = any> {\n  /** Type of content item */\n  type: ContentTypes;\n  /** Type definition for structured content item */\n  typeDefinitionName?: string;\n  /** Content of content item */\n  content: T;\n  /** Map of content item properties */\n  properties: { [key: string]: string | number };\n}\n\n/**\n * Simplified represenation of a document content item\n */\nexport interface DocumentItem {\n  /** Url of the content steam id including apiRoot */\n  url: string;\n  /** Mime type of the content item */\n  mimeType: string;\n  /** Size of the content item, not available in CX5 */\n  bytes?: number;\n}\n\n/**\n * Simplified represenation of a image content item\n */\nexport interface ImageItem extends DocumentItem {\n  /** Title of the content item */\n  title: string;\n  /** Width of the image */\n  width: number;\n  /** Height of the image */\n  height: number;\n  /** Alt text of the image */\n  altText?: string;\n  /** Renditions when loadRenditions is enabled */\n  renditions?: ImageItem[];\n}\n\n/**\n * Maps ContentItem type to its content field type, or uses generic\n */\nexport type FlattenContentItem<T> = T extends ContentItem<any> ? T['content'] : T;\n","/**\n * @module lib-bb-navigation-cdn\n * @description Navigation service that provides methods to get breadcrumbs or tree of links\n */\n\nimport type { HttpRequest } from 'lib-bb-http';\nimport type { PropertyResolver } from 'lib-bb-property-resolver';\nimport type { Navigation } from 'lib-bb-navigation';\n\nimport { createStaticNavigation } from './navigation';\nimport { applyConditions } from './utils';\n\nexport type {\n  Breadcrumb,\n  GetBreadcrumbs,\n  GetTree,\n  LinkTreeItem,\n  Navigation,\n} from 'lib-bb-navigation';\n\n/**\n * Creates the right navigation regarding the CXP version running in portal\n *\n * @param pageConfig PageConfig reference\n * @param httpRequest HTTPRequest reference\n * @param pageRestApi PageRestApi reference\n * @returns Navigation for CX5 or CX6\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createNavigation } from 'lib-bb-navigation';\n *\n * const navigation = createNavigation('statics/', request, resolveProps);\n *\n * navigation\n *   .getBreadcrumbs()\n *   .then((breadcrumbs) => console.log(breadcrumbs));\n *\n * navigation\n *   .getTree(uuid, 4)\n *   .then((tree) => console.log(tree));\n * ```\n */\nexport function createNavigation(\n  staticResourcesRoot: string,\n  httpRequest: HttpRequest,\n  resolveItem?: PropertyResolver['resolveItem'],\n  locale?: string,\n): Navigation {\n  const navigation = createStaticNavigation(httpRequest, staticResourcesRoot, locale);\n\n  const getTree = resolveItem\n    ? applyConditions(navigation.getTree, resolveItem)\n    : navigation.getTree;\n\n  return {\n    ...navigation,\n    getTree,\n  };\n}\n","/**\n * @module lib-bb-portal-content-cdn\n * @description Provide capability to query for portal content by contentRef.\n */\n\nimport { ContentTypes } from 'lib-bb-portal-content-handler';\nimport { HttpRequest, HttpResponse } from 'lib-bb-http';\nimport type { IPortalContent, ContentOptions } from './portal-content';\nimport type { StructuredContentItem, FlattenContentItem, ContentItem } from 'lib-bb-portal-content-handler';\n\nexport type { IPortalContent as PortalContent, ContentOptions } from './portal-content';\nexport { ContentTypes, ContentTypeLegacy } from 'lib-bb-portal-content-handler';\nexport type {\n  ContentItem,\n  DocumentItem,\n  FlattenContentItem,\n  ImageItem,\n  ImageContentItem,\n  StructuredContentItem,\n} from 'lib-bb-portal-content-handler';\n\n/**\n * Provide capability to query for portal content by contentRef.\n *\n * @usageNotes\n * ### Example:\n *\n * ```typescript\n * import { createPortalContentHandler } from 'lib-bb-portal-content-handler';\n * import { httpRequest } from 'lib-bb-http';\n *\n * const portalContentHandler = createPortalContentHandler(httpRequest);\n * const contentRef = 'cs:@portalRepository:aece9378-b545-4ee0-b4d4-5bf13519a6b3';\n * portalContentHandler.get(contentRef)\n *   .then(content => {\n *     console.log(content);\n *   });\n * ```\n */\nexport function createPortalContentHandler(request: HttpRequest): IPortalContent {\n  const portalContent: IPortalContent = {\n    get: (contentRef: string) => {\n      return Promise.resolve(JSON.parse(contentRef) as StructuredContentItem);\n    },\n    getContent: (\n      contentRef: string,\n      options?: ContentOptions,\n    ) => {\n      const content = JSON.parse(contentRef);\n      return request({\n        method: 'GET',\n        url: content.url,\n      }).then((res: HttpResponse) => JSON.parse(res.body) as FlattenContentItem<{}>);\n      // const item = {\n      //   type: content.mimeType.indexOf('image') === 0 ? ContentTypes.IMAGE : ContentTypes.DOCUMENT,\n      //   content,\n      // };\n      // return Promise.resolve(item as FlattenContentItem<{}>);\n    },\n    getContentItem: <T extends ContentItem<any>>(\n      contentRef: string,\n      options?: ContentOptions,\n    ) => {\n      const content = JSON.parse(contentRef);\n      const item = {\n        type: content.mimeType.indexOf('image') === 0 ? ContentTypes.IMAGE : ContentTypes.DOCUMENT,\n        content,\n      };\n      return Promise.resolve(item as T);\n    },\n    subscribeContentUpdate: <T>(\n      itemName: string,\n      propertyName: string,\n      update: (content?: FlattenContentItem<T>) => void,\n    ) => () => {},\n    subscribeContentItemUpdate: <T extends ContentItem<any>>(\n      itemName: string,\n      propertyName: string,\n      update: (contentItem?: T) => void,\n    ) => () => {},\n  };\n  return portalContent;\n}\n","/**\n * @module render-bb-widget-3\n * @description Backbase Widget 3 render strategy\n */\nimport { Pubsub } from 'lib-bb-pubsub';\nimport { Navigation } from 'lib-bb-navigation';\nimport { PortalContent } from 'lib-bb-portal-content-handler';\nimport { PageConfig, ModuleLoader } from 'lib-bb-page-config';\nimport { RenderingStrategy } from 'lib-bb-page-render';\nimport { Item, Properties } from 'lib-bb-render-model-parser';\nimport { ItemLocation } from 'lib-bb-item-locator';\nimport { BackbaseAuth } from 'lib-bb-auth';\nimport { HttpInterceptors } from 'lib-bb-http-interceptors';\nimport { ItemRefresher, Refresh } from 'lib-bb-item-refresher';\nimport { SetLocale } from 'lib-bb-set-locale';\nimport { PropertyResolver } from 'lib-bb-property-resolver';\n\ndeclare const window: { BB: { startSingleApp: (services: WebSdkServices) => Promise<RenderingStrategy> } };\n\n/**\n * WebSdkServices\n */\nexport interface WebSdkServices {\n  /** Function called to get access to Authentication service*/\n  auth: () => BackbaseAuth;\n  /** Function called to get access to Http Interceptors service*/\n  httpInterceptors: () => HttpInterceptors;\n  /** Function called to get access to PageConfig service*/\n  pageConfig: () => PageConfig;\n  /** Function called to get access to Pubsub service */\n  eventBus: () => Pubsub;\n  /** Function called to get access to Navigation service */\n  navigation: () => Navigation;\n  /** Function called to get access to PortalContent service */\n  portalContent: () => PortalContent;\n  /** Function called to get access to forms service */\n  forms: () => any;\n  /** Function called to refresh item, optionally it can also reload model, and re-render it*/\n  refresh: () => Refresh;\n  /** Function to set active locale cookie */\n  setLocale: () => SetLocale;\n  /** Function to resolve conditionals */\n  conditions: () => Pick<PropertyResolver, 'resolveEntitlements'>;\n}\n\n/**\n * Creates Widget3 Rendering Strategy\n *\n * @param pageConfig PageConfig reference\n * @param pubsub Pubsub reference\n * @param navigation Navigation reference\n * @param portalContent PortalContent reference\n * @returns RenderingStrategy\n */\nexport function create(\n  pageConfig: PageConfig,\n  loadModule: ModuleLoader,\n  pubsub: Pubsub,\n  navigation: Navigation,\n  portalContent: PortalContent,\n  auth: BackbaseAuth,\n  httpInterceptors: HttpInterceptors,\n  itemRefresher: ItemRefresher,\n  setLocale: SetLocale,\n  propertyResolver: PropertyResolver): RenderingStrategy {\n  let ngApp: Promise<RenderingStrategy>;\n\n  const getApi = (): Promise<RenderingStrategy> => {\n    if (ngApp) {\n      return ngApp;\n    }\n    if (window.BB && window.BB.startSingleApp) {\n      ngApp = window.BB.startSingleApp({\n        auth: () => auth,\n        httpInterceptors: () => httpInterceptors,\n        pageConfig: () => pageConfig,\n        eventBus: () => pubsub,\n        navigation: () => navigation,\n        portalContent: () => portalContent,\n        forms: () => (formsConfig: any) =>\n          Promise.all([loadModule('lib-bb-forms'), getApi()]).then(([module, ngApi]) =>\n            module.create(ngApi, formsConfig),\n          ),\n        refresh: () => itemRefresher.refresh.bind(itemRefresher),\n        setLocale: () => setLocale,\n        conditions: () => ({\n          resolveEntitlements: propertyResolver.resolveEntitlements,\n        }),\n      });\n\n      return ngApp;\n    }\n\n    return Promise.reject(new Error('BB.startSingleApp does not exist!'));\n  };\n\n  return {\n    bootstrap: (item: Item, itemLocation: ItemLocation) =>\n      getApi()\n        .then((ngApi: RenderingStrategy) => ngApi.bootstrap(item, itemLocation))\n        .then(() => true),\n\n    update: (item: Item, itemLocation: ItemLocation, properties: Properties) =>\n      getApi().then((ngApi: RenderingStrategy) => ngApi.update(item, itemLocation, properties)),\n\n    remove: (item: Item, itemLocation: ItemLocation) =>\n      getApi().then((ngApi: RenderingStrategy) => ngApi.remove(item, itemLocation)),\n  };\n}\n","import { createAuth } from 'lib-bb-auth';\nimport { createAuthStrategy as createHybridClient } from 'lib-bb-auth-hybrid';\nimport { createPageConfig } from 'lib-bb-page-config';\nimport { request as createHttpRequest } from 'lib-bb-http';\nimport { createHttpInterceptors } from 'lib-bb-http-interceptors';\nimport { createSetLocale } from 'lib-bb-set-locale-cdn';\nimport { createConditions } from 'lib-bb-conditions';\nimport { createEntitlements } from 'lib-bb-entitlements';\nimport { createPageRender } from 'lib-bb-page-render';\nimport { createPropertyResolver } from 'lib-bb-property-resolver';\nimport { createPubsub } from 'lib-bb-pubsub';\nimport { createNavigation } from 'lib-bb-navigation-cdn';\nimport { createPortalContentHandler } from 'lib-bb-portal-content-cdn';\nimport { create as createWidget3Renderer } from 'render-bb-widget-3';\n\nimport type {\n  RawPageConfig,\n  AuthConfigs,\n  HybridConfig,\n  NormalizedConfig,\n  PageConfig,\n  FeatureToggles } from 'lib-bb-page-config';\nimport type { HttpRequest } from 'lib-bb-http';\nimport type { HttpInterceptors } from 'lib-bb-http-interceptors';\nimport type { SetLocale } from 'lib-bb-set-locale-cdn';\nimport type { BackbaseAuth, CreateStrategy, EnvironmentConfig } from 'lib-bb-auth';\nimport type { Conditions } from 'lib-bb-conditions';\nimport type { Entitlements } from 'lib-bb-entitlements';\nimport type { PageRender, RenderingStrategy } from 'lib-bb-page-render';\nimport type { PropertyResolver } from 'lib-bb-property-resolver';\nimport type { Container, Item } from 'lib-bb-render-model-parser';\nimport type { Pubsub } from 'lib-bb-pubsub';\nimport type { Navigation } from 'lib-bb-navigation-cdn';\nimport type { PortalContent } from 'lib-bb-portal-content-cdn';\nimport type { ItemRefresher, Refresh } from 'lib-bb-item-refresher';\n\nexport type PageItemCheck = (pageItem: Container, propertyResolver: PropertyResolver) => Promise<boolean>;\n\nexport const checkPageItem: PageItemCheck = async (pageItem: Container, propertyResolver: PropertyResolver) => {\n  const withoutChildren = {\n    name: pageItem.name,\n    properties: pageItem.properties,\n  };\n  const item = await propertyResolver.resolveItem<Item>(withoutChildren);\n  if (!item) {\n    const message = `Page '${pageItem.name}' cannot be resolved and rendered.`;\n    document.body.innerHTML = `<h3>${message}</h3>`;\n    return false;\n  }\n  return true;\n};\n\nasync function render(pageModel: Container, propertyResolver: PropertyResolver, pageRender: PageRender) {\n  const checkResult = await checkPageItem(pageModel, propertyResolver);\n  if (!checkResult) {\n    return [];\n  }\n  const resolvedModel = await propertyResolver.resolveItem<Container>(pageModel);\n  const pageChildren = resolvedModel ? resolvedModel.children : [];\n\n  const childRenders = pageChildren.map((item: Item, index: number) => {\n    const itemLocation = { parentName: pageModel.name, index };\n    return pageRender.bootstrap(item, itemLocation);\n  });\n  return Promise.all(childRenders);\n}\n\nexport interface CdnPageConfig {\n  apiRoot: string;\n  staticResourcesRoot: string;\n  locale: string;\n  auth: HybridConfig;\n  locales?: string;\n  features?: any;\n}\n\nfunction cdnToRawPageConfig(config: CdnPageConfig): RawPageConfig {\n  const locales = config.locales || config.locale;\n  return {\n    ...config,\n    version: '6',\n    portalName: '',\n    pageName: '',\n    designmode: 'false',\n    currentLinkUUID: '',\n    currentLink: '',\n    linkRoot: '',\n    cspNonce: '',\n    userId: '',\n    locales,\n    loadModule: () => Promise.resolve(),\n  };\n}\n\nexport function initialise(cdnPageConfig: CdnPageConfig) {\n  const config: NormalizedConfig = createPageConfig(cdnToRawPageConfig(cdnPageConfig));\n  const pageConfig: PageConfig = config.pageConfig;\n  const featureToggles: FeatureToggles = config.featureToggles;\n  const authConfig: AuthConfigs = config.authConfig;\n\n  const httpInterceptors: HttpInterceptors = createHttpInterceptors();\n  const httpRequest: HttpRequest = createHttpRequest(httpInterceptors);\n\n  const conditionsService: Conditions = createConditions();\n  if (featureToggles.entitlements.enabled) {\n    const entitlements: Entitlements = createEntitlements(httpRequest, pageConfig, featureToggles);\n    conditionsService.addResolver('entitlement', entitlements.resolve);\n  }\n\n  const setLocale: SetLocale = createSetLocale();\n  const pubsub: Pubsub = createPubsub();\n\n  const envConfig: EnvironmentConfig = {\n    locale: pageConfig.locale,\n    locales: pageConfig.locales,\n    cookiePath: '/',\n    designmode: false,\n    isAnonymousUser: false,\n    apiRoot: pageConfig.apiRoot,\n  };\n  const auth: BackbaseAuth = createAuth(authConfig, createHybridClient as unknown as CreateStrategy<AuthConfigs>,\n    httpInterceptors, httpRequest, setLocale, envConfig, pubsub);\n\n  const propertyResolver: PropertyResolver = createPropertyResolver(conditionsService, featureToggles);\n  const conditions: Pick<PropertyResolver, 'resolveEntitlements'> = {\n    resolveEntitlements: propertyResolver.resolveEntitlements,\n  };\n\n  const navigation: Navigation =\n    createNavigation(pageConfig.staticResourcesRoot, httpRequest, propertyResolver.resolveItem, pageConfig.locale);\n\n  // TODO: implement docker support for full content services\n  const portalContent: PortalContent = createPortalContentHandler(httpRequest);\n  // item refreshes depends on many libraries like redux, page store etc\n  // so it is too expensive for simple functionality it gives\n  // so I am mocking it until we decide if it is needed in docker\n  const itemRefresher: ItemRefresher = {\n    refresh: (() => Promise.resolve()) as Refresh,\n  } as ItemRefresher;\n\n  const pageRender: PageRender = createPageRender({\n    ['render-bb-widget-3']: () => createWidget3Renderer(pageConfig,\n      () => Promise.resolve(), pubsub, navigation,\n      portalContent, auth, httpInterceptors, itemRefresher, setLocale, propertyResolver),\n    ['render-bb-ssr']: (): RenderingStrategy => ({\n      bootstrap: () => Promise.resolve(),\n      update: () => Promise.resolve(),\n      remove: () => Promise.resolve(),\n    }),\n  });\n\n  return {\n    propertyResolver,\n    pageRender,\n    pageConfig,\n    pubsub,\n    navigation,\n    portalContent,\n    auth,\n    httpInterceptors,\n    itemRefresher,\n    setLocale,\n    conditions,\n  };\n}\n\nexport async function bootstrap(cdnPageConfig: CdnPageConfig, pageModel: Container) {\n  const {\n    propertyResolver,\n    pageRender,\n  } = initialise(cdnPageConfig);\n\n  return render(pageModel, propertyResolver, pageRender);\n}\n\n// enums\n\nexport { AuthKind } from 'lib-bb-page-config';\nexport { ReauthErrorCodes } from 'lib-bb-auth-hybrid';\nexport { ContentTypeLegacy, ContentTypes } from 'lib-bb-portal-content-cdn';\nexport { StructuredContentType, ContentType } from 'lib-bb-content-services';\n\n// types\n\nexport type {\n  PageConfig,\n  RawPageConfig,\n  AuthConfigs,\n  ModuleLoader,\n  BasConfig,\n  HybridConfig,\n  CustomConfig,\n} from 'lib-bb-page-config';\nexport type {\n  Breadcrumb,\n  GetBreadcrumbs,\n  GetTree,\n  LinkTreeItem,\n  Navigation,\n} from 'lib-bb-navigation-cdn';\nexport type {\n  EventName,\n  Pubsub,\n  PubsubListener,\n  Unsubscribe,\n} from 'lib-bb-pubsub';\nexport type {\n  Refresh,\n} from 'lib-bb-item-refresher';\nexport type {\n  PortalContent,\n  ImageContentItem,\n  StructuredContentItem,\n  ContentItem,\n  ContentOptions,\n  DocumentItem,\n  FlattenContentItem,\n  ImageItem,\n} from 'lib-bb-portal-content-cdn';\nexport type {\n  ContentUpdateUnsubscribe,\n} from 'lib-bb-content-updater';\nexport type {\n  Conditions,\n} from 'lib-bb-conditions';\nexport type {\n  ResolveEntitlements,\n  PropertyResolver,\n} from 'lib-bb-property-resolver';\nexport type {\n  SetLocale,\n} from 'lib-bb-set-locale-cdn';\nexport type {\n  CXResponse,\n} from 'lib-bb-portal-rest';\nexport type { RenderingStrategy } from 'lib-bb-page-render';\nexport type { Item, Widget, Container, Property, Properties } from 'lib-bb-render-model-parser';\nexport type { ItemLocation } from 'lib-bb-item-locator';\nexport type {\n  HttpRequest,\n  HttpRequestConfig,\n  HttpResponse,\n} from 'lib-bb-http';\nexport type {\n  HttpInterceptor,\n  HttpInterceptors,\n  HttpHandler,\n} from 'lib-bb-http-interceptors';\nexport type {\n  Login,\n  Logout,\n  Reauthenticate,\n  ReauthConfig,\n  ChallengeResponse,\n  ChallengeError,\n  ChallengeResponseFunction,\n  RefreshSession,\n  TimeToLive,\n  GoToLoginPage,\n  Countdown,\n  BackbaseAuth,\n  CookieOptions,\n  IsExternal,\n  Redirect,\n  Base64Jwt,\n  Seconds,\n  UnixTimeSeconds,\n  Cookie,\n  StoredSession,\n  BackbaseSession,\n  AuthSession,\n  AuthStrategy,\n  AuthUtils,\n} from 'lib-bb-auth';\n"]}