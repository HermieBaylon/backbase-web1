import { HttpErrorResponse } from '@angular/common/http';
import { Component, Directive, Input, Optional, ViewChild } from '@angular/core';
import { BbTemplate } from '@backbase/foundation-ang/core';
import { BehaviorSubject, combineLatest, of } from 'rxjs';
import { catchError, flatMap, map, publish, switchMap, withLatestFrom } from 'rxjs/operators';
import { ModalConfig, PROPERTIES } from './constants';
import * as i0 from "@angular/core";
import * as i1 from "./services/utility.service";
import * as i2 from "./services/budget.service";
import * as i3 from "@backbase/ui-ang/notification";
import * as i4 from "@backbase/foundation-ang/core";
import * as i5 from "./budget-manager/budget-manager.component";
import * as i6 from "@backbase/ui-ang/empty-state";
import * as i7 from "@backbase/ui-ang/loading-indicator";
import * as i8 from "@angular/common";
var NotificationModifier;
(function (NotificationModifier) {
    NotificationModifier["SUCCESS"] = "success";
    NotificationModifier["INFO"] = "info";
    NotificationModifier["WARNING"] = "warning";
    NotificationModifier["ERROR"] = "error";
})(NotificationModifier || (NotificationModifier = {}));
const filterInputParameters = (input, prop) => combineLatest([input, prop]).pipe(map(([inputVal, propVal]) => (inputVal !== undefined ? inputVal : propVal)));
export class BudgetWidgetComponent {
    constructor(utility, service, notificationService, model) {
        this.utility = utility;
        this.service = service;
        this.notificationService = notificationService;
        this.model = model;
        this.showPercentageSubject = new BehaviorSubject(undefined);
        this.budgetSafeZoneLimitSubject = new BehaviorSubject(undefined);
        this.notificationDismissTimeSubject = new BehaviorSubject(undefined);
        this.maxBudgetsSubject = new BehaviorSubject(undefined);
        this.reload = new BehaviorSubject(undefined);
        this.baseBudgetModalOptions = ModalConfig;
        this.confirmationModalOptions = Object.assign(Object.assign({}, this.baseBudgetModalOptions), { size: 'sm' });
        this.budgetList = this.reload.asObservable().pipe(switchMap(() => this.service.getBudgets()), catchError((error) => {
            this.handleError(error);
            return of(undefined);
        }));
        this.hostRef = this;
        this.serviceResponse = (successHeader, errorHeader) => (source) => source.pipe(flatMap(() => {
            this.reload.next(undefined);
            return of({ header: successHeader, message: '', modifier: NotificationModifier.SUCCESS });
        }), catchError(() => {
            return of({ header: errorHeader, message: '', modifier: NotificationModifier.WARNING });
        }), withLatestFrom(this.notificationDismissTime), map(([notification, notificationDismissTime]) => {
            if (notification) {
                this.pushNotification(notification.header, notification.message, notification.modifier, notificationDismissTime);
            }
            return undefined;
        }), publish());
        this.showPercentage = filterInputParameters(this.showPercentageSubject.asObservable(), this.getProperty(PROPERTIES.showPercentage).pipe(map((propertyValue) => propertyValue + '' === 'true')));
        this.budgetSafeZoneLimit = filterInputParameters(this.budgetSafeZoneLimitSubject.asObservable(), this.getProperty(PROPERTIES.budgetSafeZoneLimit).pipe(map((propertyValue) => parseInt(propertyValue, 10))));
        this.notificationDismissTime = filterInputParameters(this.notificationDismissTimeSubject.asObservable(), this.getProperty(PROPERTIES.notificationDismissTime).pipe(map((propertyValue) => parseFloat(propertyValue))));
        this.maxBudgets = filterInputParameters(this.maxBudgetsSubject.asObservable(), this.getProperty(PROPERTIES.maxBudgets).pipe(map((propertyValue) => parseFloat(propertyValue))));
    }
    set showPercentageValue(value) {
        this.showPercentageSubject.next(value);
    }
    set budgetSafeZoneLimitValue(value) {
        this.budgetSafeZoneLimitSubject.next(value);
    }
    set notificationDismissTimeValue(value) {
        this.notificationDismissTimeSubject.next(value);
    }
    set maxBudgetsValue(value) {
        this.maxBudgetsSubject.next(value);
    }
    pushNotification(header, message, modifier, notificationDismissTime) {
        if (notificationDismissTime) {
            this.notificationService.showNotification({
                header,
                message,
                modifier,
                dismissible: true,
                ttl: notificationDismissTime * 1000,
            });
        }
    }
    createBudget(createBudgetFormData) {
        const budgetName = createBudgetFormData.categoryName;
        const budgetIcon = this.utility.getCategoryIconClass(createBudgetFormData.categoryName);
        const buildCreateBudgetObj = Object.assign(createBudgetFormData, {
            budgetName,
            budgetIcon,
        });
        (this.service
            .createBudget(buildCreateBudgetObj)
            .pipe(this.serviceResponse(this.notificationCreateTemplate, this.notificationErrorCreateTemplate))).connect();
    }
    updateBudget(data) {
        const buildUpdateBudgetObj = Object.assign(data.updateBudgetFormData, {
            budgetName: data.selectedBudgetName,
        });
        (this.service
            .updateBudget(data.selectedBudgetId, buildUpdateBudgetObj)
            .pipe(this.serviceResponse(this.notificationUpdateTemplate, this.notificationErrorUpdateTemplate))).connect();
    }
    deleteBudget(budget) {
        (this.service
            .deleteBudget(budget.id)
            .pipe(this.serviceResponse(this.notificationDeleteTemplate, this.notificationErrorDeleteTemplate))).connect();
    }
    handleError(error) {
        if (error instanceof HttpErrorResponse) {
            this.error = error.statusText;
        }
        else if (error instanceof Error) {
            this.error = error.message;
        }
    }
    getProperty(property) {
        return this.model ? this.model.property(property.name, property.value) : of(property.value);
    }
}
BudgetWidgetComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BudgetWidgetComponent, deps: [{ token: i1.UtilityService }, { token: i2.BudgetService }, { token: i3.NotificationService }, { token: i4.ItemModel, optional: true }], target: i0.ɵɵFactoryTarget.Component });
BudgetWidgetComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: BudgetWidgetComponent, selector: "bb-budget-widget", inputs: { showPercentageValue: ["showPercentage", "showPercentageValue"], budgetSafeZoneLimitValue: ["budgetSafeZoneLimit", "budgetSafeZoneLimitValue"], notificationDismissTimeValue: ["notificationDismissTime", "notificationDismissTimeValue"], maxBudgetsValue: ["maxBudgets", "maxBudgetsValue"] }, viewQueries: [{ propertyName: "notificationCreateTemplate", first: true, predicate: ["notificationCreate"], descendants: true }, { propertyName: "notificationUpdateTemplate", first: true, predicate: ["notificationUpdate"], descendants: true }, { propertyName: "notificationDeleteTemplate", first: true, predicate: ["notificationDelete"], descendants: true }, { propertyName: "notificationErrorCreateTemplate", first: true, predicate: ["notificationErrorCreate"], descendants: true }, { propertyName: "notificationErrorUpdateTemplate", first: true, predicate: ["notificationErrorUpdate"], descendants: true }, { propertyName: "notificationErrorDeleteTemplate", first: true, predicate: ["notificationErrorDelete"], descendants: true }], ngImport: i0, template: "<div *ngIf=\"!error; else errorState\">\n  <ng-container *ngIf=\"budgetList | async; else loadingState; let budgetList\">\n    <bb-budget-manager\n      [budgets]=\"budgetList\"\n      [showPercentage]=\"(showPercentage | async) || undefined\"\n      [maxBudgets]=\"(maxBudgets | async) || undefined\"\n      [safeZoneLimit]=\"(budgetSafeZoneLimit | async) || undefined\"\n      (createBudget)=\"createBudget($event)\"\n      (editBudget)=\"updateBudget($event)\"\n      (deleteBudget)=\"deleteBudget($event)\"\n    ></bb-budget-manager>\n\n    <ng-container bbBudgetNotificationCustomizable [bbHostRef]=\"hostRef\"></ng-container>\n  </ng-container>\n</div>\n\n<ng-template #errorState>\n  <bb-empty-state-ui \n    class=\"card bb-state-container\"\n    title=\"\"\n    [subtitle]=\"error\"\n    iconModifier=\"error\"\n    iconSize=\"xxl\"\n    iconColor=\"gray\"\n    iconClasses=\"text-muted\"\n  ></bb-empty-state-ui>\n</ng-template>\n\n<ng-template #loadingState>\n  <bb-loading-indicator-ui\n    text=\"Loading budgets...\"\n    i18n-text=\"Loading budgets|Text to display while loading budgets@@budgets.state.loadingBudgets\"\n  ></bb-loading-indicator-ui>\n</ng-template>\n\n<ng-template bbBudgetNotificationCustomizable>\n  <ng-container notificationCreate></ng-container>\n  <ng-container notificationUpdate></ng-container>\n  <ng-container notificationDelete></ng-container>\n  <ng-container notificationErrorCreate></ng-container>\n  <ng-container notificationErrorUpdate></ng-container>\n  <ng-container notificationErrorDelete></ng-container>\n</ng-template>\n\n<ng-template #notificationCreate>\n  <span i18n=\"Create notification|Message for a notification displayed when budget create request has been processed@@budget.notification.success.create\">Budget created successfully</span>\n</ng-template>\n\n<ng-template #notificationUpdate>\n  <span i18n=\"Update notification|Message for a notification displayed when budget update request has been processed@@budget.notification.success.update\">Budget updated successfully</span>\n</ng-template>\n\n<ng-template #notificationDelete>\n  <span i18n=\"Delete notification|Message for a notification displayed when budget delete request has been processed@@budget.notification.success.delete\">Budget deleted successfully</span>\n</ng-template>\n\n<ng-template #notificationErrorCreate>\n  <span i18n=\"Create failed notification|Message for a notification displayed when budget create request has failed@@budget.notification.error.create\">Budget was not created</span>\n</ng-template>\n\n<ng-template #notificationErrorUpdate>\n  <span i18n=\"Update failed notification|Message for a notification displayed when budget update request has failed@@budget.notification.error.update\">Budget was not updated</span>\n</ng-template>\n\n<ng-template #notificationErrorDelete>\n  <span i18n=\"Delete failed notification|Message for a notification displayed when budget delete request has failed@@budget.notification.error.delete\">Budget was not deleted</span>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i5.BudgetManagerComponent; }), selector: "bb-budget-manager", inputs: ["background", "budgets", "maxBudgets", "showPercentage", "safeZoneLimit"], outputs: ["editBudget", "createBudget", "deleteBudget"] }, { type: i0.forwardRef(function () { return i6.EmptyStateComponent; }), selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }, { type: i0.forwardRef(function () { return i7.LoadingIndicatorComponent; }), selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }], directives: [{ type: i0.forwardRef(function () { return i8.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return BudgetNotificationCustomizableDirective; }), selector: "[bbBudgetNotificationCustomizable]" }], pipes: { "async": i0.forwardRef(function () { return i8.AsyncPipe; }) } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BudgetWidgetComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-budget-widget',
                    templateUrl: './budget-widget.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.UtilityService }, { type: i2.BudgetService }, { type: i3.NotificationService }, { type: i4.ItemModel, decorators: [{
                    type: Optional
                }] }]; }, propDecorators: { showPercentageValue: [{
                type: Input,
                args: ['showPercentage']
            }], budgetSafeZoneLimitValue: [{
                type: Input,
                args: ['budgetSafeZoneLimit']
            }], notificationDismissTimeValue: [{
                type: Input,
                args: ['notificationDismissTime']
            }], maxBudgetsValue: [{
                type: Input,
                args: ['maxBudgets']
            }], notificationCreateTemplate: [{
                type: ViewChild,
                args: ['notificationCreate']
            }], notificationUpdateTemplate: [{
                type: ViewChild,
                args: ['notificationUpdate']
            }], notificationDeleteTemplate: [{
                type: ViewChild,
                args: ['notificationDelete']
            }], notificationErrorCreateTemplate: [{
                type: ViewChild,
                args: ['notificationErrorCreate']
            }], notificationErrorUpdateTemplate: [{
                type: ViewChild,
                args: ['notificationErrorUpdate']
            }], notificationErrorDeleteTemplate: [{
                type: ViewChild,
                args: ['notificationErrorDelete']
            }] } });
export class BudgetNotificationCustomizableDirective extends BbTemplate {
}
BudgetNotificationCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BudgetNotificationCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
BudgetNotificationCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: BudgetNotificationCustomizableDirective, selector: "[bbBudgetNotificationCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: BudgetNotificationCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbBudgetNotificationCustomizable]',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVkZ2V0LXdpZGdldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWJzL2J1ZGdldC13aWRnZXQvc3JjL2J1ZGdldC13aWRnZXQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy9idWRnZXQtd2lkZ2V0L3NyYy9idWRnZXQtd2lkZ2V0LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQWUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlGLE9BQU8sRUFBRSxVQUFVLEVBQWEsTUFBTSwrQkFBK0IsQ0FBQztBQUd0RSxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBcUMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdGLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlGLE9BQU8sRUFBRSxXQUFXLEVBQWMsVUFBVSxFQUFFLE1BQU0sYUFBYSxDQUFDOzs7Ozs7Ozs7O0FBT2xFLElBQUssb0JBS0o7QUFMRCxXQUFLLG9CQUFvQjtJQUN2QiwyQ0FBbUIsQ0FBQTtJQUNuQixxQ0FBYSxDQUFBO0lBQ2IsMkNBQW1CLENBQUE7SUFDbkIsdUNBQWUsQ0FBQTtBQUNqQixDQUFDLEVBTEksb0JBQW9CLEtBQXBCLG9CQUFvQixRQUt4QjtBQVFELE1BQU0scUJBQXFCLEdBQUcsQ0FBSSxLQUFnQyxFQUFFLElBQW1CLEVBQWlCLEVBQUUsQ0FDeEcsYUFBYSxDQUFDLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMs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RGtKYSx1Q0FBdUM7NEZBbEx2QyxxQkFBcUI7a0JBSmpDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGtCQUFrQjtvQkFDNUIsV0FBVyxFQUFFLGdDQUFnQztpQkFDOUM7OzBCQWdESSxRQUFROzRDQTlDa0IsbUJBQW1CO3NCQUEvQyxLQUFLO3VCQUFDLGdCQUFnQjtnQkFHVyx3QkFBd0I7c0JBQXpELEtBQUs7dUJBQUMscUJBQXFCO2dCQUdVLDRCQUE0QjtzQkFBakUsS0FBSzt1QkFBQyx5QkFBeUI7Z0JBR1AsZUFBZTtzQkFBdkMsS0FBSzt1QkFBQyxZQUFZO2dCQUljLDBCQUEwQjtzQkFBMUQsU0FBUzt1QkFBQyxvQkFBb0I7Z0JBQ0UsMEJBQTBCO3NCQUExRCxTQUFTO3VCQUFDLG9CQUFvQjtnQkFDRSwwQkFBMEI7c0JBQTFELFNBQVM7dUJBQUMsb0JBQW9CO2dCQUNPLCtCQUErQjtzQkFBcEUsU0FBUzt1QkFBQyx5QkFBeUI7Z0JBQ0UsK0JBQStCO3NCQUFwRSxTQUFTO3VCQUFDLHlCQUF5QjtnQkFDRSwrQkFBK0I7c0JBQXBFLFNBQVM7dUJBQUMseUJBQXlCOztBQStKdEMsTUFBTSxPQUFPLHVDQUF3QyxTQUFRLFVBQTRDOztxSUFBNUYsdUNBQXVDO3lIQUF2Qyx1Q0FBdUM7NEZBQXZDLHVDQUF1QztrQkFIbkQsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsb0NBQW9DO2lCQUMvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBEaXJlY3RpdmUsIElucHV0LCBPcHRpb25hbCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmJUZW1wbGF0ZSwgSXRlbU1vZGVsIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICdAYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvd2ViLXNkayc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy9ub3RpZmljYXRpb24nO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCBDb25uZWN0YWJsZU9ic2VydmFibGUsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBmbGF0TWFwLCBtYXAsIHB1Ymxpc2gsIHN3aXRjaE1hcCwgd2l0aExhdGVzdEZyb20gfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDcmVhdGVCdWRnZXRGb3JtLCBVcGRhdGVCdWRnZXRGb3JtIH0gZnJvbSAnLi9idWRnZXQtbWFuYWdlci9idWRnZXQtbWFuYWdlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgTW9kYWxDb25maWcsIFByb3BlcnRpZXMsIFBST1BFUlRJRVMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBCdWRnZXREYXRhLCBCdWRnZXRJdGVtLCBCdWRnZXRMaXN0LCBCdWRnZXRQb3N0IH0gZnJvbSAnLi9tb2RlbC9idWRnZXRzJztcbmltcG9ydCB7IEJ1ZGdldFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2J1ZGdldC5zZXJ2aWNlJztcbmltcG9ydCB7IFV0aWxpdHlTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy91dGlsaXR5LnNlcnZpY2UnO1xuXG50eXBlIE5vdGlmaWNhdGlvbkhlYWRlciA9IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT47XG50eXBlIE5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xuZW51bSBOb3RpZmljYXRpb25Nb2RpZmllciB7XG4gIFNVQ0NFU1MgPSAnc3VjY2VzcycsXG4gIElORk8gPSAnaW5mbycsXG4gIFdBUk5JTkcgPSAnd2FybmluZycsXG4gIEVSUk9SID0gJ2Vycm9yJyxcbn1cblxuaW50ZXJmYWNlIE5vdGlmaWNhdGlvbiB7XG4gIGhlYWRlcjogTm90aWZpY2F0aW9uSGVhZGVyO1xuICBtZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlO1xuICBtb2RpZmllcjogTm90aWZpY2F0aW9uTW9kaWZpZXIgfCB1bmRlZmluZWQ7XG59XG5cbmNvbnN0IGZpbHRlcklucHV0UGFyYW1ldGVycyA9IDxUPihpbnB1dDogT2JzZXJ2YWJsZTxUIHwgdW5kZWZpbmVkPiwgcHJvcDogT2JzZXJ2YWJsZTxUPik6IE9ic2VydmFibGU8VD4gPT5cbiAgY29tYmluZUxhdGVzdChbaW5wdXQsIHByb3BdKS5waXBlKG1hcCgoW2lucHV0VmFsLCBwcm9wVmFsXSkgPT4gKGlucHV0VmFsICE9PSB1bmRlZmluZWQgPyBpbnB1dFZhbCA6IHByb3BWYWwpKSk7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLWJ1ZGdldC13aWRnZXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vYnVkZ2V0LXdpZGdldC5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIEJ1ZGdldFdpZGdldENvbXBvbmVudCB7XG4gIEBJbnB1dCgnc2hvd1BlcmNlbnRhZ2UnKSBzZXQgc2hvd1BlcmNlbnRhZ2VWYWx1ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuc2hvd1BlcmNlbnRhZ2VTdWJqZWN0Lm5leHQodmFsdWUpO1xuICB9XG4gIEBJbnB1dCgnYnVkZ2V0U2FmZVpvbmVMaW1pdCcpIHNldCBidWRnZXRTYWZlWm9uZUxpbWl0VmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuYnVkZ2V0U2FmZVpvbmVMaW1pdFN1YmplY3QubmV4dCh2YWx1ZSk7XG4gIH1cbiAgQElucHV0KCdub3RpZmljYXRpb25EaXNtaXNzVGltZScpIHNldCBub3RpZmljYXRpb25EaXNtaXNzVGltZVZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lU3ViamVjdC5uZXh0KHZhbHVlKTtcbiAgfVxuICBASW5wdXQoJ21heEJ1ZGdldHMnKSBzZXQgbWF4QnVkZ2V0c1ZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLm1heEJ1ZGdldHNTdWJqZWN0Lm5leHQodmFsdWUpO1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnbm90aWZpY2F0aW9uQ3JlYXRlJykgbm90aWZpY2F0aW9uQ3JlYXRlVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCB1bmRlZmluZWQ7XG4gIEBWaWV3Q2hpbGQoJ25vdGlmaWNhdGlvblVwZGF0ZScpIG5vdGlmaWNhdGlvblVwZGF0ZVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgdW5kZWZpbmVkO1xuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25EZWxldGUnKSBub3RpZmljYXRpb25EZWxldGVUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnbm90aWZpY2F0aW9uRXJyb3JDcmVhdGUnKSBub3RpZmljYXRpb25FcnJvckNyZWF0ZVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgdW5kZWZpbmVkO1xuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25FcnJvclVwZGF0ZScpIG5vdGlmaWNhdGlvbkVycm9yVXBkYXRlVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCB1bmRlZmluZWQ7XG4gIEBWaWV3Q2hpbGQoJ25vdGlmaWNhdGlvbkVycm9yRGVsZXRlJykgbm90aWZpY2F0aW9uRXJyb3JEZWxldGVUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIHJlYWRvbmx5IHNob3dQZXJjZW50YWdlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBidWRnZXRTYWZlWm9uZUxpbWl0U3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVtYmVyIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvbkRpc21pc3NUaW1lU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVtYmVyIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heEJ1ZGdldHNTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxudW1iZXIgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSByZWxvYWQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHVuZGVmaW5lZCk7XG4gIHJlYWRvbmx5IGJhc2VCdWRnZXRNb2RhbE9wdGlvbnMgPSBNb2RhbENvbmZpZztcbiAgcmVhZG9ubHkgY29uZmlybWF0aW9uTW9kYWxPcHRpb25zID0ge1xuICAgIC4uLnRoaXMuYmFzZUJ1ZGdldE1vZGFsT3B0aW9ucyxcbiAgICBzaXplOiAnc20nLFxuICB9O1xuICByZWFkb25seSBidWRnZXRMaXN0OiBPYnNlcnZhYmxlPEJ1ZGdldExpc3QgfCB1bmRlZmluZWQ+ID0gdGhpcy5yZWxvYWQuYXNPYnNlcnZhYmxlKCkucGlwZShcbiAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5zZXJ2aWNlLmdldEJ1ZGdldHMoKSksXG4gICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlIHwgRXJyb3IpID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xuICAgICAgcmV0dXJuIG9mKHVuZGVmaW5lZCk7XG4gICAgfSksXG4gICk7XG5cbiAgaG9zdFJlZiA9IHRoaXM7XG4gIGVycm9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSB1dGlsaXR5OiBVdGlsaXR5U2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlcnZpY2U6IEJ1ZGdldFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgcmVhZG9ubHkgbW9kZWw6IEl0ZW1Nb2RlbCxcbiAgKSB7fVxuXG4gIHByaXZhdGUgcHVzaE5vdGlmaWNhdGlvbihcbiAgICBoZWFkZXI6IE5vdGlmaWNhdGlvbkhlYWRlcixcbiAgICBtZXNzYWdlOiBOb3RpZmljYXRpb25NZXNzYWdlLFxuICAgIG1vZGlmaWVyOiBOb3RpZmljYXRpb25Nb2RpZmllcixcbiAgICBub3RpZmljYXRpb25EaXNtaXNzVGltZTogbnVtYmVyIHwgdW5kZWZpbmVkLFxuICApIHtcbiAgICBpZiAobm90aWZpY2F0aW9uRGlzbWlzc1RpbWUpIHtcbiAgICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgICAgaGVhZGVyLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBtb2RpZmllcixcbiAgICAgICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgICAgIHR0bDogbm90aWZpY2F0aW9uRGlzbWlzc1RpbWUgKiAxMDAwLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWFkb25seSBzZXJ2aWNlUmVzcG9uc2UgPVxuICAgIDxSPihzdWNjZXNzSGVhZGVyOiBOb3RpZmljYXRpb25IZWFkZXIsIGVycm9ySGVhZGVyOiBOb3RpZmljYXRpb25IZWFkZXIpID0+XG4gICAgKHNvdXJjZTogT2JzZXJ2YWJsZTxSPik6IE9ic2VydmFibGU8Tm90aWZpY2F0aW9uIHwgdW5kZWZpbmVkPiA9PlxuICAgICAgc291cmNlLnBpcGUoXG4gICAgICAgIGZsYXRNYXAoKCkgPT4ge1xuICAgICAgICAgIHRoaXMucmVsb2FkLm5leHQodW5kZWZpbmVkKTtcbiAgICAgICAgICByZXR1cm4gb2YoeyBoZWFkZXI6IHN1Y2Nlc3NIZWFkZXIsIG1lc3NhZ2U6ICcnLCBtb2RpZmllcjogTm90aWZpY2F0aW9uTW9kaWZpZXIuU1VDQ0VTUyB9KTtcbiAgICAgICAgfSksXG4gICAgICAgIGNhdGNoRXJyb3IoKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBvZih7IGhlYWRlcjogZXJyb3JIZWFkZXIsIG1lc3NhZ2U6ICcnLCBtb2RpZmllcjogTm90aWZpY2F0aW9uTW9kaWZpZXIuV0FSTklORyB9KTtcbiAgICAgICAgfSksXG4gICAgICAgIHdpdGhMYXRlc3RGcm9tKHRoaXMubm90aWZpY2F0aW9uRGlzbWlzc1RpbWUpLFxuICAgICAgICBtYXAoKFtub3RpZmljYXRpb24sIG5vdGlmaWNhdGlvbkRpc21pc3NUaW1lXSkgPT4ge1xuICAgICAgICAgIGlmIChub3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMucHVzaE5vdGlmaWNhdGlvbihcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmhlYWRlcixcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLm1lc3NhZ2UsXG4gICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5tb2RpZmllcixcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uRGlzbWlzc1RpbWUsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9KSxcbiAgICAgICAgcHVibGlzaCgpLFxuICAgICAgKTtcblxuICBjcmVhdGVCdWRnZXQoY3JlYXRlQnVkZ2V0Rm9ybURhdGE6IENyZWF0ZUJ1ZGdldEZvcm0pIHtcbiAgICBjb25zdCBidWRnZXROYW1lID0gY3JlYXRlQnVkZ2V0Rm9ybURhdGEuY2F0ZWdvcnlOYW1lO1xuICAgIGNvbnN0IGJ1ZGdldEljb24gPSB0aGlzLnV0aWxpdHkuZ2V0Q2F0ZWdvcnlJY29uQ2xhc3MoY3JlYXRlQnVkZ2V0Rm9ybURhdGEuY2F0ZWdvcnlOYW1lKTtcbiAgICBjb25zdCBidWlsZENyZWF0ZUJ1ZGdldE9iajogQnVkZ2V0UG9zdCA9IE9iamVjdC5hc3NpZ24oY3JlYXRlQnVkZ2V0Rm9ybURhdGEsIHtcbiAgICAgIGJ1ZGdldE5hbWUsXG4gICAgICBidWRnZXRJY29uLFxuICAgIH0pO1xuXG4gICAgKDxDb25uZWN0YWJsZU9ic2VydmFibGU8Tm90aWZpY2F0aW9uPj4oXG4gICAgICB0aGlzLnNlcnZpY2VcbiAgICAgICAgLmNyZWF0ZUJ1ZGdldChidWlsZENyZWF0ZUJ1ZGdldE9iailcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGhpcy5zZXJ2aWNlUmVzcG9uc2UoXG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbkNyZWF0ZVRlbXBsYXRlIGFzIFRlbXBsYXRlUmVmPGFueT4sXG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbkVycm9yQ3JlYXRlVGVtcGxhdGUgYXMgVGVtcGxhdGVSZWY8YW55PixcbiAgICAgICAgICApLFxuICAgICAgICApXG4gICAgKSkuY29ubmVjdCgpO1xuICB9XG5cbiAgdXBkYXRlQnVkZ2V0KGRhdGE6IFVwZGF0ZUJ1ZGdldEZvcm0pIHtcbiAgICBjb25zdCBidWlsZFVwZGF0ZUJ1ZGdldE9iajogQnVkZ2V0SXRlbSA9IE9iamVjdC5hc3NpZ24oZGF0YS51cGRhdGVCdWRnZXRGb3JtRGF0YSwge1xuICAgICAgYnVkZ2V0TmFtZTogZGF0YS5zZWxlY3RlZEJ1ZGdldE5hbWUsXG4gICAgfSk7XG5cbiAgICAoPENvbm5lY3RhYmxlT2JzZXJ2YWJsZTxOb3RpZmljYXRpb24+PihcbiAgICAgIHRoaXMuc2VydmljZVxuICAgICAgICAudXBkYXRlQnVkZ2V0KGRhdGEuc2VsZWN0ZWRCdWRnZXRJZCwgYnVpbGRVcGRhdGVCdWRnZXRPYmopXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRoaXMuc2VydmljZVJlc3BvbnNlKFxuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25VcGRhdGVUZW1wbGF0ZSBhcyBUZW1wbGF0ZVJlZjxhbnk+LFxuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25FcnJvclVwZGF0ZVRlbXBsYXRlIGFzIFRlbXBsYXRlUmVmPGFueT4sXG4gICAgICAgICAgKSxcbiAgICAgICAgKVxuICAgICkpLmNvbm5lY3QoKTtcbiAgfVxuXG4gIGRlbGV0ZUJ1ZGdldChidWRnZXQ6IEJ1ZGdldERhdGEpIHtcbiAgICAoPENvbm5lY3RhYmxlT2JzZXJ2YWJsZTxOb3RpZmljYXRpb24+PihcbiAgICAgIHRoaXMuc2VydmljZVxuICAgICAgICAuZGVsZXRlQnVkZ2V0KGJ1ZGdldC5pZClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGhpcy5zZXJ2aWNlUmVzcG9uc2UoXG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbkRlbGV0ZVRlbXBsYXRlIGFzIFRlbXBsYXRlUmVmPGFueT4sXG4gICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbkVycm9yRGVsZXRlVGVtcGxhdGUgYXMgVGVtcGxhdGVSZWY8YW55PixcbiAgICAgICAgICApLFxuICAgICAgICApXG4gICAgKSkuY29ubmVjdCgpO1xuICB9XG5cbiAgaGFuZGxlRXJyb3IoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlIHwgRXJyb3IpOiB2b2lkIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXJyb3JSZXNwb25zZSkge1xuICAgICAgdGhpcy5lcnJvciA9IGVycm9yLnN0YXR1c1RleHQ7XG4gICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICB0aGlzLmVycm9yID0gZXJyb3IubWVzc2FnZTtcbiAgICB9XG4gIH1cblxuICByZWFkb25seSBzaG93UGVyY2VudGFnZTogT2JzZXJ2YWJsZTxib29sZWFuPiA9IGZpbHRlcklucHV0UGFyYW1ldGVycyhcbiAgICB0aGlzLnNob3dQZXJjZW50YWdlU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLmdldFByb3BlcnR5KFBST1BFUlRJRVMuc2hvd1BlcmNlbnRhZ2UpLnBpcGUobWFwKChwcm9wZXJ0eVZhbHVlKSA9PiBwcm9wZXJ0eVZhbHVlICsgJycgPT09ICd0cnVlJykpLFxuICApO1xuICByZWFkb25seSBidWRnZXRTYWZlWm9uZUxpbWl0OiBPYnNlcnZhYmxlPG51bWJlcj4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5idWRnZXRTYWZlWm9uZUxpbWl0U3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLmdldFByb3BlcnR5KFBST1BFUlRJRVMuYnVkZ2V0U2FmZVpvbmVMaW1pdCkucGlwZShtYXAoKHByb3BlcnR5VmFsdWUpID0+IHBhcnNlSW50KDxzdHJpbmc+cHJvcGVydHlWYWx1ZSwgMTApKSksXG4gICk7XG4gIHJlYWRvbmx5IG5vdGlmaWNhdGlvbkRpc21pc3NUaW1lOiBPYnNlcnZhYmxlPG51bWJlcj4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5ub3RpZmljYXRpb25EaXNtaXNzVGltZVN1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5nZXRQcm9wZXJ0eShQUk9QRVJUSUVTLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lKS5waXBlKFxuICAgICAgbWFwKChwcm9wZXJ0eVZhbHVlKSA9PiBwYXJzZUZsb2F0KDxzdHJpbmc+cHJvcGVydHlWYWx1ZSkpLFxuICAgICksXG4gICk7XG4gIHJlYWRvbmx5IG1heEJ1ZGdldHM6IE9ic2VydmFibGU8bnVtYmVyPiA9IGZpbHRlcklucHV0UGFyYW1ldGVycyhcbiAgICB0aGlzLm1heEJ1ZGdldHNTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLFxuICAgIHRoaXMuZ2V0UHJvcGVydHkoUFJPUEVSVElFUy5tYXhCdWRnZXRzKS5waXBlKG1hcCgocHJvcGVydHlWYWx1ZSkgPT4gcGFyc2VGbG9hdCg8c3RyaW5nPnByb3BlcnR5VmFsdWUpKSksXG4gICk7XG5cbiAgcHJpdmF0ZSBnZXRQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydGllcyk6IE9ic2VydmFibGU8UHJvcGVydHk+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbCA/IHRoaXMubW9kZWwucHJvcGVydHkocHJvcGVydHkubmFtZSwgcHJvcGVydHkudmFsdWUpIDogb2YocHJvcGVydHkudmFsdWUpO1xuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tiYkJ1ZGdldE5vdGlmaWNhdGlvbkN1c3RvbWl6YWJsZV0nLFxufSlcbmV4cG9ydCBjbGFzcyBCdWRnZXROb3RpZmljYXRpb25DdXN0b21pemFibGVEaXJlY3RpdmUgZXh0ZW5kcyBCYlRlbXBsYXRlPEJ1ZGdldFdpZGdldENvbXBvbmVudCwgdW5kZWZpbmVkPiB7fVxuIiwiPGRpdiAqbmdJZj1cIiFlcnJvcjsgZWxzZSBlcnJvclN0YXRlXCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJidWRnZXRMaXN0IHwgYXN5bmM7IGVsc2UgbG9hZGluZ1N0YXRlOyBsZXQgYnVkZ2V0TGlzdFwiPlxuICAgIDxiYi1idWRnZXQtbWFuYWdlclxuICAgICAgW2J1ZGdldHNdPVwiYnVkZ2V0TGlzdFwiXG4gICAgICBbc2hvd1BlcmNlbnRhZ2VdPVwiKHNob3dQZXJjZW50YWdlIHwgYXN5bmMpIHx8IHVuZGVmaW5lZFwiXG4gICAgICBbbWF4QnVkZ2V0c109XCIobWF4QnVkZ2V0cyB8IGFzeW5jKSB8fCB1bmRlZmluZWRcIlxuICAgICAgW3NhZmVab25lTGltaXRdPVwiKGJ1ZGdldFNhZmVab25lTGltaXQgfCBhc3luYykgfHwgdW5kZWZpbmVkXCJcbiAgICAgIChjcmVhdGVCdWRnZXQpPVwiY3JlYXRlQnVkZ2V0KCRldmVudClcIlxuICAgICAgKGVkaXRCdWRnZXQpPVwidXBkYXRlQnVkZ2V0KCRldmVudClcIlxuICAgICAgKGRlbGV0ZUJ1ZGdldCk9XCJkZWxldGVCdWRnZXQoJGV2ZW50KVwiXG4gICAgPjwvYmItYnVkZ2V0LW1hbmFnZXI+XG5cbiAgICA8bmctY29udGFpbmVyIGJiQnVkZ2V0Tm90aWZpY2F0aW9uQ3VzdG9taXphYmxlIFtiYkhvc3RSZWZdPVwiaG9zdFJlZlwiPjwvbmctY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2Vycm9yU3RhdGU+XG4gIDxiYi1lbXB0eS1zdGF0ZS11aSBcbiAgICBjbGFzcz1cImNhcmQgYmItc3RhdGUtY29udGFpbmVyXCJcbiAgICB0aXRsZT1cIlwiXG4gICAgW3N1YnRpdGxlXT1cImVycm9yXCJcbiAgICBpY29uTW9kaWZpZXI9XCJlcnJvclwiXG4gICAgaWNvblNpemU9XCJ4eGxcIlxuICAgIGljb25Db2xvcj1cImdyYXlcIlxuICAgIGljb25DbGFzc2VzPVwidGV4dC1tdXRlZFwiXG4gID48L2JiLWVtcHR5LXN0YXRlLXVpPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNsb2FkaW5nU3RhdGU+XG4gIDxiYi1sb2FkaW5nLWluZGljYXRvci11aVxuICAgIHRleHQ9XCJMb2FkaW5nIGJ1ZGdldHMuLi5cIlxuICAgIGkxOG4tdGV4dD1cIkxvYWRpbmcgYnVkZ2V0c3xUZXh0IHRvIGRpc3BsYXkgd2hpbGUgbG9hZGluZyBidWRnZXRzQEBidWRnZXRzLnN0YXRlLmxvYWRpbmdCdWRnZXRzXCJcbiAgPjwvYmItbG9hZGluZy1pbmRpY2F0b3ItdWk+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgYmJCdWRnZXROb3RpZmljYXRpb25DdXN0b21pemFibGU+XG4gIDxuZy1jb250YWluZXIgbm90aWZpY2F0aW9uQ3JlYXRlPjwvbmctY29udGFpbmVyPlxuICA8bmctY29udGFpbmVyIG5vdGlmaWNhdGlvblVwZGF0ZT48L25nLWNvbnRhaW5lcj5cbiAgPG5nLWNvbnRhaW5lciBub3RpZmljYXRpb25EZWxldGU+PC9uZy1jb250YWluZXI+XG4gIDxuZy1jb250YWluZXIgbm90aWZpY2F0aW9uRXJyb3JDcmVhdGU+PC9uZy1jb250YWluZXI+XG4gIDxuZy1jb250YWluZXIgbm90aWZpY2F0aW9uRXJyb3JVcGRhdGU+PC9uZy1jb250YWluZXI+XG4gIDxuZy1jb250YWluZXIgbm90aWZpY2F0aW9uRXJyb3JEZWxldGU+PC9uZy1jb250YWluZXI+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI25vdGlmaWNhdGlvbkNyZWF0ZT5cbiAgPHNwYW4gaTE4bj1cIkNyZWF0ZSBub3RpZmljYXRpb258TWVzc2FnZSBmb3IgYSBub3RpZmljYXRpb24gZGlzcGxheWVkIHdoZW4gYnVkZ2V0IGNyZWF0ZSByZXF1ZXN0IGhhcyBiZWVuIHByb2Nlc3NlZEBAYnVkZ2V0Lm5vdGlmaWNhdGlvbi5zdWNjZXNzLmNyZWF0ZVwiPkJ1ZGdldCBjcmVhdGVkIHN1Y2Nlc3NmdWxseTwvc3Bhbj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uVXBkYXRlPlxuICA8c3BhbiBpMThuPVwiVXBkYXRlIG5vdGlmaWNhdGlvbnxNZXNzYWdlIGZvciBhIG5vdGlmaWNhdGlvbiBkaXNwbGF5ZWQgd2hlbiBidWRnZXQgdXBkYXRlIHJlcXVlc3QgaGFzIGJlZW4gcHJvY2Vzc2VkQEBidWRnZXQubm90aWZpY2F0aW9uLnN1Y2Nlc3MudXBkYXRlXCI+QnVkZ2V0IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5PC9zcGFuPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNub3RpZmljYXRpb25EZWxldGU+XG4gIDxzcGFuIGkxOG49XCJEZWxldGUgbm90aWZpY2F0aW9ufE1lc3NhZ2UgZm9yIGEgbm90aWZpY2F0aW9uIGRpc3BsYXllZCB3aGVuIGJ1ZGdldCBkZWxldGUgcmVxdWVzdCBoYXMgYmVlbiBwcm9jZXNzZWRAQGJ1ZGdldC5ub3RpZmljYXRpb24uc3VjY2Vzcy5kZWxldGVcIj5CdWRnZXQgZGVsZXRlZCBzdWNjZXNzZnVsbHk8L3NwYW4+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI25vdGlmaWNhdGlvbkVycm9yQ3JlYXRlPlxuICA8c3BhbiBpMThuPVwiQ3JlYXRlIGZhaWxlZCBub3RpZmljYXRpb258TWVzc2FnZSBmb3IgYSBub3RpZmljYXRpb24gZGlzcGxheWVkIHdoZW4gYnVkZ2V0IGNyZWF0ZSByZXF1ZXN0IGhhcyBmYWlsZWRAQGJ1ZGdldC5ub3RpZmljYXRpb24uZXJyb3IuY3JlYXRlXCI+QnVkZ2V0IHdhcyBub3QgY3JlYXRlZDwvc3Bhbj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uRXJyb3JVcGRhdGU+XG4gIDxzcGFuIGkxOG49XCJVcGRhdGUgZmFpbGVkIG5vdGlmaWNhdGlvbnxNZXNzYWdlIGZvciBhIG5vdGlmaWNhdGlvbiBkaXNwbGF5ZWQgd2hlbiBidWRnZXQgdXBkYXRlIHJlcXVlc3QgaGFzIGZhaWxlZEBAYnVkZ2V0Lm5vdGlmaWNhdGlvbi5lcnJvci51cGRhdGVcIj5CdWRnZXQgd2FzIG5vdCB1cGRhdGVkPC9zcGFuPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNub3RpZmljYXRpb25FcnJvckRlbGV0ZT5cbiAgPHNwYW4gaTE4bj1cIkRlbGV0ZSBmYWlsZWQgbm90aWZpY2F0aW9ufE1lc3NhZ2UgZm9yIGEgbm90aWZpY2F0aW9uIGRpc3BsYXllZCB3aGVuIGJ1ZGdldCBkZWxldGUgcmVxdWVzdCBoYXMgZmFpbGVkQEBidWRnZXQubm90aWZpY2F0aW9uLmVycm9yLmRlbGV0ZVwiPkJ1ZGdldCB3YXMgbm90IGRlbGV0ZWQ8L3NwYW4+XG48L25nLXRlbXBsYXRlPlxuIl19