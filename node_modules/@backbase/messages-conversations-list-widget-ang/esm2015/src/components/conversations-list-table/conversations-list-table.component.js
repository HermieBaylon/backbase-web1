import { Component, Directive, EventEmitter, Input, Output } from '@angular/core';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { map, take, takeUntil } from 'rxjs/operators';
import { BbTemplate, TemplateRegistry } from '@backbase/foundation-ang/core';
import { MailboxTypeEnum, ReadUnreadStatusType } from '../../model';
import { BaseConversationsListPropertiesService, getPropertyValue } from '@backbase/messages-common';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/messages-common";
import * as i2 from "@backbase/ui-ang/icon";
import * as i3 from "../conversations-list-table-head/conversations-list-table-head.component";
import * as i4 from "../conversations-list-table-row/conversations-list-table-row.component";
import * as i5 from "@backbase/ui-ang/modal";
import * as i6 from "@backbase/ui-ang/button";
import * as i7 from "@angular/common";
import * as i8 from "@backbase/ui-ang/keyboard-click-directive";
import * as i9 from "@backbase/ui-ang/tooltip-directive";
import * as i10 from "@angular/forms";
export class ConversationsListTableComponent {
    constructor(properties) {
        this.properties = properties;
        /**
         * Emits conversation object on select event
         */
        this.select = new EventEmitter();
        /**
         * Emits id of the conversation that should be marked as read/unread
         */
        this.read = new EventEmitter();
        /**
         * Emits id of the conversation that should be removed
         */
        this.remove = new EventEmitter();
        /**
         * EventEmitter to update list of the conversations
         */
        this.update = new EventEmitter();
        /**
         * The unique ID HTML property for each component instance.
         */
        this.id = `conversations-list-table-component-${ConversationsListTableComponent.counter++}`;
        this.hostRef = this;
        this._conversations = [];
        this.readUnreadStatusTypeDefault = ReadUnreadStatusType.READ;
        this.readUnreadStatus = this.readUnreadStatusTypeDefault;
        this.unsubscribe = new Subject();
        /**
         * The flag that toggles between the open and closed state of the confirmation modal for conversation removal.
         */
        this.removeModalOpened = false;
        /**
         * The array containing the IDs of selected conversations.
         */
        this.selectedIdsArray = [];
        /**
         * The stream with the flag toggling between the draft and the conversation view.
         */
        this.isDraftView$ = of(false);
        this.mailboxType$$ = new BehaviorSubject(undefined);
    }
    /**
     * Array of the conversations
     */
    set conversations(value) {
        this._conversations = value;
        this.manageSelectionForm(this.selectionsGroupForm);
    }
    /**
     * The conversations getter.
     */
    get conversations() {
        return this._conversations;
    }
    /**
     * The stream with the mailbox type.
     */
    set mailboxTypeValue(value) {
        this.mailboxType$$.next(value);
    }
    doesParentContainDropdown(node) {
        return !!(node.parentNode && node.parentNode.closest('.dropdown'));
    }
    ngOnInit() {
        if (this.reset) {
            this.reset.pipe(takeUntil(this.unsubscribe)).subscribe(() => this.resetForm());
        }
        this.isDraftView$ = this.mailboxType.pipe(take(1), map(type => type === MailboxTypeEnum.drafts));
    }
    ngOnDestroy() {
        this.unsubscribe.next();
        this.unsubscribe.complete();
    }
    /**
     * The flag indicating if the conversation is unread.
     */
    get isUnread() {
        return this.readUnreadStatus === ReadUnreadStatusType.UNREAD;
    }
    /**
     * The method to update the list of conversations.
     */
    callUpdate() {
        this.resetForm();
        this.update.emit();
    }
    /**
     * The method to mark a conversation as selected.
     *
     * @param event Mouse event
     * @param conversation Conversation thread data
     */
    callSelect(event, conversation) {
        if (this.doesParentContainDropdown(event.target)) {
            return;
        }
        this.select.emit(conversation);
    }
    /**
     * The method to mark a conversation as read or unread.
     *
     * @param conversationId Conversation id
     * @param conversationStatus Conversation status
     */
    markAsReadUnread(conversationId, conversationStatus) {
        const status = conversationStatus === undefined
            ? this.readUnreadStatus
            : conversationStatus
                ? ReadUnreadStatusType.UNREAD
                : ReadUnreadStatusType.READ;
        this.read.emit({
            status,
            ids: conversationId ? [conversationId] : this.selectedIdsArray,
        });
    }
    /**
     * The method to open the confirmation modal for removal.
     *
     * @param id Conversation id
     */
    openRemoveModal(id) {
        this.removeId = id;
        this.removeModalOpened = true;
    }
    /**
     * The method to close the confirmation modal for removal.
     */
    closeRemoveModal() {
        this.removeId = undefined;
        this.removeModalOpened = false;
    }
    /**
     * The method to confirm the remove action and close the modal.
     */
    confirmRemoveModal() {
        this.remove.emit(this.removeId ? [this.removeId] : this.selectedIdsArray);
        this.closeRemoveModal();
    }
    /**
     * The method to update the selected conversations form.
     *
     * @param ngForm Form object
     */
    manageSelectionForm(ngForm) {
        if (ngForm) {
            const ids = ngForm.form.value.ids;
            this.selectionsGroupForm = ngForm;
            this.selectedIdsArray = Object.keys(ids).filter(id => ids[id]);
            if (this.selectedIdsArray.length) {
                const selectedIdsIncludesUnreadConversation = this.conversations.find(conversation => this.selectedIdsArray.includes(conversation.id) && !conversation.read);
                this.readUnreadStatus = selectedIdsIncludesUnreadConversation
                    ? ReadUnreadStatusType.READ
                    : ReadUnreadStatusType.UNREAD;
            }
            else {
                this.readUnreadStatus = ReadUnreadStatusType.READ;
            }
        }
    }
    /**
     * The method to differentiate conversations by IDs in order to optimize loops performance.
     *
     * @param _index Index
     * @param item Conversation thread
     * @returns Conversation thread id
     */
    trackByFn(_index, item) {
        return item.id;
    }
    resetForm() {
        if (this.selectionsGroupForm) {
            this.selectionsGroupForm.reset();
            this.manageSelectionForm(this.selectionsGroupForm);
        }
    }
    get mailboxType() {
        return getPropertyValue(this.mailboxType$$.asObservable(), this.properties.mailboxType);
    }
}
ConversationsListTableComponent.counter = 0;
ConversationsListTableComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: ConversationsListTableComponent, deps: [{ token: i1.BaseConversationsListPropertiesService }], target: i0.ɵɵFactoryTarget.Component });
ConversationsListTableComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.14", type: ConversationsListTableComponent, selector: "bb-conversations-list-table-ui", inputs: { conversations: "conversations", reset: "reset", mailboxTypeValue: ["mailboxType", "mailboxTypeValue"], customerServiceTitle$: "customerServiceTitle$" }, outputs: { select: "select", read: "read", remove: "remove", update: "update" }, providers: [TemplateRegistry, BaseConversationsListPropertiesService], ngImport: i0, template: "<ng-container\n  bbConversationsListTableCustomizable\n  [bbHostRef]=\"hostRef\"\n  [bbTemplateContext]=\"{\n    isDraftView: isDraftView$ | async,\n    mailboxType: mailboxType | async\n  }\"\n></ng-container>\n\n<ng-template\n  bbConversationsListTableCustomizable\n  let-host\n  let-isDraftView=\"context.isDraftView\"\n  let-mailboxType=\"context.mailboxType\"\n>\n  <div\n    class=\"sr-only\"\n    i18n=\"Mailbox tab of selected type is open announcement@@messages.messagesConversationsList.openTabType\"\n  >\n    { mailboxType, select, inbox {inbox} outbox {outbox} drafts {drafts} } tab is open,\n  </div>\n  <div class=\"d-md-none\">\n    <div class=\"bb-button-bar\">\n      <ng-container *ngTemplateOutlet=\"reloadBtn\"></ng-container>\n    </div>\n    <table class=\"table\" role=\"presentation\">\n      <tbody role=\"list\">\n        <tr\n          role=\"listitem\"\n          tabindex=\"0\"\n          data-role=\"conversation-mobile\"\n          *ngFor=\"let conversation of host.conversations\"\n          [ngClass]=\"{ 'table-active': !conversation.read }\"\n          (bbKeyboardClick)=\"host.callSelect($event, conversation)\"\n        >\n          <td>\n            <div\n              class=\"text-truncate text-normal bb-text-semi-bold break-word\"\n              *ngIf=\"conversation.subject; else noSubject\"\n              [innerHTML]=\"conversation.subject\"\n            ></div>\n            <div class=\"text-truncate text-small\" *ngIf=\"conversation.sender\">{{ conversation.sender.name }}</div>\n\n            <ng-template #noSubject>\n              <span\n                class=\"bb-text-support\"\n                i18n=\"No subject@@messages.messagesConversationsList.messagesTableMobile.subjectEmptyState\"\n                >No subject</span\n              >\n            </ng-template>\n          </td>\n          <td>\n            <div class=\"bb-stack\">\n              <div class=\"bb-stack__item text-small\" [attr.aria-label]=\"conversation.timestamp | date: 'mediumDate'\">\n                <span aria-hidden=\"true\">{{ conversation.timestamp | date: 'shortDate' }}</span>\n              </div>\n              <bb-icon-ui\n                *ngIf=\"conversation.important\"\n                bbTooltip=\"High priority\"\n                i18n-bbTooltip=\"High priority@@messages.messagesConversationsList.messagesTable.importantMessage\"\n                container=\"body\"\n                triggers=\"hover\"\n                placement=\"bottom\"\n                class=\"bb-stack__item\"\n                name=\"error\"\n                color=\"danger\"\n                aria-label=\"High priority\"\n                i18n-aria-label=\"@@messages.messagesConversationsList.messagesTable.importantMessage\"\n              ></bb-icon-ui>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n\n  <div class=\"d-none d-md-block\">\n    <div class=\"bb-stack\">\n      <div class=\"bb-stack__item--push-right\">\n        <ng-container *ngIf=\"host.selectedIdsArray.length; else noneSelectedTpl\">\n          <span class=\"bb-stack__item bb-text-support\">\n            <span\n              data-role=\"selected-conversations-counter\"\n              i18n=\"Selected|Selected conversations count@@messages.messagesConversationsList.selected\"\n              [attr.aria-label]=\"host.selectedIdsArray.length + ' Selected'\"\n            >\n              <span aria-hidden=\"true\">{{ host.selectedIdsArray.length + ' Selected' }}</span>\n            </span>\n          </span>\n          <span class=\"bb-stack__item bb-text-support\">|</span>\n          <a\n            data-role=\"clear-selection\"\n            href=\"#\"\n            class=\"bb-stack__item bb-text-semi-bold\"\n            i18n=\"\n              Clear Selection|Clear selection button on the top of the table\n              list@@messages.messagesConversationsList.clearSelectionButton\"\n            (click)=\"\n              $event.preventDefault(); selectionsGroupForm.reset(); host.manageSelectionForm(selectionsGroupForm)\n            \"\n            >Clear Selection</a\n          >\n          <button\n            bbButton\n            color=\"link\"\n            [circle]=\"true\"\n            data-role=\"mark-as-read-unread\"\n            i18n-aria-label=\"\n              Toggle read status@@messages.messagesConversationsList.messagesTableMobile.toggleReadStatusAriaLabel\"\n            aria-label=\"Toggle read status\"\n            i18n-bbTooltip=\"\n              Toggle read status@@messages.messagesConversationsList.messagesTable.ToggleReadStatusTooltipText\"\n            bbTooltip=\"Toggle read status\"\n            container=\"body\"\n            triggers=\"hover\"\n            *ngIf=\"!isDraftView\"\n            (click)=\"host.selectedIdsArray.length && host.markAsReadUnread()\"\n          >\n            <bb-icon-ui *ngIf=\"host.isUnread; else readIconTpl\" class=\"bb-text-support\" name=\"markunread\"> </bb-icon-ui>\n            <ng-template #readIconTpl>\n              <bb-icon-ui class=\"bb-text-support\" name=\"drafts\"></bb-icon-ui>\n            </ng-template>\n          </button>\n\n          <button\n            bbButton\n            color=\"link\"\n            data-role=\"Delete\"\n            circle=\"true\"\n            aria-label=\"Delete\"\n            i18n-aria-label=\"Delete aria-label@@messages.messagesConversationsList.deleteButtonAriaLabel\"\n            i18n=\"Delete|Delete button on the top of the table list@@messages.messagesConversationsList.deleteButton\"\n            bbTooltip=\"Delete\"\n            i18n-bbTooltip=\"\n              Delete|Delete button on the top of the table list\n              tooltip@@messages.messagesConversationsList.deleteTooltip\"\n            container=\"body\"\n            triggers=\"hover\"\n            (click)=\"host.openRemoveModal()\"\n          >\n            <bb-icon-ui class=\"bb-text-support\" name=\"delete\"></bb-icon-ui>\n          </button>\n        </ng-container>\n        <ng-template #noneSelectedTpl>\n          <span\n            aria-live=\"assertive\"\n            class=\"sr-only\"\n            data-role=\"none-selected-conversations-counter\"\n            i18n=\"None selected|None selected conversations count@@messages.messagesConversationsList.noneSelected\"\n          >\n            None selected\n          </span>\n        </ng-template>\n        <ng-container *ngIf=\"!host.selectedIdsArray.length\">\n          <ng-container *ngTemplateOutlet=\"reloadBtn\"></ng-container>\n        </ng-container>\n      </div>\n    </div>\n\n    <form #selectionsGroupForm=\"ngForm\">\n      <table class=\"table table-hover\" data-role=\"conversations-list-table\">\n        <caption class=\"sr-only\" i18n=\"Conversations@@messages.messagesConversationsList.conversationsTable\">\n          Conversations\n        </caption>\n        <thead>\n          <tr\n            bb-conversations-list-table-head-ui\n            (change)=\"host.manageSelectionForm(selectionsGroupForm)\"\n            [mailboxType]=\"mailboxType\"\n          ></tr>\n        </thead>\n        <tbody ngModelGroup=\"ids\">\n          <tr\n            [attr.aria-describedby]=\"'bb-cs-' + conversation.id\"\n            bb-conversations-list-table-row-ui\n            tabindex=\"0\"\n            id=\"bb-cs-{{ conversation.id }}\"\n            class=\"bb-messages-conversations-list-item\"\n            data-role=\"conversation\"\n            *ngFor=\"let conversation of host.conversations; trackBy: trackByFn\"\n            [mailboxType]=\"mailboxType\"\n            [conversation]=\"conversation\"\n            [isDraftView]=\"isDraftView\"\n            [customerServiceTitle$]=\"customerServiceTitle$\"\n            [ngClass]=\"{ 'table-active bb-text-semi-bold': conversation.hasOwnProperty('read') && !conversation.read }\"\n            (change)=\"host.manageSelectionForm(selectionsGroupForm)\"\n            (bbKeyboardClick)=\"host.callSelect($event, conversation)\"\n            (remove)=\"host.openRemoveModal(conversation.id)\"\n            (read)=\"host.markAsReadUnread(conversation.id, conversation.read)\"\n          ></tr>\n        </tbody>\n      </table>\n    </form>\n\n    <bb-modal-ui\n      [isOpen]=\"host.removeModalOpened\"\n      (cancel)=\"host.closeRemoveModal()\"\n      aria-describedby=\"messages-list-table-delete-conversation-modal-subtitle\"\n    >\n      <bb-modal-header-ui>\n        <ng-template bbCustomModalHeader>\n          <span\n            class=\"text-large bb-text-semi-bold\"\n            i18n=\"\n              Delete conversation(s)/draft(s)|Header title of the confirmation modal to delete conversation(s) or\n              draft(s)@@messages.messagesConversationsList.messagesDeleteModal.headerTitle\"\n            >Delete {isDraftView + '', select, true {draft(s)} false {conversation(s)}}?</span\n          >\n        </ng-template>\n      </bb-modal-header-ui>\n      <bb-modal-body-ui>\n        <ng-template bbCustomModalBody>\n          <span\n            id=\"messages-list-table-delete-conversation-modal-subtitle\"\n            i18n=\"\n              Are you sure you want to delete the selected conversation(s)?(s)|Body message of the confirmation modal to\n              delete conversation(s)@@messages.messagesConversationsList.messagesDeleteModal.bodyMessage\"\n            >Are you sure you want to delete the selected {isDraftView + '', select, true {draft(s)} false\n            {conversation(s)}}?</span\n          >\n        </ng-template>\n      </bb-modal-body-ui>\n      <bb-modal-footer-ui>\n        <ng-template bbCustomModalFooter>\n          <bb-button-ui\n            color=\"secondary\"\n            i18n=\"\n              Cancel|Cancel button inside the confirmation modal\n              footer@@messages.messagesConversationsList.messagesDeleteModal.cancelButton\"\n            (click)=\"host.closeRemoveModal()\"\n            >Cancel\n          </bb-button-ui>\n          <bb-button-ui\n            color=\"danger\"\n            i18n=\"\n              Delete|Delete button inside the confirmation modal\n              footer@@messages.messagesConversationsList.messagesDeleteModal.deleteButton\"\n            (click)=\"host.confirmRemoveModal()\"\n            >Delete\n          </bb-button-ui>\n        </ng-template>\n      </bb-modal-footer-ui>\n    </bb-modal-ui>\n  </div>\n\n  <ng-template #reloadBtn>\n    <span\n      bbTooltip=\"Refresh\"\n      i18n-bbTooltip=\"Refresh|Refresh button text@@messagesConversationsList.refreshButton\"\n      triggers=\"hover focus\"\n      placement=\"top\"\n      container=\"body\"\n    >\n      <button\n        bbButton\n        color=\"link\"\n        circle=\"true\"\n        data-role=\"refresh\"\n        aria-label=\"Refresh\"\n        i18n-aria-label=\"@@messagesConversationsList.refreshButton\"\n        (click)=\"host.callUpdate()\"\n      >\n        <bb-icon-ui class=\"bb-text-support\" name=\"loading\"></bb-icon-ui>\n      </button>\n    </span>\n  </ng-template>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i2.IconComponent; }), selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }, { type: i0.forwardRef(function () { return i3.ConversationsListTableHeadComponent; }), selector: "tr[bb-conversations-list-table-head-ui]", inputs: ["mailboxType"] }, { type: i0.forwardRef(function () { return i4.ConversationsListTableRowComponent; }), selector: "tr[bb-conversations-list-table-row-ui]", inputs: ["conversation", "isDraftView", "customerServiceTitle$", "mailboxType"], outputs: ["read", "remove"] }, { type: i0.forwardRef(function () { return i5.ModalComponent; }), selector: "bb-modal-ui", inputs: ["isOpen", "aria-labelledby", "aria-describedby", "modalOptions"], outputs: ["confirm", "cancel", "isOpenChange"] }, { type: i0.forwardRef(function () { return i5.ModalHeaderComponent; }), selector: "bb-modal-header-ui", inputs: ["title"], outputs: ["close"] }, { type: i0.forwardRef(function () { return i5.ModalBodyComponent; }), selector: "bb-modal-body-ui" }, { type: i0.forwardRef(function () { return i5.ModalFooterComponent; }), selector: "bb-modal-footer-ui", inputs: ["confirmText", "cancelText"], outputs: ["confirm", "cancel"] }, { type: i0.forwardRef(function () { return i6.ButtonComponent; }), selector: "bb-button-ui", inputs: ["autofocus", "type", "disabled", "buttonSize", "color", "block"] }], directives: [{ type: i0.forwardRef(function () { return ConversationsListTableCustomizableDirective; }), selector: "[bbConversationsListTableCustomizable]" }, { type: i0.forwardRef(function () { return i7.NgTemplateOutlet; }), selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i0.forwardRef(function () { return i7.NgForOf; }), selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i0.forwardRef(function () { return i7.NgClass; }), selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i0.forwardRef(function () { return i8.KeyboardClickDirective; }), selector: "[bbKeyboardClick]", outputs: ["bbKeyboardClick"] }, { type: i0.forwardRef(function () { return i7.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return i9.TooltipDirective; }), selector: "[bbTooltip]", inputs: ["bbTooltip", "triggers"] }, { type: i0.forwardRef(function () { return i6.ButtonDirective; }), selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i0.forwardRef(function () { return i10.ɵNgNoValidate; }), selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i0.forwardRef(function () { return i10.NgControlStatusGroup; }), selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i0.forwardRef(function () { return i10.NgForm; }), selector: "form:not([ngNoForm]):not([formGroup]),ng-form,[ngForm]", inputs: ["ngFormOptions"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i0.forwardRef(function () { return i10.NgModelGroup; }), selector: "[ngModelGroup]", inputs: ["ngModelGroup"], exportAs: ["ngModelGroup"] }, { type: i0.forwardRef(function () { return i5.CustomModalHeaderDirective; }), selector: "ng-template[bbCustomModalHeader]" }, { type: i0.forwardRef(function () { return i5.CustomModalBodyDirective; }), selector: "ng-template[bbCustomModalBody]" }, { type: i0.forwardRef(function () { return i5.CustomModalFooterDirective; }), selector: "ng-template[bbCustomModalFooter]" }], pipes: { "async": i0.forwardRef(function () { return i7.AsyncPipe; }), "date": i0.forwardRef(function () { return i7.DatePipe; }) } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: ConversationsListTableComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-conversations-list-table-ui',
                    providers: [TemplateRegistry, BaseConversationsListPropertiesService],
                    templateUrl: './conversations-list-table.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.BaseConversationsListPropertiesService }]; }, propDecorators: { conversations: [{
                type: Input
            }], reset: [{
                type: Input
            }], mailboxTypeValue: [{
                type: Input,
                args: ['mailboxType']
            }], customerServiceTitle$: [{
                type: Input
            }], select: [{
                type: Output
            }], read: [{
                type: Output
            }], remove: [{
                type: Output
            }], update: [{
                type: Output
            }] } });
export class ConversationsListTableCustomizableDirective extends BbTemplate {
}
ConversationsListTableCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: ConversationsListTableCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
ConversationsListTableCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.14", type: ConversationsListTableCustomizableDirective, selector: "[bbConversationsListTableCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: ConversationsListTableCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbConversationsListTableCustomizable]',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVyc2F0aW9ucy1saXN0LXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvbWVzc2FnZXMtY29udmVyc2F0aW9ucy1saXN0LXdpZGdldC1hbmcvc3JjL2NvbXBvbmVudHMvY29udmVyc2F0aW9ucy1saXN0LXRhYmxlL2NvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21lc3NhZ2VzLWNvbnZlcnNhdGlvbnMtbGlzdC13aWRnZXQtYW5nL3NyYy9jb21wb25lbnRzL2NvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS9jb252ZXJzYXRpb25zLWxpc3QtdGFibGUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXJHLE9BQU8sRUFBRSxlQUFlLEVBQWMsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRSxPQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsVUFBVSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFN0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNwRSxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7Ozs7Ozs7Ozs7O0FBT3JHLE1BQU0sT0FBTywrQkFBK0I7SUFzRjFDLFlBQTZCLFVBQWtEO1FBQWxELGVBQVUsR0FBVixVQUFVLENBQXdDO1FBbEQvRTs7V0FFRztRQUNPLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBcUQsQ0FB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QUUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzFGLENBQUM7O0FBbk9NLHVDQUFPLEdBQUcsQ0FBQyxDQUFDOzZIQURSLCtCQUErQjtpSEFBL0IsK0JBQStCLDZTQUgvQixDQUFDLGdCQUFnQixFQUFFLHNDQUFzQyxDQUFDLDBCQ1h2RSwreVZBMlFBLGs5Q0RuQmEsMkNBQTJDOzRGQTFPM0MsK0JBQStCO2tCQUwzQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxnQ0FBZ0M7b0JBQzFDLFNBQVMsRUFBRSxDQUFDLGdCQUFnQixFQUFFLHNDQUFzQyxDQUFDO29CQUNyRSxXQUFXLEVBQUUsMkNBQTJDO2lCQUN6RDs2SEFRSyxhQUFhO3NCQURoQixLQUFLO2dCQWdCRyxLQUFLO3NCQUFiLEtBQUs7Z0JBS29CLGdCQUFnQjtzQkFBekMsS0FBSzt1QkFBQyxhQUFhO2dCQU9YLHFCQUFxQjtzQkFBN0IsS0FBSztnQkFLSSxNQUFNO3NCQUFmLE1BQU07Z0JBS0csSUFBSTtzQkFBYixNQUFNO2dCQUtHLE1BQU07c0JBQWYsTUFBTTtnQkFLRyxNQUFNO3NCQUFmLE1BQU07O0FBb0xULE1BQU0sT0FBTywyQ0FBNEMsU0FBUSxVQUdoRTs7eUlBSFksMkNBQTJDOzZIQUEzQywyQ0FBMkM7NEZBQTNDLDJDQUEyQztrQkFIdkQsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsd0NBQXdDO2lCQUNuRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRGlyZWN0aXZlLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHRha2UsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJiVGVtcGxhdGUsIFRlbXBsYXRlUmVnaXN0cnkgfSBmcm9tICdAYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvY29yZSc7XG5pbXBvcnQgeyBDb252ZXJzYXRpb25UaHJlYWQsIE1lc3NhZ2VEcmFmdHNHZXRSZXNwb25zZUJvZHkgfSBmcm9tICdAYmFja2Jhc2UvbWVzc2FnZXMtdjUtaHR0cC1hbmcnO1xuaW1wb3J0IHsgTWFpbGJveFR5cGVFbnVtLCBSZWFkVW5yZWFkU3RhdHVzVHlwZSB9IGZyb20gJy4uLy4uL21vZGVsJztcbmltcG9ydCB7IEJhc2VDb252ZXJzYXRpb25zTGlzdFByb3BlcnRpZXNTZXJ2aWNlLCBnZXRQcm9wZXJ0eVZhbHVlIH0gZnJvbSAnQGJhY2tiYXNlL21lc3NhZ2VzLWNvbW1vbic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLWNvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS11aScsXG4gIHByb3ZpZGVyczogW1RlbXBsYXRlUmVnaXN0cnksIEJhc2VDb252ZXJzYXRpb25zTGlzdFByb3BlcnRpZXNTZXJ2aWNlXSxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIENvbnZlcnNhdGlvbnNMaXN0VGFibGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHN0YXRpYyBjb3VudGVyID0gMDtcblxuICAvKipcbiAgICogQXJyYXkgb2YgdGhlIGNvbnZlcnNhdGlvbnNcbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCBjb252ZXJzYXRpb25zKHZhbHVlOiBDb252ZXJzYXRpb25UaHJlYWRbXSkge1xuICAgIHRoaXMuX2NvbnZlcnNhdGlvbnMgPSB2YWx1ZTtcbiAgICB0aGlzLm1hbmFnZVNlbGVjdGlvbkZvcm0odGhpcy5zZWxlY3Rpb25zR3JvdXBGb3JtKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgY29udmVyc2F0aW9ucyBnZXR0ZXIuXG4gICAqL1xuICBnZXQgY29udmVyc2F0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29udmVyc2F0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnB1dCBzdHJlYW0gb2YgcmVzZXQgc2lnbmFscyB0aGF0IHdpbGwgdHJpZ2dlciBzZWxlY3Rpb24gcmVzZXRcbiAgICovXG4gIEBJbnB1dCgpIHJlc2V0OiBPYnNlcnZhYmxlPHVuZGVmaW5lZD4gfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCB0aGUgbWFpbGJveCB0eXBlLlxuICAgKi9cbiAgQElucHV0KCdtYWlsYm94VHlwZScpIHNldCBtYWlsYm94VHlwZVZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLm1haWxib3hUeXBlJCQubmV4dCh2YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHN0cmVhbSB3aXRoIHRoZSBjdXN0b21lciBzZXJ2aWNlIHRpdGxlLlxuICAgKi9cbiAgQElucHV0KCkgY3VzdG9tZXJTZXJ2aWNlVGl0bGUkITogT2JzZXJ2YWJsZTxzdHJpbmcgfCB1bmRlZmluZWQ+O1xuXG4gIC8qKlxuICAgKiBFbWl0cyBjb252ZXJzYXRpb24gb2JqZWN0IG9uIHNlbGVjdCBldmVudFxuICAgKi9cbiAgQE91dHB1dCgpIHNlbGVjdCA9IG5ldyBFdmVudEVtaXR0ZXI8Q29udmVyc2F0aW9uVGhyZWFkIHwgTWVzc2FnZURyYWZ0c0dldFJlc3BvbnNlQm9keT4oKTtcblxuICAvKipcbiAgICogRW1pdHMgaWQgb2YgdGhlIGNvbnZlcnNhdGlvbiB0aGF0IHNob3VsZCBiZSBtYXJrZWQgYXMgcmVhZC91bnJlYWRcbiAgICovXG4gIEBPdXRwdXQoKSByZWFkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBFbWl0cyBpZCBvZiB0aGUgY29udmVyc2F0aW9uIHRoYXQgc2hvdWxkIGJlIHJlbW92ZWRcbiAgICovXG4gIEBPdXRwdXQoKSByZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqXG4gICAqIEV2ZW50RW1pdHRlciB0byB1cGRhdGUgbGlzdCBvZiB0aGUgY29udmVyc2F0aW9uc1xuICAgKi9cbiAgQE91dHB1dCgpIHVwZGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBJRCBIVE1MIHByb3BlcnR5IGZvciBlYWNoIGNvbXBvbmVudCBpbnN0YW5jZS5cbiAgICovXG4gIHJlYWRvbmx5IGlkID0gYGNvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS1jb21wb25lbnQtJHtDb252ZXJzYXRpb25zTGlzdFRhYmxlQ29tcG9uZW50LmNvdW50ZXIrK31gO1xuICByZWFkb25seSBob3N0UmVmID0gdGhpcztcblxuICBwcml2YXRlIF9jb252ZXJzYXRpb25zOiBDb252ZXJzYXRpb25UaHJlYWRbXSA9IFtdO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlYWRVbnJlYWRTdGF0dXNUeXBlRGVmYXVsdDogUmVhZFVucmVhZFN0YXR1c1R5cGUgPSBSZWFkVW5yZWFkU3RhdHVzVHlwZS5SRUFEO1xuICBwcml2YXRlIHJlYWRVbnJlYWRTdGF0dXMgPSB0aGlzLnJlYWRVbnJlYWRTdGF0dXNUeXBlRGVmYXVsdDtcbiAgcHJpdmF0ZSByZW1vdmVJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHNlbGVjdGlvbnNHcm91cEZvcm06IE5nRm9ybSB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSByZWFkb25seSB1bnN1YnNjcmliZSA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgLyoqXG4gICAqIFRoZSBmbGFnIHRoYXQgdG9nZ2xlcyBiZXR3ZWVuIHRoZSBvcGVuIGFuZCBjbG9zZWQgc3RhdGUgb2YgdGhlIGNvbmZpcm1hdGlvbiBtb2RhbCBmb3IgY29udmVyc2F0aW9uIHJlbW92YWwuXG4gICAqL1xuICByZW1vdmVNb2RhbE9wZW5lZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgYXJyYXkgY29udGFpbmluZyB0aGUgSURzIG9mIHNlbGVjdGVkIGNvbnZlcnNhdGlvbnMuXG4gICAqL1xuICBzZWxlY3RlZElkc0FycmF5OiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RyZWFtIHdpdGggdGhlIGZsYWcgdG9nZ2xpbmcgYmV0d2VlbiB0aGUgZHJhZnQgYW5kIHRoZSBjb252ZXJzYXRpb24gdmlldy5cbiAgICovXG4gIGlzRHJhZnRWaWV3JCA9IG9mKGZhbHNlKTtcblxuICBwcml2YXRlIHJlYWRvbmx5IG1haWxib3hUeXBlJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZyB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByb3BlcnRpZXM6IEJhc2VDb252ZXJzYXRpb25zTGlzdFByb3BlcnRpZXNTZXJ2aWNlKSB7fVxuXG4gIHByaXZhdGUgZG9lc1BhcmVudENvbnRhaW5Ecm9wZG93bihub2RlOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEobm9kZS5wYXJlbnROb2RlICYmIG5vZGUucGFyZW50Tm9kZS5jbG9zZXN0KCcuZHJvcGRvd24nKSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5yZXNldCkge1xuICAgICAgdGhpcy5yZXNldC5waXBlKHRha2VVbnRpbCh0aGlzLnVuc3Vic2NyaWJlKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMucmVzZXRGb3JtKCkpO1xuICAgIH1cbiAgICB0aGlzLmlzRHJhZnRWaWV3JCA9IHRoaXMubWFpbGJveFR5cGUucGlwZShcbiAgICAgIHRha2UoMSksXG4gICAgICBtYXAodHlwZSA9PiB0eXBlID09PSBNYWlsYm94VHlwZUVudW0uZHJhZnRzKSxcbiAgICApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy51bnN1YnNjcmliZS5uZXh0KCk7XG4gICAgdGhpcy51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBmbGFnIGluZGljYXRpbmcgaWYgdGhlIGNvbnZlcnNhdGlvbiBpcyB1bnJlYWQuXG4gICAqL1xuICBnZXQgaXNVbnJlYWQoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhZFVucmVhZFN0YXR1cyA9PT0gUmVhZFVucmVhZFN0YXR1c1R5cGUuVU5SRUFEO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBtZXRob2QgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIGNvbnZlcnNhdGlvbnMuXG4gICAqL1xuICBjYWxsVXBkYXRlKCkge1xuICAgIHRoaXMucmVzZXRGb3JtKCk7XG4gICAgdGhpcy51cGRhdGUuZW1pdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBtZXRob2QgdG8gbWFyayBhIGNvbnZlcnNhdGlvbiBhcyBzZWxlY3RlZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IE1vdXNlIGV2ZW50XG4gICAqIEBwYXJhbSBjb252ZXJzYXRpb24gQ29udmVyc2F0aW9uIHRocmVhZCBkYXRhXG4gICAqL1xuICBjYWxsU2VsZWN0KGV2ZW50OiBNb3VzZUV2ZW50LCBjb252ZXJzYXRpb246IENvbnZlcnNhdGlvblRocmVhZCkge1xuICAgIGlmICh0aGlzLmRvZXNQYXJlbnRDb250YWluRHJvcGRvd24oZXZlbnQudGFyZ2V0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNlbGVjdC5lbWl0KGNvbnZlcnNhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG1ldGhvZCB0byBtYXJrIGEgY29udmVyc2F0aW9uIGFzIHJlYWQgb3IgdW5yZWFkLlxuICAgKlxuICAgKiBAcGFyYW0gY29udmVyc2F0aW9uSWQgQ29udmVyc2F0aW9uIGlkXG4gICAqIEBwYXJhbSBjb252ZXJzYXRpb25TdGF0dXMgQ29udmVyc2F0aW9uIHN0YXR1c1xuICAgKi9cbiAgbWFya0FzUmVhZFVucmVhZChjb252ZXJzYXRpb25JZD86IHN0cmluZywgY29udmVyc2F0aW9uU3RhdHVzPzogYm9vbGVhbikge1xuICAgIGNvbnN0IHN0YXR1czogUmVhZFVucmVhZFN0YXR1c1R5cGUgPVxuICAgICAgY29udmVyc2F0aW9uU3RhdHVzID09PSB1bmRlZmluZWRcbiAgICAgICAgPyB0aGlzLnJlYWRVbnJlYWRTdGF0dXNcbiAgICAgICAgOiBjb252ZXJzYXRpb25TdGF0dXNcbiAgICAgICAgPyBSZWFkVW5yZWFkU3RhdHVzVHlwZS5VTlJFQURcbiAgICAgICAgOiBSZWFkVW5yZWFkU3RhdHVzVHlwZS5SRUFEO1xuXG4gICAgdGhpcy5yZWFkLmVtaXQoe1xuICAgICAgc3RhdHVzLFxuICAgICAgaWRzOiBjb252ZXJzYXRpb25JZCA/IFtjb252ZXJzYXRpb25JZF0gOiB0aGlzLnNlbGVjdGVkSWRzQXJyYXksXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG1ldGhvZCB0byBvcGVuIHRoZSBjb25maXJtYXRpb24gbW9kYWwgZm9yIHJlbW92YWwuXG4gICAqXG4gICAqIEBwYXJhbSBpZCBDb252ZXJzYXRpb24gaWRcbiAgICovXG4gIG9wZW5SZW1vdmVNb2RhbChpZD86IHN0cmluZykge1xuICAgIHRoaXMucmVtb3ZlSWQgPSBpZDtcbiAgICB0aGlzLnJlbW92ZU1vZGFsT3BlbmVkID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbWV0aG9kIHRvIGNsb3NlIHRoZSBjb25maXJtYXRpb24gbW9kYWwgZm9yIHJlbW92YWwuXG4gICAqL1xuICBjbG9zZVJlbW92ZU1vZGFsKCkge1xuICAgIHRoaXMucmVtb3ZlSWQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5yZW1vdmVNb2RhbE9wZW5lZCA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBtZXRob2QgdG8gY29uZmlybSB0aGUgcmVtb3ZlIGFjdGlvbiBhbmQgY2xvc2UgdGhlIG1vZGFsLlxuICAgKi9cbiAgY29uZmlybVJlbW92ZU1vZGFsKCkge1xuICAgIHRoaXMucmVtb3ZlLmVtaXQodGhpcy5yZW1vdmVJZCA/IFt0aGlzLnJlbW92ZUlkXSA6IHRoaXMuc2VsZWN0ZWRJZHNBcnJheSk7XG5cbiAgICB0aGlzLmNsb3NlUmVtb3ZlTW9kYWwoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbWV0aG9kIHRvIHVwZGF0ZSB0aGUgc2VsZWN0ZWQgY29udmVyc2F0aW9ucyBmb3JtLlxuICAgKlxuICAgKiBAcGFyYW0gbmdGb3JtIEZvcm0gb2JqZWN0XG4gICAqL1xuICBtYW5hZ2VTZWxlY3Rpb25Gb3JtKG5nRm9ybT86IE5nRm9ybSkge1xuICAgIGlmIChuZ0Zvcm0pIHtcbiAgICAgIGNvbnN0IGlkcyA9IG5nRm9ybS5mb3JtLnZhbHVlLmlkcztcblxuICAgICAgdGhpcy5zZWxlY3Rpb25zR3JvdXBGb3JtID0gbmdGb3JtO1xuICAgICAgdGhpcy5zZWxlY3RlZElkc0FycmF5ID0gT2JqZWN0LmtleXMoaWRzKS5maWx0ZXIoaWQgPT4gaWRzW2lkXSk7XG5cbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkSWRzQXJyYXkubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSWRzSW5jbHVkZXNVbnJlYWRDb252ZXJzYXRpb24gPSB0aGlzLmNvbnZlcnNhdGlvbnMuZmluZChcbiAgICAgICAgICBjb252ZXJzYXRpb24gPT4gdGhpcy5zZWxlY3RlZElkc0FycmF5LmluY2x1ZGVzKGNvbnZlcnNhdGlvbi5pZCkgJiYgIWNvbnZlcnNhdGlvbi5yZWFkLFxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMucmVhZFVucmVhZFN0YXR1cyA9IHNlbGVjdGVkSWRzSW5jbHVkZXNVbnJlYWRDb252ZXJzYXRpb25cbiAgICAgICAgICA/IFJlYWRVbnJlYWRTdGF0dXNUeXBlLlJFQURcbiAgICAgICAgICA6IFJlYWRVbnJlYWRTdGF0dXNUeXBlLlVOUkVBRDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVhZFVucmVhZFN0YXR1cyA9IFJlYWRVbnJlYWRTdGF0dXNUeXBlLlJFQUQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBtZXRob2QgdG8gZGlmZmVyZW50aWF0ZSBjb252ZXJzYXRpb25zIGJ5IElEcyBpbiBvcmRlciB0byBvcHRpbWl6ZSBsb29wcyBwZXJmb3JtYW5jZS5cbiAgICpcbiAgICogQHBhcmFtIF9pbmRleCBJbmRleFxuICAgKiBAcGFyYW0gaXRlbSBDb252ZXJzYXRpb24gdGhyZWFkXG4gICAqIEByZXR1cm5zIENvbnZlcnNhdGlvbiB0aHJlYWQgaWRcbiAgICovXG4gIHRyYWNrQnlGbihfaW5kZXg6IG51bWJlciwgaXRlbTogQ29udmVyc2F0aW9uVGhyZWFkKTogc3RyaW5nIHtcbiAgICByZXR1cm4gaXRlbS5pZDtcbiAgfVxuXG4gIHByaXZhdGUgcmVzZXRGb3JtKCkge1xuICAgIGlmICh0aGlzLnNlbGVjdGlvbnNHcm91cEZvcm0pIHtcbiAgICAgIHRoaXMuc2VsZWN0aW9uc0dyb3VwRm9ybS5yZXNldCgpO1xuICAgICAgdGhpcy5tYW5hZ2VTZWxlY3Rpb25Gb3JtKHRoaXMuc2VsZWN0aW9uc0dyb3VwRm9ybSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IG1haWxib3hUeXBlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIGdldFByb3BlcnR5VmFsdWUodGhpcy5tYWlsYm94VHlwZSQkLmFzT2JzZXJ2YWJsZSgpLCB0aGlzLnByb3BlcnRpZXMubWFpbGJveFR5cGUpO1xuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tiYkNvbnZlcnNhdGlvbnNMaXN0VGFibGVDdXN0b21pemFibGVdJyxcbn0pXG5leHBvcnQgY2xhc3MgQ29udmVyc2F0aW9uc0xpc3RUYWJsZUN1c3RvbWl6YWJsZURpcmVjdGl2ZSBleHRlbmRzIEJiVGVtcGxhdGU8XG4gIENvbnZlcnNhdGlvbnNMaXN0VGFibGVDb21wb25lbnQsXG4gIHsgaXNEcmFmdFZpZXc6IGJvb2xlYW4gfVxuPiB7fVxuIiwiPG5nLWNvbnRhaW5lclxuICBiYkNvbnZlcnNhdGlvbnNMaXN0VGFibGVDdXN0b21pemFibGVcbiAgW2JiSG9zdFJlZl09XCJob3N0UmVmXCJcbiAgW2JiVGVtcGxhdGVDb250ZXh0XT1cIntcbiAgICBpc0RyYWZ0VmlldzogaXNEcmFmdFZpZXckIHwgYXN5bmMsXG4gICAgbWFpbGJveFR5cGU6IG1haWxib3hUeXBlIHwgYXN5bmNcbiAgfVwiXG4+PC9uZy1jb250YWluZXI+XG5cbjxuZy10ZW1wbGF0ZVxuICBiYkNvbnZlcnNhdGlvbnNMaXN0VGFibGVDdXN0b21pemFibGVcbiAgbGV0LWhvc3RcbiAgbGV0LWlzRHJhZnRWaWV3PVwiY29udGV4dC5pc0RyYWZ0Vmlld1wiXG4gIGxldC1tYWlsYm94VHlwZT1cImNvbnRleHQubWFpbGJveFR5cGVcIlxuPlxuICA8ZGl2XG4gICAgY2xhc3M9XCJzci1vbmx5XCJcbiAgICBpMThuPVwiTWFpbGJveCB0YWIgb2Ygc2VsZWN0ZWQgdHlwZSBpcyBvcGVuIGFubm91bmNlbWVudEBAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5vcGVuVGFiVHlwZVwiXG4gID5cbiAgICB7IG1haWxib3hUeXBlLCBzZWxlY3QsIGluYm94IHtpbmJveH0gb3V0Ym94IHtvdXRib3h9IGRyYWZ0cyB7ZHJhZnRzfSB9IHRhYiBpcyBvcGVuLFxuICA8L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImQtbWQtbm9uZVwiPlxuICAgIDxkaXYgY2xhc3M9XCJiYi1idXR0b24tYmFyXCI+XG4gICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwicmVsb2FkQnRuXCI+PC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gICAgPHRhYmxlIGNsYXNzPVwidGFibGVcIiByb2xlPVwicHJlc2VudGF0aW9uXCI+XG4gICAgICA8dGJvZHkgcm9sZT1cImxpc3RcIj5cbiAgICAgICAgPHRyXG4gICAgICAgICAgcm9sZT1cImxpc3RpdGVtXCJcbiAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICAgIGRhdGEtcm9sZT1cImNvbnZlcnNhdGlvbi1tb2JpbGVcIlxuICAgICAgICAgICpuZ0Zvcj1cImxldCBjb252ZXJzYXRpb24gb2YgaG9zdC5jb252ZXJzYXRpb25zXCJcbiAgICAgICAgICBbbmdDbGFzc109XCJ7ICd0YWJsZS1hY3RpdmUnOiAhY29udmVyc2F0aW9uLnJlYWQgfVwiXG4gICAgICAgICAgKGJiS2V5Ym9hcmRDbGljayk9XCJob3N0LmNhbGxTZWxlY3QoJGV2ZW50LCBjb252ZXJzYXRpb24pXCJcbiAgICAgICAgPlxuICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgY2xhc3M9XCJ0ZXh0LXRydW5jYXRlIHRleHQtbm9ybWFsIGJiLXRleHQtc2VtaS1ib2xkIGJyZWFrLXdvcmRcIlxuICAgICAgICAgICAgICAqbmdJZj1cImNvbnZlcnNhdGlvbi5zdWJqZWN0OyBlbHNlIG5vU3ViamVjdFwiXG4gICAgICAgICAgICAgIFtpbm5lckhUTUxdPVwiY29udmVyc2F0aW9uLnN1YmplY3RcIlxuICAgICAgICAgICAgPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtdHJ1bmNhdGUgdGV4dC1zbWFsbFwiICpuZ0lmPVwiY29udmVyc2F0aW9uLnNlbmRlclwiPnt7IGNvbnZlcnNhdGlvbi5zZW5kZXIubmFtZSB9fTwvZGl2PlxuXG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgI25vU3ViamVjdD5cbiAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICBjbGFzcz1cImJiLXRleHQtc3VwcG9ydFwiXG4gICAgICAgICAgICAgICAgaTE4bj1cIk5vIHN1YmplY3RAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QubWVzc2FnZXNUYWJsZU1vYmlsZS5zdWJqZWN0RW1wdHlTdGF0ZVwiXG4gICAgICAgICAgICAgICAgPk5vIHN1YmplY3Q8L3NwYW5cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICA8L3RkPlxuICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJiYi1zdGFja1wiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2tfX2l0ZW0gdGV4dC1zbWFsbFwiIFthdHRyLmFyaWEtbGFiZWxdPVwiY29udmVyc2F0aW9uLnRpbWVzdGFtcCB8IGRhdGU6ICdtZWRpdW1EYXRlJ1wiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPnt7IGNvbnZlcnNhdGlvbi50aW1lc3RhbXAgfCBkYXRlOiAnc2hvcnREYXRlJyB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxiYi1pY29uLXVpXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJjb252ZXJzYXRpb24uaW1wb3J0YW50XCJcbiAgICAgICAgICAgICAgICBiYlRvb2x0aXA9XCJIaWdoIHByaW9yaXR5XCJcbiAgICAgICAgICAgICAgICBpMThuLWJiVG9vbHRpcD1cIkhpZ2ggcHJpb3JpdHlAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QubWVzc2FnZXNUYWJsZS5pbXBvcnRhbnRNZXNzYWdlXCJcbiAgICAgICAgICAgICAgICBjb250YWluZXI9XCJib2R5XCJcbiAgICAgICAgICAgICAgICB0cmlnZ2Vycz1cImhvdmVyXCJcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ9XCJib3R0b21cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW1cIlxuICAgICAgICAgICAgICAgIG5hbWU9XCJlcnJvclwiXG4gICAgICAgICAgICAgICAgY29sb3I9XCJkYW5nZXJcIlxuICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJIaWdoIHByaW9yaXR5XCJcbiAgICAgICAgICAgICAgICBpMThuLWFyaWEtbGFiZWw9XCJAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QubWVzc2FnZXNUYWJsZS5pbXBvcnRhbnRNZXNzYWdlXCJcbiAgICAgICAgICAgICAgPjwvYmItaWNvbi11aT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgICA8L3Rib2R5PlxuICAgIDwvdGFibGU+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9XCJkLW5vbmUgZC1tZC1ibG9ja1wiPlxuICAgIDxkaXYgY2xhc3M9XCJiYi1zdGFja1wiPlxuICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YWNrX19pdGVtLS1wdXNoLXJpZ2h0XCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJob3N0LnNlbGVjdGVkSWRzQXJyYXkubGVuZ3RoOyBlbHNlIG5vbmVTZWxlY3RlZFRwbFwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW0gYmItdGV4dC1zdXBwb3J0XCI+XG4gICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJzZWxlY3RlZC1jb252ZXJzYXRpb25zLWNvdW50ZXJcIlxuICAgICAgICAgICAgICBpMThuPVwiU2VsZWN0ZWR8U2VsZWN0ZWQgY29udmVyc2F0aW9ucyBjb3VudEBAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5zZWxlY3RlZFwiXG4gICAgICAgICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiaG9zdC5zZWxlY3RlZElkc0FycmF5Lmxlbmd0aCArICcgU2VsZWN0ZWQnXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCI+e3sgaG9zdC5zZWxlY3RlZElkc0FycmF5Lmxlbmd0aCArICcgU2VsZWN0ZWQnIH19PC9zcGFuPlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImJiLXN0YWNrX19pdGVtIGJiLXRleHQtc3VwcG9ydFwiPnw8L3NwYW4+XG4gICAgICAgICAgPGFcbiAgICAgICAgICAgIGRhdGEtcm9sZT1cImNsZWFyLXNlbGVjdGlvblwiXG4gICAgICAgICAgICBocmVmPVwiI1wiXG4gICAgICAgICAgICBjbGFzcz1cImJiLXN0YWNrX19pdGVtIGJiLXRleHQtc2VtaS1ib2xkXCJcbiAgICAgICAgICAgIGkxOG49XCJcbiAgICAgICAgICAgICAgQ2xlYXIgU2VsZWN0aW9ufENsZWFyIHNlbGVjdGlvbiBidXR0b24gb24gdGhlIHRvcCBvZiB0aGUgdGFibGVcbiAgICAgICAgICAgICAgbGlzdEBAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5jbGVhclNlbGVjdGlvbkJ1dHRvblwiXG4gICAgICAgICAgICAoY2xpY2spPVwiXG4gICAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpOyBzZWxlY3Rpb25zR3JvdXBGb3JtLnJlc2V0KCk7IGhvc3QubWFuYWdlU2VsZWN0aW9uRm9ybShzZWxlY3Rpb25zR3JvdXBGb3JtKVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAgID5DbGVhciBTZWxlY3Rpb248L2FcbiAgICAgICAgICA+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgYmJCdXR0b25cbiAgICAgICAgICAgIGNvbG9yPVwibGlua1wiXG4gICAgICAgICAgICBbY2lyY2xlXT1cInRydWVcIlxuICAgICAgICAgICAgZGF0YS1yb2xlPVwibWFyay1hcy1yZWFkLXVucmVhZFwiXG4gICAgICAgICAgICBpMThuLWFyaWEtbGFiZWw9XCJcbiAgICAgICAgICAgICAgVG9nZ2xlIHJlYWQgc3RhdHVzQEBtZXNzYWdlcy5tZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0Lm1lc3NhZ2VzVGFibGVNb2JpbGUudG9nZ2xlUmVhZFN0YXR1c0FyaWFMYWJlbFwiXG4gICAgICAgICAgICBhcmlhLWxhYmVsPVwiVG9nZ2xlIHJlYWQgc3RhdHVzXCJcbiAgICAgICAgICAgIGkxOG4tYmJUb29sdGlwPVwiXG4gICAgICAgICAgICAgIFRvZ2dsZSByZWFkIHN0YXR1c0BAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5tZXNzYWdlc1RhYmxlLlRvZ2dsZVJlYWRTdGF0dXNUb29sdGlwVGV4dFwiXG4gICAgICAgICAgICBiYlRvb2x0aXA9XCJUb2dnbGUgcmVhZCBzdGF0dXNcIlxuICAgICAgICAgICAgY29udGFpbmVyPVwiYm9keVwiXG4gICAgICAgICAgICB0cmlnZ2Vycz1cImhvdmVyXCJcbiAgICAgICAgICAgICpuZ0lmPVwiIWlzRHJhZnRWaWV3XCJcbiAgICAgICAgICAgIChjbGljayk9XCJob3N0LnNlbGVjdGVkSWRzQXJyYXkubGVuZ3RoICYmIGhvc3QubWFya0FzUmVhZFVucmVhZCgpXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8YmItaWNvbi11aSAqbmdJZj1cImhvc3QuaXNVbnJlYWQ7IGVsc2UgcmVhZEljb25UcGxcIiBjbGFzcz1cImJiLXRleHQtc3VwcG9ydFwiIG5hbWU9XCJtYXJrdW5yZWFkXCI+IDwvYmItaWNvbi11aT5cbiAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSAjcmVhZEljb25UcGw+XG4gICAgICAgICAgICAgIDxiYi1pY29uLXVpIGNsYXNzPVwiYmItdGV4dC1zdXBwb3J0XCIgbmFtZT1cImRyYWZ0c1wiPjwvYmItaWNvbi11aT5cbiAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICBiYkJ1dHRvblxuICAgICAgICAgICAgY29sb3I9XCJsaW5rXCJcbiAgICAgICAgICAgIGRhdGEtcm9sZT1cIkRlbGV0ZVwiXG4gICAgICAgICAgICBjaXJjbGU9XCJ0cnVlXCJcbiAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJEZWxldGVcIlxuICAgICAgICAgICAgaTE4bi1hcmlhLWxhYmVsPVwiRGVsZXRlIGFyaWEtbGFiZWxAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QuZGVsZXRlQnV0dG9uQXJpYUxhYmVsXCJcbiAgICAgICAgICAgIGkxOG49XCJEZWxldGV8RGVsZXRlIGJ1dHRvbiBvbiB0aGUgdG9wIG9mIHRoZSB0YWJsZSBsaXN0QEBtZXNzYWdlcy5tZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0LmRlbGV0ZUJ1dHRvblwiXG4gICAgICAgICAgICBiYlRvb2x0aXA9XCJEZWxldGVcIlxuICAgICAgICAgICAgaTE4bi1iYlRvb2x0aXA9XCJcbiAgICAgICAgICAgICAgRGVsZXRlfERlbGV0ZSBidXR0b24gb24gdGhlIHRvcCBvZiB0aGUgdGFibGUgbGlzdFxuICAgICAgICAgICAgICB0b29sdGlwQEBtZXNzYWdlcy5tZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0LmRlbGV0ZVRvb2x0aXBcIlxuICAgICAgICAgICAgY29udGFpbmVyPVwiYm9keVwiXG4gICAgICAgICAgICB0cmlnZ2Vycz1cImhvdmVyXCJcbiAgICAgICAgICAgIChjbGljayk9XCJob3N0Lm9wZW5SZW1vdmVNb2RhbCgpXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8YmItaWNvbi11aSBjbGFzcz1cImJiLXRleHQtc3VwcG9ydFwiIG5hbWU9XCJkZWxldGVcIj48L2JiLWljb24tdWk+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8bmctdGVtcGxhdGUgI25vbmVTZWxlY3RlZFRwbD5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgYXJpYS1saXZlPVwiYXNzZXJ0aXZlXCJcbiAgICAgICAgICAgIGNsYXNzPVwic3Itb25seVwiXG4gICAgICAgICAgICBkYXRhLXJvbGU9XCJub25lLXNlbGVjdGVkLWNvbnZlcnNhdGlvbnMtY291bnRlclwiXG4gICAgICAgICAgICBpMThuPVwiTm9uZSBzZWxlY3RlZHxOb25lIHNlbGVjdGVkIGNvbnZlcnNhdGlvbnMgY291bnRAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3Qubm9uZVNlbGVjdGVkXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICBOb25lIHNlbGVjdGVkXG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWhvc3Quc2VsZWN0ZWRJZHNBcnJheS5sZW5ndGhcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwicmVsb2FkQnRuXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8Zm9ybSAjc2VsZWN0aW9uc0dyb3VwRm9ybT1cIm5nRm9ybVwiPlxuICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtaG92ZXJcIiBkYXRhLXJvbGU9XCJjb252ZXJzYXRpb25zLWxpc3QtdGFibGVcIj5cbiAgICAgICAgPGNhcHRpb24gY2xhc3M9XCJzci1vbmx5XCIgaTE4bj1cIkNvbnZlcnNhdGlvbnNAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QuY29udmVyc2F0aW9uc1RhYmxlXCI+XG4gICAgICAgICAgQ29udmVyc2F0aW9uc1xuICAgICAgICA8L2NhcHRpb24+XG4gICAgICAgIDx0aGVhZD5cbiAgICAgICAgICA8dHJcbiAgICAgICAgICAgIGJiLWNvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS1oZWFkLXVpXG4gICAgICAgICAgICAoY2hhbmdlKT1cImhvc3QubWFuYWdlU2VsZWN0aW9uRm9ybShzZWxlY3Rpb25zR3JvdXBGb3JtKVwiXG4gICAgICAgICAgICBbbWFpbGJveFR5cGVdPVwibWFpbGJveFR5cGVcIlxuICAgICAgICAgID48L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHkgbmdNb2RlbEdyb3VwPVwiaWRzXCI+XG4gICAgICAgICAgPHRyXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cIidiYi1jcy0nICsgY29udmVyc2F0aW9uLmlkXCJcbiAgICAgICAgICAgIGJiLWNvbnZlcnNhdGlvbnMtbGlzdC10YWJsZS1yb3ctdWlcbiAgICAgICAgICAgIHRhYmluZGV4PVwiMFwiXG4gICAgICAgICAgICBpZD1cImJiLWNzLXt7IGNvbnZlcnNhdGlvbi5pZCB9fVwiXG4gICAgICAgICAgICBjbGFzcz1cImJiLW1lc3NhZ2VzLWNvbnZlcnNhdGlvbnMtbGlzdC1pdGVtXCJcbiAgICAgICAgICAgIGRhdGEtcm9sZT1cImNvbnZlcnNhdGlvblwiXG4gICAgICAgICAgICAqbmdGb3I9XCJsZXQgY29udmVyc2F0aW9uIG9mIGhvc3QuY29udmVyc2F0aW9uczsgdHJhY2tCeTogdHJhY2tCeUZuXCJcbiAgICAgICAgICAgIFttYWlsYm94VHlwZV09XCJtYWlsYm94VHlwZVwiXG4gICAgICAgICAgICBbY29udmVyc2F0aW9uXT1cImNvbnZlcnNhdGlvblwiXG4gICAgICAgICAgICBbaXNEcmFmdFZpZXddPVwiaXNEcmFmdFZpZXdcIlxuICAgICAgICAgICAgW2N1c3RvbWVyU2VydmljZVRpdGxlJF09XCJjdXN0b21lclNlcnZpY2VUaXRsZSRcIlxuICAgICAgICAgICAgW25nQ2xhc3NdPVwieyAndGFibGUtYWN0aXZlIGJiLXRleHQtc2VtaS1ib2xkJzogY29udmVyc2F0aW9uLmhhc093blByb3BlcnR5KCdyZWFkJykgJiYgIWNvbnZlcnNhdGlvbi5yZWFkIH1cIlxuICAgICAgICAgICAgKGNoYW5nZSk9XCJob3N0Lm1hbmFnZVNlbGVjdGlvbkZvcm0oc2VsZWN0aW9uc0dyb3VwRm9ybSlcIlxuICAgICAgICAgICAgKGJiS2V5Ym9hcmRDbGljayk9XCJob3N0LmNhbGxTZWxlY3QoJGV2ZW50LCBjb252ZXJzYXRpb24pXCJcbiAgICAgICAgICAgIChyZW1vdmUpPVwiaG9zdC5vcGVuUmVtb3ZlTW9kYWwoY29udmVyc2F0aW9uLmlkKVwiXG4gICAgICAgICAgICAocmVhZCk9XCJob3N0Lm1hcmtBc1JlYWRVbnJlYWQoY29udmVyc2F0aW9uLmlkLCBjb252ZXJzYXRpb24ucmVhZClcIlxuICAgICAgICAgID48L3RyPlxuICAgICAgICA8L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Zvcm0+XG5cbiAgICA8YmItbW9kYWwtdWlcbiAgICAgIFtpc09wZW5dPVwiaG9zdC5yZW1vdmVNb2RhbE9wZW5lZFwiXG4gICAgICAoY2FuY2VsKT1cImhvc3QuY2xvc2VSZW1vdmVNb2RhbCgpXCJcbiAgICAgIGFyaWEtZGVzY3JpYmVkYnk9XCJtZXNzYWdlcy1saXN0LXRhYmxlLWRlbGV0ZS1jb252ZXJzYXRpb24tbW9kYWwtc3VidGl0bGVcIlxuICAgID5cbiAgICAgIDxiYi1tb2RhbC1oZWFkZXItdWk+XG4gICAgICAgIDxuZy10ZW1wbGF0ZSBiYkN1c3RvbU1vZGFsSGVhZGVyPlxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICBjbGFzcz1cInRleHQtbGFyZ2UgYmItdGV4dC1zZW1pLWJvbGRcIlxuICAgICAgICAgICAgaTE4bj1cIlxuICAgICAgICAgICAgICBEZWxldGUgY29udmVyc2F0aW9uKHMpL2RyYWZ0KHMpfEhlYWRlciB0aXRsZSBvZiB0aGUgY29uZmlybWF0aW9uIG1vZGFsIHRvIGRlbGV0ZSBjb252ZXJzYXRpb24ocykgb3JcbiAgICAgICAgICAgICAgZHJhZnQocylAQG1lc3NhZ2VzLm1lc3NhZ2VzQ29udmVyc2F0aW9uc0xpc3QubWVzc2FnZXNEZWxldGVNb2RhbC5oZWFkZXJUaXRsZVwiXG4gICAgICAgICAgICA+RGVsZXRlIHtpc0RyYWZ0VmlldyArICcnLCBzZWxlY3QsIHRydWUge2RyYWZ0KHMpfSBmYWxzZSB7Y29udmVyc2F0aW9uKHMpfX0/PC9zcGFuXG4gICAgICAgICAgPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgPC9iYi1tb2RhbC1oZWFkZXItdWk+XG4gICAgICA8YmItbW9kYWwtYm9keS11aT5cbiAgICAgICAgPG5nLXRlbXBsYXRlIGJiQ3VzdG9tTW9kYWxCb2R5PlxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICBpZD1cIm1lc3NhZ2VzLWxpc3QtdGFibGUtZGVsZXRlLWNvbnZlcnNhdGlvbi1tb2RhbC1zdWJ0aXRsZVwiXG4gICAgICAgICAgICBpMThuPVwiXG4gICAgICAgICAgICAgIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhlIHNlbGVjdGVkIGNvbnZlcnNhdGlvbihzKT8ocyl8Qm9keSBtZXNzYWdlIG9mIHRoZSBjb25maXJtYXRpb24gbW9kYWwgdG9cbiAgICAgICAgICAgICAgZGVsZXRlIGNvbnZlcnNhdGlvbihzKUBAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5tZXNzYWdlc0RlbGV0ZU1vZGFsLmJvZHlNZXNzYWdlXCJcbiAgICAgICAgICAgID5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoZSBzZWxlY3RlZCB7aXNEcmFmdFZpZXcgKyAnJywgc2VsZWN0LCB0cnVlIHtkcmFmdChzKX0gZmFsc2VcbiAgICAgICAgICAgIHtjb252ZXJzYXRpb24ocyl9fT88L3NwYW5cbiAgICAgICAgICA+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICA8L2JiLW1vZGFsLWJvZHktdWk+XG4gICAgICA8YmItbW9kYWwtZm9vdGVyLXVpPlxuICAgICAgICA8bmctdGVtcGxhdGUgYmJDdXN0b21Nb2RhbEZvb3Rlcj5cbiAgICAgICAgICA8YmItYnV0dG9uLXVpXG4gICAgICAgICAgICBjb2xvcj1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICBpMThuPVwiXG4gICAgICAgICAgICAgIENhbmNlbHxDYW5jZWwgYnV0dG9uIGluc2lkZSB0aGUgY29uZmlybWF0aW9uIG1vZGFsXG4gICAgICAgICAgICAgIGZvb3RlckBAbWVzc2FnZXMubWVzc2FnZXNDb252ZXJzYXRpb25zTGlzdC5tZXNzYWdlc0RlbGV0ZU1vZGFsLmNhbmNlbEJ1dHRvblwiXG4gICAgICAgICAgICAoY2xpY2spPVwiaG9zdC5jbG9zZVJlbW92ZU1vZGFsKClcIlxuICAgICAgICAgICAgPkNhbmNlbFxuICAgICAgICAgIDwvYmItYnV0dG9uLXVpPlxuICAgICAgICAgIDxiYi1idXR0b24tdWlcbiAgICAgICAgICAgIGNvbG9yPVwiZGFuZ2VyXCJcbiAgICAgICAgICAgIGkxOG49XCJcbiAgICAgICAgICAgICAgRGVsZXRlfERlbGV0ZSBidXR0b24gaW5zaWRlIHRoZSBjb25maXJtYXRpb24gbW9kYWxcbiAgICAgICAgICAgICAgZm9vdGVyQEBtZXNzYWdlcy5tZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0Lm1lc3NhZ2VzRGVsZXRlTW9kYWwuZGVsZXRlQnV0dG9uXCJcbiAgICAgICAgICAgIChjbGljayk9XCJob3N0LmNvbmZpcm1SZW1vdmVNb2RhbCgpXCJcbiAgICAgICAgICAgID5EZWxldGVcbiAgICAgICAgICA8L2JiLWJ1dHRvbi11aT5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDwvYmItbW9kYWwtZm9vdGVyLXVpPlxuICAgIDwvYmItbW9kYWwtdWk+XG4gIDwvZGl2PlxuXG4gIDxuZy10ZW1wbGF0ZSAjcmVsb2FkQnRuPlxuICAgIDxzcGFuXG4gICAgICBiYlRvb2x0aXA9XCJSZWZyZXNoXCJcbiAgICAgIGkxOG4tYmJUb29sdGlwPVwiUmVmcmVzaHxSZWZyZXNoIGJ1dHRvbiB0ZXh0QEBtZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0LnJlZnJlc2hCdXR0b25cIlxuICAgICAgdHJpZ2dlcnM9XCJob3ZlciBmb2N1c1wiXG4gICAgICBwbGFjZW1lbnQ9XCJ0b3BcIlxuICAgICAgY29udGFpbmVyPVwiYm9keVwiXG4gICAgPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBiYkJ1dHRvblxuICAgICAgICBjb2xvcj1cImxpbmtcIlxuICAgICAgICBjaXJjbGU9XCJ0cnVlXCJcbiAgICAgICAgZGF0YS1yb2xlPVwicmVmcmVzaFwiXG4gICAgICAgIGFyaWEtbGFiZWw9XCJSZWZyZXNoXCJcbiAgICAgICAgaTE4bi1hcmlhLWxhYmVsPVwiQEBtZXNzYWdlc0NvbnZlcnNhdGlvbnNMaXN0LnJlZnJlc2hCdXR0b25cIlxuICAgICAgICAoY2xpY2spPVwiaG9zdC5jYWxsVXBkYXRlKClcIlxuICAgICAgPlxuICAgICAgICA8YmItaWNvbi11aSBjbGFzcz1cImJiLXRleHQtc3VwcG9ydFwiIG5hbWU9XCJsb2FkaW5nXCI+PC9iYi1pY29uLXVpPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9zcGFuPlxuICA8L25nLXRlbXBsYXRlPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==