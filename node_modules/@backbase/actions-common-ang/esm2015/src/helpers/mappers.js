import { __rest } from "tslib";
import { DAYS_OF_WEEK, getHoursOfDay, hoursToMinutesArray } from './time.helper';
import { isEqualNumberArrays } from './utils';
export const fromHttpResponse = (body) => {
    if (body === null) {
        throw new Error('Response body not set');
    }
    return body;
};
export const secondsToMilliseconds = (seconds) => seconds * 1000;
export const actionRecipeFormItemToRequest = (_a) => {
    var { id, name, amount, actions, recurrence } = _a, restActionRecipe = __rest(_a, ["id", "name", "amount", "actions", "recurrence"]);
    return (Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, restActionRecipe), (id && { id })), (name && { name })), { amount: (amount === null || amount === void 0 ? void 0 : amount.amount) || '0' }), (Object.keys(notificationRecurrenceFormValueToRequest(recurrence)).length && {
        recurrence: notificationRecurrenceFormValueToRequest(recurrence),
    })), { actions: notificationChannelsFormValueToRequest(actions) }));
};
export const parseActionRecipeFormItem = (_a) => {
    var { id, name, amount, actions, recurrence } = _a, restActionRecipe = __rest(_a, ["id", "name", "amount", "actions", "recurrence"]);
    return (Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, restActionRecipe), (id && { id })), (name && { name })), { amount: amount.amount || '0', actions: parseNotificationChannelsFormValue(actions) }), (Object.keys(notificationRecurrenceFormValueToRequest(recurrence)).length && {
        recurrence: notificationRecurrenceFormValueToRequest(recurrence),
    })));
};
export const arrangementActionRecipeToRequest = (arrangementId) => (actionRecipeFormItemValue) => (Object.assign({ arrangementId }, actionRecipeFormItemToRequest(actionRecipeFormItemValue)));
export const mergeNotificationChannels = (channels, defaultChannels) => channels
    ? channels.map(channel => (Object.assign(Object.assign({}, channel), { enabled: defaultChannels.some(({ type }) => type === channel.type) })))
    : [];
export const mergeSpecificationsWithActionRecipes = (specs, recipes) => specs.reduce((prev, specification) => (Object.assign(Object.assign({}, prev), { [specification.id]: {
        specification,
        actionRecipe: recipes.find(({ specificationId }) => specificationId === specification.id),
    } })), {});
export const getMappedRecurrenceResponse = (responseRecurrence, { recurrence: cachedRecurrence }) => (Object.assign(Object.assign({}, responseRecurrence), { hoursOfDay: getCachedHoursOfDay(responseRecurrence, cachedRecurrence) }));
const notificationChannelsFormValueToRequest = (channels) => Object.keys(channels)
    .filter(key => channels[key])
    .map(type => ({ type }));
const notificationRecurrenceFormValueToRequest = (rec) => (Object.assign(Object.assign({}, (((rec === null || rec === void 0 ? void 0 : rec.scheduleTime.length) || 0) !== 0 && { hoursOfDay: getHoursOfDay(rec === null || rec === void 0 ? void 0 : rec.scheduleTime) })), (((rec === null || rec === void 0 ? void 0 : rec.scheduleTime.length) || 0) !== 0 && { daysOfWeek: (rec === null || rec === void 0 ? void 0 : rec.daysOfWeek) || DAYS_OF_WEEK })));
const parseNotificationChannelsFormValue = (channels) => Object.keys(channels).map(type => ({
    type,
    enabled: channels[type],
}));
const getCachedHoursOfDay = (responseRecurrence, cachedRecurrence) => {
    if (!(cachedRecurrence === null || cachedRecurrence === void 0 ? void 0 : cachedRecurrence.scheduleTime)) {
        return responseRecurrence.hoursOfDay;
    }
    if (!isEqualNumberArrays(cachedRecurrence.scheduleTime.slice(0), hoursToMinutesArray(responseRecurrence.hoursOfDay))) {
        return responseRecurrence.hoursOfDay;
    }
    return cachedRecurrence.scheduleTime.map(minutes => String(minutes / 60));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwcGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYWN0aW9ucy1jb21tb24tYW5nL3NyYy9oZWxwZXJzL21hcHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQWVBLE9BQU8sRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLG1CQUFtQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUU5QyxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFJLElBQWMsRUFBSyxFQUFFO0lBQ3ZELElBQUksSUFBSSxLQUFLLElBQUksRUFBRTtRQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7S0FDMUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLENBQUMsT0FBZSxFQUFFLEVBQUUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0FBRXpFLE1BQU0sQ0FBQyxNQUFNLDZCQUE2QixHQUFHLENBQUMsRUFPbEIsRUFBZSxFQUFFO1FBUEMsRUFDNUMsRUFBRSxFQUNGLElBQUksRUFDSixNQUFNLEVBQ04sT0FBTyxFQUNQLFVBQVUsT0FFZ0IsRUFEdkIsZ0JBQWdCLGNBTnlCLGlEQU83QyxDQURvQjtJQUN5QixPQUFBLHlGQUN6QyxnQkFBZ0IsR0FDaEIsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUNkLENBQUMsSUFBSSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsS0FDckIsTUFBTSxFQUFFLENBQUEsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLE1BQU0sS0FBSSxHQUFHLEtBQzFCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSTtRQUM5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RUFBRSxDQUFDLENBQWlCLENBQUM7QUFDNUYsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWN0aW9uUGFyZW50LFxuICBBY3Rpb25SZWNpcGVTcGVjaWZpY2F0aW9uLFxuICBCYXRjaFJlY2lwZSxcbiAgQWN0aW9uLFxuICBSZWN1cnJlbmNlLFxuICBIb3Vyc09mRGF5LFxufSBmcm9tICdAYmFja2Jhc2UvZGF0YS1hbmcvYWN0aW9ucyc7XG5pbXBvcnQgeyBTcGVjaWZpY2F0aW9uc1dpdGhBY3Rpb24gfSBmcm9tICcuLi9tb2RlbHMvc3BlY2lmaWNhdGlvbnMtd2l0aC1hY3Rpb24ubW9kZWwnO1xuaW1wb3J0IHtcbiAgQWN0aW9uUmVjaXBlQ2hhbm5lbHNGb3JtVmFsdWUsXG4gIEFjdGlvblJlY2lwZUZvcm1JdGVtVmFsdWUsXG4gIEFjdGlvblJlY3VycmVuY2VGb3JtVmFsdWUsXG59IGZyb20gJy4uL21vZGVscy9hY3Rpb24tcmVjaXBlcy1mb3JtLXZhbHVlLm1vZGVsJztcbmltcG9ydCB7IEFjdGlvblJlY2lwZUl0ZW0gfSBmcm9tICcuLi9tb2RlbHMvYWN0aW9uLXJlY2lwZS1pdGVtLm1vZGVsJztcbmltcG9ydCB7IERBWVNfT0ZfV0VFSywgZ2V0SG91cnNPZkRheSwgaG91cnNUb01pbnV0ZXNBcnJheSB9IGZyb20gJy4vdGltZS5oZWxwZXInO1xuaW1wb3J0IHsgaXNFcXVhbE51bWJlckFycmF5cyB9IGZyb20gJy4vdXRpbHMnO1xuXG5leHBvcnQgY29uc3QgZnJvbUh0dHBSZXNwb25zZSA9IDxUPihib2R5OiBUIHwgbnVsbCk6IFQgPT4ge1xuICBpZiAoYm9keSA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUmVzcG9uc2UgYm9keSBub3Qgc2V0Jyk7XG4gIH1cblxuICByZXR1cm4gYm9keTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZWNvbmRzVG9NaWxsaXNlY29uZHMgPSAoc2Vjb25kczogbnVtYmVyKSA9PiBzZWNvbmRzICogMTAwMDtcblxuZXhwb3J0IGNvbnN0IGFjdGlvblJlY2lwZUZvcm1JdGVtVG9SZXF1ZXN0ID0gKHtcbiAgaWQsXG4gIG5hbWUsXG4gIGFtb3VudCxcbiAgYWN0aW9ucyxcbiAgcmVjdXJyZW5jZSxcbiAgLi4ucmVzdEFjdGlvblJlY2lwZVxufTogQWN0aW9uUmVjaXBlRm9ybUl0ZW1WYWx1ZSk6IEJhdGNoUmVjaXBlID0+ICh7XG4gIC4uLnJlc3RBY3Rpb25SZWNpcGUsXG4gIC4uLihpZCAmJiB7IGlkIH0pLFxuICAuLi4obmFtZSAmJiB7IG5hbWUgfSksXG4gIGFtb3VudDogYW1vdW50Py5hbW91bnQgfHwgJzAnLFxuICAuLi4oT2JqZWN0LmtleXMobm90aWZpY2F0aW9uUmVjdXJyZW5jZUZvcm1WYWx1ZVRvUmVxdWVzdChyZWN1cnJlbmNlKSkubGVuZ3RoICYmIHtcbiAgICByZWN1cnJlbmNlOiBub3RpZmljYXRpb25SZWN1cnJlbmNlRm9ybVZhbHVlVG9SZXF1ZXN0KHJlY3VycmVuY2UpLFxuICB9KSxcbiAgYWN0aW9uczogbm90aWZpY2F0aW9uQ2hhbm5lbHNGb3JtVmFsdWVUb1JlcXVlc3QoYWN0aW9ucyksXG59KTtcblxuZXhwb3J0IGNvbnN0IHBhcnNlQWN0aW9uUmVjaXBlRm9ybUl0ZW0gPSAoe1xuICBpZCxcbiAgbmFtZSxcbiAgYW1vdW50LFxuICBhY3Rpb25zLFxuICByZWN1cnJlbmNlLFxuICAuLi5yZXN0QWN0aW9uUmVjaXBlXG59OiBBY3Rpb25SZWNpcGVGb3JtSXRlbVZhbHVlKTogQWN0aW9uUmVjaXBlSXRlbSA9PiAoe1xuICAuLi5yZXN0QWN0aW9uUmVjaXBlLFxuICAuLi4oaWQgJiYgeyBpZCB9KSxcbiAgLi4uKG5hbWUgJiYgeyBuYW1lIH0pLFxuICBhbW91bnQ6IGFtb3VudC5hbW91bnQgfHwgJzAnLFxuICBhY3Rpb25zOiBwYXJzZU5vdGlmaWNhdGlvbkNoYW5uZWxzRm9ybVZhbHVlKGFjdGlvbnMpLFxuICAuLi4oT2JqZWN0LmtleXMobm90aWZpY2F0aW9uUmVjdXJyZW5jZUZvcm1WYWx1ZVRvUmVxdWVzdChyZWN1cnJlbmNlKSkubGVuZ3RoICYmIHtcbiAgICByZWN1cnJlbmNlOiBub3RpZmljYXRpb25SZWN1cnJlbmNlRm9ybVZhbHVlVG9SZXF1ZXN0KHJlY3VycmVuY2UpLFxuICB9KSxcbn0pO1xuXG5leHBvcnQgY29uc3QgYXJyYW5nZW1lbnRBY3Rpb25SZWNpcGVUb1JlcXVlc3QgPVxuICAoYXJyYW5nZW1lbnRJZDogc3RyaW5nKSA9PlxuICAoYWN0aW9uUmVjaXBlRm9ybUl0ZW1WYWx1ZTogQWN0aW9uUmVjaXBlRm9ybUl0ZW1WYWx1ZSk6IEJhdGNoUmVjaXBlID0+ICh7XG4gICAgYXJyYW5nZW1lbnRJZCxcbiAgICAuLi5hY3Rpb25SZWNpcGVGb3JtSXRlbVRvUmVxdWVzdChhY3Rpb25SZWNpcGVGb3JtSXRlbVZhbHVlKSxcbiAgfSk7XG5cbmV4cG9ydCBjb25zdCBtZXJnZU5vdGlmaWNhdGlvbkNoYW5uZWxzID0gKGNoYW5uZWxzOiBBY3Rpb25QYXJlbnRbXSwgZGVmYXVsdENoYW5uZWxzOiBBY3Rpb25QYXJlbnRbXSk6IEFjdGlvbltdID0+XG4gIGNoYW5uZWxzXG4gICAgPyBjaGFubmVscy5tYXAoY2hhbm5lbCA9PiAoe1xuICAgICAgICAuLi5jaGFubmVsLFxuICAgICAgICBlbmFibGVkOiBkZWZhdWx0Q2hhbm5lbHMuc29tZSgoeyB0eXBlIH0pID0+IHR5cGUgPT09IGNoYW5uZWwudHlwZSksXG4gICAgICB9KSlcbiAgICA6IFtdO1xuXG5leHBvcnQgY29uc3QgbWVyZ2VTcGVjaWZpY2F0aW9uc1dpdGhBY3Rpb25SZWNpcGVzID0gKFxuICBzcGVjczogQWN0aW9uUmVjaXBlU3BlY2lmaWNhdGlvbltdLFxuICByZWNpcGVzOiBBY3Rpb25SZWNpcGVJdGVtW10sXG4pOiBTcGVjaWZpY2F0aW9uc1dpdGhBY3Rpb24gPT5cbiAgc3BlY3MucmVkdWNlKFxuICAgIChwcmV2LCBzcGVjaWZpY2F0aW9uKSA9PiAoe1xuICAgICAgLi4ucHJldixcbiAgICAgIFtzcGVjaWZpY2F0aW9uLmlkIGFzIHN0cmluZ106IHtcbiAgICAgICAgc3BlY2lmaWNhdGlvbixcbiAgICAgICAgYWN0aW9uUmVjaXBlOiByZWNpcGVzLmZpbmQoKHsgc3BlY2lmaWNhdGlvbklkIH0pID0+IHNwZWNpZmljYXRpb25JZCA9PT0gc3BlY2lmaWNhdGlvbi5pZCksXG4gICAgICB9LFxuICAgIH0pLFxuICAgIHt9IGFzIFNwZWNpZmljYXRpb25zV2l0aEFjdGlvbixcbiAgKTtcblxuZXhwb3J0IGNvbnN0IGdldE1hcHBlZFJlY3VycmVuY2VSZXNwb25zZSA9IChcbiAgcmVzcG9uc2VSZWN1cnJlbmNlOiBSZWN1cnJlbmNlLFxuICB7IHJlY3VycmVuY2U6IGNhY2hlZFJlY3VycmVuY2UgfTogQWN0aW9uUmVjaXBlRm9ybUl0ZW1WYWx1ZSxcbik6IFJlY3VycmVuY2UgPT4gKHtcbiAgLi4ucmVzcG9uc2VSZWN1cnJlbmNlLFxuICBob3Vyc09mRGF5OiBnZXRDYWNoZWRIb3Vyc09mRGF5KHJlc3BvbnNlUmVjdXJyZW5jZSwgY2FjaGVkUmVjdXJyZW5jZSksXG59KTtcblxuY29uc3Qgbm90aWZpY2F0aW9uQ2hhbm5lbHNGb3JtVmFsdWVUb1JlcXVlc3QgPSAoY2hhbm5lbHM6IEFjdGlvblJlY2lwZUNoYW5uZWxzRm9ybVZhbHVlKTogQWN0aW9uUGFyZW50W10gPT5cbiAgT2JqZWN0LmtleXMoY2hhbm5lbHMpXG4gICAgLmZpbHRlcihrZXkgPT4gY2hhbm5lbHNba2V5XSlcbiAgICAubWFwKHR5cGUgPT4gKHsgdHlwZSB9KSk7XG5cbmNvbnN0IG5vdGlmaWNhdGlvblJlY3VycmVuY2VGb3JtVmFsdWVUb1JlcXVlc3QgPSAocmVjPzogQWN0aW9uUmVjdXJyZW5jZUZvcm1WYWx1ZSk6IFJlY3VycmVuY2UgPT4gKHtcbiAgLi4uKChyZWM/LnNjaGVkdWxlVGltZS5sZW5ndGggfHwgMCkgIT09IDAgJiYgeyBob3Vyc09mRGF5OiBnZXRIb3Vyc09mRGF5KHJlYz8uc2NoZWR1bGVUaW1lKSB9KSxcbiAgLi4uKChyZWM/LnNjaGVkdWxlVGltZS5sZW5ndGggfHwgMCkgIT09IDAgJiYgeyBkYXlzT2ZXZWVrOiByZWM/LmRheXNPZldlZWsgfHwgREFZU19PRl9XRUVLIH0pLFxufSk7XG5cbmNvbnN0IHBhcnNlTm90aWZpY2F0aW9uQ2hhbm5lbHNGb3JtVmFsdWUgPSAoY2hhbm5lbHM6IEFjdGlvblJlY2lwZUNoYW5uZWxzRm9ybVZhbHVlKTogQWN0aW9uW10gPT5cbiAgT2JqZWN0LmtleXMoY2hhbm5lbHMpLm1hcCh0eXBlID0+ICh7XG4gICAgdHlwZSxcbiAgICBlbmFibGVkOiBjaGFubmVsc1t0eXBlXSxcbiAgfSkpO1xuXG5jb25zdCBnZXRDYWNoZWRIb3Vyc09mRGF5ID0gKFxuICByZXNwb25zZVJlY3VycmVuY2U6IFJlY3VycmVuY2UsXG4gIGNhY2hlZFJlY3VycmVuY2U6IEFjdGlvblJlY3VycmVuY2VGb3JtVmFsdWUgfCB1bmRlZmluZWQsXG4pOiBIb3Vyc09mRGF5W10gfCB1bmRlZmluZWQgPT4ge1xuICBpZiAoIWNhY2hlZFJlY3VycmVuY2U/LnNjaGVkdWxlVGltZSkge1xuICAgIHJldHVybiByZXNwb25zZVJlY3VycmVuY2UuaG91cnNPZkRheTtcbiAgfVxuICBpZiAoXG4gICAgIWlzRXF1YWxOdW1iZXJBcnJheXMoY2FjaGVkUmVjdXJyZW5jZS5zY2hlZHVsZVRpbWUuc2xpY2UoMCksIGhvdXJzVG9NaW51dGVzQXJyYXkocmVzcG9uc2VSZWN1cnJlbmNlLmhvdXJzT2ZEYXkpKVxuICApIHtcbiAgICByZXR1cm4gcmVzcG9uc2VSZWN1cnJlbmNlLmhvdXJzT2ZEYXk7XG4gIH1cblxuICByZXR1cm4gY2FjaGVkUmVjdXJyZW5jZS5zY2hlZHVsZVRpbWUubWFwKG1pbnV0ZXMgPT4gU3RyaW5nKG1pbnV0ZXMgLyA2MCkpIGFzIEhvdXJzT2ZEYXlbXTtcbn07XG4iXX0=