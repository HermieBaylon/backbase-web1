import { ChangeDetectionStrategy, Component, ContentChild, Directive, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Input, Output, TemplateRef, ViewChild, } from '@angular/core';
import { NgbDropdown, NgbDropdownToggle } from '@ng-bootstrap/ng-bootstrap';
import { getKeyCode, KEY_CODES, getDynamicId } from '@backbase/ui-ang/util';
import { COUNT_OF_ELEMENTS_TO_SHOW_IN_THE_DROPDOWN_LIST, DROPDOWN_MENU_MIN_INDENT_TO_HORIZONTAL_AXIS, } from './constants/dropdown-menu.constants';
import { DOCUMENT } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/ui-ang/services";
import * as i2 from "@backbase/foundation-ang/core";
import * as i3 from "@backbase/ui-ang/icon";
import * as i4 from "@ng-bootstrap/ng-bootstrap";
import * as i5 from "@backbase/ui-ang/button";
import * as i6 from "@angular/common";
export class DropdownMenuItemDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
}
DropdownMenuItemDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMenuItemDirective, deps: [{ token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });
DropdownMenuItemDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: DropdownMenuItemDirective, selector: "ng-template[bbDropdownMenuItem]", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMenuItemDirective, decorators: [{
            type: Directive,
            args: [{ selector: 'ng-template[bbDropdownMenuItem]' }]
        }], ctorParameters: function () { return [{ type: i0.TemplateRef }]; } });
export class DropdownLabelDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
}
DropdownLabelDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownLabelDirective, deps: [{ token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });
DropdownLabelDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: DropdownLabelDirective, selector: "ng-template[bbDropdownLabel]", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownLabelDirective, decorators: [{
            type: Directive,
            args: [{ selector: 'ng-template[bbDropdownLabel]' }]
        }], ctorParameters: function () { return [{ type: i0.TemplateRef }]; } });
export class DropdownMenuToken {
}
/**
 * @name DropdownMenuComponent
 *
 * @description
 * Component that displays a button with a dropdown
 *
 * @a11y dropDownButtonLabel is discernible text for dropdown button.
 *
 * `aria-owns` handles contextual relationship between a parent and its child elements,
 * in this case between dropdown menu and dropdown items, it's internally handled by the component with unique ids.
 *
 * `aria-activedescendant` identifies currently active element of dropdown item. It's internally handled but
 * when `bbDropdownMenuItem`directive and [role=menuitem] is used for listing dropdown elements
 * then use [id]="option". Example:
 * ```
  <ng-template bbDropdownMenuItem>
    <button role="menuitem" [id]="option" class="dropdown-item" *ngFor="let option of [1,2,3]">
      {{ option}}
   </button>
  </ng-template>
 ```
 */
// @dynamic (to suppress error with resolving Document type during compilation)
export class DropdownMenuComponent extends DropdownMenuToken {
    constructor(domAttrService, elem, renderer, deprecationsService, cdr, document) {
        super();
        this.domAttrService = domAttrService;
        this.elem = elem;
        this.renderer = renderer;
        this.deprecationsService = deprecationsService;
        this.cdr = cdr;
        this.document = document;
        this.keyActionsConfig = [
            {
                predicate: (key) => key === KEY_CODES.DOWN,
                resolver: (event, itemList) => {
                    event.preventDefault();
                    if (this.focusedItemIndex === undefined) {
                        this.focusedItemIndex = 0;
                        this.focusListItem(itemList);
                        return;
                    }
                    if (this.focusedItemIndex < itemList.length - 1) {
                        this.focusedItemIndex = this.focusedItemIndex + 1;
                    }
                    this.focusListItem(itemList);
                },
            },
            {
                predicate: (key) => key === KEY_CODES.UP,
                resolver: (event, itemList) => {
                    event.preventDefault();
                    if (this.focusedItemIndex === undefined) {
                        this.focusedItemIndex = 0;
                        this.focusListItem(itemList);
                        return;
                    }
                    if (this.focusedItemIndex > 0) {
                        this.focusedItemIndex = this.focusedItemIndex - 1;
                    }
                    this.focusListItem(itemList);
                },
            },
            {
                predicate: (key) => key === KEY_CODES.SPACE || key === KEY_CODES.ENTER,
                resolver: (event) => {
                    event.preventDefault();
                    // eslint-disable-next-line @typescript-eslint/no-unused-expressions
                    this.dropdownDir && this.dropdownDir.close();
                    if (this.dropDownToggle) {
                        this.dropDownToggle.nativeElement.focus();
                    }
                },
            },
            {
                predicate: (key) => key === KEY_CODES.TAB,
                resolver: (event, itemList) => {
                    if (this.isDropDownOpen() && this.focusedItemIndex === undefined) {
                        if (event.shiftKey) {
                            this.closeDropDown();
                        }
                        else {
                            event.preventDefault();
                            this.focusedItemIndex = 0;
                            this.focusListItem(itemList);
                        }
                        return;
                    }
                    if (this.isFirstListItemInFocus(itemList) && event.shiftKey) {
                        event.preventDefault();
                        this.focusToggle();
                        this.focusedItemIndex = undefined;
                        return;
                    }
                    if (this.isLastListItemInFocus(itemList) && !event.shiftKey) {
                        this.focusToggle();
                        this.closeDropDown();
                        this.focusedItemIndex = undefined;
                        return;
                    }
                    if (this.focusedItemIndex !== undefined) {
                        this.focusedItemIndex = event.shiftKey ? this.focusedItemIndex - 1 : this.focusedItemIndex + 1;
                    }
                },
            },
        ];
        this.dropdownContainerAdjustedMaxHeight = 0;
        this.ariaActivedescendant = null;
        this.dropdownId = getDynamicId() + '_dropdown_menu';
        /**
         * The label for the button dropdown. Defaults to an empty string.
         */
        this.label = '';
        /**
         * The disabled state for the button dropdown. Defaults to false.
         */
        this.disabled = false;
        /**
         * If the value is an object, please provide a optionLabelKey.
         */
        this.options = [];
        /**
         * Event (Output) that emits the value of selected dropdown item.
         */
        this.select = new EventEmitter();
        /**
         * The size of the icon to be displayed. Defaults to md.
         */
        this.iconSize = 'md';
        /**
         * Color of the button. Defaults to primary.
         */
        this.btnColor = 'primary';
        /**
         * The flag to indicate whether the dropdown button should be in a circular shape. Defaults to 'false'.
         * This will only work when there's only an icon inside the button without a text.
         */
        this.btnCircle = false;
        /**
         * If true it will stretch the button inside to 100% width
         */
        this.fullWidth = false;
        /**
         * Whether the dropdown should be closed when clicking one of dropdown items or pressing ESC
         */
        this.autoClose = true;
        /**
         * Specifies which element the dropdown should be appended to.
         */
        this.container = '';
        /**
         * The position of the dropdown. Defaults to bottom-right.
         */
        this.position = 'bottom-right';
        /**
         * The role of the dropdown menu defaults to menu
         */
        this.dropDownMenuRole = 'menu';
        /**
         * Predefined button sizes
         */
        this.buttonSize = 'md';
        /**
         * Dropdown menu (toggle) button aria label
         */
        // todo add translation when adding default value
        this.dropDownButtonLabel = '';
        /**
         * Count of elements which is used in showing elements in the dropdown list.
         */
        this.visibleElementDependingOnViewport = COUNT_OF_ELEMENTS_TO_SHOW_IN_THE_DROPDOWN_LIST;
        /**
         * Add role=group onto host
         */
        this.role = 'group';
        this.window = this.document.defaultView;
    }
    ngOnInit() {
        // the buttons size will be set from the group size
        if (this.elem.nativeElement.parentElement.className.indexOf('btn-group-sm') > -1) {
            this.buttonSize = 'sm';
        }
    }
    ngAfterViewInit() {
        this.domAttrService.moveAriaAttributes(this.elem.nativeElement, this.buttonEl && this.buttonEl.nativeElement, this.renderer);
        const itemList = this.getItemList();
        if (itemList) {
            this.setItemsTabIndex(itemList);
        }
    }
    /**
     * Internal handler for clicks on dropdown items
     *
     * @param event Event
     * @param item Item that has been clicked
     */
    onClick(event, item) {
        event.preventDefault();
        this.select.emit(item);
    }
    /**
     * Drop down change state event handler
     *
     * @param isOpen
     */
    onOpenChange(isOpen) {
        if (isOpen) {
            this.adjustDropdownListToViewport();
        }
        else {
            this.focusedItemIndex = undefined;
            if (this.buttonEl) {
                this.ariaActivedescendant = null;
            }
        }
    }
    /**
     * Function that returns the label of the dropdown item
     *
     * @param option Item that has been clicked
     * @param labelKey Key that contains the label of the option object
     */
    getOptionLabel(option) {
        return this.optionLabelKey && typeof option === 'object' ? option[this.optionLabelKey] : option;
    }
    onKeyUp(event) {
        if (!this.isDropDownOpen()) {
            return;
        }
        const itemList = this.getItemList();
        if (!itemList) {
            return;
        }
        this.setItemsTabIndex(itemList);
        const config = this.keyActionsConfig.find((cv) => cv.predicate(getKeyCode(event)));
        if (config) {
            config.resolver(event, itemList);
        }
        const selectedItem = this.getSelectedItem(itemList);
        if (this.buttonEl && this.isDropDownOpen() && selectedItem) {
            this.ariaActivedescendant = selectedItem.id;
        }
    }
    isLastListItemInFocus(itemList) {
        return document.activeElement === itemList.item(itemList.length - 1);
    }
    isFirstListItemInFocus(itemList) {
        return document.activeElement === itemList.item(0);
    }
    focusToggle() {
        if (this.dropDownToggle) {
            this.dropDownToggle.nativeElement.focus();
        }
    }
    closeDropDown() {
        if (this.dropdownDir) {
            this.dropdownDir.close();
        }
    }
    isDropDownOpen() {
        return Boolean(this.dropdownDir && this.dropdownDir.isOpen());
    }
    getItemList() {
        var _a, _b, _c;
        //TODO: don't access private API
        return (_c = (_b = (_a = this.dropdownDir) === null || _a === void 0 ? void 0 : _a['_menu']) === null || _b === void 0 ? void 0 : _b.nativeElement) === null || _c === void 0 ? void 0 : _c.querySelectorAll('[role=menuitem]');
    }
    setItemsTabIndex(itemList) {
        Array.prototype.forEach.call(itemList, (cv) => {
            this.renderer.setAttribute(cv, 'tabindex', '0');
        });
    }
    focusListItem(itemList) {
        const item = this.getSelectedItem(itemList);
        if (item) {
            item.focus();
        }
    }
    getSelectedItem(itemList) {
        let item;
        if (itemList) {
            // @ts-ignore
            item = itemList.item(this.focusedItemIndex);
        }
        return item;
    }
    adjustDropdownListToViewport() {
        if (!this.doElementsExist()) {
            return;
        }
        this.dropdownContainerAdjustedMaxHeight = 0;
        setTimeout(() => {
            this.defineAdjustedDropdownMenuHeight();
            this.cdr.detectChanges();
        }, 0);
    }
    defineAdjustedDropdownMenuHeight() {
        var _a, _b, _c, _d;
        this.dropdownMenuItemHeight = this.customDropdownMenuItem
            ? ((_a = this.dropdownMenuInnerContainer) === null || _a === void 0 ? void 0 : _a.nativeElement.firstChild).clientHeight
            : (_b = this.dropdownListElement) === null || _b === void 0 ? void 0 : _b.nativeElement.offsetHeight;
        if (!this.dropdownMenuItemHeight) {
            this.clearStyles();
            return;
        }
        // The min height of dropdown container list started from height of 1 element;
        let heightOfAllDropdownItems = this.dropdownMenuItemHeight;
        let containerHeightOfDropdownItems = (((_c = this.dropdownMenuContainer) === null || _c === void 0 ? void 0 : _c.nativeElement.offsetHeight) || 0) + heightOfAllDropdownItems;
        this.defineMaxDropdownContainerHeight();
        const iterationsForIncreasingHeight = Math.min(this.visibleElementDependingOnViewport, 
        // when we pass custom template items, this.options.length can be 0;
        this.options.length || ((_d = this.dropdownMenuInnerContainer) === null || _d === void 0 ? void 0 : _d.nativeElement.childNodes.length));
        for (let i = 1; i < iterationsForIncreasingHeight &&
            // here we should avoid redundant increasing;
            containerHeightOfDropdownItems + this.dropdownMenuItemHeight <= Number(this.dropdownContainerMaxHeight); i++) {
            heightOfAllDropdownItems += this.dropdownMenuItemHeight;
            containerHeightOfDropdownItems += this.dropdownMenuItemHeight;
        }
        this.dropdownContainerAdjustedMaxHeight = heightOfAllDropdownItems;
    }
    defineMaxDropdownContainerHeight() {
        if (!this.window || !this.dropDownToggle)
            return;
        const relativeIndent = DROPDOWN_MENU_MIN_INDENT_TO_HORIZONTAL_AXIS;
        const viewportHeight = this.window.innerHeight;
        const { bottom, top } = this.dropDownToggle.nativeElement.getBoundingClientRect();
        this.dropdownContainerMaxHeight = this.dropdownMenuItemHeight;
        if (this.position.includes('bottom')) {
            const viewportIndent = Math.floor(viewportHeight * relativeIndent);
            const boundingHeight = viewportHeight - bottom;
            // we should include a viewport indent because dropdownContainerMaxHeight must not overlap window.
            this.dropdownContainerMaxHeight = boundingHeight - viewportIndent;
        }
        if (this.position === 'left' || this.position === 'right') {
            const offsetDifference = top + bottom - viewportHeight;
            // here we should calculate the smallest offset between top and bottom because dropdown list renders at middle;
            const offset = offsetDifference <= 0 ? top : viewportHeight - bottom;
            // here we multiply by 2 because left or right position renders dropdown list at middle;
            this.dropdownContainerMaxHeight = Math.floor(2 * offset * (1 - relativeIndent));
        }
        if (this.position.includes('top')) {
            this.dropdownContainerMaxHeight = Math.floor(top * (1 - relativeIndent));
        }
        if (this.position === 'auto') {
            // auto calculates the most suitable position that`s why it is enough to set wider limitations;
            this.dropdownContainerMaxHeight = Math.floor(viewportHeight * (1 - 2 * relativeIndent));
        }
    }
    doElementsExist() {
        var _a;
        const requiredElementPresented = this.customDropdownMenuItem
            ? (_a = this.dropdownMenuInnerContainer) === null || _a === void 0 ? void 0 : _a.nativeElement.firstChild
            : !this.disabled;
        return Boolean(requiredElementPresented);
    }
    clearStyles() {
        // if we can`t define item height we should discard style properties for disabling adjusting.
        if (this.dropdownMenuInnerContainer && this.dropdownMenuContainer) {
            this.renderer.removeStyle(this.dropdownMenuInnerContainer.nativeElement, 'maxHeight');
            this.renderer.removeStyle(this.dropdownMenuContainer.nativeElement, 'visibility');
        }
    }
}
DropdownMenuComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMenuComponent, deps: [{ token: i1.DomAttributesService }, { token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i2.DeprecationsService }, { token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
DropdownMenuComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: DropdownMenuComponent, selector: "bb-dropdown-menu-ui", inputs: { label: "label", disabled: "disabled", options: "options", icon: "icon", iconSize: "iconSize", iconColor: "iconColor", btnColor: "btnColor", btnCircle: "btnCircle", optionLabelKey: "optionLabelKey", fullWidth: "fullWidth", autoClose: "autoClose", container: "container", position: "position", ariaLabel: "ariaLabel", dropDownMenuRole: "dropDownMenuRole", dropDownMenuId: "dropDownMenuId", buttonSize: "buttonSize", dropDownButtonLabel: "dropDownButtonLabel", visibleElementDependingOnViewport: "visibleElementDependingOnViewport", role: "role" }, outputs: { select: "select" }, host: { listeners: { "window:keydown": "onKeyUp($event)" }, properties: { "attr.role": "this.role" } }, providers: [
        {
            provide: DropdownMenuToken,
            useExisting: DropdownMenuComponent,
        },
    ], queries: [{ propertyName: "customLabel", first: true, predicate: DropdownLabelDirective, descendants: true, read: TemplateRef, static: true }, { propertyName: "customDropdownMenuItem", first: true, predicate: DropdownMenuItemDirective, descendants: true, read: TemplateRef, static: true }], viewQueries: [{ propertyName: "dropdownDir", first: true, predicate: NgbDropdown, descendants: true, static: true }, { propertyName: "dropDownToggle", first: true, predicate: NgbDropdownToggle, descendants: true, read: ElementRef, static: true }, { propertyName: "dropdownListElement", first: true, predicate: ["dropdownListElement"], descendants: true }, { propertyName: "dropdownMenuContainer", first: true, predicate: ["dropdownMenuContainer"], descendants: true }, { propertyName: "dropdownMenuInnerContainer", first: true, predicate: ["dropdownMenuInnerContainer"], descendants: true }, { propertyName: "buttonEl", first: true, predicate: ["button"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<div\n  (openChange)=\"onOpenChange($event)\"\n  [autoClose]=\"autoClose\"\n  [container]=\"container\"\n  [placement]=\"position\"\n  class=\"bb-dropdown-btn-group-wrapper\"\n  ngbDropdown\n>\n  <button\n    bbButton\n    #button\n    [attr.aria-label]=\"dropDownButtonLabel\"\n    [attr.data-role]=\"'dropdown-menu-toggle-button'\"\n    [attr.aria-owns]=\"dropdownId\"\n    [attr.aria-activedescendant]=\"ariaActivedescendant\"\n    [block]=\"fullWidth\"\n    [circle]=\"btnCircle\"\n    [color]=\"btnColor\"\n    [buttonSize]=\"buttonSize\"\n    [disabled]=\"disabled\"\n    ngbDropdownToggle\n  >\n    <div\n      class=\"dropdown-menu-toggle-button__content\"\n      [ngClass]=\"{ 'dropdown-menu-toggle-button__content--full-width': fullWidth }\"\n    >\n      <ng-container *ngIf=\"customLabel; else bbDefaultDropdownLabel\">\n        <ng-container *ngTemplateOutlet=\"customLabel\"></ng-container>\n      </ng-container>\n      <ng-template #bbDefaultDropdownLabel>\n        <span\n          class=\"dropdown-menu__label\"\n          [ngClass]=\"{ 'dropdown-menu__label--full-width': fullWidth }\"\n          *ngIf=\"label\"\n          [attr.data-role]=\"'dropdown-menu-label'\"\n          >{{ label }}</span\n        >\n      </ng-template>\n      <ng-container *ngIf=\"icon\">\n        <bb-icon-ui [color]=\"iconColor\" [name]=\"icon\" [size]=\"iconSize\" [cropped]=\"!btnCircle\"></bb-icon-ui>\n      </ng-container>\n    </div>\n  </button>\n  <div\n    #dropdownMenuContainer\n    class=\"dropdown-menu\"\n    ngbDropdownMenu\n    *ngIf=\"!disabled\"\n    [attr.role]=\"dropDownMenuRole\"\n    [attr.data-role]=\"'dropdown-menu'\"\n    [attr.id]=\"dropDownMenuId\"\n    [style.visibility]=\"dropdownContainerAdjustedMaxHeight ? 'visible' : 'hidden'\"\n  >\n    <div\n      [attr.id]=\"dropdownId\"\n      #dropdownMenuInnerContainer\n      class=\"dropdown-menu-inner-container\"\n      [attr.data-role]=\"'inner-dropdown-menu'\"\n      [style.maxHeight.px]=\"dropdownContainerAdjustedMaxHeight\"\n    >\n      <ng-container *ngIf=\"customDropdownMenuItem; else bbDefaultDropdown\">\n        <ng-container *ngTemplateOutlet=\"customDropdownMenuItem\"></ng-container>\n      </ng-container>\n\n      <ng-template #bbDefaultDropdown>\n        <a\n          ngbDropdownItem\n          role=\"menuitem\"\n          href=\"#\"\n          [attr.id]=\"dropdownId + i\"\n          class=\"dropdown-item\"\n          #dropdownListElement\n          *ngFor=\"let option of options; let i = index\"\n          (click)=\"onClick($event, option)\"\n          [attr.data-role]=\"'dropdown-menu-item'\"\n        >\n          {{ getOptionLabel(option) }}\n        </a>\n      </ng-template>\n    </div>\n  </div>\n</div>\n", components: [{ type: i3.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }], directives: [{ type: i4.NgbDropdown, selector: "[ngbDropdown]", inputs: ["open", "placement", "container", "autoClose", "display", "dropdownClass"], outputs: ["openChange"], exportAs: ["ngbDropdown"] }, { type: i5.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i4.NgbDropdownToggle, selector: "[ngbDropdownToggle]" }, { type: i6.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i6.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i4.NgbDropdownMenu, selector: "[ngbDropdownMenu]" }, { type: i6.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i4.NgbDropdownItem, selector: "[ngbDropdownItem]", inputs: ["disabled"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMenuComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-dropdown-menu-ui',
                    templateUrl: './dropdown-menu.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        {
                            provide: DropdownMenuToken,
                            useExisting: DropdownMenuComponent,
                        },
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i1.DomAttributesService }, { type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i2.DeprecationsService }, { type: i0.ChangeDetectorRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { customLabel: [{
                type: ContentChild,
                args: [DropdownLabelDirective, { read: TemplateRef, static: true }]
            }], customDropdownMenuItem: [{
                type: ContentChild,
                args: [DropdownMenuItemDirective, { read: TemplateRef, static: true }]
            }], dropdownDir: [{
                type: ViewChild,
                args: [NgbDropdown, { static: true }]
            }], dropDownToggle: [{
                type: ViewChild,
                args: [NgbDropdownToggle, { read: ElementRef, static: true }]
            }], dropdownListElement: [{
                type: ViewChild,
                args: ['dropdownListElement']
            }], dropdownMenuContainer: [{
                type: ViewChild,
                args: ['dropdownMenuContainer']
            }], dropdownMenuInnerContainer: [{
                type: ViewChild,
                args: ['dropdownMenuInnerContainer']
            }], label: [{
                type: Input
            }], disabled: [{
                type: Input
            }], options: [{
                type: Input
            }], select: [{
                type: Output
            }], icon: [{
                type: Input
            }], iconSize: [{
                type: Input
            }], iconColor: [{
                type: Input
            }], btnColor: [{
                type: Input
            }], btnCircle: [{
                type: Input
            }], optionLabelKey: [{
                type: Input
            }], fullWidth: [{
                type: Input
            }], autoClose: [{
                type: Input
            }], container: [{
                type: Input
            }], position: [{
                type: Input
            }], ariaLabel: [{
                type: Input
            }], dropDownMenuRole: [{
                type: Input
            }], dropDownMenuId: [{
                type: Input
            }], buttonSize: [{
                type: Input
            }], dropDownButtonLabel: [{
                type: Input
            }], visibleElementDependingOnViewport: [{
                type: Input
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }, {
                type: Input
            }], buttonEl: [{
                type: ViewChild,
                args: ['button']
            }], onKeyUp: [{
                type: HostListener,
                args: ['window:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tbWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWJzL3VpLWFuZy9kcm9wZG93bi1tZW51L2Ryb3Bkb3duLW1lbnUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvZHJvcGRvd24tbWVudS9kcm9wZG93bi1tZW51LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFFdkIsU0FBUyxFQUNULFlBQVksRUFDWixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBRUwsTUFBTSxFQUdOLFdBQVcsRUFDWCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRTVFLE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVFLE9BQU8sRUFDTCw4Q0FBOEMsRUFDOUMsMkNBQTJDLEdBQzVDLE1BQU0scUNBQXFDLENBQUM7QUFDN0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7OztBQUkzQyxNQUFNLE9BQU8seUJBQXlCO0lBQ3BDLFlBQW1CLFdBQTZCO1FBQTdCLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtJQUFHLENBQUM7O3VIQUR6Qyx5QkFBeUI7MkdBQXpCLHlCQUF5Qjs0RkFBekIseUJBQXlCO2tCQURyQyxTQUFTO21CQUFDLEVBQUUsUUFBUSxFQUFFLGlDQUFpQyxFQUFFOztBQU0xRCxNQUFNLE9BQU8sc0JBQXNCO0lBQ2pDLFlBQW1CLFdBQTZCO1FBQTdCLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtJQUFHLENBQUM7O29IQUR6QyxzQkFBc0I7d0dBQXRC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QkFBQyxpQkFBaUIsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFHckIsbUJBQW1CO3NCQUE3RCxTQUFTO3VCQUFDLHFCQUFxQjtnQkFDYSxxQkFBcUI7c0JBQWpFLFNBQVM7dUJBQUMsdUJBQXVCO2dCQUNnQiwwQkFBMEI7c0JBQTNFLFNBQVM7dUJBQUMsNEJBQTRCO2dCQXdHOUIsS0FBSztzQkFBYixLQUFLO2dCQUtHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBS0csT0FBTztzQkFBZixLQUFLO2dCQUtJLE1BQU07c0JBQWYsTUFBTTtnQkFLRSxJQUFJO3NCQUFaLEtBQUs7Z0JBS0csUUFBUTtzQkFBaEIsS0FBSztnQkFLRyxTQUFTO3NCQUFqQixLQUFLO2dCQUtHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBTUcsU0FBUztzQkFBakIsS0FBSztnQkFNRyxjQUFjO3NCQUF0QixLQUFLO2dCQUtHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBS0csU0FBUztzQkFBakIsS0FBSztnQkFLRyxTQUFTO3NCQUFqQixLQUFLO2dCQUtHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBTUcsU0FBUztzQkFBakIsS0FBSztnQkFNRyxnQkFBZ0I7c0JBQXhCLEtBQUs7Z0JBTUcsY0FBYztzQkFBdEIsS0FBSztnQkFLRyxVQUFVO3NCQUFsQixLQUFLO2dCQU1HLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFLRyxpQ0FBaUM7c0JBQXpDLEtBQUs7Z0JBSzZCLElBQUk7c0JBQXRDLFdBQVc7dUJBQUMsV0FBVzs7c0JBQUcsS0FBSztnQkFFWCxRQUFRO3NCQUE1QixTQUFTO3VCQUFDLFFBQVE7Z0JBMEV5QixPQUFPO3NCQUFsRCxZQUFZO3VCQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIFJlbmRlcmVyMixcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOZ2JEcm9wZG93biwgTmdiRHJvcGRvd25Ub2dnbGUgfSBmcm9tICdAbmctYm9vdHN0cmFwL25nLWJvb3RzdHJhcCc7XG5pbXBvcnQgeyBEb21BdHRyaWJ1dGVzU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvc2VydmljZXMnO1xuaW1wb3J0IHsgZ2V0S2V5Q29kZSwgS0VZX0NPREVTLCBnZXREeW5hbWljSWQgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL3V0aWwnO1xuaW1wb3J0IHsgRGVwcmVjYXRpb25zU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9jb3JlJztcbmltcG9ydCB7XG4gIENPVU5UX09GX0VMRU1FTlRTX1RPX1NIT1dfSU5fVEhFX0RST1BET1dOX0xJU1QsXG4gIERST1BET1dOX01FTlVfTUlOX0lOREVOVF9UT19IT1JJWk9OVEFMX0FYSVMsXG59IGZyb20gJy4vY29uc3RhbnRzL2Ryb3Bkb3duLW1lbnUuY29uc3RhbnRzJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFBsYWNlbWVudCB9IGZyb20gJ0BuZy1ib290c3RyYXAvbmctYm9vdHN0cmFwJztcblxuQERpcmVjdGl2ZSh7IHNlbGVjdG9yOiAnbmctdGVtcGxhdGVbYmJEcm9wZG93bk1lbnVJdGVtXScgfSlcbmV4cG9ydCBjbGFzcyBEcm9wZG93bk1lbnVJdGVtRGlyZWN0aXZlIHtcbiAgY29uc3RydWN0b3IocHVibGljIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+KSB7fVxufVxuXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICduZy10ZW1wbGF0ZVtiYkRyb3Bkb3duTGFiZWxdJyB9KVxuZXhwb3J0IGNsYXNzIERyb3Bkb3duTGFiZWxEaXJlY3RpdmUge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4pIHt9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBEcm9wZG93bk1lbnVUb2tlbiB7XG4gIGJ1dHRvbkVsOiBFbGVtZW50UmVmIHwgdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIEBuYW1lIERyb3Bkb3duTWVudUNvbXBvbmVudFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQ29tcG9uZW50IHRoYXQgZGlzcGxheXMgYSBidXR0b24gd2l0aCBhIGRyb3Bkb3duXG4gKlxuICogQGExMXkgZHJvcERvd25CdXR0b25MYWJlbCBpcyBkaXNjZXJuaWJsZSB0ZXh0IGZvciBkcm9wZG93biBidXR0b24uXG4gKlxuICogYGFyaWEtb3duc2AgaGFuZGxlcyBjb250ZXh0dWFsIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIGEgcGFyZW50IGFuZCBpdHMgY2hpbGQgZWxlbWVudHMsXG4gKiBpbiB0aGlzIGNhc2UgYmV0d2VlbiBkcm9wZG93biBtZW51IGFuZCBkcm9wZG93biBpdGVtcywgaXQncyBpbnRlcm5hbGx5IGhhbmRsZWQgYnkgdGhlIGNvbXBvbmVudCB3aXRoIHVuaXF1ZSBpZHMuXG4gKlxuICogYGFyaWEtYWN0aXZlZGVzY2VuZGFudGAgaWRlbnRpZmllcyBjdXJyZW50bHkgYWN0aXZlIGVsZW1lbnQgb2YgZHJvcGRvd24gaXRlbS4gSXQncyBpbnRlcm5hbGx5IGhhbmRsZWQgYnV0XG4gKiB3aGVuIGBiYkRyb3Bkb3duTWVudUl0ZW1gZGlyZWN0aXZlIGFuZCBbcm9sZT1tZW51aXRlbV0gaXMgdXNlZCBmb3IgbGlzdGluZyBkcm9wZG93biBlbGVtZW50c1xuICogdGhlbiB1c2UgW2lkXT1cIm9wdGlvblwiLiBFeGFtcGxlOlxuICogYGBgXG4gIDxuZy10ZW1wbGF0ZSBiYkRyb3Bkb3duTWVudUl0ZW0+XG4gICAgPGJ1dHRvbiByb2xlPVwibWVudWl0ZW1cIiBbaWRdPVwib3B0aW9uXCIgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgKm5nRm9yPVwibGV0IG9wdGlvbiBvZiBbMSwyLDNdXCI+XG4gICAgICB7eyBvcHRpb259fVxuICAgPC9idXR0b24+XG4gIDwvbmctdGVtcGxhdGU+XG4gYGBgXG4gKi9cbi8vIEBkeW5hbWljICh0byBzdXBwcmVzcyBlcnJvciB3aXRoIHJlc29sdmluZyBEb2N1bWVudCB0eXBlIGR1cmluZyBjb21waWxhdGlvbilcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLWRyb3Bkb3duLW1lbnUtdWknLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24tbWVudS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBEcm9wZG93bk1lbnVUb2tlbixcbiAgICAgIHVzZUV4aXN0aW5nOiBEcm9wZG93bk1lbnVDb21wb25lbnQsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgRHJvcGRvd25NZW51Q29tcG9uZW50IGV4dGVuZHMgRHJvcGRvd25NZW51VG9rZW4gaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQge1xuICBAQ29udGVudENoaWxkKERyb3Bkb3duTGFiZWxEaXJlY3RpdmUsIHsgcmVhZDogVGVtcGxhdGVSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuICBjdXN0b21MYWJlbDogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcbiAgQENvbnRlbnRDaGlsZChEcm9wZG93bk1lbnVJdGVtRGlyZWN0aXZlLCB7IHJlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgY3VzdG9tRHJvcGRvd25NZW51SXRlbTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZChOZ2JEcm9wZG93biwgeyBzdGF0aWM6IHRydWUgfSkgcmVhZG9ubHkgZHJvcGRvd25EaXI6IE5nYkRyb3Bkb3duIHwgdW5kZWZpbmVkO1xuICBAVmlld0NoaWxkKE5nYkRyb3Bkb3duVG9nZ2xlLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSByZWFkb25seSBkcm9wRG93blRvZ2dsZTpcbiAgICB8IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+XG4gICAgfCB1bmRlZmluZWQ7XG4gIEBWaWV3Q2hpbGQoJ2Ryb3Bkb3duTGlzdEVsZW1lbnQnKSByZWFkb25seSBkcm9wZG93bkxpc3RFbGVtZW50OiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PiB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnZHJvcGRvd25NZW51Q29udGFpbmVyJykgcmVhZG9ubHkgZHJvcGRvd25NZW51Q29udGFpbmVyOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PiB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnZHJvcGRvd25NZW51SW5uZXJDb250YWluZXInKSByZWFkb25seSBkcm9wZG93bk1lbnVJbm5lckNvbnRhaW5lcjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4gfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgZm9jdXNlZEl0ZW1JbmRleDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHJlYWRvbmx5IGtleUFjdGlvbnNDb25maWcgPSBbXG4gICAge1xuICAgICAgcHJlZGljYXRlOiAoa2V5OiBzdHJpbmcpID0+IGtleSA9PT0gS0VZX0NPREVTLkRPV04sXG4gICAgICByZXNvbHZlcjogKGV2ZW50OiBLZXlib2FyZEV2ZW50LCBpdGVtTGlzdDogTm9kZUxpc3QpID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbUluZGV4ID0gMDtcbiAgICAgICAgICB0aGlzLmZvY3VzTGlzdEl0ZW0oaXRlbUxpc3QpO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA8IGl0ZW1MaXN0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtSW5kZXggPSB0aGlzLmZvY3VzZWRJdGVtSW5kZXggKyAxO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5mb2N1c0xpc3RJdGVtKGl0ZW1MaXN0KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBwcmVkaWNhdGU6IChrZXk6IHN0cmluZykgPT4ga2V5ID09PSBLRVlfQ09ERVMuVVAsXG4gICAgICByZXNvbHZlcjogKGV2ZW50OiBLZXlib2FyZEV2ZW50LCBpdGVtTGlzdDogTm9kZUxpc3QpID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbUluZGV4ID0gMDtcbiAgICAgICAgICB0aGlzLmZvY3VzTGlzdEl0ZW0oaXRlbUxpc3QpO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA+IDApIHtcbiAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtSW5kZXggPSB0aGlzLmZvY3VzZWRJdGVtSW5kZXggLSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5mb2N1c0xpc3RJdGVtKGl0ZW1MaXN0KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBwcmVkaWNhdGU6IChrZXk6IHN0cmluZykgPT4ga2V5ID09PSBLRVlfQ09ERVMuU1BBQ0UgfHwga2V5ID09PSBLRVlfQ09ERVMuRU5URVIsXG4gICAgICByZXNvbHZlcjogKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLWV4cHJlc3Npb25zXG4gICAgICAgIHRoaXMuZHJvcGRvd25EaXIgJiYgdGhpcy5kcm9wZG93bkRpci5jbG9zZSgpO1xuICAgICAgICBpZiAodGhpcy5kcm9wRG93blRvZ2dsZSkge1xuICAgICAgICAgIHRoaXMuZHJvcERvd25Ub2dnbGUubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgcHJlZGljYXRlOiAoa2V5OiBzdHJpbmcpID0+IGtleSA9PT0gS0VZX0NPREVTLlRBQixcbiAgICAgIHJlc29sdmVyOiAoZXZlbnQ6IEtleWJvYXJkRXZlbnQsIGl0ZW1MaXN0OiBOb2RlTGlzdCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5pc0Ryb3BEb3duT3BlbigpICYmIHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlRHJvcERvd24oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA9IDA7XG4gICAgICAgICAgICB0aGlzLmZvY3VzTGlzdEl0ZW0oaXRlbUxpc3QpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzRmlyc3RMaXN0SXRlbUluRm9jdXMoaXRlbUxpc3QpICYmIGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0aGlzLmZvY3VzVG9nZ2xlKCk7XG4gICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbUluZGV4ID0gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNMYXN0TGlzdEl0ZW1JbkZvY3VzKGl0ZW1MaXN0KSAmJiAhZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICB0aGlzLmZvY3VzVG9nZ2xlKCk7XG4gICAgICAgICAgdGhpcy5jbG9zZURyb3BEb3duKCk7XG4gICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbUluZGV4ID0gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW1JbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbUluZGV4ID0gZXZlbnQuc2hpZnRLZXkgPyB0aGlzLmZvY3VzZWRJdGVtSW5kZXggLSAxIDogdGhpcy5mb2N1c2VkSXRlbUluZGV4ICsgMTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICBdO1xuICBwcml2YXRlIHJlYWRvbmx5IHdpbmRvdzogV2luZG93IHwgbnVsbDtcblxuICBwcml2YXRlIF9pdGVtTGlzdDogTm9kZUxpc3QgfCB1bmRlZmluZWQ7XG5cbiAgcHJpdmF0ZSBkcm9wZG93bk1lbnVJdGVtSGVpZ2h0OiBudW1iZXIgfCB1bmRlZmluZWQ7XG5cbiAgcHJpdmF0ZSBkcm9wZG93bkNvbnRhaW5lck1heEhlaWdodDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuXG4gIGRyb3Bkb3duQ29udGFpbmVyQWRqdXN0ZWRNYXhIZWlnaHQgPSAwO1xuXG4gIGFyaWFBY3RpdmVkZXNjZW5kYW50OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBkcm9wZG93bklkID0gZ2V0RHluYW1pY0lkKCkgKyAnX2Ryb3Bkb3duX21lbnUnO1xuXG4gIC8qKlxuICAgKiBUaGUgbGFiZWwgZm9yIHRoZSBidXR0b24gZHJvcGRvd24uIERlZmF1bHRzIHRvIGFuIGVtcHR5IHN0cmluZy5cbiAgICovXG4gIEBJbnB1dCgpIGxhYmVsID0gJyc7XG5cbiAgLyoqXG4gICAqIFRoZSBkaXNhYmxlZCBzdGF0ZSBmb3IgdGhlIGJ1dHRvbiBkcm9wZG93bi4gRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAqL1xuICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJZiB0aGUgdmFsdWUgaXMgYW4gb2JqZWN0LCBwbGVhc2UgcHJvdmlkZSBhIG9wdGlvbkxhYmVsS2V5LlxuICAgKi9cbiAgQElucHV0KCkgb3B0aW9uczogQXJyYXk8c3RyaW5nIHwgb2JqZWN0PiA9IFtdO1xuXG4gIC8qKlxuICAgKiBFdmVudCAoT3V0cHV0KSB0aGF0IGVtaXRzIHRoZSB2YWx1ZSBvZiBzZWxlY3RlZCBkcm9wZG93biBpdGVtLlxuICAgKi9cbiAgQE91dHB1dCgpIHNlbGVjdCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nIHwgb2JqZWN0PigpO1xuXG4gIC8qKlxuICAgKiBJY29uIHRoYXQgaXMgZGlzcGxheWVkIGluIHRoZSBidXR0b24uXG4gICAqL1xuICBASW5wdXQoKSBpY29uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFRoZSBzaXplIG9mIHRoZSBpY29uIHRvIGJlIGRpc3BsYXllZC4gRGVmYXVsdHMgdG8gbWQuXG4gICAqL1xuICBASW5wdXQoKSBpY29uU2l6ZSA9ICdtZCc7XG5cbiAgLyoqXG4gICAqIFRoZSBjb2xvciBvZiB0aGUgaWNvbiB0byBiZSBkaXNwbGF5ZWQuXG4gICAqL1xuICBASW5wdXQoKSBpY29uQ29sb3I6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogQ29sb3Igb2YgdGhlIGJ1dHRvbi4gRGVmYXVsdHMgdG8gcHJpbWFyeS5cbiAgICovXG4gIEBJbnB1dCgpIGJ0bkNvbG9yID0gJ3ByaW1hcnknO1xuXG4gIC8qKlxuICAgKiBUaGUgZmxhZyB0byBpbmRpY2F0ZSB3aGV0aGVyIHRoZSBkcm9wZG93biBidXR0b24gc2hvdWxkIGJlIGluIGEgY2lyY3VsYXIgc2hhcGUuIERlZmF1bHRzIHRvICdmYWxzZScuXG4gICAqIFRoaXMgd2lsbCBvbmx5IHdvcmsgd2hlbiB0aGVyZSdzIG9ubHkgYW4gaWNvbiBpbnNpZGUgdGhlIGJ1dHRvbiB3aXRob3V0IGEgdGV4dC5cbiAgICovXG4gIEBJbnB1dCgpIGJ0bkNpcmNsZSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBLZXkgdGhhdCBjb250YWlucyB0aGUgbGFiZWwgb2YgdGhlIG9wdGlvbiBvYmplY3QuXG4gICAqIE1hbmRhdG9yeSB3aGVuIHRoZSB0eXBlIG9mIG9wdGlvbiBpcyBvYmplY3RcbiAgICovXG4gIEBJbnB1dCgpIG9wdGlvbkxhYmVsS2V5OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIElmIHRydWUgaXQgd2lsbCBzdHJldGNoIHRoZSBidXR0b24gaW5zaWRlIHRvIDEwMCUgd2lkdGhcbiAgICovXG4gIEBJbnB1dCgpIGZ1bGxXaWR0aCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBkcm9wZG93biBzaG91bGQgYmUgY2xvc2VkIHdoZW4gY2xpY2tpbmcgb25lIG9mIGRyb3Bkb3duIGl0ZW1zIG9yIHByZXNzaW5nIEVTQ1xuICAgKi9cbiAgQElucHV0KCkgYXV0b0Nsb3NlOiBib29sZWFuIHwgJ2luc2lkZScgfCAnb3V0c2lkZScgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hpY2ggZWxlbWVudCB0aGUgZHJvcGRvd24gc2hvdWxkIGJlIGFwcGVuZGVkIHRvLlxuICAgKi9cbiAgQElucHV0KCkgY29udGFpbmVyOiAnJyB8ICdib2R5JyA9ICcnO1xuXG4gIC8qKlxuICAgKiBUaGUgcG9zaXRpb24gb2YgdGhlIGRyb3Bkb3duLiBEZWZhdWx0cyB0byBib3R0b20tcmlnaHQuXG4gICAqL1xuICBASW5wdXQoKSBwb3NpdGlvbjogUGxhY2VtZW50ID0gJ2JvdHRvbS1yaWdodCc7XG5cbiAgLyoqXG4gICAqIEFyaWEgbGFiZWwgZm9yIHRoZSBkcm9wZG93blxuICAgKi9cblxuICBASW5wdXQoKSBhcmlhTGFiZWw6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIHJvbGUgb2YgdGhlIGRyb3Bkb3duIG1lbnUgZGVmYXVsdHMgdG8gbWVudVxuICAgKi9cblxuICBASW5wdXQoKSBkcm9wRG93bk1lbnVSb2xlOiBzdHJpbmcgfCB1bmRlZmluZWQgPSAnbWVudSc7XG5cbiAgLyoqXG4gICAqIElEIGZvciB0aGUgZHJvcGRvd24gbWVudVxuICAgKi9cblxuICBASW5wdXQoKSBkcm9wRG93bk1lbnVJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBQcmVkZWZpbmVkIGJ1dHRvbiBzaXplc1xuICAgKi9cbiAgQElucHV0KCkgYnV0dG9uU2l6ZTogJ3NtJyB8ICdtZCcgPSAnbWQnO1xuXG4gIC8qKlxuICAgKiBEcm9wZG93biBtZW51ICh0b2dnbGUpIGJ1dHRvbiBhcmlhIGxhYmVsXG4gICAqL1xuICAvLyB0b2RvIGFkZCB0cmFuc2xhdGlvbiB3aGVuIGFkZGluZyBkZWZhdWx0IHZhbHVlXG4gIEBJbnB1dCgpIGRyb3BEb3duQnV0dG9uTGFiZWwgPSAnJztcblxuICAvKipcbiAgICogQ291bnQgb2YgZWxlbWVudHMgd2hpY2ggaXMgdXNlZCBpbiBzaG93aW5nIGVsZW1lbnRzIGluIHRoZSBkcm9wZG93biBsaXN0LlxuICAgKi9cbiAgQElucHV0KCkgdmlzaWJsZUVsZW1lbnREZXBlbmRpbmdPblZpZXdwb3J0ID0gQ09VTlRfT0ZfRUxFTUVOVFNfVE9fU0hPV19JTl9USEVfRFJPUERPV05fTElTVDtcblxuICAvKipcbiAgICogQWRkIHJvbGU9Z3JvdXAgb250byBob3N0XG4gICAqL1xuICBASG9zdEJpbmRpbmcoJ2F0dHIucm9sZScpIEBJbnB1dCgpIHJvbGUgPSAnZ3JvdXAnO1xuXG4gIEBWaWV3Q2hpbGQoJ2J1dHRvbicpIGJ1dHRvbkVsOiBFbGVtZW50UmVmIHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZG9tQXR0clNlcnZpY2U6IERvbUF0dHJpYnV0ZXNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZWxlbTogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSByZWFkb25seSBkZXByZWNhdGlvbnNTZXJ2aWNlOiBEZXByZWNhdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcblxuICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgcmVhZG9ubHkgZG9jdW1lbnQ6IERvY3VtZW50LFxuICApIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy53aW5kb3cgPSB0aGlzLmRvY3VtZW50LmRlZmF1bHRWaWV3O1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy8gdGhlIGJ1dHRvbnMgc2l6ZSB3aWxsIGJlIHNldCBmcm9tIHRoZSBncm91cCBzaXplXG4gICAgaWYgKHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoJ2J0bi1ncm91cC1zbScpID4gLTEpIHtcbiAgICAgIHRoaXMuYnV0dG9uU2l6ZSA9ICdzbSc7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZG9tQXR0clNlcnZpY2UubW92ZUFyaWFBdHRyaWJ1dGVzKFxuICAgICAgdGhpcy5lbGVtLm5hdGl2ZUVsZW1lbnQsXG4gICAgICB0aGlzLmJ1dHRvbkVsICYmIHRoaXMuYnV0dG9uRWwubmF0aXZlRWxlbWVudCxcbiAgICAgIHRoaXMucmVuZGVyZXIsXG4gICAgKTtcblxuICAgIGNvbnN0IGl0ZW1MaXN0ID0gdGhpcy5nZXRJdGVtTGlzdCgpO1xuXG4gICAgaWYgKGl0ZW1MaXN0KSB7XG4gICAgICB0aGlzLnNldEl0ZW1zVGFiSW5kZXgoaXRlbUxpc3QpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBoYW5kbGVyIGZvciBjbGlja3Mgb24gZHJvcGRvd24gaXRlbXNcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IEV2ZW50XG4gICAqIEBwYXJhbSBpdGVtIEl0ZW0gdGhhdCBoYXMgYmVlbiBjbGlja2VkXG4gICAqL1xuICBvbkNsaWNrKGV2ZW50OiBFdmVudCwgaXRlbTogYW55KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnNlbGVjdC5lbWl0KGl0ZW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIERyb3AgZG93biBjaGFuZ2Ugc3RhdGUgZXZlbnQgaGFuZGxlclxuICAgKlxuICAgKiBAcGFyYW0gaXNPcGVuXG4gICAqL1xuICBvbk9wZW5DaGFuZ2UoaXNPcGVuOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKGlzT3Blbikge1xuICAgICAgdGhpcy5hZGp1c3REcm9wZG93bkxpc3RUb1ZpZXdwb3J0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZm9jdXNlZEl0ZW1JbmRleCA9IHVuZGVmaW5lZDtcbiAgICAgIGlmICh0aGlzLmJ1dHRvbkVsKSB7XG4gICAgICAgIHRoaXMuYXJpYUFjdGl2ZWRlc2NlbmRhbnQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIGxhYmVsIG9mIHRoZSBkcm9wZG93biBpdGVtXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb24gSXRlbSB0aGF0IGhhcyBiZWVuIGNsaWNrZWRcbiAgICogQHBhcmFtIGxhYmVsS2V5IEtleSB0aGF0IGNvbnRhaW5zIHRoZSBsYWJlbCBvZiB0aGUgb3B0aW9uIG9iamVjdFxuICAgKi9cbiAgZ2V0T3B0aW9uTGFiZWwob3B0aW9uOiBhbnkpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbkxhYmVsS2V5ICYmIHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnID8gb3B0aW9uW3RoaXMub3B0aW9uTGFiZWxLZXldIDogb3B0aW9uO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OmtleWRvd24nLCBbJyRldmVudCddKSBvbktleVVwKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmlzRHJvcERvd25PcGVuKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpdGVtTGlzdCA9IHRoaXMuZ2V0SXRlbUxpc3QoKTtcblxuICAgIGlmICghaXRlbUxpc3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNldEl0ZW1zVGFiSW5kZXgoaXRlbUxpc3QpO1xuXG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5rZXlBY3Rpb25zQ29uZmlnLmZpbmQoKGN2KSA9PiBjdi5wcmVkaWNhdGUoZ2V0S2V5Q29kZShldmVudCkpKTtcblxuICAgIGlmIChjb25maWcpIHtcbiAgICAgIGNvbmZpZy5yZXNvbHZlcihldmVudCwgaXRlbUxpc3QpO1xuICAgIH1cbiAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSB0aGlzLmdldFNlbGVjdGVkSXRlbShpdGVtTGlzdCk7XG4gICAgaWYgKHRoaXMuYnV0dG9uRWwgJiYgdGhpcy5pc0Ryb3BEb3duT3BlbigpICYmIHNlbGVjdGVkSXRlbSkge1xuICAgICAgdGhpcy5hcmlhQWN0aXZlZGVzY2VuZGFudCA9IHNlbGVjdGVkSXRlbS5pZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzTGFzdExpc3RJdGVtSW5Gb2N1cyhpdGVtTGlzdDogUXVlcnlMaXN0PEVsZW1lbnRSZWY+IHwgYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGl0ZW1MaXN0Lml0ZW0oaXRlbUxpc3QubGVuZ3RoIC0gMSk7XG4gIH1cblxuICBwcml2YXRlIGlzRmlyc3RMaXN0SXRlbUluRm9jdXMoaXRlbUxpc3Q6IE5vZGVMaXN0KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGl0ZW1MaXN0Lml0ZW0oMCk7XG4gIH1cblxuICBwcml2YXRlIGZvY3VzVG9nZ2xlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRyb3BEb3duVG9nZ2xlKSB7XG4gICAgICB0aGlzLmRyb3BEb3duVG9nZ2xlLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsb3NlRHJvcERvd24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZHJvcGRvd25EaXIpIHtcbiAgICAgIHRoaXMuZHJvcGRvd25EaXIuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzRHJvcERvd25PcGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMuZHJvcGRvd25EaXIgJiYgdGhpcy5kcm9wZG93bkRpci5pc09wZW4oKSk7XG4gIH1cblxuICBwcml2YXRlIGdldEl0ZW1MaXN0KCk6IE5vZGVMaXN0IHwgdW5kZWZpbmVkIHtcbiAgICAvL1RPRE86IGRvbid0IGFjY2VzcyBwcml2YXRlIEFQSVxuICAgIHJldHVybiB0aGlzLmRyb3Bkb3duRGlyPy5bJ19tZW51J10/Lm5hdGl2ZUVsZW1lbnQ/LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tyb2xlPW1lbnVpdGVtXScpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJdGVtc1RhYkluZGV4KGl0ZW1MaXN0OiBOb2RlTGlzdCk6IHZvaWQge1xuICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoaXRlbUxpc3QsIChjdjogYW55KSA9PiB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShjdiwgJ3RhYmluZGV4JywgJzAnKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZm9jdXNMaXN0SXRlbShpdGVtTGlzdDogTm9kZUxpc3QgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICBjb25zdCBpdGVtID0gdGhpcy5nZXRTZWxlY3RlZEl0ZW0oaXRlbUxpc3QpO1xuXG4gICAgaWYgKGl0ZW0pIHtcbiAgICAgIGl0ZW0uZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNlbGVjdGVkSXRlbShpdGVtTGlzdDogTm9kZUxpc3QgfCB1bmRlZmluZWQpOiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZCB7XG4gICAgbGV0IGl0ZW06IEhUTUxFbGVtZW50IHwgdW5kZWZpbmVkO1xuXG4gICAgaWYgKGl0ZW1MaXN0KSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBpdGVtID0gaXRlbUxpc3QuaXRlbSh0aGlzLmZvY3VzZWRJdGVtSW5kZXgpO1xuICAgIH1cblxuICAgIHJldHVybiBpdGVtO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGp1c3REcm9wZG93bkxpc3RUb1ZpZXdwb3J0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kb0VsZW1lbnRzRXhpc3QoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZHJvcGRvd25Db250YWluZXJBZGp1c3RlZE1heEhlaWdodCA9IDA7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZGVmaW5lQWRqdXN0ZWREcm9wZG93bk1lbnVIZWlnaHQoKTtcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICB9LCAwKTtcbiAgfVxuXG4gIHByaXZhdGUgZGVmaW5lQWRqdXN0ZWREcm9wZG93bk1lbnVIZWlnaHQoKTogdm9pZCB7XG4gICAgdGhpcy5kcm9wZG93bk1lbnVJdGVtSGVpZ2h0ID0gdGhpcy5jdXN0b21Ecm9wZG93bk1lbnVJdGVtXG4gICAgICA/ICh0aGlzLmRyb3Bkb3duTWVudUlubmVyQ29udGFpbmVyPy5uYXRpdmVFbGVtZW50LmZpcnN0Q2hpbGQgYXMgRWxlbWVudCkuY2xpZW50SGVpZ2h0XG4gICAgICA6IHRoaXMuZHJvcGRvd25MaXN0RWxlbWVudD8ubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cbiAgICBpZiAoIXRoaXMuZHJvcGRvd25NZW51SXRlbUhlaWdodCkge1xuICAgICAgdGhpcy5jbGVhclN0eWxlcygpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVGhlIG1pbiBoZWlnaHQgb2YgZHJvcGRvd24gY29udGFpbmVyIGxpc3Qgc3RhcnRlZCBmcm9tIGhlaWdodCBvZiAxIGVsZW1lbnQ7XG4gICAgbGV0IGhlaWdodE9mQWxsRHJvcGRvd25JdGVtcyA9IHRoaXMuZHJvcGRvd25NZW51SXRlbUhlaWdodDtcbiAgICBsZXQgY29udGFpbmVySGVpZ2h0T2ZEcm9wZG93bkl0ZW1zID1cbiAgICAgICh0aGlzLmRyb3Bkb3duTWVudUNvbnRhaW5lcj8ubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgfHwgMCkgKyBoZWlnaHRPZkFsbERyb3Bkb3duSXRlbXM7XG5cbiAgICB0aGlzLmRlZmluZU1heERyb3Bkb3duQ29udGFpbmVySGVpZ2h0KCk7XG5cbiAgICBjb25zdCBpdGVyYXRpb25zRm9ySW5jcmVhc2luZ0hlaWdodCA9IE1hdGgubWluKFxuICAgICAgdGhpcy52aXNpYmxlRWxlbWVudERlcGVuZGluZ09uVmlld3BvcnQsXG4gICAgICAvLyB3aGVuIHdlIHBhc3MgY3VzdG9tIHRlbXBsYXRlIGl0ZW1zLCB0aGlzLm9wdGlvbnMubGVuZ3RoIGNhbiBiZSAwO1xuICAgICAgdGhpcy5vcHRpb25zLmxlbmd0aCB8fCAodGhpcy5kcm9wZG93bk1lbnVJbm5lckNvbnRhaW5lcj8ubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCBhcyBudW1iZXIpLFxuICAgICk7XG5cbiAgICBmb3IgKFxuICAgICAgbGV0IGkgPSAxO1xuICAgICAgaSA8IGl0ZXJhdGlvbnNGb3JJbmNyZWFzaW5nSGVpZ2h0ICYmXG4gICAgICAvLyBoZXJlIHdlIHNob3VsZCBhdm9pZCByZWR1bmRhbnQgaW5jcmVhc2luZztcbiAgICAgIGNvbnRhaW5lckhlaWdodE9mRHJvcGRvd25JdGVtcyArIHRoaXMuZHJvcGRvd25NZW51SXRlbUhlaWdodCA8PSBOdW1iZXIodGhpcy5kcm9wZG93bkNvbnRhaW5lck1heEhlaWdodCk7XG4gICAgICBpKytcbiAgICApIHtcbiAgICAgIGhlaWdodE9mQWxsRHJvcGRvd25JdGVtcyArPSB0aGlzLmRyb3Bkb3duTWVudUl0ZW1IZWlnaHQ7XG4gICAgICBjb250YWluZXJIZWlnaHRPZkRyb3Bkb3duSXRlbXMgKz0gdGhpcy5kcm9wZG93bk1lbnVJdGVtSGVpZ2h0O1xuICAgIH1cblxuICAgIHRoaXMuZHJvcGRvd25Db250YWluZXJBZGp1c3RlZE1heEhlaWdodCA9IGhlaWdodE9mQWxsRHJvcGRvd25JdGVtcztcbiAgfVxuXG4gIHByaXZhdGUgZGVmaW5lTWF4RHJvcGRvd25Db250YWluZXJIZWlnaHQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLndpbmRvdyB8fCAhdGhpcy5kcm9wRG93blRvZ2dsZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgcmVsYXRpdmVJbmRlbnQgPSBEUk9QRE9XTl9NRU5VX01JTl9JTkRFTlRfVE9fSE9SSVpPTlRBTF9BWElTO1xuICAgIGNvbnN0IHZpZXdwb3J0SGVpZ2h0ID0gdGhpcy53aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY29uc3QgeyBib3R0b20sIHRvcCB9ID0gdGhpcy5kcm9wRG93blRvZ2dsZS5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgdGhpcy5kcm9wZG93bkNvbnRhaW5lck1heEhlaWdodCA9IHRoaXMuZHJvcGRvd25NZW51SXRlbUhlaWdodDtcblxuICAgIGlmICh0aGlzLnBvc2l0aW9uLmluY2x1ZGVzKCdib3R0b20nKSkge1xuICAgICAgY29uc3Qgdmlld3BvcnRJbmRlbnQgPSBNYXRoLmZsb29yKHZpZXdwb3J0SGVpZ2h0ICogcmVsYXRpdmVJbmRlbnQpO1xuICAgICAgY29uc3QgYm91bmRpbmdIZWlnaHQgPSB2aWV3cG9ydEhlaWdodCAtIGJvdHRvbTtcblxuICAgICAgLy8gd2Ugc2hvdWxkIGluY2x1ZGUgYSB2aWV3cG9ydCBpbmRlbnQgYmVjYXVzZSBkcm9wZG93bkNvbnRhaW5lck1heEhlaWdodCBtdXN0IG5vdCBvdmVybGFwIHdpbmRvdy5cbiAgICAgIHRoaXMuZHJvcGRvd25Db250YWluZXJNYXhIZWlnaHQgPSBib3VuZGluZ0hlaWdodCAtIHZpZXdwb3J0SW5kZW50O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAnbGVmdCcgfHwgdGhpcy5wb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgY29uc3Qgb2Zmc2V0RGlmZmVyZW5jZSA9IHRvcCArIGJvdHRvbSAtIHZpZXdwb3J0SGVpZ2h0O1xuICAgICAgLy8gaGVyZSB3ZSBzaG91bGQgY2FsY3VsYXRlIHRoZSBzbWFsbGVzdCBvZmZzZXQgYmV0d2VlbiB0b3AgYW5kIGJvdHRvbSBiZWNhdXNlIGRyb3Bkb3duIGxpc3QgcmVuZGVycyBhdCBtaWRkbGU7XG4gICAgICBjb25zdCBvZmZzZXQgPSBvZmZzZXREaWZmZXJlbmNlIDw9IDAgPyB0b3AgOiB2aWV3cG9ydEhlaWdodCAtIGJvdHRvbTtcbiAgICAgIC8vIGhlcmUgd2UgbXVsdGlwbHkgYnkgMiBiZWNhdXNlIGxlZnQgb3IgcmlnaHQgcG9zaXRpb24gcmVuZGVycyBkcm9wZG93biBsaXN0IGF0IG1pZGRsZTtcbiAgICAgIHRoaXMuZHJvcGRvd25Db250YWluZXJNYXhIZWlnaHQgPSBNYXRoLmZsb29yKDIgKiBvZmZzZXQgKiAoMSAtIHJlbGF0aXZlSW5kZW50KSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucG9zaXRpb24uaW5jbHVkZXMoJ3RvcCcpKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duQ29udGFpbmVyTWF4SGVpZ2h0ID0gTWF0aC5mbG9vcih0b3AgKiAoMSAtIHJlbGF0aXZlSW5kZW50KSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucG9zaXRpb24gPT09ICdhdXRvJykge1xuICAgICAgLy8gYXV0byBjYWxjdWxhdGVzIHRoZSBtb3N0IHN1aXRhYmxlIHBvc2l0aW9uIHRoYXRgcyB3aHkgaXQgaXMgZW5vdWdoIHRvIHNldCB3aWRlciBsaW1pdGF0aW9ucztcbiAgICAgIHRoaXMuZHJvcGRvd25Db250YWluZXJNYXhIZWlnaHQgPSBNYXRoLmZsb29yKHZpZXdwb3J0SGVpZ2h0ICogKDEgLSAyICogcmVsYXRpdmVJbmRlbnQpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRvRWxlbWVudHNFeGlzdCgpOiBib29sZWFuIHtcbiAgICBjb25zdCByZXF1aXJlZEVsZW1lbnRQcmVzZW50ZWQgPSB0aGlzLmN1c3RvbURyb3Bkb3duTWVudUl0ZW1cbiAgICAgID8gdGhpcy5kcm9wZG93bk1lbnVJbm5lckNvbnRhaW5lcj8ubmF0aXZlRWxlbWVudC5maXJzdENoaWxkXG4gICAgICA6ICF0aGlzLmRpc2FibGVkO1xuXG4gICAgcmV0dXJuIEJvb2xlYW4ocmVxdWlyZWRFbGVtZW50UHJlc2VudGVkKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJTdHlsZXMoKSB7XG4gICAgLy8gaWYgd2UgY2FuYHQgZGVmaW5lIGl0ZW0gaGVpZ2h0IHdlIHNob3VsZCBkaXNjYXJkIHN0eWxlIHByb3BlcnRpZXMgZm9yIGRpc2FibGluZyBhZGp1c3RpbmcuXG4gICAgaWYgKHRoaXMuZHJvcGRvd25NZW51SW5uZXJDb250YWluZXIgJiYgdGhpcy5kcm9wZG93bk1lbnVDb250YWluZXIpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlU3R5bGUodGhpcy5kcm9wZG93bk1lbnVJbm5lckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnbWF4SGVpZ2h0Jyk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZVN0eWxlKHRoaXMuZHJvcGRvd25NZW51Q29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICd2aXNpYmlsaXR5Jyk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2XG4gIChvcGVuQ2hhbmdlKT1cIm9uT3BlbkNoYW5nZSgkZXZlbnQpXCJcbiAgW2F1dG9DbG9zZV09XCJhdXRvQ2xvc2VcIlxuICBbY29udGFpbmVyXT1cImNvbnRhaW5lclwiXG4gIFtwbGFjZW1lbnRdPVwicG9zaXRpb25cIlxuICBjbGFzcz1cImJiLWRyb3Bkb3duLWJ0bi1ncm91cC13cmFwcGVyXCJcbiAgbmdiRHJvcGRvd25cbj5cbiAgPGJ1dHRvblxuICAgIGJiQnV0dG9uXG4gICAgI2J1dHRvblxuICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiZHJvcERvd25CdXR0b25MYWJlbFwiXG4gICAgW2F0dHIuZGF0YS1yb2xlXT1cIidkcm9wZG93bi1tZW51LXRvZ2dsZS1idXR0b24nXCJcbiAgICBbYXR0ci5hcmlhLW93bnNdPVwiZHJvcGRvd25JZFwiXG4gICAgW2F0dHIuYXJpYS1hY3RpdmVkZXNjZW5kYW50XT1cImFyaWFBY3RpdmVkZXNjZW5kYW50XCJcbiAgICBbYmxvY2tdPVwiZnVsbFdpZHRoXCJcbiAgICBbY2lyY2xlXT1cImJ0bkNpcmNsZVwiXG4gICAgW2NvbG9yXT1cImJ0bkNvbG9yXCJcbiAgICBbYnV0dG9uU2l6ZV09XCJidXR0b25TaXplXCJcbiAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgIG5nYkRyb3Bkb3duVG9nZ2xlXG4gID5cbiAgICA8ZGl2XG4gICAgICBjbGFzcz1cImRyb3Bkb3duLW1lbnUtdG9nZ2xlLWJ1dHRvbl9fY29udGVudFwiXG4gICAgICBbbmdDbGFzc109XCJ7ICdkcm9wZG93bi1tZW51LXRvZ2dsZS1idXR0b25fX2NvbnRlbnQtLWZ1bGwtd2lkdGgnOiBmdWxsV2lkdGggfVwiXG4gICAgPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1c3RvbUxhYmVsOyBlbHNlIGJiRGVmYXVsdERyb3Bkb3duTGFiZWxcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImN1c3RvbUxhYmVsXCI+PC9uZy1jb250YWluZXI+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDxuZy10ZW1wbGF0ZSAjYmJEZWZhdWx0RHJvcGRvd25MYWJlbD5cbiAgICAgICAgPHNwYW5cbiAgICAgICAgICBjbGFzcz1cImRyb3Bkb3duLW1lbnVfX2xhYmVsXCJcbiAgICAgICAgICBbbmdDbGFzc109XCJ7ICdkcm9wZG93bi1tZW51X19sYWJlbC0tZnVsbC13aWR0aCc6IGZ1bGxXaWR0aCB9XCJcbiAgICAgICAgICAqbmdJZj1cImxhYmVsXCJcbiAgICAgICAgICBbYXR0ci5kYXRhLXJvbGVdPVwiJ2Ryb3Bkb3duLW1lbnUtbGFiZWwnXCJcbiAgICAgICAgICA+e3sgbGFiZWwgfX08L3NwYW5cbiAgICAgICAgPlxuICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJpY29uXCI+XG4gICAgICAgIDxiYi1pY29uLXVpIFtjb2xvcl09XCJpY29uQ29sb3JcIiBbbmFtZV09XCJpY29uXCIgW3NpemVdPVwiaWNvblNpemVcIiBbY3JvcHBlZF09XCIhYnRuQ2lyY2xlXCI+PC9iYi1pY29uLXVpPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG4gIDwvYnV0dG9uPlxuICA8ZGl2XG4gICAgI2Ryb3Bkb3duTWVudUNvbnRhaW5lclxuICAgIGNsYXNzPVwiZHJvcGRvd24tbWVudVwiXG4gICAgbmdiRHJvcGRvd25NZW51XG4gICAgKm5nSWY9XCIhZGlzYWJsZWRcIlxuICAgIFthdHRyLnJvbGVdPVwiZHJvcERvd25NZW51Um9sZVwiXG4gICAgW2F0dHIuZGF0YS1yb2xlXT1cIidkcm9wZG93bi1tZW51J1wiXG4gICAgW2F0dHIuaWRdPVwiZHJvcERvd25NZW51SWRcIlxuICAgIFtzdHlsZS52aXNpYmlsaXR5XT1cImRyb3Bkb3duQ29udGFpbmVyQWRqdXN0ZWRNYXhIZWlnaHQgPyAndmlzaWJsZScgOiAnaGlkZGVuJ1wiXG4gID5cbiAgICA8ZGl2XG4gICAgICBbYXR0ci5pZF09XCJkcm9wZG93bklkXCJcbiAgICAgICNkcm9wZG93bk1lbnVJbm5lckNvbnRhaW5lclxuICAgICAgY2xhc3M9XCJkcm9wZG93bi1tZW51LWlubmVyLWNvbnRhaW5lclwiXG4gICAgICBbYXR0ci5kYXRhLXJvbGVdPVwiJ2lubmVyLWRyb3Bkb3duLW1lbnUnXCJcbiAgICAgIFtzdHlsZS5tYXhIZWlnaHQucHhdPVwiZHJvcGRvd25Db250YWluZXJBZGp1c3RlZE1heEhlaWdodFwiXG4gICAgPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1c3RvbURyb3Bkb3duTWVudUl0ZW07IGVsc2UgYmJEZWZhdWx0RHJvcGRvd25cIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImN1c3RvbURyb3Bkb3duTWVudUl0ZW1cIj48L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICA8bmctdGVtcGxhdGUgI2JiRGVmYXVsdERyb3Bkb3duPlxuICAgICAgICA8YVxuICAgICAgICAgIG5nYkRyb3Bkb3duSXRlbVxuICAgICAgICAgIHJvbGU9XCJtZW51aXRlbVwiXG4gICAgICAgICAgaHJlZj1cIiNcIlxuICAgICAgICAgIFthdHRyLmlkXT1cImRyb3Bkb3duSWQgKyBpXCJcbiAgICAgICAgICBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIlxuICAgICAgICAgICNkcm9wZG93bkxpc3RFbGVtZW50XG4gICAgICAgICAgKm5nRm9yPVwibGV0IG9wdGlvbiBvZiBvcHRpb25zOyBsZXQgaSA9IGluZGV4XCJcbiAgICAgICAgICAoY2xpY2spPVwib25DbGljaygkZXZlbnQsIG9wdGlvbilcIlxuICAgICAgICAgIFthdHRyLmRhdGEtcm9sZV09XCInZHJvcGRvd24tbWVudS1pdGVtJ1wiXG4gICAgICAgID5cbiAgICAgICAgICB7eyBnZXRPcHRpb25MYWJlbChvcHRpb24pIH19XG4gICAgICAgIDwvYT5cbiAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=