import { Component, Input, Optional, SkipSelf } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * @name CollapsibleAccordionComponent
 *
 * @description
 * Component that groups Collapsible components to show them in an accordion fashion.
 * It can assure that only one Collapsible panel can be opened at a time
 */
export class CollapsibleAccordionComponent {
    constructor(parentAccordion) {
        this.parentAccordion = parentAccordion;
        /**
         * Assures that only one Collapsible panel can be opened at a time.
         */
        this.closeOthers = false;
        /**
         * When true displays the first panel on load.
         */
        this.openFirst = false;
        this.collapsiblePanels = new Map();
        this.nestedAccordions = new Set();
        this.closeOtherPanels = (panel) => (value) => {
            if (!value) {
                return;
            }
            if (!this.closeOthers) {
                return;
            }
            this.collapsiblePanels.forEach((_, item) => {
                if (panel !== item) {
                    item.isOpen = false;
                }
            });
        };
    }
    /**
     * When true the Accordion will inherit the parent Accordion behaviour.
     */
    set obeyParentAccordion(obey) {
        if (!this.parentAccordion) {
            return;
        }
        if (obey) {
            this.parentAccordion.registerNestedAccordion(this);
        }
        else {
            this.parentAccordion.unregisterNestedAccordion(this);
        }
    }
    ngOnDestroy() {
        this.obeyParentAccordion = false;
    }
    registerNestedAccordion(childAccordion) {
        this.nestedAccordions.add(childAccordion);
    }
    unregisterNestedAccordion(childAccordion) {
        this.nestedAccordions.delete(childAccordion);
    }
    registerNestedPanel(panel) {
        const subscription = panel.isOpenChange.subscribe(this.closeOtherPanels(panel));
        this.collapsiblePanels.set(panel, subscription);
    }
    unregisterNestedPanel(panel) {
        const subscription = this.collapsiblePanels.get(panel);
        if (subscription) {
            subscription.unsubscribe();
        }
        this.collapsiblePanels.delete(panel);
    }
    expandAll() {
        if (this.closeOthers) {
            return;
        }
        this.setPanelsState(true);
        this.setNestedAccordionsState(true);
    }
    collapseAll() {
        this.setPanelsState(false);
        this.setNestedAccordionsState(false);
    }
    ngAfterContentInit() {
        if (this.openFirst) {
            this.collapsiblePanels.keys().next().value.isOpen = true;
        }
    }
    setPanelsState(isOpen) {
        this.collapsiblePanels.forEach((_, panel) => (panel.isOpen = isOpen));
    }
    setNestedAccordionsState(isOpen) {
        this.nestedAccordions.forEach((accordion) => {
            if (isOpen) {
                accordion.expandAll();
            }
            else {
                accordion.collapseAll();
            }
        });
    }
}
CollapsibleAccordionComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: CollapsibleAccordionComponent, deps: [{ token: CollapsibleAccordionComponent, optional: true, skipSelf: true }], target: i0.ɵɵFactoryTarget.Component });
CollapsibleAccordionComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: CollapsibleAccordionComponent, selector: "bb-collapsible-accordion-ui", inputs: { closeOthers: "closeOthers", openFirst: "openFirst", obeyParentAccordion: "obeyParentAccordion" }, ngImport: i0, template: "<ng-content></ng-content>\n" });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: CollapsibleAccordionComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-collapsible-accordion-ui',
                    templateUrl: 'collapsible-accordion.component.html',
                }]
        }], ctorParameters: function () { return [{ type: CollapsibleAccordionComponent, decorators: [{
                    type: Optional
                }, {
                    type: SkipSelf
                }] }]; }, propDecorators: { closeOthers: [{
                type: Input
            }], openFirst: [{
                type: Input
            }], obeyParentAccordion: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFwc2libGUtYWNjb3JkaW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvdWktYW5nL2NvbGxhcHNpYmxlLWFjY29yZGlvbi9jb2xsYXBzaWJsZS1hY2NvcmRpb24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvY29sbGFwc2libGUtYWNjb3JkaW9uL2NvbGxhcHNpYmxlLWFjY29yZGlvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQW9CLFNBQVMsRUFBZ0IsS0FBSyxFQUFhLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBU2hIOzs7Ozs7R0FNRztBQUtILE1BQU0sT0FBTyw2QkFBNkI7SUE0QnhDLFlBR21CLGVBQThDO1FBQTlDLG9CQUFlLEdBQWYsZUFBZSxDQUErQjtRQTlCakU7O1dBRUc7UUFDTSxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUM3Qjs7V0FFRztRQUNNLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFpQlYsc0JBQWlCLEdBQUcsSUFBSSxHQUFHLEVBQThCLENBQUM7UUFDMUQscUJBQWdCLEdBQUcsSUFBSSxHQUFHLEVBQWlDLENBQUM7UUFvRDVELHFCQUFnQixHQUFHLENBQUMsS0FBbUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFjLEVBQUUsRUFBRTtZQUM5RSxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNWLE9BQU87YUFDUjtZQUVELElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNyQixPQUFPO2FBQ1I7WUFFRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFO2dCQUN6QyxJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUU7b0JBQ2xCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2lCQUNyQjtZQUNI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V0FBVyxFQUFFLHNDQUFzQztpQkFDcEQ7MERBZ0NxQyw2QkFBNkI7MEJBRjlELFFBQVE7OzBCQUNSLFFBQVE7NENBMUJGLFdBQVc7c0JBQW5CLEtBQUs7Z0JBSUcsU0FBUztzQkFBakIsS0FBSztnQkFLRixtQkFBbUI7c0JBRHRCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlckNvbnRlbnRJbml0LCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT3B0aW9uYWwsIFNraXBTZWxmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IGludGVyZmFjZSBJQ29sbGFwc2libGUgZXh0ZW5kcyBPbkRlc3Ryb3kge1xuICB0b2dnbGU6ICgpID0+IHZvaWQ7XG4gIGlzT3BlbjogYm9vbGVhbjtcbiAgaXNPcGVuQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj47XG59XG5cbi8qKlxuICogQG5hbWUgQ29sbGFwc2libGVBY2NvcmRpb25Db21wb25lbnRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbXBvbmVudCB0aGF0IGdyb3VwcyBDb2xsYXBzaWJsZSBjb21wb25lbnRzIHRvIHNob3cgdGhlbSBpbiBhbiBhY2NvcmRpb24gZmFzaGlvbi5cbiAqIEl0IGNhbiBhc3N1cmUgdGhhdCBvbmx5IG9uZSBDb2xsYXBzaWJsZSBwYW5lbCBjYW4gYmUgb3BlbmVkIGF0IGEgdGltZVxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1jb2xsYXBzaWJsZS1hY2NvcmRpb24tdWknLFxuICB0ZW1wbGF0ZVVybDogJ2NvbGxhcHNpYmxlLWFjY29yZGlvbi5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIENvbGxhcHNpYmxlQWNjb3JkaW9uQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIEFzc3VyZXMgdGhhdCBvbmx5IG9uZSBDb2xsYXBzaWJsZSBwYW5lbCBjYW4gYmUgb3BlbmVkIGF0IGEgdGltZS5cbiAgICovXG4gIEBJbnB1dCgpIGNsb3NlT3RoZXJzID0gZmFsc2U7XG4gIC8qKlxuICAgKiBXaGVuIHRydWUgZGlzcGxheXMgdGhlIGZpcnN0IHBhbmVsIG9uIGxvYWQuXG4gICAqL1xuICBASW5wdXQoKSBvcGVuRmlyc3QgPSBmYWxzZTtcbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSB0aGUgQWNjb3JkaW9uIHdpbGwgaW5oZXJpdCB0aGUgcGFyZW50IEFjY29yZGlvbiBiZWhhdmlvdXIuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgb2JleVBhcmVudEFjY29yZGlvbihvYmV5OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLnBhcmVudEFjY29yZGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChvYmV5KSB7XG4gICAgICB0aGlzLnBhcmVudEFjY29yZGlvbi5yZWdpc3Rlck5lc3RlZEFjY29yZGlvbih0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wYXJlbnRBY2NvcmRpb24udW5yZWdpc3Rlck5lc3RlZEFjY29yZGlvbih0aGlzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlYWRvbmx5IGNvbGxhcHNpYmxlUGFuZWxzID0gbmV3IE1hcDxJQ29sbGFwc2libGUsIFN1YnNjcmlwdGlvbj4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBuZXN0ZWRBY2NvcmRpb25zID0gbmV3IFNldDxDb2xsYXBzaWJsZUFjY29yZGlvbkNvbXBvbmVudD4oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBTa2lwU2VsZigpXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXJlbnRBY2NvcmRpb246IENvbGxhcHNpYmxlQWNjb3JkaW9uQ29tcG9uZW50LFxuICApIHt9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5vYmV5UGFyZW50QWNjb3JkaW9uID0gZmFsc2U7XG4gIH1cblxuICByZWdpc3Rlck5lc3RlZEFjY29yZGlvbihjaGlsZEFjY29yZGlvbjogQ29sbGFwc2libGVBY2NvcmRpb25Db21wb25lbnQpIHtcbiAgICB0aGlzLm5lc3RlZEFjY29yZGlvbnMuYWRkKGNoaWxkQWNjb3JkaW9uKTtcbiAgfVxuXG4gIHVucmVnaXN0ZXJOZXN0ZWRBY2NvcmRpb24oY2hpbGRBY2NvcmRpb246IENvbGxhcHNpYmxlQWNjb3JkaW9uQ29tcG9uZW50KSB7XG4gICAgdGhpcy5uZXN0ZWRBY2NvcmRpb25zLmRlbGV0ZShjaGlsZEFjY29yZGlvbik7XG4gIH1cblxuICByZWdpc3Rlck5lc3RlZFBhbmVsKHBhbmVsOiBJQ29sbGFwc2libGUpIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBwYW5lbC5pc09wZW5DaGFuZ2Uuc3Vic2NyaWJlKHRoaXMuY2xvc2VPdGhlclBhbmVscyhwYW5lbCkpO1xuICAgIHRoaXMuY29sbGFwc2libGVQYW5lbHMuc2V0KHBhbmVsLCBzdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgdW5yZWdpc3Rlck5lc3RlZFBhbmVsKHBhbmVsOiBJQ29sbGFwc2libGUpIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLmNvbGxhcHNpYmxlUGFuZWxzLmdldChwYW5lbCk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xuICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIHRoaXMuY29sbGFwc2libGVQYW5lbHMuZGVsZXRlKHBhbmVsKTtcbiAgfVxuXG4gIGV4cGFuZEFsbCgpIHtcbiAgICBpZiAodGhpcy5jbG9zZU90aGVycykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNldFBhbmVsc1N0YXRlKHRydWUpO1xuICAgIHRoaXMuc2V0TmVzdGVkQWNjb3JkaW9uc1N0YXRlKHRydWUpO1xuICB9XG5cbiAgY29sbGFwc2VBbGwoKSB7XG4gICAgdGhpcy5zZXRQYW5lbHNTdGF0ZShmYWxzZSk7XG4gICAgdGhpcy5zZXROZXN0ZWRBY2NvcmRpb25zU3RhdGUoZmFsc2UpO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIGlmICh0aGlzLm9wZW5GaXJzdCkge1xuICAgICAgdGhpcy5jb2xsYXBzaWJsZVBhbmVscy5rZXlzKCkubmV4dCgpLnZhbHVlLmlzT3BlbiA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWFkb25seSBjbG9zZU90aGVyUGFuZWxzID0gKHBhbmVsOiBJQ29sbGFwc2libGUpID0+ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuY2xvc2VPdGhlcnMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbGxhcHNpYmxlUGFuZWxzLmZvckVhY2goKF8sIGl0ZW0pID0+IHtcbiAgICAgIGlmIChwYW5lbCAhPT0gaXRlbSkge1xuICAgICAgICBpdGVtLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHByaXZhdGUgc2V0UGFuZWxzU3RhdGUoaXNPcGVuOiBib29sZWFuKSB7XG4gICAgdGhpcy5jb2xsYXBzaWJsZVBhbmVscy5mb3JFYWNoKChfLCBwYW5lbCkgPT4gKHBhbmVsLmlzT3BlbiA9IGlzT3BlbikpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXROZXN0ZWRBY2NvcmRpb25zU3RhdGUoaXNPcGVuOiBib29sZWFuKSB7XG4gICAgdGhpcy5uZXN0ZWRBY2NvcmRpb25zLmZvckVhY2goKGFjY29yZGlvbikgPT4ge1xuICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICBhY2NvcmRpb24uZXhwYW5kQWxsKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhY2NvcmRpb24uY29sbGFwc2VBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuIl19