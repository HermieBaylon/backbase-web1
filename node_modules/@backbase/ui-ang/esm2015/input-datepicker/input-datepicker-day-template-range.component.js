import { ChangeDetectionStrategy, Component, EventEmitter, HostListener, Input, Output, } from '@angular/core';
import { NgbDate, NgbDateParserFormatter } from '@ng-bootstrap/ng-bootstrap';
import { NgbDateLocaleParserFormatter } from './input-datepicker-formatter';
import { DatePipe } from '@angular/common';
import { KEY_CODES } from '@backbase/ui-ang/util';
import { BrowserService, NAVIGATOR_TOKEN, navigatorFactory } from '@backbase/ui-ang/services';
import * as i0 from "@angular/core";
import * as i1 from "./input-datepicker-formatter";
import * as i2 from "@backbase/ui-ang/services";
import * as i3 from "@angular/common";
/* eslint-disable */
export var Key;
(function (Key) {
    Key[Key["ArrowLeft"] = 37] = "ArrowLeft";
    Key[Key["ArrowUp"] = 38] = "ArrowUp";
    Key[Key["ArrowRight"] = 39] = "ArrowRight";
    Key[Key["ArrowDown"] = 40] = "ArrowDown";
})(Key || (Key = {}));
export class InputDatepickerDayTemplateRangeComponent {
    constructor(formatterHelper, browserService) {
        this.formatterHelper = formatterHelper;
        this.browserService = browserService;
        /**
         * When true the date is rendered as disabled
         */
        this.disabled = false;
        /**
         * Selected "from" date
         */
        this.fromDate = null;
        /**
         * Selected "to" date
         */
        this.toDate = null;
        /**
         * If "true" the datepicker is displayed with two input fields for "from" and "to" dates
         */
        this.splitRange = false;
        /**
         * "true" when "splitRange" is "true" and the parent datepicker belongs to
         * second datepicker input (the one for "to" date)
         */
        this.toDateDatepicker = false;
        /**
         * Hovered date by a user
         */
        this.hoveredDate = null;
        /**
         * Date range
         */
        this.rangeSelect = new EventEmitter();
        /**
         * Event to trigger on date hover
         */
        this.hovered = new EventEmitter();
        /**
         * Prevent keypress to be called on toggle button enter
         */
        this.firstKey = true;
        /**
         * Indicates if the date is between the from-date and the hovered date
         */
        this.isWithinRangeHover = false;
        /**
         * Indicates if the date is between the from-date and the to-date date
         */
        this.isWithinSelectedRange = false;
        /**
         * Indicates if the date displayed as greyed out
         */
        this.isTextMuted = false;
        /**
         * Indicates if the date is hovered the range
         */
        this.isHovered = false;
        /**
         * Indicates if the date is the from-date of the range
         */
        this.isFrom = false;
        /**
         * Indicates if the the date is the to-date of the range
         */
        this.isTo = false;
        /**
         * Formatted date
         */
        this.formattedDate = '';
        this.isIE = this.browserService.browserIsMSIE();
    }
    get withinHoverRangeSingle() {
        return (!this.toDate &&
            (this.date.after(this.fromDate) || this.date.equals(this.fromDate)) &&
            (this.date.before(this.hoveredDate) || this.date.equals(this.hoveredDate)));
    }
    get withinHoverRangeSplitTo() {
        return ((this.date.before(this.hoveredDate) || this.date.equals(this.hoveredDate)) &&
            (this.date.after(this.toDate) ||
                this.date.equals(this.toDate) ||
                (this.date.before(this.toDate) && this.date.after(this.fromDate))) &&
            this.toDateDatepicker);
    }
    get withinHoverRangeSplitFrom() {
        return ((this.date.after(this.hoveredDate) || this.date.equals(this.hoveredDate)) &&
            this.date.before(this.toDate) &&
            !this.toDateDatepicker &&
            this.toDate);
    }
    /* eslint-disable complexity */
    ngOnChanges(changes) {
        var _a, _b, _c, _d;
        if (changes === null || changes === void 0 ? void 0 : changes.hoveredDate) {
            this.isWithinRangeHover = !!(this.isValidRange() &&
                this.date &&
                this.hoveredDate &&
                (((this.withinHoverRangeSplitTo || this.withinHoverRangeSplitFrom) && this.splitRange) ||
                    (this.withinHoverRangeSingle && this.toDateDatepicker && this.splitRange) ||
                    (this.withinHoverRangeSingle && !this.splitRange)));
            this.isHovered = (_a = this.date) === null || _a === void 0 ? void 0 : _a.equals(this.hoveredDate);
        }
        if ((changes === null || changes === void 0 ? void 0 : changes.fromDate) || (changes === null || changes === void 0 ? void 0 : changes.toDate) || (changes === null || changes === void 0 ? void 0 : changes.date)) {
            this.isWithinSelectedRange = this.date && this.date.before(this.toDate) && this.date.after(this.fromDate);
            this.isTo = (_b = this.date) === null || _b === void 0 ? void 0 : _b.equals(this.toDate);
            this.formattedDate = this.formatterHelper.format(this.date);
            this.isFrom = (_c = this.date) === null || _c === void 0 ? void 0 : _c.equals(this.fromDate);
        }
        this.isTextMuted =
            !this.isWithinRangeHover &&
                !this.isWithinSelectedRange &&
                !this.isFrom &&
                !this.isTo &&
                (this.disabled || ((_d = this.date) === null || _d === void 0 ? void 0 : _d.month) !== +this.currentMonth);
    }
    /**
     *
     * @description
     * Handle mouseover. Emit the hovered date with null.
     *
     */
    onMouseOut() {
        this.hovered.emit({ date: null, isTo: this.toDateDatepicker, isSelecting: false });
    }
    /**
     *
     * @description
     * Handle mouseover. Emit the hovered date with date.
     *
     */
    onMouseOver() {
        this.hovered.emit({ date: this.date, isTo: this.toDateDatepicker, isSelecting: true });
    }
    /**
     * @description
     * Keypress handler
     *
     * @param evt
     * @param curMonth
     * @param curDay
     * @param date
     */
    onKeyUp(event) {
        const day = event.target.textContent;
        const matchKey = this.isIE
            ? Object.values(Key).includes(event === null || event === void 0 ? void 0 : event.keyCode)
            : InputDatepickerDayTemplateRangeComponent.hangledKeyCodes.includes(event === null || event === void 0 ? void 0 : event.key);
        if (Number(day) === this.date.day && Number(this.currentMonth) === this.date.month && matchKey) {
            this.hovered.emit({ date: this.date, isTo: this.toDateDatepicker, isSelecting: true });
        }
    }
    isValidRange() {
        return (!this.fromDate ||
            !this.toDate ||
            new NgbDate(this.fromDate.year, this.fromDate.month, this.fromDate.day).before(this.toDate));
    }
}
InputDatepickerDayTemplateRangeComponent.hangledKeyCodes = [KEY_CODES.LEFT, KEY_CODES.UP, KEY_CODES.RIGHT, KEY_CODES.DOWN];
InputDatepickerDayTemplateRangeComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: InputDatepickerDayTemplateRangeComponent, deps: [{ token: i1.NgbDateLocaleParserFormatter }, { token: i2.BrowserService }], target: i0.ɵɵFactoryTarget.Component });
InputDatepickerDayTemplateRangeComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: InputDatepickerDayTemplateRangeComponent, selector: "bb-input-datepicker-range-day-template-ui", inputs: { date: "date", disabled: "disabled", currentMonth: "currentMonth", fromDate: "fromDate", toDate: "toDate", splitRange: "splitRange", toDateDatepicker: "toDateDatepicker", hoveredDate: "hoveredDate" }, outputs: { rangeSelect: "rangeSelect", hovered: "hovered" }, host: { listeners: { "mouseout": "onMouseOut()", "mouseover": "onMouseOver()", "document:keyup": "onKeyUp($event)" } }, providers: [
        DatePipe,
        NgbDateLocaleParserFormatter,
        {
            provide: NgbDateParserFormatter,
            useExisting: NgbDateLocaleParserFormatter,
        },
        BrowserService,
        { provide: NAVIGATOR_TOKEN, useFactory: navigatorFactory },
    ], usesOnChanges: true, ngImport: i0, template: "<time\n  class=\"custom-day text-center bb-input-datepicker__custom-day\"\n  [ngClass]=\"{\n    'is-range-selected': isWithinSelectedRange,\n    'is-faded': isWithinRangeHover,\n    'is-faded-from-date': isWithinRangeHover && !toDateDatepicker && splitRange,\n    'is-hovered': isHovered,\n    'text-muted': isTextMuted,\n    'from-date': isFrom,\n    'to-date': isTo\n  }\"\n  [attr.data-role]=\"'calendar-date-item'\"\n  [dateTime]=\"formattedDate\"\n>\n  {{ date?.day }}\n</time>\n", directives: [{ type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: InputDatepickerDayTemplateRangeComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-input-datepicker-range-day-template-ui',
                    templateUrl: './input-datepicker-day-template-range.component.html',
                    providers: [
                        DatePipe,
                        NgbDateLocaleParserFormatter,
                        {
                            provide: NgbDateParserFormatter,
                            useExisting: NgbDateLocaleParserFormatter,
                        },
                        BrowserService,
                        { provide: NAVIGATOR_TOKEN, useFactory: navigatorFactory },
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.NgbDateLocaleParserFormatter }, { type: i2.BrowserService }]; }, propDecorators: { date: [{
                type: Input
            }], disabled: [{
                type: Input
            }], currentMonth: [{
                type: Input
            }], fromDate: [{
                type: Input
            }], toDate: [{
                type: Input
            }], splitRange: [{
                type: Input
            }], toDateDatepicker: [{
                type: Input
            }], hoveredDate: [{
                type: Input
            }], rangeSelect: [{
                type: Output
            }], hovered: [{
                type: Output
            }], onMouseOut: [{
                type: HostListener,
                args: ['mouseout']
            }], onMouseOver: [{
                type: HostListener,
                args: ['mouseover']
            }], onKeyUp: [{
                type: HostListener,
                args: ['document:keyup', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtZGF0ZXBpY2tlci1kYXktdGVtcGxhdGUtcmFuZ2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvaW5wdXQtZGF0ZXBpY2tlci9pbnB1dC1kYXRlcGlja2VyLWRheS10ZW1wbGF0ZS1yYW5nZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9saWJzL3VpLWFuZy9pbnB1dC1kYXRlcGlja2VyL2lucHV0LWRhdGVwaWNrZXItZGF5LXRlbXBsYXRlLXJhbmdlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFHdkIsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0UsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDNUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDOzs7OztBQUk5RixvQkFBb0I7QUFDcEIsTUFBTSxDQUFOLElBQVksR0FLWDtBQUxELFdBQVksR0FBRztJQUNiLHdDQUFjLENBQUE7SUFDZCxvQ0FBWSxDQUFBO0lBQ1osMENBQWUsQ0FBQTtJQUNmLHdDQUFjLENBQUE7QUFDaEIsQ0FBQyxFQUxXLEdBQUcsS0FBSCxHQUFHLFFBS2Q7QUFpQkQsTUFBTSxPQUFPLHdDQUF3QztJQThIbkQsWUFDbUIsZUFBNkMsRUFDN0MsY0FBOEI7UUFEOUIsb0JBQWUsR0FBZixlQUFlLENBQThCO1FB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RUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRTtLQUMzRCwrQ0N0Q0gsc2VBZ0JBOzRGRHlCYSx3Q0FBd0M7a0JBZnBELFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLDJDQUEyQztvQkFDckQsV0FBVyxFQUFFLHNEQUFzRDtvQkFDbkUsU0FBUyxFQUFFO3dCQUNULFFBQVE7d0JBQ1IsNEJBQTRCO3dCQUM1Qjs0QkFDRSxPQUFPLEVBQUUsc0JBQXNCOzRCQUMvQixXQUFXLEVBQUUsNEJBQTRCO3lCQUMxQzt3QkFDRCxjQUFjO3dCQUNkLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLEVBQUU7cUJBQzNEO29CQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDtnSkFPVSxJQUFJO3NCQUFaLEtBQUs7Z0JBS0csUUFBUTtzQkFBaEIsS0FBSztnQkFLRyxZQUFZO3NCQUFwQixLQUFLO2dCQUtHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBS0csTUFBTTtzQkFBZCxLQUFLO2dCQUtHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBTUcsZ0JBQWdCO3NCQUF4QixLQUFLO2dCQUtHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBS0ksV0FBVztzQkFBcEIsTUFBTTtnQkFLRyxPQUFPO3NCQUFoQixNQUFNO2dCQXNIUCxVQUFVO3NCQURULFlBQVk7dUJBQUMsVUFBVTtnQkFZeEIsV0FBVztzQkFEVixZQUFZO3VCQUFDLFdBQVc7Z0JBZXpCLE9BQU87c0JBRE4sWUFBWTt1QkFBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdiRGF0ZSwgTmdiRGF0ZVBhcnNlckZvcm1hdHRlciB9IGZyb20gJ0BuZy1ib290c3RyYXAvbmctYm9vdHN0cmFwJztcbmltcG9ydCB7IE5nYkRhdGVMb2NhbGVQYXJzZXJGb3JtYXR0ZXIgfSBmcm9tICcuL2lucHV0LWRhdGVwaWNrZXItZm9ybWF0dGVyJztcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEtFWV9DT0RFUyB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvdXRpbCc7XG5pbXBvcnQgeyBCcm93c2VyU2VydmljZSwgTkFWSUdBVE9SX1RPS0VOLCBuYXZpZ2F0b3JGYWN0b3J5IH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBOZ0RhdGVTdHJ1Y3ROdWxsYWJsZSB9IGZyb20gJy4vaW5wdXQtZGF0ZXBpY2tlci5tb2RlbCc7XG5pbXBvcnQgeyBEYXRlUmFuZ2VTZWxlY3Rpb25Nb2RlbCwgUmFuZ2VTZWxlY3RNb2RlbCB9IGZyb20gJy4vaW5wdXQtZGF0ZXBpY2tlci5tb2RlbCc7XG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5leHBvcnQgZW51bSBLZXkge1xuICBBcnJvd0xlZnQgPSAzNyxcbiAgQXJyb3dVcCA9IDM4LFxuICBBcnJvd1JpZ2h0ID0gMzksXG4gIEFycm93RG93biA9IDQwLFxufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1pbnB1dC1kYXRlcGlja2VyLXJhbmdlLWRheS10ZW1wbGF0ZS11aScsXG4gIHRlbXBsYXRlVXJsOiAnLi9pbnB1dC1kYXRlcGlja2VyLWRheS10ZW1wbGF0ZS1yYW5nZS5jb21wb25lbnQuaHRtbCcsXG4gIHByb3ZpZGVyczogW1xuICAgIERhdGVQaXBlLFxuICAgIE5nYkRhdGVMb2NhbGVQYXJzZXJGb3JtYXR0ZXIsXG4gICAge1xuICAgICAgcHJvdmlkZTogTmdiRGF0ZVBhcnNlckZvcm1hdHRlcixcbiAgICAgIHVzZUV4aXN0aW5nOiBOZ2JEYXRlTG9jYWxlUGFyc2VyRm9ybWF0dGVyLFxuICAgIH0sXG4gICAgQnJvd3NlclNlcnZpY2UsXG4gICAgeyBwcm92aWRlOiBOQVZJR0FUT1JfVE9LRU4sIHVzZUZhY3Rvcnk6IG5hdmlnYXRvckZhY3RvcnkgfSxcbiAgXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIElucHV0RGF0ZXBpY2tlckRheVRlbXBsYXRlUmFuZ2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBoYW5nbGVkS2V5Q29kZXM6IHN0cmluZ1tdID0gW0tFWV9DT0RFUy5MRUZULCBLRVlfQ09ERVMuVVAsIEtFWV9DT0RFUy5SSUdIVCwgS0VZX0NPREVTLkRPV05dO1xuXG4gIC8qKlxuICAgKiBEYXRlIHRvIHJlbmRlclxuICAgKi9cbiAgQElucHV0KCkgZGF0ZSE6IE5nYkRhdGU7XG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSB0aGUgZGF0ZSBpcyByZW5kZXJlZCBhcyBkaXNhYmxlZFxuICAgKi9cbiAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcblxuICAvKipcbiAgICogQ3VycmVudE1vbnRoIG9uIHRoZSBkYXRlcGlja2VyIHdpbmRvd1xuICAgKi9cbiAgQElucHV0KCkgY3VycmVudE1vbnRoITogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTZWxlY3RlZCBcImZyb21cIiBkYXRlXG4gICAqL1xuICBASW5wdXQoKSBmcm9tRGF0ZTogTmdEYXRlU3RydWN0TnVsbGFibGUgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBTZWxlY3RlZCBcInRvXCIgZGF0ZVxuICAgKi9cbiAgQElucHV0KCkgdG9EYXRlOiBOZ0RhdGVTdHJ1Y3ROdWxsYWJsZSA9IG51bGw7XG5cbiAgLyoqXG4gICAqIElmIFwidHJ1ZVwiIHRoZSBkYXRlcGlja2VyIGlzIGRpc3BsYXllZCB3aXRoIHR3byBpbnB1dCBmaWVsZHMgZm9yIFwiZnJvbVwiIGFuZCBcInRvXCIgZGF0ZXNcbiAgICovXG4gIEBJbnB1dCgpIHNwbGl0UmFuZ2UgPSBmYWxzZTtcblxuICAvKipcbiAgICogXCJ0cnVlXCIgd2hlbiBcInNwbGl0UmFuZ2VcIiBpcyBcInRydWVcIiBhbmQgdGhlIHBhcmVudCBkYXRlcGlja2VyIGJlbG9uZ3MgdG9cbiAgICogc2Vjb25kIGRhdGVwaWNrZXIgaW5wdXQgKHRoZSBvbmUgZm9yIFwidG9cIiBkYXRlKVxuICAgKi9cbiAgQElucHV0KCkgdG9EYXRlRGF0ZXBpY2tlciA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBIb3ZlcmVkIGRhdGUgYnkgYSB1c2VyXG4gICAqL1xuICBASW5wdXQoKSBob3ZlcmVkRGF0ZTogTmdEYXRlU3RydWN0TnVsbGFibGUgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBEYXRlIHJhbmdlXG4gICAqL1xuICBAT3V0cHV0KCkgcmFuZ2VTZWxlY3QgPSBuZXcgRXZlbnRFbWl0dGVyPFJhbmdlU2VsZWN0TW9kZWw+KCk7XG5cbiAgLyoqXG4gICAqIEV2ZW50IHRvIHRyaWdnZXIgb24gZGF0ZSBob3ZlclxuICAgKi9cbiAgQE91dHB1dCgpIGhvdmVyZWQgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGVSYW5nZVNlbGVjdGlvbk1vZGVsPigpO1xuXG4gIC8qKlxuICAgKiBQcmV2ZW50IGtleXByZXNzIHRvIGJlIGNhbGxlZCBvbiB0b2dnbGUgYnV0dG9uIGVudGVyXG4gICAqL1xuICBmaXJzdEtleSA9IHRydWU7XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyBpZiB0aGUgZGF0ZSBpcyBiZXR3ZWVuIHRoZSBmcm9tLWRhdGUgYW5kIHRoZSBob3ZlcmVkIGRhdGVcbiAgICovXG4gIGlzV2l0aGluUmFuZ2VIb3ZlciA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRhdGUgaXMgYmV0d2VlbiB0aGUgZnJvbS1kYXRlIGFuZCB0aGUgdG8tZGF0ZSBkYXRlXG4gICAqL1xuICBpc1dpdGhpblNlbGVjdGVkUmFuZ2UgPSBmYWxzZTtcblxuICAvKipcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBkYXRlIGRpc3BsYXllZCBhcyBncmV5ZWQgb3V0XG4gICAqL1xuICBpc1RleHRNdXRlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRhdGUgaXMgaG92ZXJlZCB0aGUgcmFuZ2VcbiAgICovXG4gIGlzSG92ZXJlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRhdGUgaXMgdGhlIGZyb20tZGF0ZSBvZiB0aGUgcmFuZ2VcbiAgICovXG4gIGlzRnJvbSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIHRoZSBkYXRlIGlzIHRoZSB0by1kYXRlIG9mIHRoZSByYW5nZVxuICAgKi9cbiAgaXNUbyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBGb3JtYXR0ZWQgZGF0ZVxuICAgKi9cbiAgZm9ybWF0dGVkRGF0ZSA9ICcnO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGJyb3dzZXIgaXMgSUVcbiAgICovXG4gIGlzSUU6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBnZXQgd2l0aGluSG92ZXJSYW5nZVNpbmdsZSgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgIXRoaXMudG9EYXRlICYmXG4gICAgICAodGhpcy5kYXRlLmFmdGVyKHRoaXMuZnJvbURhdGUpIHx8IHRoaXMuZGF0ZS5lcXVhbHModGhpcy5mcm9tRGF0ZSkpICYmXG4gICAgICAodGhpcy5kYXRlLmJlZm9yZSh0aGlzLmhvdmVyZWREYXRlKSB8fCB0aGlzLmRhdGUuZXF1YWxzKHRoaXMuaG92ZXJlZERhdGUpKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCB3aXRoaW5Ib3ZlclJhbmdlU3BsaXRUbygpIHtcbiAgICByZXR1cm4gKFxuICAgICAgKHRoaXMuZGF0ZS5iZWZvcmUodGhpcy5ob3ZlcmVkRGF0ZSkgfHwgdGhpcy5kYXRlLmVxdWFscyh0aGlzLmhvdmVyZWREYXRlKSkgJiZcbiAgICAgICh0aGlzLmRhdGUuYWZ0ZXIodGhpcy50b0RhdGUpIHx8XG4gICAgICAgIHRoaXMuZGF0ZS5lcXVhbHModGhpcy50b0RhdGUpIHx8XG4gICAgICAgICh0aGlzLmRhdGUuYmVmb3JlKHRoaXMudG9EYXRlKSAmJiB0aGlzLmRhdGUuYWZ0ZXIodGhpcy5mcm9tRGF0ZSkpKSAmJlxuICAgICAgdGhpcy50b0RhdGVEYXRlcGlja2VyXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IHdpdGhpbkhvdmVyUmFuZ2VTcGxpdEZyb20oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICh0aGlzLmRhdGUuYWZ0ZXIodGhpcy5ob3ZlcmVkRGF0ZSkgfHwgdGhpcy5kYXRlLmVxdWFscyh0aGlzLmhvdmVyZWREYXRlKSkgJiZcbiAgICAgIHRoaXMuZGF0ZS5iZWZvcmUodGhpcy50b0RhdGUpICYmXG4gICAgICAhdGhpcy50b0RhdGVEYXRlcGlja2VyICYmXG4gICAgICB0aGlzLnRvRGF0ZVxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZvcm1hdHRlckhlbHBlcjogTmdiRGF0ZUxvY2FsZVBhcnNlckZvcm1hdHRlcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJyb3dzZXJTZXJ2aWNlOiBCcm93c2VyU2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5pc0lFID0gdGhpcy5icm93c2VyU2VydmljZS5icm93c2VySXNNU0lFKCk7XG4gIH1cblxuICAvKiBlc2xpbnQtZGlzYWJsZSBjb21wbGV4aXR5ICovXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoY2hhbmdlcz8uaG92ZXJlZERhdGUpIHtcbiAgICAgIHRoaXMuaXNXaXRoaW5SYW5nZUhvdmVyID0gISEoXG4gICAgICAgIHRoaXMuaXNWYWxpZFJhbmdlKCkgJiZcbiAgICAgICAgdGhpcy5kYXRlICYmXG4gICAgICAgIHRoaXMuaG92ZXJlZERhdGUgJiZcbiAgICAgICAgKCgodGhpcy53aXRoaW5Ib3ZlclJhbmdlU3BsaXRUbyB8fCB0aGlzLndpdGhpbkhvdmVyUmFuZ2VTcGxpdEZyb20pICYmIHRoaXMuc3BsaXRSYW5nZSkgfHxcbiAgICAgICAgICAodGhpcy53aXRoaW5Ib3ZlclJhbmdlU2luZ2xlICYmIHRoaXMudG9EYXRlRGF0ZXBpY2tlciAmJiB0aGlzLnNwbGl0UmFuZ2UpIHx8XG4gICAgICAgICAgKHRoaXMud2l0aGluSG92ZXJSYW5nZVNpbmdsZSAmJiAhdGhpcy5zcGxpdFJhbmdlKSlcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuaXNIb3ZlcmVkID0gdGhpcy5kYXRlPy5lcXVhbHModGhpcy5ob3ZlcmVkRGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXM/LmZyb21EYXRlIHx8IGNoYW5nZXM/LnRvRGF0ZSB8fCBjaGFuZ2VzPy5kYXRlKSB7XG4gICAgICB0aGlzLmlzV2l0aGluU2VsZWN0ZWRSYW5nZSA9IHRoaXMuZGF0ZSAmJiB0aGlzLmRhdGUuYmVmb3JlKHRoaXMudG9EYXRlKSAmJiB0aGlzLmRhdGUuYWZ0ZXIodGhpcy5mcm9tRGF0ZSk7XG4gICAgICB0aGlzLmlzVG8gPSB0aGlzLmRhdGU/LmVxdWFscyh0aGlzLnRvRGF0ZSk7XG4gICAgICB0aGlzLmZvcm1hdHRlZERhdGUgPSB0aGlzLmZvcm1hdHRlckhlbHBlci5mb3JtYXQodGhpcy5kYXRlKTtcbiAgICAgIHRoaXMuaXNGcm9tID0gdGhpcy5kYXRlPy5lcXVhbHModGhpcy5mcm9tRGF0ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5pc1RleHRNdXRlZCA9XG4gICAgICAhdGhpcy5pc1dpdGhpblJhbmdlSG92ZXIgJiZcbiAgICAgICF0aGlzLmlzV2l0aGluU2VsZWN0ZWRSYW5nZSAmJlxuICAgICAgIXRoaXMuaXNGcm9tICYmXG4gICAgICAhdGhpcy5pc1RvICYmXG4gICAgICAodGhpcy5kaXNhYmxlZCB8fCB0aGlzLmRhdGU/Lm1vbnRoICE9PSArdGhpcy5jdXJyZW50TW9udGgpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBIYW5kbGUgbW91c2VvdmVyLiBFbWl0IHRoZSBob3ZlcmVkIGRhdGUgd2l0aCBudWxsLlxuICAgKlxuICAgKi9cbiAgQEhvc3RMaXN0ZW5lcignbW91c2VvdXQnKVxuICBvbk1vdXNlT3V0KCkge1xuICAgIHRoaXMuaG92ZXJlZC5lbWl0KHsgZGF0ZTogbnVsbCwgaXNUbzogdGhpcy50b0RhdGVEYXRlcGlja2VyLCBpc1NlbGVjdGluZzogZmFsc2UgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIEhhbmRsZSBtb3VzZW92ZXIuIEVtaXQgdGhlIGhvdmVyZWQgZGF0ZSB3aXRoIGRhdGUuXG4gICAqXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdtb3VzZW92ZXInKVxuICBvbk1vdXNlT3ZlcigpIHtcbiAgICB0aGlzLmhvdmVyZWQuZW1pdCh7IGRhdGU6IHRoaXMuZGF0ZSwgaXNUbzogdGhpcy50b0RhdGVEYXRlcGlja2VyLCBpc1NlbGVjdGluZzogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogS2V5cHJlc3MgaGFuZGxlclxuICAgKlxuICAgKiBAcGFyYW0gZXZ0XG4gICAqIEBwYXJhbSBjdXJNb250aFxuICAgKiBAcGFyYW0gY3VyRGF5XG4gICAqIEBwYXJhbSBkYXRlXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXl1cCcsIFsnJGV2ZW50J10pXG4gIG9uS2V5VXAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBjb25zdCBkYXkgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS50ZXh0Q29udGVudDtcbiAgICBjb25zdCBtYXRjaEtleSA9IHRoaXMuaXNJRVxuICAgICAgPyBPYmplY3QudmFsdWVzKEtleSkuaW5jbHVkZXMoZXZlbnQ/LmtleUNvZGUpXG4gICAgICA6IElucHV0RGF0ZXBpY2tlckRheVRlbXBsYXRlUmFuZ2VDb21wb25lbnQuaGFuZ2xlZEtleUNvZGVzLmluY2x1ZGVzKGV2ZW50Py5rZXkpO1xuXG4gICAgaWYgKE51bWJlcihkYXkpID09PSB0aGlzLmRhdGUuZGF5ICYmIE51bWJlcih0aGlzLmN1cnJlbnRNb250aCkgPT09IHRoaXMuZGF0ZS5tb250aCAmJiBtYXRjaEtleSkge1xuICAgICAgdGhpcy5ob3ZlcmVkLmVtaXQoeyBkYXRlOiB0aGlzLmRhdGUsIGlzVG86IHRoaXMudG9EYXRlRGF0ZXBpY2tlciwgaXNTZWxlY3Rpbmc6IHRydWUgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1ZhbGlkUmFuZ2UoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICF0aGlzLmZyb21EYXRlIHx8XG4gICAgICAhdGhpcy50b0RhdGUgfHxcbiAgICAgIG5ldyBOZ2JEYXRlKHRoaXMuZnJvbURhdGUueWVhciwgdGhpcy5mcm9tRGF0ZS5tb250aCwgdGhpcy5mcm9tRGF0ZS5kYXkpLmJlZm9yZSh0aGlzLnRvRGF0ZSlcbiAgICApO1xuICB9XG59XG4iLCI8dGltZVxuICBjbGFzcz1cImN1c3RvbS1kYXkgdGV4dC1jZW50ZXIgYmItaW5wdXQtZGF0ZXBpY2tlcl9fY3VzdG9tLWRheVwiXG4gIFtuZ0NsYXNzXT1cIntcbiAgICAnaXMtcmFuZ2Utc2VsZWN0ZWQnOiBpc1dpdGhpblNlbGVjdGVkUmFuZ2UsXG4gICAgJ2lzLWZhZGVkJzogaXNXaXRoaW5SYW5nZUhvdmVyLFxuICAgICdpcy1mYWRlZC1mcm9tLWRhdGUnOiBpc1dpdGhpblJhbmdlSG92ZXIgJiYgIXRvRGF0ZURhdGVwaWNrZXIgJiYgc3BsaXRSYW5nZSxcbiAgICAnaXMtaG92ZXJlZCc6IGlzSG92ZXJlZCxcbiAgICAndGV4dC1tdXRlZCc6IGlzVGV4dE11dGVkLFxuICAgICdmcm9tLWRhdGUnOiBpc0Zyb20sXG4gICAgJ3RvLWRhdGUnOiBpc1RvXG4gIH1cIlxuICBbYXR0ci5kYXRhLXJvbGVdPVwiJ2NhbGVuZGFyLWRhdGUtaXRlbSdcIlxuICBbZGF0ZVRpbWVdPVwiZm9ybWF0dGVkRGF0ZVwiXG4+XG4gIHt7IGRhdGU/LmRheSB9fVxuPC90aW1lPlxuIl19