import { Component, EventEmitter, forwardRef, Input, Output, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject } from 'rxjs';
import { filter, distinctUntilChanged, debounceTime, map } from 'rxjs/operators';
import { InputBaseComponent } from '@backbase/ui-ang/base-classes';
import * as i0 from "@angular/core";
import * as i1 from "@ng-select/ng-select";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
// TODO: set a generic that extends to SelectListItemBase once Ivy check types step supports correctly types
export class SelectListComponent extends InputBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * Flag to determine if the data in the list is loading
         */
        this.loading = false;
        /**
         * Placeholder text to display in the input
         * */
        this.placeholder = '';
        /**
         * Minimum number of characters required before searching for items
         * */
        this.minTermLength = 2;
        /**
         * Maximum number of selected items, 'none' means unlimited
         */
        this.maxSelectedItems = 'none';
        /**
         * Flag to determine if the list allows multiple selection.
         * */
        this.multiple = false;
        /**
         * A list of items to select from based on the input text.
         * */
        this.items = [];
        /**
         * Flag to determine if typeahead should be used to filter the items list.
         * If enabled the items list can not be updated asynchonously as the filtering
         * and the underlying data will get out of sync.
         */
        this.filterEnabled = true;
        /**
         * Output to capture value change event.
         */
        this.valueChange = this._valueChange;
        /**
         * Emitter when search is performed. Outputs search term
         */
        this.search = new EventEmitter();
        /**
         * Emitter when clear is performed.
         */
        this.clear = new EventEmitter();
        /**
         * Delay in ms between autocomplete updates.
         * */
        this.DEBOUNCE_TIME_MS = 500;
        /**
         * Observable of the typeahead input
         */
        this.typeaheadInput$ = new Subject();
        /**
         * Observable of the filtered items
         */
        this.filteredItems$ = this.typeaheadInput$.pipe(filter((term) => term !== null && term.length >= this.minTermLength), distinctUntilChanged(), debounceTime(this.DEBOUNCE_TIME_MS), map((term) => this.items.filter(({ name }) => name.toLowerCase().includes(term.toLowerCase()))));
    }
    writeValue(inputValue) {
        if (inputValue !== null) {
            super.writeValue(inputValue);
        }
        else {
            this.value = inputValue;
            this.cd.markForCheck();
        }
    }
    onSearch(event) {
        const searchTerm = typeof event === 'string' ? event : event.term;
        if (searchTerm.length >= this.minTermLength) {
            this.search.emit(searchTerm);
        }
    }
    ngOnChanges(changes) {
        var _a, _b, _c, _d;
        if (((_b = (_a = changes === null || changes === void 0 ? void 0 : changes.items) === null || _a === void 0 ? void 0 : _a.currentValue) === null || _b === void 0 ? void 0 : _b.length) > 0 && ((_c = this.ngSelect) === null || _c === void 0 ? void 0 : _c.isOpen) === false && ((_d = this.ngSelect) === null || _d === void 0 ? void 0 : _d.searchTerm)) {
            this.ngSelect.isOpen = true;
        }
    }
}
SelectListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: SelectListComponent, deps: null, target: i0.ɵɵFactoryTarget.Component });
SelectListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: SelectListComponent, selector: "bb-select-list-ui", inputs: { loading: "loading", placeholder: "placeholder", minTermLength: "minTermLength", maxSelectedItems: "maxSelectedItems", multiple: "multiple", items: "items", filterEnabled: "filterEnabled" }, outputs: { valueChange: "valueChange", search: "search", clear: "clear" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            multi: true,
            useExisting: forwardRef(() => SelectListComponent),
        },
    ], viewQueries: [{ propertyName: "ngSelect", first: true, predicate: ["select"], descendants: true }], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<label *ngIf=\"label\" [attr.for]=\"id\" [attr.data-role]=\"'select-list-ui-label'\">{{ label }}</label>\n<ng-container *ngIf=\"filterEnabled; else filterDisabled\">\n  <ng-select\n    class=\"bb-select-list\"\n    bindLabel=\"name\"\n    [items]=\"filteredItems$ | async\"\n    [hideSelected]=\"true\"\n    [maxSelectedItems]=\"maxSelectedItems\"\n    [multiple]=\"multiple\"\n    [minTermLength]=\"minTermLength\"\n    [typeahead]=\"typeaheadInput$\"\n    [virtualScroll]=\"true\"\n    [placeholder]=\"placeholder\"\n    [attr.data-role]=\"id\"\n    [ngModel]=\"value\"\n    [loading]=\"loading\"\n    (ngModelChange)=\"onValueChange($event)\"\n    (search)=\"onSearch($event)\"\n    [labelForId]=\"id\"\n    [attr.aria-label]=\"ariaLabel\"\n    [attr.aria-labelledby]=\"ariaLabelledby\"\n    (blur)=\"onBlur($event)\"\n    (focus)=\"onFocus($event)\"\n    (clear)=\"clear.emit()\"\n  >\n  </ng-select>\n</ng-container>\n\n<ng-template #filterDisabled>\n  <ng-select\n    #select\n    class=\"bb-select-list\"\n    bindLabel=\"name\"\n    [items]=\"items\"\n    [hideSelected]=\"true\"\n    [maxSelectedItems]=\"maxSelectedItems\"\n    [multiple]=\"multiple\"\n    [minTermLength]=\"minTermLength\"\n    [virtualScroll]=\"true\"\n    [placeholder]=\"placeholder\"\n    [attr.data-role]=\"id\"\n    [ngModel]=\"value\"\n    [loading]=\"loading\"\n    (ngModelChange)=\"onValueChange($event)\"\n    (search)=\"onSearch($event)\"\n    [labelForId]=\"id\"\n    [attr.aria-label]=\"ariaLabel\"\n    [attr.aria-labelledby]=\"ariaLabelledby\"\n    (blur)=\"onBlur($event)\"\n    (focus)=\"onFocus($event)\"\n    (clear)=\"clear.emit()\"\n  >\n  </ng-select>\n</ng-template>\n", components: [{ type: i1.NgSelectComponent, selector: "ng-select", inputs: ["markFirst", "dropdownPosition", "loading", "closeOnSelect", "hideSelected", "selectOnTab", "bufferAmount", "selectableGroup", "selectableGroupAsModel", "searchFn", "trackByFn", "clearOnBackspace", "labelForId", "inputAttrs", "readonly", "searchWhileComposing", "minTermLength", "editableSearchTerm", "keyDownFn", "multiple", "addTag", "searchable", "clearable", "isOpen", "items", "compareWith", "clearSearchOnAdd", "bindLabel", "placeholder", "notFoundText", "typeToSearchText", "addTagText", "loadingText", "clearAllText", "virtualScroll", "openOnEnter", "appendTo", "bindValue", "appearance", "maxSelectedItems", "groupBy", "groupValue", "tabIndex", "typeahead"], outputs: ["blur", "focus", "change", "open", "close", "search", "clear", "add", "remove", "scroll", "scrollToEnd"] }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }], pipes: { "async": i2.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: SelectListComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-select-list-ui',
                    templateUrl: './select-list.component.html',
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            multi: true,
                            useExisting: forwardRef(() => SelectListComponent),
                        },
                    ],
                }]
        }], propDecorators: { ngSelect: [{
                type: ViewChild,
                args: ['select']
            }], loading: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], minTermLength: [{
                type: Input
            }], maxSelectedItems: [{
                type: Input
            }], multiple: [{
                type: Input
            }], items: [{
                type: Input
            }], filterEnabled: [{
                type: Input
            }], valueChange: [{
                type: Output
            }], search: [{
                type: Output
            }], clear: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvc2VsZWN0LWxpc3Qvc2VsZWN0LWxpc3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvc2VsZWN0LWxpc3Qvc2VsZWN0LWxpc3QuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQWlCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4SCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuRCxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsb0JBQW9CLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7OztBQXNCbkUsNEdBQTRHO0FBQzVHLE1BQU0sT0FBTyxtQkFBZ0QsU0FBUSxrQkFBa0I7SUFadkY7O1FBZUU7O1dBRUc7UUFDTSxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBRXpCOzthQUVLO1FBQ0ksZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFFMUI7O2FBRUs7UUFDSSxrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUUzQjs7V0FFRztRQUNNLHFCQUFnQixHQUFHLE1BQU0sQ0FBQztRQUVuQzs7YUFFSztRQUNJLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFMUI7O2FBRUs7UUFDSSxVQUFLLEdBQVEsRUFBRSxDQUFDO1FBRXpCOzs7O1dBSUc7UUFDTSxrQkFBYSxHQUFHLElBQUksQ0FBQztRQUU5Qjs7V0FFRztRQUNPLGdCQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUUxQzs7V0FFRztRQUNPLFdBQU0sR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUVwRTs7V0FFRztRQUNPLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRTNDOzthQUVLO1FBQ1kscUJBQWdCLEdBQUcsR0FBRyxDQUFDO1FBRXhDOztXQUVHO1FBQ00sb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ2pEOztXQUVHO1FBQ00sbUJBQWMsR0FBb0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQ2xFLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsRUFDcEUsb0JBQW9CLEVBQUUsRUFDdEIsWUFBWSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUNuQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQU8sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQ3JHLENBQUM7S0F3Qkg7SUF0QkMsVUFBVSxDQUFDLFVBQWtDO1FBQzNDLElBQUksVUFBVSxLQUFLLElBQUksRUFBRTtZQUN2QixLQUFLLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQzlCO2FBQU07WUFDTCxJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztZQUN4QixJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3hCO0lBQ0gsQ0FBQztJQUVELFFBQVEsQ0FBQyxLQUE2QjtRQUNwQyxNQUFNLFVBQVUsR0FBRyxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUVsRSxJQUFJLFVBQVUsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUMzQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUM5QjtJQUNILENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7O1FBQ2hDLElBQUksQ0FBQSxNQUFBLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLEtBQUssMENBQUUsWUFBWSwwQ0FBRSxNQUFNLElBQUcsQ0FBQyxJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsUUFBUSwwQ0FBRSxNQUFNLE1BQUssS0FBSyxLQUFJLE1BQUEsSUFBSSxDQUFDLFFBQVEsMENBQUUsVUFBVSxDQUFBLEVBQUU7WUFDNUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQzdCO0lBQ0gsQ0FBQzs7aUhBL0ZVLG1CQUFtQjtxR0FBbkIsbUJBQW1CLCtUQVRuQjtRQUNUO1lBQ0UsT0FBTyxFQUFFLGlCQUFpQjtZQUMxQixLQUFLLEVBQUUsSUFBSTtZQUNYLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsbUJBQW1CLENBQUM7U0FDbkQ7S0FDRiwwS0N6Qkgsd29EQXNEQTs0RkQxQmEsbUJBQW1CO2tCQVovQixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxtQkFBbUI7b0JBQzdCLFdBQVcsRUFBRSw4QkFBOEI7b0JBQzNDLFNBQVMsRUFBRTt3QkFDVDs0QkFDRSxPQUFPLEVBQUUsaUJBQWlCOzRCQUMxQixLQUFLLEVBQUUsSUFBSTs0QkFDWCxXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxvQkFBb0IsQ0FBQzt5QkFDbkQ7cUJBQ0Y7aUJBQ0Y7OEJBR3NCLFFBQVE7c0JBQTVCLFNBQVM7dUJBQUMsUUFBUTtnQkFLVixPQUFPO3NCQUFmLEtBQUs7Z0JBS0csV0FBVztzQkFBbkIsS0FBSztnQkFLRyxhQUFhO3NCQUFyQixLQUFLO2dCQUtHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFLRyxRQUFRO3NCQUFoQixLQUFLO2dCQUtHLEtBQUs7c0JBQWIsS0FBSztnQkFPRyxhQUFhO3NCQUFyQixLQUFLO2dCQUtJLFdBQVc7c0JBQXBCLE1BQU07Z0JBS0csTUFBTTtzQkFBZixNQUFNO2dCQUtHLEtBQUs7c0JBQWQsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBmb3J3YXJkUmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBOZ1NlbGVjdENvbXBvbmVudCB9IGZyb20gJ0BuZy1zZWxlY3Qvbmctc2VsZWN0JztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgZGlzdGluY3RVbnRpbENoYW5nZWQsIGRlYm91bmNlVGltZSwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSW5wdXRCYXNlQ29tcG9uZW50IH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy9iYXNlLWNsYXNzZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdExpc3RJdGVtQmFzZSB7XG4gIG5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hQYXlsb2FkIHtcbiAgdGVybTogc3RyaW5nO1xuICBpdGVtczogQXJyYXk8YW55Pjtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItc2VsZWN0LWxpc3QtdWknLFxuICB0ZW1wbGF0ZVVybDogJy4vc2VsZWN0LWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU2VsZWN0TGlzdENvbXBvbmVudCksXG4gICAgfSxcbiAgXSxcbn0pXG4vLyBUT0RPOiBzZXQgYSBnZW5lcmljIHRoYXQgZXh0ZW5kcyB0byBTZWxlY3RMaXN0SXRlbUJhc2Ugb25jZSBJdnkgY2hlY2sgdHlwZXMgc3RlcCBzdXBwb3J0cyBjb3JyZWN0bHkgdHlwZXNcbmV4cG9ydCBjbGFzcyBTZWxlY3RMaXN0Q29tcG9uZW50PFQgZXh0ZW5kcyB7IG5hbWU6IHN0cmluZyB9PiBleHRlbmRzIElucHV0QmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQoJ3NlbGVjdCcpIG5nU2VsZWN0OiBOZ1NlbGVjdENvbXBvbmVudCB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogRmxhZyB0byBkZXRlcm1pbmUgaWYgdGhlIGRhdGEgaW4gdGhlIGxpc3QgaXMgbG9hZGluZ1xuICAgKi9cbiAgQElucHV0KCkgbG9hZGluZyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBQbGFjZWhvbGRlciB0ZXh0IHRvIGRpc3BsYXkgaW4gdGhlIGlucHV0XG4gICAqICovXG4gIEBJbnB1dCgpIHBsYWNlaG9sZGVyID0gJyc7XG5cbiAgLyoqXG4gICAqIE1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgcmVxdWlyZWQgYmVmb3JlIHNlYXJjaGluZyBmb3IgaXRlbXNcbiAgICogKi9cbiAgQElucHV0KCkgbWluVGVybUxlbmd0aCA9IDI7XG5cbiAgLyoqXG4gICAqIE1heGltdW0gbnVtYmVyIG9mIHNlbGVjdGVkIGl0ZW1zLCAnbm9uZScgbWVhbnMgdW5saW1pdGVkXG4gICAqL1xuICBASW5wdXQoKSBtYXhTZWxlY3RlZEl0ZW1zID0gJ25vbmUnO1xuXG4gIC8qKlxuICAgKiBGbGFnIHRvIGRldGVybWluZSBpZiB0aGUgbGlzdCBhbGxvd3MgbXVsdGlwbGUgc2VsZWN0aW9uLlxuICAgKiAqL1xuICBASW5wdXQoKSBtdWx0aXBsZSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgaXRlbXMgdG8gc2VsZWN0IGZyb20gYmFzZWQgb24gdGhlIGlucHV0IHRleHQuXG4gICAqICovXG4gIEBJbnB1dCgpIGl0ZW1zOiBUW10gPSBbXTtcblxuICAvKipcbiAgICogRmxhZyB0byBkZXRlcm1pbmUgaWYgdHlwZWFoZWFkIHNob3VsZCBiZSB1c2VkIHRvIGZpbHRlciB0aGUgaXRlbXMgbGlzdC5cbiAgICogSWYgZW5hYmxlZCB0aGUgaXRlbXMgbGlzdCBjYW4gbm90IGJlIHVwZGF0ZWQgYXN5bmNob25vdXNseSBhcyB0aGUgZmlsdGVyaW5nXG4gICAqIGFuZCB0aGUgdW5kZXJseWluZyBkYXRhIHdpbGwgZ2V0IG91dCBvZiBzeW5jLlxuICAgKi9cbiAgQElucHV0KCkgZmlsdGVyRW5hYmxlZCA9IHRydWU7XG5cbiAgLyoqXG4gICAqIE91dHB1dCB0byBjYXB0dXJlIHZhbHVlIGNoYW5nZSBldmVudC5cbiAgICovXG4gIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IHRoaXMuX3ZhbHVlQ2hhbmdlO1xuXG4gIC8qKlxuICAgKiBFbWl0dGVyIHdoZW4gc2VhcmNoIGlzIHBlcmZvcm1lZC4gT3V0cHV0cyBzZWFyY2ggdGVybVxuICAgKi9cbiAgQE91dHB1dCgpIHNlYXJjaDogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICAvKipcbiAgICogRW1pdHRlciB3aGVuIGNsZWFyIGlzIHBlcmZvcm1lZC5cbiAgICovXG4gIEBPdXRwdXQoKSBjbGVhciA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogRGVsYXkgaW4gbXMgYmV0d2VlbiBhdXRvY29tcGxldGUgdXBkYXRlcy5cbiAgICogKi9cbiAgcHJpdmF0ZSByZWFkb25seSBERUJPVU5DRV9USU1FX01TID0gNTAwO1xuXG4gIC8qKlxuICAgKiBPYnNlcnZhYmxlIG9mIHRoZSB0eXBlYWhlYWQgaW5wdXRcbiAgICovXG4gIHJlYWRvbmx5IHR5cGVhaGVhZElucHV0JCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcbiAgLyoqXG4gICAqIE9ic2VydmFibGUgb2YgdGhlIGZpbHRlcmVkIGl0ZW1zXG4gICAqL1xuICByZWFkb25seSBmaWx0ZXJlZEl0ZW1zJDogT2JzZXJ2YWJsZTxUW10+ID0gdGhpcy50eXBlYWhlYWRJbnB1dCQucGlwZShcbiAgICBmaWx0ZXIoKHRlcm0pID0+IHRlcm0gIT09IG51bGwgJiYgdGVybS5sZW5ndGggPj0gdGhpcy5taW5UZXJtTGVuZ3RoKSxcbiAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgIGRlYm91bmNlVGltZSh0aGlzLkRFQk9VTkNFX1RJTUVfTVMpLFxuICAgIG1hcCgodGVybSkgPT4gdGhpcy5pdGVtcy5maWx0ZXIoKHsgbmFtZSB9OiBhbnkpID0+IG5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtLnRvTG93ZXJDYXNlKCkpKSksXG4gICk7XG5cbiAgd3JpdGVWYWx1ZShpbnB1dFZhbHVlOiBPYmplY3QgfCBzdHJpbmcgfCBudWxsKTogdm9pZCB7XG4gICAgaWYgKGlucHV0VmFsdWUgIT09IG51bGwpIHtcbiAgICAgIHN1cGVyLndyaXRlVmFsdWUoaW5wdXRWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsdWUgPSBpbnB1dFZhbHVlO1xuICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBvblNlYXJjaChldmVudDogc3RyaW5nIHwgU2VhcmNoUGF5bG9hZCkge1xuICAgIGNvbnN0IHNlYXJjaFRlcm0gPSB0eXBlb2YgZXZlbnQgPT09ICdzdHJpbmcnID8gZXZlbnQgOiBldmVudC50ZXJtO1xuXG4gICAgaWYgKHNlYXJjaFRlcm0ubGVuZ3RoID49IHRoaXMubWluVGVybUxlbmd0aCkge1xuICAgICAgdGhpcy5zZWFyY2guZW1pdChzZWFyY2hUZXJtKTtcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXM/Lml0ZW1zPy5jdXJyZW50VmFsdWU/Lmxlbmd0aCA+IDAgJiYgdGhpcy5uZ1NlbGVjdD8uaXNPcGVuID09PSBmYWxzZSAmJiB0aGlzLm5nU2VsZWN0Py5zZWFyY2hUZXJtKSB7XG4gICAgICB0aGlzLm5nU2VsZWN0LmlzT3BlbiA9IHRydWU7XG4gICAgfVxuICB9XG59XG4iLCI8bGFiZWwgKm5nSWY9XCJsYWJlbFwiIFthdHRyLmZvcl09XCJpZFwiIFthdHRyLmRhdGEtcm9sZV09XCInc2VsZWN0LWxpc3QtdWktbGFiZWwnXCI+e3sgbGFiZWwgfX08L2xhYmVsPlxuPG5nLWNvbnRhaW5lciAqbmdJZj1cImZpbHRlckVuYWJsZWQ7IGVsc2UgZmlsdGVyRGlzYWJsZWRcIj5cbiAgPG5nLXNlbGVjdFxuICAgIGNsYXNzPVwiYmItc2VsZWN0LWxpc3RcIlxuICAgIGJpbmRMYWJlbD1cIm5hbWVcIlxuICAgIFtpdGVtc109XCJmaWx0ZXJlZEl0ZW1zJCB8IGFzeW5jXCJcbiAgICBbaGlkZVNlbGVjdGVkXT1cInRydWVcIlxuICAgIFttYXhTZWxlY3RlZEl0ZW1zXT1cIm1heFNlbGVjdGVkSXRlbXNcIlxuICAgIFttdWx0aXBsZV09XCJtdWx0aXBsZVwiXG4gICAgW21pblRlcm1MZW5ndGhdPVwibWluVGVybUxlbmd0aFwiXG4gICAgW3R5cGVhaGVhZF09XCJ0eXBlYWhlYWRJbnB1dCRcIlxuICAgIFt2aXJ0dWFsU2Nyb2xsXT1cInRydWVcIlxuICAgIFtwbGFjZWhvbGRlcl09XCJwbGFjZWhvbGRlclwiXG4gICAgW2F0dHIuZGF0YS1yb2xlXT1cImlkXCJcbiAgICBbbmdNb2RlbF09XCJ2YWx1ZVwiXG4gICAgW2xvYWRpbmddPVwibG9hZGluZ1wiXG4gICAgKG5nTW9kZWxDaGFuZ2UpPVwib25WYWx1ZUNoYW5nZSgkZXZlbnQpXCJcbiAgICAoc2VhcmNoKT1cIm9uU2VhcmNoKCRldmVudClcIlxuICAgIFtsYWJlbEZvcklkXT1cImlkXCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImFyaWFMYWJlbFwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbGxlZGJ5XT1cImFyaWFMYWJlbGxlZGJ5XCJcbiAgICAoYmx1cik9XCJvbkJsdXIoJGV2ZW50KVwiXG4gICAgKGZvY3VzKT1cIm9uRm9jdXMoJGV2ZW50KVwiXG4gICAgKGNsZWFyKT1cImNsZWFyLmVtaXQoKVwiXG4gID5cbiAgPC9uZy1zZWxlY3Q+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLXRlbXBsYXRlICNmaWx0ZXJEaXNhYmxlZD5cbiAgPG5nLXNlbGVjdFxuICAgICNzZWxlY3RcbiAgICBjbGFzcz1cImJiLXNlbGVjdC1saXN0XCJcbiAgICBiaW5kTGFiZWw9XCJuYW1lXCJcbiAgICBbaXRlbXNdPVwiaXRlbXNcIlxuICAgIFtoaWRlU2VsZWN0ZWRdPVwidHJ1ZVwiXG4gICAgW21heFNlbGVjdGVkSXRlbXNdPVwibWF4U2VsZWN0ZWRJdGVtc1wiXG4gICAgW211bHRpcGxlXT1cIm11bHRpcGxlXCJcbiAgICBbbWluVGVybUxlbmd0aF09XCJtaW5UZXJtTGVuZ3RoXCJcbiAgICBbdmlydHVhbFNjcm9sbF09XCJ0cnVlXCJcbiAgICBbcGxhY2Vob2xkZXJdPVwicGxhY2Vob2xkZXJcIlxuICAgIFthdHRyLmRhdGEtcm9sZV09XCJpZFwiXG4gICAgW25nTW9kZWxdPVwidmFsdWVcIlxuICAgIFtsb2FkaW5nXT1cImxvYWRpbmdcIlxuICAgIChuZ01vZGVsQ2hhbmdlKT1cIm9uVmFsdWVDaGFuZ2UoJGV2ZW50KVwiXG4gICAgKHNlYXJjaCk9XCJvblNlYXJjaCgkZXZlbnQpXCJcbiAgICBbbGFiZWxGb3JJZF09XCJpZFwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbF09XCJhcmlhTGFiZWxcIlxuICAgIFthdHRyLmFyaWEtbGFiZWxsZWRieV09XCJhcmlhTGFiZWxsZWRieVwiXG4gICAgKGJsdXIpPVwib25CbHVyKCRldmVudClcIlxuICAgIChmb2N1cyk9XCJvbkZvY3VzKCRldmVudClcIlxuICAgIChjbGVhcik9XCJjbGVhci5lbWl0KClcIlxuICA+XG4gIDwvbmctc2VsZWN0PlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==