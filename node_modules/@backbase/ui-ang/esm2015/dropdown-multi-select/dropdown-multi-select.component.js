import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, forwardRef, Input, ViewChild, ViewChildren, } from '@angular/core';
import { FormControl, FormGroup, NG_VALUE_ACCESSOR } from '@angular/forms';
import { BehaviorSubject, Subject } from 'rxjs';
import { map, takeUntil, withLatestFrom } from 'rxjs/operators';
import { InputBaseComponent } from '@backbase/ui-ang/base-classes';
import { idListAttr } from '@backbase/ui-ang/util';
import { KEY_CODES } from '@backbase/ui-ang/util';
import { BB_MULTI_SELECT_CHANGE_DETECTION_REF_TOKEN, DropdownMultiSelectOptionComponent, } from './dropdown-multi-select-option.component';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/ui-ang/services";
import * as i2 from "@backbase/foundation-ang/future";
import * as i3 from "@backbase/ui-ang/dropdown-panel";
import * as i4 from "@backbase/ui-ang/icon";
import * as i5 from "@angular/common";
import * as i6 from "@backbase/ui-ang/button";
import * as i7 from "@angular/forms";
/**
 * @name DropdownMultiSelectComponent
 *
 * @description
 * Component that use for DropDown Multi Select.
 */
export class DropdownMultiSelectComponent extends InputBaseComponent {
    constructor(cd, domAttributesService, deprecationsService) {
        super(cd, deprecationsService);
        this.cd = cd;
        this.domAttributesService = domAttributesService;
        this.deprecationsService = deprecationsService;
        this.unsubscribe$ = new Subject();
        /**
         * The placeholder for the multi select.
         */
        this.placeholder = 'No items selected';
        /**
         * The label for the Dropdown multi select. Defaults to an empty string.
         */
        this.label = '';
        /**
         * Enable filtering; Defaults to false.
         */
        this.filtering = false;
        /**
         * Whether the Dropdown multi select is read only. Defaults to false.
         */
        this.readonly = false;
        /**
         * The child option components of type DropDownMultiSelectSingleOption
         */
        this.isIE = navigator.userAgent.indexOf('MSIE ') > -1 || navigator.userAgent.indexOf('Trident/') > -1;
        this.activeOptionIndex = -1;
        this.isOptionsFocused = false;
        this.formGroup = new FormGroup({});
        this.formValue$ = this.formGroup.valueChanges.pipe(map((formValue) => this.getSelectedValues(formValue)), takeUntil(this.unsubscribe$));
        this.labelsMap = {};
        this.buttonLabelId = this.domAttributesService.generateId();
        this.clearOptions$ = new Subject();
        this.selectedValuesSubject$ = new BehaviorSubject([]);
        this.selectedValues$ = this.selectedValuesSubject$.asObservable();
        this.searchKey = '';
        this.cachedValue = {};
        this.isOpen = false;
        this.buttonLabelId = this.domAttributesService.generateId();
        this.formValue$.subscribe(this.selectedValuesSubject$);
        this.formValue$.subscribe((value) => {
            if (value && value.length === 0) {
                this.onChange(undefined);
            }
            else {
                this.onValueChange(value);
            }
        });
        this.clearOptions$
            .pipe(withLatestFrom(this.selectedValues$), takeUntil(this.unsubscribe$))
            .subscribe(([, items]) => {
            items.forEach((item) => {
                this.formGroup.patchValue({ [item]: false }, { emitEvent: false });
            });
            this.formGroup.updateValueAndValidity();
        });
    }
    ngAfterContentInit() {
        if (this.contentOptions) {
            this.contentOptions.forEach(({ value, label }) => {
                this.formGroup.registerControl(value, new FormControl(this.cachedValue[value] || false));
                Object.assign(this.labelsMap, { [value]: label });
            });
            if (Object.keys(this.cachedValue).length) {
                this.formGroup.updateValueAndValidity();
            }
        }
    }
    ngOnDestroy() {
        this.unsubscribe$.next();
        this.unsubscribe$.complete();
    }
    /**
     * Unselect all selected options from the listbox
     *
     * @param $event
     */
    clearAll($event) {
        $event.preventDefault();
        this.clearOptions$.next();
    }
    /**
     *
     * @param index
     * @param item
     */
    trackByValueFn(index, item) {
        return item.value;
    }
    /**
     *
     * @param value
     */
    writeValue(value) {
        const valuesMap = (value || []).reduce((acc, item) => Object.assign(acc, { [item]: true }), {});
        this.cachedValue = valuesMap;
        Object.keys(this.formGroup.controls).forEach((key) => {
            this.formGroup.controls[key].setValue(valuesMap[key] || false, { emitEvent: false });
        });
        this.formGroup.updateValueAndValidity({ emitEvent: false });
        const selectedValues = this.getSelectedValues(this.formGroup.value);
        this.selectedValuesSubject$.next(selectedValues);
    }
    /**
     * Updating labels while searching
     *
     * @param label
     */
    getLabel(label) {
        return this.searchKey.toLocaleLowerCase() === label[0].toLocaleLowerCase() && this.filtering
            ? `<b>${label[0]}</b>${label.substring(1)}`
            : label;
    }
    onListboxFocus() {
        this.activeOptionIndex = 0;
        this.isOptionsFocused = true;
    }
    /* eslint-disable complexity */
    onListboxKeyDown(event) {
        if (!this.disabled && this.isOpen && this.isOptionsFocused) {
            const keyCode = this.isIE ? event.keyCode : event.key;
            switch (keyCode) {
                case 40:
                case KEY_CODES.DOWN:
                    this.activeOptionIndex = Math.min(this.activeOptionIndex + 1, this.options.length - 1);
                    break;
                case 38:
                case KEY_CODES.UP:
                    this.activeOptionIndex = Math.max(this.activeOptionIndex - 1, 0);
                    break;
                case 13:
                case 32:
                case KEY_CODES.ENTER:
                case KEY_CODES.SPACE:
                    this.selectActiveOption();
                    break;
                default:
                    if (this.filtering) {
                        this.searchKey = event.key;
                        this.setActiveOptionBaseOnSearchKey(event.key);
                    }
            }
            // let Tab key to jump out and close the dropdown menu
            if (keyCode !== 9 && keyCode !== KEY_CODES.TAB) {
                event.preventDefault();
            }
        }
    }
    /* eslint-enable complexity */
    /**
     *
     */
    onListboxBlur() {
        this.activeOptionIndex = -1;
        this.isOptionsFocused = false;
    }
    /**
     *
     * @param isOpen
     */
    onDropdownToggle(isOpen) {
        this.activeOptionIndex = -1;
        this.isOptionsFocused = false;
        this.isOpen = isOpen;
    }
    getLabeledByIds(...tokens) {
        return idListAttr(...tokens);
    }
    // only taking consideration the focusable elements of the control
    onFocusOut(event) {
        const nextFocusedElement = event.relatedTarget;
        const focusOutElement = event.target;
        if ((focusOutElement === this.toggleButton.nativeElement &&
            nextFocusedElement !== this.clearAllButton.nativeElement &&
            nextFocusedElement !== this.listbox.nativeElement) ||
            (focusOutElement === this.clearAllButton.nativeElement &&
                nextFocusedElement !== this.toggleButton.nativeElement &&
                nextFocusedElement !== this.listbox.nativeElement) ||
            (focusOutElement === this.listbox.nativeElement &&
                nextFocusedElement !== this.toggleButton.nativeElement &&
                nextFocusedElement !== this.clearAllButton.nativeElement)) {
            super.onBlur();
        }
    }
    getSelectedValues(formValue) {
        return Object.keys(formValue).reduce((acc, key) => {
            if (formValue[key]) {
                acc.push(key);
            }
            return acc;
        }, []);
    }
    selectActiveOption() {
        const el = this.options.toArray()[this.activeOptionIndex];
        el === null || el === void 0 ? void 0 : el.nativeElement.click();
    }
    setActiveOptionBaseOnSearchKey(key) {
        this.activeOptionIndex = this.options
            .toArray()
            .findIndex((item) => key.toLocaleLowerCase() === item.nativeElement.innerText[0].toLocaleLowerCase());
    }
}
DropdownMultiSelectComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMultiSelectComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.DomAttributesService }, { token: i2.DeprecationsService }], target: i0.ɵɵFactoryTarget.Component });
DropdownMultiSelectComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: DropdownMultiSelectComponent, selector: "bb-dropdown-multi-select-ui", inputs: { dropdownHeaderText: "dropdownHeaderText", placeholder: "placeholder", label: "label", filtering: "filtering", readonly: "readonly" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => DropdownMultiSelectComponent),
            multi: true,
        },
        {
            provide: BB_MULTI_SELECT_CHANGE_DETECTION_REF_TOKEN,
            useExisting: ChangeDetectorRef,
        },
    ], queries: [{ propertyName: "contentOptions", predicate: DropdownMultiSelectOptionComponent }], viewQueries: [{ propertyName: "clearAllButton", first: true, predicate: ["clearOptions"], descendants: true }, { propertyName: "dropDownMenu", first: true, predicate: ["dropDownMenu"], descendants: true }, { propertyName: "toggleButton", first: true, predicate: ["toggleButton"], descendants: true }, { propertyName: "listbox", first: true, predicate: ["listbox"], descendants: true }, { propertyName: "options", predicate: ["option"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<label *ngIf=\"label\" for=\"{{ id }}_dropdown-option_input\" [id]=\"'bb-dropdown-multi-select-label' + id\">\n  {{ label }}\n</label>\n<div #dropDownMenu>\n  <bb-dropdown-panel-ui\n    (open)=\"onDropdownToggle($event)\"\n    [ngClass]=\"{ 'bb-dropdown-multi-select--disabled': disabled || readonly }\"\n    class=\"bb-dropdown-multi-select\"\n  >\n    <ng-template bbDropdownToggle let-isOpen=\"isOpen\">\n      <button\n        [attr.data-role]=\"'expand-button'\"\n        #toggleButton\n        [attr.required]=\"required ? true : undefined\"\n        [attr.aria-expanded]=\"isOpen\"\n        [attr.aria-labelledby]=\"getLabeledByIds('bb-dropdown-multi-select-label' + id, ariaLabelledby, buttonLabelId)\"\n        [attr.aria-describedby]=\"ariaDescribedby\"\n        [attr.aria-activedescendant]=\"ariaActivedescendant\"\n        [attr.aria-invalid]=\"ariaInvalid\"\n        [attr.aria-owns]=\"ariaOwns\"\n        [attr.aria-label]=\"ariaLabel\"\n        [disabled]=\"disabled\"\n        aria-haspopup=\"listbox\"\n        (focus)=\"onFocus()\"\n        (focusout)=\"onFocusOut($event)\"\n        class=\"\n          bb-stack--wrap\n          bb-dropdown-multi-select__toggle\n          bb-stack bb-text-align-left\n          bb-stack--align-top\n          form-control\n        \"\n        type=\"button\"\n        id=\"{{ id }}\"\n      >\n        <span class=\"bb-dropdown-multi-select__result\" [id]=\"buttonLabelId\" [attr.data-role]=\"'dropdown-result'\">\n          <span *ngIf=\"(selectedValues$ | async)?.length; else placeholderTemplate\">\n            <ng-container *ngFor=\"let item of selectedValues$ | async; last as last\">\n              {{ labelsMap[item] + (last ? '' : ', ') }}\n            </ng-container>\n          </span>\n          <ng-template #placeholderTemplate>\n            <span class=\"bb-text-support\">{{ placeholder }}</span>\n          </ng-template>\n        </span>\n        <span class=\"bb-stack__item--push-right\">\n          <bb-icon-ui [cropped]=\"true\" [name]=\"isOpen ? 'toggle-up' : 'toggle-down'\"></bb-icon-ui>\n        </span>\n      </button>\n    </ng-template>\n    <ng-template bbDropdownMenu>\n      <div>\n        <button\n          [attr.data-role]=\"'clear-btn'\"\n          #clearOptions\n          bbButton\n          color=\"unstyled\"\n          class=\"bb-dropdown-multi-select__clear-button\"\n          (click)=\"clearAll($event)\"\n          i18n=\"Clear selection button text@@dropdown-multiple-select.clear-selection.button\"\n          (focusout)=\"onFocusOut($event)\"\n        >\n          Clear selection\n        </button>\n      </div>\n      <div class=\"dropdown-divider\"></div>\n      <div *ngIf=\"dropdownHeaderText\" [id]=\"'bb-dropdown-multi-select-header_' + id\" class=\"dropdown-header\">\n        {{ dropdownHeaderText }}\n      </div>\n      <div\n        #listbox\n        role=\"listbox\"\n        aria-multiselectable=\"true\"\n        tabindex=\"0\"\n        [attr.aria-labelledby]=\"dropdownHeaderText ? getLabeledByIds('bb-dropdown-multi-select-header_' + id) : null\"\n        class=\"bb-dropdown-multi-select__options-list\"\n        [attr.aria-activedescendant]=\"\n          activeOptionIndex >= 0 ? 'bb-dropdown-multi-select-option-' + (id + activeOptionIndex) : undefined\n        \"\n        *ngIf=\"contentOptions?.length && formGroup.controls[contentOptions?.first.value]\"\n        (keydown)=\"onListboxKeyDown($event)\"\n        (focus)=\"onListboxFocus()\"\n        (blur)=\"onListboxBlur()\"\n        (focusout)=\"onFocusOut($event)\"\n      >\n        <label\n          *ngFor=\"let contentOption of contentOptions; index as i; trackBy: trackByValueFn\"\n          #option\n          (click)=\"activeOptionIndex = i\"\n          role=\"option\"\n          class=\"dropdown-item dropdown-option\"\n          [ngClass]=\"{\n            'active dropdown-option--active': activeOptionIndex === i,\n            'dropdown-option--selected': !!formGroup.controls[contentOption.value].value\n          }\"\n          [attr.data-role]=\"'option-' + i\"\n          [attr.aria-selected]=\"formGroup.controls[contentOption.value].value\"\n          [id]=\"'bb-dropdown-multi-select-option-' + id + i\"\n        >\n          <input\n            class=\"dropdown-option__input\"\n            type=\"checkbox\"\n            id=\"{{ id }}_dropdown-option_input\"\n            [attr.data-role]=\"'option-' + (id + i + 1)\"\n            [formControl]=\"formGroup.controls[contentOption.value]\"\n          />\n          <span [innerHTML]=\"getLabel(contentOption.label)\"></span>\n        </label>\n      </div>\n    </ng-template>\n  </bb-dropdown-panel-ui>\n</div>\n", components: [{ type: i3.DropdownPanelComponent, selector: "bb-dropdown-panel-ui", outputs: ["open"] }, { type: i4.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i3.DropdownToggleDirective, selector: "ng-template[bbDropdownToggle]" }, { type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i3.DropdownMenuDirective, selector: "ng-template[bbDropdownMenu]" }, { type: i6.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i7.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i7.FormControlDirective, selector: "[formControl]", inputs: ["disabled", "formControl", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }], pipes: { "async": i5.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: DropdownMultiSelectComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-dropdown-multi-select-ui',
                    templateUrl: './dropdown-multi-select.component.html',
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DropdownMultiSelectComponent),
                            multi: true,
                        },
                        {
                            provide: BB_MULTI_SELECT_CHANGE_DETECTION_REF_TOKEN,
                            useExisting: ChangeDetectorRef,
                        },
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.DomAttributesService }, { type: i2.DeprecationsService }]; }, propDecorators: { dropdownHeaderText: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], label: [{
                type: Input
            }], filtering: [{
                type: Input
            }], readonly: [{
                type: Input
            }], contentOptions: [{
                type: ContentChildren,
                args: [DropdownMultiSelectOptionComponent]
            }], options: [{
                type: ViewChildren,
                args: ['option']
            }], clearAllButton: [{
                type: ViewChild,
                args: ['clearOptions']
            }], dropDownMenu: [{
                type: ViewChild,
                args: ['dropDownMenu']
            }], toggleButton: [{
                type: ViewChild,
                args: ['toggleButton']
            }], listbox: [{
                type: ViewChild,
                args: ['listbox']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tbXVsdGktc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvdWktYW5nL2Ryb3Bkb3duLW11bHRpLXNlbGVjdC9kcm9wZG93bi1tdWx0aS1zZWxlY3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvZHJvcGRvd24tbXVsdGktc2VsZWN0L2Ryb3Bkb3duLW11bHRpLXNlbGVjdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsZUFBZSxFQUVmLFVBQVUsRUFDVixLQUFLLEVBR0wsU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLFdBQVcsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRyxPQUFPLEVBQUUsZUFBZSxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUduRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFDTCwwQ0FBMEMsRUFDMUMsa0NBQWtDLEdBQ25DLE1BQU0sMENBQTBDLENBQUM7Ozs7Ozs7OztBQUVsRDs7Ozs7R0FLRztBQWlCSCxNQUFNLE9BQU8sNEJBQ1gsU0FBUSxrQkFBa0I7SUE2RTFCLFlBQ3FCLEVBQXFCLEVBQ3ZCLG9CQUEwQyxFQUN4QyxtQkFBd0M7UUFFM0QsS0FBSyxDQUFDLEVBQUUsRUFBRSxtQkFB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VyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyw0QkFBNEIsQ0FBQztZQUMzRCxLQUFLLEVBQUUsSUFBSTtTQUNaO1FBQ0Q7WUFDRSxPQUFPLEVBQUUsMENBQTBDO1lBQ25ELFdBQVcsRUFBRSxpQkFBaUI7U0FDL0I7S0FDRix5REFzQ2dCLGtDQUFrQyw4ZkNyRnJELHlqSkFnSEE7NEZEOURhLDRCQUE0QjtrQkFoQnhDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLDZCQUE2QjtvQkFDdkMsV0FBVyxFQUFFLHdDQUF3QztvQkFDckQsU0FBUyxFQUFFO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLDZCQUE2QixDQUFDOzRCQUMzRCxLQUFLLEVBQUUsSUFBSTt5QkFDWjt3QkFDRDs0QkFDRSxPQUFPLEVBQUUsMENBQTBDOzRCQUNuRCxXQUFXLEVBQUUsaUJBQWlCO3lCQUMvQjtxQkFDRjtvQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtpQkFDaEQ7NktBU1Usa0JBQWtCO3NCQUExQixLQUFLO2dCQUtHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBS0csS0FBSztzQkFBYixLQUFLO2dCQUtHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBS0csUUFBUTtzQkFBaEIsS0FBSztnQkFRTixjQUFjO3NCQURiLGVBQWU7dUJBQUMsa0NBQWtDO2dCQU0zQixPQUFPO3NCQUE5QixZQUFZO3VCQUFDLFFBQVE7Z0JBRUssY0FBYztzQkFBeEMsU0FBUzt1QkFBQyxjQUFjO2dCQUNFLFlBQVk7c0JBQXRDLFNBQVM7dUJBQUMsY0FBYztnQkFLRSxZQUFZO3NCQUF0QyxTQUFTO3VCQUFDLGNBQWM7Z0JBRUgsT0FBTztzQkFBNUIsU0FBUzt1QkFBQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRWxlbWVudFJlZixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgUXVlcnlMaXN0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDaGlsZHJlbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBEZXByZWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2Z1dHVyZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZVVudGlsLCB3aXRoTGF0ZXN0RnJvbSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IElucHV0QmFzZUNvbXBvbmVudCB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvYmFzZS1jbGFzc2VzJztcbmltcG9ydCB7IERyb3Bkb3duU2luZ2xlU2VsZWN0T3B0aW9uQ29tcG9uZW50IH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy9kcm9wZG93bi1zaW5nbGUtc2VsZWN0JztcbmltcG9ydCB7IERvbUF0dHJpYnV0ZXNTZXJ2aWNlIH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBpZExpc3RBdHRyIH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy91dGlsJztcbmltcG9ydCB7IEtFWV9DT0RFUyB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvdXRpbCc7XG5pbXBvcnQge1xuICBCQl9NVUxUSV9TRUxFQ1RfQ0hBTkdFX0RFVEVDVElPTl9SRUZfVE9LRU4sXG4gIERyb3Bkb3duTXVsdGlTZWxlY3RPcHRpb25Db21wb25lbnQsXG59IGZyb20gJy4vZHJvcGRvd24tbXVsdGktc2VsZWN0LW9wdGlvbi5jb21wb25lbnQnO1xuXG4vKipcbiAqIEBuYW1lIERyb3Bkb3duTXVsdGlTZWxlY3RDb21wb25lbnRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbXBvbmVudCB0aGF0IHVzZSBmb3IgRHJvcERvd24gTXVsdGkgU2VsZWN0LlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3QtdWknLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24tbXVsdGktc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBEcm9wZG93bk11bHRpU2VsZWN0Q29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogQkJfTVVMVElfU0VMRUNUX0NIQU5HRV9ERVRFQ1RJT05fUkVGX1RPS0VOLFxuICAgICAgdXNlRXhpc3Rpbmc6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIH0sXG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBEcm9wZG93bk11bHRpU2VsZWN0Q29tcG9uZW50XG4gIGV4dGVuZHMgSW5wdXRCYXNlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uRGVzdHJveVxue1xuICBwcml2YXRlIHJlYWRvbmx5IHVuc3Vic2NyaWJlJCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIC8qKlxuICAgKiBUaGUgZHJvcGRvd24gaGVhZGVyIHRleHRcbiAgICovXG4gIEBJbnB1dCgpIGRyb3Bkb3duSGVhZGVyVGV4dDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBUaGUgcGxhY2Vob2xkZXIgZm9yIHRoZSBtdWx0aSBzZWxlY3QuXG4gICAqL1xuICBASW5wdXQoKSBwbGFjZWhvbGRlciA9ICdObyBpdGVtcyBzZWxlY3RlZCc7XG5cbiAgLyoqXG4gICAqIFRoZSBsYWJlbCBmb3IgdGhlIERyb3Bkb3duIG11bHRpIHNlbGVjdC4gRGVmYXVsdHMgdG8gYW4gZW1wdHkgc3RyaW5nLlxuICAgKi9cbiAgQElucHV0KCkgbGFiZWwgPSAnJztcblxuICAvKipcbiAgICogRW5hYmxlIGZpbHRlcmluZzsgRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAqL1xuICBASW5wdXQoKSBmaWx0ZXJpbmcgPSBmYWxzZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgRHJvcGRvd24gbXVsdGkgc2VsZWN0IGlzIHJlYWQgb25seS4gRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAqL1xuICBASW5wdXQoKSByZWFkb25seSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGUgY2hpbGQgb3B0aW9uIGNvbXBvbmVudHMgb2YgdHlwZSBEcm9wRG93bk11bHRpU2VsZWN0U2luZ2xlT3B0aW9uXG4gICAqL1xuICBpc0lFID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFICcpID4gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdUcmlkZW50LycpID4gLTE7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihEcm9wZG93bk11bHRpU2VsZWN0T3B0aW9uQ29tcG9uZW50KVxuICBjb250ZW50T3B0aW9uczogUXVlcnlMaXN0PERyb3Bkb3duTXVsdGlTZWxlY3RPcHRpb25Db21wb25lbnQ+IHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBUaGUgbGlzdCBvZiBvcHRpb25zLlxuICAgKi9cbiAgQFZpZXdDaGlsZHJlbignb3B0aW9uJykgb3B0aW9ucyE6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcblxuICBAVmlld0NoaWxkKCdjbGVhck9wdGlvbnMnKSBjbGVhckFsbEJ1dHRvbiE6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2Ryb3BEb3duTWVudScpIGRyb3BEb3duTWVudSE6IEVsZW1lbnRSZWY7XG5cbiAgLyoqXG4gICAqIFRoZSB0b2dnbGUgYnV0dG9uIG9mIHRoZSBkcm9wZG93blxuICAgKi9cbiAgQFZpZXdDaGlsZCgndG9nZ2xlQnV0dG9uJykgdG9nZ2xlQnV0dG9uITogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKCdsaXN0Ym94JykgbGlzdGJveCE6IEVsZW1lbnRSZWY7XG5cbiAgYWN0aXZlT3B0aW9uSW5kZXggPSAtMTtcbiAgaXNPcHRpb25zRm9jdXNlZCA9IGZhbHNlO1xuXG4gIHJlYWRvbmx5IGZvcm1Hcm91cCA9IG5ldyBGb3JtR3JvdXAoe30pO1xuXG4gIHJlYWRvbmx5IGZvcm1WYWx1ZSQ6IE9ic2VydmFibGU8c3RyaW5nW10+ID0gdGhpcy5mb3JtR3JvdXAudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgbWFwKChmb3JtVmFsdWU6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9KSA9PiB0aGlzLmdldFNlbGVjdGVkVmFsdWVzKGZvcm1WYWx1ZSkpLFxuICAgIHRha2VVbnRpbCh0aGlzLnVuc3Vic2NyaWJlJCksXG4gICk7XG5cbiAgcmVhZG9ubHkgbGFiZWxzTWFwOiB7XG4gICAgW2tleTogc3RyaW5nXTogc3RyaW5nO1xuICB9ID0ge307XG5cbiAgcmVhZG9ubHkgYnV0dG9uTGFiZWxJZCA9IHRoaXMuZG9tQXR0cmlidXRlc1NlcnZpY2UuZ2VuZXJhdGVJZCgpO1xuXG4gIHJlYWRvbmx5IGNsZWFyT3B0aW9ucyQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIHByaXZhdGUgc2VsZWN0ZWRWYWx1ZXNTdWJqZWN0JCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nW10+KFtdKTtcbiAgcmVhZG9ubHkgc2VsZWN0ZWRWYWx1ZXMkID0gdGhpcy5zZWxlY3RlZFZhbHVlc1N1YmplY3QkLmFzT2JzZXJ2YWJsZSgpO1xuXG4gIHByaXZhdGUgc2VhcmNoS2V5ID0gJyc7XG4gIHByaXZhdGUgY2FjaGVkVmFsdWU6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9ID0ge307XG4gIHByaXZhdGUgaXNPcGVuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRvbUF0dHJpYnV0ZXNTZXJ2aWNlOiBEb21BdHRyaWJ1dGVzU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGVwcmVjYXRpb25zU2VydmljZTogRGVwcmVjYXRpb25zU2VydmljZSxcbiAgKSB7XG4gICAgc3VwZXIoY2QsIGRlcHJlY2F0aW9uc1NlcnZpY2UpO1xuICAgIHRoaXMuYnV0dG9uTGFiZWxJZCA9IHRoaXMuZG9tQXR0cmlidXRlc1NlcnZpY2UuZ2VuZXJhdGVJZCgpO1xuICAgIHRoaXMuZm9ybVZhbHVlJC5zdWJzY3JpYmUodGhpcy5zZWxlY3RlZFZhbHVlc1N1YmplY3QkKTtcblxuICAgIHRoaXMuZm9ybVZhbHVlJC5zdWJzY3JpYmUoKHZhbHVlKSA9PiB7XG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMub25DaGFuZ2UodW5kZWZpbmVkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub25WYWx1ZUNoYW5nZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmNsZWFyT3B0aW9ucyRcbiAgICAgIC5waXBlKHdpdGhMYXRlc3RGcm9tKHRoaXMuc2VsZWN0ZWRWYWx1ZXMkKSwgdGFrZVVudGlsKHRoaXMudW5zdWJzY3JpYmUkKSlcbiAgICAgIC5zdWJzY3JpYmUoKFssIGl0ZW1zXSkgPT4ge1xuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0aGlzLmZvcm1Hcm91cC5wYXRjaFZhbHVlKHsgW2l0ZW1dOiBmYWxzZSB9LCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZvcm1Hcm91cC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb250ZW50T3B0aW9ucykge1xuICAgICAgdGhpcy5jb250ZW50T3B0aW9ucy5mb3JFYWNoKCh7IHZhbHVlLCBsYWJlbCB9KSA9PiB7XG4gICAgICAgIHRoaXMuZm9ybUdyb3VwLnJlZ2lzdGVyQ29udHJvbCh2YWx1ZSwgbmV3IEZvcm1Db250cm9sKHRoaXMuY2FjaGVkVmFsdWVbdmFsdWVdIHx8IGZhbHNlKSk7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5sYWJlbHNNYXAsIHsgW3ZhbHVlXTogbGFiZWwgfSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmNhY2hlZFZhbHVlKS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5mb3JtR3JvdXAudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMudW5zdWJzY3JpYmUkLm5leHQoKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuc2VsZWN0IGFsbCBzZWxlY3RlZCBvcHRpb25zIGZyb20gdGhlIGxpc3Rib3hcbiAgICpcbiAgICogQHBhcmFtICRldmVudFxuICAgKi9cbiAgY2xlYXJBbGwoJGV2ZW50OiBFdmVudCkge1xuICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuY2xlYXJPcHRpb25zJC5uZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGluZGV4XG4gICAqIEBwYXJhbSBpdGVtXG4gICAqL1xuICB0cmFja0J5VmFsdWVGbihpbmRleDogbnVtYmVyLCBpdGVtOiBEcm9wZG93blNpbmdsZVNlbGVjdE9wdGlvbkNvbXBvbmVudCkge1xuICAgIHJldHVybiBpdGVtLnZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZVxuICAgKi9cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogc3RyaW5nW10gfCBudWxsKTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWVzTWFwID0gKHZhbHVlIHx8IFtdKS5yZWR1Y2UoXG4gICAgICAoYWNjLCBpdGVtKSA9PiBPYmplY3QuYXNzaWduKGFjYywgeyBbaXRlbV06IHRydWUgfSksXG4gICAgICB7fSBhcyB7XG4gICAgICAgIFtrZXk6IHN0cmluZ106IGJvb2xlYW47XG4gICAgICB9LFxuICAgICk7XG5cbiAgICB0aGlzLmNhY2hlZFZhbHVlID0gdmFsdWVzTWFwO1xuXG4gICAgT2JqZWN0LmtleXModGhpcy5mb3JtR3JvdXAuY29udHJvbHMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgdGhpcy5mb3JtR3JvdXAuY29udHJvbHNba2V5XS5zZXRWYWx1ZSh2YWx1ZXNNYXBba2V5XSB8fCBmYWxzZSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5mb3JtR3JvdXAudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XG5cbiAgICBjb25zdCBzZWxlY3RlZFZhbHVlcyA9IHRoaXMuZ2V0U2VsZWN0ZWRWYWx1ZXModGhpcy5mb3JtR3JvdXAudmFsdWUpO1xuICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXNTdWJqZWN0JC5uZXh0KHNlbGVjdGVkVmFsdWVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGluZyBsYWJlbHMgd2hpbGUgc2VhcmNoaW5nXG4gICAqXG4gICAqIEBwYXJhbSBsYWJlbFxuICAgKi9cbiAgZ2V0TGFiZWwobGFiZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoS2V5LnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09IGxhYmVsWzBdLnRvTG9jYWxlTG93ZXJDYXNlKCkgJiYgdGhpcy5maWx0ZXJpbmdcbiAgICAgID8gYDxiPiR7bGFiZWxbMF19PC9iPiR7bGFiZWwuc3Vic3RyaW5nKDEpfWBcbiAgICAgIDogbGFiZWw7XG4gIH1cblxuICBvbkxpc3Rib3hGb2N1cygpIHtcbiAgICB0aGlzLmFjdGl2ZU9wdGlvbkluZGV4ID0gMDtcbiAgICB0aGlzLmlzT3B0aW9uc0ZvY3VzZWQgPSB0cnVlO1xuICB9XG5cbiAgLyogZXNsaW50LWRpc2FibGUgY29tcGxleGl0eSAqL1xuICBvbkxpc3Rib3hLZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIHRoaXMuaXNPcGVuICYmIHRoaXMuaXNPcHRpb25zRm9jdXNlZCkge1xuICAgICAgY29uc3Qga2V5Q29kZSA9IHRoaXMuaXNJRSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC5rZXk7XG5cbiAgICAgIHN3aXRjaCAoa2V5Q29kZSkge1xuICAgICAgICBjYXNlIDQwOlxuICAgICAgICBjYXNlIEtFWV9DT0RFUy5ET1dOOlxuICAgICAgICAgIHRoaXMuYWN0aXZlT3B0aW9uSW5kZXggPSBNYXRoLm1pbih0aGlzLmFjdGl2ZU9wdGlvbkluZGV4ICsgMSwgdGhpcy5vcHRpb25zLmxlbmd0aCAtIDEpO1xuXG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAzODpcbiAgICAgICAgY2FzZSBLRVlfQ09ERVMuVVA6XG4gICAgICAgICAgdGhpcy5hY3RpdmVPcHRpb25JbmRleCA9IE1hdGgubWF4KHRoaXMuYWN0aXZlT3B0aW9uSW5kZXggLSAxLCAwKTtcblxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgMTM6XG4gICAgICAgIGNhc2UgMzI6XG4gICAgICAgIGNhc2UgS0VZX0NPREVTLkVOVEVSOlxuICAgICAgICBjYXNlIEtFWV9DT0RFUy5TUEFDRTpcbiAgICAgICAgICB0aGlzLnNlbGVjdEFjdGl2ZU9wdGlvbigpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgaWYgKHRoaXMuZmlsdGVyaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaEtleSA9IGV2ZW50LmtleTtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uQmFzZU9uU2VhcmNoS2V5KGV2ZW50LmtleSk7XG4gICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBsZXQgVGFiIGtleSB0byBqdW1wIG91dCBhbmQgY2xvc2UgdGhlIGRyb3Bkb3duIG1lbnVcbiAgICAgIGlmIChrZXlDb2RlICE9PSA5ICYmIGtleUNvZGUgIT09IEtFWV9DT0RFUy5UQUIpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiBlc2xpbnQtZW5hYmxlIGNvbXBsZXhpdHkgKi9cblxuICAvKipcbiAgICpcbiAgICovXG4gIG9uTGlzdGJveEJsdXIoKSB7XG4gICAgdGhpcy5hY3RpdmVPcHRpb25JbmRleCA9IC0xO1xuICAgIHRoaXMuaXNPcHRpb25zRm9jdXNlZCA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpc09wZW5cbiAgICovXG4gIG9uRHJvcGRvd25Ub2dnbGUoaXNPcGVuOiBib29sZWFuKSB7XG4gICAgdGhpcy5hY3RpdmVPcHRpb25JbmRleCA9IC0xO1xuICAgIHRoaXMuaXNPcHRpb25zRm9jdXNlZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNPcGVuID0gaXNPcGVuO1xuICB9XG5cbiAgZ2V0TGFiZWxlZEJ5SWRzKC4uLnRva2VuczogQXJyYXk8c3RyaW5nIHwgdW5kZWZpbmVkPik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIGlkTGlzdEF0dHIoLi4udG9rZW5zKTtcbiAgfVxuXG4gIC8vIG9ubHkgdGFraW5nIGNvbnNpZGVyYXRpb24gdGhlIGZvY3VzYWJsZSBlbGVtZW50cyBvZiB0aGUgY29udHJvbFxuICBvbkZvY3VzT3V0KGV2ZW50OiBGb2N1c0V2ZW50KSB7XG4gICAgY29uc3QgbmV4dEZvY3VzZWRFbGVtZW50ID0gZXZlbnQucmVsYXRlZFRhcmdldDtcbiAgICBjb25zdCBmb2N1c091dEVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG5cbiAgICBpZiAoXG4gICAgICAoZm9jdXNPdXRFbGVtZW50ID09PSB0aGlzLnRvZ2dsZUJ1dHRvbi5uYXRpdmVFbGVtZW50ICYmXG4gICAgICAgIG5leHRGb2N1c2VkRWxlbWVudCAhPT0gdGhpcy5jbGVhckFsbEJ1dHRvbi5uYXRpdmVFbGVtZW50ICYmXG4gICAgICAgIG5leHRGb2N1c2VkRWxlbWVudCAhPT0gdGhpcy5saXN0Ym94Lm5hdGl2ZUVsZW1lbnQpIHx8XG4gICAgICAoZm9jdXNPdXRFbGVtZW50ID09PSB0aGlzLmNsZWFyQWxsQnV0dG9uLm5hdGl2ZUVsZW1lbnQgJiZcbiAgICAgICAgbmV4dEZvY3VzZWRFbGVtZW50ICE9PSB0aGlzLnRvZ2dsZUJ1dHRvbi5uYXRpdmVFbGVtZW50ICYmXG4gICAgICAgIG5leHRGb2N1c2VkRWxlbWVudCAhPT0gdGhpcy5saXN0Ym94Lm5hdGl2ZUVsZW1lbnQpIHx8XG4gICAgICAoZm9jdXNPdXRFbGVtZW50ID09PSB0aGlzLmxpc3Rib3gubmF0aXZlRWxlbWVudCAmJlxuICAgICAgICBuZXh0Rm9jdXNlZEVsZW1lbnQgIT09IHRoaXMudG9nZ2xlQnV0dG9uLm5hdGl2ZUVsZW1lbnQgJiZcbiAgICAgICAgbmV4dEZvY3VzZWRFbGVtZW50ICE9PSB0aGlzLmNsZWFyQWxsQnV0dG9uLm5hdGl2ZUVsZW1lbnQpXG4gICAgKSB7XG4gICAgICBzdXBlci5vbkJsdXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNlbGVjdGVkVmFsdWVzKGZvcm1WYWx1ZTogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0pIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoZm9ybVZhbHVlKS5yZWR1Y2UoKGFjYzogc3RyaW5nW10sIGtleSkgPT4ge1xuICAgICAgaWYgKGZvcm1WYWx1ZVtrZXldKSB7XG4gICAgICAgIGFjYy5wdXNoKGtleSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgW10pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RBY3RpdmVPcHRpb24oKSB7XG4gICAgY29uc3QgZWwgPSB0aGlzLm9wdGlvbnMudG9BcnJheSgpW3RoaXMuYWN0aXZlT3B0aW9uSW5kZXhdO1xuXG4gICAgZWw/Lm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWN0aXZlT3B0aW9uQmFzZU9uU2VhcmNoS2V5KGtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5hY3RpdmVPcHRpb25JbmRleCA9IHRoaXMub3B0aW9uc1xuICAgICAgLnRvQXJyYXkoKVxuICAgICAgLmZpbmRJbmRleCgoaXRlbSkgPT4ga2V5LnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09IGl0ZW0ubmF0aXZlRWxlbWVudC5pbm5lclRleHRbMF0udG9Mb2NhbGVMb3dlckNhc2UoKSk7XG4gIH1cbn1cbiIsIjxsYWJlbCAqbmdJZj1cImxhYmVsXCIgZm9yPVwie3sgaWQgfX1fZHJvcGRvd24tb3B0aW9uX2lucHV0XCIgW2lkXT1cIidiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3QtbGFiZWwnICsgaWRcIj5cbiAge3sgbGFiZWwgfX1cbjwvbGFiZWw+XG48ZGl2ICNkcm9wRG93bk1lbnU+XG4gIDxiYi1kcm9wZG93bi1wYW5lbC11aVxuICAgIChvcGVuKT1cIm9uRHJvcGRvd25Ub2dnbGUoJGV2ZW50KVwiXG4gICAgW25nQ2xhc3NdPVwieyAnYmItZHJvcGRvd24tbXVsdGktc2VsZWN0LS1kaXNhYmxlZCc6IGRpc2FibGVkIHx8IHJlYWRvbmx5IH1cIlxuICAgIGNsYXNzPVwiYmItZHJvcGRvd24tbXVsdGktc2VsZWN0XCJcbiAgPlxuICAgIDxuZy10ZW1wbGF0ZSBiYkRyb3Bkb3duVG9nZ2xlIGxldC1pc09wZW49XCJpc09wZW5cIj5cbiAgICAgIDxidXR0b25cbiAgICAgICAgW2F0dHIuZGF0YS1yb2xlXT1cIidleHBhbmQtYnV0dG9uJ1wiXG4gICAgICAgICN0b2dnbGVCdXR0b25cbiAgICAgICAgW2F0dHIucmVxdWlyZWRdPVwicmVxdWlyZWQgPyB0cnVlIDogdW5kZWZpbmVkXCJcbiAgICAgICAgW2F0dHIuYXJpYS1leHBhbmRlZF09XCJpc09wZW5cIlxuICAgICAgICBbYXR0ci5hcmlhLWxhYmVsbGVkYnldPVwiZ2V0TGFiZWxlZEJ5SWRzKCdiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3QtbGFiZWwnICsgaWQsIGFyaWFMYWJlbGxlZGJ5LCBidXR0b25MYWJlbElkKVwiXG4gICAgICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiYXJpYURlc2NyaWJlZGJ5XCJcbiAgICAgICAgW2F0dHIuYXJpYS1hY3RpdmVkZXNjZW5kYW50XT1cImFyaWFBY3RpdmVkZXNjZW5kYW50XCJcbiAgICAgICAgW2F0dHIuYXJpYS1pbnZhbGlkXT1cImFyaWFJbnZhbGlkXCJcbiAgICAgICAgW2F0dHIuYXJpYS1vd25zXT1cImFyaWFPd25zXCJcbiAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJhcmlhTGFiZWxcIlxuICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgICBhcmlhLWhhc3BvcHVwPVwibGlzdGJveFwiXG4gICAgICAgIChmb2N1cyk9XCJvbkZvY3VzKClcIlxuICAgICAgICAoZm9jdXNvdXQpPVwib25Gb2N1c091dCgkZXZlbnQpXCJcbiAgICAgICAgY2xhc3M9XCJcbiAgICAgICAgICBiYi1zdGFjay0td3JhcFxuICAgICAgICAgIGJiLWRyb3Bkb3duLW11bHRpLXNlbGVjdF9fdG9nZ2xlXG4gICAgICAgICAgYmItc3RhY2sgYmItdGV4dC1hbGlnbi1sZWZ0XG4gICAgICAgICAgYmItc3RhY2stLWFsaWduLXRvcFxuICAgICAgICAgIGZvcm0tY29udHJvbFxuICAgICAgICBcIlxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgaWQ9XCJ7eyBpZCB9fVwiXG4gICAgICA+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiYmItZHJvcGRvd24tbXVsdGktc2VsZWN0X19yZXN1bHRcIiBbaWRdPVwiYnV0dG9uTGFiZWxJZFwiIFthdHRyLmRhdGEtcm9sZV09XCInZHJvcGRvd24tcmVzdWx0J1wiPlxuICAgICAgICAgIDxzcGFuICpuZ0lmPVwiKHNlbGVjdGVkVmFsdWVzJCB8IGFzeW5jKT8ubGVuZ3RoOyBlbHNlIHBsYWNlaG9sZGVyVGVtcGxhdGVcIj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2VsZWN0ZWRWYWx1ZXMkIHwgYXN5bmM7IGxhc3QgYXMgbGFzdFwiPlxuICAgICAgICAgICAgICB7eyBsYWJlbHNNYXBbaXRlbV0gKyAobGFzdCA/ICcnIDogJywgJykgfX1cbiAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8bmctdGVtcGxhdGUgI3BsYWNlaG9sZGVyVGVtcGxhdGU+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImJiLXRleHQtc3VwcG9ydFwiPnt7IHBsYWNlaG9sZGVyIH19PC9zcGFuPlxuICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJiYi1zdGFja19faXRlbS0tcHVzaC1yaWdodFwiPlxuICAgICAgICAgIDxiYi1pY29uLXVpIFtjcm9wcGVkXT1cInRydWVcIiBbbmFtZV09XCJpc09wZW4gPyAndG9nZ2xlLXVwJyA6ICd0b2dnbGUtZG93bidcIj48L2JiLWljb24tdWk+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvYnV0dG9uPlxuICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPG5nLXRlbXBsYXRlIGJiRHJvcGRvd25NZW51PlxuICAgICAgPGRpdj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIFthdHRyLmRhdGEtcm9sZV09XCInY2xlYXItYnRuJ1wiXG4gICAgICAgICAgI2NsZWFyT3B0aW9uc1xuICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgY29sb3I9XCJ1bnN0eWxlZFwiXG4gICAgICAgICAgY2xhc3M9XCJiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3RfX2NsZWFyLWJ1dHRvblwiXG4gICAgICAgICAgKGNsaWNrKT1cImNsZWFyQWxsKCRldmVudClcIlxuICAgICAgICAgIGkxOG49XCJDbGVhciBzZWxlY3Rpb24gYnV0dG9uIHRleHRAQGRyb3Bkb3duLW11bHRpcGxlLXNlbGVjdC5jbGVhci1zZWxlY3Rpb24uYnV0dG9uXCJcbiAgICAgICAgICAoZm9jdXNvdXQpPVwib25Gb2N1c091dCgkZXZlbnQpXCJcbiAgICAgICAgPlxuICAgICAgICAgIENsZWFyIHNlbGVjdGlvblxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duLWRpdmlkZXJcIj48L2Rpdj5cbiAgICAgIDxkaXYgKm5nSWY9XCJkcm9wZG93bkhlYWRlclRleHRcIiBbaWRdPVwiJ2JiLWRyb3Bkb3duLW11bHRpLXNlbGVjdC1oZWFkZXJfJyArIGlkXCIgY2xhc3M9XCJkcm9wZG93bi1oZWFkZXJcIj5cbiAgICAgICAge3sgZHJvcGRvd25IZWFkZXJUZXh0IH19XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXZcbiAgICAgICAgI2xpc3Rib3hcbiAgICAgICAgcm9sZT1cImxpc3Rib3hcIlxuICAgICAgICBhcmlhLW11bHRpc2VsZWN0YWJsZT1cInRydWVcIlxuICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICBbYXR0ci5hcmlhLWxhYmVsbGVkYnldPVwiZHJvcGRvd25IZWFkZXJUZXh0ID8gZ2V0TGFiZWxlZEJ5SWRzKCdiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3QtaGVhZGVyXycgKyBpZCkgOiBudWxsXCJcbiAgICAgICAgY2xhc3M9XCJiYi1kcm9wZG93bi1tdWx0aS1zZWxlY3RfX29wdGlvbnMtbGlzdFwiXG4gICAgICAgIFthdHRyLmFyaWEtYWN0aXZlZGVzY2VuZGFudF09XCJcbiAgICAgICAgICBhY3RpdmVPcHRpb25JbmRleCA+PSAwID8gJ2JiLWRyb3Bkb3duLW11bHRpLXNlbGVjdC1vcHRpb24tJyArIChpZCArIGFjdGl2ZU9wdGlvbkluZGV4KSA6IHVuZGVmaW5lZFxuICAgICAgICBcIlxuICAgICAgICAqbmdJZj1cImNvbnRlbnRPcHRpb25zPy5sZW5ndGggJiYgZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRlbnRPcHRpb25zPy5maXJzdC52YWx1ZV1cIlxuICAgICAgICAoa2V5ZG93bik9XCJvbkxpc3Rib3hLZXlEb3duKCRldmVudClcIlxuICAgICAgICAoZm9jdXMpPVwib25MaXN0Ym94Rm9jdXMoKVwiXG4gICAgICAgIChibHVyKT1cIm9uTGlzdGJveEJsdXIoKVwiXG4gICAgICAgIChmb2N1c291dCk9XCJvbkZvY3VzT3V0KCRldmVudClcIlxuICAgICAgPlxuICAgICAgICA8bGFiZWxcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgY29udGVudE9wdGlvbiBvZiBjb250ZW50T3B0aW9uczsgaW5kZXggYXMgaTsgdHJhY2tCeTogdHJhY2tCeVZhbHVlRm5cIlxuICAgICAgICAgICNvcHRpb25cbiAgICAgICAgICAoY2xpY2spPVwiYWN0aXZlT3B0aW9uSW5kZXggPSBpXCJcbiAgICAgICAgICByb2xlPVwib3B0aW9uXCJcbiAgICAgICAgICBjbGFzcz1cImRyb3Bkb3duLWl0ZW0gZHJvcGRvd24tb3B0aW9uXCJcbiAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAnYWN0aXZlIGRyb3Bkb3duLW9wdGlvbi0tYWN0aXZlJzogYWN0aXZlT3B0aW9uSW5kZXggPT09IGksXG4gICAgICAgICAgICAnZHJvcGRvd24tb3B0aW9uLS1zZWxlY3RlZCc6ICEhZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRlbnRPcHRpb24udmFsdWVdLnZhbHVlXG4gICAgICAgICAgfVwiXG4gICAgICAgICAgW2F0dHIuZGF0YS1yb2xlXT1cIidvcHRpb24tJyArIGlcIlxuICAgICAgICAgIFthdHRyLmFyaWEtc2VsZWN0ZWRdPVwiZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRlbnRPcHRpb24udmFsdWVdLnZhbHVlXCJcbiAgICAgICAgICBbaWRdPVwiJ2JiLWRyb3Bkb3duLW11bHRpLXNlbGVjdC1vcHRpb24tJyArIGlkICsgaVwiXG4gICAgICAgID5cbiAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgIGNsYXNzPVwiZHJvcGRvd24tb3B0aW9uX19pbnB1dFwiXG4gICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgaWQ9XCJ7eyBpZCB9fV9kcm9wZG93bi1vcHRpb25faW5wdXRcIlxuICAgICAgICAgICAgW2F0dHIuZGF0YS1yb2xlXT1cIidvcHRpb24tJyArIChpZCArIGkgKyAxKVwiXG4gICAgICAgICAgICBbZm9ybUNvbnRyb2xdPVwiZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRlbnRPcHRpb24udmFsdWVdXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxzcGFuIFtpbm5lckhUTUxdPVwiZ2V0TGFiZWwoY29udGVudE9wdGlvbi5sYWJlbClcIj48L3NwYW4+XG4gICAgICAgIDwvbGFiZWw+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICA8L2JiLWRyb3Bkb3duLXBhbmVsLXVpPlxuPC9kaXY+XG4iXX0=