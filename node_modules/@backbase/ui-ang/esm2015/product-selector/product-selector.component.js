import { Component, ContentChildren, HostListener, Input, ViewChild } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/foundation-ang/core";
import * as i2 from "@backbase/ui-ang/icon";
import * as i3 from "@ng-bootstrap/ng-bootstrap";
import * as i4 from "@backbase/ui-ang/button";
/**
 * @name ProductSelectorComponent
 *
 * @description
 * A dropdown component that displays items in a pre-defined format.
 *
 * @a11y
 * Every items from list in custom templates need have
 * role="option" attribute, for detection by Screen Reader like option.
 *
 * Every items from list in custom templates need have  #listItem,
 * for keyBoard accessibility(navigate with keyUp/keyDown)
 */
export class ProductSelectorComponent {
    constructor(deprecationsService) {
        this.deprecationsService = deprecationsService;
        /**
         * Focused item index from product selector list
         */
        this.focusedItemIndex = -1;
        /**
         * State of focus on product selector element
         */
        this.focusState = '';
        /**
         * Open/close state of dropDown menu
         */
        this.isOpen = false;
        /**
         * Whether the dropdown should be closed when clicking one of dropdown items or pressing ESC
         */
        this.autoClose = true;
        /**
         * The relative position where the dropdown menu will be open
         */
        this.position = 'bottom';
        /**
         * Specifies which element the dropdown should be appended to.
         */
        this.container = '';
        this.isIE = navigator.userAgent.indexOf('MSIE ') > -1 || navigator.userAgent.indexOf('Trident/') > -1;
    }
    onKeyEvent(event) {
        if (this.isOpen) {
            switch (this.isIE ? event.keyCode : event.key) {
                case 40:
                case 'ArrowDown':
                    this.focusedItemIndex = Math.min(this.focusedItemIndex + 1, this.listItems.length - 1);
                    this.focusItem();
                    break;
                case 38:
                case 'ArrowUp':
                    this.focusedItemIndex = Math.max(this.focusedItemIndex - 1, 0);
                    this.focusItem();
                    break;
                default:
                    return;
            }
            event.preventDefault();
        }
    }
    close() {
        if (this.bbDropdown && this.autoClose && this.bbDropdown.isOpen()) {
            this.bbDropdown.close();
        }
    }
    open() {
        if (this.bbDropdown && !this.bbDropdown.isOpen()) {
            this.bbDropdown.open();
        }
    }
    onClose() {
        if (this.autoClose) {
            this.close();
            this.dropdownToggle.nativeElement.focus();
        }
    }
    focusItem() {
        this.listItems.forEach((el, index) => {
            if (index === this.focusedItemIndex) {
                el.nativeElement.tabIndex = 0;
                el.nativeElement.focus();
            }
        });
    }
    /**
     * Event handler for change open/close state in dropdown menu
     */
    onOpenChange($event) {
        this.isOpen = $event;
        if (!this.isOpen) {
            this.focusedItemIndex = -1;
        }
    }
    /**
     * Event handler for blur dropdown menu
     */
    onBlur() {
        if (this.bbDropdown && this.bbDropdown.isOpen()) {
            this.bbDropdown.close();
        }
    }
}
ProductSelectorComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ProductSelectorComponent, deps: [{ token: i1.DeprecationsService }], target: i0.ɵɵFactoryTarget.Component });
ProductSelectorComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: ProductSelectorComponent, selector: "bb-product-selector-ui", inputs: { autoClose: "autoClose", position: "position", container: "container" }, host: { listeners: { "window:keydown": "onKeyEvent($event)" } }, queries: [{ propertyName: "listItems", predicate: ["listItem"] }], viewQueries: [{ propertyName: "bbDropdown", first: true, predicate: ["bbDropdown"], descendants: true, static: true }, { propertyName: "dropdownToggle", first: true, predicate: ["dropdownToggle"], descendants: true }], ngImport: i0, template: "<div class=\"bb-product-selector\">\n  <div\n    ngbDropdown\n    #bbDropdown=\"ngbDropdown\"\n    [autoClose]=\"autoClose\"\n    [container]=\"container\"\n    (blur)=\"onBlur()\"\n    (openChange)=\"onOpenChange($event)\"\n    [placement]=\"position\"\n    class=\"bb-product-selector__dropdown\"\n  >\n    <button\n      ngbDropdownToggle\n      #dropdownToggle\n      bbButton\n      color=\"unstyled\"\n      class=\"bb-product-selector__item\"\n      [attr.data-role]=\"'product-selector-expand-button'\"\n      type=\"button\"\n    >\n      <div class=\"bb-product-selector__item-content\" [attr.data-role]=\"'product-selector-selected-content'\">\n        <ng-content select=\"[bbDropdownToggle]\"></ng-content>\n      </div>\n      <bb-icon-ui cropped class=\"bb-product-selector__icon\" [name]=\"isOpen ? 'toggle-up' : 'toggle-down'\"></bb-icon-ui>\n    </button>\n    <div\n      ngbDropdownMenu\n      class=\"bb-product-selector__dropdown-menu-panel\"\n      role=\"menu\"\n      (click)=\"onClose()\"\n      [attr.data-role]=\"'product-selector-dropdown-menu'\"\n    >\n      <div class=\"bb-product-selector__dropdown-menu\">\n        <ng-content select=\"[bbDropdownMenu]\"></ng-content>\n      </div>\n    </div>\n  </div>\n</div>\n", components: [{ type: i2.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }], directives: [{ type: i3.NgbDropdown, selector: "[ngbDropdown]", inputs: ["open", "placement", "container", "autoClose", "display", "dropdownClass"], outputs: ["openChange"], exportAs: ["ngbDropdown"] }, { type: i4.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i3.NgbDropdownToggle, selector: "[ngbDropdownToggle]" }, { type: i3.NgbDropdownMenu, selector: "[ngbDropdownMenu]" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ProductSelectorComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-product-selector-ui',
                    templateUrl: './product-selector.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.DeprecationsService }]; }, propDecorators: { autoClose: [{
                type: Input
            }], position: [{
                type: Input
            }], container: [{
                type: Input
            }], bbDropdown: [{
                type: ViewChild,
                args: ['bbDropdown', { static: true }]
            }], dropdownToggle: [{
                type: ViewChild,
                args: ['dropdownToggle']
            }], listItems: [{
                type: ContentChildren,
                args: ['listItem']
            }], onKeyEvent: [{
                type: HostListener,
                args: ['window:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1zZWxlY3Rvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWJzL3VpLWFuZy9wcm9kdWN0LXNlbGVjdG9yL3Byb2R1Y3Qtc2VsZWN0b3IuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvcHJvZHVjdC1zZWxlY3Rvci9wcm9kdWN0LXNlbGVjdG9yLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFjLFlBQVksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7QUFhdkc7Ozs7Ozs7Ozs7OztHQVlHO0FBS0gsTUFBTSxPQUFPLHdCQUF3QjtJQUNuQyxZQUE2QixtQkFBd0M7UUFBeEMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUNyRTs7V0FFRztRQUNILHFCQUFnQixHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3RCOztXQUVHO1FBQ0gsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQjs7V0FFRztRQUNILFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZjs7V0FFRztRQUNNLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFFMUI7O1dBRUc7UUFDTSxhQUFRLEdBQUcsUUFBUSxDQUFDO1FBRTdCOztXQUVHO1FBQ00sY0FBUyxHQUFnQixFQUFFLENBQUM7UUFDckMsU0FBSSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBM0J6QixDQUFDO0lBaUN6RSxVQUFVLENBQUMsS0FBb0I7UUFDN0IsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2YsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLENB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QyxlQUFlO3VCQUFDLFVBQVU7Z0JBRzNCLFVBQVU7c0JBRFQsWUFBWTt1QkFBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIElucHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERlcHJlY2F0aW9uc1NlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvY29yZSc7XG5pbXBvcnQgeyBOZ2JEcm9wZG93biB9IGZyb20gJ0BuZy1ib290c3RyYXAvbmctYm9vdHN0cmFwJztcblxuZXhwb3J0IGludGVyZmFjZSBQcm9kdWN0SXRlbSB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU/OiBzdHJpbmc7XG4gIGN1cnJlbmN5Pzogc3RyaW5nO1xuICBhbW91bnQ/OiBzdHJpbmc7XG4gIHByb2R1Y3ROdW1iZXI/OiBzdHJpbmc7XG4gIFtrZXk6IHN0cmluZ106IGFueTtcbn1cblxuLyoqXG4gKiBAbmFtZSBQcm9kdWN0U2VsZWN0b3JDb21wb25lbnRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEEgZHJvcGRvd24gY29tcG9uZW50IHRoYXQgZGlzcGxheXMgaXRlbXMgaW4gYSBwcmUtZGVmaW5lZCBmb3JtYXQuXG4gKlxuICogQGExMXlcbiAqIEV2ZXJ5IGl0ZW1zIGZyb20gbGlzdCBpbiBjdXN0b20gdGVtcGxhdGVzIG5lZWQgaGF2ZVxuICogcm9sZT1cIm9wdGlvblwiIGF0dHJpYnV0ZSwgZm9yIGRldGVjdGlvbiBieSBTY3JlZW4gUmVhZGVyIGxpa2Ugb3B0aW9uLlxuICpcbiAqIEV2ZXJ5IGl0ZW1zIGZyb20gbGlzdCBpbiBjdXN0b20gdGVtcGxhdGVzIG5lZWQgaGF2ZSAgI2xpc3RJdGVtLFxuICogZm9yIGtleUJvYXJkIGFjY2Vzc2liaWxpdHkobmF2aWdhdGUgd2l0aCBrZXlVcC9rZXlEb3duKVxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1wcm9kdWN0LXNlbGVjdG9yLXVpJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb2R1Y3Qtc2VsZWN0b3IuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBQcm9kdWN0U2VsZWN0b3JDb21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGRlcHJlY2F0aW9uc1NlcnZpY2U6IERlcHJlY2F0aW9uc1NlcnZpY2UpIHt9XG4gIC8qKlxuICAgKiBGb2N1c2VkIGl0ZW0gaW5kZXggZnJvbSBwcm9kdWN0IHNlbGVjdG9yIGxpc3RcbiAgICovXG4gIGZvY3VzZWRJdGVtSW5kZXggPSAtMTtcbiAgLyoqXG4gICAqIFN0YXRlIG9mIGZvY3VzIG9uIHByb2R1Y3Qgc2VsZWN0b3IgZWxlbWVudFxuICAgKi9cbiAgZm9jdXNTdGF0ZSA9ICcnO1xuICAvKipcbiAgICogT3Blbi9jbG9zZSBzdGF0ZSBvZiBkcm9wRG93biBtZW51XG4gICAqL1xuICBpc09wZW4gPSBmYWxzZTtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGRyb3Bkb3duIHNob3VsZCBiZSBjbG9zZWQgd2hlbiBjbGlja2luZyBvbmUgb2YgZHJvcGRvd24gaXRlbXMgb3IgcHJlc3NpbmcgRVNDXG4gICAqL1xuICBASW5wdXQoKSBhdXRvQ2xvc2UgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBUaGUgcmVsYXRpdmUgcG9zaXRpb24gd2hlcmUgdGhlIGRyb3Bkb3duIG1lbnUgd2lsbCBiZSBvcGVuXG4gICAqL1xuICBASW5wdXQoKSBwb3NpdGlvbiA9ICdib3R0b20nO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hpY2ggZWxlbWVudCB0aGUgZHJvcGRvd24gc2hvdWxkIGJlIGFwcGVuZGVkIHRvLlxuICAgKi9cbiAgQElucHV0KCkgY29udGFpbmVyOiAnJyB8ICdib2R5JyA9ICcnO1xuICBpc0lFID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFICcpID4gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdUcmlkZW50LycpID4gLTE7XG4gIEBWaWV3Q2hpbGQoJ2JiRHJvcGRvd24nLCB7IHN0YXRpYzogdHJ1ZSB9KSBiYkRyb3Bkb3duOiBOZ2JEcm9wZG93biB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnZHJvcGRvd25Ub2dnbGUnKSBkcm9wZG93blRvZ2dsZSE6IEVsZW1lbnRSZWY7XG4gIEBDb250ZW50Q2hpbGRyZW4oJ2xpc3RJdGVtJykgbGlzdEl0ZW1zITogQXJyYXk8RWxlbWVudFJlZj47XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OmtleWRvd24nLCBbJyRldmVudCddKVxuICBvbktleUV2ZW50KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNPcGVuKSB7XG4gICAgICBzd2l0Y2ggKHRoaXMuaXNJRSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC5rZXkpIHtcbiAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgY2FzZSAnQXJyb3dEb3duJzpcbiAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtSW5kZXggPSBNYXRoLm1pbih0aGlzLmZvY3VzZWRJdGVtSW5kZXggKyAxLCB0aGlzLmxpc3RJdGVtcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICB0aGlzLmZvY3VzSXRlbSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM4OlxuICAgICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtSW5kZXggPSBNYXRoLm1heCh0aGlzLmZvY3VzZWRJdGVtSW5kZXggLSAxLCAwKTtcbiAgICAgICAgICB0aGlzLmZvY3VzSXRlbSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgaWYgKHRoaXMuYmJEcm9wZG93biAmJiB0aGlzLmF1dG9DbG9zZSAmJiB0aGlzLmJiRHJvcGRvd24uaXNPcGVuKCkpIHtcbiAgICAgIHRoaXMuYmJEcm9wZG93bi5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgaWYgKHRoaXMuYmJEcm9wZG93biAmJiAhdGhpcy5iYkRyb3Bkb3duLmlzT3BlbigpKSB7XG4gICAgICB0aGlzLmJiRHJvcGRvd24ub3BlbigpO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgaWYgKHRoaXMuYXV0b0Nsb3NlKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB0aGlzLmRyb3Bkb3duVG9nZ2xlLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBmb2N1c0l0ZW0oKSB7XG4gICAgdGhpcy5saXN0SXRlbXMuZm9yRWFjaCgoZWwsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IHRoaXMuZm9jdXNlZEl0ZW1JbmRleCkge1xuICAgICAgICBlbC5uYXRpdmVFbGVtZW50LnRhYkluZGV4ID0gMDtcbiAgICAgICAgZWwubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV2ZW50IGhhbmRsZXIgZm9yIGNoYW5nZSBvcGVuL2Nsb3NlIHN0YXRlIGluIGRyb3Bkb3duIG1lbnVcbiAgICovXG4gIG9uT3BlbkNoYW5nZSgkZXZlbnQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzT3BlbiA9ICRldmVudDtcbiAgICBpZiAoIXRoaXMuaXNPcGVuKSB7XG4gICAgICB0aGlzLmZvY3VzZWRJdGVtSW5kZXggPSAtMTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXZlbnQgaGFuZGxlciBmb3IgYmx1ciBkcm9wZG93biBtZW51XG4gICAqL1xuICBvbkJsdXIoKSB7XG4gICAgaWYgKHRoaXMuYmJEcm9wZG93biAmJiB0aGlzLmJiRHJvcGRvd24uaXNPcGVuKCkpIHtcbiAgICAgIHRoaXMuYmJEcm9wZG93bi5jbG9zZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImJiLXByb2R1Y3Qtc2VsZWN0b3JcIj5cbiAgPGRpdlxuICAgIG5nYkRyb3Bkb3duXG4gICAgI2JiRHJvcGRvd249XCJuZ2JEcm9wZG93blwiXG4gICAgW2F1dG9DbG9zZV09XCJhdXRvQ2xvc2VcIlxuICAgIFtjb250YWluZXJdPVwiY29udGFpbmVyXCJcbiAgICAoYmx1cik9XCJvbkJsdXIoKVwiXG4gICAgKG9wZW5DaGFuZ2UpPVwib25PcGVuQ2hhbmdlKCRldmVudClcIlxuICAgIFtwbGFjZW1lbnRdPVwicG9zaXRpb25cIlxuICAgIGNsYXNzPVwiYmItcHJvZHVjdC1zZWxlY3Rvcl9fZHJvcGRvd25cIlxuICA+XG4gICAgPGJ1dHRvblxuICAgICAgbmdiRHJvcGRvd25Ub2dnbGVcbiAgICAgICNkcm9wZG93blRvZ2dsZVxuICAgICAgYmJCdXR0b25cbiAgICAgIGNvbG9yPVwidW5zdHlsZWRcIlxuICAgICAgY2xhc3M9XCJiYi1wcm9kdWN0LXNlbGVjdG9yX19pdGVtXCJcbiAgICAgIFthdHRyLmRhdGEtcm9sZV09XCIncHJvZHVjdC1zZWxlY3Rvci1leHBhbmQtYnV0dG9uJ1wiXG4gICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICA+XG4gICAgICA8ZGl2IGNsYXNzPVwiYmItcHJvZHVjdC1zZWxlY3Rvcl9faXRlbS1jb250ZW50XCIgW2F0dHIuZGF0YS1yb2xlXT1cIidwcm9kdWN0LXNlbGVjdG9yLXNlbGVjdGVkLWNvbnRlbnQnXCI+XG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIltiYkRyb3Bkb3duVG9nZ2xlXVwiPjwvbmctY29udGVudD5cbiAgICAgIDwvZGl2PlxuICAgICAgPGJiLWljb24tdWkgY3JvcHBlZCBjbGFzcz1cImJiLXByb2R1Y3Qtc2VsZWN0b3JfX2ljb25cIiBbbmFtZV09XCJpc09wZW4gPyAndG9nZ2xlLXVwJyA6ICd0b2dnbGUtZG93bidcIj48L2JiLWljb24tdWk+XG4gICAgPC9idXR0b24+XG4gICAgPGRpdlxuICAgICAgbmdiRHJvcGRvd25NZW51XG4gICAgICBjbGFzcz1cImJiLXByb2R1Y3Qtc2VsZWN0b3JfX2Ryb3Bkb3duLW1lbnUtcGFuZWxcIlxuICAgICAgcm9sZT1cIm1lbnVcIlxuICAgICAgKGNsaWNrKT1cIm9uQ2xvc2UoKVwiXG4gICAgICBbYXR0ci5kYXRhLXJvbGVdPVwiJ3Byb2R1Y3Qtc2VsZWN0b3ItZHJvcGRvd24tbWVudSdcIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3M9XCJiYi1wcm9kdWN0LXNlbGVjdG9yX19kcm9wZG93bi1tZW51XCI+XG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIltiYkRyb3Bkb3duTWVudV1cIj48L25nLWNvbnRlbnQ+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==