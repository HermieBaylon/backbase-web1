import { Component, EventEmitter, HostBinding, HostListener, Inject, Input, Output, TemplateRef, ViewChild, } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { getBemModifiers, fadeSlideAnimation } from '@backbase/ui-ang/util';
import * as i0 from "@angular/core";
import * as i1 from "./notification.config";
import * as i2 from "@backbase/ui-ang/icon";
import * as i3 from "@angular/common";
import * as i4 from "@backbase/ui-ang/focus";
import * as i5 from "@backbase/ui-ang/keyboard-click-directive";
import * as i6 from "@backbase/ui-ang/button";
/**
 * @name NotificationComponent
 *
 * @description
 * Component that displays a notification.
 */
// @dynamic to suppress error with resolving Document type during compilation
export class NotificationComponent {
    constructor(document, elem, config) {
        this.document = document;
        this.elem = elem;
        /**
         * The message template for the notification. Defaults to an empty string
         */
        this.message = '';
        /**
         * The type modifier for the notification. Defaults to 'info'
         *
         * This property will be used to add additional class names to the wrapper div of the notification
         * in the following format: `bb-notification--<<modifier>>`
         *
         */
        this.modifier = 'info';
        /**
         * Whether the notification is dismissible. Defaults to `true`.
         *
         *
         * If `true` then an additional class name is added to the wrapper div of the notification in the following format
         * `bb-notification--dismissible`
         */
        this.dismissible = true;
        /**
         * The callback function for the manually close event.
         */
        this.closeAction = undefined;
        /**
         * The callback function for the host click event.
         */
        this.hostAction = undefined;
        /**
         * Notification manually close event stream.
         */
        this.close = new EventEmitter();
        /**
         * Autofocus will cause the component to be focused on the first rendering.
         */
        this.autofocus = true;
        this.bemBlock = 'bb-notification';
        this.bemModifiers = [() => (this.dismissible ? 'dismissible' : ''), () => this.modifier];
        this.animation = config.animation;
    }
    get dynamicClassNames() {
        return getBemModifiers(this.bemBlock, this.bemModifiers);
    }
    get noAnimation() {
        return !this.animation;
    }
    get animated() {
        return this.animation;
    }
    onKeyEvent(event) {
        switch (event.key) {
            case 'Escape':
                this.onNotificationClose();
                break;
            default:
                return;
        }
        event.preventDefault();
    }
    ngOnInit() {
        if (this.hasPrimaryAction() && typeof this.primaryActionText === 'undefined') {
            throw new Error(`"primaryActionText" input is required when a primaryAction is set in "${this.constructor.name}"`);
        }
        if (this.hasSecondaryAction() && typeof this.secondaryActionText === 'undefined') {
            throw new Error(`"secondaryActionText" input is required when a secondaryAction is set in "${this.constructor.name}"`);
        }
        this.iconColor = this.modifier === 'error' ? 'danger' : this.modifier;
    }
    ngAfterViewInit() {
        if (document.activeElement instanceof HTMLElement) {
            this.previousFocusedElement = document.activeElement;
        }
    }
    get hostTabIndex() {
        return this.hostAction ? 0 : -1;
    }
    onNotificationClick() {
        if (this.hostAction) {
            this.hostAction();
            this.close.emit();
        }
    }
    onNotificationClose() {
        if (this.closeAction) {
            this.closeAction();
        }
        this.close.emit();
    }
    beforeDestroy() {
        const notificationList = this.document.querySelector('.bb-notification-list');
        const isNotificationListFocused = notificationList && notificationList.contains(this.document.activeElement);
        if (notificationList && isNotificationListFocused) {
            const notificationBtns = notificationList.querySelectorAll('.bb-notification__close');
            const currentIndex = Array.from(notificationList.children).findIndex((listElement) => listElement === this.elem.nativeElement);
            const nextElementToFocus = notificationBtns[currentIndex + 1] || notificationBtns[currentIndex - 1] || this.previousFocusedElement;
            if (nextElementToFocus) {
                nextElementToFocus.focus();
            }
        }
    }
    onPrimaryPress() {
        if (this.primaryAction) {
            this.primaryAction();
            this.onNotificationClose();
        }
    }
    onSecondaryPress() {
        if (this.secondaryAction) {
            this.secondaryAction();
            this.onNotificationClose();
        }
    }
    getHeaderTemplate() {
        if (this.header instanceof TemplateRef) {
            return this.header;
        }
        return this.defaultHeaderTemplate;
    }
    getMessageTemplate() {
        if (this.message instanceof TemplateRef) {
            return this.message;
        }
        return this.defaultMessageTemplate;
    }
    hasButtonRow() {
        return this.hasPrimaryAction() || this.hasSecondaryAction();
    }
    hasPrimaryAction() {
        return this.primaryAction !== undefined;
    }
    hasSecondaryAction() {
        return this.secondaryAction !== undefined;
    }
}
NotificationComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NotificationComponent, deps: [{ token: DOCUMENT }, { token: i0.ElementRef }, { token: i1.BBNotificationConfig }], target: i0.ɵɵFactoryTarget.Component });
NotificationComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: NotificationComponent, selector: "bb-notification-ui", inputs: { header: "header", message: "message", primaryActionTemplate: "primaryActionTemplate", secondaryActionTemplate: "secondaryActionTemplate", modifier: "modifier", dismissible: "dismissible", primaryActionText: "primaryActionText", primaryAction: "primaryAction", secondaryActionText: "secondaryActionText", secondaryAction: "secondaryAction", closeAction: "closeAction", hostAction: "hostAction", headerContext: "headerContext", messageContext: "messageContext", animation: "animation" }, outputs: { close: "close" }, host: { listeners: { "window:keydown": "onKeyEvent($event)" }, properties: { "@.disabled": "this.noAnimation", "@fadeSlideInOut": "this.animated" } }, viewQueries: [{ propertyName: "notificationContent", first: true, predicate: ["notificationContent"], descendants: true }, { propertyName: "defaultHeaderTemplate", first: true, predicate: ["defaultNotificationHeaderTemplate"], descendants: true, static: true }, { propertyName: "defaultMessageTemplate", first: true, predicate: ["defaultNotificationMessageTemplate"], descendants: true, static: true }, { propertyName: "defaultPrimaryActionsTemplate", first: true, predicate: ["defaultPrimaryActionsTemplate"], descendants: true, static: true }, { propertyName: "defaultSecondaryActionsTemplate", first: true, predicate: ["defaultSecondaryActionsTemplate"], descendants: true, static: true }], ngImport: i0, template: "<div\n  class=\"bb-notification\"\n  [ngClass]=\"dynamicClassNames\"\n  data-role=\"notification-alert\"\n  #notificationContent\n  [bbFocus]=\"autofocus\"\n  [attr.tabindex]=\"hostTabIndex\"\n  (bbKeyboardClick)=\"onNotificationClick()\"\n>\n  <bb-icon-ui\n    [name]=\"modifier\"\n    [color]=\"iconColor\"\n    class=\"bb-notification__icon\"\n    [attr.data-role]=\"'notification-icon'\"\n  ></bb-icon-ui>\n  <div class=\"bb-notification__body\">\n    <div class=\"bb-notification__title\" data-role=\"notification-heading\">\n      <ng-container *ngTemplateOutlet=\"getHeaderTemplate(); context: headerContext\"></ng-container>\n    </div>\n    <div data-role=\"notification-message\" class=\"bb-text-support\">\n      <ng-container *ngTemplateOutlet=\"getMessageTemplate(); context: messageContext\"></ng-container>\n    </div>\n    <div\n      data-role=\"notification-actions\"\n      *ngIf=\"primaryActionTemplate || primaryActionText || secondaryActionTemplate || secondaryActionText\"\n    >\n      <div class=\"bb-button-bar\">\n        <button\n          *ngIf=\"hasPrimaryAction()\"\n          bbButton\n          type=\"button\"\n          data-role=\"notification-primary-button\"\n          class=\"bb-button-bar__button\"\n          (click)=\"onPrimaryPress()\"\n        >\n          <ng-container *ngIf=\"primaryActionTemplate; else defaultPrimaryActionsTemplate\">\n            <ng-container *ngTemplateOutlet=\"primaryActionTemplate; context: this\"></ng-container>\n          </ng-container>\n        </button>\n        <button\n          bbButton\n          color=\"secondary\"\n          *ngIf=\"hasSecondaryAction()\"\n          data-role=\"notification-secondary-button\"\n          class=\"bb-button-bar__button\"\n          (click)=\"onSecondaryPress()\"\n        >\n          <ng-container *ngIf=\"secondaryActionTemplate; else defaultSecondaryActionsTemplate\">\n            <ng-container *ngTemplateOutlet=\"secondaryActionTemplate; context: this\"></ng-container>\n          </ng-container>\n        </button>\n      </div>\n    </div>\n  </div>\n  <button\n    *ngIf=\"dismissible\"\n    (click)=\"onNotificationClose()\"\n    type=\"button\"\n    data-role=\"notification-close-button\"\n    class=\"bb-notification__close close\"\n    aria-label=\"Close\"\n    i18n-aria-label=\"Close notification button| Text for the close notification button @@bb-notification-ui.close\"\n  >\n    <bb-icon-ui name=\"times\"></bb-icon-ui>\n  </button>\n</div>\n\n<ng-template #defaultNotificationHeaderTemplate>\n  <div [ngClass]=\"{ 'bb-block bb-block--sm': !!header }\">\n    {{ header }}\n  </div>\n</ng-template>\n\n<ng-template #defaultNotificationMessageTemplate>\n  {{ message }}\n</ng-template>\n\n<ng-template #defaultPrimaryActionsTemplate>\n  {{ primaryActionText }}\n</ng-template>\n\n<ng-template #defaultSecondaryActionsTemplate>\n  {{ secondaryActionText }}\n</ng-template>\n", components: [{ type: i2.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }], directives: [{ type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i4.FocusDirective, selector: "[bbFocus]", inputs: ["bbFocus"], exportAs: ["bbFocus"] }, { type: i5.KeyboardClickDirective, selector: "[bbKeyboardClick]", outputs: ["bbKeyboardClick"] }, { type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i6.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }], animations: [fadeSlideAnimation] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: NotificationComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-notification-ui',
                    templateUrl: './notification.component.html',
                    animations: [fadeSlideAnimation],
                }]
        }], ctorParameters: function () { return [{ type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }, { type: i0.ElementRef }, { type: i1.BBNotificationConfig }]; }, propDecorators: { header: [{
                type: Input
            }], message: [{
                type: Input
            }], primaryActionTemplate: [{
                type: Input
            }], secondaryActionTemplate: [{
                type: Input
            }], modifier: [{
                type: Input
            }], dismissible: [{
                type: Input
            }], primaryActionText: [{
                type: Input
            }], primaryAction: [{
                type: Input
            }], secondaryActionText: [{
                type: Input
            }], secondaryAction: [{
                type: Input
            }], closeAction: [{
                type: Input
            }], hostAction: [{
                type: Input
            }], headerContext: [{
                type: Input
            }], messageContext: [{
                type: Input
            }], animation: [{
                type: Input
            }], close: [{
                type: Output
            }], notificationContent: [{
                type: ViewChild,
                args: ['notificationContent']
            }], defaultHeaderTemplate: [{
                type: ViewChild,
                args: ['defaultNotificationHeaderTemplate', { static: true }]
            }], defaultMessageTemplate: [{
                type: ViewChild,
                args: ['defaultNotificationMessageTemplate', { static: true }]
            }], defaultPrimaryActionsTemplate: [{
                type: ViewChild,
                args: ['defaultPrimaryActionsTemplate', { static: true }]
            }], defaultSecondaryActionsTemplate: [{
                type: ViewChild,
                args: ['defaultSecondaryActionsTemplate', { static: true }]
            }], noAnimation: [{
                type: HostBinding,
                args: ['@.disabled']
            }], animated: [{
                type: HostBinding,
                args: ['@fadeSlideInOut']
            }], onKeyEvent: [{
                type: HostListener,
                args: ['window:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvdWktYW5nL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7Ozs7QUFLNUU7Ozs7O0dBS0c7QUFDSCw2RUFBNkU7QUFNN0UsTUFBTSxPQUFPLHFCQUFxQjtJQWtJaEMsWUFBc0MsUUFBa0IsRUFBVSxJQUFnQixFQUFFLE1BQTRCO1FBQTFFLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO1FBN0hsRjs7V0FFRztRQUNNLFlBQU8sR0FBOEIsRUFBRSxDQUFDO1FBU2pEOzs7Ozs7V0FNRztRQUNNLGFBQVEsR0FBcUIsTUFBTSxDQUFDO1FBQzdDOzs7Ozs7V0FNRztRQUNNLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBbUI1Qjs7V0FFRztRQUNNLGdCQUFXLEdBQXlCLFNBQVMsQ0FBQztRQUN2RDs7V0FFRztRQUNNLGVBQVUsR0FBeUIsU0FBUyxDQUFDO1FBY3REOztXQUVHO1FBQ08sVUFBSyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFrQnJDOztXQUVHO1FBQ0gsY0FBUyxHQUFHLElBQUksQ0FBQztRQU9QLGFBQVEs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LFNBQVM7dUJBQUMsb0NBQW9DLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUdILDZCQUE2QjtzQkFBMUYsU0FBUzt1QkFBQywrQkFBK0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBR0ksK0JBQStCO3NCQUE5RixTQUFTO3VCQUFDLGlDQUFpQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkEwQi9CLFdBQVc7c0JBQXpDLFdBQVc7dUJBQUMsWUFBWTtnQkFJVyxRQUFRO3NCQUEzQyxXQUFXO3VCQUFDLGlCQUFpQjtnQkFLOUIsVUFBVTtzQkFEVCxZQUFZO3VCQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IGdldEJlbU1vZGlmaWVycywgZmFkZVNsaWRlQW5pbWF0aW9uIH0gZnJvbSAnQGJhY2tiYXNlL3VpLWFuZy91dGlsJztcbmltcG9ydCB7IEJCTm90aWZpY2F0aW9uQ29uZmlnIH0gZnJvbSAnLi9ub3RpZmljYXRpb24uY29uZmlnJztcblxuZXhwb3J0IHR5cGUgTm90aWZpY2F0aW9uVHlwZSA9ICdzdWNjZXNzJyB8ICdpbmZvJyB8ICd3YXJuaW5nJyB8ICdlcnJvcicgfCAnYWxlcnQnO1xuXG4vKipcbiAqIEBuYW1lIE5vdGlmaWNhdGlvbkNvbXBvbmVudFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQ29tcG9uZW50IHRoYXQgZGlzcGxheXMgYSBub3RpZmljYXRpb24uXG4gKi9cbi8vIEBkeW5hbWljIHRvIHN1cHByZXNzIGVycm9yIHdpdGggcmVzb2x2aW5nIERvY3VtZW50IHR5cGUgZHVyaW5nIGNvbXBpbGF0aW9uXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1ub3RpZmljYXRpb24tdWknLFxuICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpY2F0aW9uLmNvbXBvbmVudC5odG1sJyxcbiAgYW5pbWF0aW9uczogW2ZhZGVTbGlkZUFuaW1hdGlvbl0sXG59KVxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG4gIC8qKlxuICAgKiBUaGUgaGVhZGVyIGZvciB0aGUgbm90aWZpY2F0aW9uLlxuICAgKi9cbiAgQElucHV0KCkgaGVhZGVyOiBUZW1wbGF0ZVJlZjxhbnk+IHwgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogVGhlIG1lc3NhZ2UgdGVtcGxhdGUgZm9yIHRoZSBub3RpZmljYXRpb24uIERlZmF1bHRzIHRvIGFuIGVtcHR5IHN0cmluZ1xuICAgKi9cbiAgQElucHV0KCkgbWVzc2FnZTogVGVtcGxhdGVSZWY8YW55PiB8IHN0cmluZyA9ICcnO1xuICAvKipcbiAgICogVGhlIHByaW1hcnkgYWN0aW9uIHRlbXBsYXRlIGZvciB0aGUgbm90aWZpY2F0aW9uLlxuICAgKi9cbiAgQElucHV0KCkgcHJpbWFyeUFjdGlvblRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogVGhlIHNlY29uZGFyeSBhY3Rpb24gdGVtcGxhdGUgZm9yIHRoZSBub3RpZmljYXRpb24uXG4gICAqL1xuICBASW5wdXQoKSBzZWNvbmRhcnlBY3Rpb25UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG1vZGlmaWVyIGZvciB0aGUgbm90aWZpY2F0aW9uLiBEZWZhdWx0cyB0byAnaW5mbydcbiAgICpcbiAgICogVGhpcyBwcm9wZXJ0eSB3aWxsIGJlIHVzZWQgdG8gYWRkIGFkZGl0aW9uYWwgY2xhc3MgbmFtZXMgdG8gdGhlIHdyYXBwZXIgZGl2IG9mIHRoZSBub3RpZmljYXRpb25cbiAgICogaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6IGBiYi1ub3RpZmljYXRpb24tLTw8bW9kaWZpZXI+PmBcbiAgICpcbiAgICovXG4gIEBJbnB1dCgpIG1vZGlmaWVyOiBOb3RpZmljYXRpb25UeXBlID0gJ2luZm8nO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgbm90aWZpY2F0aW9uIGlzIGRpc21pc3NpYmxlLiBEZWZhdWx0cyB0byBgdHJ1ZWAuXG4gICAqXG4gICAqXG4gICAqIElmIGB0cnVlYCB0aGVuIGFuIGFkZGl0aW9uYWwgY2xhc3MgbmFtZSBpcyBhZGRlZCB0byB0aGUgd3JhcHBlciBkaXYgb2YgdGhlIG5vdGlmaWNhdGlvbiBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdFxuICAgKiBgYmItbm90aWZpY2F0aW9uLS1kaXNtaXNzaWJsZWBcbiAgICovXG4gIEBJbnB1dCgpIGRpc21pc3NpYmxlID0gdHJ1ZTtcbiAgLyoqXG4gICAqIFRoZSB0ZXh0IGZvciB0aGUgcHJpbWFyeSBhY3Rpb24gYnV0dG9uLlxuICAgKiBXaWxsIHRocm93IGFuIGVycm9yIGlmIHVuc2V0IGFuZCBwcmltYXJ5IGFjdGlvbiBzZXQuXG4gICAqL1xuICBASW5wdXQoKSBwcmltYXJ5QWN0aW9uVGV4dDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogQSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIHByaW1hcnkgYWN0aW9uLiBSZXF1aXJlZCB0byBzaG93IHRoZSBidXR0b24uXG4gICAqL1xuICBASW5wdXQoKSBwcmltYXJ5QWN0aW9uOiBGdW5jdGlvbiB8IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIFRoZSB0ZXh0IGZvciB0aGUgc2Vjb25kYXJ5IGFjdGlvbiBidXR0b24uXG4gICAqIFdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgdW5zZXQgYW5kIHNlY29uZGFyeSBhY3Rpb24gc2V0LlxuICAgKi9cbiAgQElucHV0KCkgc2Vjb25kYXJ5QWN0aW9uVGV4dDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogQSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIHNlY29uZGFyeSBhY3Rpb24uIFJlcXVpcmVkIHRvIHNob3cgdGhlIGJ1dHRvbi5cbiAgICovXG4gIEBJbnB1dCgpIHNlY29uZGFyeUFjdGlvbjogRnVuY3Rpb24gfCB1bmRlZmluZWQ7XG4gIC8qKlxuICAgKiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBtYW51YWxseSBjbG9zZSBldmVudC5cbiAgICovXG4gIEBJbnB1dCgpIGNsb3NlQWN0aW9uOiBGdW5jdGlvbiB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIGhvc3QgY2xpY2sgZXZlbnQuXG4gICAqL1xuICBASW5wdXQoKSBob3N0QWN0aW9uOiBGdW5jdGlvbiB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIFRoZSBjb250ZXh0IGZvciBub3RpZmljYXRpb24gaGVhZGVyIHRlbXBsYXRlLlxuICAgKi9cbiAgQElucHV0KCkgaGVhZGVyQ29udGV4dDogYW55O1xuICAvKipcbiAgICogVGhlIGNvbnRleHQgZm9yIG5vdGlmaWNhdGlvbiBtZXNzYWdlIHRlbXBsYXRlLlxuICAgKi9cbiAgQElucHV0KCkgbWVzc2FnZUNvbnRleHQ6IGFueTtcbiAgLyoqXG4gICAqIElmIGB0cnVlYCwgbm90aWZpY2F0aW9uIG9wZW5pbmcgYW5kIGNsb3Npbmcgd2lsbCBiZSBhbmltYXRlZC5cbiAgICogQW5pbWF0aW9uIGlzIHRyaWdnZXJlZCBvbmx5IHdoZW4gdGhlIGAuaGlkZSgpYCBvciBgLnNob3coKWAgZnVuY3Rpb25zIGFyZSBjYWxsZWRcbiAgICovXG4gIEBJbnB1dCgpIGFuaW1hdGlvbjogYm9vbGVhbjtcbiAgLyoqXG4gICAqIE5vdGlmaWNhdGlvbiBtYW51YWxseSBjbG9zZSBldmVudCBzdHJlYW0uXG4gICAqL1xuICBAT3V0cHV0KCkgY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBWaWV3Q2hpbGQoJ25vdGlmaWNhdGlvbkNvbnRlbnQnKSBub3RpZmljYXRpb25Db250ZW50ITogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnZGVmYXVsdE5vdGlmaWNhdGlvbkhlYWRlclRlbXBsYXRlJywgeyBzdGF0aWM6IHRydWUgfSkgZGVmYXVsdEhlYWRlclRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgdW5kZWZpbmVkO1xuICBAVmlld0NoaWxkKCdkZWZhdWx0Tm90aWZpY2F0aW9uTWVzc2FnZVRlbXBsYXRlJywgeyBzdGF0aWM6IHRydWUgfSkgZGVmYXVsdE1lc3NhZ2VUZW1wbGF0ZTpcbiAgICB8IFRlbXBsYXRlUmVmPGFueT5cbiAgICB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnZGVmYXVsdFByaW1hcnlBY3Rpb25zVGVtcGxhdGUnLCB7IHN0YXRpYzogdHJ1ZSB9KSBkZWZhdWx0UHJpbWFyeUFjdGlvbnNUZW1wbGF0ZTpcbiAgICB8IFRlbXBsYXRlUmVmPGFueT5cbiAgICB8IHVuZGVmaW5lZDtcbiAgQFZpZXdDaGlsZCgnZGVmYXVsdFNlY29uZGFyeUFjdGlvbnNUZW1wbGF0ZScsIHsgc3RhdGljOiB0cnVlIH0pIGRlZmF1bHRTZWNvbmRhcnlBY3Rpb25zVGVtcGxhdGU6XG4gICAgfCBUZW1wbGF0ZVJlZjxhbnk+XG4gICAgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIE5vdGlmaWNhdGlvbiBpY29uIGNvbG9yLlxuICAgKi9cbiAgaWNvbkNvbG9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIEF1dG9mb2N1cyB3aWxsIGNhdXNlIHRoZSBjb21wb25lbnQgdG8gYmUgZm9jdXNlZCBvbiB0aGUgZmlyc3QgcmVuZGVyaW5nLlxuICAgKi9cbiAgYXV0b2ZvY3VzID0gdHJ1ZTtcblxuICAvKipcbiAgICogRWxlbWVudCB0aGF0IGZvY3VzZWQgYmVmb3JlIG5vdGlmaWNhdGlvbiBpcyBvcGVuLCBmb3IgYmFjayBmb2N1cyB3aGVuIG5vdGlmaWNhdGlvbiBpcyBjbG9zZWQuXG4gICAqL1xuICBwcmV2aW91c0ZvY3VzZWRFbGVtZW50ITogSFRNTEVsZW1lbnQ7XG5cbiAgcHJvdGVjdGVkIGJlbUJsb2NrID0gJ2JiLW5vdGlmaWNhdGlvbic7XG4gIHByb3RlY3RlZCBiZW1Nb2RpZmllcnMgPSBbKCkgPT4gKHRoaXMuZGlzbWlzc2libGUgPyAnZGlzbWlzc2libGUnIDogJycpLCAoKSA9PiB0aGlzLm1vZGlmaWVyXTtcblxuICBnZXQgZHluYW1pY0NsYXNzTmFtZXMoKSB7XG4gICAgcmV0dXJuIGdldEJlbU1vZGlmaWVycyh0aGlzLmJlbUJsb2NrLCB0aGlzLmJlbU1vZGlmaWVycyk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ0AuZGlzYWJsZWQnKSBnZXQgbm9BbmltYXRpb24oKSB7XG4gICAgcmV0dXJuICF0aGlzLmFuaW1hdGlvbjtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnQGZhZGVTbGlkZUluT3V0JykgZ2V0IGFuaW1hdGVkKCkge1xuICAgIHJldHVybiB0aGlzLmFuaW1hdGlvbjtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzprZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlFdmVudChldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIHN3aXRjaCAoZXZlbnQua2V5KSB7XG4gICAgICBjYXNlICdFc2NhcGUnOlxuICAgICAgICB0aGlzLm9uTm90aWZpY2F0aW9uQ2xvc2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudCwgcHJpdmF0ZSBlbGVtOiBFbGVtZW50UmVmLCBjb25maWc6IEJCTm90aWZpY2F0aW9uQ29uZmlnKSB7XG4gICAgdGhpcy5hbmltYXRpb24gPSBjb25maWcuYW5pbWF0aW9uO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMuaGFzUHJpbWFyeUFjdGlvbigpICYmIHR5cGVvZiB0aGlzLnByaW1hcnlBY3Rpb25UZXh0ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgXCJwcmltYXJ5QWN0aW9uVGV4dFwiIGlucHV0IGlzIHJlcXVpcmVkIHdoZW4gYSBwcmltYXJ5QWN0aW9uIGlzIHNldCBpbiBcIiR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfVwiYCxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICh0aGlzLmhhc1NlY29uZGFyeUFjdGlvbigpICYmIHR5cGVvZiB0aGlzLnNlY29uZGFyeUFjdGlvblRleHQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBcInNlY29uZGFyeUFjdGlvblRleHRcIiBpbnB1dCBpcyByZXF1aXJlZCB3aGVuIGEgc2Vjb25kYXJ5QWN0aW9uIGlzIHNldCBpbiBcIiR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfVwiYCxcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuaWNvbkNvbG9yID0gdGhpcy5tb2RpZmllciA9PT0gJ2Vycm9yJyA/ICdkYW5nZXInIDogdGhpcy5tb2RpZmllcjtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICB0aGlzLnByZXZpb3VzRm9jdXNlZEVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgIH1cbiAgfVxuXG4gIGdldCBob3N0VGFiSW5kZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMuaG9zdEFjdGlvbiA/IDAgOiAtMTtcbiAgfVxuXG4gIG9uTm90aWZpY2F0aW9uQ2xpY2soKSB7XG4gICAgaWYgKHRoaXMuaG9zdEFjdGlvbikge1xuICAgICAgdGhpcy5ob3N0QWN0aW9uKCk7XG4gICAgICB0aGlzLmNsb3NlLmVtaXQoKTtcbiAgICB9XG4gIH1cblxuICBvbk5vdGlmaWNhdGlvbkNsb3NlKCkge1xuICAgIGlmICh0aGlzLmNsb3NlQWN0aW9uKSB7XG4gICAgICB0aGlzLmNsb3NlQWN0aW9uKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuICB9XG5cbiAgYmVmb3JlRGVzdHJveSgpIHtcbiAgICBjb25zdCBub3RpZmljYXRpb25MaXN0ID0gdGhpcy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmItbm90aWZpY2F0aW9uLWxpc3QnKTtcbiAgICBjb25zdCBpc05vdGlmaWNhdGlvbkxpc3RGb2N1c2VkID0gbm90aWZpY2F0aW9uTGlzdCAmJiBub3RpZmljYXRpb25MaXN0LmNvbnRhaW5zKHRoaXMuZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG5cbiAgICBpZiAobm90aWZpY2F0aW9uTGlzdCAmJiBpc05vdGlmaWNhdGlvbkxpc3RGb2N1c2VkKSB7XG4gICAgICBjb25zdCBub3RpZmljYXRpb25CdG5zID0gbm90aWZpY2F0aW9uTGlzdC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignLmJiLW5vdGlmaWNhdGlvbl9fY2xvc2UnKTtcblxuICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gQXJyYXkuZnJvbShub3RpZmljYXRpb25MaXN0LmNoaWxkcmVuKS5maW5kSW5kZXgoXG4gICAgICAgIChsaXN0RWxlbWVudCkgPT4gbGlzdEVsZW1lbnQgPT09IHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgbmV4dEVsZW1lbnRUb0ZvY3VzID1cbiAgICAgICAgbm90aWZpY2F0aW9uQnRuc1tjdXJyZW50SW5kZXggKyAxXSB8fCBub3RpZmljYXRpb25CdG5zW2N1cnJlbnRJbmRleCAtIDFdIHx8IHRoaXMucHJldmlvdXNGb2N1c2VkRWxlbWVudDtcblxuICAgICAgaWYgKG5leHRFbGVtZW50VG9Gb2N1cykge1xuICAgICAgICBuZXh0RWxlbWVudFRvRm9jdXMuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvblByaW1hcnlQcmVzcygpIHtcbiAgICBpZiAodGhpcy5wcmltYXJ5QWN0aW9uKSB7XG4gICAgICB0aGlzLnByaW1hcnlBY3Rpb24oKTtcbiAgICAgIHRoaXMub25Ob3RpZmljYXRpb25DbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIG9uU2Vjb25kYXJ5UHJlc3MoKSB7XG4gICAgaWYgKHRoaXMuc2Vjb25kYXJ5QWN0aW9uKSB7XG4gICAgICB0aGlzLnNlY29uZGFyeUFjdGlvbigpO1xuICAgICAgdGhpcy5vbk5vdGlmaWNhdGlvbkNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0SGVhZGVyVGVtcGxhdGUoKTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHRoaXMuaGVhZGVyIGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlYWRlcjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0SGVhZGVyVGVtcGxhdGU7XG4gIH1cblxuICBnZXRNZXNzYWdlVGVtcGxhdGUoKTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHRoaXMubWVzc2FnZSBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSB7XG4gICAgICByZXR1cm4gdGhpcy5tZXNzYWdlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmRlZmF1bHRNZXNzYWdlVGVtcGxhdGU7XG4gIH1cblxuICBoYXNCdXR0b25Sb3coKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaGFzUHJpbWFyeUFjdGlvbigpIHx8IHRoaXMuaGFzU2Vjb25kYXJ5QWN0aW9uKCk7XG4gIH1cblxuICBoYXNQcmltYXJ5QWN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnByaW1hcnlBY3Rpb24gIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGhhc1NlY29uZGFyeUFjdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zZWNvbmRhcnlBY3Rpb24gIT09IHVuZGVmaW5lZDtcbiAgfVxufVxuIiwiPGRpdlxuICBjbGFzcz1cImJiLW5vdGlmaWNhdGlvblwiXG4gIFtuZ0NsYXNzXT1cImR5bmFtaWNDbGFzc05hbWVzXCJcbiAgZGF0YS1yb2xlPVwibm90aWZpY2F0aW9uLWFsZXJ0XCJcbiAgI25vdGlmaWNhdGlvbkNvbnRlbnRcbiAgW2JiRm9jdXNdPVwiYXV0b2ZvY3VzXCJcbiAgW2F0dHIudGFiaW5kZXhdPVwiaG9zdFRhYkluZGV4XCJcbiAgKGJiS2V5Ym9hcmRDbGljayk9XCJvbk5vdGlmaWNhdGlvbkNsaWNrKClcIlxuPlxuICA8YmItaWNvbi11aVxuICAgIFtuYW1lXT1cIm1vZGlmaWVyXCJcbiAgICBbY29sb3JdPVwiaWNvbkNvbG9yXCJcbiAgICBjbGFzcz1cImJiLW5vdGlmaWNhdGlvbl9faWNvblwiXG4gICAgW2F0dHIuZGF0YS1yb2xlXT1cIidub3RpZmljYXRpb24taWNvbidcIlxuICA+PC9iYi1pY29uLXVpPlxuICA8ZGl2IGNsYXNzPVwiYmItbm90aWZpY2F0aW9uX19ib2R5XCI+XG4gICAgPGRpdiBjbGFzcz1cImJiLW5vdGlmaWNhdGlvbl9fdGl0bGVcIiBkYXRhLXJvbGU9XCJub3RpZmljYXRpb24taGVhZGluZ1wiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImdldEhlYWRlclRlbXBsYXRlKCk7IGNvbnRleHQ6IGhlYWRlckNvbnRleHRcIj48L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGRhdGEtcm9sZT1cIm5vdGlmaWNhdGlvbi1tZXNzYWdlXCIgY2xhc3M9XCJiYi10ZXh0LXN1cHBvcnRcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJnZXRNZXNzYWdlVGVtcGxhdGUoKTsgY29udGV4dDogbWVzc2FnZUNvbnRleHRcIj48L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2XG4gICAgICBkYXRhLXJvbGU9XCJub3RpZmljYXRpb24tYWN0aW9uc1wiXG4gICAgICAqbmdJZj1cInByaW1hcnlBY3Rpb25UZW1wbGF0ZSB8fCBwcmltYXJ5QWN0aW9uVGV4dCB8fCBzZWNvbmRhcnlBY3Rpb25UZW1wbGF0ZSB8fCBzZWNvbmRhcnlBY3Rpb25UZXh0XCJcbiAgICA+XG4gICAgICA8ZGl2IGNsYXNzPVwiYmItYnV0dG9uLWJhclwiPlxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgKm5nSWY9XCJoYXNQcmltYXJ5QWN0aW9uKClcIlxuICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgZGF0YS1yb2xlPVwibm90aWZpY2F0aW9uLXByaW1hcnktYnV0dG9uXCJcbiAgICAgICAgICBjbGFzcz1cImJiLWJ1dHRvbi1iYXJfX2J1dHRvblwiXG4gICAgICAgICAgKGNsaWNrKT1cIm9uUHJpbWFyeVByZXNzKClcIlxuICAgICAgICA+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInByaW1hcnlBY3Rpb25UZW1wbGF0ZTsgZWxzZSBkZWZhdWx0UHJpbWFyeUFjdGlvbnNUZW1wbGF0ZVwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cInByaW1hcnlBY3Rpb25UZW1wbGF0ZTsgY29udGV4dDogdGhpc1wiPjwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgY29sb3I9XCJzZWNvbmRhcnlcIlxuICAgICAgICAgICpuZ0lmPVwiaGFzU2Vjb25kYXJ5QWN0aW9uKClcIlxuICAgICAgICAgIGRhdGEtcm9sZT1cIm5vdGlmaWNhdGlvbi1zZWNvbmRhcnktYnV0dG9uXCJcbiAgICAgICAgICBjbGFzcz1cImJiLWJ1dHRvbi1iYXJfX2J1dHRvblwiXG4gICAgICAgICAgKGNsaWNrKT1cIm9uU2Vjb25kYXJ5UHJlc3MoKVwiXG4gICAgICAgID5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwic2Vjb25kYXJ5QWN0aW9uVGVtcGxhdGU7IGVsc2UgZGVmYXVsdFNlY29uZGFyeUFjdGlvbnNUZW1wbGF0ZVwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cInNlY29uZGFyeUFjdGlvblRlbXBsYXRlOyBjb250ZXh0OiB0aGlzXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICA8YnV0dG9uXG4gICAgKm5nSWY9XCJkaXNtaXNzaWJsZVwiXG4gICAgKGNsaWNrKT1cIm9uTm90aWZpY2F0aW9uQ2xvc2UoKVwiXG4gICAgdHlwZT1cImJ1dHRvblwiXG4gICAgZGF0YS1yb2xlPVwibm90aWZpY2F0aW9uLWNsb3NlLWJ1dHRvblwiXG4gICAgY2xhc3M9XCJiYi1ub3RpZmljYXRpb25fX2Nsb3NlIGNsb3NlXCJcbiAgICBhcmlhLWxhYmVsPVwiQ2xvc2VcIlxuICAgIGkxOG4tYXJpYS1sYWJlbD1cIkNsb3NlIG5vdGlmaWNhdGlvbiBidXR0b258IFRleHQgZm9yIHRoZSBjbG9zZSBub3RpZmljYXRpb24gYnV0dG9uIEBAYmItbm90aWZpY2F0aW9uLXVpLmNsb3NlXCJcbiAgPlxuICAgIDxiYi1pY29uLXVpIG5hbWU9XCJ0aW1lc1wiPjwvYmItaWNvbi11aT5cbiAgPC9idXR0b24+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNkZWZhdWx0Tm90aWZpY2F0aW9uSGVhZGVyVGVtcGxhdGU+XG4gIDxkaXYgW25nQ2xhc3NdPVwieyAnYmItYmxvY2sgYmItYmxvY2stLXNtJzogISFoZWFkZXIgfVwiPlxuICAgIHt7IGhlYWRlciB9fVxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdE5vdGlmaWNhdGlvbk1lc3NhZ2VUZW1wbGF0ZT5cbiAge3sgbWVzc2FnZSB9fVxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNkZWZhdWx0UHJpbWFyeUFjdGlvbnNUZW1wbGF0ZT5cbiAge3sgcHJpbWFyeUFjdGlvblRleHQgfX1cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdFNlY29uZGFyeUFjdGlvbnNUZW1wbGF0ZT5cbiAge3sgc2Vjb25kYXJ5QWN0aW9uVGV4dCB9fVxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==