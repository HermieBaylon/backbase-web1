import { Injectable, } from '@angular/core';
import * as i0 from "@angular/core";
export class AppendToDomService {
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
    }
    appendComponentToRoot(component, autofocus = true, projectables = [], root = document.body) {
        var _a, _b;
        // 1. Create a component reference from the component
        const componentRef = this.componentFactoryResolver
            .resolveComponentFactory(component)
            .create(this.injector, [projectables]);
        // 2. Attach component to the appRef so that it's inside the ng component tree
        this.appRef.attachView(componentRef.hostView);
        // 3. Get DOM element from component
        const domElem = componentRef.hostView.rootNodes[0];
        // 4. Append notification list if missing
        const listElement = this.generateListElement(root);
        // 5. Add item class
        domElem.setAttribute('class', 'bb-notification-list__item');
        // 6. Set role='status' if autofocus is set to true and role='alert' if autofocus is set to false
        if (autofocus) {
            (_a = domElem === null || domElem === void 0 ? void 0 : domElem.firstElementChild) === null || _a === void 0 ? void 0 : _a.setAttribute('role', 'status');
        }
        else {
            componentRef.instance.autofocus = false;
            // For Firefox and NVDA role should be set to list element
            if (navigator.userAgent.indexOf('Firefox') > -1) {
                listElement.setAttribute('role', 'alert');
            }
            else {
                (_b = domElem === null || domElem === void 0 ? void 0 : domElem.firstElementChild) === null || _b === void 0 ? void 0 : _b.setAttribute('role', 'alert');
            }
        }
        // 7. Append new element to list of elements and push old ones down.
        if (listElement) {
            listElement.insertBefore(domElem, listElement.firstChild);
        }
        return {
            componentInstance: componentRef.instance,
            unmountComponent: () => {
                this.destroyElement(componentRef);
            },
        };
    }
    generateListElement(root) {
        let listElement = document.getElementsByClassName('bb-notification-list')[0];
        if (!listElement) {
            listElement = document.createElement('div');
            listElement.setAttribute('class', 'bb-notification-list');
            root.appendChild(listElement);
        }
        return listElement;
    }
    /*
      This method is a hack to make notifications visible to screen readers
      (NVDA and VoiceOver) when a modal window (role="dialog") is opened.
      aria-label="polite" on the list element and role="status" with
      aria-atomic="true" on notification element don't resolve the issue.
      Any better ideas are welcome.
     */
    checkAndDestroyListElement() {
        const listElement = document.getElementsByClassName('bb-notification-list')[0];
        // don't remove list element if there are any remaining notifications
        if (!listElement || listElement.childElementCount > 0) {
            return;
        }
        listElement.remove();
    }
    destroyElement(componentRef) {
        componentRef.instance.beforeDestroy();
        this.appRef.detachView(componentRef.hostView);
        componentRef.destroy();
        // is required to make notifications visible to screen readers when any modal window is opened
        this.checkAndDestroyListElement();
    }
}
AppendToDomService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: AppendToDomService, deps: [{ token: i0.ComponentFactoryResolver }, { token: i0.ApplicationRef }, { token: i0.Injector }], target: i0.ɵɵFactoryTarget.Injectable });
AppendToDomService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: AppendToDomService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: AppendToDomService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i0.ComponentFactoryResolver }, { type: i0.ApplicationRef }, { type: i0.Injector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwZW5kLXRvLWRvbS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy91aS1hbmcvbm90aWZpY2F0aW9uL2FwcGVuZC10by1kb20uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBS0wsVUFBVSxHQUdYLE1BQU0sZUFBZSxDQUFDOztBQU12QixNQUFNLE9BQU8sa0JBQWtCO0lBQzdCLFlBQ21CLHdCQUFrRCxFQUNsRCxNQUFzQixFQUN0QixRQUFrQjtRQUZsQiw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQ3RCLGFBQVEsR0FBUixRQUFRLENBQVU7SUFDbEMsQ0FBQztJQUVKLHFCQUFxQixDQUNuQixTQUFzQyxFQUN0QyxTQUFTLEdBQUcsSUFBSSxFQUNoQixlQUFzQixFQUFFLEVBQ3hCLE9BQWEsUUFBUSxDQUFDLElBQUk7O1FBSzFCLHFEQUFxRDtRQUNyRCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsd0JBQXdCO2FBQy9DLHVCQUF1QixDQUFDLFNBQVMsQ0FBQzthQUNsQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFFekMsOEVBQThFO1FBQzlFLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU5QyxvQ0FBb0M7UUFDcEMsTUFBTSxPQUFPLEdBQUksWUFBWSxDQUFDLFFBQWlDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBZ0IsQ0FBQztRQUU1Rix5Q0FBeUM7UUFDekMsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRW5ELG9CQUFvQjtRQUNwQixPQUFPLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSw0QkFBNEIsQ0FBQyxDQUFDO1FBRTVELGlHQUFpRztRQUNqRyxJQUFJLFNBQVMsRUFBRTtZQUNiLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLGlCQUFpQiwwQ0FBRSxZQUFZLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQzVEO2FBQU07WUFDTCxZQUFZLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDeEMsMERBQTBEO1lBQzFELElBQUksU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQy9DLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQzNDO2lCQUFNO2dCQUNMLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLGlCQUFpQiwwQ0FBRSxZQUFZLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQzNEO1NBQ0Y7UUFFRCxvRUFBb0U7UUFDcEUsSUFBSSxXQUFXLEVBQUU7WUFDZixXQUFXLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDM0Q7UUFFRCxPQUFPO1lBQ0wsaUJBQWlCLEVBQUUsWUFBWSxDQUFDLFFBQVE7WUFDeEMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO2dCQUNyQixJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3BDLENBQUM7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVPLG1CQUFtQixDQUFDLElBQVU7UUFDcEMsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDLHNCQUFzQixDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0UsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixXQUFXLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1QyxXQUFXLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1lBQzFELElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDL0I7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssMEJBQTBCO1FBQ2hDLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9FLHFFQUFxRTtRQUNyRSxJQUFJLENBQUMsV0FBVyxJQUFJLFdBQVcsQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLEVBQUU7WUFDckQsT0FBTztTQUNSO1FBQ0QsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFTyxjQUFjLENBQUMsWUFBK0I7UUFDcEQsWUFBWSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3ZCLDhGQUE4RjtRQUM5RixJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztJQUNwQyxDQUFDOztnSEE1RlUsa0JBQWtCO29IQUFsQixrQkFBa0IsY0FGakIsTUFBTTs0RkFFUCxrQkFBa0I7a0JBSDlCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQXBwbGljYXRpb25SZWYsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBFbWJlZGRlZFZpZXdSZWYsXG4gIEluamVjdGFibGUsXG4gIEluamVjdG9yLFxuICBUeXBlLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbkNvbXBvbmVudCB9IGZyb20gJy4vbm90aWZpY2F0aW9uLmNvbXBvbmVudCc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBBcHBlbmRUb0RvbVNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGluamVjdG9yOiBJbmplY3RvcixcbiAgKSB7fVxuXG4gIGFwcGVuZENvbXBvbmVudFRvUm9vdChcbiAgICBjb21wb25lbnQ6IFR5cGU8Tm90aWZpY2F0aW9uQ29tcG9uZW50PixcbiAgICBhdXRvZm9jdXMgPSB0cnVlLFxuICAgIHByb2plY3RhYmxlczogYW55W10gPSBbXSxcbiAgICByb290OiBOb2RlID0gZG9jdW1lbnQuYm9keSxcbiAgKToge1xuICAgIGNvbXBvbmVudEluc3RhbmNlOiBhbnk7XG4gICAgdW5tb3VudENvbXBvbmVudDogKCkgPT4gdm9pZDtcbiAgfSB7XG4gICAgLy8gMS4gQ3JlYXRlIGEgY29tcG9uZW50IHJlZmVyZW5jZSBmcm9tIHRoZSBjb21wb25lbnRcbiAgICBjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICAgICAgLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudClcbiAgICAgIC5jcmVhdGUodGhpcy5pbmplY3RvciwgW3Byb2plY3RhYmxlc10pO1xuXG4gICAgLy8gMi4gQXR0YWNoIGNvbXBvbmVudCB0byB0aGUgYXBwUmVmIHNvIHRoYXQgaXQncyBpbnNpZGUgdGhlIG5nIGNvbXBvbmVudCB0cmVlXG4gICAgdGhpcy5hcHBSZWYuYXR0YWNoVmlldyhjb21wb25lbnRSZWYuaG9zdFZpZXcpO1xuXG4gICAgLy8gMy4gR2V0IERPTSBlbGVtZW50IGZyb20gY29tcG9uZW50XG4gICAgY29uc3QgZG9tRWxlbSA9IChjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPGFueT4pLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcblxuICAgIC8vIDQuIEFwcGVuZCBub3RpZmljYXRpb24gbGlzdCBpZiBtaXNzaW5nXG4gICAgY29uc3QgbGlzdEVsZW1lbnQgPSB0aGlzLmdlbmVyYXRlTGlzdEVsZW1lbnQocm9vdCk7XG5cbiAgICAvLyA1LiBBZGQgaXRlbSBjbGFzc1xuICAgIGRvbUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdiYi1ub3RpZmljYXRpb24tbGlzdF9faXRlbScpO1xuXG4gICAgLy8gNi4gU2V0IHJvbGU9J3N0YXR1cycgaWYgYXV0b2ZvY3VzIGlzIHNldCB0byB0cnVlIGFuZCByb2xlPSdhbGVydCcgaWYgYXV0b2ZvY3VzIGlzIHNldCB0byBmYWxzZVxuICAgIGlmIChhdXRvZm9jdXMpIHtcbiAgICAgIGRvbUVsZW0/LmZpcnN0RWxlbWVudENoaWxkPy5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnc3RhdHVzJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbXBvbmVudFJlZi5pbnN0YW5jZS5hdXRvZm9jdXMgPSBmYWxzZTtcbiAgICAgIC8vIEZvciBGaXJlZm94IGFuZCBOVkRBIHJvbGUgc2hvdWxkIGJlIHNldCB0byBsaXN0IGVsZW1lbnRcbiAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gnKSA+IC0xKSB7XG4gICAgICAgIGxpc3RFbGVtZW50LnNldEF0dHJpYnV0ZSgncm9sZScsICdhbGVydCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9tRWxlbT8uZmlyc3RFbGVtZW50Q2hpbGQ/LnNldEF0dHJpYnV0ZSgncm9sZScsICdhbGVydCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDcuIEFwcGVuZCBuZXcgZWxlbWVudCB0byBsaXN0IG9mIGVsZW1lbnRzIGFuZCBwdXNoIG9sZCBvbmVzIGRvd24uXG4gICAgaWYgKGxpc3RFbGVtZW50KSB7XG4gICAgICBsaXN0RWxlbWVudC5pbnNlcnRCZWZvcmUoZG9tRWxlbSwgbGlzdEVsZW1lbnQuZmlyc3RDaGlsZCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbXBvbmVudEluc3RhbmNlOiBjb21wb25lbnRSZWYuaW5zdGFuY2UsXG4gICAgICB1bm1vdW50Q29tcG9uZW50OiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZGVzdHJveUVsZW1lbnQoY29tcG9uZW50UmVmKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVMaXN0RWxlbWVudChyb290OiBOb2RlKTogRWxlbWVudCB7XG4gICAgbGV0IGxpc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYmItbm90aWZpY2F0aW9uLWxpc3QnKVswXTtcbiAgICBpZiAoIWxpc3RFbGVtZW50KSB7XG4gICAgICBsaXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgbGlzdEVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdiYi1ub3RpZmljYXRpb24tbGlzdCcpO1xuICAgICAgcm9vdC5hcHBlbmRDaGlsZChsaXN0RWxlbWVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpc3RFbGVtZW50O1xuICB9XG5cbiAgLypcbiAgICBUaGlzIG1ldGhvZCBpcyBhIGhhY2sgdG8gbWFrZSBub3RpZmljYXRpb25zIHZpc2libGUgdG8gc2NyZWVuIHJlYWRlcnNcbiAgICAoTlZEQSBhbmQgVm9pY2VPdmVyKSB3aGVuIGEgbW9kYWwgd2luZG93IChyb2xlPVwiZGlhbG9nXCIpIGlzIG9wZW5lZC5cbiAgICBhcmlhLWxhYmVsPVwicG9saXRlXCIgb24gdGhlIGxpc3QgZWxlbWVudCBhbmQgcm9sZT1cInN0YXR1c1wiIHdpdGhcbiAgICBhcmlhLWF0b21pYz1cInRydWVcIiBvbiBub3RpZmljYXRpb24gZWxlbWVudCBkb24ndCByZXNvbHZlIHRoZSBpc3N1ZS5cbiAgICBBbnkgYmV0dGVyIGlkZWFzIGFyZSB3ZWxjb21lLlxuICAgKi9cbiAgcHJpdmF0ZSBjaGVja0FuZERlc3Ryb3lMaXN0RWxlbWVudCgpIHtcbiAgICBjb25zdCBsaXN0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2JiLW5vdGlmaWNhdGlvbi1saXN0JylbMF07XG4gICAgLy8gZG9uJ3QgcmVtb3ZlIGxpc3QgZWxlbWVudCBpZiB0aGVyZSBhcmUgYW55IHJlbWFpbmluZyBub3RpZmljYXRpb25zXG4gICAgaWYgKCFsaXN0RWxlbWVudCB8fCBsaXN0RWxlbWVudC5jaGlsZEVsZW1lbnRDb3VudCA+IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGlzdEVsZW1lbnQucmVtb3ZlKCk7XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lFbGVtZW50KGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPGFueT4pIHtcbiAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UuYmVmb3JlRGVzdHJveSgpO1xuICAgIHRoaXMuYXBwUmVmLmRldGFjaFZpZXcoY29tcG9uZW50UmVmLmhvc3RWaWV3KTtcbiAgICBjb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgIC8vIGlzIHJlcXVpcmVkIHRvIG1ha2Ugbm90aWZpY2F0aW9ucyB2aXNpYmxlIHRvIHNjcmVlbiByZWFkZXJzIHdoZW4gYW55IG1vZGFsIHdpbmRvdyBpcyBvcGVuZWRcbiAgICB0aGlzLmNoZWNrQW5kRGVzdHJveUxpc3RFbGVtZW50KCk7XG4gIH1cbn1cbiJdfQ==