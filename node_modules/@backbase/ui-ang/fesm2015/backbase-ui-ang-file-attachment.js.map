{"version":3,"file":"backbase-ui-ang-file-attachment.js","sources":["../../../../libs/ui-ang/file-attachment/file-attachment.component.ts","../../../../libs/ui-ang/file-attachment/file-attachment.component.html","../../../../libs/ui-ang/file-attachment/file-attachment.module.ts","../../../../libs/ui-ang/file-attachment/backbase-ui-ang-file-attachment.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Inject,\n  Input,\n  OnInit,\n  Output,\n  Renderer2,\n} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { isObservable, Observable } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nexport interface FileSize {\n  value: number;\n  unit: string;\n}\n\n/**\n * @name FileAttachmentComponent\n *\n * @description\n * Component displays file attachment.\n *\n * @dynamic (to suppress error with resolving statics declarations during compilation)\n */\n\n@Component({\n  selector: 'bb-file-attachment-ui',\n  templateUrl: './file-attachment.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class FileAttachmentComponent implements OnInit {\n  /**\n   * Set name (required).\n   */\n  @Input()\n  set name(value: string | undefined) {\n    if (value?.trim()) {\n      this._name = value;\n      this.fileType = this.getFileType(value);\n    } else {\n      throw new Error(`\"name\" input is invalid in \"${this.constructor.name}\"`);\n    }\n  }\n\n  /**\n   * Get name.\n   */\n  get name() {\n    return this._name;\n  }\n\n  /**\n   * Set file size (required).\n   */\n  @Input()\n  set size(value: number | string | undefined) {\n    if (value !== undefined) {\n      const valueAsNumber = Math.trunc(Number(value));\n\n      this._sizeInUnits = this.formatBytes(valueAsNumber, 2);\n    }\n  }\n\n  /**\n   * Get file size in information units (Bytes, Kbs, etc.).\n   */\n  get sizeInUnits() {\n    return this._sizeInUnits;\n  }\n\n  /**\n   * Set file content (required if disabled property is not set to true).\n   */\n  @Input()\n  set fileContent(value: Observable<ArrayBuffer> | undefined) {\n    if (value && isObservable(value)) {\n      this._fileContent = value;\n    } else {\n      throw new Error(`\"fileContent\" stream input is invalid in \"${this.constructor.name}\"`);\n    }\n  }\n\n  /**\n   * Get file content.\n   */\n  get fileContent() {\n    return this._fileContent;\n  }\n\n  /**\n   * Loading indicator flag. Defaults to false.\n   */\n  @Input() loading = false;\n\n  /**\n   * Show delete button flag. Defaults to false.\n   */\n  @Input() deletable = false;\n\n  /**\n   * Disabled state flag. Defaults to false.\n   */\n  @Input() disabled = false;\n\n  /**\n   * The flag to indicate whether the file-attachment should fill the container that it is in. Defaults to 'false'.\n   */\n  @Input() block = false;\n\n  /**\n   * Event emitted on delete button click.\n   */\n  @Output() delete = new EventEmitter<void>();\n\n  /**\n   * File type which is determined by file extension. Defaults to 'unknown'.\n   */\n  fileType = 'unknown';\n\n  private _sizeInUnits: FileSize | undefined;\n  private _name: string | undefined;\n  private _fileContent: Observable<ArrayBuffer> | undefined;\n\n  constructor(@Inject(DOCUMENT) private readonly document: Document, private readonly renderer: Renderer2) {}\n\n  ngOnInit() {\n    if (!this._name) {\n      throw new Error(`\"name\" input is required in \"${this.constructor.name}\"`);\n    }\n\n    if (!this.disabled && !this._fileContent) {\n      throw new Error(`\"fileContent\" input is required in \"${this.constructor.name}\"`);\n    }\n  }\n\n  /**\n   * Download attachment method.\n   *\n   * @param $event Download button click event\n   */\n  onDownload($event: Event) {\n    $event.stopPropagation();\n\n    if (this.fileContent) {\n      this.fileContent.pipe(take(1)).subscribe((response: ArrayBuffer) => {\n        if (!this.document.defaultView) {\n          return;\n        }\n        const window = this.document.defaultView;\n        const blob = new window.Blob([response]);\n\n        if (window.navigator.msSaveBlob) {\n          window.navigator.msSaveBlob(blob, this.name);\n        } else {\n          const fileURL = window.URL.createObjectURL(blob);\n          const link = this.renderer.createElement('a');\n\n          link.setAttribute('href', fileURL);\n          link.setAttribute('target', '_blank');\n          link.setAttribute('download', this.name || '');\n          link.click();\n          URL.revokeObjectURL(fileURL);\n        }\n      });\n    }\n  }\n\n  /**\n   * Delete attachment event emitter.\n   *\n   * @param event Delete button click event.\n   */\n  onDelete(event: MouseEvent) {\n    event.stopPropagation();\n    this.delete.emit();\n  }\n\n  private getFileType(fileName: string): string {\n    return fileName.includes('.') ? fileName.toLowerCase().split('.').pop() || 'unknown' : 'unknown';\n  }\n\n  private formatBytes(bytes: number, decimals: number): FileSize {\n    if (bytes === 0) {\n      return {\n        value: 0,\n        unit: 'Bytes',\n      };\n    }\n\n    const k = 1024;\n    const dm = decimals <= 0 ? 0 : decimals || 2;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n    return {\n      value: parseFloat((bytes / Math.pow(k, i)).toFixed(dm)),\n      unit: sizes[i],\n    };\n  }\n}\n","<div\n  class=\"bb-attachment-ui bb-card bb-card--sm\"\n  [class.bb-attachment-ui--block]=\"block\"\n  [attr.role]=\"disabled || deletable ? null : 'button'\"\n  [tabindex]=\"disabled ? -1 : 0\"\n  data-role=\"download-attachment\"\n  aria-describedby=\"file-attachment-card-body\"\n  (bbKeyboardClick)=\"!disabled && onDownload($event)\"\n>\n  <div class=\"bb-stack bb-stack--align-top bb-card__body\" id=\"file-attachment-card-body\">\n    <div class=\"bb-stack__item\">\n      <em\n        data-role=\"file-type-icon\"\n        [attr.aria-label]=\"fileType\"\n        [ngClass]=\"'bb-icon-file-' + fileType\"\n        class=\"bb-icon bb-icon--md bb-message-attachment__content\"\n        [class.bb-message-attachment__content--disabled]=\"loading\"\n      ></em>\n    </div>\n    <div class=\"bb-stack__item text-truncate\" [class.bb-message-attachment__content--disabled]=\"loading\">\n      <span class=\"bb-block bb-block--xs\" data-role=\"attachment-name\">{{ name }}</span>\n      <div *ngIf=\"sizeInUnits\">\n        <span class=\"bb-text-support\" data-role=\"attachment-size\"\n          >{{ sizeInUnits.value }}\n          <span i18n=\"File size|Attachment file size in units@@fileAttachment.fileSize\"\n            >{ sizeInUnits.unit, select, Bytes {Bytes} KB {KB} MB {MB} GB {GB} TB {TB} }</span\n          ></span\n        >\n      </div>\n    </div>\n    <div *ngIf=\"loading || deletable\" class=\"bb-stack__item bb-stack__item--push-right\">\n      <button\n        bbButton\n        color=\"link-text\"\n        *ngIf=\"deletable && !loading\"\n        class=\"bb-text-support\"\n        aria-label=\"Delete file\"\n        i18n-aria-label=\"Delete file button@@fileAttachment.deleteButton.ariaLabel\"\n        data-role=\"file-attachment-delete-button\"\n        (click)=\"onDelete($event)\"\n      >\n        <bb-icon-ui name=\"times\"></bb-icon-ui>\n      </button>\n\n      <bb-loading-indicator-ui\n        *ngIf=\"loading\"\n        class=\"bb-message-attachment__loader\"\n        loaderSize=\"sm\"\n        aria-label=\"Loading\"\n        i18n-aria-label=\"Loading|File attachment loading indicator@@fileAttachment.loadingIndicator.ariaLabel\"\n      >\n      </bb-loading-indicator-ui>\n    </div>\n  </div>\n</div>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FileAttachmentComponent } from './file-attachment.component';\nimport { ButtonModule } from '@backbase/ui-ang/button';\nimport { KeyboardClickModule } from '@backbase/ui-ang/keyboard-click-directive';\nimport { LoadingIndicatorModule } from '@backbase/ui-ang/loading-indicator';\nimport { IconModule } from '@backbase/ui-ang/icon';\n\nconst uiModules = [ButtonModule, IconModule, KeyboardClickModule, LoadingIndicatorModule];\n\n@NgModule({\n  imports: [CommonModule, ...uiModules],\n  declarations: [FileAttachmentComponent],\n  exports: [FileAttachmentComponent],\n})\nexport class FileAttachmentModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}