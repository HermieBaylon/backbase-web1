import { Inject, Injectable, Optional } from '@angular/core';
import { HttpHeaders, HttpParams } from '@angular/common/http';
import { CustomHttpParameterCodec } from '../encoder';
import { USER_BASE_PATH } from '../variables';
import { UserConfiguration } from '../configuration';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../configuration";
export class IdentityManagementService {
    constructor(httpClient, basePath, configuration) {
        this.httpClient = httpClient;
        this.basePath = '';
        this.defaultHeaders = new HttpHeaders();
        this.configuration = new UserConfiguration();
        if (configuration) {
            this.configuration = configuration;
        }
        if (typeof this.configuration.basePath !== 'string') {
            if (typeof basePath !== 'string') {
                basePath = this.basePath;
            }
            this.configuration.basePath = basePath;
        }
        this.encoder = this.configuration.encoder || new CustomHttpParameterCodec();
    }
    addToHttpParams(httpParams, value, key) {
        if (typeof value === "object" && value instanceof Date === false) {
            httpParams = this.addToHttpParamsRecursive(httpParams, value);
        }
        else {
            httpParams = this.addToHttpParamsRecursive(httpParams, value, key);
        }
        return httpParams;
    }
    addToHttpParamsRecursive(httpParams, value, key) {
        if (value == null) {
            return httpParams;
        }
        if (typeof value === "object") {
            if (Array.isArray(value)) {
                value.forEach(elem => httpParams = this.addToHttpParamsRecursive(httpParams, elem, key));
            }
            else if (value instanceof Date) {
                if (key != null) {
                    httpParams = httpParams.append(key, value.toISOString().substr(0, 10));
                }
                else {
                    throw Error("key may not be null if value is Date");
                }
            }
            else {
                Object.keys(value).forEach(k => httpParams = this.addToHttpParamsRecursive(httpParams, value[k], key != null ? `${key}.${k}` : k));
            }
        }
        else if (key != null) {
            httpParams = httpParams.append(key, value);
        }
        else {
            throw Error("key may not be null if value is not object or array");
        }
        return httpParams;
    }
    changePassword(requestParameters, observe = 'body', reportProgress = false, options) {
        const _changePasswordRequest = requestParameters["changePasswordRequest"];
        if (_changePasswordRequest === null || _changePasswordRequest === undefined) {
            throw new Error('Required parameter changePasswordRequest was null or undefined when calling changePassword.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.post(`${this.configuration.basePath}/client-api/v2/users/identities/password`, _changePasswordRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    changePasswordUrl(requestParameters) {
        const _changePasswordRequest = requestParameters["changePasswordRequest"];
        if (_changePasswordRequest === null || _changePasswordRequest === undefined) {
            throw new Error('Required parameter changePasswordRequest was null or undefined when calling changePassword.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/password`;
    }
    createIdentity(requestParameters, observe = 'body', reportProgress = false, options) {
        const _createIdentityRequest = requestParameters["createIdentityRequest"];
        if (_createIdentityRequest === null || _createIdentityRequest === undefined) {
            throw new Error('Required parameter createIdentityRequest was null or undefined when calling createIdentity.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.post(`${this.configuration.basePath}/client-api/v2/users/identities`, _createIdentityRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    createIdentityUrl(requestParameters) {
        const _createIdentityRequest = requestParameters["createIdentityRequest"];
        if (_createIdentityRequest === null || _createIdentityRequest === undefined) {
            throw new Error('Required parameter createIdentityRequest was null or undefined when calling createIdentity.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities`;
    }
    getIdentities(requestParameters, observe = 'body', reportProgress = false, options) {
        const _externalId = requestParameters["externalId"];
        const _from = requestParameters["from"];
        const _cursor = requestParameters["cursor"];
        const _size = requestParameters["size"];
        const _legalEntityName = requestParameters["legalEntityName"];
        let queryParameters = new HttpParams({ encoder: this.encoder });
        if (_externalId !== undefined && _externalId !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _externalId, 'externalId');
        }
        if (_from !== undefined && _from !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _from, 'from');
        }
        if (_cursor !== undefined && _cursor !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _cursor, 'cursor');
        }
        if (_size !== undefined && _size !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _size, 'size');
        }
        if (_legalEntityName !== undefined && _legalEntityName !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _legalEntityName, 'legalEntityName');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.get(`${this.configuration.basePath}/client-api/v2/users/identities`, {
            params: queryParameters,
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    getIdentitiesUrl(requestParameters) {
        const _externalId = requestParameters["externalId"];
        const _from = requestParameters["from"];
        const _cursor = requestParameters["cursor"];
        const _size = requestParameters["size"];
        const _legalEntityName = requestParameters["legalEntityName"];
        let queryParameters = new HttpParams({ encoder: this.encoder });
        if (_externalId !== undefined && _externalId !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _externalId, 'externalId');
        }
        if (_from !== undefined && _from !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _from, 'from');
        }
        if (_cursor !== undefined && _cursor !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _cursor, 'cursor');
        }
        if (_size !== undefined && _size !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _size, 'size');
        }
        if (_legalEntityName !== undefined && _legalEntityName !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _legalEntityName, 'legalEntityName');
        }
        const queryString = queryParameters.toString();
        return `${this.configuration.basePath}/client-api/v2/users/identities${queryString ? `?${queryString}` : ''}`;
    }
    getIdentity(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getIdentity.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.get(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}`, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    getIdentityUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getIdentity.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}`;
    }
    getIdentityPendingApprovals(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getIdentityPendingApprovals.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.get(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/approvals`, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    getIdentityPendingApprovalsUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getIdentityPendingApprovals.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/approvals`;
    }
    getSessions(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getSessions.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.get(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/sessions`, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    getSessionsUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling getSessions.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/sessions`;
    }
    logoutSessions(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling logoutSessions.');
        }
        const _identityLogoutRequest = requestParameters["identityLogoutRequest"];
        if (_identityLogoutRequest === null || _identityLogoutRequest === undefined) {
            throw new Error('Required parameter identityLogoutRequest was null or undefined when calling logoutSessions.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.post(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/sessions/logout`, _identityLogoutRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    logoutSessionsUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling logoutSessions.');
        }
        const _identityLogoutRequest = requestParameters["identityLogoutRequest"];
        if (_identityLogoutRequest === null || _identityLogoutRequest === undefined) {
            throw new Error('Required parameter identityLogoutRequest was null or undefined when calling logoutSessions.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/sessions/logout`;
    }
    revokeIdentityAccess(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling revokeIdentityAccess.');
        }
        const _revokeIdentityAccessRequest = requestParameters["revokeIdentityAccessRequest"];
        if (_revokeIdentityAccessRequest === null || _revokeIdentityAccessRequest === undefined) {
            throw new Error('Required parameter revokeIdentityAccessRequest was null or undefined when calling revokeIdentityAccess.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.put(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/access`, _revokeIdentityAccessRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    revokeIdentityAccessUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling revokeIdentityAccess.');
        }
        const _revokeIdentityAccessRequest = requestParameters["revokeIdentityAccessRequest"];
        if (_revokeIdentityAccessRequest === null || _revokeIdentityAccessRequest === undefined) {
            throw new Error('Required parameter revokeIdentityAccessRequest was null or undefined when calling revokeIdentityAccess.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/access`;
    }
    sendRequiredActions(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling sendRequiredActions.');
        }
        const _identityRequiredActionsRequest = requestParameters["identityRequiredActionsRequest"];
        if (_identityRequiredActionsRequest === null || _identityRequiredActionsRequest === undefined) {
            throw new Error('Required parameter identityRequiredActionsRequest was null or undefined when calling sendRequiredActions.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.put(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/actions`, _identityRequiredActionsRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    sendRequiredActionsUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling sendRequiredActions.');
        }
        const _identityRequiredActionsRequest = requestParameters["identityRequiredActionsRequest"];
        if (_identityRequiredActionsRequest === null || _identityRequiredActionsRequest === undefined) {
            throw new Error('Required parameter identityRequiredActionsRequest was null or undefined when calling sendRequiredActions.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/actions`;
    }
    updateIdentity(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling updateIdentity.');
        }
        const _updateIdentityRequest = requestParameters["updateIdentityRequest"];
        if (_updateIdentityRequest === null || _updateIdentityRequest === undefined) {
            throw new Error('Required parameter updateIdentityRequest was null or undefined when calling updateIdentity.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.put(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}`, _updateIdentityRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    updateIdentityUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling updateIdentity.');
        }
        const _updateIdentityRequest = requestParameters["updateIdentityRequest"];
        if (_updateIdentityRequest === null || _updateIdentityRequest === undefined) {
            throw new Error('Required parameter updateIdentityRequest was null or undefined when calling updateIdentity.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}`;
    }
    updateIdentityStatus(requestParameters, observe = 'body', reportProgress = false, options) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling updateIdentityStatus.');
        }
        const _updateIdentityStatusRequest = requestParameters["updateIdentityStatusRequest"];
        if (_updateIdentityStatusRequest === null || _updateIdentityStatusRequest === undefined) {
            throw new Error('Required parameter updateIdentityStatusRequest was null or undefined when calling updateIdentityStatus.');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        const consumes = [
            'application/json'
        ];
        const httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
        if (httpContentTypeSelected !== undefined) {
            headers = headers.set('Content-Type', httpContentTypeSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.put(`${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/status`, _updateIdentityStatusRequest, {
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    updateIdentityStatusUrl(requestParameters) {
        const _internalId = requestParameters["internalId"];
        if (_internalId === null || _internalId === undefined) {
            throw new Error('Required parameter internalId was null or undefined when calling updateIdentityStatus.');
        }
        const _updateIdentityStatusRequest = requestParameters["updateIdentityStatusRequest"];
        if (_updateIdentityStatusRequest === null || _updateIdentityStatusRequest === undefined) {
            throw new Error('Required parameter updateIdentityStatusRequest was null or undefined when calling updateIdentityStatus.');
        }
        return `${this.configuration.basePath}/client-api/v2/users/identities/${encodeURIComponent(String(_internalId))}/status`;
    }
}
IdentityManagementService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: IdentityManagementService, deps: [{ token: i1.HttpClient }, { token: USER_BASE_PATH, optional: true }, { token: i2.UserConfiguration, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
IdentityManagementService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: IdentityManagementService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: IdentityManagementService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [USER_BASE_PATH]
                }] }, { type: i2.UserConfiguration, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpdHlNYW5hZ2VtZW50LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9hcGkvaWRlbnRpdHlNYW5hZ2VtZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBY0EsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQTJCLGVBQWUsQ0FBQztBQUNsRixPQUFPLEVBQWMsV0FBVyxFQUFFLFVBQVUsRUFDVSxNQUFZLHNCQUFzQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUErQixZQUFZLENBQUM7QUFxQi9FLE9BQU8sRUFBRSxjQUFjLEVBQXNCLE1BQTBCLGNBQWMsQ0FBQztBQUN0RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBMEMsa0JBQWtCLENBQUM7Ozs7QUF5RXpGLE1BQU0sT0FBTyx5QkFBeUI7SUFPbEMsWUFBc0IsVUFBc0IsRUFBc0MsUUFBZ0IsRUFBYyxhQUFnQztRQUExSCxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBTGxDLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDakIsbUJBQWMsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ25DLGtCQUFhLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1FBSTNDLElBQUksYUFBYSxFQUFFO1lBQ2YsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7U0FDdEM7UUFDRCxJQUFJLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEtBQUssUUFBUSxFQUFFO1lBQ2pELElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxFQUFFO2dCQUM5QixRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQzthQUM1QjtZQUNELElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztTQUMxQztRQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLElBQUksSUFBSSx3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c291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVc2VyIE1hbmFnZXIgY2xpZW50XG4gKiBDcmVhdGUsIHJldHJpZXZlLCBhbmQgbWFuYWdlIHVzZXJzIGFuZCB0aGVpciByZWxhdGlvbnNoaXBzIHdpdGggaW50ZXJuYWwgKERCUyBzZXJ2aWNlcykgYW5kIGV4dGVybmFsIChDUk0gc3lzdGVtcykgcmVzb3VyY2VzLiBcbiAqXG4gKiBUaGUgdmVyc2lvbiBvZiB0aGUgT3BlbkFQSSBkb2N1bWVudDogMi40LjBcbiAqIFxuICpcbiAqIE5PVEU6IFRoaXMgY2xhc3MgaXMgYXV0byBnZW5lcmF0ZWQgYnkgT3BlbkFQSSBHZW5lcmF0b3IgKGh0dHBzOi8vZ2l0aHViLmNvbS9CYWNrYmFzZS9iYWNrYmFzZS1vcGVuYXBpLXRvb2xzKS5cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9CYWNrYmFzZS9iYWNrYmFzZS1vcGVuYXBpLXRvb2xzXG4gKiBEbyBub3QgZWRpdCB0aGUgY2xhc3MgbWFudWFsbHkuXG4gKi9cblxuLyogdHNsaW50OmRpc2FibGU6bm8tdW51c2VkLXZhcmlhYmxlIG1lbWJlci1vcmRlcmluZyAqL1xuXG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsIH0gICAgICAgICAgICAgICAgICAgICAgZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycywgSHR0cFBhcmFtcyxcbiAgICAgICAgIEh0dHBSZXNwb25zZSwgSHR0cEV2ZW50LCBIdHRwUGFyYW1ldGVyQ29kZWMgfSAgICAgICBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBDdXN0b21IdHRwUGFyYW1ldGVyQ29kZWMgfSAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnLi4vZW5jb2Rlcic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEJhZFJlcXVlc3RFcnJvciB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBDaGFuZ2VQYXNzd29yZFJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgQ29uZmxpY3QgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgQ3JlYXRlSWRlbnRpdHlSZXF1ZXN0IH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IENyZWF0ZUlkZW50aXR5UmVzcG9uc2UgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgRm9yYmlkZGVuRXJyb3IgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgR2V0SWRlbnRpdGllcyB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBHZXRJZGVudGl0eSB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBHZXRJZGVudGl0eVNlc3Npb25zIH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IEdldFBlbmRpbmdBcHByb3ZhbCB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBJZGVudGl0eUxvZ291dFJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgSWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0IH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IElkZW50aXR5U3RhdHVzQXBwcm92YWxQZW5kaW5nIH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IE5vdEZvdW5kRXJyb3IgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgUmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0IH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IFVwZGF0ZUlkZW50aXR5UmVxdWVzdCB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBVcGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3QgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuXG5pbXBvcnQgeyBVU0VSX0JBU0VfUEFUSCwgQ09MTEVDVElPTl9GT1JNQVRTIH0gICAgICAgICAgICAgICAgICAgICBmcm9tICcuLi92YXJpYWJsZXMnO1xuaW1wb3J0IHsgVXNlckNvbmZpZ3VyYXRpb24gfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tICcuLi9jb25maWd1cmF0aW9uJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIENoYW5nZVBhc3N3b3JkUmVxdWVzdFBhcmFtcyB7XG4gICAgW1wiY2hhbmdlUGFzc3dvcmRSZXF1ZXN0XCJdOiBDaGFuZ2VQYXNzd29yZFJlcXVlc3Q7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zIHtcbiAgICBbXCJjcmVhdGVJZGVudGl0eVJlcXVlc3RcIl06IENyZWF0ZUlkZW50aXR5UmVxdWVzdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHZXRJZGVudGl0aWVzUmVxdWVzdFBhcmFtcyB7XG4gICAgLyoqIEV4dGVybmFsIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSByZXNvdXJjZS4gKi9cbiAgICBbXCJleHRlcm5hbElkXCJdPzogc3RyaW5nO1xuICAgIC8qKiBQYWdlIE51bWJlci4gU2tpcCBvdmVyIHBhZ2VzIG9mIGVsZW1lbnRzIGJ5IHNwZWNpZnlpbmcgYSBzdGFydCB2YWx1ZSBmb3IgdGhlIHF1ZXJ5ICovXG4gICAgW1wiZnJvbVwiXT86IG51bWJlcjtcbiAgICAvKiogUmVjb3JkIFVVSUQuIEFzIGFuIGFsdGVybmF0aXZlIGZvciBzcGVjaWZ5aW5nIFxcJiMzOTtmcm9tXFwmIzM5OyB0aGlzIGFsbG93cyB0byBwb2ludCB0byB0aGUgcmVjb3JkIHRvIHN0YXJ0IHRoZSBzZWxlY3Rpb24gZnJvbS4gICovXG4gICAgW1wiY3Vyc29yXCJdPzogc3RyaW5nO1xuICAgIC8qKiBMaW1pdCB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIG9uIHRoZSByZXNwb25zZS4gV2hlbiB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggY3Vyc29yLCB0aGUgdmFsdWUgaXMgYWxsb3dlZCB0byBiZSBhIG5lZ2F0aXZlIG51bWJlciB0byBpbmRpY2F0ZSByZXF1ZXN0aW5nIHJlY29yZHMgdXB3YXJkcyBmcm9tIHRoZSBzdGFydGluZyBwb2ludCBpbmRpY2F0ZWQgYnkgdGhlIGN1cnNvci4gICovXG4gICAgW1wic2l6ZVwiXT86IG51bWJlcjtcbiAgICAvKiogRmlsdGVyIHRoZSByZXN1bHRzIGJ5IHRoZSBpZGVudGl0eSBsZWdhbCBlbnRpdHlcXCYjMzk7cyBuYW1lLiAgKi9cbiAgICBbXCJsZWdhbEVudGl0eU5hbWVcIl0/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2V0SWRlbnRpdHlSZXF1ZXN0UGFyYW1zIHtcbiAgICAvKiogVXNlciBpbnRlcm5hbCBJRCAqL1xuICAgIFtcImludGVybmFsSWRcIl06IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHNSZXF1ZXN0UGFyYW1zIHtcbiAgICAvKiogVXNlciBpbnRlcm5hbCBJRCAqL1xuICAgIFtcImludGVybmFsSWRcIl06IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHZXRTZXNzaW9uc1JlcXVlc3RQYXJhbXMge1xuICAgIC8qKiBVc2VyIGludGVybmFsIElEICovXG4gICAgW1wiaW50ZXJuYWxJZFwiXTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvZ291dFNlc3Npb25zUmVxdWVzdFBhcmFtcyB7XG4gICAgLyoqIFVzZXIgaW50ZXJuYWwgSUQgKi9cbiAgICBbXCJpbnRlcm5hbElkXCJdOiBzdHJpbmc7XG4gICAgW1wiaWRlbnRpdHlMb2dvdXRSZXF1ZXN0XCJdOiBJZGVudGl0eUxvZ291dFJlcXVlc3Q7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0UGFyYW1zIHtcbiAgICAvKiogVXNlciBpbnRlcm5hbCBJRCAqL1xuICAgIFtcImludGVybmFsSWRcIl06IHN0cmluZztcbiAgICBbXCJyZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3RcIl06IFJldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZW5kUmVxdWlyZWRBY3Rpb25zUmVxdWVzdFBhcmFtcyB7XG4gICAgLyoqIFVzZXIgaW50ZXJuYWwgSUQgKi9cbiAgICBbXCJpbnRlcm5hbElkXCJdOiBzdHJpbmc7XG4gICAgW1wiaWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0XCJdOiBJZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3Q7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zIHtcbiAgICAvKiogVXNlciBpbnRlcm5hbCBJRCAqL1xuICAgIFtcImludGVybmFsSWRcIl06IHN0cmluZztcbiAgICBbXCJ1cGRhdGVJZGVudGl0eVJlcXVlc3RcIl06IFVwZGF0ZUlkZW50aXR5UmVxdWVzdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3RQYXJhbXMge1xuICAgIC8qKiBVc2VyIGludGVybmFsIElEICovXG4gICAgW1wiaW50ZXJuYWxJZFwiXTogc3RyaW5nO1xuICAgIFtcInVwZGF0ZUlkZW50aXR5U3RhdHVzUmVxdWVzdFwiXTogVXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0O1xufVxuXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIElkZW50aXR5TWFuYWdlbWVudFNlcnZpY2Uge1xuXG4gICAgcHJvdGVjdGVkIGJhc2VQYXRoID0gJyc7XG4gICAgcHVibGljIGRlZmF1bHRIZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgcHVibGljIGNvbmZpZ3VyYXRpb24gPSBuZXcgVXNlckNvbmZpZ3VyYXRpb24oKTtcbiAgICBwdWJsaWMgZW5jb2RlcjogSHR0cFBhcmFtZXRlckNvZGVjO1xuXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsIEBPcHRpb25hbCgpIEBJbmplY3QoVVNFUl9CQVNFX1BBVEgpIGJhc2VQYXRoOiBzdHJpbmcsIEBPcHRpb25hbCgpIGNvbmZpZ3VyYXRpb246IFVzZXJDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRoICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlUGF0aCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBiYXNlUGF0aCA9IHRoaXMuYmFzZVBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGggPSBiYXNlUGF0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVuY29kZXIgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZW5jb2RlciB8fCBuZXcgQ3VzdG9tSHR0cFBhcmFtZXRlckNvZGVjKCk7XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIGFkZFRvSHR0cFBhcmFtcyhodHRwUGFyYW1zOiBIdHRwUGFyYW1zLCB2YWx1ZTogYW55LCBrZXk/OiBzdHJpbmcpOiBIdHRwUGFyYW1zIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBodHRwUGFyYW1zID0gdGhpcy5hZGRUb0h0dHBQYXJhbXNSZWN1cnNpdmUoaHR0cFBhcmFtcywgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHR0cFBhcmFtcyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKGh0dHBQYXJhbXMsIHZhbHVlLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBodHRwUGFyYW1zO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKGh0dHBQYXJhbXM6IEh0dHBQYXJhbXMsIHZhbHVlPzogYW55LCBrZXk/OiBzdHJpbmcpOiBIdHRwUGFyYW1zIHtcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBodHRwUGFyYW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgKHZhbHVlIGFzIGFueVtdKS5mb3JFYWNoKCBlbGVtID0+IGh0dHBQYXJhbXMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtc1JlY3Vyc2l2ZShodHRwUGFyYW1zLCBlbGVtLCBrZXkpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0dHBQYXJhbXMgPSBodHRwUGFyYW1zLmFwcGVuZChrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAodmFsdWUgYXMgRGF0ZSkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwia2V5IG1heSBub3QgYmUgbnVsbCBpZiB2YWx1ZSBpcyBEYXRlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goIGsgPT4gaHR0cFBhcmFtcyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKFxuICAgICAgICAgICAgICAgICAgICBodHRwUGFyYW1zLCB2YWx1ZVtrXSwga2V5ICE9IG51bGwgPyBgJHtrZXl9LiR7a31gIDogaykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGtleSAhPSBudWxsKSB7XG4gICAgICAgICAgICBodHRwUGFyYW1zID0gaHR0cFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcImtleSBtYXkgbm90IGJlIG51bGwgaWYgdmFsdWUgaXMgbm90IG9iamVjdCBvciBhcnJheVwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaHR0cFBhcmFtcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgUGFzc3dvcmRcbiAgICAgKiBDaGFuZ2UgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxcJiMzOTtzIHBhc3N3b3JkLCBwcm92aWRlZCB0aGUgZ2l2ZW4gcGFzc3dvcmQgaXMgY29ycmVjdCBhbmQgbmV3IHBhc3N3b3JkIHNhdGlzZmllcyB0aGUgcGFzc3dvcmQgcG9saWN5LiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgY2hhbmdlUGFzc3dvcmQocmVxdWVzdFBhcmFtZXRlcnM6IENoYW5nZVBhc3N3b3JkUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+O1xuICAgIC8qKlxuICAgICAqIENoYW5nZSBQYXNzd29yZFxuICAgICAqIENoYW5nZSB0aGUgYXV0aGVudGljYXRlZCB1c2VyXFwmIzM5O3MgcGFzc3dvcmQsIHByb3ZpZGVkIHRoZSBnaXZlbiBwYXNzd29yZCBpcyBjb3JyZWN0IGFuZCBuZXcgcGFzc3dvcmQgc2F0aXNmaWVzIHRoZSBwYXNzd29yZCBwb2xpY3kuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBjaGFuZ2VQYXNzd29yZChyZXF1ZXN0UGFyYW1ldGVyczogQ2hhbmdlUGFzc3dvcmRSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8YW55Pj47XG4gICAgLyoqXG4gICAgICogQ2hhbmdlIFBhc3N3b3JkXG4gICAgICogQ2hhbmdlIHRoZSBhdXRoZW50aWNhdGVkIHVzZXJcXCYjMzk7cyBwYXNzd29yZCwgcHJvdmlkZWQgdGhlIGdpdmVuIHBhc3N3b3JkIGlzIGNvcnJlY3QgYW5kIG5ldyBwYXNzd29yZCBzYXRpc2ZpZXMgdGhlIHBhc3N3b3JkIHBvbGljeS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGNoYW5nZVBhc3N3b3JkKHJlcXVlc3RQYXJhbWV0ZXJzOiBDaGFuZ2VQYXNzd29yZFJlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8YW55Pj47XG4gICAgLyoqXG4gICAgICogQ2hhbmdlIFBhc3N3b3JkXG4gICAgICogQ2hhbmdlIHRoZSBhdXRoZW50aWNhdGVkIHVzZXJcXCYjMzk7cyBwYXNzd29yZCwgcHJvdmlkZWQgdGhlIGdpdmVuIHBhc3N3b3JkIGlzIGNvcnJlY3QgYW5kIG5ldyBwYXNzd29yZCBzYXRpc2ZpZXMgdGhlIHBhc3N3b3JkIHBvbGljeS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGNoYW5nZVBhc3N3b3JkKHJlcXVlc3RQYXJhbWV0ZXJzOiBDaGFuZ2VQYXNzd29yZFJlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9jaGFuZ2VQYXNzd29yZFJlcXVlc3QgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImNoYW5nZVBhc3N3b3JkUmVxdWVzdFwiXTtcbiAgICAgICAgaWYgKF9jaGFuZ2VQYXNzd29yZFJlcXVlc3QgPT09IG51bGwgfHwgX2NoYW5nZVBhc3N3b3JkUmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBjaGFuZ2VQYXNzd29yZFJlcXVlc3Qgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBjaGFuZ2VQYXNzd29yZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBvcHRpb25zICYmIG9wdGlvbnMuaHR0cEhlYWRlckFjY2VwdDtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlVHlwZTogJ3RleHQnIHwgJ2pzb24nID0gJ2pzb24nO1xuICAgICAgICBpZihodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgJiYgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkLnN0YXJ0c1dpdGgoJ3RleHQnKSkge1xuICAgICAgICAgICAgcmVzcG9uc2VUeXBlID0gJ3RleHQnO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0PGFueT4oYCR7dGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRofS9jbGllbnQtYXBpL3YyL3VzZXJzL2lkZW50aXRpZXMvcGFzc3dvcmRgLFxuICAgICAgICAgICAgX2NoYW5nZVBhc3N3b3JkUmVxdWVzdCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6IDxhbnk+cmVzcG9uc2VUeXBlLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGNoYW5nZVBhc3N3b3JkVXJsKHJlcXVlc3RQYXJhbWV0ZXJzOiBDaGFuZ2VQYXNzd29yZFJlcXVlc3RQYXJhbXMpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBfY2hhbmdlUGFzc3dvcmRSZXF1ZXN0ID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJjaGFuZ2VQYXNzd29yZFJlcXVlc3RcIl07XG4gICAgICAgIGlmIChfY2hhbmdlUGFzc3dvcmRSZXF1ZXN0ID09PSBudWxsIHx8IF9jaGFuZ2VQYXNzd29yZFJlcXVlc3QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgY2hhbmdlUGFzc3dvcmRSZXF1ZXN0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgY2hhbmdlUGFzc3dvcmQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuY29uZmlndXJhdGlvbi5iYXNlUGF0aH0vY2xpZW50LWFwaS92Mi91c2Vycy9pZGVudGl0aWVzL3Bhc3N3b3JkYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdXNlciBpZGVudGl0eVxuICAgICAqIENyZWF0ZXMgYSBuZXcgdXNlciBpbiBEQlMgdGhhdCBiZWxvbmdzIHRvIHRoZSBnaXZlbiBsZWdhbCBlbnRpdHkgYW5kIGNvcnJlc3BvbmRpbmcgdXNlciBpZGVudGl0eSBpbiB0aGUgQmFja2Jhc2UtSWRlbnRpdHkgc2VydmljZS4gIElmIHRoZSBmdWxsIG5hbWUgcHJvcGVydHkgaXMgbWlzc2luZyBmcm9tIHRoZSByZXF1ZXN0IHRoZSBmYW1pbHkgYW5kIGdpdmVuIG5hbWUgcHJvcGVydGllcyB3aWxsIGJlIHJlcXVpcmVkIGFuZCB0aGV5IHdpbGwgYmUgY29uY2F0ZW5hdGVkIHRvIGZvcm0gdGhlIEZ1bGwgTmFtZSBpbiBEQlMuIElmIGJvdGggRnVsbCBOYW1lIGFuZCBHaXZlbi9GYW1pbHkgbmFtZSBhcmUgcGFzc2VkIHRoZSBsYXR0ZXIgd2lsbCBiZSB1c2VkLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgY3JlYXRlSWRlbnRpdHkocmVxdWVzdFBhcmFtZXRlcnM6IENyZWF0ZUlkZW50aXR5UmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxDcmVhdGVJZGVudGl0eVJlc3BvbnNlPjtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdXNlciBpZGVudGl0eVxuICAgICAqIENyZWF0ZXMgYSBuZXcgdXNlciBpbiBEQlMgdGhhdCBiZWxvbmdzIHRvIHRoZSBnaXZlbiBsZWdhbCBlbnRpdHkgYW5kIGNvcnJlc3BvbmRpbmcgdXNlciBpZGVudGl0eSBpbiB0aGUgQmFja2Jhc2UtSWRlbnRpdHkgc2VydmljZS4gIElmIHRoZSBmdWxsIG5hbWUgcHJvcGVydHkgaXMgbWlzc2luZyBmcm9tIHRoZSByZXF1ZXN0IHRoZSBmYW1pbHkgYW5kIGdpdmVuIG5hbWUgcHJvcGVydGllcyB3aWxsIGJlIHJlcXVpcmVkIGFuZCB0aGV5IHdpbGwgYmUgY29uY2F0ZW5hdGVkIHRvIGZvcm0gdGhlIEZ1bGwgTmFtZSBpbiBEQlMuIElmIGJvdGggRnVsbCBOYW1lIGFuZCBHaXZlbi9GYW1pbHkgbmFtZSBhcmUgcGFzc2VkIHRoZSBsYXR0ZXIgd2lsbCBiZSB1c2VkLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgY3JlYXRlSWRlbnRpdHkocmVxdWVzdFBhcmFtZXRlcnM6IENyZWF0ZUlkZW50aXR5UmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPENyZWF0ZUlkZW50aXR5UmVzcG9uc2U+PjtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdXNlciBpZGVudGl0eVxuICAgICAqIENyZWF0ZXMgYSBuZXcgdXNlciBpbiBEQlMgdGhhdCBiZWxvbmdzIHRvIHRoZSBnaXZlbiBsZWdhbCBlbnRpdHkgYW5kIGNvcnJlc3BvbmRpbmcgdXNlciBpZGVudGl0eSBpbiB0aGUgQmFja2Jhc2UtSWRlbnRpdHkgc2VydmljZS4gIElmIHRoZSBmdWxsIG5hbWUgcHJvcGVydHkgaXMgbWlzc2luZyBmcm9tIHRoZSByZXF1ZXN0IHRoZSBmYW1pbHkgYW5kIGdpdmVuIG5hbWUgcHJvcGVydGllcyB3aWxsIGJlIHJlcXVpcmVkIGFuZCB0aGV5IHdpbGwgYmUgY29uY2F0ZW5hdGVkIHRvIGZvcm0gdGhlIEZ1bGwgTmFtZSBpbiBEQlMuIElmIGJvdGggRnVsbCBOYW1lIGFuZCBHaXZlbi9GYW1pbHkgbmFtZSBhcmUgcGFzc2VkIHRoZSBsYXR0ZXIgd2lsbCBiZSB1c2VkLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgY3JlYXRlSWRlbnRpdHkocmVxdWVzdFBhcmFtZXRlcnM6IENyZWF0ZUlkZW50aXR5UmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxDcmVhdGVJZGVudGl0eVJlc3BvbnNlPj47XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHVzZXIgaWRlbnRpdHlcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHVzZXIgaW4gREJTIHRoYXQgYmVsb25ncyB0byB0aGUgZ2l2ZW4gbGVnYWwgZW50aXR5IGFuZCBjb3JyZXNwb25kaW5nIHVzZXIgaWRlbnRpdHkgaW4gdGhlIEJhY2tiYXNlLUlkZW50aXR5IHNlcnZpY2UuICBJZiB0aGUgZnVsbCBuYW1lIHByb3BlcnR5IGlzIG1pc3NpbmcgZnJvbSB0aGUgcmVxdWVzdCB0aGUgZmFtaWx5IGFuZCBnaXZlbiBuYW1lIHByb3BlcnRpZXMgd2lsbCBiZSByZXF1aXJlZCBhbmQgdGhleSB3aWxsIGJlIGNvbmNhdGVuYXRlZCB0byBmb3JtIHRoZSBGdWxsIE5hbWUgaW4gREJTLiBJZiBib3RoIEZ1bGwgTmFtZSBhbmQgR2l2ZW4vRmFtaWx5IG5hbWUgYXJlIHBhc3NlZCB0aGUgbGF0dGVyIHdpbGwgYmUgdXNlZC4gIE5vdGUgdGhhdCB0byB1c2UgdGhpcyBlbmRwb2ludCwgdGhlIGZlYXR1cmUgZmxhZyBcXCZxdW90O2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkXFwmcXVvdDsgbXVzdCBiZSBzZXQgdG8gdHJ1ZS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGNyZWF0ZUlkZW50aXR5KHJlcXVlc3RQYXJhbWV0ZXJzOiBDcmVhdGVJZGVudGl0eVJlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9jcmVhdGVJZGVudGl0eVJlcXVlc3QgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImNyZWF0ZUlkZW50aXR5UmVxdWVzdFwiXTtcbiAgICAgICAgaWYgKF9jcmVhdGVJZGVudGl0eVJlcXVlc3QgPT09IG51bGwgfHwgX2NyZWF0ZUlkZW50aXR5UmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBjcmVhdGVJZGVudGl0eVJlcXVlc3Qgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBjcmVhdGVJZGVudGl0eS4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBvcHRpb25zICYmIG9wdGlvbnMuaHR0cEhlYWRlckFjY2VwdDtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlVHlwZTogJ3RleHQnIHwgJ2pzb24nID0gJ2pzb24nO1xuICAgICAgICBpZihodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgJiYgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkLnN0YXJ0c1dpdGgoJ3RleHQnKSkge1xuICAgICAgICAgICAgcmVzcG9uc2VUeXBlID0gJ3RleHQnO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0PENyZWF0ZUlkZW50aXR5UmVzcG9uc2U+KGAke3RoaXMuY29uZmlndXJhdGlvbi5iYXNlUGF0aH0vY2xpZW50LWFwaS92Mi91c2Vycy9pZGVudGl0aWVzYCxcbiAgICAgICAgICAgIF9jcmVhdGVJZGVudGl0eVJlcXVlc3QsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVJZGVudGl0eVVybChyZXF1ZXN0UGFyYW1ldGVyczogQ3JlYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2NyZWF0ZUlkZW50aXR5UmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiY3JlYXRlSWRlbnRpdHlSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX2NyZWF0ZUlkZW50aXR5UmVxdWVzdCA9PT0gbnVsbCB8fCBfY3JlYXRlSWRlbnRpdHlSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGNyZWF0ZUlkZW50aXR5UmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGNyZWF0ZUlkZW50aXR5LicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllc2A7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGlzdCBVc2VyIGlkZW50aXRpZXNcbiAgICAgKiBSZXRyaWV2ZSBhIGxpc3Qgb2YgdXNlciBpZGVudGl0aWVzIHdpdGggdGhlIHNlYXJjaCBjcml0ZXJpYSBwYXNzZWQgYXMgcXVlcnkgcGFyYW1ldGVyczogKiBleHRlcm5hbElkOiBVc2VyIEV4dGVybmFsIElEIHVzZWQgYXMgYSBzZWFyY2ggdGVybS4gIFRoaXMgZW5kcG9pbnQgcmVzdWx0cyBhcmUgcGFnZWFibGUgYW5kIGFkbWl0IGFsc28gdGhlIGZvbGxvd2luZyBxdWVyeSBwYXJhbWV0ZXJzOiAqIGZyb206IFBhZ2UgTnVtYmVyLiBTa2lwIG92ZXIgcGFnZXMgb2YgZWxlbWVudHMgYnkgc3BlY2lmeWluZyBhIHN0YXJ0IHZhbHVlIGZvciB0aGUgcXVlcnkuICogc2l6ZTogTnVtYmVyIG9mIHJlY29yZHMgdGhhdCB3aWxsIGJlIHNob3duIGVhY2ggcmVxdWVzdC4gIEFzIGFuIGV4YW1wbGUsIGEgcmVxdWVzdCB1c2luZyB0aGUgZm9sbG93aW5nIHF1ZXJ5IHBhcmFtZXRlcnM6ICAmI3g2MDsmI3g2MDsmI3g2MDtmcm9tJiN4M0Q7MiZhbXA7c2l6ZSYjeDNEOzEwJiN4NjA7JiN4NjA7JiN4NjA7ICB3aWxsIHNob3cgdGhlIGVsZW1lbnRzIDIwdGggdG8gMzB0aCAobm9uIGluY2x1c2l2ZSkuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRJZGVudGl0aWVzKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0aWVzUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxHZXRJZGVudGl0aWVzPjtcbiAgICAvKipcbiAgICAgKiBMaXN0IFVzZXIgaWRlbnRpdGllc1xuICAgICAqIFJldHJpZXZlIGEgbGlzdCBvZiB1c2VyIGlkZW50aXRpZXMgd2l0aCB0aGUgc2VhcmNoIGNyaXRlcmlhIHBhc3NlZCBhcyBxdWVyeSBwYXJhbWV0ZXJzOiAqIGV4dGVybmFsSWQ6IFVzZXIgRXh0ZXJuYWwgSUQgdXNlZCBhcyBhIHNlYXJjaCB0ZXJtLiAgVGhpcyBlbmRwb2ludCByZXN1bHRzIGFyZSBwYWdlYWJsZSBhbmQgYWRtaXQgYWxzbyB0aGUgZm9sbG93aW5nIHF1ZXJ5IHBhcmFtZXRlcnM6ICogZnJvbTogUGFnZSBOdW1iZXIuIFNraXAgb3ZlciBwYWdlcyBvZiBlbGVtZW50cyBieSBzcGVjaWZ5aW5nIGEgc3RhcnQgdmFsdWUgZm9yIHRoZSBxdWVyeS4gKiBzaXplOiBOdW1iZXIgb2YgcmVjb3JkcyB0aGF0IHdpbGwgYmUgc2hvd24gZWFjaCByZXF1ZXN0LiAgQXMgYW4gZXhhbXBsZSwgYSByZXF1ZXN0IHVzaW5nIHRoZSBmb2xsb3dpbmcgcXVlcnkgcGFyYW1ldGVyczogICYjeDYwOyYjeDYwOyYjeDYwO2Zyb20mI3gzRDsyJmFtcDtzaXplJiN4M0Q7MTAmI3g2MDsmI3g2MDsmI3g2MDsgIHdpbGwgc2hvdyB0aGUgZWxlbWVudHMgMjB0aCB0byAzMHRoIChub24gaW5jbHVzaXZlKS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldElkZW50aXRpZXMocmVxdWVzdFBhcmFtZXRlcnM6IEdldElkZW50aXRpZXNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8R2V0SWRlbnRpdGllcz4+O1xuICAgIC8qKlxuICAgICAqIExpc3QgVXNlciBpZGVudGl0aWVzXG4gICAgICogUmV0cmlldmUgYSBsaXN0IG9mIHVzZXIgaWRlbnRpdGllcyB3aXRoIHRoZSBzZWFyY2ggY3JpdGVyaWEgcGFzc2VkIGFzIHF1ZXJ5IHBhcmFtZXRlcnM6ICogZXh0ZXJuYWxJZDogVXNlciBFeHRlcm5hbCBJRCB1c2VkIGFzIGEgc2VhcmNoIHRlcm0uICBUaGlzIGVuZHBvaW50IHJlc3VsdHMgYXJlIHBhZ2VhYmxlIGFuZCBhZG1pdCBhbHNvIHRoZSBmb2xsb3dpbmcgcXVlcnkgcGFyYW1ldGVyczogKiBmcm9tOiBQYWdlIE51bWJlci4gU2tpcCBvdmVyIHBhZ2VzIG9mIGVsZW1lbnRzIGJ5IHNwZWNpZnlpbmcgYSBzdGFydCB2YWx1ZSBmb3IgdGhlIHF1ZXJ5LiAqIHNpemU6IE51bWJlciBvZiByZWNvcmRzIHRoYXQgd2lsbCBiZSBzaG93biBlYWNoIHJlcXVlc3QuICBBcyBhbiBleGFtcGxlLCBhIHJlcXVlc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBxdWVyeSBwYXJhbWV0ZXJzOiAgJiN4NjA7JiN4NjA7JiN4NjA7ZnJvbSYjeDNEOzImYW1wO3NpemUmI3gzRDsxMCYjeDYwOyYjeDYwOyYjeDYwOyAgd2lsbCBzaG93IHRoZSBlbGVtZW50cyAyMHRoIHRvIDMwdGggKG5vbiBpbmNsdXNpdmUpLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdGllcyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0SWRlbnRpdGllc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8R2V0SWRlbnRpdGllcz4+O1xuICAgIC8qKlxuICAgICAqIExpc3QgVXNlciBpZGVudGl0aWVzXG4gICAgICogUmV0cmlldmUgYSBsaXN0IG9mIHVzZXIgaWRlbnRpdGllcyB3aXRoIHRoZSBzZWFyY2ggY3JpdGVyaWEgcGFzc2VkIGFzIHF1ZXJ5IHBhcmFtZXRlcnM6ICogZXh0ZXJuYWxJZDogVXNlciBFeHRlcm5hbCBJRCB1c2VkIGFzIGEgc2VhcmNoIHRlcm0uICBUaGlzIGVuZHBvaW50IHJlc3VsdHMgYXJlIHBhZ2VhYmxlIGFuZCBhZG1pdCBhbHNvIHRoZSBmb2xsb3dpbmcgcXVlcnkgcGFyYW1ldGVyczogKiBmcm9tOiBQYWdlIE51bWJlci4gU2tpcCBvdmVyIHBhZ2VzIG9mIGVsZW1lbnRzIGJ5IHNwZWNpZnlpbmcgYSBzdGFydCB2YWx1ZSBmb3IgdGhlIHF1ZXJ5LiAqIHNpemU6IE51bWJlciBvZiByZWNvcmRzIHRoYXQgd2lsbCBiZSBzaG93biBlYWNoIHJlcXVlc3QuICBBcyBhbiBleGFtcGxlLCBhIHJlcXVlc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBxdWVyeSBwYXJhbWV0ZXJzOiAgJiN4NjA7JiN4NjA7JiN4NjA7ZnJvbSYjeDNEOzImYW1wO3NpemUmI3gzRDsxMCYjeDYwOyYjeDYwOyYjeDYwOyAgd2lsbCBzaG93IHRoZSBlbGVtZW50cyAyMHRoIHRvIDMwdGggKG5vbiBpbmNsdXNpdmUpLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdGllcyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0SWRlbnRpdGllc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9leHRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJleHRlcm5hbElkXCJdO1xuICAgICAgICBjb25zdCBfZnJvbSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiZnJvbVwiXTtcbiAgICAgICAgY29uc3QgX2N1cnNvciA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiY3Vyc29yXCJdO1xuICAgICAgICBjb25zdCBfc2l6ZSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wic2l6ZVwiXTtcbiAgICAgICAgY29uc3QgX2xlZ2FsRW50aXR5TmFtZSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wibGVnYWxFbnRpdHlOYW1lXCJdO1xuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogdGhpcy5lbmNvZGVyfSk7XG4gICAgICAgIGlmIChfZXh0ZXJuYWxJZCAhPT0gdW5kZWZpbmVkICYmIF9leHRlcm5hbElkICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fZXh0ZXJuYWxJZCwgJ2V4dGVybmFsSWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX2Zyb20gIT09IHVuZGVmaW5lZCAmJiBfZnJvbSAhPT0gbnVsbCkge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgIDxhbnk+X2Zyb20sICdmcm9tJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9jdXJzb3IgIT09IHVuZGVmaW5lZCAmJiBfY3Vyc29yICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fY3Vyc29yLCAnY3Vyc29yJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9zaXplICE9PSB1bmRlZmluZWQgJiYgX3NpemUgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9zaXplLCAnc2l6ZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfbGVnYWxFbnRpdHlOYW1lICE9PSB1bmRlZmluZWQgJiYgX2xlZ2FsRW50aXR5TmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgIDxhbnk+X2xlZ2FsRW50aXR5TmFtZSwgJ2xlZ2FsRW50aXR5TmFtZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwSGVhZGVyQWNjZXB0O1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cblxuICAgICAgICBsZXQgcmVzcG9uc2VUeXBlOiAndGV4dCcgfCAnanNvbicgPSAnanNvbic7XG4gICAgICAgIGlmKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAmJiBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQuc3RhcnRzV2l0aCgndGV4dCcpKSB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldDxHZXRJZGVudGl0aWVzPihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllc2AsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJZGVudGl0aWVzVXJsKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0aWVzUmVxdWVzdFBhcmFtcyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IF9leHRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJleHRlcm5hbElkXCJdO1xuICAgICAgICBjb25zdCBfZnJvbSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiZnJvbVwiXTtcbiAgICAgICAgY29uc3QgX2N1cnNvciA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiY3Vyc29yXCJdO1xuICAgICAgICBjb25zdCBfc2l6ZSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wic2l6ZVwiXTtcbiAgICAgICAgY29uc3QgX2xlZ2FsRW50aXR5TmFtZSA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wibGVnYWxFbnRpdHlOYW1lXCJdO1xuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IHRoaXMuZW5jb2Rlcn0pO1xuICAgICAgICBpZiAoX2V4dGVybmFsSWQgIT09IHVuZGVmaW5lZCAmJiBfZXh0ZXJuYWxJZCAhPT0gbnVsbCkge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgIDxhbnk+X2V4dGVybmFsSWQsICdleHRlcm5hbElkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9mcm9tICE9PSB1bmRlZmluZWQgJiYgX2Zyb20gIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9mcm9tLCAnZnJvbScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfY3Vyc29yICE9PSB1bmRlZmluZWQgJiYgX2N1cnNvciAhPT0gbnVsbCkge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgIDxhbnk+X2N1cnNvciwgJ2N1cnNvcicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfc2l6ZSAhPT0gdW5kZWZpbmVkICYmIF9zaXplICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fc2l6ZSwgJ3NpemUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX2xlZ2FsRW50aXR5TmFtZSAhPT0gdW5kZWZpbmVkICYmIF9sZWdhbEVudGl0eU5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9sZWdhbEVudGl0eU5hbWUsICdsZWdhbEVudGl0eU5hbWUnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IHF1ZXJ5UGFyYW1ldGVycy50b1N0cmluZygpO1xuICAgICAgICByZXR1cm4gYCR7dGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRofS9jbGllbnQtYXBpL3YyL3VzZXJzL2lkZW50aXRpZXMke3F1ZXJ5U3RyaW5nID8gYD8ke3F1ZXJ5U3RyaW5nfWAgOiAnJ31gO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZXIgaWRlbnRpdHkgZGV0YWlsc1xuICAgICAqIFJldHJpZXZlcyBhIFVzZXIgSWRlbnRpdHkgYnkgaXRzIGludGVybmFsIElELiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdHkocmVxdWVzdFBhcmFtZXRlcnM6IEdldElkZW50aXR5UmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxHZXRJZGVudGl0eT47XG4gICAgLyoqXG4gICAgICogVXNlciBpZGVudGl0eSBkZXRhaWxzXG4gICAgICogUmV0cmlldmVzIGEgVXNlciBJZGVudGl0eSBieSBpdHMgaW50ZXJuYWwgSUQuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRJZGVudGl0eShyZXF1ZXN0UGFyYW1ldGVyczogR2V0SWRlbnRpdHlSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8R2V0SWRlbnRpdHk+PjtcbiAgICAvKipcbiAgICAgKiBVc2VyIGlkZW50aXR5IGRldGFpbHNcbiAgICAgKiBSZXRyaWV2ZXMgYSBVc2VyIElkZW50aXR5IGJ5IGl0cyBpbnRlcm5hbCBJRC4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldElkZW50aXR5KHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVJlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8R2V0SWRlbnRpdHk+PjtcbiAgICAvKipcbiAgICAgKiBVc2VyIGlkZW50aXR5IGRldGFpbHNcbiAgICAgKiBSZXRyaWV2ZXMgYSBVc2VyIElkZW50aXR5IGJ5IGl0cyBpbnRlcm5hbCBJRC4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldElkZW50aXR5KHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVJlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9pbnRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcm5hbElkXCJdO1xuICAgICAgICBpZiAoX2ludGVybmFsSWQgPT09IG51bGwgfHwgX2ludGVybmFsSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaW50ZXJuYWxJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGdldElkZW50aXR5LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwSGVhZGVyQWNjZXB0O1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cblxuICAgICAgICBsZXQgcmVzcG9uc2VUeXBlOiAndGV4dCcgfCAnanNvbicgPSAnanNvbic7XG4gICAgICAgIGlmKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAmJiBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQuc3RhcnRzV2l0aCgndGV4dCcpKSB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldDxHZXRJZGVudGl0eT4oYCR7dGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRofS9jbGllbnQtYXBpL3YyL3VzZXJzL2lkZW50aXRpZXMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKF9pbnRlcm5hbElkKSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6IDxhbnk+cmVzcG9uc2VUeXBlLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldElkZW50aXR5VXJsKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVJlcXVlc3RQYXJhbXMpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBfaW50ZXJuYWxJZCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaW50ZXJuYWxJZFwiXTtcbiAgICAgICAgaWYgKF9pbnRlcm5hbElkID09PSBudWxsIHx8IF9pbnRlcm5hbElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGludGVybmFsSWQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRJZGVudGl0eS4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7dGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRofS9jbGllbnQtYXBpL3YyL3VzZXJzL2lkZW50aXRpZXMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKF9pbnRlcm5hbElkKSl9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhcHByb3ZhbHMgcGVuZGluZyBmb3IgYW4gSWRlbnRpdHlcbiAgICAgKiBSZXR1cm4gYWxsIHRoZSBwZW5kaW5nIGFwcHJvdmFscyBmb3IgYSB1c2VyIGRlZmluZWQgYnkgdGhlaXIgSW50ZXJuYWwgSUQuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHMocmVxdWVzdFBhcmFtZXRlcnM6IEdldElkZW50aXR5UGVuZGluZ0FwcHJvdmFsc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8QXJyYXk8R2V0UGVuZGluZ0FwcHJvdmFsPj47XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgYXBwcm92YWxzIHBlbmRpbmcgZm9yIGFuIElkZW50aXR5XG4gICAgICogUmV0dXJuIGFsbCB0aGUgcGVuZGluZyBhcHByb3ZhbHMgZm9yIGEgdXNlciBkZWZpbmVkIGJ5IHRoZWlyIEludGVybmFsIElELiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdHlQZW5kaW5nQXBwcm92YWxzKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8QXJyYXk8R2V0UGVuZGluZ0FwcHJvdmFsPj4+O1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGFwcHJvdmFscyBwZW5kaW5nIGZvciBhbiBJZGVudGl0eVxuICAgICAqIFJldHVybiBhbGwgdGhlIHBlbmRpbmcgYXBwcm92YWxzIGZvciBhIHVzZXIgZGVmaW5lZCBieSB0aGVpciBJbnRlcm5hbCBJRC4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldElkZW50aXR5UGVuZGluZ0FwcHJvdmFscyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0SWRlbnRpdHlQZW5kaW5nQXBwcm92YWxzUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxBcnJheTxHZXRQZW5kaW5nQXBwcm92YWw+Pj47XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgYXBwcm92YWxzIHBlbmRpbmcgZm9yIGFuIElkZW50aXR5XG4gICAgICogUmV0dXJuIGFsbCB0aGUgcGVuZGluZyBhcHByb3ZhbHMgZm9yIGEgdXNlciBkZWZpbmVkIGJ5IHRoZWlyIEludGVybmFsIElELiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdHlQZW5kaW5nQXBwcm92YWxzKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UsIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCBfaW50ZXJuYWxJZCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaW50ZXJuYWxJZFwiXTtcbiAgICAgICAgaWYgKF9pbnRlcm5hbElkID09PSBudWxsIHx8IF9pbnRlcm5hbElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGludGVybmFsSWQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gb3B0aW9ucyAmJiBvcHRpb25zLmh0dHBIZWFkZXJBY2NlcHQ7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGxldCByZXNwb25zZVR5cGU6ICd0ZXh0JyB8ICdqc29uJyA9ICdqc29uJztcbiAgICAgICAgaWYoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICYmIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZC5zdGFydHNXaXRoKCd0ZXh0JykpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZSA9ICd0ZXh0JztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0PEFycmF5PEdldFBlbmRpbmdBcHByb3ZhbD4+KGAke3RoaXMuY29uZmlndXJhdGlvbi5iYXNlUGF0aH0vY2xpZW50LWFwaS92Mi91c2Vycy9pZGVudGl0aWVzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhfaW50ZXJuYWxJZCkpfS9hcHByb3ZhbHNgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogPGFueT5yZXNwb25zZVR5cGUsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0SWRlbnRpdHlQZW5kaW5nQXBwcm92YWxzVXJsKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRJZGVudGl0eVBlbmRpbmdBcHByb3ZhbHNSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0SWRlbnRpdHlQZW5kaW5nQXBwcm92YWxzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vYXBwcm92YWxzYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgVXNlciBJZGVudGl0eSBzZXNzaW9uc1xuICAgICAqIFJldHJpZXZlcyB0aGUgc2Vzc2lvbnMgYXNzb2NpYXRlZCB3aXRoIGFuIGlkZW50aXR5LiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2Vzc2lvbnMocmVxdWVzdFBhcmFtZXRlcnM6IEdldFNlc3Npb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxHZXRJZGVudGl0eVNlc3Npb25zPjtcbiAgICAvKipcbiAgICAgKiBHZXQgVXNlciBJZGVudGl0eSBzZXNzaW9uc1xuICAgICAqIFJldHJpZXZlcyB0aGUgc2Vzc2lvbnMgYXNzb2NpYXRlZCB3aXRoIGFuIGlkZW50aXR5LiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2Vzc2lvbnMocmVxdWVzdFBhcmFtZXRlcnM6IEdldFNlc3Npb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPEdldElkZW50aXR5U2Vzc2lvbnM+PjtcbiAgICAvKipcbiAgICAgKiBHZXQgVXNlciBJZGVudGl0eSBzZXNzaW9uc1xuICAgICAqIFJldHJpZXZlcyB0aGUgc2Vzc2lvbnMgYXNzb2NpYXRlZCB3aXRoIGFuIGlkZW50aXR5LiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0U2Vzc2lvbnMocmVxdWVzdFBhcmFtZXRlcnM6IEdldFNlc3Npb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxHZXRJZGVudGl0eVNlc3Npb25zPj47XG4gICAgLyoqXG4gICAgICogR2V0IFVzZXIgSWRlbnRpdHkgc2Vzc2lvbnNcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIHNlc3Npb25zIGFzc29jaWF0ZWQgd2l0aCBhbiBpZGVudGl0eS4gIE5vdGUgdGhhdCB0byB1c2UgdGhpcyBlbmRwb2ludCwgdGhlIGZlYXR1cmUgZmxhZyBcXCZxdW90O2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkXFwmcXVvdDsgbXVzdCBiZSBzZXQgdG8gdHJ1ZS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldFNlc3Npb25zKHJlcXVlc3RQYXJhbWV0ZXJzOiBHZXRTZXNzaW9uc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9pbnRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcm5hbElkXCJdO1xuICAgICAgICBpZiAoX2ludGVybmFsSWQgPT09IG51bGwgfHwgX2ludGVybmFsSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaW50ZXJuYWxJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGdldFNlc3Npb25zLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwSGVhZGVyQWNjZXB0O1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cblxuICAgICAgICBsZXQgcmVzcG9uc2VUeXBlOiAndGV4dCcgfCAnanNvbicgPSAnanNvbic7XG4gICAgICAgIGlmKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAmJiBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQuc3RhcnRzV2l0aCgndGV4dCcpKSB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldDxHZXRJZGVudGl0eVNlc3Npb25zPihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc2Vzc2lvbnNgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogPGFueT5yZXNwb25zZVR5cGUsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2Vzc2lvbnNVcmwocmVxdWVzdFBhcmFtZXRlcnM6IEdldFNlc3Npb25zUmVxdWVzdFBhcmFtcyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IF9pbnRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcm5hbElkXCJdO1xuICAgICAgICBpZiAoX2ludGVybmFsSWQgPT09IG51bGwgfHwgX2ludGVybmFsSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaW50ZXJuYWxJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGdldFNlc3Npb25zLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc2Vzc2lvbnNgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvZ291dCBJZGVudGl0eSBzZXNzaW9uc1xuICAgICAqIExvZ3Mgb3V0IGVpdGhlciBhIGxpc3Qgb2Ygc2Vzc2lvbnMgZm9yIGEgdXNlciwgb3IgYWxsIHNlc3Npb25zIGZvciBhbiBpbmRpdmlkdWFsIHVzZXIgaWYgYW4gZW1wdHkgc2Vzc2lvbklkcyBhcnJheSBpcyBzZXQgaW4gdGhlIHJlcXVlc3QuICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBsb2dvdXRTZXNzaW9ucyhyZXF1ZXN0UGFyYW1ldGVyczogTG9nb3V0U2Vzc2lvbnNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPGFueT47XG4gICAgLyoqXG4gICAgICogTG9nb3V0IElkZW50aXR5IHNlc3Npb25zXG4gICAgICogTG9ncyBvdXQgZWl0aGVyIGEgbGlzdCBvZiBzZXNzaW9ucyBmb3IgYSB1c2VyLCBvciBhbGwgc2Vzc2lvbnMgZm9yIGFuIGluZGl2aWR1YWwgdXNlciBpZiBhbiBlbXB0eSBzZXNzaW9uSWRzIGFycmF5IGlzIHNldCBpbiB0aGUgcmVxdWVzdC4gIE5vdGUgdGhhdCB0byB1c2UgdGhpcyBlbmRwb2ludCwgdGhlIGZlYXR1cmUgZmxhZyBcXCZxdW90O2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkXFwmcXVvdDsgbXVzdCBiZSBzZXQgdG8gdHJ1ZS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGxvZ291dFNlc3Npb25zKHJlcXVlc3RQYXJhbWV0ZXJzOiBMb2dvdXRTZXNzaW9uc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxhbnk+PjtcbiAgICAvKipcbiAgICAgKiBMb2dvdXQgSWRlbnRpdHkgc2Vzc2lvbnNcbiAgICAgKiBMb2dzIG91dCBlaXRoZXIgYSBsaXN0IG9mIHNlc3Npb25zIGZvciBhIHVzZXIsIG9yIGFsbCBzZXNzaW9ucyBmb3IgYW4gaW5kaXZpZHVhbCB1c2VyIGlmIGFuIGVtcHR5IHNlc3Npb25JZHMgYXJyYXkgaXMgc2V0IGluIHRoZSByZXF1ZXN0LiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgbG9nb3V0U2Vzc2lvbnMocmVxdWVzdFBhcmFtZXRlcnM6IExvZ291dFNlc3Npb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxhbnk+PjtcbiAgICAvKipcbiAgICAgKiBMb2dvdXQgSWRlbnRpdHkgc2Vzc2lvbnNcbiAgICAgKiBMb2dzIG91dCBlaXRoZXIgYSBsaXN0IG9mIHNlc3Npb25zIGZvciBhIHVzZXIsIG9yIGFsbCBzZXNzaW9ucyBmb3IgYW4gaW5kaXZpZHVhbCB1c2VyIGlmIGFuIGVtcHR5IHNlc3Npb25JZHMgYXJyYXkgaXMgc2V0IGluIHRoZSByZXF1ZXN0LiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgbG9nb3V0U2Vzc2lvbnMocmVxdWVzdFBhcmFtZXRlcnM6IExvZ291dFNlc3Npb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgbG9nb3V0U2Vzc2lvbnMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2lkZW50aXR5TG9nb3V0UmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaWRlbnRpdHlMb2dvdXRSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX2lkZW50aXR5TG9nb3V0UmVxdWVzdCA9PT0gbnVsbCB8fCBfaWRlbnRpdHlMb2dvdXRSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGlkZW50aXR5TG9nb3V0UmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGxvZ291dFNlc3Npb25zLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwSGVhZGVyQWNjZXB0O1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBDb250ZW50VHlwZVNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQ29udGVudFR5cGUoY29uc3VtZXMpO1xuICAgICAgICBpZiAoaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBodHRwQ29udGVudFR5cGVTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzcG9uc2VUeXBlOiAndGV4dCcgfCAnanNvbicgPSAnanNvbic7XG4gICAgICAgIGlmKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAmJiBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQuc3RhcnRzV2l0aCgndGV4dCcpKSB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3Q8YW55PihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc2Vzc2lvbnMvbG9nb3V0YCxcbiAgICAgICAgICAgIF9pZGVudGl0eUxvZ291dFJlcXVlc3QsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2dvdXRTZXNzaW9uc1VybChyZXF1ZXN0UGFyYW1ldGVyczogTG9nb3V0U2Vzc2lvbnNSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgbG9nb3V0U2Vzc2lvbnMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2lkZW50aXR5TG9nb3V0UmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaWRlbnRpdHlMb2dvdXRSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX2lkZW50aXR5TG9nb3V0UmVxdWVzdCA9PT0gbnVsbCB8fCBfaWRlbnRpdHlMb2dvdXRSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGlkZW50aXR5TG9nb3V0UmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGxvZ291dFNlc3Npb25zLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc2Vzc2lvbnMvbG9nb3V0YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXZva2UgSWRlbnRpdHkgYWNjZXNzXG4gICAgICogVGhpcyBlbmRwb2ludCBzZXRzIHRoZSB1c2VyXFwmIzM5O3Mgc3RhdHVzIHRvIEFjY2VzcyBSZXZva2VkIGFuZCBkaXNhYmxlcyB0aGUgdXNlciwgZWZmZWN0aXZlbHkgbWFraW5nIHRoZW0gdW5hYmxlIHRvIGFjY2VzcyBCYWNrYmFzZSBzZXJ2aWNlcy4gQSB1c2VyIHdpdGggc3RhdHVzIEFjY2VzcyBSZXZva2VkIGNhbm5vdCBiZSB1bmxvY2tlZCB2aWEgb3RoZXIgZW5kcG9pbnRzLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmV2b2tlSWRlbnRpdHlBY2Nlc3MocmVxdWVzdFBhcmFtZXRlcnM6IFJldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+O1xuICAgIC8qKlxuICAgICAqIFJldm9rZSBJZGVudGl0eSBhY2Nlc3NcbiAgICAgKiBUaGlzIGVuZHBvaW50IHNldHMgdGhlIHVzZXJcXCYjMzk7cyBzdGF0dXMgdG8gQWNjZXNzIFJldm9rZWQgYW5kIGRpc2FibGVzIHRoZSB1c2VyLCBlZmZlY3RpdmVseSBtYWtpbmcgdGhlbSB1bmFibGUgdG8gYWNjZXNzIEJhY2tiYXNlIHNlcnZpY2VzLiBBIHVzZXIgd2l0aCBzdGF0dXMgQWNjZXNzIFJldm9rZWQgY2Fubm90IGJlIHVubG9ja2VkIHZpYSBvdGhlciBlbmRwb2ludHMuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyByZXZva2VJZGVudGl0eUFjY2VzcyhyZXF1ZXN0UGFyYW1ldGVyczogUmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8YW55Pj47XG4gICAgLyoqXG4gICAgICogUmV2b2tlIElkZW50aXR5IGFjY2Vzc1xuICAgICAqIFRoaXMgZW5kcG9pbnQgc2V0cyB0aGUgdXNlclxcJiMzOTtzIHN0YXR1cyB0byBBY2Nlc3MgUmV2b2tlZCBhbmQgZGlzYWJsZXMgdGhlIHVzZXIsIGVmZmVjdGl2ZWx5IG1ha2luZyB0aGVtIHVuYWJsZSB0byBhY2Nlc3MgQmFja2Jhc2Ugc2VydmljZXMuIEEgdXNlciB3aXRoIHN0YXR1cyBBY2Nlc3MgUmV2b2tlZCBjYW5ub3QgYmUgdW5sb2NrZWQgdmlhIG90aGVyIGVuZHBvaW50cy4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHJldm9rZUlkZW50aXR5QWNjZXNzKHJlcXVlc3RQYXJhbWV0ZXJzOiBSZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8YW55Pj47XG4gICAgLyoqXG4gICAgICogUmV2b2tlIElkZW50aXR5IGFjY2Vzc1xuICAgICAqIFRoaXMgZW5kcG9pbnQgc2V0cyB0aGUgdXNlclxcJiMzOTtzIHN0YXR1cyB0byBBY2Nlc3MgUmV2b2tlZCBhbmQgZGlzYWJsZXMgdGhlIHVzZXIsIGVmZmVjdGl2ZWx5IG1ha2luZyB0aGVtIHVuYWJsZSB0byBhY2Nlc3MgQmFja2Jhc2Ugc2VydmljZXMuIEEgdXNlciB3aXRoIHN0YXR1cyBBY2Nlc3MgUmV2b2tlZCBjYW5ub3QgYmUgdW5sb2NrZWQgdmlhIG90aGVyIGVuZHBvaW50cy4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHJldm9rZUlkZW50aXR5QWNjZXNzKHJlcXVlc3RQYXJhbWV0ZXJzOiBSZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IF9pbnRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcm5hbElkXCJdO1xuICAgICAgICBpZiAoX2ludGVybmFsSWQgPT09IG51bGwgfHwgX2ludGVybmFsSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaW50ZXJuYWxJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHJldm9rZUlkZW50aXR5QWNjZXNzLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IF9yZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3QgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInJldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdFwiXTtcbiAgICAgICAgaWYgKF9yZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3QgPT09IG51bGwgfHwgX3Jldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciByZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3Qgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyByZXZva2VJZGVudGl0eUFjY2Vzcy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBvcHRpb25zICYmIG9wdGlvbnMuaHR0cEhlYWRlckFjY2VwdDtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlVHlwZTogJ3RleHQnIHwgJ2pzb24nID0gJ2pzb24nO1xuICAgICAgICBpZihodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgJiYgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkLnN0YXJ0c1dpdGgoJ3RleHQnKSkge1xuICAgICAgICAgICAgcmVzcG9uc2VUeXBlID0gJ3RleHQnO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQ8YW55PihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vYWNjZXNzYCxcbiAgICAgICAgICAgIF9yZXZva2VJZGVudGl0eUFjY2Vzc1JlcXVlc3QsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyByZXZva2VJZGVudGl0eUFjY2Vzc1VybChyZXF1ZXN0UGFyYW1ldGVyczogUmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgcmV2b2tlSWRlbnRpdHlBY2Nlc3MuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX3Jldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wicmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX3Jldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdCA9PT0gbnVsbCB8fCBfcmV2b2tlSWRlbnRpdHlBY2Nlc3NSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHJldm9rZUlkZW50aXR5QWNjZXNzUmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHJldm9rZUlkZW50aXR5QWNjZXNzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vYWNjZXNzYDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZW5kIGVtYWlsIHdpdGggcmVxdWlyZWQgYWN0aW9uc1xuICAgICAqIFJlcXVlc3RzIHRoZSBpZGVudGl0eSBzeXN0ZW0gdG8gc2VuZCBhbiBlbWFpbCB0byBhIHVzZXIgd2l0aCBhIGxpbmsgdG8gcGVyZm9ybSB0aGUgZ2l2ZW4gYWN0aW9ucy4gIE5vdGUgdGhhdCB0byB1c2UgdGhpcyBlbmRwb2ludCwgdGhlIGZlYXR1cmUgZmxhZyBcXCZxdW90O2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkXFwmcXVvdDsgbXVzdCBiZSBzZXQgdG8gdHJ1ZS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHNlbmRSZXF1aXJlZEFjdGlvbnMocmVxdWVzdFBhcmFtZXRlcnM6IFNlbmRSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPGFueT47XG4gICAgLyoqXG4gICAgICogU2VuZCBlbWFpbCB3aXRoIHJlcXVpcmVkIGFjdGlvbnNcbiAgICAgKiBSZXF1ZXN0cyB0aGUgaWRlbnRpdHkgc3lzdGVtIHRvIHNlbmQgYW4gZW1haWwgdG8gYSB1c2VyIHdpdGggYSBsaW5rIHRvIHBlcmZvcm0gdGhlIGdpdmVuIGFjdGlvbnMuICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBzZW5kUmVxdWlyZWRBY3Rpb25zKHJlcXVlc3RQYXJhbWV0ZXJzOiBTZW5kUmVxdWlyZWRBY3Rpb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPGFueT4+O1xuICAgIC8qKlxuICAgICAqIFNlbmQgZW1haWwgd2l0aCByZXF1aXJlZCBhY3Rpb25zXG4gICAgICogUmVxdWVzdHMgdGhlIGlkZW50aXR5IHN5c3RlbSB0byBzZW5kIGFuIGVtYWlsIHRvIGEgdXNlciB3aXRoIGEgbGluayB0byBwZXJmb3JtIHRoZSBnaXZlbiBhY3Rpb25zLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgc2VuZFJlcXVpcmVkQWN0aW9ucyhyZXF1ZXN0UGFyYW1ldGVyczogU2VuZFJlcXVpcmVkQWN0aW9uc1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8YW55Pj47XG4gICAgLyoqXG4gICAgICogU2VuZCBlbWFpbCB3aXRoIHJlcXVpcmVkIGFjdGlvbnNcbiAgICAgKiBSZXF1ZXN0cyB0aGUgaWRlbnRpdHkgc3lzdGVtIHRvIHNlbmQgYW4gZW1haWwgdG8gYSB1c2VyIHdpdGggYSBsaW5rIHRvIHBlcmZvcm0gdGhlIGdpdmVuIGFjdGlvbnMuICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBzZW5kUmVxdWlyZWRBY3Rpb25zKHJlcXVlc3RQYXJhbWV0ZXJzOiBTZW5kUmVxdWlyZWRBY3Rpb25zUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgc2VuZFJlcXVpcmVkQWN0aW9ucy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfaWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0ID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3RcIl07XG4gICAgICAgIGlmIChfaWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0ID09PSBudWxsIHx8IF9pZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgc2VuZFJlcXVpcmVkQWN0aW9ucy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBvcHRpb25zICYmIG9wdGlvbnMuaHR0cEhlYWRlckFjY2VwdDtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlVHlwZTogJ3RleHQnIHwgJ2pzb24nID0gJ2pzb24nO1xuICAgICAgICBpZihodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgJiYgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkLnN0YXJ0c1dpdGgoJ3RleHQnKSkge1xuICAgICAgICAgICAgcmVzcG9uc2VUeXBlID0gJ3RleHQnO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQ8YW55PihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vYWN0aW9uc2AsXG4gICAgICAgICAgICBfaWRlbnRpdHlSZXF1aXJlZEFjdGlvbnNSZXF1ZXN0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogPGFueT5yZXNwb25zZVR5cGUsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VuZFJlcXVpcmVkQWN0aW9uc1VybChyZXF1ZXN0UGFyYW1ldGVyczogU2VuZFJlcXVpcmVkQWN0aW9uc1JlcXVlc3RQYXJhbXMpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBfaW50ZXJuYWxJZCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaW50ZXJuYWxJZFwiXTtcbiAgICAgICAgaWYgKF9pbnRlcm5hbElkID09PSBudWxsIHx8IF9pbnRlcm5hbElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGludGVybmFsSWQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBzZW5kUmVxdWlyZWRBY3Rpb25zLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IF9pZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3QgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImlkZW50aXR5UmVxdWlyZWRBY3Rpb25zUmVxdWVzdFwiXTtcbiAgICAgICAgaWYgKF9pZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3QgPT09IG51bGwgfHwgX2lkZW50aXR5UmVxdWlyZWRBY3Rpb25zUmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpZGVudGl0eVJlcXVpcmVkQWN0aW9uc1JlcXVlc3Qgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBzZW5kUmVxdWlyZWRBY3Rpb25zLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vYWN0aW9uc2A7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHVzZXIgaWRlbnRpdHlcbiAgICAgKiBVcGRhdGVzIGEgdXNlciBpbiBEQlMgYW5kIHRoZSBpZGVudGl0eSBzeXN0ZW0uICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eShyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPGFueT47XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHVzZXIgaWRlbnRpdHlcbiAgICAgKiBVcGRhdGVzIGEgdXNlciBpbiBEQlMgYW5kIHRoZSBpZGVudGl0eSBzeXN0ZW0uICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eShyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8YW55Pj47XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHVzZXIgaWRlbnRpdHlcbiAgICAgKiBVcGRhdGVzIGEgdXNlciBpbiBEQlMgYW5kIHRoZSBpZGVudGl0eSBzeXN0ZW0uICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgXFwmcXVvdDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZFxcJnF1b3Q7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eShyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cEV2ZW50PGFueT4+O1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB1c2VyIGlkZW50aXR5XG4gICAgICogVXBkYXRlcyBhIHVzZXIgaW4gREJTIGFuZCB0aGUgaWRlbnRpdHkgc3lzdGVtLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnIFxcJnF1b3Q7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWRcXCZxdW90OyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlSWRlbnRpdHkocmVxdWVzdFBhcmFtZXRlcnM6IFVwZGF0ZUlkZW50aXR5UmVxdWVzdFBhcmFtcywgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlSWRlbnRpdHkuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX3VwZGF0ZUlkZW50aXR5UmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1widXBkYXRlSWRlbnRpdHlSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX3VwZGF0ZUlkZW50aXR5UmVxdWVzdCA9PT0gbnVsbCB8fCBfdXBkYXRlSWRlbnRpdHlSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHVwZGF0ZUlkZW50aXR5UmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUlkZW50aXR5LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwSGVhZGVyQWNjZXB0O1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBDb250ZW50VHlwZVNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQ29udGVudFR5cGUoY29uc3VtZXMpO1xuICAgICAgICBpZiAoaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBodHRwQ29udGVudFR5cGVTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzcG9uc2VUeXBlOiAndGV4dCcgfCAnanNvbicgPSAnanNvbic7XG4gICAgICAgIGlmKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAmJiBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQuc3RhcnRzV2l0aCgndGV4dCcpKSB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGUgPSAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dDxhbnk+KGAke3RoaXMuY29uZmlndXJhdGlvbi5iYXNlUGF0aH0vY2xpZW50LWFwaS92Mi91c2Vycy9pZGVudGl0aWVzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhfaW50ZXJuYWxJZCkpfWAsXG4gICAgICAgICAgICBfdXBkYXRlSWRlbnRpdHlSZXF1ZXN0LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogPGFueT5yZXNwb25zZVR5cGUsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlSWRlbnRpdHlVcmwocmVxdWVzdFBhcmFtZXRlcnM6IFVwZGF0ZUlkZW50aXR5UmVxdWVzdFBhcmFtcyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IF9pbnRlcm5hbElkID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcm5hbElkXCJdO1xuICAgICAgICBpZiAoX2ludGVybmFsSWQgPT09IG51bGwgfHwgX2ludGVybmFsSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgaW50ZXJuYWxJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUlkZW50aXR5LicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IF91cGRhdGVJZGVudGl0eVJlcXVlc3QgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInVwZGF0ZUlkZW50aXR5UmVxdWVzdFwiXTtcbiAgICAgICAgaWYgKF91cGRhdGVJZGVudGl0eVJlcXVlc3QgPT09IG51bGwgfHwgX3VwZGF0ZUlkZW50aXR5UmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB1cGRhdGVJZGVudGl0eVJlcXVlc3Qgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVJZGVudGl0eS4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7dGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRofS9jbGllbnQtYXBpL3YyL3VzZXJzL2lkZW50aXRpZXMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKF9pbnRlcm5hbElkKSl9YDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgSWRlbnRpdHkgc3RhdHVzXG4gICAgICogVXBkYXRlcyB0aGUgc3RhdHVzIG9mIGEgdXNlciBkZWZpbmVkIGJ5IHRoZWlyIGludGVybmFsIElELiAgVGhpcyBlbmRwb2ludCByZXF1aXJlcyBkaWZmZXJlbnQgYXNzaWduZWQgJiN4NjA7QWNjZXNzIENvbnRyb2wmI3g2MDsgYnVzaW5lc3MgZnVuY3Rpb25zIGRlcGVuZGluZyBvbiB0aGUgY29udGV4dCBvZiB0aGUgcmVxdWVzdDogKiBUbyBjaGFuZ2UgYW4gaWRlbnRpdHkgc3RhdHVzIGZyb20gVW5sb2NrZWQgdG8gTG9ja2VkIHlvdSB3aWxsIG5lZWQgdGhlICYjeDYwO0xvY2sgVXNlciYjeDYwOyBmdW5jdGlvbiBhc3NpZ25lZC4gKiBUbyBjaGFuZ2UgYW4gaWRlbnRpdHkgc3RhdHVzIGZyb20gTG9ja2VkIHRvIFVubG9ja2VkIHlvdSB3aWxsIG5lZWQgdGhlICYjeDYwO1VubG9jayBVc2VyJiN4NjA7IGZ1bmN0aW9uIGFzc2lnbmVkLiAgQWxzbyB0aGlzIGVuZHBvaW50IHdpbGwgYmVoYXZlIGRpZmZlcmVudGx5IHdoZW4gJiN4NjA7YXBwcm92YWxzJiN4NjA7IGlzIGVuYWJsZWQgYW5kIGFuIGFwcHJvdmFsIHBvbGljeSBpcyBzZXQgdXAgZm9yIHRoZSAmI3g2MDtMb2NrJiN4NjA7IG9yICYjeDYwO1VubG9jayYjeDYwOyBvcGVyYXRpb25zLiAgV2hlbiBhcHByb3ZhbHMgaXMgZW5hYmxlZCBhbmQgYSB2YWxpZCBhcHByb3ZhbCBwb2xpY3kgaXMgc2V0IHVwLCB0aGlzIG9wZXJhdGlvbiB3aWxsIHJldHVybiBhIHN0YXR1cyBjb2RlIG9mICYjeDYwOzIwMiYjeDYwOyBhbmQgdGhlIHBlbmRpbmcgYXBwcm92YWwgSUQgaW4gdGhlIGJvZHkgcmVzcG9uc2UuICBOb3RlIHRoYXQgdG8gdXNlIHRoaXMgZW5kcG9pbnQsIHRoZSBmZWF0dXJlIGZsYWcgJiN4NjA7YmFja2Jhc2UudXNlcnMuaWRlbnRpdHktZW5kcG9pbnRzLWVuYWJsZWQmI3g2MDsgbXVzdCBiZSBzZXQgdG8gdHJ1ZS4gXG4gICAgICogQHBhcmFtIHJlcXVlc3RQYXJhbWV0ZXJzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZUlkZW50aXR5U3RhdHVzKHJlcXVlc3RQYXJhbWV0ZXJzOiBVcGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3RQYXJhbXMsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SWRlbnRpdHlTdGF0dXNBcHByb3ZhbFBlbmRpbmc+O1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBJZGVudGl0eSBzdGF0dXNcbiAgICAgKiBVcGRhdGVzIHRoZSBzdGF0dXMgb2YgYSB1c2VyIGRlZmluZWQgYnkgdGhlaXIgaW50ZXJuYWwgSUQuICBUaGlzIGVuZHBvaW50IHJlcXVpcmVzIGRpZmZlcmVudCBhc3NpZ25lZCAmI3g2MDtBY2Nlc3MgQ29udHJvbCYjeDYwOyBidXNpbmVzcyBmdW5jdGlvbnMgZGVwZW5kaW5nIG9uIHRoZSBjb250ZXh0IG9mIHRoZSByZXF1ZXN0OiAqIFRvIGNoYW5nZSBhbiBpZGVudGl0eSBzdGF0dXMgZnJvbSBVbmxvY2tlZCB0byBMb2NrZWQgeW91IHdpbGwgbmVlZCB0aGUgJiN4NjA7TG9jayBVc2VyJiN4NjA7IGZ1bmN0aW9uIGFzc2lnbmVkLiAqIFRvIGNoYW5nZSBhbiBpZGVudGl0eSBzdGF0dXMgZnJvbSBMb2NrZWQgdG8gVW5sb2NrZWQgeW91IHdpbGwgbmVlZCB0aGUgJiN4NjA7VW5sb2NrIFVzZXImI3g2MDsgZnVuY3Rpb24gYXNzaWduZWQuICBBbHNvIHRoaXMgZW5kcG9pbnQgd2lsbCBiZWhhdmUgZGlmZmVyZW50bHkgd2hlbiAmI3g2MDthcHByb3ZhbHMmI3g2MDsgaXMgZW5hYmxlZCBhbmQgYW4gYXBwcm92YWwgcG9saWN5IGlzIHNldCB1cCBmb3IgdGhlICYjeDYwO0xvY2smI3g2MDsgb3IgJiN4NjA7VW5sb2NrJiN4NjA7IG9wZXJhdGlvbnMuICBXaGVuIGFwcHJvdmFscyBpcyBlbmFibGVkIGFuZCBhIHZhbGlkIGFwcHJvdmFsIHBvbGljeSBpcyBzZXQgdXAsIHRoaXMgb3BlcmF0aW9uIHdpbGwgcmV0dXJuIGEgc3RhdHVzIGNvZGUgb2YgJiN4NjA7MjAyJiN4NjA7IGFuZCB0aGUgcGVuZGluZyBhcHByb3ZhbCBJRCBpbiB0aGUgYm9keSByZXNwb25zZS4gIE5vdGUgdGhhdCB0byB1c2UgdGhpcyBlbmRwb2ludCwgdGhlIGZlYXR1cmUgZmxhZyAmI3g2MDtiYWNrYmFzZS51c2Vycy5pZGVudGl0eS1lbmRwb2ludHMtZW5hYmxlZCYjeDYwOyBtdXN0IGJlIHNldCB0byB0cnVlLiBcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlSWRlbnRpdHlTdGF0dXMocmVxdWVzdFBhcmFtZXRlcnM6IFVwZGF0ZUlkZW50aXR5U3RhdHVzUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPElkZW50aXR5U3RhdHVzQXBwcm92YWxQZW5kaW5nPj47XG4gICAgLyoqXG4gICAgICogVXBkYXRlIElkZW50aXR5IHN0YXR1c1xuICAgICAqIFVwZGF0ZXMgdGhlIHN0YXR1cyBvZiBhIHVzZXIgZGVmaW5lZCBieSB0aGVpciBpbnRlcm5hbCBJRC4gIFRoaXMgZW5kcG9pbnQgcmVxdWlyZXMgZGlmZmVyZW50IGFzc2lnbmVkICYjeDYwO0FjY2VzcyBDb250cm9sJiN4NjA7IGJ1c2luZXNzIGZ1bmN0aW9ucyBkZXBlbmRpbmcgb24gdGhlIGNvbnRleHQgb2YgdGhlIHJlcXVlc3Q6ICogVG8gY2hhbmdlIGFuIGlkZW50aXR5IHN0YXR1cyBmcm9tIFVubG9ja2VkIHRvIExvY2tlZCB5b3Ugd2lsbCBuZWVkIHRoZSAmI3g2MDtMb2NrIFVzZXImI3g2MDsgZnVuY3Rpb24gYXNzaWduZWQuICogVG8gY2hhbmdlIGFuIGlkZW50aXR5IHN0YXR1cyBmcm9tIExvY2tlZCB0byBVbmxvY2tlZCB5b3Ugd2lsbCBuZWVkIHRoZSAmI3g2MDtVbmxvY2sgVXNlciYjeDYwOyBmdW5jdGlvbiBhc3NpZ25lZC4gIEFsc28gdGhpcyBlbmRwb2ludCB3aWxsIGJlaGF2ZSBkaWZmZXJlbnRseSB3aGVuICYjeDYwO2FwcHJvdmFscyYjeDYwOyBpcyBlbmFibGVkIGFuZCBhbiBhcHByb3ZhbCBwb2xpY3kgaXMgc2V0IHVwIGZvciB0aGUgJiN4NjA7TG9jayYjeDYwOyBvciAmI3g2MDtVbmxvY2smI3g2MDsgb3BlcmF0aW9ucy4gIFdoZW4gYXBwcm92YWxzIGlzIGVuYWJsZWQgYW5kIGEgdmFsaWQgYXBwcm92YWwgcG9saWN5IGlzIHNldCB1cCwgdGhpcyBvcGVyYXRpb24gd2lsbCByZXR1cm4gYSBzdGF0dXMgY29kZSBvZiAmI3g2MDsyMDImI3g2MDsgYW5kIHRoZSBwZW5kaW5nIGFwcHJvdmFsIElEIGluIHRoZSBib2R5IHJlc3BvbnNlLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnICYjeDYwO2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkJiN4NjA7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eVN0YXR1cyhyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cEV2ZW50PElkZW50aXR5U3RhdHVzQXBwcm92YWxQZW5kaW5nPj47XG4gICAgLyoqXG4gICAgICogVXBkYXRlIElkZW50aXR5IHN0YXR1c1xuICAgICAqIFVwZGF0ZXMgdGhlIHN0YXR1cyBvZiBhIHVzZXIgZGVmaW5lZCBieSB0aGVpciBpbnRlcm5hbCBJRC4gIFRoaXMgZW5kcG9pbnQgcmVxdWlyZXMgZGlmZmVyZW50IGFzc2lnbmVkICYjeDYwO0FjY2VzcyBDb250cm9sJiN4NjA7IGJ1c2luZXNzIGZ1bmN0aW9ucyBkZXBlbmRpbmcgb24gdGhlIGNvbnRleHQgb2YgdGhlIHJlcXVlc3Q6ICogVG8gY2hhbmdlIGFuIGlkZW50aXR5IHN0YXR1cyBmcm9tIFVubG9ja2VkIHRvIExvY2tlZCB5b3Ugd2lsbCBuZWVkIHRoZSAmI3g2MDtMb2NrIFVzZXImI3g2MDsgZnVuY3Rpb24gYXNzaWduZWQuICogVG8gY2hhbmdlIGFuIGlkZW50aXR5IHN0YXR1cyBmcm9tIExvY2tlZCB0byBVbmxvY2tlZCB5b3Ugd2lsbCBuZWVkIHRoZSAmI3g2MDtVbmxvY2sgVXNlciYjeDYwOyBmdW5jdGlvbiBhc3NpZ25lZC4gIEFsc28gdGhpcyBlbmRwb2ludCB3aWxsIGJlaGF2ZSBkaWZmZXJlbnRseSB3aGVuICYjeDYwO2FwcHJvdmFscyYjeDYwOyBpcyBlbmFibGVkIGFuZCBhbiBhcHByb3ZhbCBwb2xpY3kgaXMgc2V0IHVwIGZvciB0aGUgJiN4NjA7TG9jayYjeDYwOyBvciAmI3g2MDtVbmxvY2smI3g2MDsgb3BlcmF0aW9ucy4gIFdoZW4gYXBwcm92YWxzIGlzIGVuYWJsZWQgYW5kIGEgdmFsaWQgYXBwcm92YWwgcG9saWN5IGlzIHNldCB1cCwgdGhpcyBvcGVyYXRpb24gd2lsbCByZXR1cm4gYSBzdGF0dXMgY29kZSBvZiAmI3g2MDsyMDImI3g2MDsgYW5kIHRoZSBwZW5kaW5nIGFwcHJvdmFsIElEIGluIHRoZSBib2R5IHJlc3BvbnNlLiAgTm90ZSB0aGF0IHRvIHVzZSB0aGlzIGVuZHBvaW50LCB0aGUgZmVhdHVyZSBmbGFnICYjeDYwO2JhY2tiYXNlLnVzZXJzLmlkZW50aXR5LWVuZHBvaW50cy1lbmFibGVkJiN4NjA7IG11c3QgYmUgc2V0IHRvIHRydWUuIFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eVN0YXR1cyhyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UsIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCBfaW50ZXJuYWxJZCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiaW50ZXJuYWxJZFwiXTtcbiAgICAgICAgaWYgKF9pbnRlcm5hbElkID09PSBudWxsIHx8IF9pbnRlcm5hbElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGludGVybmFsSWQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVJZGVudGl0eVN0YXR1cy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfdXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0ID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJ1cGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3RcIl07XG4gICAgICAgIGlmIChfdXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0ID09PSBudWxsIHx8IF91cGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3QgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlSWRlbnRpdHlTdGF0dXMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gb3B0aW9ucyAmJiBvcHRpb25zLmh0dHBIZWFkZXJBY2NlcHQ7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJDb250ZW50VHlwZShjb25zdW1lcyk7XG4gICAgICAgIGlmIChodHRwQ29udGVudFR5cGVTZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0NvbnRlbnQtVHlwZScsIGh0dHBDb250ZW50VHlwZVNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByZXNwb25zZVR5cGU6ICd0ZXh0JyB8ICdqc29uJyA9ICdqc29uJztcbiAgICAgICAgaWYoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICYmIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZC5zdGFydHNXaXRoKCd0ZXh0JykpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZSA9ICd0ZXh0JztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0PElkZW50aXR5U3RhdHVzQXBwcm92YWxQZW5kaW5nPihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc3RhdHVzYCxcbiAgICAgICAgICAgIF91cGRhdGVJZGVudGl0eVN0YXR1c1JlcXVlc3QsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVJZGVudGl0eVN0YXR1c1VybChyZXF1ZXN0UGFyYW1ldGVyczogVXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2ludGVybmFsSWQgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVybmFsSWRcIl07XG4gICAgICAgIGlmIChfaW50ZXJuYWxJZCA9PT0gbnVsbCB8fCBfaW50ZXJuYWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBpbnRlcm5hbElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlSWRlbnRpdHlTdGF0dXMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX3VwZGF0ZUlkZW50aXR5U3RhdHVzUmVxdWVzdCA9IHJlcXVlc3RQYXJhbWV0ZXJzW1widXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0XCJdO1xuICAgICAgICBpZiAoX3VwZGF0ZUlkZW50aXR5U3RhdHVzUmVxdWVzdCA9PT0gbnVsbCB8fCBfdXBkYXRlSWRlbnRpdHlTdGF0dXNSZXF1ZXN0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHVwZGF0ZUlkZW50aXR5U3RhdHVzUmVxdWVzdCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUlkZW50aXR5U3RhdHVzLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvdXNlcnMvaWRlbnRpdGllcy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoX2ludGVybmFsSWQpKX0vc3RhdHVzYDtcbiAgICB9XG5cbn1cbiJdfQ==