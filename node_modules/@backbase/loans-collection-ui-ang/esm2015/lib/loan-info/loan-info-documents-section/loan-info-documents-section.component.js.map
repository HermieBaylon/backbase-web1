{"version":3,"file":"loan-info-documents-section.component.js","sourceRoot":"","sources":["../../../../../../../libs/loans-collection-ui-ang/src/lib/loan-info/loan-info-documents-section/loan-info-documents-section.component.ts","../../../../../../../libs/loans-collection-ui-ang/src/lib/loan-info/loan-info-documents-section/loan-info-documents-section.component.html"],"names":[],"mappings":"AAAA,OAAO,EAAE,uBAAuB,EAAE,SAAS,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAC1E,OAAO,wBAAwB,CAAC;AAEhC,OAAO,EAAE,gBAAgB,EAAgC,MAAM,0BAA0B,CAAC;;;;;;;;AAe1F,MAAM,OAAO,iCAAiC;IAc5C,YAA6B,gBAAkC;QAAlC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAb9C,wBAAmB,GAAG,SAAS,CAAA,kFAAkF,CAAC;IAajE,CAAC;IAZnE;;OAEG;IACH,IAAa,IAAI,CAAC,KAAW;QAC3B,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;IAClC,CAAC;IASD;;;;OAIG;IACH,iBAAiB,CAAC,EAAU;QAC1B,OAAO,yBAAyB,EAAE,EAAE,CAAC;IACvC,CAAC;IAED;;;;OAIG;IACK,mBAAmB,CAAC,IAAU;;QACpC,MAAM,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC;QACvB,IAAI,EAAE,GAAG,CAAC,CAAC;QAEX,IAAI,CAAC,aAAa,GAAG,MAAA,IAAI,CAAC,SAAS,0CAAE,MAAM,CAAqB,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,WAAW,EAAE,IAAI,EAAE,EAAE,EAAE;YAC3G,IAAI,UAAU,EAAE;gBACd,MAAM,kBAAkB,GAAG,WAAW,KAAK,iBAAiB,CAAC;gBAE7D,KAAK,CAAC,IAAI,CAAC;oBACT,IAAI,EAAE,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,EAAE,KAAI,GAAG,IAAI,CAAC,mBAAmB,IAAI,EAAE,EAAE,EAAE;oBAC3D,WAAW,EAAE,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,UAAU,CAAC;oBACxD,UAAU,EAAE,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS;iBAC/F,CAAC,CAAC;aACJ;YAED,OAAO,KAAK,CAAC;QACf,CAAC,EAAE,EAAE,CAAC,CAAC;IACT,CAAC;IAED;;;;OAIG;IACK,kBAAkB,CAAC,MAAc,EAAE,UAAkB,EAAE,MAAgB;QAC7E,OAAO,IAAI,CAAC,gBAAgB,CAAC,wCAAwC,CAAC;YACpE,MAAM;YACN,UAAU;YACV,MAAM;SACP,CAAC,CAAC;IACL,CAAC;;kJA5DU,iCAAiC;sIAAjC,iCAAiC,gGClB9C,i/DAiDA;4FD/Ba,iCAAiC;kBAL7C,SAAS;mBAAC;oBACT,QAAQ,EAAE,gCAAgC;oBAC1C,WAAW,EAAE,8CAA8C;oBAC3D,eAAe,EAAE,uBAAuB,CAAC,MAAM;iBAChD;uGAMc,IAAI;sBAAhB,KAAK","sourcesContent":["import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport '@angular/localize/init';\n\nimport { LoansHttpService, PresentationDocumentMetadata } from '@backbase/data-ang/loans';\n\nimport { LoanItemCustomBase } from '../loan-info.model';\nimport { Loan } from '../../models/loan.model';\n\nexport interface LoanInfoDocument extends Required<Omit<PresentationDocumentMetadata, 'documentId' | 'contentType'>> {\n  downloadUrl: string;\n  previewUrl?: string;\n}\n\n@Component({\n  selector: 'bb-loan-info-documents-section',\n  templateUrl: './loan-info-documents-section.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class LoanInfoDocumentsSectionComponent implements LoanItemCustomBase {\n  private readonly defaultDocumentName = $localize`:Loan info document default name@@loans.loan-info.document.default-name:Document`;\n  /**\n   * Loan item\n   */\n  @Input() set loan(value: Loan) {\n    this.updateLoanDocuments(value);\n  }\n\n  /**\n   * Collection of filtered loan documents\n   */\n  loanDocuments: LoanInfoDocument[] | undefined;\n\n  constructor(private readonly loansHttpService: LoansHttpService) {}\n\n  /**\n   * Document name tag id\n   *\n   * @param id\n   */\n  getDocumentNameId(id: number): string {\n    return `bb-loan-info-document-${id}`;\n  }\n\n  /**\n   * Updates loan documents collection\n   *\n   * @private\n   */\n  private updateLoanDocuments(loan: Loan): void {\n    const loanId = loan.id;\n    let id = 1;\n\n    this.loanDocuments = loan.documents?.reduce<LoanInfoDocument[]>((accum, { documentId, contentType, name }) => {\n      if (documentId) {\n        const isPreviewAvailable = contentType === 'application/pdf';\n\n        accum.push({\n          name: name?.trim() || `${this.defaultDocumentName} ${id++}`,\n          downloadUrl: this.getLoanDocumentUrl(loanId, documentId),\n          previewUrl: isPreviewAvailable ? this.getLoanDocumentUrl(loanId, documentId, true) : undefined,\n        });\n      }\n\n      return accum;\n    }, []);\n  }\n\n  /**\n   * Construct formatted url for preview or download\n   *\n   * @private\n   */\n  private getLoanDocumentUrl(loanId: string, documentId: string, inline?: boolean): string {\n    return this.loansHttpService.downloadDocumentByLoanIdAndDocumentIdUrl({\n      loanId,\n      documentId,\n      inline,\n    });\n  }\n}\n","<ul class=\"bb-list bb-list--no-separator bb-list--density-none\">\n  <li\n    *ngFor=\"let document of loanDocuments; let index = index\"\n    class=\"bb-list__item bb-stack bb-loans-loan-info-documents-section\"\n    [class.bb-loans-loan-info-documents-section--no-preview]=\"!document.previewUrl\"\n    data-role=\"loan-info-document\"\n  >\n    <bb-icon-ui class=\"bb-stack__item bb-stack__item--spacing-sm\" name=\"description\" color=\"neutral-dark\"></bb-icon-ui>\n    <bb-ellipsis-ui\n      [id]=\"getDocumentNameId(index)\"\n      class=\"bb-stack__item bb-stack__item--fill bb-loans-loan-info-documents-section__name\"\n      [text]=\"document.name\"\n      tooltipTriggers=\"hover click\"\n      data-role=\"loan-info-document__name\"\n    ></bb-ellipsis-ui>\n    <button\n      *ngIf=\"document.previewUrl as previewUrl\"\n      class=\"bb-stack__item d-print-none\"\n      bbButton\n      color=\"link\"\n      type=\"button\"\n      [circle]=\"true\"\n      [bbLoanInfoCustomLink]=\"previewUrl\"\n      bbLoanInfoCustomLinkTarget=\"_blank\"\n      [attr.aria-describedby]=\"getDocumentNameId(index)\"\n      i18n-aria-label=\"Loan info preview document button aria label@@loans.loan-info.preview-document.button.aria-label\"\n      aria-label=\"View online\"\n      data-role=\"loan-info-document__preview-btn\"\n    >\n      <bb-icon-ui name=\"open-in-new\"></bb-icon-ui>\n    </button>\n    <button\n      class=\"bb-stack__item d-print-none\"\n      bbButton\n      color=\"link\"\n      type=\"button\"\n      [circle]=\"true\"\n      [bbLoanInfoCustomLink]=\"document.downloadUrl\"\n      [bbLoanInfoCustomLinkDownloadName]=\"document.name\"\n      [attr.aria-describedby]=\"getDocumentNameId(index)\"\n      i18n-aria-label=\"\n        Loan info download document button aria label@@loans.loan-info.download-document.button.aria-label\"\n      aria-label=\"Download\"\n      data-role=\"loan-info-document__download-btn\"\n    >\n      <bb-icon-ui name=\"get-app\"></bb-icon-ui>\n    </button>\n  </li>\n</ul>\n"]}