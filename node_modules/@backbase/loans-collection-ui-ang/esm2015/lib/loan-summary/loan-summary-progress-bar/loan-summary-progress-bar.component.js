import { ChangeDetectionStrategy, Component } from '@angular/core';
import BigNumber from 'bignumber.js';
import { LoanConfigBaseComponent } from '../../base/loan-config-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../loan-summary-amount-item/loan-summary-amount-item.component";
import * as i2 from "@backbase/ui-ang/progressbar";
import * as i3 from "@angular/common";
export class LoanSummaryProgressBarComponent extends LoanConfigBaseComponent {
    constructor() {
        super(...arguments);
        /**
         * Percentage value for progress bar
         */
        this.progressPercentage = NaN;
        /**
         * Progress type for progress bar
         */
        this.progressType = 'primary';
        /**
         * Flag represents progress bar visibility
         */
        this.isProgressBarVisible = false;
    }
    ngOnChanges() {
        this.updateProperties();
    }
    // TODO move to config logic
    updateProperties() {
        this.activeAmount = this.loan[this.dataConfig.activeAmount.fieldKey];
        this.totalAmount = this.loan[this.dataConfig.totalAmount.fieldKey];
        if (this.activeAmount && this.totalAmount) {
            const totalAmount = new BigNumber(this.totalAmount);
            const activeAmount = new BigNumber(this.activeAmount);
            this.progressPercentage =
                totalAmount.isLessThanOrEqualTo(0) || activeAmount.isLessThan(0)
                    ? NaN
                    : Math.floor(activeAmount.div(totalAmount).toNumber() * 100);
        }
        else {
            this.progressPercentage = NaN;
        }
        this.progressType = this.progressPercentage >= 100 ? 'success' : 'primary';
        const showProgressBar = this.dataConfig.showProgressBar ? this.dataConfig.showProgressBar(this.loan) : true;
        this.isProgressBarVisible = !isNaN(this.progressPercentage) && showProgressBar;
    }
}
/** @nocollapse */ LoanSummaryProgressBarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LoanSummaryProgressBarComponent, deps: null, target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ LoanSummaryProgressBarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: LoanSummaryProgressBarComponent, selector: "bb-loan-summary-progress-bar", usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<div class=\"bb-loans-summary-progress\">\n  <div class=\"row no-gutters bb-block bb-block--sm bb-loans-summary-progress__legend-wrapper\">\n    <div class=\"col-12 col-sm-9\">\n      <div class=\"row no-gutters\" *ngIf=\"loan.currencyCode as currencyCode\">\n        <div *ngIf=\"activeAmount\" class=\"col-12 col-md-6 bb-block bb-block--md\">\n          <div\n            [ngClass]=\"{\n              'bb-loans-summary-progress__legend-item': isProgressBarVisible,\n              'bb-loans-summary-progress__legend-item--success': isProgressBarVisible && progressType === 'success',\n              'bb-loans-summary-progress__legend-item--active': isProgressBarVisible && progressType === 'primary'\n            }\"\n            data-role=\"loan-summary-progress__active-wrapper\"\n          >\n            <bb-loan-summary-amount-item\n              [amount]=\"activeAmount\"\n              [currency]=\"currencyCode\"\n              [title]=\"dataConfig.activeAmount.title\"\n              titleClasses=\"bb-text-support\"\n              data-role=\"loan-summary-progress__active\"\n            >\n            </bb-loan-summary-amount-item>\n          </div>\n        </div>\n        <div *ngIf=\"totalAmount\" class=\"col-12 col-md-6 bb-block bb-block--md\">\n          <div\n            [class.bb-loans-summary-progress__legend-item]=\"isProgressBarVisible\"\n            data-role=\"loan-summary-progress__total-wrapper\"\n          >\n            <bb-loan-summary-amount-item\n              [amount]=\"totalAmount\"\n              [currency]=\"currencyCode\"\n              [title]=\"dataConfig.totalAmount.title\"\n              titleClasses=\"bb-text-support\"\n              data-role=\"loan-summary-progress__total\"\n            >\n            </bb-loan-summary-amount-item>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"col-12 col-sm-3\">\n      <ng-content></ng-content>\n    </div>\n  </div>\n  <div *ngIf=\"isProgressBarVisible && loan.currencyCode\" class=\"row no-gutters bb-block bb-block--md\">\n    <div class=\"col-12\">\n      <bb-progressbar-ui\n        class=\"bb-loans-summary-progress__progressbar\"\n        [animated]=\"true\"\n        [max]=\"100\"\n        [value]=\"progressPercentage\"\n        [type]=\"progressType\"\n        data-role=\"loan-summary-progress__progressbar\"\n      >\n      </bb-progressbar-ui>\n    </div>\n  </div>\n</div>\n", components: [{ type: i1.LoanSummaryAmountItemComponent, selector: "bb-loan-summary-amount-item", inputs: ["title", "amount", "currency", "isCurrencySymbolUsed", "showPercent", "titleClasses", "amountClasses", "totalAmount", "showLabel"] }, { type: i2.ProgressbarComponent, selector: "bb-progressbar-ui", inputs: ["height", "max", "showValue", "striped", "animated", "type", "value"] }], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LoanSummaryProgressBarComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-loan-summary-progress-bar',
                    templateUrl: './loan-summary-progress-bar.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }] });
//# sourceMappingURL=loan-summary-progress-bar.component.js.map