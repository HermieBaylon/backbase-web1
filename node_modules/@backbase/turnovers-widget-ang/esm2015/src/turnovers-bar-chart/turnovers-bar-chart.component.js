import { Component, Directive, Input, ViewChild } from '@angular/core';
import { BbTemplate } from '@backbase/foundation-ang/core';
import { CssVariablesService } from '@backbase/ui-ang/css-variables-lib';
import { from } from 'rxjs';
import { map } from 'rxjs/operators';
import { BAR_COLORS_CSS_VAR, CHART_COLORS, MOBILE_WIDGET_WIDTH } from '../constants';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@backbase/ui-ang/css-variables-lib";
import * as i3 from "../turnovers-vertical-grouped-bar-chart/turnovers-vertical-grouped-bar-chart.component";
import * as i4 from "../bb-turnovers-legend/bb-turnovers-legend.component";
import * as i5 from "@backbase/ui-ang/amount";
export class TurnoversBarChartComponent {
    constructor(currencyPipe, cssVariableService) {
        this.currencyPipe = currencyPipe;
        this.cssVariableService = cssVariableService;
        /**
         * Array of Chart data objects needed for the chart to be rendered.
         */
        this.chartSeriesData = [];
        /**
         * Disable/enable the forecast option on the chart.
         */
        this.forecast = false;
        // bar chart
        // options
        this.chartOptions = from(this.cssVariableService.getCssVariable(BAR_COLORS_CSS_VAR)).pipe(map((cssVar) => ({
            colors: cssVar ? cssVar.split(',') : CHART_COLORS,
            showXAxis: true,
            showYAxis: true,
            gradient: false,
            showLegend: false,
            showXAxisLabel: true,
            showYAxisLabel: true,
        })));
    }
    yAxisTickFormatting(value) {
        const currency = this.chartSeriesData[0].currency;
        if (this.barChart2d && this.barChart2d.width < MOBILE_WIDGET_WIDTH) {
            const amountVal = value / 1000;
            if (amountVal <= 999) {
                return `${this.currencyPipe.transform(amountVal, currency, 'symbol', '1.0')}k`;
            }
            return `${this.currencyPipe.transform(amountVal / 1000, currency, 'symbol', '1.0')}m`;
        }
        return this.currencyPipe.transform(value, currency, 'symbol', '1.0');
    }
}
TurnoversBarChartComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversBarChartComponent, deps: [{ token: i1.CurrencyPipe }, { token: i2.CssVariablesService }], target: i0.ɵɵFactoryTarget.Component });
TurnoversBarChartComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: TurnoversBarChartComponent, selector: "bb-turnovers-bar-chart", inputs: { chartSeriesData: "chartSeriesData", forecast: "forecast" }, providers: [CssVariablesService], viewQueries: [{ propertyName: "barChart2d", first: true, predicate: ["bbChartsBarVertical2d"], descendants: true }], ngImport: i0, template: "<div class=\"position-relative pb-25p pb-md-50p\">\n  <ng-container *ngIf=\"this.chartOptions | async as options\">\n    <ng-container\n      bbTurnoversVerticalGroupedBarChartCustomizable\n      [bbHostRef]=\"this\"\n      [bbTemplateContext]=\"{options: options}\"\n    ></ng-container>\n    <ng-container\n      bbTurnoversVerticalStackedBarChartCustomizable\n      [bbHostRef]=\"this\"\n      [bbTemplateContext]=\"{options: options}\"\n    ></ng-container>\n  </ng-container>\n</div>\n\n<ng-template bbTurnoversVerticalGroupedBarChartCustomizable let-hostRef let-options=\"context.options\">\n  <div class=\"bb-turnovers-vertical-chart\">\n    <bb-charts-bar-vertical-2d\n      #bbChartsBarVertical2d\n      class=\"position-static transform-none\"\n      [scheme]=\"{ domain: options.colors }\"\n      [results]=\"hostRef.chartSeriesData\"\n      [groupsData]=\"hostRef.chartSeriesData\"\n      [xAxis]=\"options.showXAxis\"\n      [yAxis]=\"options.showYAxis\"\n      [showXAxisLabel]=\"options.showXAxisLabel\"\n      [showYAxisLabel]=\"options.showYAxisLabel\"\n      [legend]=\"options.showLegend\"\n      [gradient]=\"options.gradient\"\n      [barPadding]=\"0\"\n      [groupPadding]=\"6\"\n      [roundEdges]=\"true\"\n      [legendTemplate]=\"legendTemplate\"\n      [tooltipTemplate]=\"tooltipTemplate\"\n      [yAxisTickFormatting]=\"yAxisTickFormatting.bind(this)\">\n    </bb-charts-bar-vertical-2d>\n  </div>\n</ng-template>\n\n<ng-template bbTurnoversVerticalStackedBarChartCustomizable let-hostRef let-options=\"context.options\">\n</ng-template>\n\n<ng-template bbTurnoversChartLegendCustomizable #legendTemplate\n  let-legendOptions=\"legendOptions\"\n  let-activeEntries=\"activeEntries\"\n  let-height=\"height\"\n  let-onActivate=\"onActivate\"\n  let-onDeactivate=\"onDeactivate\"\n  let-onClick=\"onClick\">\n  <bb-charts-legend\n    class=\"chart-legend\"\n    [data]=\"legendOptions.domain\"\n    [title]=\"legendOptions.title\"\n    [colors]=\"legendOptions.colors\"\n    [height]=\"height\"\n    [activeEntries]=\"activeEntries\"\n    (labelClick)=\"onClick($event)\"\n    (labelActivate)=\"onActivate($event)\"\n    (labelDeactivate)=\"onDeactivate($event)\">\n  </bb-charts-legend>\n</ng-template>\n\n<ng-template bbTurnoversChartTooltipCustomizable #tooltipTemplate let-model=\"model\">\n  <div class=\"chart-tooltip-default bb-arrow-bottom text-dark\">\n    <div\n      *ngIf=\"model.badge\"\n      class=\"pb-1 mb-2 font-weight-bold border-bottom border-dark text-capitalize text-left\">\n      {{model.badge}}\n    </div>\n    <div>\n      <div class=\"d-flex pb-1 align-items-center\" *ngFor=\"let bar of model.series; let i = index\">\n        <span [ngStyle]=\"{'color': bar.color}\" class=\"bicon bicon-circle\"></span>\n        <span class=\"text-capitalize\">{{bar.name}}</span>\n        <span class=\"ml-auto font-weight-bold\">\n          <bb-amount-ui\n            [amount]=\"i === 0 ? bar.value : (-bar.value)\"\n            [currency]=\"bar.currency\"\n            [showPlusSign]=\"i === 0 && bar.value > 0\"\n          ></bb-amount-ui>\n        </span>\n      </div>\n      <div class=\"d-flex pt-1 pl-1 align-items-center\">\n        <span i18n=\"Difference|tooltip difference label@@turnovers.tooltip.diff\">Difference</span>\n        <span class=\"ml-auto font-weight-bold\">\n          <bb-amount-ui\n            [amount]=\"model.diff\"\n            [currency]=\"model.currency\"\n            [showPlusSign]=\"model.diff !== 0\"\n          ></bb-amount-ui>\n        </span>\n      </div>\n    </div>\n  </div>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i3.TurnoversVerticalGroupedBarChartComponent; }), selector: "bb-charts-bar-vertical-2d", inputs: ["scaleType", "groupPadding", "results"] }, { type: i0.forwardRef(function () { return i4.BbTurnoversLegendComponent; }), selector: "bb-charts-legend", inputs: ["data", "title", "colors", "height", "width", "activeEntries"], outputs: ["labelClick", "labelActivate", "labelDeactivate"] }, { type: i0.forwardRef(function () { return i5.AmountComponent; }), selector: "bb-amount-ui", inputs: ["currency", "showPlusSign", "mapCurrency", "showPercent", "abbreviate", "decimalPlaces", "trailingZeroes", "amount"] }], directives: [{ type: i0.forwardRef(function () { return i1.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return TurnoversVerticalGroupedBarChartCustomizableDirective; }), selector: "[bbTurnoversVerticalGroupedBarChartCustomizable]" }, { type: i0.forwardRef(function () { return TurnoversVerticalStackedBarChartCustomizableDirective; }), selector: "[bbTurnoversVerticalStackedBarChartCustomizable]" }, { type: i0.forwardRef(function () { return TurnoversChartLegendCustomizableDirective; }), selector: "[bbTurnoversChartLegendCustomizable]" }, { type: i0.forwardRef(function () { return TurnoversChartTooltipCustomizableDirective; }), selector: "[bbTurnoversChartTooltipCustomizable]" }, { type: i0.forwardRef(function () { return i1.NgForOf; }), selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i0.forwardRef(function () { return i1.NgStyle; }), selector: "[ngStyle]", inputs: ["ngStyle"] }], pipes: { "async": i0.forwardRef(function () { return i1.AsyncPipe; }) } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversBarChartComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-turnovers-bar-chart',
                    templateUrl: './turnovers-bar-chart.component.html',
                    providers: [CssVariablesService],
                }]
        }], ctorParameters: function () { return [{ type: i1.CurrencyPipe }, { type: i2.CssVariablesService }]; }, propDecorators: { barChart2d: [{
                type: ViewChild,
                args: ['bbChartsBarVertical2d']
            }], chartSeriesData: [{
                type: Input
            }], forecast: [{
                type: Input
            }] } });
export class TurnoversChartTooltipCustomizableDirective extends BbTemplate {
}
TurnoversChartTooltipCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversChartTooltipCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
TurnoversChartTooltipCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: TurnoversChartTooltipCustomizableDirective, selector: "[bbTurnoversChartTooltipCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversChartTooltipCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbTurnoversChartTooltipCustomizable]',
                }]
        }] });
export class TurnoversChartLegendCustomizableDirective extends BbTemplate {
}
TurnoversChartLegendCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversChartLegendCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
TurnoversChartLegendCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: TurnoversChartLegendCustomizableDirective, selector: "[bbTurnoversChartLegendCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversChartLegendCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbTurnoversChartLegendCustomizable]',
                }]
        }] });
export class TurnoversVerticalGroupedBarChartCustomizableDirective extends BbTemplate {
}
TurnoversVerticalGroupedBarChartCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversVerticalGroupedBarChartCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
TurnoversVerticalGroupedBarChartCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: TurnoversVerticalGroupedBarChartCustomizableDirective, selector: "[bbTurnoversVerticalGroupedBarChartCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversVerticalGroupedBarChartCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbTurnoversVerticalGroupedBarChartCustomizable]',
                }]
        }] });
export class TurnoversVerticalStackedBarChartCustomizableDirective extends BbTemplate {
}
TurnoversVerticalStackedBarChartCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversVerticalStackedBarChartCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
TurnoversVerticalStackedBarChartCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.16", type: TurnoversVerticalStackedBarChartCustomizableDirective, selector: "[bbTurnoversVerticalStackedBarChartCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: TurnoversVerticalStackedBarChartCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbTurnoversVerticalStackedBarChartCustomizable]',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHVybm92ZXJzLWJhci1jaGFydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL3R1cm5vdmVycy13aWRnZXQvc3JjL3R1cm5vdmVycy1iYXItY2hhcnQvdHVybm92ZXJzLWJhci1jaGFydC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL3R1cm5vdmVycy13aWRnZXQvc3JjL3R1cm5vdmVycy1iYXItY2hhcnQvdHVybm92ZXJzLWJhci1jaGFydC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUV6RSxPQUFPLEVBQUUsSUFBSSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsWUFBWSxFQUFFLG1CQUFtQixFQUFFLE1BQU0sY0FBYyxDQUFDOzs7Ozs7O0FBUXJGLE1BQU0sT0FBTywwQkFBMEI7SUEwQnJDLFlBQTZCLFlBQTBCLEVBQW1CLGtCQUF1QztRQUFwRixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFtQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQXFCO1FBdkJqSDs7V0FFRztRQUNNLG9CQUFlLEdBQWdCLEVBQUUsQ0FBQztRQUMzQzs7V0FFRztRQUNNLGFBQVEsR0FBSSxLQUFLLENBQUM7UUFDM0IsWUFBWTtRQUVaLFVBQVU7UUFDRCxpQkFBWSxHQUFtQixJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUMzRyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDZixNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZO1lBQ2pELFNBQVMsRUFBRSxJQUFJO1lBQ2YsU0FBUyxFQUFFLElBQUk7WUFDZixRQUFRLEVBQUUsS0FBSztZQUNmLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLGNBQWMsRUFBRSxJQUFJO1NBQ3JCLENBQUMsQ0FBQyxDQUNKLENBQUM7SUFFa0gsQ0FBQztJQUVySCxtQkFBbUIsQ0FBQyxLQUFhO1FBQy9CLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBRWxELElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxtQkFBbUIsRUFBRTtZQUNsRSxNQUFNLFNBQVMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBRS9CLElBQUksU0FBUyxJQUFJLEdBQUcsRUFBRTtnQkFDcEIsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDaEY7WUFFRCxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUM7U0FDdkY7UUFFRCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7O3dIQTFDVSwwQkFBMEI7NEdBQTFCLDBCQUEwQix1SEFGMUIsQ0FBQyxtQkFBbUIsQ0FBQywrSUNibEMsKy9HQThGQSwwMEJEckJhLHFEQUFxRCxpSEFRckQscURBQXFELGlIQWJyRCx5Q0FBeUMscUdBTHpDLDBDQUEwQzs0RkFoRDFDLDBCQUEwQjtrQkFMdEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsd0JBQXdCO29CQUNsQyxXQUFXLEVBQUUsc0NBQXNDO29CQUNuRCxTQUFTLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztpQkFDakM7cUlBRXFDLFVBQVU7c0JBQTdDLFNBQVM7dUJBQUMsdUJBQXVCO2dCQUt6QixlQUFlO3NCQUF2QixLQUFLO2dCQUlHLFFBQVE7c0JBQWhCLEtBQUs7O0FBc0NSLE1BQU0sT0FBTywwQ0FBMkMsU0FBUSxVQUFpRDs7d0lBQXBHLDBDQUEwQzs0SEFBMUMsMENBQTBDOzRGQUExQywwQ0FBMEM7a0JBSHRELFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHVDQUF1QztpQkFDbEQ7O0FBTUQsTUFBTSxPQUFPLHlDQUEwQyxTQUFRLFVBQWlEOzt1SUFBbkcseUNBQXlDOzJIQUF6Qyx5Q0FBeUM7NEZBQXpDLHlDQUF5QztrQkFIckQsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsc0NBQXNDO2lCQUNqRDs7QUFNRCxNQUFNLE9BQU8scURBQXNELFNBQVEsVUFHMUU7O21KQUhZLHFEQUFxRDt1SUFBckQscURBQXFEOzRGQUFyRCxxREFBcUQ7a0JBSGpFLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGtEQUFrRDtpQkFDN0Q7O0FBU0QsTUFBTSxPQUFPLHFEQUFzRCxTQUFRLFVBRzFFOzttSkFIWSxxREFBcUQ7dUlBQXJELHFEQUFxRDs0RkFBckQscURBQXFEO2tCQUhqRSxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxrREFBa0Q7aUJBQzdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ3VycmVuY3lQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgRGlyZWN0aXZlLCBJbnB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCYlRlbXBsYXRlIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgQ3NzVmFyaWFibGVzU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvY3NzLXZhcmlhYmxlcy1saWInO1xuaW1wb3J0IHsgQmFyQ29tcG9uZW50IH0gZnJvbSAnQHN3aW1sYW5lL25neC1jaGFydHMnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQkFSX0NPTE9SU19DU1NfVkFSLCBDSEFSVF9DT0xPUlMsIE1PQklMRV9XSURHRVRfV0lEVEggfSBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgQ2hhcnREYXRhIH0gZnJvbSAnLi4vbW9kZWwvdHVybm92ZXJzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItdHVybm92ZXJzLWJhci1jaGFydCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90dXJub3ZlcnMtYmFyLWNoYXJ0LmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbQ3NzVmFyaWFibGVzU2VydmljZV0sXG59KVxuZXhwb3J0IGNsYXNzIFR1cm5vdmVyc0JhckNoYXJ0Q29tcG9uZW50IHtcbiAgQFZpZXdDaGlsZCgnYmJDaGFydHNCYXJWZXJ0aWNhbDJkJykgYmFyQ2hhcnQyZDogQmFyQ29tcG9uZW50IHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBBcnJheSBvZiBDaGFydCBkYXRhIG9iamVjdHMgbmVlZGVkIGZvciB0aGUgY2hhcnQgdG8gYmUgcmVuZGVyZWQuXG4gICAqL1xuICBASW5wdXQoKSBjaGFydFNlcmllc0RhdGE6IENoYXJ0RGF0YVtdID0gW107XG4gIC8qKlxuICAgKiBEaXNhYmxlL2VuYWJsZSB0aGUgZm9yZWNhc3Qgb3B0aW9uIG9uIHRoZSBjaGFydC5cbiAgICovXG4gIEBJbnB1dCgpIGZvcmVjYXN0PyA9IGZhbHNlO1xuICAvLyBiYXIgY2hhcnRcblxuICAvLyBvcHRpb25zXG4gIHJlYWRvbmx5IGNoYXJ0T3B0aW9uczogT2JzZXJ2YWJsZTx7fT4gPSBmcm9tKHRoaXMuY3NzVmFyaWFibGVTZXJ2aWNlLmdldENzc1ZhcmlhYmxlKEJBUl9DT0xPUlNfQ1NTX1ZBUikpLnBpcGUoXG4gICAgbWFwKChjc3NWYXIpID0+ICh7XG4gICAgICBjb2xvcnM6IGNzc1ZhciA/IGNzc1Zhci5zcGxpdCgnLCcpIDogQ0hBUlRfQ09MT1JTLFxuICAgICAgc2hvd1hBeGlzOiB0cnVlLFxuICAgICAgc2hvd1lBeGlzOiB0cnVlLFxuICAgICAgZ3JhZGllbnQ6IGZhbHNlLFxuICAgICAgc2hvd0xlZ2VuZDogZmFsc2UsXG4gICAgICBzaG93WEF4aXNMYWJlbDogdHJ1ZSxcbiAgICAgIHNob3dZQXhpc0xhYmVsOiB0cnVlLFxuICAgIH0pKSxcbiAgKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGN1cnJlbmN5UGlwZTogQ3VycmVuY3lQaXBlLCBwcml2YXRlIHJlYWRvbmx5IGNzc1ZhcmlhYmxlU2VydmljZTogQ3NzVmFyaWFibGVzU2VydmljZSkge31cblxuICB5QXhpc1RpY2tGb3JtYXR0aW5nKHZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBjdXJyZW5jeSA9IHRoaXMuY2hhcnRTZXJpZXNEYXRhWzBdLmN1cnJlbmN5O1xuXG4gICAgaWYgKHRoaXMuYmFyQ2hhcnQyZCAmJiB0aGlzLmJhckNoYXJ0MmQud2lkdGggPCBNT0JJTEVfV0lER0VUX1dJRFRIKSB7XG4gICAgICBjb25zdCBhbW91bnRWYWwgPSB2YWx1ZSAvIDEwMDA7XG5cbiAgICAgIGlmIChhbW91bnRWYWwgPD0gOTk5KSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmN1cnJlbmN5UGlwZS50cmFuc2Zvcm0oYW1vdW50VmFsLCBjdXJyZW5jeSwgJ3N5bWJvbCcsICcxLjAnKX1rYDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGAke3RoaXMuY3VycmVuY3lQaXBlLnRyYW5zZm9ybShhbW91bnRWYWwgLyAxMDAwLCBjdXJyZW5jeSwgJ3N5bWJvbCcsICcxLjAnKX1tYDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jdXJyZW5jeVBpcGUudHJhbnNmb3JtKHZhbHVlLCBjdXJyZW5jeSwgJ3N5bWJvbCcsICcxLjAnKTtcbiAgfVxufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYmJUdXJub3ZlcnNDaGFydFRvb2x0aXBDdXN0b21pemFibGVdJyxcbn0pXG5leHBvcnQgY2xhc3MgVHVybm92ZXJzQ2hhcnRUb29sdGlwQ3VzdG9taXphYmxlRGlyZWN0aXZlIGV4dGVuZHMgQmJUZW1wbGF0ZTxUdXJub3ZlcnNCYXJDaGFydENvbXBvbmVudCwgdW5kZWZpbmVkPiB7fVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYmJUdXJub3ZlcnNDaGFydExlZ2VuZEN1c3RvbWl6YWJsZV0nLFxufSlcbmV4cG9ydCBjbGFzcyBUdXJub3ZlcnNDaGFydExlZ2VuZEN1c3RvbWl6YWJsZURpcmVjdGl2ZSBleHRlbmRzIEJiVGVtcGxhdGU8VHVybm92ZXJzQmFyQ2hhcnRDb21wb25lbnQsIHVuZGVmaW5lZD4ge31cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2JiVHVybm92ZXJzVmVydGljYWxHcm91cGVkQmFyQ2hhcnRDdXN0b21pemFibGVdJyxcbn0pXG5leHBvcnQgY2xhc3MgVHVybm92ZXJzVmVydGljYWxHcm91cGVkQmFyQ2hhcnRDdXN0b21pemFibGVEaXJlY3RpdmUgZXh0ZW5kcyBCYlRlbXBsYXRlPFxuICBUdXJub3ZlcnNCYXJDaGFydENvbXBvbmVudCxcbiAgdW5kZWZpbmVkXG4+IHt9XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tiYlR1cm5vdmVyc1ZlcnRpY2FsU3RhY2tlZEJhckNoYXJ0Q3VzdG9taXphYmxlXScsXG59KVxuZXhwb3J0IGNsYXNzIFR1cm5vdmVyc1ZlcnRpY2FsU3RhY2tlZEJhckNoYXJ0Q3VzdG9taXphYmxlRGlyZWN0aXZlIGV4dGVuZHMgQmJUZW1wbGF0ZTxcbiAgVHVybm92ZXJzQmFyQ2hhcnRDb21wb25lbnQsXG4gIHVuZGVmaW5lZFxuPiB7fVxuIiwiPGRpdiBjbGFzcz1cInBvc2l0aW9uLXJlbGF0aXZlIHBiLTI1cCBwYi1tZC01MHBcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRoaXMuY2hhcnRPcHRpb25zIHwgYXN5bmMgYXMgb3B0aW9uc1wiPlxuICAgIDxuZy1jb250YWluZXJcbiAgICAgIGJiVHVybm92ZXJzVmVydGljYWxHcm91cGVkQmFyQ2hhcnRDdXN0b21pemFibGVcbiAgICAgIFtiYkhvc3RSZWZdPVwidGhpc1wiXG4gICAgICBbYmJUZW1wbGF0ZUNvbnRleHRdPVwie29wdGlvbnM6IG9wdGlvbnN9XCJcbiAgICA+PC9uZy1jb250YWluZXI+XG4gICAgPG5nLWNvbnRhaW5lclxuICAgICAgYmJUdXJub3ZlcnNWZXJ0aWNhbFN0YWNrZWRCYXJDaGFydEN1c3RvbWl6YWJsZVxuICAgICAgW2JiSG9zdFJlZl09XCJ0aGlzXCJcbiAgICAgIFtiYlRlbXBsYXRlQ29udGV4dF09XCJ7b3B0aW9uczogb3B0aW9uc31cIlxuICAgID48L25nLWNvbnRhaW5lcj5cbiAgPC9uZy1jb250YWluZXI+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlIGJiVHVybm92ZXJzVmVydGljYWxHcm91cGVkQmFyQ2hhcnRDdXN0b21pemFibGUgbGV0LWhvc3RSZWYgbGV0LW9wdGlvbnM9XCJjb250ZXh0Lm9wdGlvbnNcIj5cbiAgPGRpdiBjbGFzcz1cImJiLXR1cm5vdmVycy12ZXJ0aWNhbC1jaGFydFwiPlxuICAgIDxiYi1jaGFydHMtYmFyLXZlcnRpY2FsLTJkXG4gICAgICAjYmJDaGFydHNCYXJWZXJ0aWNhbDJkXG4gICAgICBjbGFzcz1cInBvc2l0aW9uLXN0YXRpYyB0cmFuc2Zvcm0tbm9uZVwiXG4gICAgICBbc2NoZW1lXT1cInsgZG9tYWluOiBvcHRpb25zLmNvbG9ycyB9XCJcbiAgICAgIFtyZXN1bHRzXT1cImhvc3RSZWYuY2hhcnRTZXJpZXNEYXRhXCJcbiAgICAgIFtncm91cHNEYXRhXT1cImhvc3RSZWYuY2hhcnRTZXJpZXNEYXRhXCJcbiAgICAgIFt4QXhpc109XCJvcHRpb25zLnNob3dYQXhpc1wiXG4gICAgICBbeUF4aXNdPVwib3B0aW9ucy5zaG93WUF4aXNcIlxuICAgICAgW3Nob3dYQXhpc0xhYmVsXT1cIm9wdGlvbnMuc2hvd1hBeGlzTGFiZWxcIlxuICAgICAgW3Nob3dZQXhpc0xhYmVsXT1cIm9wdGlvbnMuc2hvd1lBeGlzTGFiZWxcIlxuICAgICAgW2xlZ2VuZF09XCJvcHRpb25zLnNob3dMZWdlbmRcIlxuICAgICAgW2dyYWRpZW50XT1cIm9wdGlvbnMuZ3JhZGllbnRcIlxuICAgICAgW2JhclBhZGRpbmddPVwiMFwiXG4gICAgICBbZ3JvdXBQYWRkaW5nXT1cIjZcIlxuICAgICAgW3JvdW5kRWRnZXNdPVwidHJ1ZVwiXG4gICAgICBbbGVnZW5kVGVtcGxhdGVdPVwibGVnZW5kVGVtcGxhdGVcIlxuICAgICAgW3Rvb2x0aXBUZW1wbGF0ZV09XCJ0b29sdGlwVGVtcGxhdGVcIlxuICAgICAgW3lBeGlzVGlja0Zvcm1hdHRpbmddPVwieUF4aXNUaWNrRm9ybWF0dGluZy5iaW5kKHRoaXMpXCI+XG4gICAgPC9iYi1jaGFydHMtYmFyLXZlcnRpY2FsLTJkPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSBiYlR1cm5vdmVyc1ZlcnRpY2FsU3RhY2tlZEJhckNoYXJ0Q3VzdG9taXphYmxlIGxldC1ob3N0UmVmIGxldC1vcHRpb25zPVwiY29udGV4dC5vcHRpb25zXCI+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgYmJUdXJub3ZlcnNDaGFydExlZ2VuZEN1c3RvbWl6YWJsZSAjbGVnZW5kVGVtcGxhdGVcbiAgbGV0LWxlZ2VuZE9wdGlvbnM9XCJsZWdlbmRPcHRpb25zXCJcbiAgbGV0LWFjdGl2ZUVudHJpZXM9XCJhY3RpdmVFbnRyaWVzXCJcbiAgbGV0LWhlaWdodD1cImhlaWdodFwiXG4gIGxldC1vbkFjdGl2YXRlPVwib25BY3RpdmF0ZVwiXG4gIGxldC1vbkRlYWN0aXZhdGU9XCJvbkRlYWN0aXZhdGVcIlxuICBsZXQtb25DbGljaz1cIm9uQ2xpY2tcIj5cbiAgPGJiLWNoYXJ0cy1sZWdlbmRcbiAgICBjbGFzcz1cImNoYXJ0LWxlZ2VuZFwiXG4gICAgW2RhdGFdPVwibGVnZW5kT3B0aW9ucy5kb21haW5cIlxuICAgIFt0aXRsZV09XCJsZWdlbmRPcHRpb25zLnRpdGxlXCJcbiAgICBbY29sb3JzXT1cImxlZ2VuZE9wdGlvbnMuY29sb3JzXCJcbiAgICBbaGVpZ2h0XT1cImhlaWdodFwiXG4gICAgW2FjdGl2ZUVudHJpZXNdPVwiYWN0aXZlRW50cmllc1wiXG4gICAgKGxhYmVsQ2xpY2spPVwib25DbGljaygkZXZlbnQpXCJcbiAgICAobGFiZWxBY3RpdmF0ZSk9XCJvbkFjdGl2YXRlKCRldmVudClcIlxuICAgIChsYWJlbERlYWN0aXZhdGUpPVwib25EZWFjdGl2YXRlKCRldmVudClcIj5cbiAgPC9iYi1jaGFydHMtbGVnZW5kPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlIGJiVHVybm92ZXJzQ2hhcnRUb29sdGlwQ3VzdG9taXphYmxlICN0b29sdGlwVGVtcGxhdGUgbGV0LW1vZGVsPVwibW9kZWxcIj5cbiAgPGRpdiBjbGFzcz1cImNoYXJ0LXRvb2x0aXAtZGVmYXVsdCBiYi1hcnJvdy1ib3R0b20gdGV4dC1kYXJrXCI+XG4gICAgPGRpdlxuICAgICAgKm5nSWY9XCJtb2RlbC5iYWRnZVwiXG4gICAgICBjbGFzcz1cInBiLTEgbWItMiBmb250LXdlaWdodC1ib2xkIGJvcmRlci1ib3R0b20gYm9yZGVyLWRhcmsgdGV4dC1jYXBpdGFsaXplIHRleHQtbGVmdFwiPlxuICAgICAge3ttb2RlbC5iYWRnZX19XG4gICAgPC9kaXY+XG4gICAgPGRpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggcGItMSBhbGlnbi1pdGVtcy1jZW50ZXJcIiAqbmdGb3I9XCJsZXQgYmFyIG9mIG1vZGVsLnNlcmllczsgbGV0IGkgPSBpbmRleFwiPlxuICAgICAgICA8c3BhbiBbbmdTdHlsZV09XCJ7J2NvbG9yJzogYmFyLmNvbG9yfVwiIGNsYXNzPVwiYmljb24gYmljb24tY2lyY2xlXCI+PC9zcGFuPlxuICAgICAgICA8c3BhbiBjbGFzcz1cInRleHQtY2FwaXRhbGl6ZVwiPnt7YmFyLm5hbWV9fTwvc3Bhbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJtbC1hdXRvIGZvbnQtd2VpZ2h0LWJvbGRcIj5cbiAgICAgICAgICA8YmItYW1vdW50LXVpXG4gICAgICAgICAgICBbYW1vdW50XT1cImkgPT09IDAgPyBiYXIudmFsdWUgOiAoLWJhci52YWx1ZSlcIlxuICAgICAgICAgICAgW2N1cnJlbmN5XT1cImJhci5jdXJyZW5jeVwiXG4gICAgICAgICAgICBbc2hvd1BsdXNTaWduXT1cImkgPT09IDAgJiYgYmFyLnZhbHVlID4gMFwiXG4gICAgICAgICAgPjwvYmItYW1vdW50LXVpPlxuICAgICAgICA8L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggcHQtMSBwbC0xIGFsaWduLWl0ZW1zLWNlbnRlclwiPlxuICAgICAgICA8c3BhbiBpMThuPVwiRGlmZmVyZW5jZXx0b29sdGlwIGRpZmZlcmVuY2UgbGFiZWxAQHR1cm5vdmVycy50b29sdGlwLmRpZmZcIj5EaWZmZXJlbmNlPC9zcGFuPlxuICAgICAgICA8c3BhbiBjbGFzcz1cIm1sLWF1dG8gZm9udC13ZWlnaHQtYm9sZFwiPlxuICAgICAgICAgIDxiYi1hbW91bnQtdWlcbiAgICAgICAgICAgIFthbW91bnRdPVwibW9kZWwuZGlmZlwiXG4gICAgICAgICAgICBbY3VycmVuY3ldPVwibW9kZWwuY3VycmVuY3lcIlxuICAgICAgICAgICAgW3Nob3dQbHVzU2lnbl09XCJtb2RlbC5kaWZmICE9PSAwXCJcbiAgICAgICAgICA+PC9iYi1hbW91bnQtdWk+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=