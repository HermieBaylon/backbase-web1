{"version":3,"file":"accounts-details-tab.component.js","sourceRoot":"","sources":["../../../../../../../libs/accounts-transactions-journey/src/lib/views/accounts-details-tab/accounts-details-tab.component.ts","../../../../../../../libs/accounts-transactions-journey/src/lib/views/accounts-details-tab/accounts-details-tab.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Inject, Optional } from '@angular/core';\nimport { ActivatedRoute, Route, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { AccountsTransactionsJourneyService } from '../../accounts-transactions-journey-config.service';\nimport {\n  ACCOUNT_ALIAS_DISPLAYING_LEVEL,\n  AccountAliasDisplayingLevel,\n  AccountArrangementItem,\n  hasExternalInfo,\n  ProductsExternalInfoService,\n  ProductSummaryAccountsService,\n} from '@backbase/product-summary-common-ang';\nimport { Tab } from '../../models/types';\nimport { AccountsPaymentsCommunication } from '../../services/accounts-payments-communication';\nimport { publishSwitch } from '../../utils/operators';\n\n@Component({\n  selector: 'bb-accounts-details-tab-container',\n  templateUrl: './accounts-details-tab.component.html',\n  providers: [ProductSummaryAccountsService, ProductsExternalInfoService],\n})\nexport class AccountsDetailsTabComponent {\n  /**\n   * Collection of Tabs to be rendered according to the journey layout and routing.\n   */\n  public tabs: Tab[];\n\n  /**\n   * Arrangement item to be displayed\n   */\n  accountArrangementItem$: Observable<AccountArrangementItem | undefined> = this.accountsService\n    .getAccountById(this.getSelectedAccount())\n    .pipe(publishSwitch((source) => this.externalInfoService.getProductsWithExternalInfo(source)));\n  /**\n   * Returns `true` if `AccountsPaymentsCommunication` was provided\n   */\n  isCommunicationProvided = false;\n\n  constructor(\n    @Optional()\n    @Inject(ACCOUNT_ALIAS_DISPLAYING_LEVEL)\n    readonly accountAliasDisplayingLevel: AccountAliasDisplayingLevel,\n    readonly config: AccountsTransactionsJourneyService,\n    @Optional()\n    private accountsPaymentsCommunication: AccountsPaymentsCommunication,\n    private readonly route: ActivatedRoute,\n    private readonly router: Router,\n    private readonly accountsService: ProductSummaryAccountsService,\n    private readonly externalInfoService: ProductsExternalInfoService,\n  ) {\n    const { routeConfig } = this.route.snapshot;\n    this.tabs = routeConfig?.children ? this.initializeTabs(routeConfig) : [];\n    this.accountAliasDisplayingLevel = accountAliasDisplayingLevel || config.accountAliasDisplayLevel;\n    this.isCommunicationProvided = !!accountsPaymentsCommunication;\n  }\n\n  /**\n   * Specifies whether `repay` action can be initiated for provided AccountArrangementItem\n   *\n   * @param accountArrangementItem\n   */\n  canInitiateRepay(accountArrangementItem: AccountArrangementItem): boolean {\n    return this.isQuickActionsAllowed(accountArrangementItem) && accountArrangementItem.creditAccount === true;\n  }\n\n  /**\n   * Specifies whether `cash advance` action can be initiated for provided AccountArrangementItem\n   *\n   * @param accountArrangementItem\n   */\n  canInitiateCashInAdvance(accountArrangementItem: AccountArrangementItem): boolean {\n    return this.isQuickActionsAllowed(accountArrangementItem) && accountArrangementItem.debitAccount === true;\n  }\n\n  /**\n   * Event handler for the `repayInitiated` event of `bb-account-graphical-header`\n   * Initiates the event by running the corresponding method from communication protocol\n   *\n   * @param arrangementId\n   */\n  onRepayInitiated(arrangementId: string | undefined) {\n    if (arrangementId && this.accountsPaymentsCommunication) {\n      this.accountsPaymentsCommunication.repayEvent(arrangementId);\n    }\n  }\n\n  /**\n   * Event handler for the `cashAdvanceInitiated` event of `bb-account-graphical-header`\n   * Initiates the event by running the corresponding method from communication protocol\n   *\n   * @param arrangementId\n   */\n  onCashAdvanceInitiated(arrangementId: string | undefined) {\n    if (arrangementId && this.accountsPaymentsCommunication) {\n      this.accountsPaymentsCommunication.cashAdvanceEvent(arrangementId);\n    }\n  }\n\n  /**\n   * Navigates back to `My Accounts`\n   */\n  onNavigateBack() {\n    this.router.navigate(['..'], { relativeTo: this.route });\n  }\n\n  private isQuickActionsAllowed(accountArrangementItem: AccountArrangementItem): boolean {\n    return this.isCommunicationProvided && !hasExternalInfo(accountArrangementItem);\n  }\n\n  private initializeTabs({ children = [] }: Route) {\n    return children\n      .filter((routeItem) => routeItem.path && routeItem.data)\n      .map((routeItem, index) => ({\n        title: routeItem.data?.title || `Tab${index + 1}`,\n        route: routeItem.path || `${index + 1}`,\n      }));\n  }\n\n  /**\n   * Returns selected account from snapshot params of activatedRoute\n   *\n   * @private\n   */\n  private getSelectedAccount(): string {\n    return this.route.snapshot.params.selectedAccount;\n  }\n}\n","<div class=\"pt-5 bb-block bb-block--xl\">\n  <button\n    bbButton\n    data-role=\"account-details-tab__back-navigation-button\"\n    buttonSize=\"md\"\n    color=\"link-text\"\n    class=\"bb-stack justify-content-start bb-stack--density-sm\"\n    (click)=\"onNavigateBack()\"\n  >\n    <bb-icon-ui size=\"md\" name=\"arrow-back\" class=\"bb-stack__item\"></bb-icon-ui>\n    <span\n      class=\"bb-stack__item\"\n      i18n=\"Back to my accounts|Navigation button@@accounts-details-tab-header-back-navigation-button\"\n    >\n      Back to my accounts\n    </span>\n  </button>\n</div>\n\n<ng-container *ngIf=\"accountArrangementItem$ | async as accountArrangementItem\">\n  <div\n    class=\"bb-card bb-card--lg\"\n    *ngIf=\"\n      accountArrangementItem?.product?.productKind | bbIsProductKind: config.productKindsWithGraphicalRepresentation;\n      else accountHeader\n    \"\n  >\n    <div class=\"bb-card__body\">\n      <bb-account-graphical-header\n        data-role=\"accounts-details-tab__account-graphical-header\"\n        [product]=\"accountArrangementItem\"\n        [canEditAlias]=\"false\"\n        [useShortCurrency]=\"true\"\n        [creditLimitViewMode]=\"config.creditLimitViewMode\"\n        [canRepay]=\"canInitiateRepay(accountArrangementItem)\"\n        [canCashInAdvance]=\"canInitiateCashInAdvance(accountArrangementItem)\"\n        [creditCardBackgroundType]=\"'darkred-card'\"\n        [aliasLevel]=\"accountAliasDisplayingLevel\"\n        [isLogoVisible]=\"false\"\n        (repayInitiated)=\"onRepayInitiated($event)\"\n        (cashAdvanceInitiated)=\"onCashAdvanceInitiated($event)\"\n      ></bb-account-graphical-header>\n    </div>\n  </div>\n  <ng-template #accountHeader>\n    <bb-account-header\n      data-role=\"accounts-details-tab__account-header\"\n      [product]=\"accountArrangementItem\"\n      [isBalanceTypeVisible]=\"false\"\n      [mapCurrency]=\"true\"\n      [aliasLevel]=\"accountAliasDisplayingLevel\"\n      [canEditAlias]=\"false\"\n      [isLogoVisible]=\"config.showAccountIcons\"\n    ></bb-account-header>\n  </ng-template>\n</ng-container>\n\n<div class=\"d-block\">\n  <div class=\"d-block mx-4 pt-5\">\n    <div class=\"bb-tab-container__tabs nav nav-tabs\">\n      <a *ngFor=\"let tab of tabs\" class=\"nav-link\" role=\"tab\" [routerLink]=\"[tab.route]\" routerLinkActive=\"active\">\n        <span class=\"bb-stack__item bb-stack__item--spacing-xs\">{{ tab?.title }}</span>\n      </a>\n    </div>\n  </div>\n\n  <div class=\"bb-tab-container__content tab-content\" role=\"tabpanel\">\n    <router-outlet></router-outlet>\n  </div>\n</div>\n"]}