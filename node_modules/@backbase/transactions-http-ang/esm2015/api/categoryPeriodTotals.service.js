import { Inject, Injectable, Optional } from '@angular/core';
import { HttpHeaders, HttpParams } from '@angular/common/http';
import { CustomHttpParameterCodec } from '../encoder';
import { TRANSACTIONS_BASE_PATH } from '../variables';
import { TransactionsConfiguration } from '../configuration';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../configuration";
export class CategoryPeriodTotalsHttpService {
    constructor(httpClient, basePath, configuration) {
        this.httpClient = httpClient;
        this.basePath = '';
        this.defaultHeaders = new HttpHeaders();
        this.configuration = new TransactionsConfiguration();
        if (configuration) {
            this.configuration = configuration;
        }
        if (typeof this.configuration.basePath !== 'string') {
            if (typeof basePath !== 'string') {
                basePath = this.basePath;
            }
            this.configuration.basePath = basePath;
        }
        this.encoder = this.configuration.encoder || new CustomHttpParameterCodec();
    }
    addToHttpParams(httpParams, value, key) {
        if (typeof value === "object" && value instanceof Date === false) {
            httpParams = this.addToHttpParamsRecursive(httpParams, value);
        }
        else {
            httpParams = this.addToHttpParamsRecursive(httpParams, value, key);
        }
        return httpParams;
    }
    addToHttpParamsRecursive(httpParams, value, key) {
        if (value == null) {
            return httpParams;
        }
        if (typeof value === "object") {
            if (Array.isArray(value)) {
                value.forEach(elem => httpParams = this.addToHttpParamsRecursive(httpParams, elem, key));
            }
            else if (value instanceof Date) {
                if (key != null) {
                    httpParams = httpParams.append(key, value.toISOString().substr(0, 10));
                }
                else {
                    throw Error("key may not be null if value is Date");
                }
            }
            else {
                Object.keys(value).forEach(k => httpParams = this.addToHttpParamsRecursive(httpParams, value[k], key != null ? `${key}.${k}` : k));
            }
        }
        else if (key != null) {
            httpParams = httpParams.append(key, value);
        }
        else {
            throw Error("key may not be null if value is not object or array");
        }
        return httpParams;
    }
    getCategoryPeriodTotals(requestParameters, observe = 'body', reportProgress = false, options) {
        const _categories = requestParameters["categories"];
        if (_categories === null || _categories === undefined) {
            throw new Error('Required parameter categories was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _creditDebitIndicator = requestParameters["creditDebitIndicator"];
        if (_creditDebitIndicator === null || _creditDebitIndicator === undefined) {
            throw new Error('Required parameter creditDebitIndicator was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _periodStartDate = requestParameters["periodStartDate"];
        if (_periodStartDate === null || _periodStartDate === undefined) {
            throw new Error('Required parameter periodStartDate was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _periodEndDate = requestParameters["periodEndDate"];
        if (_periodEndDate === null || _periodEndDate === undefined) {
            throw new Error('Required parameter periodEndDate was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _intervalStartDay = requestParameters["intervalStartDay"];
        const _arrangementIds = requestParameters["arrangementIds"];
        const _intervalDuration = requestParameters["intervalDuration"];
        const _parentCategory = requestParameters["parentCategory"];
        let queryParameters = new HttpParams({ encoder: this.encoder });
        if (_categories) {
            _categories.forEach((element) => {
                queryParameters = this.addToHttpParams(queryParameters, element, 'categories');
            });
        }
        if (_intervalStartDay !== undefined && _intervalStartDay !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _intervalStartDay, 'intervalStartDay');
        }
        if (_creditDebitIndicator !== undefined && _creditDebitIndicator !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _creditDebitIndicator, 'creditDebitIndicator');
        }
        if (_arrangementIds) {
            _arrangementIds.forEach((element) => {
                queryParameters = this.addToHttpParams(queryParameters, element, 'arrangementIds');
            });
        }
        if (_periodStartDate !== undefined && _periodStartDate !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _periodStartDate, 'periodStartDate');
        }
        if (_periodEndDate !== undefined && _periodEndDate !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _periodEndDate, 'periodEndDate');
        }
        if (_intervalDuration !== undefined && _intervalDuration !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _intervalDuration, 'intervalDuration');
        }
        if (_parentCategory !== undefined && _parentCategory !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _parentCategory, 'parentCategory');
        }
        let headers = this.defaultHeaders;
        let httpHeaderAcceptSelected = options && options.httpHeaderAccept;
        if (httpHeaderAcceptSelected === undefined) {
            const httpHeaderAccepts = [
                'application/json'
            ];
            httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
        }
        if (httpHeaderAcceptSelected !== undefined) {
            headers = headers.set('Accept', httpHeaderAcceptSelected);
        }
        let responseType = 'json';
        if (httpHeaderAcceptSelected && httpHeaderAcceptSelected.startsWith('text')) {
            responseType = 'text';
        }
        return this.httpClient.get(`${this.configuration.basePath}/client-api/v2/category-period-totals`, {
            params: queryParameters,
            responseType: responseType,
            withCredentials: this.configuration.withCredentials,
            headers: headers,
            observe: observe,
            reportProgress: reportProgress
        });
    }
    getCategoryPeriodTotalsUrl(requestParameters) {
        const _categories = requestParameters["categories"];
        if (_categories === null || _categories === undefined) {
            throw new Error('Required parameter categories was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _creditDebitIndicator = requestParameters["creditDebitIndicator"];
        if (_creditDebitIndicator === null || _creditDebitIndicator === undefined) {
            throw new Error('Required parameter creditDebitIndicator was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _periodStartDate = requestParameters["periodStartDate"];
        if (_periodStartDate === null || _periodStartDate === undefined) {
            throw new Error('Required parameter periodStartDate was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _periodEndDate = requestParameters["periodEndDate"];
        if (_periodEndDate === null || _periodEndDate === undefined) {
            throw new Error('Required parameter periodEndDate was null or undefined when calling getCategoryPeriodTotals.');
        }
        const _intervalStartDay = requestParameters["intervalStartDay"];
        const _arrangementIds = requestParameters["arrangementIds"];
        const _intervalDuration = requestParameters["intervalDuration"];
        const _parentCategory = requestParameters["parentCategory"];
        let queryParameters = new HttpParams({ encoder: this.encoder });
        if (_categories) {
            _categories.forEach((element) => {
                queryParameters = this.addToHttpParams(queryParameters, element, 'categories');
            });
        }
        if (_intervalStartDay !== undefined && _intervalStartDay !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _intervalStartDay, 'intervalStartDay');
        }
        if (_creditDebitIndicator !== undefined && _creditDebitIndicator !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _creditDebitIndicator, 'creditDebitIndicator');
        }
        if (_arrangementIds) {
            _arrangementIds.forEach((element) => {
                queryParameters = this.addToHttpParams(queryParameters, element, 'arrangementIds');
            });
        }
        if (_periodStartDate !== undefined && _periodStartDate !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _periodStartDate, 'periodStartDate');
        }
        if (_periodEndDate !== undefined && _periodEndDate !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _periodEndDate, 'periodEndDate');
        }
        if (_intervalDuration !== undefined && _intervalDuration !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _intervalDuration, 'intervalDuration');
        }
        if (_parentCategory !== undefined && _parentCategory !== null) {
            queryParameters = this.addToHttpParams(queryParameters, _parentCategory, 'parentCategory');
        }
        const queryString = queryParameters.toString();
        return `${this.configuration.basePath}/client-api/v2/category-period-totals${queryString ? `?${queryString}` : ''}`;
    }
}
CategoryPeriodTotalsHttpService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CategoryPeriodTotalsHttpService, deps: [{ token: i1.HttpClient }, { token: TRANSACTIONS_BASE_PATH, optional: true }, { token: i2.TransactionsConfiguration, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
CategoryPeriodTotalsHttpService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CategoryPeriodTotalsHttpService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CategoryPeriodTotalsHttpService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [TRANSACTIONS_BASE_PATH]
                }] }, { type: i2.TransactionsConfiguration, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2F0ZWdvcnlQZXJpb2RUb3RhbHMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2FwaS9jYXRlZ29yeVBlcmlvZFRvdGFscy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUEyQixlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFjLFdBQVcsRUFBRSxVQUFVLEVBQ1UsTUFBWSxzQkFBc0IsQ0FBQztBQUN6RixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBK0IsWUFBWSxDQUFDO0FBVS9FLE9BQU8sRUFBRSxzQkFBc0IsRUFBc0IsTUFBMEIsY0FBYyxDQUFDO0FBQzlGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUEwQyxrQkFBa0IsQ0FBQzs7OztBQTBCakcsTUFBTSxPQUFPLCtCQUErQjtJQU94QyxZQUFzQixVQUFzQixFQUE4QyxRQUFnQixFQUFjLGFBQXdDO1FBQTFJLGVBQVUsR0FBVixVQUFVLENBQVk7UUFMbEMsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNqQixtQkFBYyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDbkMsa0JBQWEsR0FBRyxJQUFJLHlCQUF5QixFQUFFLENBQUM7UUFJbkQsSUFBSSxhQUFhLEVBQUU7WUFDZixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztTQUN0QztRQUNELElBQUksT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsS0FBSyxRQUFRLEVBQUU7WUFDakQsSUFBSSxPQUFPLFFBQVEsS0FBSyxRQUFRLEVBQUU7Z0JBQzlCLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO2FBQzVCO1lBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1NBQzFDO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sSUFBSSxJ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RSxFQUFFLENBQUM7SUFDeEgsQ0FBQzs7NkhBaFBRLCtCQUErQiw0Q0FPMEIsc0JBQXNCO2lJQVAvRSwrQkFBK0IsY0FGOUIsTUFBTTs0RkFFUCwrQkFBK0I7a0JBSDNDLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzswQkFRa0QsUUFBUTs7MEJBQUksTUFBTTsyQkFBQyxzQkFBc0I7OzBCQUFxQixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUcmFuc2FjdGlvbiBtYW5hZ2VtZW50XG4gKiBSZXRyaWV2ZSBhIHNvcnRlZCBsaXN0IG9mIHRyYW5zYWN0aW9ucywgc2VhcmNoIGFuZCBmaWx0ZXIgdHJhbnNhY3Rpb24gbGlzdHMsIGV4cG9ydCB0cmFuc2FjdGlvbnMsIGFuZCBhZGQgbm90ZXMgdG8gaW5kaXZpZHVhbCB0cmFuc2FjdGlvbnMuXG4gKlxuICogVGhlIHZlcnNpb24gb2YgdGhlIE9wZW5BUEkgZG9jdW1lbnQ6IDIuNi4wXG4gKiBcbiAqXG4gKiBOT1RFOiBUaGlzIGNsYXNzIGlzIGF1dG8gZ2VuZXJhdGVkIGJ5IE9wZW5BUEkgR2VuZXJhdG9yIChodHRwczovL2dpdGh1Yi5jb20vQmFja2Jhc2UvYmFja2Jhc2Utb3BlbmFwaS10b29scykuXG4gKiBodHRwczovL2dpdGh1Yi5jb20vQmFja2Jhc2UvYmFja2Jhc2Utb3BlbmFwaS10b29sc1xuICogRG8gbm90IGVkaXQgdGhlIGNsYXNzIG1hbnVhbGx5LlxuICovXG5cbi8qIHRzbGludDpkaXNhYmxlOm5vLXVudXNlZC12YXJpYWJsZSBtZW1iZXItb3JkZXJpbmcgKi9cblxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPcHRpb25hbCB9ICAgICAgICAgICAgICAgICAgICAgIGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMsXG4gICAgICAgICBIdHRwUmVzcG9uc2UsIEh0dHBFdmVudCwgSHR0cFBhcmFtZXRlckNvZGVjIH0gICAgICAgZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQ3VzdG9tSHR0cFBhcmFtZXRlckNvZGVjIH0gICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gJy4uL2VuY29kZXInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXJyb3IgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgQ2F0ZWdvcnlQZXJpb2RUb3RhbHNHZXRSZXNwb25zZUJvZHkgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgRm9yYmlkZGVuRXJyb3IgfSBmcm9tICcuLi9tb2RlbC9tb2RlbHMnO1xuaW1wb3J0IHsgSW50ZXJuYWxTZXJ2ZXJFcnJvciB9IGZyb20gJy4uL21vZGVsL21vZGVscyc7XG5pbXBvcnQgeyBOb3RGb3VuZEVycm9yIH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcbmltcG9ydCB7IFVuYXV0aG9yaXplZEVycm9yIH0gZnJvbSAnLi4vbW9kZWwvbW9kZWxzJztcblxuaW1wb3J0IHsgVFJBTlNBQ1RJT05TX0JBU0VfUEFUSCwgQ09MTEVDVElPTl9GT1JNQVRTIH0gICAgICAgICAgICAgICAgICAgICBmcm9tICcuLi92YXJpYWJsZXMnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb25zQ29uZmlndXJhdGlvbiB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gJy4uL2NvbmZpZ3VyYXRpb24nO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgR2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHNSZXF1ZXN0UGFyYW1zIHtcbiAgICAvKiogQ2F0ZWdvcmllcyBmb3Igd2hpY2ggdG90YWxzIG11c3QgYmUgY2FsY3VsYXRlZCAqL1xuICAgIFtcImNhdGVnb3JpZXNcIl06IEFycmF5PHN0cmluZz47XG4gICAgLyoqIFdoZXRoZXIgY3JlZGl0IG9yIGRlYml0IHRyYW5zYWN0aW9ucyBzaG91bGQgYmUgYWdncmVnYXRlZCAqL1xuICAgIFtcImNyZWRpdERlYml0SW5kaWNhdG9yXCJdOiAnREJJVCcgfCAnQ1JEVCc7XG4gICAgLyoqIEluY2x1c2l2ZSBzdGFydCBkYXRlIHRvIGNhbGN1bGF0ZSB0b3RhbHMgZm9yICovXG4gICAgW1wicGVyaW9kU3RhcnREYXRlXCJdOiBzdHJpbmc7XG4gICAgLyoqIEluY2x1c2l2ZSBlbmQgZGF0ZSB0byBjYWxjdWxhdGUgdG90YWxzIGZvciAqL1xuICAgIFtcInBlcmlvZEVuZERhdGVcIl06IHN0cmluZztcbiAgICAvKiogRGF5IHRvIHN0YXJ0IHRvdGFscyBjYWxjdWxhdGlvbiBmb3IgZWFjaCBwZXJpb2QgKi9cbiAgICBbXCJpbnRlcnZhbFN0YXJ0RGF5XCJdPzogbnVtYmVyO1xuICAgIC8qKiBBcnJhbmdlbWVudCBJRHMgZm9yIHdoaWNoIHRvIGNhbGN1bGF0ZSB0aGUgdG90YWxzICovXG4gICAgW1wiYXJyYW5nZW1lbnRJZHNcIl0/OiBBcnJheTxzdHJpbmc+O1xuICAgIC8qKiBMZW5ndGggb2YgZWFjaCBwZXJpb2QgdG8gYWdncmVnYXRlICovXG4gICAgW1wiaW50ZXJ2YWxEdXJhdGlvblwiXT86ICdEQVknIHwgJ1dFRUsnIHwgJ01PTlRIJyB8ICdZRUFSJztcbiAgICAvKiogQ2F0ZWdvcnkgbmFtZSB3aG9zZSBjaGlsZHJlbiBzaG91bGQgYmUgYWdncmVnYXRlZCAqL1xuICAgIFtcInBhcmVudENhdGVnb3J5XCJdPzogc3RyaW5nO1xufVxuXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIENhdGVnb3J5UGVyaW9kVG90YWxzSHR0cFNlcnZpY2Uge1xuXG4gICAgcHJvdGVjdGVkIGJhc2VQYXRoID0gJyc7XG4gICAgcHVibGljIGRlZmF1bHRIZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgcHVibGljIGNvbmZpZ3VyYXRpb24gPSBuZXcgVHJhbnNhY3Rpb25zQ29uZmlndXJhdGlvbigpO1xuICAgIHB1YmxpYyBlbmNvZGVyOiBIdHRwUGFyYW1ldGVyQ29kZWM7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cENsaWVudDogSHR0cENsaWVudCwgQE9wdGlvbmFsKCkgQEluamVjdChUUkFOU0FDVElPTlNfQkFTRV9QQVRIKSBiYXNlUGF0aDogc3RyaW5nLCBAT3B0aW9uYWwoKSBjb25maWd1cmF0aW9uOiBUcmFuc2FjdGlvbnNDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmJhc2VQYXRoICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlUGF0aCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBiYXNlUGF0aCA9IHRoaXMuYmFzZVBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGggPSBiYXNlUGF0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVuY29kZXIgPSB0aGlzLmNvbmZpZ3VyYXRpb24uZW5jb2RlciB8fCBuZXcgQ3VzdG9tSHR0cFBhcmFtZXRlckNvZGVjKCk7XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIGFkZFRvSHR0cFBhcmFtcyhodHRwUGFyYW1zOiBIdHRwUGFyYW1zLCB2YWx1ZTogYW55LCBrZXk/OiBzdHJpbmcpOiBIdHRwUGFyYW1zIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBodHRwUGFyYW1zID0gdGhpcy5hZGRUb0h0dHBQYXJhbXNSZWN1cnNpdmUoaHR0cFBhcmFtcywgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHR0cFBhcmFtcyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKGh0dHBQYXJhbXMsIHZhbHVlLCBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBodHRwUGFyYW1zO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKGh0dHBQYXJhbXM6IEh0dHBQYXJhbXMsIHZhbHVlPzogYW55LCBrZXk/OiBzdHJpbmcpOiBIdHRwUGFyYW1zIHtcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBodHRwUGFyYW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgKHZhbHVlIGFzIGFueVtdKS5mb3JFYWNoKCBlbGVtID0+IGh0dHBQYXJhbXMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtc1JlY3Vyc2l2ZShodHRwUGFyYW1zLCBlbGVtLCBrZXkpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0dHBQYXJhbXMgPSBodHRwUGFyYW1zLmFwcGVuZChrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAodmFsdWUgYXMgRGF0ZSkudG9JU09TdHJpbmcoKS5zdWJzdHIoMCwgMTApKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKFwia2V5IG1heSBub3QgYmUgbnVsbCBpZiB2YWx1ZSBpcyBEYXRlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goIGsgPT4gaHR0cFBhcmFtcyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zUmVjdXJzaXZlKFxuICAgICAgICAgICAgICAgICAgICBodHRwUGFyYW1zLCB2YWx1ZVtrXSwga2V5ICE9IG51bGwgPyBgJHtrZXl9LiR7a31gIDogaykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGtleSAhPSBudWxsKSB7XG4gICAgICAgICAgICBodHRwUGFyYW1zID0gaHR0cFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcImtleSBtYXkgbm90IGJlIG51bGwgaWYgdmFsdWUgaXMgbm90IG9iamVjdCBvciBhcnJheVwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaHR0cFBhcmFtcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbmNvbWUgb3Igc3BlbnQgYW1vdW50IHBlciBjYXRlZ29yeSBhbmQgcGVyaW9kXG4gICAgICogUmV0cmlldmVzIHRoZSBhbW91bnQgb2YgaW5jb21lIG9yIGV4cGVuc2VzIGZvciB0aGUgc3BlY2lmaWVkIHBlcmlvZCBwZXIgY2F0ZWdvcnkgYW5kIHBlcmlvZFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFscyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4sIG9wdGlvbnM/OiB7aHR0cEhlYWRlckFjY2VwdD86ICdhcHBsaWNhdGlvbi9qc29uJ30pOiBPYnNlcnZhYmxlPENhdGVnb3J5UGVyaW9kVG90YWxzR2V0UmVzcG9uc2VCb2R5PjtcbiAgICAvKipcbiAgICAgKiBJbmNvbWUgb3Igc3BlbnQgYW1vdW50IHBlciBjYXRlZ29yeSBhbmQgcGVyaW9kXG4gICAgICogUmV0cmlldmVzIHRoZSBhbW91bnQgb2YgaW5jb21lIG9yIGV4cGVuc2VzIGZvciB0aGUgc3BlY2lmaWVkIHBlcmlvZCBwZXIgY2F0ZWdvcnkgYW5kIHBlcmlvZFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFscyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8Q2F0ZWdvcnlQZXJpb2RUb3RhbHNHZXRSZXNwb25zZUJvZHk+PjtcbiAgICAvKipcbiAgICAgKiBJbmNvbWUgb3Igc3BlbnQgYW1vdW50IHBlciBjYXRlZ29yeSBhbmQgcGVyaW9kXG4gICAgICogUmV0cmlldmVzIHRoZSBhbW91bnQgb2YgaW5jb21lIG9yIGV4cGVuc2VzIGZvciB0aGUgc3BlY2lmaWVkIHBlcmlvZCBwZXIgY2F0ZWdvcnkgYW5kIHBlcmlvZFxuICAgICAqIEBwYXJhbSByZXF1ZXN0UGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFscyhyZXF1ZXN0UGFyYW1ldGVyczogR2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHNSZXF1ZXN0UGFyYW1zLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbiwgb3B0aW9ucz86IHtodHRwSGVhZGVyQWNjZXB0PzogJ2FwcGxpY2F0aW9uL2pzb24nfSk6IE9ic2VydmFibGU8SHR0cEV2ZW50PENhdGVnb3J5UGVyaW9kVG90YWxzR2V0UmVzcG9uc2VCb2R5Pj47XG4gICAgLyoqXG4gICAgICogSW5jb21lIG9yIHNwZW50IGFtb3VudCBwZXIgY2F0ZWdvcnkgYW5kIHBlcmlvZFxuICAgICAqIFJldHJpZXZlcyB0aGUgYW1vdW50IG9mIGluY29tZSBvciBleHBlbnNlcyBmb3IgdGhlIHNwZWNpZmllZCBwZXJpb2QgcGVyIGNhdGVnb3J5IGFuZCBwZXJpb2RcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMocmVxdWVzdFBhcmFtZXRlcnM6IEdldENhdGVnb3J5UGVyaW9kVG90YWxzUmVxdWVzdFBhcmFtcywgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zPzoge2h0dHBIZWFkZXJBY2NlcHQ/OiAnYXBwbGljYXRpb24vanNvbid9KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgX2NhdGVnb3JpZXMgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImNhdGVnb3JpZXNcIl07XG4gICAgICAgIGlmIChfY2F0ZWdvcmllcyA9PT0gbnVsbCB8fCBfY2F0ZWdvcmllcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBjYXRlZ29yaWVzIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2NyZWRpdERlYml0SW5kaWNhdG9yID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJjcmVkaXREZWJpdEluZGljYXRvclwiXTtcbiAgICAgICAgaWYgKF9jcmVkaXREZWJpdEluZGljYXRvciA9PT0gbnVsbCB8fCBfY3JlZGl0RGViaXRJbmRpY2F0b3IgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgY3JlZGl0RGViaXRJbmRpY2F0b3Igd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFscy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfcGVyaW9kU3RhcnREYXRlID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJwZXJpb2RTdGFydERhdGVcIl07XG4gICAgICAgIGlmIChfcGVyaW9kU3RhcnREYXRlID09PSBudWxsIHx8IF9wZXJpb2RTdGFydERhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgcGVyaW9kU3RhcnREYXRlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX3BlcmlvZEVuZERhdGUgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInBlcmlvZEVuZERhdGVcIl07XG4gICAgICAgIGlmIChfcGVyaW9kRW5kRGF0ZSA9PT0gbnVsbCB8fCBfcGVyaW9kRW5kRGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBwZXJpb2RFbmREYXRlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2ludGVydmFsU3RhcnREYXkgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVydmFsU3RhcnREYXlcIl07XG4gICAgICAgIGNvbnN0IF9hcnJhbmdlbWVudElkcyA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiYXJyYW5nZW1lbnRJZHNcIl07XG4gICAgICAgIGNvbnN0IF9pbnRlcnZhbER1cmF0aW9uID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcnZhbER1cmF0aW9uXCJdO1xuICAgICAgICBjb25zdCBfcGFyZW50Q2F0ZWdvcnkgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInBhcmVudENhdGVnb3J5XCJdO1xuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogdGhpcy5lbmNvZGVyfSk7XG4gICAgICAgIGlmIChfY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgX2NhdGVnb3JpZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICAgIDxhbnk+ZWxlbWVudCwgJ2NhdGVnb3JpZXMnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9pbnRlcnZhbFN0YXJ0RGF5ICE9PSB1bmRlZmluZWQgJiYgX2ludGVydmFsU3RhcnREYXkgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9pbnRlcnZhbFN0YXJ0RGF5LCAnaW50ZXJ2YWxTdGFydERheScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfY3JlZGl0RGViaXRJbmRpY2F0b3IgIT09IHVuZGVmaW5lZCAmJiBfY3JlZGl0RGViaXRJbmRpY2F0b3IgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9jcmVkaXREZWJpdEluZGljYXRvciwgJ2NyZWRpdERlYml0SW5kaWNhdG9yJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9hcnJhbmdlbWVudElkcykge1xuICAgICAgICAgICAgX2FycmFuZ2VtZW50SWRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgICA8YW55PmVsZW1lbnQsICdhcnJhbmdlbWVudElkcycpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoX3BlcmlvZFN0YXJ0RGF0ZSAhPT0gdW5kZWZpbmVkICYmIF9wZXJpb2RTdGFydERhdGUgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9wZXJpb2RTdGFydERhdGUsICdwZXJpb2RTdGFydERhdGUnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX3BlcmlvZEVuZERhdGUgIT09IHVuZGVmaW5lZCAmJiBfcGVyaW9kRW5kRGF0ZSAhPT0gbnVsbCkge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHRoaXMuYWRkVG9IdHRwUGFyYW1zKHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgIDxhbnk+X3BlcmlvZEVuZERhdGUsICdwZXJpb2RFbmREYXRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9pbnRlcnZhbER1cmF0aW9uICE9PSB1bmRlZmluZWQgJiYgX2ludGVydmFsRHVyYXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9pbnRlcnZhbER1cmF0aW9uLCAnaW50ZXJ2YWxEdXJhdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfcGFyZW50Q2F0ZWdvcnkgIT09IHVuZGVmaW5lZCAmJiBfcGFyZW50Q2F0ZWdvcnkgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9wYXJlbnRDYXRlZ29yeSwgJ3BhcmVudENhdGVnb3J5Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gb3B0aW9ucyAmJiBvcHRpb25zLmh0dHBIZWFkZXJBY2NlcHQ7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGxldCByZXNwb25zZVR5cGU6ICd0ZXh0JyB8ICdqc29uJyA9ICdqc29uJztcbiAgICAgICAgaWYoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICYmIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZC5zdGFydHNXaXRoKCd0ZXh0JykpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZSA9ICd0ZXh0JztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0PENhdGVnb3J5UGVyaW9kVG90YWxzR2V0UmVzcG9uc2VCb2R5PihgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvY2F0ZWdvcnktcGVyaW9kLXRvdGFsc2AsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiA8YW55PnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFsc1VybChyZXF1ZXN0UGFyYW1ldGVyczogR2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHNSZXF1ZXN0UGFyYW1zKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgX2NhdGVnb3JpZXMgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImNhdGVnb3JpZXNcIl07XG4gICAgICAgIGlmIChfY2F0ZWdvcmllcyA9PT0gbnVsbCB8fCBfY2F0ZWdvcmllcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBjYXRlZ29yaWVzIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2NyZWRpdERlYml0SW5kaWNhdG9yID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJjcmVkaXREZWJpdEluZGljYXRvclwiXTtcbiAgICAgICAgaWYgKF9jcmVkaXREZWJpdEluZGljYXRvciA9PT0gbnVsbCB8fCBfY3JlZGl0RGViaXRJbmRpY2F0b3IgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgY3JlZGl0RGViaXRJbmRpY2F0b3Igd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRDYXRlZ29yeVBlcmlvZFRvdGFscy4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBfcGVyaW9kU3RhcnREYXRlID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJwZXJpb2RTdGFydERhdGVcIl07XG4gICAgICAgIGlmIChfcGVyaW9kU3RhcnREYXRlID09PSBudWxsIHx8IF9wZXJpb2RTdGFydERhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgcGVyaW9kU3RhcnREYXRlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX3BlcmlvZEVuZERhdGUgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInBlcmlvZEVuZERhdGVcIl07XG4gICAgICAgIGlmIChfcGVyaW9kRW5kRGF0ZSA9PT0gbnVsbCB8fCBfcGVyaW9kRW5kRGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBwZXJpb2RFbmREYXRlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q2F0ZWdvcnlQZXJpb2RUb3RhbHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgX2ludGVydmFsU3RhcnREYXkgPSByZXF1ZXN0UGFyYW1ldGVyc1tcImludGVydmFsU3RhcnREYXlcIl07XG4gICAgICAgIGNvbnN0IF9hcnJhbmdlbWVudElkcyA9IHJlcXVlc3RQYXJhbWV0ZXJzW1wiYXJyYW5nZW1lbnRJZHNcIl07XG4gICAgICAgIGNvbnN0IF9pbnRlcnZhbER1cmF0aW9uID0gcmVxdWVzdFBhcmFtZXRlcnNbXCJpbnRlcnZhbER1cmF0aW9uXCJdO1xuICAgICAgICBjb25zdCBfcGFyZW50Q2F0ZWdvcnkgPSByZXF1ZXN0UGFyYW1ldGVyc1tcInBhcmVudENhdGVnb3J5XCJdO1xuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IHRoaXMuZW5jb2Rlcn0pO1xuICAgICAgICBpZiAoX2NhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgIF9jYXRlZ29yaWVzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgICA8YW55PmVsZW1lbnQsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGlmIChfaW50ZXJ2YWxTdGFydERheSAhPT0gdW5kZWZpbmVkICYmIF9pbnRlcnZhbFN0YXJ0RGF5ICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5faW50ZXJ2YWxTdGFydERheSwgJ2ludGVydmFsU3RhcnREYXknKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX2NyZWRpdERlYml0SW5kaWNhdG9yICE9PSB1bmRlZmluZWQgJiYgX2NyZWRpdERlYml0SW5kaWNhdG9yICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fY3JlZGl0RGViaXRJbmRpY2F0b3IsICdjcmVkaXREZWJpdEluZGljYXRvcicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfYXJyYW5nZW1lbnRJZHMpIHtcbiAgICAgICAgICAgIF9hcnJhbmdlbWVudElkcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgICAgPGFueT5lbGVtZW50LCAnYXJyYW5nZW1lbnRJZHMnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9wZXJpb2RTdGFydERhdGUgIT09IHVuZGVmaW5lZCAmJiBfcGVyaW9kU3RhcnREYXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fcGVyaW9kU3RhcnREYXRlLCAncGVyaW9kU3RhcnREYXRlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9wZXJpb2RFbmREYXRlICE9PSB1bmRlZmluZWQgJiYgX3BlcmlvZEVuZERhdGUgIT09IG51bGwpIHtcbiAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSB0aGlzLmFkZFRvSHR0cFBhcmFtcyhxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICA8YW55Pl9wZXJpb2RFbmREYXRlLCAncGVyaW9kRW5kRGF0ZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfaW50ZXJ2YWxEdXJhdGlvbiAhPT0gdW5kZWZpbmVkICYmIF9pbnRlcnZhbER1cmF0aW9uICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5faW50ZXJ2YWxEdXJhdGlvbiwgJ2ludGVydmFsRHVyYXRpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX3BhcmVudENhdGVnb3J5ICE9PSB1bmRlZmluZWQgJiYgX3BhcmVudENhdGVnb3J5ICE9PSBudWxsKSB7XG4gICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRUb0h0dHBQYXJhbXMocXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgPGFueT5fcGFyZW50Q2F0ZWdvcnksICdwYXJlbnRDYXRlZ29yeScpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcXVlcnlQYXJhbWV0ZXJzLnRvU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVBhdGh9L2NsaWVudC1hcGkvdjIvY2F0ZWdvcnktcGVyaW9kLXRvdGFscyR7cXVlcnlTdHJpbmcgPyBgPyR7cXVlcnlTdHJpbmd9YCA6ICcnfWA7XG4gICAgfVxuXG59XG4iXX0=