{"version":3,"file":"reducer.js","sourceRoot":"","sources":["../../../../../../libs/quick-transfer-journey/src/lib/store/reducer.ts"],"names":[],"mappings":"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","sourcesContent":["import { createReducer, on } from '@ngrx/store';\nimport { initialState } from '../constants/initital-state';\nimport { AccountItem, Arrangement, TransferAmount } from '../models/items.model';\nimport { LoadingState } from '../models/state.model';\nimport { ViewState } from '../models/view.model';\nimport {\n  accountsFetch,\n  accountsFetchError,\n  accountsFetchSuccess,\n  contactsFetch,\n  contactsFetchError,\n  contactsFetchSuccess,\n  extAccountsFetchError,\n  extAccountsFetchSuccess,\n  externalAccountsFetch,\n  openView,\n  resetFocus,\n  resetWidget,\n  sendTransferOrder,\n  setAmount,\n  setDefaultCurrency,\n  setFieldTouched,\n  setFromAccount,\n  setModalOpen,\n  setPayeeAccount,\n  transferOrderError,\n  transferOrderSuccess,\n} from './actions';\n\nfunction onlyUnique(value: any, index: number, self: any[]) {\n  return self.indexOf(value) === index;\n}\n\nexport const quickTransferReducer = createReducer(\n  initialState,\n  on(accountsFetch, state => ({\n    ...state,\n    accountsCallState: LoadingState.LOADING,\n  })),\n  on(accountsFetchError, (state, { error }) => ({\n    ...state,\n    accountsCallState: { error },\n  })),\n  on(accountsFetchSuccess, (state, { debitAccounts, creditAccounts }) => ({\n    ...state,\n    debitAccounts,\n    creditAccounts,\n    accountsCallState: LoadingState.LOADED,\n  })),\n  on(contactsFetch, state => ({\n    ...state,\n    contactsCallState: LoadingState.LOADING,\n  })),\n  on(contactsFetchError, (state, { error }) => ({\n    ...state,\n    contactsCallState: { error },\n  })),\n  on(contactsFetchSuccess, (state, { contacts }) => ({\n    ...state,\n    contacts,\n    contactsCallState: LoadingState.LOADED,\n  })),\n  on(externalAccountsFetch, state => ({\n    ...state,\n    extAccountsCallState: LoadingState.LOADING,\n  })),\n  on(extAccountsFetchSuccess, (state, { extAccounts }) => ({\n    ...state,\n    extAccounts,\n    extAccountsCallState: LoadingState.LOADED,\n  })),\n  on(extAccountsFetchError, (state, { error }) => ({\n    ...state,\n    extAccountsCallState: { error },\n  })),\n  on(setFromAccount, (state, { accountId }) => {\n    const _accounts = [...(state.extAccounts || []), ...(state.debitAccounts || [])];\n    const account = _accounts.find((a: Arrangement) => a.uuid === accountId) || {};\n    const currency = (account as Arrangement)?.currency || state.defaultCurrency;\n    return {\n      ...state,\n      fromAccount: account as AccountItem,\n      amount: { amount: state.amount?.amount || '', currency },\n    };\n  }),\n  on(setPayeeAccount, (state, { id }) => {\n    const _accounts = [...(state.extAccounts || []), ...(state.creditAccounts || []), ...(state.contacts || [])];\n    const account = _accounts.find(e => e.uuid === id) as AccountItem;\n    return {\n      ...state,\n      payeeTo: account,\n    };\n  }),\n  on(setModalOpen, (state, { isOpen }) => {\n    return {\n      ...state,\n      isModalOpen: isOpen,\n    };\n  }),\n  on(setAmount, (state, { amount, defaultCurrency }) => {\n    const newAmount = {\n      amount,\n      currency: state.amount?.currency ? state.amount.currency : defaultCurrency,\n    } as TransferAmount;\n    return {\n      ...state,\n      amount: newAmount,\n    };\n  }),\n  on(openView, (state, { view, focus }) => {\n    return {\n      ...state,\n      viewState: view,\n      focusElement: focus,\n    };\n  }),\n  on(resetFocus, state => {\n    return {\n      ...state,\n      focusElement: undefined,\n    };\n  }),\n  on(sendTransferOrder, state => ({\n    ...state,\n    transferOrderCallState: LoadingState.LOADING,\n  })),\n  on(transferOrderSuccess, state => ({\n    ...state,\n    transferOrderCallState: LoadingState.LOADED,\n    isModalOpen: false,\n    viewState: ViewState.COMPLETE,\n  })),\n  on(transferOrderError, (state, { error }) => ({\n    ...state,\n    transferOrderCallState: { error },\n    isModalOpen: false,\n    viewState: ViewState.COMPLETE,\n  })),\n  on(resetWidget, (state, { focus }) => ({\n    ...state,\n    transferOrderCallState: LoadingState.INIT,\n    viewState: ViewState.FORM,\n    payeeTo: undefined,\n    amount: undefined,\n    fromAccount: undefined,\n    touchedFields: [],\n    focusElement: focus || undefined,\n  })),\n  on(setFieldTouched, (state, { fieldName }) => ({\n    ...state,\n    touchedFields: [...state.touchedFields, fieldName].filter(onlyUnique),\n  })),\n  on(setDefaultCurrency, (state, { currency }) => ({\n    ...state,\n    defaultCurrency: currency,\n  })),\n);\n"]}