{"version":3,"file":"quick-transfer-journey.component.js","sourceRoot":"","sources":["../../../../../libs/quick-transfer-journey/src/lib/quick-transfer-journey.component.ts","../../../../../libs/quick-transfer-journey/src/lib/quick-transfer-journey.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { ActivatedRoute, NavigationEnd, Router } from '@angular/router';\nimport { fadeInAnimation, slideUpAnimation } from '@backbase/ui-ang/util';\nimport { Observable, Subscription } from 'rxjs';\nimport { concatMap, filter, map, startWith, take, withLatestFrom } from 'rxjs/operators';\nimport { slideLeftAnimation, slideRightAnimation } from './animations';\nimport { Arrangement } from './models/items.model';\nimport { LoadingState } from './models/state.model';\nimport { Location, ViewState } from './models/view.model';\nimport { QuickTransferJourneyConfigService } from './services/config.service';\nimport { QuickTransferStoreService } from './store/store.service';\nimport { filterByDisabledCombinations } from './utils/arrangement-filter';\nimport { getRouteParams } from './utils/helpers';\n\n@Component({\n  selector: 'bb-quick-transfer-journey',\n  templateUrl: 'quick-transfer-journey.component.html',\n  providers: [QuickTransferJourneyConfigService, QuickTransferStoreService],\n  animations: [slideRightAnimation, slideLeftAnimation, fadeInAnimation, slideUpAnimation],\n})\nexport class QuickTransferJourneyComponent implements OnInit, OnDestroy {\n  subscription$ = new Subscription();\n  /**\n   * Enum for current View\n   */\n  readonly viewState = ViewState;\n  /**\n   * Stream of the current view\n   */\n  readonly currentView$: Observable<ViewState | undefined> = this.store.currentView$;\n\n  /**\n   * Success image path\n   */\n  readonly successImg = 'assets/bb-quick-transfer-widget-ang/succeed.svg';\n  /**\n   * Fail image path\n   */\n  readonly successImgNoMotion = 'assets/bb-quick-transfer-widget-ang/no-motion.svg';\n\n  constructor(\n    private readonly store: QuickTransferStoreService,\n    private router: Router,\n    private activatedRoute: ActivatedRoute,\n    readonly config: QuickTransferJourneyConfigService,\n  ) {}\n\n  ngOnInit() {\n    this.subscription$ = this.router.events\n      .pipe(\n        filter(event => event instanceof NavigationEnd),\n        startWith(getRouteParams(this.activatedRoute.root)),\n        withLatestFrom(this.store.touchedFields$, this.store.accountsCallState$),\n        map(([_, touchedFields, callState]) => {\n          if (callState === LoadingState.INIT) this.store.fetchAccounts();\n          return !touchedFields?.includes('fromAccount'); // Indicate if there is already selected account by user\n        }),\n        filter(Boolean),\n        concatMap(() => this.applyDisabledCombination(getRouteParams(this.activatedRoute.root).selectedAccount)),\n      )\n      .subscribe(() => {\n        const selectedAccountId = getRouteParams(this.activatedRoute.root).selectedAccount;\n        this.store.selectFromAccount(selectedAccountId);\n      });\n    this.store.updateDefaultCurrency(this.config.fields?.amount?.initialCurrency);\n  }\n\n  ngOnDestroy() {\n    this.store.reset();\n    this.subscription$.unsubscribe();\n  }\n\n  /**\n   * Apply disabled combination filtration for selected product summary item in app level\n   */\n  applyDisabledCombination(id: string) {\n    const { disabledCombinations } = this.config || {};\n    return this.store.debitAccounts$.pipe(\n      filter(Boolean),\n      take(1),\n      withLatestFrom(this.store.toPayee$),\n      map(([acc, toPayee]) => {\n        const _accounts = filterByDisabledCombinations(\n          acc as Arrangement[],\n          toPayee,\n          disabledCombinations,\n          Location.FROM,\n        );\n        return _accounts.some((item: Arrangement) => item.uuid === id);\n      }),\n      filter(Boolean),\n    );\n  }\n}\n","<div class=\"bb-quick-transfer\" *ngIf=\"currentView$ | async as currentView\">\n  <bb-quick-transfer-form-ui\n    [config]=\"config\"\n    *ngIf=\"currentView === viewState.FORM || currentView === viewState.COMPLETE as formView\"\n    [@slideRight]\n  ></bb-quick-transfer-form-ui>\n  <bb-quick-transfer-from-account-ui\n    *ngIf=\"currentView === viewState.FROM as fromView\"\n    [config]=\"config\"\n    [@slideLeft]\n  ></bb-quick-transfer-from-account-ui>\n  <bb-quick-transfer-to-account-ui\n    *ngIf=\"currentView === viewState.PAYEE as payeeView\"\n    [config]=\"config\"\n    [@slideLeft]\n  ></bb-quick-transfer-to-account-ui>\n  <div class=\"bb-quick-transfer__success-overlay\" *ngIf=\"currentView === viewState.COMPLETE\" [@fadeIn]></div>\n  <bb-quick-transfer-complete-ui\n    *ngIf=\"currentView === viewState.COMPLETE\"\n    [successImg]=\"successImg\"\n    [successImgNoMotion]=\"successImgNoMotion\"\n    [config]=\"config\"\n    [@slideUp]\n  ></bb-quick-transfer-complete-ui>\n\n  <bb-quick-transfer-confirmation-modal-ui\n    [paymentTypes]=\"config.paymentTypes\"\n    [config]=\"config\"\n  ></bb-quick-transfer-confirmation-modal-ui>\n</div>\n"]}