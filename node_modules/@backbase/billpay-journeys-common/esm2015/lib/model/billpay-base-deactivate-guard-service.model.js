import { tap } from 'rxjs/operators';
export class BillpayBaseDeactivateGuardService {
    /** @internal */
    constructor(router, location) {
        this.router = router;
        this.location = location;
    }
    canDeactivate(component, currentRoute, currentState, nextState) {
        const isNextRouteAllowed = this.allowedNextRoutes.some(route => route.test(nextState.url));
        const isPreviousRouteAllowed = this.allowedPreviousRoutes.some(route => route.test(currentState.url));
        const isNotSameRoute = currentState.url !== nextState.url;
        const isNavigationAllowed = isNextRouteAllowed && isPreviousRouteAllowed && isNotSameRoute;
        return (isNavigationAllowed ||
            component.openModal().pipe(
            // TODO: Due to Angular issue https://github.com/angular/angular/issues/13586
            tap(canDeactivate => {
                if (!canDeactivate) {
                    const currentUrlTree = this.router.createUrlTree([], currentRoute);
                    this.location.go(currentUrlTree.toString());
                }
            })));
    }
}
//# sourceMappingURL=billpay-base-deactivate-guard-service.model.js.map