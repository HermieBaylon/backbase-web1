{"version":3,"file":"billpay-payee-summary-item-base.component.js","sourceRoot":"","sources":["../../../../../../../libs/billpay-journeys-common/src/lib/components/billpay-payee-summary-item-base/billpay-payee-summary-item-base.component.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAa,MAAM,eAAe,CAAC;AAC5D,OAAO,EAAE,qBAAqB,IAAI,OAAO,EAAE,MAAM,wCAAwC,CAAC;AAE1F,OAAO,EAAE,iBAAiB,EAAE,MAAM,4BAA4B,CAAC;AAC/D,OAAO,EAAE,eAAe,EAAE,iBAAiB,EAAE,MAAM,iBAAiB,CAAC;AACrE,OAAO,EAAE,uBAAuB,EAAE,MAAM,2CAA2C,CAAC;AACpF,OAAO,EAAE,OAAO,EAAE,MAAM,MAAM,CAAC;AAC/B,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;;;;AAG3C,MAAM,OAAgB,oCAAoC;IAwBxD,gBAAgB;IAChB,YACmB,WAAoC,EAClC,oBAAuC;QADzC,gBAAW,GAAX,WAAW,CAAyB;QAClC,yBAAoB,GAApB,oBAAoB,CAAmB;QAlB5D,sBAAiB,GAAG,iBAAiB,CAAC;QACtC,oBAAe,GAAG,eAAe,CAAC;QACzB,yBAAoB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAC5C,kBAAa,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACrC,sBAAiB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACzC,kCAA6B,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACrD,4BAAuB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAC/C,iBAAY,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QACpC,wBAAmB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAC3C,2BAAsB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAC9C,wBAAmB,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAC3C,kBAAa,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;QAErC,aAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;QAOhC,oBAAoB,CAAC,SAAS,GAAG,cAAc,CAAC;IAClD,CAAC;IAED,WAAW;QACT,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;IAC3B,CAAC;IAED,gBAAgB,CAAC,MAAa;QAC5B,MAAM,CAAC,cAAc,EAAE,CAAC;QACxB,IAAI,CAAC,WAAW,CAAC,0BAA0B,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACjE,CAAC;IAED,iBAAiB,CAAC,MAAa;QAC7B,MAAM,CAAC,cAAc,EAAE,CAAC;QACxB,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,SAAS,CAAC;QAEtG,IAAI,CAAC,WAAW,CAAC,yBAAyB,CAAC,KAAK,CAAC,CAAC;IACpD,CAAC;IAED,IAAI,SAAS;QACX,OAAO,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;IAC7F,CAAC;IAED,IAAI,OAAO;QACT,OAAO,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;IAC3D,CAAC;IAED,IAAI,kBAAkB;QACpB,OAAO,IAAI,CAAC,WAAW,CAAC,kBAAkB,CAAC;IAC7C,CAAC;IAED,IAAI,6BAA6B;QAC/B,MAAM,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACvC,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,YAAY,CAAC,oBAAoB,CAAC,CAAC;IAC/D,CAAC;IAED,IAAI,qBAAqB;QACvB,OAAO,IAAI,CAAC,qBAAqB,EAAE,CAAC;IACtC,CAAC;IAED,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC;IAED,IAAI,8BAA8B;QAChC,OAAO,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAC;IACrD,CAAC;IAED,IAAI,yBAAyB;QAC3B,OAAO,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;IAChD,CAAC;IAED,IAAI,uBAAuB;QACzB,OAAO,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;IAC9C,CAAC;IAED,yBAAyB;QACvB,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,IAAI,CAAC,WAAW;iBACb,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC;iBACnC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAC9B,SAAS,CAAC,QAAQ,CAAC,EAAE;gBACpB,IAAI,IAAI,CAAC,4BAA4B,CAAC,QAAQ,CAAC,EAAE;oBAC/C,IAAI,CAAC,eAAe,EAAE,CAAC;iBACxB;qBAAM;oBACL,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;iBACjC;YACH,CAAC,CAAC,CAAC;SACN;IACH,CAAC;IAEO,4BAA4B,CAAC,sBAAsE;QACzG,OAAO,CACL,CAAC,sBAAsB,CAAC,QAAQ,IAAI,sBAAsB,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;YAC/E,CAAC,sBAAsB,CAAC,OAAO,IAAI,sBAAsB,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YAC7E,sBAAsB,CAAC,cAAc;YACrC,sBAAsB,CAAC,YAAY,CACpC,CAAC;IACJ,CAAC;IAED,IAAI,kBAAkB;QACpB,OAAO,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;IACzD,CAAC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,cAAc,EAAE,IAAI,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;IACnF,CAAC;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,eAAe,EAAE,CAAC;IAChC,CAAC;IAED,IAAI,yBAAyB;QAC3B,OAAO,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC;IAC1F,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAClC,CAAC;IAED,IAAI,cAAc;QAChB,OAAO,IAAI,CAAC,cAAc,EAAE,CAAC;IAC/B,CAAC;IAED,IAAI,SAAS;QACX,OAAQ,IAAI,CAAC,YAA6B,CAAC,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,QAAQ,CAAC;IAClF,CAAC;IAEO,qBAAqB;;QAC3B,OAAO,CAAC,CAAC,CAAC,CAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,MAAM,MAAK,QAAQ,CAAC,CAAC;IAC3D,CAAC;IAEO,gBAAgB,CAAC,KAAa;;QACpC,MAAM,YAAY,GAAG,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,CAAC;QAC9C,OAAO,CAAC,CAAC,CAAC,YAAY,IAAI,YAAY,CAAC,MAAM,KAAK,KAAK,CAAC,CAAC;IAC3D,CAAC;IAEO,cAAc;;QACpB,OAAO,CAAC,CAAC,CAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,UAAU,CAAA,CAAC;IAChD,CAAC;IAEO,eAAe;;QACrB,OAAO,CAAC,CAAC,CAAC,CAAA,MAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,UAAU,0CAAE,MAAM,MAAK,MAAM,CAAC,CAAC;IACrE,CAAC;IAEO,iBAAiB;;QACvB,OAAO,CAAA,MAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,UAAU,0CAAE,GAAG,KAAI,EAAE,CAAC;IACzD,CAAC;IAEO,cAAc;;QACpB,OAAO,CAAC,CAAC,CAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,OAAO,CAAA,CAAC;IAC7C,CAAC;IAEO,cAAc;;QACpB,OAAO,CAAC,CAAC,CAAA,MAAA,MAAA,IAAI,CAAC,YAAY,0CAAE,KAAK,0CAAE,OAAO,CAAA,CAAC;IAC7C,CAAC;;qJArKmB,oCAAoC;yIAApC,oCAAoC,8FADnC,EAAE;4FACH,oCAAoC;kBADzD,SAAS;mBAAC,EAAE,QAAQ,EAAE,EAAE,EAAE;8IAShB,YAAY;sBAApB,KAAK","sourcesContent":["import { Component, Input, OnDestroy } from '@angular/core';\nimport { BillpayUtilityService as Utility } from '../../services/billpay-utility.service';\nimport { BillPayPayverisEbillsEnrolmentPostResponseBody, PayeeSummary } from '@backbase/data-ang/billpay';\nimport { NgbDropdownConfig } from '@ng-bootstrap/ng-bootstrap';\nimport { ONE_OFF_PAYMENT, RECURRING_PAYMENT } from '../../constants';\nimport { BillpayPayeeDataService } from '../../services/billpay-payee-data.service';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\n@Component({ template: '' })\nexport abstract class BillpayPayeeSummaryItemBaseComponent implements OnDestroy {\n  /**\n   * This method will be overriden by parent components\n   */\n  abstract handleGetEbills(): void;\n  /**\n   * Details of the payee summary.\n   */\n  @Input() payeeSummary: PayeeSummary | undefined;\n  RECURRING_PAYMENT = RECURRING_PAYMENT;\n  ONE_OFF_PAYMENT = ONE_OFF_PAYMENT;\n  readonly ebillRetrieveErrorId = Utility.generateId();\n  readonly noEbillsDueId = Utility.generateId();\n  readonly ebillsAvailableId = Utility.generateId();\n  readonly recurringPaymentScheduledIdId = Utility.generateId();\n  readonly ebillPaymentScheduledId = Utility.generateId();\n  readonly ebillDueOnId = Utility.generateId();\n  readonly ebillSupportErrorId = Utility.generateId();\n  readonly ebillUserActionErrorId = Utility.generateId();\n  readonly ebillUnknownErrorId = Utility.generateId();\n  readonly payeeAmountId = Utility.generateId();\n\n  readonly destroy$ = new Subject();\n\n  /** @internal */\n  constructor(\n    private readonly dataService: BillpayPayeeDataService,\n    protected readonly dropdownButtonConfig: NgbDropdownConfig,\n  ) {\n    dropdownButtonConfig.placement = 'bottom-right';\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  handleStopEbills($event: Event): void {\n    $event.preventDefault();\n    this.dataService.updateSelectedDeleteEbills(this.payeeSummary);\n  }\n\n  handleDeletePayee($event: Event): void {\n    $event.preventDefault();\n    const payee = (this.payeeSummary && !this.payeeSummary.nextPayment && this.payeeSummary) || undefined;\n\n    this.dataService.updateSelectedDeletePayee(payee);\n  }\n\n  get payeeName(): string {\n    return (this.payeeSummary && (this.payeeSummary.nickName || this.payeeSummary.name)) || '';\n  }\n\n  get payeeId(): string {\n    return (this.payeeSummary && this.payeeSummary.id) || '';\n  }\n\n  get areButtonsDisabled(): boolean {\n    return this.dataService.areButtonsDisabled;\n  }\n\n  get areRecurringPaymentsScheduled(): boolean {\n    const payeeSummary = this.payeeSummary;\n    return !!(payeeSummary && payeeSummary.hasRecurringPayments);\n  }\n\n  get areEbillsInErrorState(): boolean {\n    return this.isEbillsStatusInError();\n  }\n\n  get isEbillsErrorUnknown(): boolean {\n    return this.ebillErrorEquals('ERROR');\n  }\n\n  get isEbillsErrorUpdateCredentials(): boolean {\n    return this.ebillErrorEquals('UPDATE_CREDENTIALS');\n  }\n\n  get isEbillsErrorNotSupported(): boolean {\n    return this.ebillErrorEquals('NOT_SUPPORTED');\n  }\n\n  get isEbillsErrorUserAction(): boolean {\n    return this.ebillErrorEquals('USER_ACTION');\n  }\n\n  handleResolveEbillsErrors(): void {\n    if (this.payeeSummary) {\n      this.dataService\n        .resolveErrors(this.payeeSummary.id)\n        .pipe(takeUntil(this.destroy$))\n        .subscribe(response => {\n          if (this.isEbillEnrolmentFlowRequired(response)) {\n            this.handleGetEbills();\n          } else {\n            this.dataService.reloadPayees();\n          }\n        });\n    }\n  }\n\n  private isEbillEnrolmentFlowRequired(ebillEnrolmentResponse: BillPayPayverisEbillsEnrolmentPostResponseBody) {\n    return (\n      (ebillEnrolmentResponse.accounts && ebillEnrolmentResponse.accounts.length > 0) ||\n      (ebillEnrolmentResponse.billers && ebillEnrolmentResponse.billers.length > 0) ||\n      ebillEnrolmentResponse.authentication ||\n      ebillEnrolmentResponse.callBackTime\n    );\n  }\n\n  get areEbillsAvailable(): boolean {\n    return this.isEbillCapable() && !this.isEbillEnabled();\n  }\n\n  get areEbillsDue(): boolean {\n    return this.isEbillEnabled() && this.hasLatestEbill() && !this.latestEbillPaid();\n  }\n\n  get isLatestEbillPaid(): boolean {\n    return this.latestEbillPaid();\n  }\n\n  get areEbillsEnabledButNotDue(): boolean {\n    return this.isEbillEnabled() && !this.hasLatestEbill() && !this.isEbillsStatusInError();\n  }\n\n  get ebillLink(): string {\n    return this.getLatestEbillURL();\n  }\n\n  get showStopEbills(): boolean {\n    return this.isEbillEnabled();\n  }\n\n  get payeeType(): 'manual' | 'electronic' {\n    return (this.payeeSummary as PayeeSummary).electronic ? 'electronic' : 'manual';\n  }\n\n  private isEbillsStatusInError(): boolean {\n    return !!(this.payeeSummary?.ebill?.status !== 'ACTIVE');\n  }\n\n  private ebillErrorEquals(error: string) {\n    const ebillSummary = this.payeeSummary?.ebill;\n    return !!(ebillSummary && ebillSummary.status === error);\n  }\n\n  private hasLatestEbill(): boolean {\n    return !!this.payeeSummary?.ebill?.latestBill;\n  }\n\n  private latestEbillPaid(): boolean {\n    return !!(this.payeeSummary?.ebill?.latestBill?.status === 'PAID');\n  }\n\n  private getLatestEbillURL(): string {\n    return this.payeeSummary?.ebill?.latestBill?.url || '';\n  }\n\n  private isEbillCapable(): boolean {\n    return !!this.payeeSummary?.ebill?.capable;\n  }\n\n  private isEbillEnabled(): boolean {\n    return !!this.payeeSummary?.ebill?.enabled;\n  }\n}\n"]}