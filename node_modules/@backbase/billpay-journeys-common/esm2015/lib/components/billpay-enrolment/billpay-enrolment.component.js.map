{"version":3,"file":"billpay-enrolment.component.js","sourceRoot":"","sources":["../../../../../../../libs/billpay-journeys-common/src/lib/components/billpay-enrolment/billpay-enrolment.component.ts","../../../../../../../libs/billpay-journeys-common/src/lib/components/billpay-enrolment/billpay-enrolment.component.html"],"names":[],"mappings":"AAAA,OAAO,EACL,SAAS,EAET,uBAAuB,EACvB,iBAAiB,EACjB,SAAS,EAET,KAAK,GACN,MAAM,eAAe,CAAC;AACvB,OAAO,EAAE,KAAK,EAAE,MAAM,gBAAgB,CAAC;AACvC,OAAO,EAAE,uBAAuB,EAAE,MAAM,0CAA0C,CAAC;AACnF,OAAO,EAAE,mBAAmB,EAAE,MAAM,+BAA+B,CAAC;;;;;;;;AAOpE,MAAM,OAAO,yBAAyB;IASpC,YACmB,uBAAgD,EAChD,EAAqB,EACrB,mBAAwC;QAFxC,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,OAAE,GAAF,EAAE,CAAmB;QACrB,wBAAmB,GAAnB,mBAAmB,CAAqB;QAX3D,oBAAe,GAAG,KAAK,CAAC;QACxB,YAAO,GAAG,KAAK,CAAC;QAIY,sCAAiC,GAA8B,EAAE,CAAC;QACpE,oCAA+B,GAA8B,EAAE,CAAC;IAMvF,CAAC;IAEJ,QAAQ;QACN,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QAEpB,IAAI,CAAC,uBAAuB;aACzB,UAAU,EAAE;aACZ,IAAI,CAAC,KAAK,EAAE,CAAC;aACb,SAAS,CACR,UAAU,CAAC,EAAE;YACX,IAAI,UAAU,EAAE;gBACd,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;gBACrB,IAAI,CAAC,YAAY,EAAE,CAAC;aACrB;iBAAM;gBACL,IAAI,CAAC,SAAS,EAAE,CAAC;aAClB;QACH,CAAC,EACD,GAAG,EAAE;YACH,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC;QACzB,CAAC,CACF,CAAC;IACN,CAAC;IAED,SAAS;QACP,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC,uBAAuB;aACzB,SAAS,EAAE;aACX,IAAI,CAAC,KAAK,EAAE,CAAC;aACb,SAAS,CAAC,UAAU,CAAC,EAAE;YACtB,IAAI,UAAU,EAAE;gBACd,IAAI,CAAC,cAAc,EAAE,CAAC;aACvB;iBAAM;gBACL,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;YACD,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,cAAc;QACZ,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,mBAAmB,CAAC,gBAAgB,CAAC;YACxC,MAAM,EAAE,IAAI,CAAC,iCAAiC;YAC9C,OAAO,EAAE,EAAE;YACX,QAAQ,EAAE,SAAS;YACnB,GAAG,EAAE,IAAI,CAAC,uBAAuB;SAClC,CAAC,CAAC;QACH,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAED,WAAW;QACT,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,mBAAmB,CAAC,gBAAgB,CAAC;YACxC,MAAM,EAAE,IAAI,CAAC,+BAA+B;YAC5C,OAAO,EAAE,EAAE;YACX,QAAQ,EAAE,OAAO;YACjB,GAAG,EAAE,IAAI,CAAC,uBAAuB;SAClC,CAAC,CAAC;IACL,CAAC;IAED,YAAY;QACV,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;YACzE,IAAI,CAAC,uBAAuB,CAAC,YAAY,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;IACL,CAAC;;0IA/EU,yBAAyB;8HAAzB,yBAAyB,iXClBtC,2zDAkDA;4FDhCa,yBAAyB;kBALrC,SAAS;mBAAC;oBACT,QAAQ,EAAE,sBAAsB;oBAChC,WAAW,EAAE,oCAAoC;oBACjD,eAAe,EAAE,uBAAuB,CAAC,MAAM;iBAChD;gLAKU,uBAAuB;sBAA/B,KAAK;gBAEsB,iCAAiC;sBAA5D,SAAS;uBAAC,eAAe;gBACA,+BAA+B;sBAAxD,SAAS;uBAAC,aAAa","sourcesContent":["import {\n  Component,\n  OnInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  ViewChild,\n  TemplateRef,\n  Input,\n} from '@angular/core';\nimport { first } from 'rxjs/operators';\nimport { BillpayEnrolmentService } from '../../services/billpay-enrolment.service';\nimport { NotificationService } from '@backbase/ui-ang/notification';\n\n@Component({\n  selector: 'bb-billpay-enrolment',\n  templateUrl: './billpay-enrolment.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class BillpayEnrolmentComponent implements OnInit {\n  enrolmentFailed = false;\n  loading = false;\n\n  @Input() notificationDismissTime?: number;\n\n  @ViewChild('successHeader') notificationHeaderSuccessTemplate: TemplateRef<any> | string = '';\n  @ViewChild('errorHeader') notificationHeaderErrorTemplate: TemplateRef<any> | string = '';\n\n  constructor(\n    private readonly billpayEnrolmentService: BillpayEnrolmentService,\n    private readonly cd: ChangeDetectorRef,\n    private readonly notificationService: NotificationService,\n  ) {}\n\n  ngOnInit() {\n    this.loading = true;\n\n    this.billpayEnrolmentService\n      .isEnrolled()\n      .pipe(first())\n      .subscribe(\n        isEnrolled => {\n          if (isEnrolled) {\n            this.loading = false;\n            this.redirectUser();\n          } else {\n            this.enrolUser();\n          }\n        },\n        () => {\n          this.onEnrolFail();\n          this.cd.markForCheck();\n        },\n      );\n  }\n\n  enrolUser() {\n    this.loading = true;\n    this.enrolmentFailed = false;\n    this.billpayEnrolmentService\n      .enrolUser()\n      .pipe(first())\n      .subscribe(isEnrolled => {\n        if (isEnrolled) {\n          this.onEnrolSuccess();\n        } else {\n          this.onEnrolFail();\n        }\n        this.cd.markForCheck();\n      });\n  }\n\n  onEnrolSuccess() {\n    this.loading = false;\n    this.notificationService.showNotification({\n      header: this.notificationHeaderSuccessTemplate,\n      message: '',\n      modifier: 'success',\n      ttl: this.notificationDismissTime,\n    });\n    this.redirectUser();\n  }\n\n  onEnrolFail() {\n    this.loading = false;\n    this.enrolmentFailed = true;\n    this.notificationService.showNotification({\n      header: this.notificationHeaderErrorTemplate,\n      message: '',\n      modifier: 'error',\n      ttl: this.notificationDismissTime,\n    });\n  }\n\n  redirectUser() {\n    this.billpayEnrolmentService.previousRoute.pipe(first()).subscribe(route => {\n      this.billpayEnrolmentService.redirectUser(route || '');\n    });\n  }\n}\n","<div class=\"card card-lg\">\n  <div class=\"card-body\">\n    <div *ngIf=\"loading\">\n      <bb-loading-indicator-ui\n        i18n-text=\"\n          Enrolling in the bill pay service...|Enrolment Widget enrolling text@@bb-billpay-enrolment.enrolling.text\"\n        text=\"Enrolling in the bill pay service...\"\n        loaderSize=\"lg\"\n      ></bb-loading-indicator-ui>\n    </div>\n\n    <div *ngIf=\"enrolmentFailed\">\n      <div class=\"bb-state-container\">\n        <bb-empty-state-ui\n          data-role=\"error-state\"\n          iconSize=\"xxl\"\n          iconColor=\"danger\"\n          iconModifier=\"error-outline\"\n          subtitle=\"Try enrolling again or contact support\"\n          i18n-subtitle=\"\n            Try enrolling again or contact support|Enrolment Widget failure\n            subtitle@@bb-billpay-enrolment.failure.subtitle\"\n          title=\"Enrolment failed\"\n          i18n-title=\"Enrolment failed|Enrolment Widget failure title@@bb-billpay-enrolment.failure.title\"\n        >\n        </bb-empty-state-ui>\n        <div class=\"bb-state-container__footer\">\n          <button\n            bbButton\n            data-role=\"button-enrolment-retry\"\n            (click)=\"enrolUser()\"\n            i18n=\"Try enrolling again|Enrolment Widget Try enrolling again button@@bb-billpay-enrolment.button.tryAgain\"\n          >\n            Try enrolling again\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<ng-template #successHeader>\n  <span i18n=\"Enrolment successful|Enrolment successful message@@b-billpay-enrolment.message.successful\"\n    >Enrolment successful</span\n  >\n</ng-template>\n\n<ng-template #errorHeader>\n  <span i18n=\"Enrolment failed|Enrolment failed message@@b-billpay-enrolment.message.failed\">Enrolment failed</span>\n</ng-template>\n"]}