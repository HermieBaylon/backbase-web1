import { Component, Directive, Input } from '@angular/core';
import { BbTemplate } from '@backbase/foundation-ang/core';
import { convertCommaSeparatedStringToStringArray, filterInputParameters, ManageProfileComponent, ManageProfilePreferencesService, ManageProfileService, } from '@backbase/user-common';
import { BehaviorSubject, of } from 'rxjs';
import { catchError, first, pluck, switchMap, tap } from 'rxjs/operators';
import { UserManageProfileService } from './user-manage-profile.service';
import * as i0 from "@angular/core";
import * as i1 from "./user-manage-profile.service";
import * as i2 from "@backbase/user-common";
import * as i3 from "@backbase/ui-ang/loading-indicator";
import * as i4 from "@backbase/ui-ang/common-error-state";
import * as i5 from "./user-manage-email-addresses/user-manage-email-addresses.component";
import * as i6 from "./user-manage-phone-numbers/user-manage-phone-numbers.component";
import * as i7 from "./user-manage-postal-addresses/user-manage-postal-addresses.component";
import * as i8 from "@backbase/ui-ang/header";
import * as i9 from "@angular/common";
export class UserManageProfileWidgetComponent extends ManageProfileComponent {
    constructor(manageProfileService, manageProfilePreferencesService, cd) {
        super(manageProfilePreferencesService, cd);
        this.manageProfileService = manageProfileService;
        this.manageProfilePreferencesService = manageProfilePreferencesService;
        this.cd = cd;
        this.emailAddressTypesSubject = new BehaviorSubject(undefined);
        this.postalAddressTypesSubject = new BehaviorSubject(undefined);
        this.phoneNumberTypesSubject = new BehaviorSubject(undefined);
        this.maxEmailAddressesSubject = new BehaviorSubject(undefined);
        this.maxPhoneNumbersSubject = new BehaviorSubject(undefined);
        this.maxPostalAddressesSubject = new BehaviorSubject(undefined);
        this.showWidgetHeaderSubject = new BehaviorSubject(undefined);
        this.phoneNumberCountryCodeSubject = new BehaviorSubject(undefined);
        this.phoneNumberDebounceTimeSubject = new BehaviorSubject(undefined);
        this.enablePhoneNumberFormatterSubject = new BehaviorSubject(undefined);
        this.emailAddressTypes = filterInputParameters(this.emailAddressTypesSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('emailAddressTypes')));
        this.postalAddressTypes = filterInputParameters(this.postalAddressTypesSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('postalAddressTypes')));
        this.phoneNumberTypes = filterInputParameters(this.phoneNumberTypesSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('phoneNumberTypes')));
        this.maxEmailAddresses = filterInputParameters(this.maxEmailAddressesSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('maxEmailAddresses')));
        this.maxPhoneNumbers = filterInputParameters(this.maxPhoneNumbersSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('maxPhoneNumbers')));
        this.maxPostalAddresses = filterInputParameters(this.maxPostalAddressesSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('maxPostalAddresses')));
        this.showWidgetHeader = filterInputParameters(this.showWidgetHeaderSubject.asObservable(), this.manageProfilePreferencesService.getWidgetPreferences().pipe(pluck('showWidgetHeader')));
        this.phoneNumberCountryCode = filterInputParameters(this.phoneNumberCountryCodeSubject.asObservable(), this.manageProfilePreferencesService.getPhoneNumberInputPreferences().pipe(pluck('countryCode')));
        this.phoneNumberDebounceTime = filterInputParameters(this.phoneNumberDebounceTimeSubject.asObservable(), this.manageProfilePreferencesService.getPhoneNumberInputPreferences().pipe(pluck('debounceTime')));
        this.enablePhoneNumberFormatter = filterInputParameters(this.enablePhoneNumberFormatterSubject.asObservable(), this.manageProfilePreferencesService
            .getPhoneNumberInputPreferences()
            .pipe(switchMap((preferences) => of((preferences && preferences.enablePhoneNumberFormatter) || false))));
    }
    set emailAddressTypesValue(value) {
        this.emailAddressTypesSubject.next(typeof value === 'string' ? this.convertCommaSeparatedStringToStringArray(value) : value);
    }
    set postalAddressTypesValue(value) {
        this.postalAddressTypesSubject.next(typeof value === 'string' ? this.convertCommaSeparatedStringToStringArray(value) : value);
    }
    set phoneNumberTypesValue(value) {
        this.phoneNumberTypesSubject.next(typeof value === 'string' ? this.convertCommaSeparatedStringToStringArray(value) : value);
    }
    set maxEmailAddressesValue(value) {
        this.maxEmailAddressesSubject.next(value);
    }
    set maxPhoneNumbersValue(value) {
        this.maxPhoneNumbersSubject.next(value);
    }
    set maxPostalAddressesValue(value) {
        this.maxPostalAddressesSubject.next(value);
    }
    set showWidgetHeaderValue(value) {
        this.showWidgetHeaderSubject.next(typeof value === 'string' ? !!value && value !== 'false' : value);
    }
    set phoneNumberCountryCodeValue(value) {
        this.phoneNumberCountryCodeSubject.next(value);
    }
    set phoneNumberDebounceTimeValue(value) {
        this.phoneNumberDebounceTimeSubject.next(value);
    }
    set enablePhoneNumberFormatterValue(value) {
        this.enablePhoneNumberFormatterSubject.next(typeof value === 'string' ? value === 'true' : value);
    }
    ngOnInit() {
        super.ngOnInit();
        if (this.notificationDismissTime) {
            this.dismissTimeout = this.notificationDismissTime * 1000;
        }
        else {
            this.manageProfilePreferencesService
                .getNotificationDismissTimePreference()
                .pipe(first())
                .subscribe((time) => (this.dismissTimeout = time * 1000));
        }
    }
    convertCommaSeparatedStringToStringArray(value) {
        return convertCommaSeparatedStringToStringArray(value);
    }
    setUserProfileObservable() {
        return this.userProfileSubject.asObservable().pipe(tap(this.onProfileUpdate), switchMap(() => this.manageProfileService.getUserProfile()), tap(() => (this.loadingState = false)), catchError(this.handleProfileError));
    }
}
UserManageProfileWidgetComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageProfileWidgetComponent, deps: [{ token: i1.UserManageProfileService }, { token: i2.ManageProfilePreferencesService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
UserManageProfileWidgetComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: UserManageProfileWidgetComponent, selector: "bb-user-manage-profile-widget", inputs: { emailAddressTypesValue: ["emailAddressTypes", "emailAddressTypesValue"], postalAddressTypesValue: ["postalAddressTypes", "postalAddressTypesValue"], phoneNumberTypesValue: ["phoneNumberTypes", "phoneNumberTypesValue"], maxEmailAddressesValue: ["maxEmailAddresses", "maxEmailAddressesValue"], maxPhoneNumbersValue: ["maxPhoneNumbers", "maxPhoneNumbersValue"], maxPostalAddressesValue: ["maxPostalAddresses", "maxPostalAddressesValue"], showWidgetHeaderValue: ["showWidgetHeader", "showWidgetHeaderValue"], phoneNumberCountryCodeValue: ["phoneNumberCountryCode", "phoneNumberCountryCodeValue"], phoneNumberDebounceTimeValue: ["phoneNumberDebounceTime", "phoneNumberDebounceTimeValue"], enablePhoneNumberFormatterValue: ["enablePhoneNumberFormatter", "enablePhoneNumberFormatterValue"] }, providers: [UserManageProfileService, ManageProfilePreferencesService, ManageProfileService], usesInheritance: true, ngImport: i0, template: "<ng-container bbUserManageWidgetCustomizable [bbHostRef]=\"this\">\n</ng-container>\n\n<ng-template bbUserManageWidgetCustomizable let-hostRef>\n  <section>\n    <bb-loading-indicator-ui\n      *ngIf=\"hostRef.loadingState\"\n      i18n-text=\"User Profile loading message|Message for when the user profile is loading@@bb-user-manage-profile.bb-loading-indicator-ui\"\n      text=\"Loading...\">\n    </bb-loading-indicator-ui>\n\n    <bb-common-error-state-ui\n      *ngIf=\"hostRef.loadingErrorState\"\n      class=\"bb-state-container\"\n      [error]=\"hostRef.loadingError\"\n      data-role=\"user-manage-profile-error-state\">\n    </bb-common-error-state-ui>\n\n    <div *ngIf=\"!hostRef.loadingState && !hostRef.loadingErrorState && hostRef.userProfile\">\n      <ng-container bbUserManageWidgetTitleCustomizable\n        *ngIf=\"hostRef.showWidgetHeader | async\"\n        [bbHostRef]=\"hostRef\">\n      </ng-container>\n      <div>\n        <div class=\"bb-block bb-block--xl\">\n          <bb-user-manage-email-addresses\n            [emailAddresses]=\"hostRef.userProfile['electronic-addresses']\"\n            [emailAddressTypes]=\"hostRef.emailAddressTypes | async\"\n            [maxEmailAddresses]=\"hostRef.maxEmailAddresses | async\"\n            (updateProfile)=\"hostRef.refreshProfileData()\"\n            (manageEmail)=\"hostRef.handleManageAddressOpen()\"\n            (cancelManageEmail)=\"hostRef.handleManageAddressClose()\"\n            [disableManage]=\"hostRef.disableAddressManaging\"\n            [dismissTimeout]=\"hostRef.dismissTimeout\">\n          </bb-user-manage-email-addresses>\n        </div>\n        <div class=\"bb-block bb-block--xl\">\n          <bb-user-manage-phone-numbers\n            [phoneNumbers]=\"hostRef.userProfile['phone-addresses']\"\n            [phoneNumberTypes]=\"hostRef.phoneNumberTypes | async\"\n            [maxPhoneNumbers]=\"hostRef.maxPhoneNumbers | async\"\n            (updateProfile)=\"hostRef.refreshProfileData()\"\n            (managePhoneNumber)=\"hostRef.handleManageAddressOpen()\"\n            (cancelManagePhoneNumber)=\"hostRef.handleManageAddressClose()\"\n            [disableManage]=\"hostRef.disableAddressManaging\"\n            [dismissTimeout]=\"hostRef.dismissTimeout\"\n\n            [phoneNumberCountryCode]=\"hostRef.phoneNumberCountryCode | async\"\n            [phoneNumberDebounceTime]=\"hostRef.phoneNumberDebounceTime | async\"\n            [enablePhoneNumberFormatter]=\"hostRef.enablePhoneNumberFormatter | async\">\n          </bb-user-manage-phone-numbers>\n        </div>\n        <div class=\"bb-block bb-block--xl\">\n          <bb-user-manage-postal-addresses\n            [postalAddresses]=\"hostRef.userProfile['postal-addresses']\"\n            [postalAddressTypes]=\"hostRef.postalAddressTypes | async\"\n            [maxPostalAddresses]=\"hostRef.maxPostalAddresses | async\"\n            (updateProfile)=\"hostRef.refreshProfileData()\"\n            (managePostalAddress)=\"hostRef.handleManageAddressOpen()\"\n            (cancelManagePostalAddress)=\"hostRef.handleManageAddressClose()\"\n            [disableManage]=\"hostRef.disableAddressManaging\"\n            [dismissTimeout]=\"hostRef.dismissTimeout\">\n          </bb-user-manage-postal-addresses>\n        </div>\n      </div>\n    </div>\n  </section>\n</ng-template>\n\n<ng-template bbUserManageWidgetTitleCustomizable let-hostRef>\n  <div class=\"bb-block bb-block--md\">\n    <bb-header-ui\n      headingType=\"h2\"\n      data-role=\"user-manage-profile-user-name\"\n      [heading]=\"hostRef.userProfile.fullName\">\n    </bb-header-ui>\n  </div>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i3.LoadingIndicatorComponent; }), selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i0.forwardRef(function () { return i4.ErrorCommonStateComponent; }), selector: "bb-common-error-state-ui", inputs: ["error"] }, { type: i0.forwardRef(function () { return i5.UserManageEmailAddressesComponent; }), selector: "bb-user-manage-email-addresses" }, { type: i0.forwardRef(function () { return i6.UserManagePhoneNumbersComponent; }), selector: "bb-user-manage-phone-numbers", inputs: ["phoneNumberCountryCode", "phoneNumberDebounceTime", "enablePhoneNumberFormatter"] }, { type: i0.forwardRef(function () { return i7.UserManagePostalAddressesComponent; }), selector: "bb-user-manage-postal-addresses" }, { type: i0.forwardRef(function () { return i8.HeaderComponent; }), selector: "bb-header-ui", inputs: ["headingClasses", "headingType", "heading"] }], directives: [{ type: i0.forwardRef(function () { return UserManageWidgetCustomizableDirective; }), selector: "[bbUserManageWidgetCustomizable]" }, { type: i0.forwardRef(function () { return i9.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return UserManageWidgetTitleCustomizableDirective; }), selector: "[bbUserManageWidgetTitleCustomizable]" }], pipes: { "async": i0.forwardRef(function () { return i9.AsyncPipe; }) } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageProfileWidgetComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-user-manage-profile-widget',
                    templateUrl: './user-manage-profile-widget.component.html',
                    providers: [UserManageProfileService, ManageProfilePreferencesService, ManageProfileService],
                }]
        }], ctorParameters: function () { return [{ type: i1.UserManageProfileService }, { type: i2.ManageProfilePreferencesService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { emailAddressTypesValue: [{
                type: Input,
                args: ['emailAddressTypes']
            }], postalAddressTypesValue: [{
                type: Input,
                args: ['postalAddressTypes']
            }], phoneNumberTypesValue: [{
                type: Input,
                args: ['phoneNumberTypes']
            }], maxEmailAddressesValue: [{
                type: Input,
                args: ['maxEmailAddresses']
            }], maxPhoneNumbersValue: [{
                type: Input,
                args: ['maxPhoneNumbers']
            }], maxPostalAddressesValue: [{
                type: Input,
                args: ['maxPostalAddresses']
            }], showWidgetHeaderValue: [{
                type: Input,
                args: ['showWidgetHeader']
            }], phoneNumberCountryCodeValue: [{
                type: Input,
                args: ['phoneNumberCountryCode']
            }], phoneNumberDebounceTimeValue: [{
                type: Input,
                args: ['phoneNumberDebounceTime']
            }], enablePhoneNumberFormatterValue: [{
                type: Input,
                args: ['enablePhoneNumberFormatter']
            }] } });
export class UserManageWidgetCustomizableDirective extends BbTemplate {
}
UserManageWidgetCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageWidgetCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
UserManageWidgetCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.15", type: UserManageWidgetCustomizableDirective, selector: "[bbUserManageWidgetCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageWidgetCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbUserManageWidgetCustomizable]',
                }]
        }] });
export class UserManageWidgetTitleCustomizableDirective extends BbTemplate {
}
UserManageWidgetTitleCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageWidgetTitleCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
UserManageWidgetTitleCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.15", type: UserManageWidgetTitleCustomizableDirective, selector: "[bbUserManageWidgetTitleCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: UserManageWidgetTitleCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbUserManageWidgetTitleCustomizable]',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1tYW5hZ2UtcHJvZmlsZS13aWRnZXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy91c2VyLW1hbmFnZS1wcm9maWxlLXdpZGdldC9zcmMvdXNlci1tYW5hZ2UtcHJvZmlsZS13aWRnZXQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vbGlicy91c2VyLW1hbmFnZS1wcm9maWxlLXdpZGdldC9zcmMvdXNlci1tYW5hZ2UtcHJvZmlsZS13aWRnZXQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFxQixTQUFTLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN2RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFM0QsT0FBTyxFQUNMLHdDQUF3QyxFQUN4QyxxQkFBcUIsRUFDckIsc0JBQXNCLEVBQ3RCLCtCQUErQixFQUMvQixvQkFBb0IsR0FFckIsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQUUsZUFBZSxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTFFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7Ozs7Ozs7OztBQU96RSxNQUFNLE9BQU8sZ0NBQWlDLFNBQVEsc0JBQXNCO0lBa0cxRSxZQUNtQixvQkFBOEMsRUFDNUMsK0JBQWdFLEVBQ2hFLEVBQXFCO1FBRXhDLEtBQUssQ0FBQywrQkFBK0IsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUoxQix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQTBCO1FBQzVDLG9DQUErQixHQUEvQiwrQkFBK0IsQ0FBaUM7UUFDaEUsT0FBRSxHQUFGLEVBQUUs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QUs7dUJBQUMsb0JBQW9CO2dCQUtJLHFCQUFxQjtzQkFBbkQsS0FBSzt1QkFBQyxrQkFBa0I7Z0JBS08sc0JBQXNCO3NCQUFyRCxLQUFLO3VCQUFDLG1CQUFtQjtnQkFHSSxvQkFBb0I7c0JBQWpELEtBQUs7dUJBQUMsaUJBQWlCO2dCQUdTLHVCQUF1QjtzQkFBdkQsS0FBSzt1QkFBQyxvQkFBb0I7Z0JBR0kscUJBQXFCO3NCQUFuRCxLQUFLO3VCQUFDLGtCQUFrQjtnQkFHWSwyQkFBMkI7c0JBQS9ELEtBQUs7dUJBQUMsd0JBQXdCO2dCQUdPLDRCQUE0QjtzQkFBakUsS0FBSzt1QkFBQyx5QkFBeUI7Z0JBR1MsK0JBQStCO3NCQUF2RSxLQUFLO3VCQUFDLDRCQUE0Qjs7QUFvR3JDLE1BQU0sT0FBTyxxQ0FBc0MsU0FBUSxVQUF1RDs7bUlBQXJHLHFDQUFxQzt1SEFBckMscUNBQXFDOzRGQUFyQyxxQ0FBcUM7a0JBSGpELFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGtDQUFrQztpQkFDN0M7O0FBTUQsTUFBTSxPQUFPLDBDQUEyQyxTQUFRLFVBRy9EOzt3SUFIWSwwQ0FBMEM7NEhBQTFDLDBDQUEwQzs0RkFBMUMsMENBQTBDO2tCQUh0RCxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSx1Q0FBdUM7aUJBQ2xEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRGlyZWN0aXZlLCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCYlRlbXBsYXRlIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgQ291bnRyeUNvZGUgfSBmcm9tICdAYmFja2Jhc2UvcGhvbmUtbnVtYmVyLWxpYic7XG5pbXBvcnQge1xuICBjb252ZXJ0Q29tbWFTZXBhcmF0ZWRTdHJpbmdUb1N0cmluZ0FycmF5LFxuICBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMsXG4gIE1hbmFnZVByb2ZpbGVDb21wb25lbnQsXG4gIE1hbmFnZVByb2ZpbGVQcmVmZXJlbmNlc1NlcnZpY2UsXG4gIE1hbmFnZVByb2ZpbGVTZXJ2aWNlLFxuICBQaG9uZU51bWJlcklucHV0UHJlZmVyZW5jZXMsXG59IGZyb20gJ0BiYWNrYmFzZS91c2VyLWNvbW1vbic7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBmaXJzdCwgcGx1Y2ssIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgVXNlclByb2ZpbGUgfSBmcm9tICcuL3R5cGVzL3VzZXItdHlwZXMnO1xuaW1wb3J0IHsgVXNlck1hbmFnZVByb2ZpbGVTZXJ2aWNlIH0gZnJvbSAnLi91c2VyLW1hbmFnZS1wcm9maWxlLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi11c2VyLW1hbmFnZS1wcm9maWxlLXdpZGdldCcsXG4gIHRlbXBsYXRlVXJsOiAnLi91c2VyLW1hbmFnZS1wcm9maWxlLXdpZGdldC5jb21wb25lbnQuaHRtbCcsXG4gIHByb3ZpZGVyczogW1VzZXJNYW5hZ2VQcm9maWxlU2VydmljZSwgTWFuYWdlUHJvZmlsZVByZWZlcmVuY2VzU2VydmljZSwgTWFuYWdlUHJvZmlsZVNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBVc2VyTWFuYWdlUHJvZmlsZVdpZGdldENvbXBvbmVudCBleHRlbmRzIE1hbmFnZVByb2ZpbGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBwdWJsaWMgZGlzbWlzc1RpbWVvdXQ6IG51bWJlciB8IHVuZGVmaW5lZDtcblxuICBASW5wdXQoJ2VtYWlsQWRkcmVzc1R5cGVzJykgc2V0IGVtYWlsQWRkcmVzc1R5cGVzVmFsdWUodmFsdWU6IEFycmF5PHN0cmluZz4gfCBzdHJpbmcpIHtcbiAgICB0aGlzLmVtYWlsQWRkcmVzc1R5cGVzU3ViamVjdC5uZXh0KFxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHRoaXMuY29udmVydENvbW1hU2VwYXJhdGVkU3RyaW5nVG9TdHJpbmdBcnJheSh2YWx1ZSkgOiB2YWx1ZSxcbiAgICApO1xuICB9XG4gIEBJbnB1dCgncG9zdGFsQWRkcmVzc1R5cGVzJykgc2V0IHBvc3RhbEFkZHJlc3NUeXBlc1ZhbHVlKHZhbHVlOiBBcnJheTxzdHJpbmc+IHwgc3RyaW5nKSB7XG4gICAgdGhpcy5wb3N0YWxBZGRyZXNzVHlwZXNTdWJqZWN0Lm5leHQoXG4gICAgICB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdGhpcy5jb252ZXJ0Q29tbWFTZXBhcmF0ZWRTdHJpbmdUb1N0cmluZ0FycmF5KHZhbHVlKSA6IHZhbHVlLFxuICAgICk7XG4gIH1cbiAgQElucHV0KCdwaG9uZU51bWJlclR5cGVzJykgc2V0IHBob25lTnVtYmVyVHlwZXNWYWx1ZSh2YWx1ZTogQXJyYXk8c3RyaW5nPiB8IHN0cmluZykge1xuICAgIHRoaXMucGhvbmVOdW1iZXJUeXBlc1N1YmplY3QubmV4dChcbiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB0aGlzLmNvbnZlcnRDb21tYVNlcGFyYXRlZFN0cmluZ1RvU3RyaW5nQXJyYXkodmFsdWUpIDogdmFsdWUsXG4gICAgKTtcbiAgfVxuICBASW5wdXQoJ21heEVtYWlsQWRkcmVzc2VzJykgc2V0IG1heEVtYWlsQWRkcmVzc2VzVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMubWF4RW1haWxBZGRyZXNzZXNTdWJqZWN0Lm5leHQodmFsdWUpO1xuICB9XG4gIEBJbnB1dCgnbWF4UGhvbmVOdW1iZXJzJykgc2V0IG1heFBob25lTnVtYmVyc1ZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLm1heFBob25lTnVtYmVyc1N1YmplY3QubmV4dCh2YWx1ZSk7XG4gIH1cbiAgQElucHV0KCdtYXhQb3N0YWxBZGRyZXNzZXMnKSBzZXQgbWF4UG9zdGFsQWRkcmVzc2VzVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMubWF4UG9zdGFsQWRkcmVzc2VzU3ViamVjdC5uZXh0KHZhbHVlKTtcbiAgfVxuICBASW5wdXQoJ3Nob3dXaWRnZXRIZWFkZXInKSBzZXQgc2hvd1dpZGdldEhlYWRlclZhbHVlKHZhbHVlOiBib29sZWFuIHwgc3RyaW5nKSB7XG4gICAgdGhpcy5zaG93V2lkZ2V0SGVhZGVyU3ViamVjdC5uZXh0KHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyAhIXZhbHVlICYmIHZhbHVlICE9PSAnZmFsc2UnIDogdmFsdWUpO1xuICB9XG4gIEBJbnB1dCgncGhvbmVOdW1iZXJDb3VudHJ5Q29kZScpIHNldCBwaG9uZU51bWJlckNvdW50cnlDb2RlVmFsdWUodmFsdWU6IENvdW50cnlDb2RlKSB7XG4gICAgdGhpcy5waG9uZU51bWJlckNvdW50cnlDb2RlU3ViamVjdC5uZXh0KHZhbHVlKTtcbiAgfVxuICBASW5wdXQoJ3Bob25lTnVtYmVyRGVib3VuY2VUaW1lJykgc2V0IHBob25lTnVtYmVyRGVib3VuY2VUaW1lVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMucGhvbmVOdW1iZXJEZWJvdW5jZVRpbWVTdWJqZWN0Lm5leHQodmFsdWUpO1xuICB9XG4gIEBJbnB1dCgnZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXInKSBzZXQgZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXJWYWx1ZSh2YWx1ZTogYm9vbGVhbiB8IHN0cmluZykge1xuICAgIHRoaXMuZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXJTdWJqZWN0Lm5leHQodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlID09PSAndHJ1ZScgOiB2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIHJlYWRvbmx5IGVtYWlsQWRkcmVzc1R5cGVzU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QXJyYXk8c3RyaW5nPiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBwb3N0YWxBZGRyZXNzVHlwZXNTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxBcnJheTxzdHJpbmc+IHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHBob25lTnVtYmVyVHlwZXNTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxBcnJheTxzdHJpbmc+IHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heEVtYWlsQWRkcmVzc2VzU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVtYmVyIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heFBob25lTnVtYmVyc1N1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhQb3N0YWxBZGRyZXNzZXNTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxudW1iZXIgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2hvd1dpZGdldEhlYWRlclN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4gfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgcGhvbmVOdW1iZXJDb3VudHJ5Q29kZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvdW50cnlDb2RlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHBob25lTnVtYmVyRGVib3VuY2VUaW1lU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVtYmVyIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IGVuYWJsZVBob25lTnVtYmVyRm9ybWF0dGVyU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuICByZWFkb25seSBlbWFpbEFkZHJlc3NUeXBlczogT2JzZXJ2YWJsZTxBcnJheTxzdHJpbmc+PiA9IGZpbHRlcklucHV0UGFyYW1ldGVycyhcbiAgICB0aGlzLmVtYWlsQWRkcmVzc1R5cGVzU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLm1hbmFnZVByb2ZpbGVQcmVmZXJlbmNlc1NlcnZpY2UuZ2V0V2lkZ2V0UHJlZmVyZW5jZXMoKS5waXBlKHBsdWNrKCdlbWFpbEFkZHJlc3NUeXBlcycpKSxcbiAgKTtcbiAgcmVhZG9ubHkgcG9zdGFsQWRkcmVzc1R5cGVzOiBPYnNlcnZhYmxlPEFycmF5PHN0cmluZz4+ID0gZmlsdGVySW5wdXRQYXJhbWV0ZXJzKFxuICAgIHRoaXMucG9zdGFsQWRkcmVzc1R5cGVzU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLm1hbmFnZVByb2ZpbGVQcmVmZXJlbmNlc1NlcnZpY2UuZ2V0V2lkZ2V0UHJlZmVyZW5jZXMoKS5waXBlKHBsdWNrKCdwb3N0YWxBZGRyZXNzVHlwZXMnKSksXG4gICk7XG4gIHJlYWRvbmx5IHBob25lTnVtYmVyVHlwZXM6IE9ic2VydmFibGU8QXJyYXk8c3RyaW5nPj4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5waG9uZU51bWJlclR5cGVzU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLm1hbmFnZVByb2ZpbGVQcmVmZXJlbmNlc1NlcnZpY2UuZ2V0V2lkZ2V0UHJlZmVyZW5jZXMoKS5waXBlKHBsdWNrKCdwaG9uZU51bWJlclR5cGVzJykpLFxuICApO1xuICByZWFkb25seSBtYXhFbWFpbEFkZHJlc3NlczogT2JzZXJ2YWJsZTxudW1iZXI+ID0gZmlsdGVySW5wdXRQYXJhbWV0ZXJzKFxuICAgIHRoaXMubWF4RW1haWxBZGRyZXNzZXNTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLFxuICAgIHRoaXMubWFuYWdlUHJvZmlsZVByZWZlcmVuY2VzU2VydmljZS5nZXRXaWRnZXRQcmVmZXJlbmNlcygpLnBpcGUocGx1Y2soJ21heEVtYWlsQWRkcmVzc2VzJykpLFxuICApO1xuICByZWFkb25seSBtYXhQaG9uZU51bWJlcnM6IE9ic2VydmFibGU8bnVtYmVyPiA9IGZpbHRlcklucHV0UGFyYW1ldGVycyhcbiAgICB0aGlzLm1heFBob25lTnVtYmVyc1N1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlLmdldFdpZGdldFByZWZlcmVuY2VzKCkucGlwZShwbHVjaygnbWF4UGhvbmVOdW1iZXJzJykpLFxuICApO1xuICByZWFkb25seSBtYXhQb3N0YWxBZGRyZXNzZXM6IE9ic2VydmFibGU8bnVtYmVyPiA9IGZpbHRlcklucHV0UGFyYW1ldGVycyhcbiAgICB0aGlzLm1heFBvc3RhbEFkZHJlc3Nlc1N1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlLmdldFdpZGdldFByZWZlcmVuY2VzKCkucGlwZShwbHVjaygnbWF4UG9zdGFsQWRkcmVzc2VzJykpLFxuICApO1xuICByZWFkb25seSBzaG93V2lkZ2V0SGVhZGVyOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gZmlsdGVySW5wdXRQYXJhbWV0ZXJzKFxuICAgIHRoaXMuc2hvd1dpZGdldEhlYWRlclN1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlLmdldFdpZGdldFByZWZlcmVuY2VzKCkucGlwZShwbHVjaygnc2hvd1dpZGdldEhlYWRlcicpKSxcbiAgKTtcbiAgcmVhZG9ubHkgcGhvbmVOdW1iZXJDb3VudHJ5Q29kZTogT2JzZXJ2YWJsZTxDb3VudHJ5Q29kZT4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5waG9uZU51bWJlckNvdW50cnlDb2RlU3ViamVjdC5hc09ic2VydmFibGUoKSxcbiAgICB0aGlzLm1hbmFnZVByb2ZpbGVQcmVmZXJlbmNlc1NlcnZpY2UuZ2V0UGhvbmVOdW1iZXJJbnB1dFByZWZlcmVuY2VzKCkucGlwZShwbHVjaygnY291bnRyeUNvZGUnKSksXG4gICk7XG4gIHJlYWRvbmx5IHBob25lTnVtYmVyRGVib3VuY2VUaW1lOiBPYnNlcnZhYmxlPG51bWJlcj4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5waG9uZU51bWJlckRlYm91bmNlVGltZVN1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlLmdldFBob25lTnVtYmVySW5wdXRQcmVmZXJlbmNlcygpLnBpcGUocGx1Y2soJ2RlYm91bmNlVGltZScpKSxcbiAgKTtcbiAgcmVhZG9ubHkgZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXI6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSBmaWx0ZXJJbnB1dFBhcmFtZXRlcnMoXG4gICAgdGhpcy5lbmFibGVQaG9uZU51bWJlckZvcm1hdHRlclN1YmplY3QuYXNPYnNlcnZhYmxlKCksXG4gICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAuZ2V0UGhvbmVOdW1iZXJJbnB1dFByZWZlcmVuY2VzKClcbiAgICAgIC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKHByZWZlcmVuY2VzOiBQaG9uZU51bWJlcklucHV0UHJlZmVyZW5jZXMgfCB1bmRlZmluZWQpID0+XG4gICAgICAgICAgb2YoKHByZWZlcmVuY2VzICYmIHByZWZlcmVuY2VzLmVuYWJsZVBob25lTnVtYmVyRm9ybWF0dGVyKSB8fCBmYWxzZSksXG4gICAgICAgICksXG4gICAgICApLFxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWFuYWdlUHJvZmlsZVNlcnZpY2U6IFVzZXJNYW5hZ2VQcm9maWxlU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgbWFuYWdlUHJvZmlsZVByZWZlcmVuY2VzU2VydmljZTogTWFuYWdlUHJvZmlsZVByZWZlcmVuY2VzU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICApIHtcbiAgICBzdXBlcihtYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlLCBjZCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuXG4gICAgaWYgKHRoaXMubm90aWZpY2F0aW9uRGlzbWlzc1RpbWUpIHtcbiAgICAgIHRoaXMuZGlzbWlzc1RpbWVvdXQgPSB0aGlzLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lICogMTAwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tYW5hZ2VQcm9maWxlUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAgIC5nZXROb3RpZmljYXRpb25EaXNtaXNzVGltZVByZWZlcmVuY2UoKVxuICAgICAgICAucGlwZShmaXJzdCgpKVxuICAgICAgICAuc3Vic2NyaWJlKCh0aW1lKSA9PiAodGhpcy5kaXNtaXNzVGltZW91dCA9IHRpbWUgKiAxMDAwKSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNvbnZlcnRDb21tYVNlcGFyYXRlZFN0cmluZ1RvU3RyaW5nQXJyYXkodmFsdWU6IHN0cmluZykge1xuICAgIHJldHVybiBjb252ZXJ0Q29tbWFTZXBhcmF0ZWRTdHJpbmdUb1N0cmluZ0FycmF5KHZhbHVlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRVc2VyUHJvZmlsZU9ic2VydmFibGUoKTogT2JzZXJ2YWJsZTxVc2VyUHJvZmlsZT4ge1xuICAgIHJldHVybiB0aGlzLnVzZXJQcm9maWxlU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxuICAgICAgdGFwKHRoaXMub25Qcm9maWxlVXBkYXRlKSxcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLm1hbmFnZVByb2ZpbGVTZXJ2aWNlLmdldFVzZXJQcm9maWxlKCkpLFxuICAgICAgdGFwKCgpID0+ICh0aGlzLmxvYWRpbmdTdGF0ZSA9IGZhbHNlKSksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlUHJvZmlsZUVycm9yKSxcbiAgICApO1xuICB9XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tiYlVzZXJNYW5hZ2VXaWRnZXRDdXN0b21pemFibGVdJyxcbn0pXG5leHBvcnQgY2xhc3MgVXNlck1hbmFnZVdpZGdldEN1c3RvbWl6YWJsZURpcmVjdGl2ZSBleHRlbmRzIEJiVGVtcGxhdGU8VXNlck1hbmFnZVByb2ZpbGVXaWRnZXRDb21wb25lbnQsIHVuZGVmaW5lZD4ge31cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2JiVXNlck1hbmFnZVdpZGdldFRpdGxlQ3VzdG9taXphYmxlXScsXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJNYW5hZ2VXaWRnZXRUaXRsZUN1c3RvbWl6YWJsZURpcmVjdGl2ZSBleHRlbmRzIEJiVGVtcGxhdGU8XG4gIFVzZXJNYW5hZ2VQcm9maWxlV2lkZ2V0Q29tcG9uZW50LFxuICB1bmRlZmluZWRcbj4ge31cbiIsIjxuZy1jb250YWluZXIgYmJVc2VyTWFuYWdlV2lkZ2V0Q3VzdG9taXphYmxlIFtiYkhvc3RSZWZdPVwidGhpc1wiPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy10ZW1wbGF0ZSBiYlVzZXJNYW5hZ2VXaWRnZXRDdXN0b21pemFibGUgbGV0LWhvc3RSZWY+XG4gIDxzZWN0aW9uPlxuICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aVxuICAgICAgKm5nSWY9XCJob3N0UmVmLmxvYWRpbmdTdGF0ZVwiXG4gICAgICBpMThuLXRleHQ9XCJVc2VyIFByb2ZpbGUgbG9hZGluZyBtZXNzYWdlfE1lc3NhZ2UgZm9yIHdoZW4gdGhlIHVzZXIgcHJvZmlsZSBpcyBsb2FkaW5nQEBiYi11c2VyLW1hbmFnZS1wcm9maWxlLmJiLWxvYWRpbmctaW5kaWNhdG9yLXVpXCJcbiAgICAgIHRleHQ9XCJMb2FkaW5nLi4uXCI+XG4gICAgPC9iYi1sb2FkaW5nLWluZGljYXRvci11aT5cblxuICAgIDxiYi1jb21tb24tZXJyb3Itc3RhdGUtdWlcbiAgICAgICpuZ0lmPVwiaG9zdFJlZi5sb2FkaW5nRXJyb3JTdGF0ZVwiXG4gICAgICBjbGFzcz1cImJiLXN0YXRlLWNvbnRhaW5lclwiXG4gICAgICBbZXJyb3JdPVwiaG9zdFJlZi5sb2FkaW5nRXJyb3JcIlxuICAgICAgZGF0YS1yb2xlPVwidXNlci1tYW5hZ2UtcHJvZmlsZS1lcnJvci1zdGF0ZVwiPlxuICAgIDwvYmItY29tbW9uLWVycm9yLXN0YXRlLXVpPlxuXG4gICAgPGRpdiAqbmdJZj1cIiFob3N0UmVmLmxvYWRpbmdTdGF0ZSAmJiAhaG9zdFJlZi5sb2FkaW5nRXJyb3JTdGF0ZSAmJiBob3N0UmVmLnVzZXJQcm9maWxlXCI+XG4gICAgICA8bmctY29udGFpbmVyIGJiVXNlck1hbmFnZVdpZGdldFRpdGxlQ3VzdG9taXphYmxlXG4gICAgICAgICpuZ0lmPVwiaG9zdFJlZi5zaG93V2lkZ2V0SGVhZGVyIHwgYXN5bmNcIlxuICAgICAgICBbYmJIb3N0UmVmXT1cImhvc3RSZWZcIj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPGRpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS14bFwiPlxuICAgICAgICAgIDxiYi11c2VyLW1hbmFnZS1lbWFpbC1hZGRyZXNzZXNcbiAgICAgICAgICAgIFtlbWFpbEFkZHJlc3Nlc109XCJob3N0UmVmLnVzZXJQcm9maWxlWydlbGVjdHJvbmljLWFkZHJlc3NlcyddXCJcbiAgICAgICAgICAgIFtlbWFpbEFkZHJlc3NUeXBlc109XCJob3N0UmVmLmVtYWlsQWRkcmVzc1R5cGVzIHwgYXN5bmNcIlxuICAgICAgICAgICAgW21heEVtYWlsQWRkcmVzc2VzXT1cImhvc3RSZWYubWF4RW1haWxBZGRyZXNzZXMgfCBhc3luY1wiXG4gICAgICAgICAgICAodXBkYXRlUHJvZmlsZSk9XCJob3N0UmVmLnJlZnJlc2hQcm9maWxlRGF0YSgpXCJcbiAgICAgICAgICAgIChtYW5hZ2VFbWFpbCk9XCJob3N0UmVmLmhhbmRsZU1hbmFnZUFkZHJlc3NPcGVuKClcIlxuICAgICAgICAgICAgKGNhbmNlbE1hbmFnZUVtYWlsKT1cImhvc3RSZWYuaGFuZGxlTWFuYWdlQWRkcmVzc0Nsb3NlKClcIlxuICAgICAgICAgICAgW2Rpc2FibGVNYW5hZ2VdPVwiaG9zdFJlZi5kaXNhYmxlQWRkcmVzc01hbmFnaW5nXCJcbiAgICAgICAgICAgIFtkaXNtaXNzVGltZW91dF09XCJob3N0UmVmLmRpc21pc3NUaW1lb3V0XCI+XG4gICAgICAgICAgPC9iYi11c2VyLW1hbmFnZS1lbWFpbC1hZGRyZXNzZXM+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLXhsXCI+XG4gICAgICAgICAgPGJiLXVzZXItbWFuYWdlLXBob25lLW51bWJlcnNcbiAgICAgICAgICAgIFtwaG9uZU51bWJlcnNdPVwiaG9zdFJlZi51c2VyUHJvZmlsZVsncGhvbmUtYWRkcmVzc2VzJ11cIlxuICAgICAgICAgICAgW3Bob25lTnVtYmVyVHlwZXNdPVwiaG9zdFJlZi5waG9uZU51bWJlclR5cGVzIHwgYXN5bmNcIlxuICAgICAgICAgICAgW21heFBob25lTnVtYmVyc109XCJob3N0UmVmLm1heFBob25lTnVtYmVycyB8IGFzeW5jXCJcbiAgICAgICAgICAgICh1cGRhdGVQcm9maWxlKT1cImhvc3RSZWYucmVmcmVzaFByb2ZpbGVEYXRhKClcIlxuICAgICAgICAgICAgKG1hbmFnZVBob25lTnVtYmVyKT1cImhvc3RSZWYuaGFuZGxlTWFuYWdlQWRkcmVzc09wZW4oKVwiXG4gICAgICAgICAgICAoY2FuY2VsTWFuYWdlUGhvbmVOdW1iZXIpPVwiaG9zdFJlZi5oYW5kbGVNYW5hZ2VBZGRyZXNzQ2xvc2UoKVwiXG4gICAgICAgICAgICBbZGlzYWJsZU1hbmFnZV09XCJob3N0UmVmLmRpc2FibGVBZGRyZXNzTWFuYWdpbmdcIlxuICAgICAgICAgICAgW2Rpc21pc3NUaW1lb3V0XT1cImhvc3RSZWYuZGlzbWlzc1RpbWVvdXRcIlxuXG4gICAgICAgICAgICBbcGhvbmVOdW1iZXJDb3VudHJ5Q29kZV09XCJob3N0UmVmLnBob25lTnVtYmVyQ291bnRyeUNvZGUgfCBhc3luY1wiXG4gICAgICAgICAgICBbcGhvbmVOdW1iZXJEZWJvdW5jZVRpbWVdPVwiaG9zdFJlZi5waG9uZU51bWJlckRlYm91bmNlVGltZSB8IGFzeW5jXCJcbiAgICAgICAgICAgIFtlbmFibGVQaG9uZU51bWJlckZvcm1hdHRlcl09XCJob3N0UmVmLmVuYWJsZVBob25lTnVtYmVyRm9ybWF0dGVyIHwgYXN5bmNcIj5cbiAgICAgICAgICA8L2JiLXVzZXItbWFuYWdlLXBob25lLW51bWJlcnM+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLXhsXCI+XG4gICAgICAgICAgPGJiLXVzZXItbWFuYWdlLXBvc3RhbC1hZGRyZXNzZXNcbiAgICAgICAgICAgIFtwb3N0YWxBZGRyZXNzZXNdPVwiaG9zdFJlZi51c2VyUHJvZmlsZVsncG9zdGFsLWFkZHJlc3NlcyddXCJcbiAgICAgICAgICAgIFtwb3N0YWxBZGRyZXNzVHlwZXNdPVwiaG9zdFJlZi5wb3N0YWxBZGRyZXNzVHlwZXMgfCBhc3luY1wiXG4gICAgICAgICAgICBbbWF4UG9zdGFsQWRkcmVzc2VzXT1cImhvc3RSZWYubWF4UG9zdGFsQWRkcmVzc2VzIHwgYXN5bmNcIlxuICAgICAgICAgICAgKHVwZGF0ZVByb2ZpbGUpPVwiaG9zdFJlZi5yZWZyZXNoUHJvZmlsZURhdGEoKVwiXG4gICAgICAgICAgICAobWFuYWdlUG9zdGFsQWRkcmVzcyk9XCJob3N0UmVmLmhhbmRsZU1hbmFnZUFkZHJlc3NPcGVuKClcIlxuICAgICAgICAgICAgKGNhbmNlbE1hbmFnZVBvc3RhbEFkZHJlc3MpPVwiaG9zdFJlZi5oYW5kbGVNYW5hZ2VBZGRyZXNzQ2xvc2UoKVwiXG4gICAgICAgICAgICBbZGlzYWJsZU1hbmFnZV09XCJob3N0UmVmLmRpc2FibGVBZGRyZXNzTWFuYWdpbmdcIlxuICAgICAgICAgICAgW2Rpc21pc3NUaW1lb3V0XT1cImhvc3RSZWYuZGlzbWlzc1RpbWVvdXRcIj5cbiAgICAgICAgICA8L2JiLXVzZXItbWFuYWdlLXBvc3RhbC1hZGRyZXNzZXM+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvc2VjdGlvbj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSBiYlVzZXJNYW5hZ2VXaWRnZXRUaXRsZUN1c3RvbWl6YWJsZSBsZXQtaG9zdFJlZj5cbiAgPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS1tZFwiPlxuICAgIDxiYi1oZWFkZXItdWlcbiAgICAgIGhlYWRpbmdUeXBlPVwiaDJcIlxuICAgICAgZGF0YS1yb2xlPVwidXNlci1tYW5hZ2UtcHJvZmlsZS11c2VyLW5hbWVcIlxuICAgICAgW2hlYWRpbmddPVwiaG9zdFJlZi51c2VyUHJvZmlsZS5mdWxsTmFtZVwiPlxuICAgIDwvYmItaGVhZGVyLXVpPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=