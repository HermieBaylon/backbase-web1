import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { FormGroup } from '@angular/forms';
import { BehaviorSubject, Subject } from 'rxjs';
import { distinctUntilChanged, takeUntil } from 'rxjs/operators';
import { validateNumber } from '../../helpers/helpers';
import { ModalState } from '../../models/types';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/ui-ang/modal";
import * as i2 from "@backbase/ui-ang/input-text";
import * as i3 from "@backbase/ui-ang/input-validation-message";
import * as i4 from "@backbase/ui-ang/dropdown-single-select";
import * as i5 from "@backbase/ui-ang/load-button";
import * as i6 from "../confirmation-dialog/confirmation-dialog.component";
import * as i7 from "../link-a2a-steps/link-a2a-steps.component";
import * as i8 from "@angular/common";
import * as i9 from "@angular/forms";
import * as i10 from "@backbase/ui-ang/button";
export class LinkAccountModalComponent {
    constructor() {
        this.modalOptions = {
            backdrop: 'static',
            keyboard: false,
        };
        /**
         * Modal open flag
         * Default value is false
         */
        this.modalOpen = false;
        /**
         * Submitted form flag
         * Default value is false
         */
        this.submitted = false;
        /**
         * Loading data flag
         * Default value is false
         */
        this.isLoading = false;
        /**
         * Submit form event emitter
         */
        this.submitForm = new EventEmitter();
        /**
         * Discard account form data event emitter
         */
        this.discardData = new EventEmitter();
        /**
         * Build account form event emitter
         */
        this.buildForm = new EventEmitter();
        this.confirmationModalOpen = false;
        this.numberValidator = validateNumber;
        this.gc$ = new Subject();
        this.preventFormDiscard = false;
        this.states = ModalState;
        this.state$ = new BehaviorSubject(ModalState.Hidden);
    }
    isFieldValid(fieldName) {
        const control = this.getControl(fieldName);
        return control === null || control === void 0 ? void 0 : control.valid;
    }
    getControl(fieldName) {
        var _a;
        return (_a = this.accountForm) === null || _a === void 0 ? void 0 : _a.controls[fieldName];
    }
    hasRequiredError(field) {
        const fieldControl = this.getControl(field);
        if (!fieldControl || !fieldControl.errors) {
            return;
        }
        return fieldControl.errors.required;
    }
    onSubmit() {
        this.submitForm.emit();
        this.modalOpen = false;
        this.state$ = this.modalState;
    }
    onDiscard() {
        this.discardData.emit();
    }
    manageConfirmationModal() {
        if (this.preventFormDiscard) {
            this.confirmationModalOpen = true;
        }
        else {
            this.onDiscard();
            this.closeModal();
        }
    }
    openModal() {
        this.buildForm.emit();
        this.state$.next(ModalState.Preview);
    }
    closeModal() {
        this.state$.next(ModalState.Hidden);
    }
    ngOnChanges() {
        if (this.accountForm) {
            this.accountForm.valueChanges.pipe(takeUntil(this.gc$), distinctUntilChanged()).subscribe(formValues => {
                this.preventFormDiscard = Object.values(formValues).some(value => !!value);
            });
        }
    }
}
/** @nocollapse */ LinkAccountModalComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LinkAccountModalComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ LinkAccountModalComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: LinkAccountModalComponent, selector: "bb-a2a-link-account-form", inputs: { modalOpen: "modalOpen", accountForm: "accountForm", submitted: "submitted", isLoading: "isLoading", formInputLengths: "formInputLengths", modalState: "modalState" }, outputs: { submitForm: "submitForm", discardData: "discardData", buildForm: "buildForm" }, usesOnChanges: true, ngImport: i0, template: "<bb-modal-ui [isOpen]=\"states.Preview === (state$ | async) || modalOpen\" [modalOptions]=\"modalOptions\">\n  <bb-modal-header-ui>\n    <ng-template bbCustomModalHeader>\n      <div\n        class=\"modal-title\"\n        i18n=\"@@a2a-link-account.dialog.header\"\n        data-role=\"payord-a2a-link-account-dialog-header\"\n      >\n        Connect external account\n      </div>\n    </ng-template>\n  </bb-modal-header-ui>\n  <bb-modal-body-ui>\n    <ng-template bbCustomModalBody>\n      <div class=\"bb-list\">\n        <div class=\"bb-list__item\">\n          <div class=\"row\">\n            <form class=\"col-md-6\" [formGroup]=\"accountForm\" *ngIf=\"accountForm\">\n              <div class=\"form-group\">\n                <label\n                  class=\"bb-label\"\n                  [for]=\"AccountName.id\"\n                  data-role=\"payord-debit-create-CountrySubDivision-label\"\n                  i18n=\"@@payord-a2a-link-account.modal.AccountName.label\"\n                >\n                  Account name\n                </label>\n                <bb-input-text-ui\n                  #AccountName\n                  data-role=\"payord-a2a-link-account-AccountName-input\"\n                  [aria-label]=\"'Account Name'\"\n                  formControlName=\"inputAccountName\"\n                  [readonly]=\"false\"\n                  [maxLength]=\"formInputLengths?.name\"\n                  [autocomplete]=\"'name'\"\n                  i18n-aria-label=\"@@payord-a2a-link-account.modal.AccountName\"\n                >\n                </bb-input-text-ui>\n                <bb-input-validation-message-ui [showErrors]=\"!isFieldValid('inputAccountName')\">\n                  <span\n                    *ngIf=\"submitted && hasRequiredError('inputAccountName')\"\n                    i18n=\"@@payord-a2a-link-account.modal.required.AccountName\"\n                    data-role=\"payord-a2a-link-account-AccountName-required-message\"\n                  >\n                    Field is required.\n                  </span>\n                </bb-input-validation-message-ui>\n              </div>\n\n              <div class=\"form-group\">\n                <label\n                  class=\"bb-label\"\n                  [for]=\"AccountType.id\"\n                  data-role=\"payord-debit-create-CountrySubDivision-label\"\n                  i18n=\"@@payord-a2a-link-account.modal.AccountType.label\"\n                >\n                  Account type\n                </label>\n                <bb-dropdown-single-select-ui\n                  #AccountType\n                  data-role=\"payord-a2a-link-account-AccountType-select\"\n                  aria-label=\"Account Type\"\n                  formControlName=\"accountTypeSelect\"\n                  placeholder=\"- select an account type -\"\n                  i18n-aria-label=\"@@payord-a2a-link-account.modal.label.AccountType\"\n                  i18n-placeholder=\"@@payord-a2a-link-account.modal.placeholder.AccountType\"\n                >\n                  <bb-dropdown-single-select-option-ui\n                    class=\"text-capitalize\"\n                    [value]=\"'Savings'\"\n                    [label]=\"'Savings Account'\"\n                    data-role=\"payord-a2a-link-account-AccountType-savings\"\n                    i18n-label=\"@@payord-a2a-link-account.modal.label.Savings\"\n                  >\n                  </bb-dropdown-single-select-option-ui>\n                  <bb-dropdown-single-select-option-ui\n                    class=\"text-capitalize\"\n                    [value]=\"'Checking'\"\n                    [label]=\"'Checking Account'\"\n                    data-role=\"payord-a2a-link-account-AccountType-checking\"\n                    i18n-label=\"@@payord-a2a-link-account.modal.label.Checking\"\n                  >\n                  </bb-dropdown-single-select-option-ui>\n                </bb-dropdown-single-select-ui>\n                <bb-input-validation-message-ui [showErrors]=\"!isFieldValid('accountTypeSelect')\">\n                  <span\n                    *ngIf=\"submitted && hasRequiredError('accountTypeSelect')\"\n                    i18n=\"@@payord-a2a-link-account.modal.required.AccountType\"\n                    data-role=\"payord-a2a-link-account-AccountType-required-message\"\n                  >\n                    Field is required.\n                  </span>\n                </bb-input-validation-message-ui>\n              </div>\n\n              <div class=\"bb-block bb-block--sm\">\n                <label\n                  class=\"bb-label\"\n                  [for]=\"AccountNumber.id\"\n                  data-role=\"payord-debit-create-CountrySubDivision-label\"\n                  i18n=\"@@payord-a2a-link-account.modal.AccountNumber.label\"\n                >\n                  Account number\n                </label>\n                <bb-input-text-ui\n                  #AccountNumber\n                  data-role=\"payord-a2a-link-account-AccountNumber-input\"\n                  aria-label=\"Account Number\"\n                  formControlName=\"inputAccountNumber\"\n                  [readonly]=\"false\"\n                  [maxLength]=\"formInputLengths?.number\"\n                  [autocomplete]=\"'name'\"\n                  i18n-aria-label=\"@@payord-a2a-link-account.modal.AccountNumber\"\n                  (keydown)=\"numberValidator($event)\"\n                >\n                </bb-input-text-ui>\n                <bb-input-validation-message-ui [showErrors]=\"!isFieldValid('inputAccountNumber')\">\n                  <span\n                    *ngIf=\"submitted && hasRequiredError('inputAccountNumber')\"\n                    i18n=\"@@payord-a2a-link-account.modal.required.AccountNumber\"\n                    data-role=\"payord-a2a-link-account-AccountNumber-required-message\"\n                  >\n                    Field is required.\n                  </span>\n                  <ng-container *ngIf=\"accountForm.controls['inputAccountNumber'] as accNumber\">\n                    <span\n                      *ngIf=\"accNumber.touched && accNumber?.errors?.pattern\"\n                      i18n=\"@@payord-a2a-link-account.modal.pattern.AccountNumber\"\n                      data-role=\"payord-a2a-link-account-AccountNumber-pattern-message\"\n                    >\n                      Account number you have entered is invalid.\n                    </span>\n                  </ng-container>\n                </bb-input-validation-message-ui>\n              </div>\n\n              <div\n                class=\"bb-block bb-block--md bb-text-support bb-subtitle\"\n                data-role=\"payord-a2a-link-account-AccountNumber-example\"\n                i18n=\"@@payord-a2a-link.account.number.example\"\n              >\n                E.g. 001234567890\n              </div>\n\n              <div class=\"bb-block bb-block--sm\">\n                <label\n                  class=\"bb-label\"\n                  [for]=\"TransitNumber.id\"\n                  data-role=\"payord-debit-create-CountrySubDivision-label\"\n                  i18n=\"@@payord-a2a-link-account.modal.RoutingNumber.label\"\n                >\n                  Routing transit number\n                </label>\n                <bb-input-text-ui\n                  #TransitNumber\n                  data-role=\"payord-a2a-link-account-RoutingNumber-input\"\n                  aria-label=\"Routing Number\"\n                  formControlName=\"inputRoutingNumber\"\n                  [readonly]=\"false\"\n                  [maxLength]=\"formInputLengths?.routingNumber\"\n                  i18n-aria-label=\"@@payord-a2a-link-account.modal.RoutingNumber\"\n                  (keydown)=\"numberValidator($event)\"\n                >\n                </bb-input-text-ui>\n                <bb-input-validation-message-ui [showErrors]=\"!isFieldValid('inputRoutingNumber')\">\n                  <span\n                    *ngIf=\"submitted && hasRequiredError('inputRoutingNumber')\"\n                    i18n=\"@@payord-a2a-link-account.modal.required.RoutingNumber\"\n                    data-role=\"payord-a2a-link-account-RoutingNumber-required-message\"\n                  >\n                    Field is required.\n                  </span>\n                  <ng-container *ngIf=\"accountForm.controls['inputRoutingNumber'] as routingNumber\">\n                    <span\n                      *ngIf=\"routingNumber.touched && routingNumber.errors && routingNumber.errors.size\"\n                      i18n=\"@@payord-a2a-link-account.modal.size.RoutingNumber\"\n                      data-role=\"payord-a2a-link-account-RoutingNumber-size-message\"\n                    >\n                      Branch code can only be 9 digit code.\n                    </span>\n                    <span\n                      *ngIf=\"routingNumber.touched && routingNumber.errors && routingNumber.errors.pattern\"\n                      i18n=\"@@payord-a2a-link-account.modal.pattern.RoutingNumber\"\n                      data-role=\"payord-a2a-link-account-RoutingNumber-pattern-message\"\n                    >\n                      Branch code you have entered is invalid.\n                    </span>\n                  </ng-container>\n                </bb-input-validation-message-ui>\n              </div>\n              <span\n                class=\"bb-text-support bb-subtitle\"\n                data-role=\"payord-a2a-link-account-RoutingNumber-example\"\n                i18n=\"@@payord-a2a-link.account.routing.example\"\n              >\n                E.g. 021000021\n              </span>\n            </form>\n          </div>\n        </div>\n        <div class=\"bb-list__item\">\n          <ng-container *ngTemplateOutlet=\"bbPayordA2ALinkAccountModalInformation\"></ng-container>\n        </div>\n      </div>\n    </ng-template>\n  </bb-modal-body-ui>\n\n  <bb-modal-footer-ui>\n    <ng-template bbCustomModalFooter>\n      <div class=\"bb-button-bar\">\n        <bb-load-button-ui\n          color=\"primary\"\n          type=\"submit\"\n          class=\"bb-button-bar__button\"\n          [isLoading]=\"isLoading\"\n          (click)=\"onSubmit()\"\n          data-role=\"payord-a2a-link-account.modal-link-btn-text\"\n          i18n=\"@@payord-link-account.modal.link-account-btn.span\"\n        >\n          Connect\n        </bb-load-button-ui>\n        <button\n          bbButton\n          color=\"link\"\n          type=\"reset\"\n          class=\"bb-button-bar__button\"\n          (click)=\"manageConfirmationModal()\"\n          data-role=\"payord-a2a-link-account.modal-cancel-btn-text\"\n        >\n          <span i18n=\"@@payord-link-account.modal.cancel-btn.span\"> Cancel </span>\n        </button>\n      </div>\n    </ng-template>\n  </bb-modal-footer-ui>\n</bb-modal-ui>\n\n<bb-confirmation-dialog\n  [isOpen]=\"confirmationModalOpen\"\n  [confirmButtonColor]=\"'danger'\"\n  (cancel)=\"confirmationModalOpen = false\"\n  (confirm)=\"onDiscard(); confirmationModalOpen = false\"\n>\n  <span\n    title\n    class=\"modal-title\"\n    data-role=\"payord-a2a-link-account.confirmation-dialog-content\"\n    i18n=\"@@payord-link-account.confirmation-dialog.discard.title\"\n  >\n    Discard account\n  </span>\n  <span\n    body\n    data-role=\"payord-a2a-link-account.confirmation-dialog.discard.body\"\n    i18n=\"@@payord-a2a-link-account.confirmation-dialog.discard.body\"\n  >\n    Are you sure you want to discard the account? The data you have entered will be lost.\n  </span>\n  <span confirmActionName i18n=\"@@payord-a2a-link-account.confirmation-dialog.discard.action.confirm\">\n    Yes, Discard\n  </span>\n  <span cancelActionName i18n=\"@@payord-a2a-link-account.confirmation-dialog.discard.action.cancel\"> Keep data </span>\n</bb-confirmation-dialog>\n\n<ng-template #bbPayordA2ALinkAccountModalInformation>\n  <bb-a2a-link-account-steps\n    [stepIcon]=\"'access-time'\"\n    stepName=\"Wait 1-3 business days\"\n    stepDescription=\"You will receive two micro deposits in your external account\"\n    i18n-stepName=\"@@payord-a2a-link.step-2.account.modal.name\"\n    i18n-stepDescription=\"@@payord-a2a-link.step-2.account.modal.description\"\n  >\n  </bb-a2a-link-account-steps>\n  <bb-a2a-link-account-steps\n    [stepIcon]=\"'check'\"\n    stepName=\"Activate account\"\n    stepDescription=\"Use the two micro deposits to activate your account\"\n    i18n-stepName=\"@@payord-a2a-link.step-3.account.modal.name\"\n    i18n-stepDescription=\"@@payord-a2a-link.step-3.account.modal.description\"\n  >\n  </bb-a2a-link-account-steps>\n</ng-template>\n", components: [{ type: i1.ModalComponent, selector: "bb-modal-ui", inputs: ["isOpen", "aria-labelledby", "aria-describedby", "modalOptions"], outputs: ["confirm", "cancel", "isOpenChange"] }, { type: i1.ModalHeaderComponent, selector: "bb-modal-header-ui", inputs: ["title"], outputs: ["close"] }, { type: i1.ModalBodyComponent, selector: "bb-modal-body-ui" }, { type: i2.InputTextComponent, selector: "bb-input-text-ui", inputs: ["placeholder", "maxLength", "minLength", "autocomplete", "readonly", "mask", "maskValidator", "showCharCounter"], outputs: ["valueChange"] }, { type: i3.InputValidationMessageComponent, selector: "bb-input-validation-message-ui", inputs: ["showErrors", "messageId"] }, { type: i4.DropdownSingleSelectComponent, selector: "bb-dropdown-single-select-ui", inputs: ["placeholder", "defaultOptionAsPlaceholder", "options", "displayAttributePath", "iconName", "compareWithFn"] }, { type: i4.DropdownSingleSelectOptionComponent, selector: "bb-dropdown-single-select-option-ui", inputs: ["value", "label"] }, { type: i1.ModalFooterComponent, selector: "bb-modal-footer-ui", inputs: ["confirmText", "cancelText"], outputs: ["confirm", "cancel"] }, { type: i5.LoadButtonComponent, selector: "bb-load-button-ui", inputs: ["isLoading", "from", "size", "circle", "totalCount"], outputs: ["paramChange"] }, { type: i6.ConfirmationDialogComponent, selector: "bb-confirmation-dialog", inputs: ["confirmButtonColor", "cancelButtonColor", "isOpen", "confirmActionPayload", "attachComment", "commentFieldLabel"], outputs: ["confirm", "cancel"] }, { type: i7.LinkAccountInfoComponent, selector: "bb-a2a-link-account-steps", inputs: ["step", "stepIcon", "stepName", "stepDescription"] }], directives: [{ type: i1.CustomModalHeaderDirective, selector: "ng-template[bbCustomModalHeader]" }, { type: i1.CustomModalBodyDirective, selector: "ng-template[bbCustomModalBody]" }, { type: i8.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i9.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i9.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i9.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i9.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i9.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i8.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i1.CustomModalFooterDirective, selector: "ng-template[bbCustomModalFooter]" }, { type: i10.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }], pipes: { "async": i8.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LinkAccountModalComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-a2a-link-account-form',
                    templateUrl: './link-account-form.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], propDecorators: { modalOpen: [{
                type: Input
            }], accountForm: [{
                type: Input
            }], submitted: [{
                type: Input
            }], isLoading: [{
                type: Input
            }], formInputLengths: [{
                type: Input
            }], modalState: [{
                type: Input
            }], submitForm: [{
                type: Output
            }], discardData: [{
                type: Output
            }], buildForm: [{
                type: Output
            }] } });
//# sourceMappingURL=link-account-form.component.js.map