import { Component, HostListener, Input } from '@angular/core';
import { map } from 'rxjs/operators';
import { combineLatest, of } from 'rxjs';
import { BillpayDiscardChangesModalService, LoadingState, } from '@backbase/billpay-journeys-common';
import * as i0 from "@angular/core";
import * as i1 from "../../../services/pay-bills-navigation.service";
import * as i2 from "@backbase/billpay-journeys-common";
import * as i3 from "../../../services/pay-bills-state.service";
import * as i4 from "@angular/router";
import * as i5 from "../billpay-payment-form/billpay-payment-form.component";
import * as i6 from "@backbase/ui-ang/loading-indicator";
import * as i7 from "@backbase/ui-ang/empty-state";
import * as i8 from "../billpay-payment-discard-changes-modal/billpay-payment-discard-changes-modal.component";
import * as i9 from "@angular/common";
export class BillpayPaymentFormContainerComponent {
    /** @internal */
    constructor(routerService, paymentDataService, paymentStateService, discardModalService, route) {
        this.routerService = routerService;
        this.paymentDataService = paymentDataService;
        this.paymentStateService = paymentStateService;
        this.discardModalService = discardModalService;
        this.route = route;
        this.isFormTouched = false;
        this.paymentRouteObservable$ = this.routerService.routeParams;
    }
    get isDiscardModalOpen() {
        return this.discardModalService.isDiscardModalOpen;
    }
    ngOnInit() {
        this.paymentDataObservable$ = combineLatest([
            this.paymentRouteObservable$,
            this.paymentDataService.getPayeesAndAccounts(),
        ]).pipe(map(([routeParams, payeeSummariesAndAccounts]) => (Object.assign(Object.assign({}, routeParams), payeeSummariesAndAccounts))));
    }
    onWindowUnload($event) {
        if ((this.isFormTouched || this.paymentStateService.isFormProcessing) && !this.isDiscardModalOpen) {
            $event.returnValue = true;
        }
    }
    hasNoErrorState(data) {
        return (this.payeesLoadingState !== LoadingState.Error &&
            this.accountsLoadingState !== LoadingState.Error &&
            !!data.accounts &&
            !!data.payeeSummaries);
    }
    onSubmittedFormData(data) {
        this.paymentStateService.isFormProcessing = true;
        this.paymentStateService.updatePaymentState([data]);
        this.routerService.navigateToReview({ relativeTo: this.route.parent });
    }
    get paymentState() {
        return this.paymentStateService.paymentState.pipe(map((state) => state === null || state === void 0 ? void 0 : state[0]));
    }
    get payeesLoadingState() {
        return this.paymentDataService.payeesLoadingState;
    }
    get accountsLoadingState() {
        return this.paymentDataService.accountsLoadingState;
    }
    openModal() {
        return this.isFormTouched || this.paymentStateService.isFormProcessing
            ? this.discardModalService.openModal()
            : of(true);
    }
    onModalResolve(isConfirmed) {
        this.discardModalService.onModalResolve(isConfirmed);
    }
    onFormValueChanged() {
        this.isFormTouched = true;
    }
    onCancelForm() {
        this.routerService.navigateToPayeeList();
    }
}
BillpayPaymentFormContainerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPaymentFormContainerComponent, deps: [{ token: i1.PayBillsNavigationService }, { token: i2.BillpayPaymentDataService }, { token: i3.PayBillsStateService }, { token: i2.BillpayDiscardChangesModalService }, { token: i4.ActivatedRoute }], target: i0.ɵɵFactoryTarget.Component });
BillpayPaymentFormContainerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: BillpayPaymentFormContainerComponent, selector: "bb-billpay-payment-form-container", inputs: { frequencies: "frequencies", accountNumberMasked: "accountNumberMasked", paymentDetailsTitle: "paymentDetailsTitle", paymentDefaultCurrency: "paymentDefaultCurrency" }, host: { listeners: { "window:beforeunload": "onWindowUnload($event)" } }, providers: [BillpayDiscardChangesModalService], ngImport: i0, template: "<ng-container *ngIf=\"paymentDataObservable$ | async as paymentData; else loadingState\">\n  <ng-container *ngIf=\"hasNoErrorState(paymentData); else errorState\">\n    <section>\n      <bb-billpay-payment-form\n        *ngIf=\"paymentData.pageType === 'new'\"\n        [payeeSummaries]=\"paymentData?.payeeSummaries\"\n        [accounts]=\"paymentData?.accounts\"\n        [selectedPayeeId]=\"paymentData.payeeId\"\n        (submitPayment)=\"onSubmittedFormData($event)\"\n        (valueChanged)=\"onFormValueChanged()\"\n        (cancelPayment)=\"onCancelForm()\"\n        [paymentState]=\"paymentState | async\"\n        [accountNumberMask]=\"accountNumberMasked\"\n        [isEditPayment]=\"false\"\n        [paymentType]=\"paymentData.paymentType\"\n        [paymentDetailsTitle]=\"paymentDetailsTitle\"\n        [paymentDefaultCurrency]=\"paymentDefaultCurrency\"\n        [frequencies]=\"frequencies\"\n      >\n      </bb-billpay-payment-form>\n    </section>\n  </ng-container>\n</ng-container>\n\n<ng-template #loadingState>\n  <div class=\"card card-lg\">\n    <div class=\"card-body\">\n      <bb-loading-indicator-ui loaderSize=\"lg\" data-role=\"loading-state\"> </bb-loading-indicator-ui>\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #errorState>\n  <div class=\"card card-lg\">\n    <div class=\"card-body\">\n      <bb-empty-state-ui\n        data-role=\"error-state\"\n        iconSize=\"xxl\"\n        iconModifier=\"error\"\n        subtitle=\"Try to reload the page or contact support\"\n        i18n-subtitle=\"\n          Try to reload the page or contact support|Payment loading error\n          subtitle@@bb-billpay-manage-payment-widget-ang.loading.subtitle\"\n        title=\"Payment information is not loading\"\n        i18n-title=\"\n          Payment information is not loading|Payment loading error\n          title@@bb-billpay-manage-payment-widget-ang.loading.title\"\n      >\n      </bb-empty-state-ui>\n    </div>\n  </div>\n</ng-template>\n\n<bb-billpay-payment-discard-changes-modal\n  *ngIf=\"isDiscardModalOpen\"\n  data-role=\"billpay-payment-create-form-page-discard-changes-modal\"\n  (resolve)=\"onModalResolve($event)\"\n  title=\"Cancel payment?\"\n  i18n-title=\"Discard changes modal header@@billpay.manage-payment.discard-changes-modal.header\"\n  subtitle=\"Are you sure you want to cancel this payment? You will lose any details entered.\"\n  i18n-subtitle=\"Discard changes modal body@@billpay.manage-payment.discard-changes-modal.body\"\n  confirm-button-label=\"Cancel payment\"\n  i18n-confirm-button-label=\"\n    confirm modal button|Cancel payment confirmation button@@billpay.manage-payment.discard-changes-modal.confirm-button\"\n  cancel-button-label=\"Continue with payment\"\n  i18n-cancel-button-label=\"\n    cancel modal button|Continue with current payment button@@billpay.manage-payment.discard-changes-modal.cancel-button\"\n></bb-billpay-payment-discard-changes-modal>\n", components: [{ type: i5.BillpayPaymentFormComponent, selector: "bb-billpay-payment-form", inputs: ["payeeSummaries", "accounts", "selectedPayeeId", "paymentState", "paymentId", "accountNumberMask", "paymentType", "isEditPayment", "paymentDetailsTitle", "paymentDefaultCurrency", "frequencies"], outputs: ["submitPayment", "cancelPayment", "valueChanged"] }, { type: i6.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i7.EmptyStateComponent, selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }, { type: i8.BillpayPaymentDiscardChangesModalComponent, selector: "bb-billpay-payment-discard-changes-modal", inputs: ["title", "subtitle", "confirm-button-label", "cancel-button-label"], outputs: ["resolve"] }], directives: [{ type: i9.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i9.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPaymentFormContainerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-billpay-payment-form-container',
                    templateUrl: './billpay-payment-form-container.component.html',
                    providers: [BillpayDiscardChangesModalService],
                }]
        }], ctorParameters: function () { return [{ type: i1.PayBillsNavigationService }, { type: i2.BillpayPaymentDataService }, { type: i3.PayBillsStateService }, { type: i2.BillpayDiscardChangesModalService }, { type: i4.ActivatedRoute }]; }, propDecorators: { frequencies: [{
                type: Input
            }], accountNumberMasked: [{
                type: Input
            }], paymentDetailsTitle: [{
                type: Input
            }], paymentDefaultCurrency: [{
                type: Input
            }], onWindowUnload: [{
                type: HostListener,
                args: ['window:beforeunload', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbHBheS1wYXltZW50LWZvcm0tY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcGF5LWJpbGxzLWpvdXJuZXkvc3JjL2NvbXBvbmVudHMvYmlsbHBheS1wYXltZW50LXNpbmdsZS1iaWxsL2JpbGxwYXktcGF5bWVudC1mb3JtLWNvbnRhaW5lci9iaWxscGF5LXBheW1lbnQtZm9ybS1jb250YWluZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9wYXktYmlsbHMtam91cm5leS9zcmMvY29tcG9uZW50cy9iaWxscGF5LXBheW1lbnQtc2luZ2xlLWJpbGwvYmlsbHBheS1wYXltZW50LWZvcm0tY29udGFpbmVyL2JpbGxwYXktcGF5bWVudC1mb3JtLWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDdkUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxhQUFhLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBR3JELE9BQU8sRUFFTCxpQ0FBaUMsRUFHakMsWUFBWSxHQUViLE1BQU0sbUNBQW1DLENBQUM7Ozs7Ozs7Ozs7O0FBVzNDLE1BQU0sT0FBTyxvQ0FBb0M7SUFTL0MsZ0JBQWdCO0lBQ2hCLFlBQ21CLGFBQXdDLEVBQ3hDLGtCQUE2QyxFQUM3QyxtQkFBeUMsRUFDekMsbUJBQXNELEVBQ3RELEtBQXFCO1FBSnJCLGtCQUFhLEdBQWIsYUFBYSxDQUEyQjtRQUN4Qyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQTJCO1FBQzdDLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBc0I7UUFDekMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFt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Q0FBQywwQkNyQmhELHc0RkFvRUE7NEZEN0NhLG9DQUFvQztrQkFMaEQsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsbUNBQW1DO29CQUM3QyxXQUFXLEVBQUUsaURBQWlEO29CQUM5RCxTQUFTLEVBQUUsQ0FBQyxpQ0FBaUMsQ0FBQztpQkFDL0M7d1FBUVUsV0FBVztzQkFBbkIsS0FBSztnQkFpQkcsbUJBQW1CO3NCQUEzQixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxzQkFBc0I7c0JBQTlCLEtBQUs7Z0JBVU4sY0FBYztzQkFEYixZQUFZO3VCQUFDLHFCQUFxQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEJpbGxQYXlBY2NvdW50c0dldFJlc3BvbnNlQm9keSwgQmlsbFBheVBheWVlc1N1bW1hcnlHZXRSZXNwb25zZUJvZHkgfSBmcm9tICdAYmFja2Jhc2UvZGF0YS1hbmcvYmlsbHBheSc7XG5pbXBvcnQge1xuICBCaWxscGF5RGlzY2FyZENoYW5nZXNGb3JtQ29tcG9uZW50LFxuICBCaWxscGF5RGlzY2FyZENoYW5nZXNNb2RhbFNlcnZpY2UsXG4gIEJpbGxwYXlQYXltZW50RGF0YVNlcnZpY2UsXG4gIEZyZXF1ZW5jeSxcbiAgTG9hZGluZ1N0YXRlLFxuICBQYXltZW50Rm9ybVN0YXRlLFxufSBmcm9tICdAYmFja2Jhc2UvYmlsbHBheS1qb3VybmV5cy1jb21tb24nO1xuaW1wb3J0IHsgUGF5QmlsbHNTdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wYXktYmlsbHMtc3RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBQYXltZW50Um91dGVQYXJhbXMgfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9yb3V0ZS5tb2RlbCc7XG5pbXBvcnQgeyBQYXlCaWxsc05hdmlnYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcGF5LWJpbGxzLW5hdmlnYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLWJpbGxwYXktcGF5bWVudC1mb3JtLWNvbnRhaW5lcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9iaWxscGF5LXBheW1lbnQtZm9ybS1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtCaWxscGF5RGlzY2FyZENoYW5nZXNNb2RhbFNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBCaWxscGF5UGF5bWVudEZvcm1Db250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEJpbGxwYXlEaXNjYXJkQ2hhbmdlc0Zvcm1Db21wb25lbnQge1xuICBwYXltZW50Um91dGVPYnNlcnZhYmxlJDogT2JzZXJ2YWJsZTxQYXltZW50Um91dGVQYXJhbXM+O1xuICBwYXltZW50RGF0YU9ic2VydmFibGUkOlxuICAgIHwgT2JzZXJ2YWJsZTwoQmlsbFBheVBheWVlc1N1bW1hcnlHZXRSZXNwb25zZUJvZHkgJiBCaWxsUGF5QWNjb3VudHNHZXRSZXNwb25zZUJvZHkpIHwgdW5kZWZpbmVkPlxuICAgIHwgdW5kZWZpbmVkO1xuXG4gIHByaXZhdGUgaXNGb3JtVG91Y2hlZCA9IGZhbHNlO1xuICBASW5wdXQoKSBmcmVxdWVuY2llcz86IEZyZXF1ZW5jeVtdO1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZXJTZXJ2aWNlOiBQYXlCaWxsc05hdmlnYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGF5bWVudERhdGFTZXJ2aWNlOiBCaWxscGF5UGF5bWVudERhdGFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGF5bWVudFN0YXRlU2VydmljZTogUGF5QmlsbHNTdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBkaXNjYXJkTW9kYWxTZXJ2aWNlOiBCaWxscGF5RGlzY2FyZENoYW5nZXNNb2RhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICkge1xuICAgIHRoaXMucGF5bWVudFJvdXRlT2JzZXJ2YWJsZSQgPSB0aGlzLnJvdXRlclNlcnZpY2Uucm91dGVQYXJhbXM7XG4gIH1cblxuICBnZXQgaXNEaXNjYXJkTW9kYWxPcGVuKCkge1xuICAgIHJldHVybiB0aGlzLmRpc2NhcmRNb2RhbFNlcnZpY2UuaXNEaXNjYXJkTW9kYWxPcGVuO1xuICB9XG5cbiAgQElucHV0KCkgYWNjb3VudE51bWJlck1hc2tlZD86IGJvb2xlYW47XG4gIEBJbnB1dCgpIHBheW1lbnREZXRhaWxzVGl0bGU/OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHBheW1lbnREZWZhdWx0Q3VycmVuY3k/OiBzdHJpbmc7XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5wYXltZW50RGF0YU9ic2VydmFibGUkID0gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLnBheW1lbnRSb3V0ZU9ic2VydmFibGUkLFxuICAgICAgdGhpcy5wYXltZW50RGF0YVNlcnZpY2UuZ2V0UGF5ZWVzQW5kQWNjb3VudHMoKSxcbiAgICBdKS5waXBlKG1hcCgoW3JvdXRlUGFyYW1zLCBwYXllZVN1bW1hcmllc0FuZEFjY291bnRzXSkgPT4gKHsgLi4ucm91dGVQYXJhbXMsIC4uLnBheWVlU3VtbWFyaWVzQW5kQWNjb3VudHMgfSkpKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpiZWZvcmV1bmxvYWQnLCBbJyRldmVudCddKVxuICBvbldpbmRvd1VubG9hZCgkZXZlbnQ6IEJlZm9yZVVubG9hZEV2ZW50KSB7XG4gICAgaWYgKCh0aGlzLmlzRm9ybVRvdWNoZWQgfHwgdGhpcy5wYXltZW50U3RhdGVTZXJ2aWNlLmlzRm9ybVByb2Nlc3NpbmcpICYmICF0aGlzLmlzRGlzY2FyZE1vZGFsT3Blbikge1xuICAgICAgJGV2ZW50LnJldHVyblZhbHVlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBoYXNOb0Vycm9yU3RhdGUoZGF0YTogQmlsbFBheVBheWVlc1N1bW1hcnlHZXRSZXNwb25zZUJvZHkgJiBCaWxsUGF5QWNjb3VudHNHZXRSZXNwb25zZUJvZHkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5wYXllZXNMb2FkaW5nU3RhdGUgIT09IExvYWRpbmdTdGF0ZS5FcnJvciAmJlxuICAgICAgdGhpcy5hY2NvdW50c0xvYWRpbmdTdGF0ZSAhPT0gTG9hZGluZ1N0YXRlLkVycm9yICYmXG4gICAgICAhIWRhdGEuYWNjb3VudHMgJiZcbiAgICAgICEhZGF0YS5wYXllZVN1bW1hcmllc1xuICAgICk7XG4gIH1cblxuICBvblN1Ym1pdHRlZEZvcm1EYXRhKGRhdGE6IFBheW1lbnRGb3JtU3RhdGUpIHtcbiAgICB0aGlzLnBheW1lbnRTdGF0ZVNlcnZpY2UuaXNGb3JtUHJvY2Vzc2luZyA9IHRydWU7XG4gICAgdGhpcy5wYXltZW50U3RhdGVTZXJ2aWNlLnVwZGF0ZVBheW1lbnRTdGF0ZShbZGF0YV0pO1xuICAgIHRoaXMucm91dGVyU2VydmljZS5uYXZpZ2F0ZVRvUmV2aWV3KHsgcmVsYXRpdmVUbzogdGhpcy5yb3V0ZS5wYXJlbnQgfSk7XG4gIH1cblxuICBnZXQgcGF5bWVudFN0YXRlKCkge1xuICAgIHJldHVybiB0aGlzLnBheW1lbnRTdGF0ZVNlcnZpY2UucGF5bWVudFN0YXRlLnBpcGUobWFwKChzdGF0ZTogUGF5bWVudEZvcm1TdGF0ZVtdIHwgdW5kZWZpbmVkKSA9PiBzdGF0ZT8uWzBdKSk7XG4gIH1cblxuICBnZXQgcGF5ZWVzTG9hZGluZ1N0YXRlKCkge1xuICAgIHJldHVybiB0aGlzLnBheW1lbnREYXRhU2VydmljZS5wYXllZXNMb2FkaW5nU3RhdGU7XG4gIH1cblxuICBnZXQgYWNjb3VudHNMb2FkaW5nU3RhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMucGF5bWVudERhdGFTZXJ2aWNlLmFjY291bnRzTG9hZGluZ1N0YXRlO1xuICB9XG5cbiAgb3Blbk1vZGFsKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmlzRm9ybVRvdWNoZWQgfHwgdGhpcy5wYXltZW50U3RhdGVTZXJ2aWNlLmlzRm9ybVByb2Nlc3NpbmdcbiAgICAgID8gdGhpcy5kaXNjYXJkTW9kYWxTZXJ2aWNlLm9wZW5Nb2RhbCgpXG4gICAgICA6IG9mKHRydWUpO1xuICB9XG5cbiAgb25Nb2RhbFJlc29sdmUoaXNDb25maXJtZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmRpc2NhcmRNb2RhbFNlcnZpY2Uub25Nb2RhbFJlc29sdmUoaXNDb25maXJtZWQpO1xuICB9XG5cbiAgb25Gb3JtVmFsdWVDaGFuZ2VkKCkge1xuICAgIHRoaXMuaXNGb3JtVG91Y2hlZCA9IHRydWU7XG4gIH1cblxuICBvbkNhbmNlbEZvcm0oKSB7XG4gICAgdGhpcy5yb3V0ZXJTZXJ2aWNlLm5hdmlnYXRlVG9QYXllZUxpc3QoKTtcbiAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cInBheW1lbnREYXRhT2JzZXJ2YWJsZSQgfCBhc3luYyBhcyBwYXltZW50RGF0YTsgZWxzZSBsb2FkaW5nU3RhdGVcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImhhc05vRXJyb3JTdGF0ZShwYXltZW50RGF0YSk7IGVsc2UgZXJyb3JTdGF0ZVwiPlxuICAgIDxzZWN0aW9uPlxuICAgICAgPGJiLWJpbGxwYXktcGF5bWVudC1mb3JtXG4gICAgICAgICpuZ0lmPVwicGF5bWVudERhdGEucGFnZVR5cGUgPT09ICduZXcnXCJcbiAgICAgICAgW3BheWVlU3VtbWFyaWVzXT1cInBheW1lbnREYXRhPy5wYXllZVN1bW1hcmllc1wiXG4gICAgICAgIFthY2NvdW50c109XCJwYXltZW50RGF0YT8uYWNjb3VudHNcIlxuICAgICAgICBbc2VsZWN0ZWRQYXllZUlkXT1cInBheW1lbnREYXRhLnBheWVlSWRcIlxuICAgICAgICAoc3VibWl0UGF5bWVudCk9XCJvblN1Ym1pdHRlZEZvcm1EYXRhKCRldmVudClcIlxuICAgICAgICAodmFsdWVDaGFuZ2VkKT1cIm9uRm9ybVZhbHVlQ2hhbmdlZCgpXCJcbiAgICAgICAgKGNhbmNlbFBheW1lbnQpPVwib25DYW5jZWxGb3JtKClcIlxuICAgICAgICBbcGF5bWVudFN0YXRlXT1cInBheW1lbnRTdGF0ZSB8IGFzeW5jXCJcbiAgICAgICAgW2FjY291bnROdW1iZXJNYXNrXT1cImFjY291bnROdW1iZXJNYXNrZWRcIlxuICAgICAgICBbaXNFZGl0UGF5bWVudF09XCJmYWxzZVwiXG4gICAgICAgIFtwYXltZW50VHlwZV09XCJwYXltZW50RGF0YS5wYXltZW50VHlwZVwiXG4gICAgICAgIFtwYXltZW50RGV0YWlsc1RpdGxlXT1cInBheW1lbnREZXRhaWxzVGl0bGVcIlxuICAgICAgICBbcGF5bWVudERlZmF1bHRDdXJyZW5jeV09XCJwYXltZW50RGVmYXVsdEN1cnJlbmN5XCJcbiAgICAgICAgW2ZyZXF1ZW5jaWVzXT1cImZyZXF1ZW5jaWVzXCJcbiAgICAgID5cbiAgICAgIDwvYmItYmlsbHBheS1wYXltZW50LWZvcm0+XG4gICAgPC9zZWN0aW9uPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctY29udGFpbmVyPlxuXG48bmctdGVtcGxhdGUgI2xvYWRpbmdTdGF0ZT5cbiAgPGRpdiBjbGFzcz1cImNhcmQgY2FyZC1sZ1wiPlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHlcIj5cbiAgICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aSBsb2FkZXJTaXplPVwibGdcIiBkYXRhLXJvbGU9XCJsb2FkaW5nLXN0YXRlXCI+IDwvYmItbG9hZGluZy1pbmRpY2F0b3ItdWk+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNlcnJvclN0YXRlPlxuICA8ZGl2IGNsYXNzPVwiY2FyZCBjYXJkLWxnXCI+XG4gICAgPGRpdiBjbGFzcz1cImNhcmQtYm9keVwiPlxuICAgICAgPGJiLWVtcHR5LXN0YXRlLXVpXG4gICAgICAgIGRhdGEtcm9sZT1cImVycm9yLXN0YXRlXCJcbiAgICAgICAgaWNvblNpemU9XCJ4eGxcIlxuICAgICAgICBpY29uTW9kaWZpZXI9XCJlcnJvclwiXG4gICAgICAgIHN1YnRpdGxlPVwiVHJ5IHRvIHJlbG9hZCB0aGUgcGFnZSBvciBjb250YWN0IHN1cHBvcnRcIlxuICAgICAgICBpMThuLXN1YnRpdGxlPVwiXG4gICAgICAgICAgVHJ5IHRvIHJlbG9hZCB0aGUgcGFnZSBvciBjb250YWN0IHN1cHBvcnR8UGF5bWVudCBsb2FkaW5nIGVycm9yXG4gICAgICAgICAgc3VidGl0bGVAQGJiLWJpbGxwYXktbWFuYWdlLXBheW1lbnQtd2lkZ2V0LWFuZy5sb2FkaW5nLnN1YnRpdGxlXCJcbiAgICAgICAgdGl0bGU9XCJQYXltZW50IGluZm9ybWF0aW9uIGlzIG5vdCBsb2FkaW5nXCJcbiAgICAgICAgaTE4bi10aXRsZT1cIlxuICAgICAgICAgIFBheW1lbnQgaW5mb3JtYXRpb24gaXMgbm90IGxvYWRpbmd8UGF5bWVudCBsb2FkaW5nIGVycm9yXG4gICAgICAgICAgdGl0bGVAQGJiLWJpbGxwYXktbWFuYWdlLXBheW1lbnQtd2lkZ2V0LWFuZy5sb2FkaW5nLnRpdGxlXCJcbiAgICAgID5cbiAgICAgIDwvYmItZW1wdHktc3RhdGUtdWk+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cblxuPGJiLWJpbGxwYXktcGF5bWVudC1kaXNjYXJkLWNoYW5nZXMtbW9kYWxcbiAgKm5nSWY9XCJpc0Rpc2NhcmRNb2RhbE9wZW5cIlxuICBkYXRhLXJvbGU9XCJiaWxscGF5LXBheW1lbnQtY3JlYXRlLWZvcm0tcGFnZS1kaXNjYXJkLWNoYW5nZXMtbW9kYWxcIlxuICAocmVzb2x2ZSk9XCJvbk1vZGFsUmVzb2x2ZSgkZXZlbnQpXCJcbiAgdGl0bGU9XCJDYW5jZWwgcGF5bWVudD9cIlxuICBpMThuLXRpdGxlPVwiRGlzY2FyZCBjaGFuZ2VzIG1vZGFsIGhlYWRlckBAYmlsbHBheS5tYW5hZ2UtcGF5bWVudC5kaXNjYXJkLWNoYW5nZXMtbW9kYWwuaGVhZGVyXCJcbiAgc3VidGl0bGU9XCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2FuY2VsIHRoaXMgcGF5bWVudD8gWW91IHdpbGwgbG9zZSBhbnkgZGV0YWlscyBlbnRlcmVkLlwiXG4gIGkxOG4tc3VidGl0bGU9XCJEaXNjYXJkIGNoYW5nZXMgbW9kYWwgYm9keUBAYmlsbHBheS5tYW5hZ2UtcGF5bWVudC5kaXNjYXJkLWNoYW5nZXMtbW9kYWwuYm9keVwiXG4gIGNvbmZpcm0tYnV0dG9uLWxhYmVsPVwiQ2FuY2VsIHBheW1lbnRcIlxuICBpMThuLWNvbmZpcm0tYnV0dG9uLWxhYmVsPVwiXG4gICAgY29uZmlybSBtb2RhbCBidXR0b258Q2FuY2VsIHBheW1lbnQgY29uZmlybWF0aW9uIGJ1dHRvbkBAYmlsbHBheS5tYW5hZ2UtcGF5bWVudC5kaXNjYXJkLWNoYW5nZXMtbW9kYWwuY29uZmlybS1idXR0b25cIlxuICBjYW5jZWwtYnV0dG9uLWxhYmVsPVwiQ29udGludWUgd2l0aCBwYXltZW50XCJcbiAgaTE4bi1jYW5jZWwtYnV0dG9uLWxhYmVsPVwiXG4gICAgY2FuY2VsIG1vZGFsIGJ1dHRvbnxDb250aW51ZSB3aXRoIGN1cnJlbnQgcGF5bWVudCBidXR0b25AQGJpbGxwYXkubWFuYWdlLXBheW1lbnQuZGlzY2FyZC1jaGFuZ2VzLW1vZGFsLmNhbmNlbC1idXR0b25cIlxuPjwvYmItYmlsbHBheS1wYXltZW50LWRpc2NhcmQtY2hhbmdlcy1tb2RhbD5cbiJdfQ==