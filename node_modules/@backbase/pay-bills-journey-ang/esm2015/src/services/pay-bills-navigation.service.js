import { Injectable, Optional } from '@angular/core';
import { ONE_OFF_PAYMENT, RECURRING_PAYMENT } from '@backbase/billpay-journeys-common';
import { combineLatest } from 'rxjs';
import { map, pluck } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../communication.service";
export class PayBillsNavigationService {
    constructor(router, route, communicationService) {
        this.router = router;
        this.route = route;
        this.communicationService = communicationService;
        this.routeParams = combineLatest([
            this.getRouteParam(this.route, 'payee'),
            this.getRouteParam(this.route, 'id'),
        ]).pipe(map(([payee, id]) => {
            const pageType = !!id ? 'edit' : 'new';
            const paymentType = this.extractPaymentTypeFromId(id, payee);
            const paymentId = (id && id.substring(2)) || '';
            const payeeId = (payee && payee.substring(2)) || '';
            return Object.assign(Object.assign({ pageType,
                paymentType }, (!!paymentId && { paymentId })), (!!payeeId && { payeeId }));
        }));
        this.defaultRelative = { relativeTo: this.route };
    }
    navigateToEditRecurringForm(id, extras) {
        this.router.navigate(['recurring', 'edit', id], extras || this.defaultRelative);
    }
    navigateToEditRecurringReview(id, extras) {
        this.router.navigate(['recurring', 'edit', id, 'review'], extras || this.defaultRelative);
    }
    navigateToEditOneOffForm(id, extras) {
        this.router.navigate(['one-off', 'edit', id], extras || this.defaultRelative);
    }
    navigateToEditOneOffReview(id, extras) {
        this.router.navigate(['one-off', 'edit', id, 'review'], extras || this.defaultRelative);
    }
    navigateToForm(extras) {
        this.router.navigate(['form'], extras || this.defaultRelative);
    }
    navigateToReview(extras) {
        this.router.navigate(['review'], extras || this.defaultRelative);
    }
    navigateToPayeeList() {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToPayeesList();
    }
    navigateToPayments() {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToPaymentsList();
    }
    navigateToAddPayee() {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToAddPayee();
    }
    navigateToMainAppPage() {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToMainAppPage();
    }
    navigateToEditManualPayee(id) {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToEditManualPayee(id);
    }
    navigateToEditElectronicPayee(id) {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToEditElectronicPayee(id);
    }
    navigateToPayeeSummary(id) {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToPayeeSummary(id);
    }
    navigateToPayverisEbillEnrol(id) {
        var _a;
        (_a = this.communicationService) === null || _a === void 0 ? void 0 : _a.navigateToPayverisEbillEnrol(id);
    }
    extractPaymentTypeFromId(paymentId, payeeId) {
        if (!paymentId && !payeeId) {
            return ONE_OFF_PAYMENT;
        }
        const idToUse = (paymentId ? paymentId : payeeId);
        return idToUse.substring(0, 1) === 'r' ? RECURRING_PAYMENT : ONE_OFF_PAYMENT;
    }
    getRouteParam(route, param) {
        const paramValue = route.paramMap.pipe(pluck('params', param));
        if (!route.parent) {
            return paramValue;
        }
        // Ensure that level that has actual value keeps it from being cleared.
        return combineLatest([paramValue, this.getRouteParam(route.parent, param)]).pipe(map(params => params[0] || params[1]));
    }
}
PayBillsNavigationService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: PayBillsNavigationService, deps: [{ token: i1.Router }, { token: i1.ActivatedRoute }, { token: i2.CommunicationService, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
PayBillsNavigationService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: PayBillsNavigationService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: PayBillsNavigationService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i1.ActivatedRoute }, { type: i2.CommunicationService, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5LWJpbGxzLW5hdmlnYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcGF5LWJpbGxzLWpvdXJuZXkvc3JjL3NlcnZpY2VzL3BheS1iaWxscy1uYXZpZ2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckQsT0FBTyxFQUFFLGVBQWUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxhQUFhLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUs1QyxNQUFNLE9BQU8seUJBQXlCO0lBc0JwQyxZQUNtQixNQUFjLEVBQ2QsS0FBcUIsRUFDVCxvQkFBMEM7UUFGdEQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQ1QseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQXRCaEUsZ0JBQVcsR0FBbUMsYUFBYSxDQUFDO1lBQ25FLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7WUFDdkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztTQUNyQyxDQUFDLENBQUMsSUFBSSxDQUNMLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbEIsTUFBTSxRQUFRLEdBQThCLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ2xFLE1BQU0sV0FBVyxHQUFpQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsRUFBRSxFQUFFLEtBQUss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SEFsR1UseUJBQXlCOzJIQUF6Qix5QkFBeUI7NEZBQXpCLHlCQUF5QjtrQkFEckMsVUFBVTs7MEJBMEJOLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIE5hdmlnYXRpb25FeHRyYXMsIFBhcmFtTWFwLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgT05FX09GRl9QQVlNRU5ULCBSRUNVUlJJTkdfUEFZTUVOVCB9IGZyb20gJ0BiYWNrYmFzZS9iaWxscGF5LWpvdXJuZXlzLWNvbW1vbic7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHBsdWNrIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ29tbXVuaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9jb21tdW5pY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGF5bWVudFJvdXRlUGFnZVR5cGVQYXJhbSwgUGF5bWVudFJvdXRlUGFyYW1zLCBQYXltZW50Um91dGVQYXltZW50VHlwZVBhcmFtIH0gZnJvbSAnLi4vbW9kZWwvcm91dGUubW9kZWwnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUGF5QmlsbHNOYXZpZ2F0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdFJlbGF0aXZlOiBOYXZpZ2F0aW9uRXh0cmFzO1xuXG4gIHJlYWRvbmx5IHJvdXRlUGFyYW1zOiBPYnNlcnZhYmxlPFBheW1lbnRSb3V0ZVBhcmFtcz4gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICB0aGlzLmdldFJvdXRlUGFyYW0odGhpcy5yb3V0ZSwgJ3BheWVlJyksXG4gICAgdGhpcy5nZXRSb3V0ZVBhcmFtKHRoaXMucm91dGUsICdpZCcpLFxuICBdKS5waXBlKFxuICAgIG1hcCgoW3BheWVlLCBpZF0pID0+IHtcbiAgICAgIGNvbnN0IHBhZ2VUeXBlOiBQYXltZW50Um91dGVQYWdlVHlwZVBhcmFtID0gISFpZCA/ICdlZGl0JyA6ICduZXcnO1xuICAgICAgY29uc3QgcGF5bWVudFR5cGU6IFBheW1lbnRSb3V0ZVBheW1lbnRUeXBlUGFyYW0gPSB0aGlzLmV4dHJhY3RQYXltZW50VHlwZUZyb21JZChpZCwgcGF5ZWUpO1xuICAgICAgY29uc3QgcGF5bWVudElkID0gKGlkICYmIGlkLnN1YnN0cmluZygyKSkgfHwgJyc7XG4gICAgICBjb25zdCBwYXllZUlkID0gKHBheWVlICYmIHBheWVlLnN1YnN0cmluZygyKSkgfHwgJyc7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhZ2VUeXBlLFxuICAgICAgICBwYXltZW50VHlwZSxcbiAgICAgICAgLi4uKCEhcGF5bWVudElkICYmIHsgcGF5bWVudElkIH0pLFxuICAgICAgICAuLi4oISFwYXllZUlkICYmIHsgcGF5ZWVJZCB9KSxcbiAgICAgIH07XG4gICAgfSksXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIHJlYWRvbmx5IGNvbW11bmljYXRpb25TZXJ2aWNlOiBDb21tdW5pY2F0aW9uU2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5kZWZhdWx0UmVsYXRpdmUgPSB7IHJlbGF0aXZlVG86IHRoaXMucm91dGUgfTtcbiAgfVxuXG4gIG5hdmlnYXRlVG9FZGl0UmVjdXJyaW5nRm9ybShpZDogc3RyaW5nLCBleHRyYXM/OiBOYXZpZ2F0aW9uRXh0cmFzKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydyZWN1cnJpbmcnLCAnZWRpdCcsIGlkXSwgZXh0cmFzIHx8IHRoaXMuZGVmYXVsdFJlbGF0aXZlKTtcbiAgfVxuXG4gIG5hdmlnYXRlVG9FZGl0UmVjdXJyaW5nUmV2aWV3KGlkOiBzdHJpbmcsIGV4dHJhcz86IE5hdmlnYXRpb25FeHRyYXMpIHtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJ3JlY3VycmluZycsICdlZGl0JywgaWQsICdyZXZpZXcnXSwgZXh0cmFzIHx8IHRoaXMuZGVmYXVsdFJlbGF0aXZlKTtcbiAgfVxuXG4gIG5hdmlnYXRlVG9FZGl0T25lT2ZmRm9ybShpZDogc3RyaW5nLCBleHRyYXM/OiBOYXZpZ2F0aW9uRXh0cmFzKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydvbmUtb2ZmJywgJ2VkaXQnLCBpZF0sIGV4dHJhcyB8fCB0aGlzLmRlZmF1bHRSZWxhdGl2ZSk7XG4gIH1cblxuICBuYXZpZ2F0ZVRvRWRpdE9uZU9mZlJldmlldyhpZDogc3RyaW5nLCBleHRyYXM/OiBOYXZpZ2F0aW9uRXh0cmFzKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydvbmUtb2ZmJywgJ2VkaXQnLCBpZCwgJ3JldmlldyddLCBleHRyYXMgfHwgdGhpcy5kZWZhdWx0UmVsYXRpdmUpO1xuICB9XG5cbiAgbmF2aWdhdGVUb0Zvcm0oZXh0cmFzPzogTmF2aWdhdGlvbkV4dHJhcykge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnZm9ybSddLCBleHRyYXMgfHwgdGhpcy5kZWZhdWx0UmVsYXRpdmUpO1xuICB9XG5cbiAgbmF2aWdhdGVUb1JldmlldyhleHRyYXM/OiBOYXZpZ2F0aW9uRXh0cmFzKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydyZXZpZXcnXSwgZXh0cmFzIHx8IHRoaXMuZGVmYXVsdFJlbGF0aXZlKTtcbiAgfVxuXG4gIG5hdmlnYXRlVG9QYXllZUxpc3QoKSB7XG4gICAgdGhpcy5jb21tdW5pY2F0aW9uU2VydmljZT8ubmF2aWdhdGVUb1BheWVlc0xpc3QoKTtcbiAgfVxuICBuYXZpZ2F0ZVRvUGF5bWVudHMoKSB7XG4gICAgdGhpcy5jb21tdW5pY2F0aW9uU2VydmljZT8ubmF2aWdhdGVUb1BheW1lbnRzTGlzdCgpO1xuICB9XG4gIG5hdmlnYXRlVG9BZGRQYXllZSgpIHtcbiAgICB0aGlzLmNvbW11bmljYXRpb25TZXJ2aWNlPy5uYXZpZ2F0ZVRvQWRkUGF5ZWUoKTtcbiAgfVxuICBuYXZpZ2F0ZVRvTWFpbkFwcFBhZ2UoKSB7XG4gICAgdGhpcy5jb21tdW5pY2F0aW9uU2VydmljZT8ubmF2aWdhdGVUb01haW5BcHBQYWdlKCk7XG4gIH1cbiAgbmF2aWdhdGVUb0VkaXRNYW51YWxQYXllZShpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5jb21tdW5pY2F0aW9uU2VydmljZT8ubmF2aWdhdGVUb0VkaXRNYW51YWxQYXllZShpZCk7XG4gIH1cbiAgbmF2aWdhdGVUb0VkaXRFbGVjdHJvbmljUGF5ZWUoaWQ6IHN0cmluZykge1xuICAgIHRoaXMuY29tbXVuaWNhdGlvblNlcnZpY2U/Lm5hdmlnYXRlVG9FZGl0RWxlY3Ryb25pY1BheWVlKGlkKTtcbiAgfVxuICBuYXZpZ2F0ZVRvUGF5ZWVTdW1tYXJ5KGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbW11bmljYXRpb25TZXJ2aWNlPy5uYXZpZ2F0ZVRvUGF5ZWVTdW1tYXJ5KGlkKTtcbiAgfVxuICBuYXZpZ2F0ZVRvUGF5dmVyaXNFYmlsbEVucm9sKGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbW11bmljYXRpb25TZXJ2aWNlPy5uYXZpZ2F0ZVRvUGF5dmVyaXNFYmlsbEVucm9sKGlkKTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdFBheW1lbnRUeXBlRnJvbUlkKHBheW1lbnRJZDogc3RyaW5nIHwgbnVsbCwgcGF5ZWVJZDogc3RyaW5nIHwgbnVsbCk6IFBheW1lbnRSb3V0ZVBheW1lbnRUeXBlUGFyYW0ge1xuICAgIGlmICghcGF5bWVudElkICYmICFwYXllZUlkKSB7XG4gICAgICByZXR1cm4gT05FX09GRl9QQVlNRU5UO1xuICAgIH1cbiAgICBjb25zdCBpZFRvVXNlOiBzdHJpbmcgPSAocGF5bWVudElkID8gcGF5bWVudElkIDogcGF5ZWVJZCkgYXMgc3RyaW5nO1xuICAgIHJldHVybiBpZFRvVXNlLnN1YnN0cmluZygwLCAxKSA9PT0gJ3InID8gUkVDVVJSSU5HX1BBWU1FTlQgOiBPTkVfT0ZGX1BBWU1FTlQ7XG4gIH1cblxuICBwcml2YXRlIGdldFJvdXRlUGFyYW0ocm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwYXJhbTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgcGFyYW1WYWx1ZSA9IHJvdXRlLnBhcmFtTWFwLnBpcGUocGx1Y2s8UGFyYW1NYXAsIHN0cmluZyB8IG51bGw+KCdwYXJhbXMnLCBwYXJhbSkpO1xuXG4gICAgaWYgKCFyb3V0ZS5wYXJlbnQpIHtcbiAgICAgIHJldHVybiBwYXJhbVZhbHVlO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSB0aGF0IGxldmVsIHRoYXQgaGFzIGFjdHVhbCB2YWx1ZSBrZWVwcyBpdCBmcm9tIGJlaW5nIGNsZWFyZWQuXG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW3BhcmFtVmFsdWUsIHRoaXMuZ2V0Um91dGVQYXJhbShyb3V0ZS5wYXJlbnQsIHBhcmFtKV0pLnBpcGUoXG4gICAgICBtYXAocGFyYW1zID0+IHBhcmFtc1swXSB8fCBwYXJhbXNbMV0pLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==