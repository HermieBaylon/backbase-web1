import { Component } from '@angular/core';
import { combineLatest } from 'rxjs';
import { map, pluck } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@backbase/ui-ang/icon";
import * as i3 from "@backbase/ui-ang/loading-indicator";
import * as i4 from "@angular/common";
export var Status;
(function (Status) {
    Status[Status["ALLOW"] = 0] = "ALLOW";
    Status[Status["REJECT"] = 1] = "REJECT";
    Status[Status["ERROR"] = 2] = "ERROR";
})(Status || (Status = {}));
export class TppConsentRedirectComponent {
    constructor(route) {
        this.route = route;
        this.CONSENT_REDIRECT_TIMEOUT = 5000;
        this.Status = Status;
        this.allowConsentRequestRedirectUrl = this.getRouteParam(this.route, 'allowConsentRequestRedirectUrl').pipe(map(allowConsentRequestRedirectUrl => allowConsentRequestRedirectUrl || ''));
        this.rejectConsentRequestRedirectUrl = this.getRouteParam(this.route, 'rejectConsentRequestRedirectUrl').pipe(map(rejectConsentRequestRedirectUrl => rejectConsentRequestRedirectUrl || ''));
        this.redirectStatus = combineLatest(this.allowConsentRequestRedirectUrl, this.rejectConsentRequestRedirectUrl).pipe(map(([allowUrl, rejectUrl]) => ({
            url: allowUrl ? allowUrl : rejectUrl ? rejectUrl : '',
            status: allowUrl ? Status.ALLOW : rejectUrl ? Status.REJECT : Status.ERROR,
        })));
    }
    getRouteParam(route, param) {
        const paramValue = route.paramMap.pipe(pluck('params', param));
        if (!route.parent) {
            return paramValue;
        }
        // ensure that level that has actual value keeps it from being cleared
        return combineLatest(paramValue, this.getRouteParam(route.parent, param)).pipe(map(params => params[0] || params[1]));
    }
    redirect() {
        this.redirectStatus.subscribe((redirectStatus) => {
            if (redirectStatus.status !== Status.ERROR) {
                window.location.href = redirectStatus.url;
            }
        });
    }
    ngOnInit() {
        setTimeout(() => {
            this.redirect();
        }, this.CONSENT_REDIRECT_TIMEOUT);
    }
}
TppConsentRedirectComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: TppConsentRedirectComponent, deps: [{ token: i1.ActivatedRoute }], target: i0.ɵɵFactoryTarget.Component });
TppConsentRedirectComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: TppConsentRedirectComponent, selector: "bb-tpp-consent-redirect", ngImport: i0, template: "<div class=\"container--fixed-width-small mx-auto\">\n  <div class=\"bb-card\">\n    <div class=\"bb-card__body\">\n      <div\n        *ngIf=\"redirectStatus | async as redirectStatus; else errorTemplate\"\n        class=\"mb-5 d-flex justify-content-center flex-column text-center\">\n        <ng-container *ngIf=\"redirectStatus.status !== Status.ERROR; else errorTemplate\">\n          <bb-icon-ui name=\"success\" color=\"success\" size=\"xl\" class=\"d-inline mb-3\"></bb-icon-ui>\n          <h4\n            i18n=\"Consent status@@consent-journey.label.consent-status-allowed\"\n            *ngIf=\"redirectStatus.status === Status.ALLOW\"\n            data-role=\"consent-status-allowed\">\n            Consent granted!\n          </h4>\n          <h4\n            i18n=\"Consent status@@consent-journey.label.consent-status-rejected\"\n            *ngIf=\"redirectStatus.status === Status.REJECT\">\n            Consent rejected!\n          </h4>\n          <div class=\"mb-4\" i18n=\"Redirecting@@consent-journey.label.redirecting-to-tpp-website\">\n            Redirecting back to third party website...\n          </div>\n          <div class=\"mb-3\">\n            <bb-loading-indicator-ui></bb-loading-indicator-ui>\n          </div>\n        </ng-container>\n      </div>\n\n      <ng-template #errorTemplate>\n        <div class=\"mb-5 d-flex justify-content-center flex-column text-center\">\n          <div i18n=\"No Redirect Url@@consent-journey.label.no-redirect-url\">No Redirect Url</div>\n        </div>\n      </ng-template>\n    </div>\n  </div>\n</div>\n", components: [{ type: i2.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }, { type: i3.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i4.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: TppConsentRedirectComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-tpp-consent-redirect',
                    templateUrl: './tpp-consent-redirect.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.ActivatedRoute }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHBwLWNvbnNlbnQtcmVkaXJlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb25zZW50LWpvdXJuZXkvc3JjL3ZpZXdzL3RwcC1jb25zZW50LXJlZGlyZWN0L3RwcC1jb25zZW50LXJlZGlyZWN0LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY29uc2VudC1qb3VybmV5L3NyYy92aWV3cy90cHAtY29uc2VudC1yZWRpcmVjdC90cHAtY29uc2VudC1yZWRpcmVjdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7O0FBRzVDLE1BQU0sQ0FBTixJQUFZLE1BSVg7QUFKRCxXQUFZLE1BQU07SUFDaEIscUNBQUssQ0FBQTtJQUNMLHVDQUFNLENBQUE7SUFDTixxQ0FBSyxDQUFBO0FBQ1AsQ0FBQyxFQUpXLE1BQU0sS0FBTixNQUFNLFFBSWpCO0FBV0QsTUFBTSxPQUFPLDJCQUEyQjtJQXFDdEMsWUFBb0IsS0FBcUI7UUFBckIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFwQ3pDLDZCQUF3QixHQUFHLElBQUksQ0FBQztRQUNoQyxXQUFNLEdBQUcsTUFBTSxDQUFDO1FBRVAsbUNBQThCLEdBQXVCLElBQUksQ0FBQyxhQUFhLENBQzlFLElBQUksQ0FBQyxLQUFLLEVBQ1YsZ0NBQWdDLENBQ2pDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxFQUFFLENBQUMsOEJBQThCLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUzRSxvQ0FBK0IsR0FBdUIsSUFBSSxDQUFDLGFBQWEsQ0FDL0UsSUFBSSxDQUFDLEtBQUssRUFDVixpQ0FBaUMsQ0FDbEMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLCtCQUErQixDQUFDLEVBQUUsQ0FBQywrQkFBK0IsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTdFLG1CQUFjLEdBQStCLGFBQWEsQ0FDakUsSUFBSSxDQUFDLDhCQUE4QixFQUNuQyxJQUFJLENBQUMsK0JBQStCLENBQ3JDLENBQUMsSUFBSSxDQUNKLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBbUIsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoRCxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ3JELE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUs7U0FDM0UsQ0FBQyxDQUFDLENBQ0osQ0FBQztJQWUwQyxDQUFDO0lBYnJDLGFBQWEsQ0FBQyxLQUFxQixFQUFFLEtBQWE7UUFDeEQsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUEwQixRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUV4RixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUNqQixPQUFPLFVBQVUsQ0FBQztTQUNuQjtRQUVELHNFQUFzRTtRQUN0RSxPQUFPLGFBQWEsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUM1RSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3RDLENBQUM7SUFDSixDQUFDO0lBSUQsUUFBUTtRQUNOLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsY0FBOEIsRUFBRSxFQUFFO1lBQy9ELElBQUksY0FBYyxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsS0FBSyxFQUFFO2dCQUMxQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxjQUFjLENBQUMsR0FBRyxDQUFDO2FBQzNDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsUUFBUTtRQUNOLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbEIsQ0FBQyxFQUFFLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7O3lIQW5EVSwyQkFBMkI7NkdBQTNCLDJCQUEyQiwrRENwQnhDLDhpREFvQ0E7NEZEaEJhLDJCQUEyQjtrQkFKdkMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUseUJBQXlCO29CQUNuQyxXQUFXLEVBQUUsdUNBQXVDO2lCQUNyRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHBsdWNrIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFBhcmFtTWFwIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuZXhwb3J0IGVudW0gU3RhdHVzIHtcbiAgQUxMT1csXG4gIFJFSkVDVCxcbiAgRVJST1IsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVkaXJlY3RTdGF0dXMge1xuICB1cmw6IHN0cmluZztcbiAgc3RhdHVzOiBTdGF0dXM7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLXRwcC1jb25zZW50LXJlZGlyZWN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RwcC1jb25zZW50LXJlZGlyZWN0LmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgVHBwQ29uc2VudFJlZGlyZWN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQ09OU0VOVF9SRURJUkVDVF9USU1FT1VUID0gNTAwMDtcbiAgU3RhdHVzID0gU3RhdHVzO1xuXG4gIHJlYWRvbmx5IGFsbG93Q29uc2VudFJlcXVlc3RSZWRpcmVjdFVybDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5nZXRSb3V0ZVBhcmFtKFxuICAgIHRoaXMucm91dGUsXG4gICAgJ2FsbG93Q29uc2VudFJlcXVlc3RSZWRpcmVjdFVybCcsXG4gICkucGlwZShtYXAoYWxsb3dDb25zZW50UmVxdWVzdFJlZGlyZWN0VXJsID0+IGFsbG93Q29uc2VudFJlcXVlc3RSZWRpcmVjdFVybCB8fCAnJykpO1xuXG4gIHJlYWRvbmx5IHJlamVjdENvbnNlbnRSZXF1ZXN0UmVkaXJlY3RVcmw6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMuZ2V0Um91dGVQYXJhbShcbiAgICB0aGlzLnJvdXRlLFxuICAgICdyZWplY3RDb25zZW50UmVxdWVzdFJlZGlyZWN0VXJsJyxcbiAgKS5waXBlKG1hcChyZWplY3RDb25zZW50UmVxdWVzdFJlZGlyZWN0VXJsID0+IHJlamVjdENvbnNlbnRSZXF1ZXN0UmVkaXJlY3RVcmwgfHwgJycpKTtcblxuICByZWFkb25seSByZWRpcmVjdFN0YXR1czogT2JzZXJ2YWJsZTxSZWRpcmVjdFN0YXR1cz4gPSBjb21iaW5lTGF0ZXN0KFxuICAgIHRoaXMuYWxsb3dDb25zZW50UmVxdWVzdFJlZGlyZWN0VXJsLFxuICAgIHRoaXMucmVqZWN0Q29uc2VudFJlcXVlc3RSZWRpcmVjdFVybCxcbiAgKS5waXBlKFxuICAgIG1hcCgoW2FsbG93VXJsLCByZWplY3RVcmxdOiBbc3RyaW5nLCBzdHJpbmddKSA9PiAoe1xuICAgICAgdXJsOiBhbGxvd1VybCA/IGFsbG93VXJsIDogcmVqZWN0VXJsID8gcmVqZWN0VXJsIDogJycsXG4gICAgICBzdGF0dXM6IGFsbG93VXJsID8gU3RhdHVzLkFMTE9XIDogcmVqZWN0VXJsID8gU3RhdHVzLlJFSkVDVCA6IFN0YXR1cy5FUlJPUixcbiAgICB9KSksXG4gICk7XG5cbiAgcHJpdmF0ZSBnZXRSb3V0ZVBhcmFtKHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSwgcGFyYW06IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGNvbnN0IHBhcmFtVmFsdWUgPSByb3V0ZS5wYXJhbU1hcC5waXBlKHBsdWNrPFBhcmFtTWFwLCBzdHJpbmcgfCBudWxsPigncGFyYW1zJywgcGFyYW0pKTtcblxuICAgIGlmICghcm91dGUucGFyZW50KSB7XG4gICAgICByZXR1cm4gcGFyYW1WYWx1ZTtcbiAgICB9XG5cbiAgICAvLyBlbnN1cmUgdGhhdCBsZXZlbCB0aGF0IGhhcyBhY3R1YWwgdmFsdWUga2VlcHMgaXQgZnJvbSBiZWluZyBjbGVhcmVkXG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QocGFyYW1WYWx1ZSwgdGhpcy5nZXRSb3V0ZVBhcmFtKHJvdXRlLnBhcmVudCwgcGFyYW0pKS5waXBlKFxuICAgICAgbWFwKHBhcmFtcyA9PiBwYXJhbXNbMF0gfHwgcGFyYW1zWzFdKSxcbiAgICApO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUpIHt9XG5cbiAgcmVkaXJlY3QoKSB7XG4gICAgdGhpcy5yZWRpcmVjdFN0YXR1cy5zdWJzY3JpYmUoKHJlZGlyZWN0U3RhdHVzOiBSZWRpcmVjdFN0YXR1cykgPT4ge1xuICAgICAgaWYgKHJlZGlyZWN0U3RhdHVzLnN0YXR1cyAhPT0gU3RhdHVzLkVSUk9SKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVkaXJlY3RTdGF0dXMudXJsO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnJlZGlyZWN0KCk7XG4gICAgfSwgdGhpcy5DT05TRU5UX1JFRElSRUNUX1RJTUVPVVQpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY29udGFpbmVyLS1maXhlZC13aWR0aC1zbWFsbCBteC1hdXRvXCI+XG4gIDxkaXYgY2xhc3M9XCJiYi1jYXJkXCI+XG4gICAgPGRpdiBjbGFzcz1cImJiLWNhcmRfX2JvZHlcIj5cbiAgICAgIDxkaXZcbiAgICAgICAgKm5nSWY9XCJyZWRpcmVjdFN0YXR1cyB8IGFzeW5jIGFzIHJlZGlyZWN0U3RhdHVzOyBlbHNlIGVycm9yVGVtcGxhdGVcIlxuICAgICAgICBjbGFzcz1cIm1iLTUgZC1mbGV4IGp1c3RpZnktY29udGVudC1jZW50ZXIgZmxleC1jb2x1bW4gdGV4dC1jZW50ZXJcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInJlZGlyZWN0U3RhdHVzLnN0YXR1cyAhPT0gU3RhdHVzLkVSUk9SOyBlbHNlIGVycm9yVGVtcGxhdGVcIj5cbiAgICAgICAgICA8YmItaWNvbi11aSBuYW1lPVwic3VjY2Vzc1wiIGNvbG9yPVwic3VjY2Vzc1wiIHNpemU9XCJ4bFwiIGNsYXNzPVwiZC1pbmxpbmUgbWItM1wiPjwvYmItaWNvbi11aT5cbiAgICAgICAgICA8aDRcbiAgICAgICAgICAgIGkxOG49XCJDb25zZW50IHN0YXR1c0BAY29uc2VudC1qb3VybmV5LmxhYmVsLmNvbnNlbnQtc3RhdHVzLWFsbG93ZWRcIlxuICAgICAgICAgICAgKm5nSWY9XCJyZWRpcmVjdFN0YXR1cy5zdGF0dXMgPT09IFN0YXR1cy5BTExPV1wiXG4gICAgICAgICAgICBkYXRhLXJvbGU9XCJjb25zZW50LXN0YXR1cy1hbGxvd2VkXCI+XG4gICAgICAgICAgICBDb25zZW50IGdyYW50ZWQhXG4gICAgICAgICAgPC9oND5cbiAgICAgICAgICA8aDRcbiAgICAgICAgICAgIGkxOG49XCJDb25zZW50IHN0YXR1c0BAY29uc2VudC1qb3VybmV5LmxhYmVsLmNvbnNlbnQtc3RhdHVzLXJlamVjdGVkXCJcbiAgICAgICAgICAgICpuZ0lmPVwicmVkaXJlY3RTdGF0dXMuc3RhdHVzID09PSBTdGF0dXMuUkVKRUNUXCI+XG4gICAgICAgICAgICBDb25zZW50IHJlamVjdGVkIVxuICAgICAgICAgIDwvaDQ+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTRcIiBpMThuPVwiUmVkaXJlY3RpbmdAQGNvbnNlbnQtam91cm5leS5sYWJlbC5yZWRpcmVjdGluZy10by10cHAtd2Vic2l0ZVwiPlxuICAgICAgICAgICAgUmVkaXJlY3RpbmcgYmFjayB0byB0aGlyZCBwYXJ0eSB3ZWJzaXRlLi4uXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTNcIj5cbiAgICAgICAgICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aT48L2JiLWxvYWRpbmctaW5kaWNhdG9yLXVpPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8bmctdGVtcGxhdGUgI2Vycm9yVGVtcGxhdGU+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtYi01IGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIGZsZXgtY29sdW1uIHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgPGRpdiBpMThuPVwiTm8gUmVkaXJlY3QgVXJsQEBjb25zZW50LWpvdXJuZXkubGFiZWwubm8tcmVkaXJlY3QtdXJsXCI+Tm8gUmVkaXJlY3QgVXJsPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==