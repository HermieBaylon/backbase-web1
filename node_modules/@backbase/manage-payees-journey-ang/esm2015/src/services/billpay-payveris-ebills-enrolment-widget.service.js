import { Injectable } from '@angular/core';
import { Observable, Subject } from 'rxjs';
import { catchError, pluck } from 'rxjs/operators';
import { BillpayUtilityService as Utilities } from '@backbase/billpay-journeys-common';
import { PayverisEnrolmentState } from '../model/payveris-enrolment-state.enum';
import { PayverisEnrolmentComponentState } from '../model';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/data-ang/billpay";
export class BillpayPayverisEbillsEnrolmentWidgetService {
    /** @internal */
    constructor(payverisData, payeesData) {
        this.payverisData = payverisData;
        this.payeesData = payeesData;
        this.widgetStateSource = new Subject();
        this._currentState = PayverisEnrolmentState.Initialize;
        this._componentState = PayverisEnrolmentComponentState.Undefined;
        this._userInputFailed = false;
        this._responses = {};
        this._expectingLoginResponse = true;
        this._expectingOtpEntryResponse = false;
        this._MIN_CALLBACK_TIME = 1;
        this.widgetStateChange = this.widgetStateSource.asObservable();
        this.credentialsResponse = (value) => {
            this._responses.credentialsResponse = value;
        };
        this._payload = {
            payeeID: this._payeeId,
            credentials: [],
        };
    }
    submitPayverisRequest(payload) {
        this._componentState = PayverisEnrolmentComponentState.Checking;
        this._userInputFailed = false;
        return this.payverisData
            .postBillPayPayverisEbillsEnrolment({ billPayPayverisEbillsEnrolmentPostRequestBody: payload }, 'response')
            .pipe(catchError(err => {
            this.handleError(err);
            return new Observable();
        }));
    }
    getPayeeNameFromID(id) {
        return this.payeesData.getElectronicPayeeById({ id: id }).pipe(pluck('payee', 'name'));
    }
    onInitializeEnrolment() {
        if (this._payeeId) {
            this._payload = {
                payeeID: this._payeeId,
                credentials: [],
            };
        }
        else {
            this.handleError(undefined);
            return false;
        }
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleStatusResponse(response);
        });
        return true;
    }
    handleStatusResponse(response) {
        if (this.isBillersResponse(response)) {
            return this.setState(PayverisEnrolmentState.SelectBiller, response, 'billersResponse');
        }
        if (this.isSelectAccountResponse(response)) {
            return this.setState(PayverisEnrolmentState.SelectAccounts, response, 'accountsResponse');
        }
        if (this.isOtpSelectResponse(response)) {
            return this.setState(PayverisEnrolmentState.OtpSelect, response, 'otpTransportResponse');
        }
        if (this.isCaptchaResponse(response)) {
            return this.setState(PayverisEnrolmentState.Captcha, response, 'captchaResponse');
        }
        if (this.isCredentialsResponse(response)) {
            return this.handleCredentialsOnStatusResponse(response);
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        if (this.isSuccessResponse(response)) {
            return this.setState(PayverisEnrolmentState.Success);
        }
        this.handleError(undefined);
        return false;
    }
    handleCredentialsOnStatusResponse(response) {
        if (this._expectingLoginResponse) {
            this._expectingLoginResponse = false;
            return this.setState(PayverisEnrolmentState.Login, response, 'credentialsResponse');
        }
        if (this._expectingOtpEntryResponse) {
            this._expectingOtpEntryResponse = false;
            return this.setState(PayverisEnrolmentState.OtpEntry, response, 'otpPasscodeResponse');
        }
        return this.setState(PayverisEnrolmentState.Mfa, response, 'mfaResponse');
    }
    onSubmitBillerSelection(billerSelectedIndex) {
        const billerSelected = this.billers ? this.billers[billerSelectedIndex] : {};
        this._payload = {
            payeeID: this._payeeId,
            biller: billerSelected,
            credentials: [],
        };
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleBillerResponse(response);
        });
    }
    handleBillerResponse(response) {
        if (this.isCredentialsResponse(response)) {
            return this.setState(PayverisEnrolmentState.Login, response, 'credentialsResponse');
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        this.handleError(undefined);
        return false;
    }
    onSubmitPayeeLogin(login) {
        var _a;
        if (login && this.loginCredentialsArray && this.loginCredentialsArray.length >= 2) {
            const credentials = (_a = this.loginCredentialsArray) === null || _a === void 0 ? void 0 : _a.map((credentials, i) => {
                return Object.assign(Object.assign({}, credentials), { value: login[i] });
            });
            this._payload = {
                payeeID: this._payeeId,
                credentials: credentials,
            };
        }
        else {
            this.handleError(undefined);
        }
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleCredentialResponse(response);
        });
    }
    handleCredentialResponse(response) {
        if (this.isOtpSelectResponse(response)) {
            return this.setState(PayverisEnrolmentState.OtpSelect, response, 'otpTransportResponse');
        }
        if (this.isCaptchaResponse(response)) {
            return this.setState(PayverisEnrolmentState.Captcha, response, 'captchaResponse');
        }
        if (this.isCredentialsResponse(response)) {
            return this.setState(PayverisEnrolmentState.Mfa, response, 'mfaResponse');
        }
        if (this.isSelectAccountResponse(response)) {
            return this.setState(PayverisEnrolmentState.SelectAccounts, response, 'accountsResponse');
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        this.handleError(undefined);
        return false;
    }
    onSubmitPayverisEbillMfa() {
        this._payload = {
            payeeID: this._payeeId,
            credentials: this.mfaArray || [],
        };
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleMfaResponse(response);
        });
    }
    handleMfaResponse(response) {
        if (this.isCredentialsResponse(response)) {
            return this.setState(PayverisEnrolmentState.Mfa, response, 'mfaResponse');
        }
        if (this.isSelectAccountResponse(response)) {
            return this.setState(PayverisEnrolmentState.SelectAccounts, response, 'accountsResponse');
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        this.handleError(undefined);
        return false;
    }
    onSubmitPayverisEbillOtpTransportSelection(transportSelectedIndex) {
        this._expectingOtpEntryResponse = true;
        const transportSelected = this.otpTransports ? this.otpTransports[transportSelectedIndex] : {};
        this._otpTransportMethodSelected = transportSelected.value;
        const label = this.getLabelFromResponse(this._responses['otpTransportResponse']);
        const selection = {
            label: label,
            value: transportSelected.id,
        };
        this._payload = {
            payeeID: this._payeeId,
            credentials: [selection],
        };
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleOtpTransportResponse(response);
        });
    }
    handleOtpTransportResponse(response) {
        if (this.isCredentialsResponse(response)) {
            return this.setState(PayverisEnrolmentState.OtpEntry, response, 'otpPasscodeResponse');
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        this.handleError(undefined);
        return false;
    }
    onSubmitPayverisEbillPayeeOtpPasscode(passcode) {
        this.submitVerificationStep(this._responses['otpPasscodeResponse'], passcode.passcode);
    }
    onSubmitPayverisEbillPayeeCaptcha(captcha) {
        this.submitVerificationStep(this._responses['captchaResponse'], captcha.captcha);
    }
    submitVerificationStep(previousResponse, credentialValue) {
        this._payload = this.prepareCredentialPayload(previousResponse, credentialValue);
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleVerificationResponse(response);
        });
    }
    prepareCredentialPayload(response, credentialValue) {
        const label = this.getLabelFromResponse(response);
        const selection = {
            label: label,
            value: credentialValue,
        };
        return {
            payeeID: this.payeeId,
            credentials: [selection],
        };
    }
    handleVerificationResponse(response) {
        if (this.isSelectAccountResponse(response)) {
            return this.setState(PayverisEnrolmentState.SelectAccounts, response, 'accountsResponse');
        }
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        this.handleError(undefined);
        return false;
    }
    cancelEnrolment() {
        return this.payverisData.deleteBillPayPayverisEbillsEnrolment(this._payload);
    }
    onSubmitPayverisEbillAccountSelection(accountSelectedIndex) {
        const accountSelected = this.accounts ? this.accounts[accountSelectedIndex] : undefined;
        this._payload = {
            payeeID: this._payeeId,
            account: accountSelected,
            credentials: [],
        };
        this.submitPayverisRequest(this._payload).subscribe(response => {
            this.handleAccountsResponse(response);
        });
    }
    handleAccountsResponse(response) {
        if (this.isCallbackResponse(response)) {
            return this.handleCallbackResponse(response);
        }
        if (this.isSuccessResponse(response)) {
            return this.setState(PayverisEnrolmentState.Success, response, 'successResponse');
        }
        this.handleError(undefined);
        return false;
    }
    handleCallbackResponse(response) {
        const callbackTime = Utilities.checkForProperty('body.callBackTime', response) || 0;
        const callbackTimeInMs = Math.max(new Date(callbackTime).getTime() - new Date().getTime(), this._MIN_CALLBACK_TIME);
        this.timer = setTimeout(() => {
            this.onInitializeEnrolment();
        }, callbackTimeInMs);
        this._componentState = PayverisEnrolmentComponentState.Callback;
        this.widgetStateSource.next();
        return true;
    }
    cancelCallback() {
        if (this.timer) {
            clearTimeout(this.timer);
        }
    }
    setState(state, response, responseToSet) {
        this._currentState = state;
        this._componentState = PayverisEnrolmentComponentState.Ready;
        if (responseToSet) {
            this._responses[responseToSet] = Utilities.checkForProperty('body', response);
        }
        this.widgetStateSource.next();
        return true;
    }
    handleError(error) {
        this._errorState = Utilities.checkForProperty(['error', 'errors', 0, 'key'], error);
        if (this._errorState === 'billpay.api.invalidCredentials') {
            this._userInputFailed = true;
            this._componentState = PayverisEnrolmentComponentState.Ready;
            this.widgetStateSource.next();
        }
        else {
            this.setState(PayverisEnrolmentState.ErrorState);
        }
    }
    isCredentialsResponse(response) {
        return !!(response.status === 200 && Utilities.checkForProperty('body.authentication.credentials.length', response) > 0);
    }
    isBillersResponse(response) {
        return !!(response.status === 200 && Utilities.checkForProperty('body.billers.length', response) > 0);
    }
    isCallbackResponse(response) {
        const accounts = Utilities.checkForProperty('body.accounts', response);
        return !!(response.status === 200 &&
            (!accounts || accounts.length === 0) &&
            Utilities.checkForProperty('body.callBackRequired', response) &&
            Utilities.checkForProperty('body.callBackTime', response));
    }
    isSelectAccountResponse(response) {
        return !!(response.status === 200 && Utilities.checkForProperty('body.accounts.length', response) >= 1);
    }
    isOtpSelectResponse(response) {
        return !!(response.status === 200 &&
            Utilities.checkForProperty('body.authentication.securityChallenge.oneTimePasscode', response));
    }
    isCaptchaResponse(response) {
        return !!(response.status === 200 &&
            Utilities.checkForProperty('body.authentication.securityChallenge.captcha', response) &&
            Utilities.checkForProperty('body.authentication.credentials', response));
    }
    isSuccessResponse(response) {
        return !!(response.status === 200 && Utilities.checkForProperty('body.payeeID', response));
    }
    getLabelFromResponse(response) {
        return Utilities.checkForProperty(['authentication', 'credentials', 0, 'label'], response);
    }
    set payeeId(value) {
        this._payeeId = value;
    }
    get payeeId() {
        return this._payeeId;
    }
    get currentState() {
        return this._currentState;
    }
    get errorState() {
        return this._errorState;
    }
    get componentState() {
        return this._componentState;
    }
    set componentState(value) {
        this._componentState = value;
    }
    get userInputFailed() {
        return this._userInputFailed;
    }
    get loginCredentialsArray() {
        return Utilities.checkForProperty('credentialsResponse.authentication.credentials', this._responses) || [];
    }
    get mfaArray() {
        return Utilities.checkForProperty('mfaResponse.authentication.credentials', this._responses) || [];
    }
    get billers() {
        return Utilities.checkForProperty('billersResponse.billers', this._responses) || [];
    }
    get accounts() {
        return Utilities.checkForProperty('accountsResponse.accounts', this._responses) || [];
    }
    get otpTransportMethodSelected() {
        return this._otpTransportMethodSelected;
    }
    checkForPropertyWrapper(propertyBranch) {
        return Utilities.checkForProperty(propertyBranch, this._responses);
    }
    get otpTransports() {
        return this.checkForPropertyWrapper('otpTransportResponse.authentication.securityChallenge.oneTimePasscode.deliveryMethods');
    }
    get captchaImageSrc() {
        return this.checkForPropertyWrapper('captchaResponse.authentication.securityChallenge.captcha.image');
    }
    get captchaImageType() {
        return this.checkForPropertyWrapper('captchaResponse.authentication.securityChallenge.captcha.mimeType');
    }
}
BillpayPayverisEbillsEnrolmentWidgetService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPayverisEbillsEnrolmentWidgetService, deps: [{ token: i1.BillPayPayverisService }, { token: i1.BillPayPayeesService }], target: i0.ɵɵFactoryTarget.Injectable });
BillpayPayverisEbillsEnrolmentWidgetService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPayverisEbillsEnrolmentWidgetService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPayverisEbillsEnrolmentWidgetService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.BillPayPayverisService }, { type: i1.BillPayPayeesService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LXdpZGdldC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9tYW5hZ2UtcGF5ZWVzLWpvdXJuZXkvc3JjL3NlcnZpY2VzL2JpbGxwYXktcGF5dmVyaXMtZWJpbGxzLWVucm9sbWVudC13aWRnZXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFXbkQsT0FBTyxFQUFFLHFCQUFxQixJQUFJLFNBQVMsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSwrQkFBK0IsRUFBdUQsTUFBTSxVQUFVLENBQUM7OztBQUdoSCxNQUFNLE9BQU8sMkNBQTJDO0lBaUJ0RCxnQkFBZ0I7SUFDaEIsWUFDbUIsWUFBb0MsRUFDcEMsVUFBZ0M7UUFEaEMsaUJBQVksR0FBWixZQUFZLENBQXdCO1FBQ3BDLGVBQVUsR0FBVixVQUFVLENBQXNCO1FBbkJsQyxzQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBRWpELGtCQUFhLEdBQUcsc0JBQXNCLENBQUMsVUFBVSxDQUFDO1FBRWxELG9CQUFlLEdBQUcsK0JBQStCLENBQUMsU0FBUyxDQUFDO1FBQzVELHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUNoQixlQUFVLEdBQVEsRUFBRSxDQUFDO1FBQzlCLDRCQUF1QixHQUFHLElBQUksQ0FBQztRQUUvQiwrQkFBMEIsR0FBRyxLQUFLLENBQUM7UUFFMUIsdUJBQWtCLEdBQUcsQ0FBQyxD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LE9BQU8sSUFBSSxDQUFDLDJCQUEyQixDQUFDO0lBQzFDLENBQUM7SUFFTyx1QkFBdUIsQ0FBQyxjQUFzQjtRQUNwRCxPQUFPLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRCxJQUFJLGFBQWE7UUFDZixPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FDakMsdUZBQXVGLENBQ3hGLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdFQUFnRSxDQUFDLENBQUM7SUFDeEcsQ0FBQztJQUVELElBQUksZ0JBQWdCO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLG1FQUFtRSxDQUFDLENBQUM7SUFDM0csQ0FBQzs7eUlBOWJVLDJDQUEyQzs2SUFBM0MsMkNBQTJDOzRGQUEzQywyQ0FBMkM7a0JBRHZELFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBwbHVjayB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIEJpbGxQYXlQYXl2ZXJpc1NlcnZpY2UsXG4gIEJpbGxQYXlQYXllZXNTZXJ2aWNlLFxuICBFYmlsbEFjY291bnQsXG4gIEViaWxsQmlsbGVyLFxuICBFYmlsbENyZWRlbnRpYWwsXG4gIE90cERlbGl2ZXJ5TWV0aG9kLFxuICBCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVxdWVzdEJvZHksXG4gIEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHksXG59IGZyb20gJ0BiYWNrYmFzZS9kYXRhLWFuZy9iaWxscGF5JztcbmltcG9ydCB7IEJpbGxwYXlVdGlsaXR5U2VydmljZSBhcyBVdGlsaXRpZXMgfSBmcm9tICdAYmFja2Jhc2UvYmlsbHBheS1qb3VybmV5cy1jb21tb24nO1xuaW1wb3J0IHsgUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZSB9IGZyb20gJy4uL21vZGVsL3BheXZlcmlzLWVucm9sbWVudC1zdGF0ZS5lbnVtJztcbmltcG9ydCB7IFBheXZlcmlzRW5yb2xtZW50Q29tcG9uZW50U3RhdGUsIFBheXZlcmlzT3RwUGFzc2NvZGUsIFBheXZlcmlzTG9naW4sIFBheXZlcmlzQ2FwdGNoYSB9IGZyb20gJy4uL21vZGVsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEJpbGxwYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFdpZGdldFNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IHdpZGdldFN0YXRlU291cmNlID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSBfcGF5ZWVJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIF9jdXJyZW50U3RhdGUgPSBQYXl2ZXJpc0Vucm9sbWVudFN0YXRlLkluaXRpYWxpemU7XG4gIHByaXZhdGUgX2Vycm9yU3RhdGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBfY29tcG9uZW50U3RhdGUgPSBQYXl2ZXJpc0Vucm9sbWVudENvbXBvbmVudFN0YXRlLlVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBfdXNlcklucHV0RmFpbGVkID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgX3Jlc3BvbnNlcyA9IDxhbnk+e307XG4gIHByaXZhdGUgX2V4cGVjdGluZ0xvZ2luUmVzcG9uc2UgPSB0cnVlO1xuICBwcml2YXRlIF9vdHBUcmFuc3BvcnRNZXRob2RTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIF9leHBlY3RpbmdPdHBFbnRyeVJlc3BvbnNlID0gZmFsc2U7XG4gIHByaXZhdGUgX3BheWxvYWQ6IEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXF1ZXN0Qm9keTtcbiAgcHJpdmF0ZSByZWFkb25seSBfTUlOX0NBTExCQUNLX1RJTUUgPSAxO1xuICBwcml2YXRlIHRpbWVyOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PiB8IHVuZGVmaW5lZDtcblxuICByZWFkb25seSB3aWRnZXRTdGF0ZUNoYW5nZTogT2JzZXJ2YWJsZTx2b2lkPiA9IHRoaXMud2lkZ2V0U3RhdGVTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBheXZlcmlzRGF0YTogQmlsbFBheVBheXZlcmlzU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBheWVlc0RhdGE6IEJpbGxQYXlQYXllZXNTZXJ2aWNlLFxuICApIHtcbiAgICB0aGlzLl9wYXlsb2FkID0ge1xuICAgICAgcGF5ZWVJRDogPHN0cmluZz50aGlzLl9wYXllZUlkLFxuICAgICAgY3JlZGVudGlhbHM6IFtdLFxuICAgIH07XG4gIH1cblxuICBzdWJtaXRQYXl2ZXJpc1JlcXVlc3QoXG4gICAgcGF5bG9hZDogQmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlcXVlc3RCb2R5LFxuICApOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5Pj4ge1xuICAgIHRoaXMuX2NvbXBvbmVudFN0YXRlID0gUGF5dmVyaXNFbnJvbG1lbnRDb21wb25lbnRTdGF0ZS5DaGVja2luZztcbiAgICB0aGlzLl91c2VySW5wdXRGYWlsZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gdGhpcy5wYXl2ZXJpc0RhdGFcbiAgICAgIC5wb3N0QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50KHsgYmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlcXVlc3RCb2R5OiBwYXlsb2FkIH0sICdyZXNwb25zZScpXG4gICAgICAucGlwZShcbiAgICAgICAgY2F0Y2hFcnJvcihlcnIgPT4ge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyKTtcbiAgICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+PigpO1xuICAgICAgICB9KSxcbiAgICAgICk7XG4gIH1cblxuICBnZXRQYXllZU5hbWVGcm9tSUQoaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMucGF5ZWVzRGF0YS5nZXRFbGVjdHJvbmljUGF5ZWVCeUlkKHsgaWQ6IDxzdHJpbmc+aWQgfSkucGlwZShwbHVjaygncGF5ZWUnLCAnbmFtZScpKTtcbiAgfVxuXG4gIG9uSW5pdGlhbGl6ZUVucm9sbWVudCgpIHtcbiAgICBpZiAodGhpcy5fcGF5ZWVJZCkge1xuICAgICAgdGhpcy5fcGF5bG9hZCA9IHtcbiAgICAgICAgcGF5ZWVJRDogdGhpcy5fcGF5ZWVJZCxcbiAgICAgICAgY3JlZGVudGlhbHM6IFtdLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcih1bmRlZmluZWQpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnN1Ym1pdFBheXZlcmlzUmVxdWVzdCh0aGlzLl9wYXlsb2FkKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVTdGF0dXNSZXNwb25zZShyZXNwb25zZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVN0YXR1c1Jlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pIHtcbiAgICBpZiAodGhpcy5pc0JpbGxlcnNSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuU2VsZWN0QmlsbGVyLCByZXNwb25zZSwgJ2JpbGxlcnNSZXNwb25zZScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc1NlbGVjdEFjY291bnRSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuU2VsZWN0QWNjb3VudHMsIHJlc3BvbnNlLCAnYWNjb3VudHNSZXNwb25zZScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc090cFNlbGVjdFJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5PdHBTZWxlY3QsIHJlc3BvbnNlLCAnb3RwVHJhbnNwb3J0UmVzcG9uc2UnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2UpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZShQYXl2ZXJpc0Vucm9sbWVudFN0YXRlLkNhcHRjaGEsIHJlc3BvbnNlLCAnY2FwdGNoYVJlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ3JlZGVudGlhbHNSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNyZWRlbnRpYWxzT25TdGF0dXNSZXNwb25zZShyZXNwb25zZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNhbGxiYWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc1N1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuU3VjY2Vzcyk7XG4gICAgfVxuICAgIHRoaXMuaGFuZGxlRXJyb3IodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUNyZWRlbnRpYWxzT25TdGF0dXNSZXNwb25zZShyZXNwb25zZTogSHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+KSB7XG4gICAgaWYgKHRoaXMuX2V4cGVjdGluZ0xvZ2luUmVzcG9uc2UpIHtcbiAgICAgIHRoaXMuX2V4cGVjdGluZ0xvZ2luUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuTG9naW4sIHJlc3BvbnNlLCAnY3JlZGVudGlhbHNSZXNwb25zZScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fZXhwZWN0aW5nT3RwRW50cnlSZXNwb25zZSkge1xuICAgICAgdGhpcy5fZXhwZWN0aW5nT3RwRW50cnlSZXNwb25zZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5PdHBFbnRyeSwgcmVzcG9uc2UsICdvdHBQYXNzY29kZVJlc3BvbnNlJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuTWZhLCByZXNwb25zZSwgJ21mYVJlc3BvbnNlJyk7XG4gIH1cblxuICBvblN1Ym1pdEJpbGxlclNlbGVjdGlvbihiaWxsZXJTZWxlY3RlZEluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBiaWxsZXJTZWxlY3RlZCA9IHRoaXMuYmlsbGVycyA/IHRoaXMuYmlsbGVyc1tiaWxsZXJTZWxlY3RlZEluZGV4XSA6IHt9O1xuICAgIHRoaXMuX3BheWxvYWQgPSB7XG4gICAgICBwYXllZUlEOiA8c3RyaW5nPnRoaXMuX3BheWVlSWQsXG4gICAgICBiaWxsZXI6IGJpbGxlclNlbGVjdGVkLFxuICAgICAgY3JlZGVudGlhbHM6IFtdLFxuICAgIH07XG4gICAgdGhpcy5zdWJtaXRQYXl2ZXJpc1JlcXVlc3QodGhpcy5fcGF5bG9hZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlQmlsbGVyUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVCaWxsZXJSZXNwb25zZShyZXNwb25zZTogSHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+KSB7XG4gICAgaWYgKHRoaXMuaXNDcmVkZW50aWFsc1Jlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5Mb2dpbiwgcmVzcG9uc2UsICdjcmVkZW50aWFsc1Jlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNhbGxiYWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZUVycm9yKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgb25TdWJtaXRQYXllZUxvZ2luKGxvZ2luOiBQYXl2ZXJpc0xvZ2luIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKGxvZ2luICYmIHRoaXMubG9naW5DcmVkZW50aWFsc0FycmF5ICYmIHRoaXMubG9naW5DcmVkZW50aWFsc0FycmF5Lmxlbmd0aCA+PSAyKSB7XG4gICAgICBjb25zdCBjcmVkZW50aWFscyA9IHRoaXMubG9naW5DcmVkZW50aWFsc0FycmF5Py5tYXAoKGNyZWRlbnRpYWxzLCBpKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uY3JlZGVudGlhbHMsXG4gICAgICAgICAgdmFsdWU6IGxvZ2luW2ldLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB0aGlzLl9wYXlsb2FkID0ge1xuICAgICAgICBwYXllZUlEOiA8c3RyaW5nPnRoaXMuX3BheWVlSWQsXG4gICAgICAgIGNyZWRlbnRpYWxzOiBjcmVkZW50aWFscyxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IodW5kZWZpbmVkKTtcbiAgICB9XG4gICAgdGhpcy5zdWJtaXRQYXl2ZXJpc1JlcXVlc3QodGhpcy5fcGF5bG9hZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlQ3JlZGVudGlhbFJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQ3JlZGVudGlhbFJlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5pc090cFNlbGVjdFJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5PdHBTZWxlY3QsIHJlc3BvbnNlLCAnb3RwVHJhbnNwb3J0UmVzcG9uc2UnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2UpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZShQYXl2ZXJpc0Vucm9sbWVudFN0YXRlLkNhcHRjaGEsIHJlc3BvbnNlLCAnY2FwdGNoYVJlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ3JlZGVudGlhbHNSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuTWZhLCByZXNwb25zZSwgJ21mYVJlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzU2VsZWN0QWNjb3VudFJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5TZWxlY3RBY2NvdW50cywgcmVzcG9uc2UsICdhY2NvdW50c1Jlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNhbGxiYWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZUVycm9yKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgb25TdWJtaXRQYXl2ZXJpc0ViaWxsTWZhKCkge1xuICAgIHRoaXMuX3BheWxvYWQgPSB7XG4gICAgICBwYXllZUlEOiA8c3RyaW5nPnRoaXMuX3BheWVlSWQsXG4gICAgICBjcmVkZW50aWFsczogdGhpcy5tZmFBcnJheSB8fCBbXSxcbiAgICB9O1xuICAgIHRoaXMuc3VibWl0UGF5dmVyaXNSZXF1ZXN0KHRoaXMuX3BheWxvYWQpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZU1mYVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlTWZhUmVzcG9uc2UocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5Pik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmlzQ3JlZGVudGlhbHNSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKFBheXZlcmlzRW5yb2xtZW50U3RhdGUuTWZhLCByZXNwb25zZSwgJ21mYVJlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzU2VsZWN0QWNjb3VudFJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5TZWxlY3RBY2NvdW50cywgcmVzcG9uc2UsICdhY2NvdW50c1Jlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNhbGxiYWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZUVycm9yKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgb25TdWJtaXRQYXl2ZXJpc0ViaWxsT3RwVHJhbnNwb3J0U2VsZWN0aW9uKHRyYW5zcG9ydFNlbGVjdGVkSW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuX2V4cGVjdGluZ090cEVudHJ5UmVzcG9uc2UgPSB0cnVlO1xuICAgIGNvbnN0IHRyYW5zcG9ydFNlbGVjdGVkID0gdGhpcy5vdHBUcmFuc3BvcnRzID8gdGhpcy5vdHBUcmFuc3BvcnRzW3RyYW5zcG9ydFNlbGVjdGVkSW5kZXhdIDoge307XG4gICAgdGhpcy5fb3RwVHJhbnNwb3J0TWV0aG9kU2VsZWN0ZWQgPSB0cmFuc3BvcnRTZWxlY3RlZC52YWx1ZTtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0TGFiZWxGcm9tUmVzcG9uc2UodGhpcy5fcmVzcG9uc2VzWydvdHBUcmFuc3BvcnRSZXNwb25zZSddKTtcbiAgICBjb25zdCBzZWxlY3Rpb246IEViaWxsQ3JlZGVudGlhbCA9IHtcbiAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgIHZhbHVlOiB0cmFuc3BvcnRTZWxlY3RlZC5pZCxcbiAgICB9O1xuICAgIHRoaXMuX3BheWxvYWQgPSB7XG4gICAgICBwYXllZUlEOiA8c3RyaW5nPnRoaXMuX3BheWVlSWQsXG4gICAgICBjcmVkZW50aWFsczogW3NlbGVjdGlvbl0sXG4gICAgfTtcbiAgICB0aGlzLnN1Ym1pdFBheXZlcmlzUmVxdWVzdCh0aGlzLl9wYXlsb2FkKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVPdHBUcmFuc3BvcnRSZXNwb25zZShyZXNwb25zZSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZU90cFRyYW5zcG9ydFJlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5pc0NyZWRlbnRpYWxzUmVzcG9uc2UocmVzcG9uc2UpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZShQYXl2ZXJpc0Vucm9sbWVudFN0YXRlLk90cEVudHJ5LCByZXNwb25zZSwgJ290cFBhc3Njb2RlUmVzcG9uc2UnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNDYWxsYmFja1Jlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSk7XG4gICAgfVxuICAgIHRoaXMuaGFuZGxlRXJyb3IodW5kZWZpbmVkKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBvblN1Ym1pdFBheXZlcmlzRWJpbGxQYXllZU90cFBhc3Njb2RlKHBhc3Njb2RlOiBQYXl2ZXJpc090cFBhc3Njb2RlKSB7XG4gICAgdGhpcy5zdWJtaXRWZXJpZmljYXRpb25TdGVwKHRoaXMuX3Jlc3BvbnNlc1snb3RwUGFzc2NvZGVSZXNwb25zZSddLCBwYXNzY29kZS5wYXNzY29kZSk7XG4gIH1cblxuICBvblN1Ym1pdFBheXZlcmlzRWJpbGxQYXllZUNhcHRjaGEoY2FwdGNoYTogUGF5dmVyaXNDYXB0Y2hhKSB7XG4gICAgdGhpcy5zdWJtaXRWZXJpZmljYXRpb25TdGVwKHRoaXMuX3Jlc3BvbnNlc1snY2FwdGNoYVJlc3BvbnNlJ10sIGNhcHRjaGEuY2FwdGNoYSk7XG4gIH1cblxuICBwcml2YXRlIHN1Ym1pdFZlcmlmaWNhdGlvblN0ZXAoXG4gICAgcHJldmlvdXNSZXNwb25zZTogQmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keSB8IHVuZGVmaW5lZCxcbiAgICBjcmVkZW50aWFsVmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgKSB7XG4gICAgdGhpcy5fcGF5bG9hZCA9IHRoaXMucHJlcGFyZUNyZWRlbnRpYWxQYXlsb2FkKHByZXZpb3VzUmVzcG9uc2UsIGNyZWRlbnRpYWxWYWx1ZSk7XG4gICAgdGhpcy5zdWJtaXRQYXl2ZXJpc1JlcXVlc3QodGhpcy5fcGF5bG9hZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgIHRoaXMuaGFuZGxlVmVyaWZpY2F0aW9uUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwcmVwYXJlQ3JlZGVudGlhbFBheWxvYWQoXG4gICAgcmVzcG9uc2U6IEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHkgfCB1bmRlZmluZWQsXG4gICAgY3JlZGVudGlhbFZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICk6IEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXF1ZXN0Qm9keSB7XG4gICAgY29uc3QgbGFiZWwgPSB0aGlzLmdldExhYmVsRnJvbVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICBjb25zdCBzZWxlY3Rpb246IEViaWxsQ3JlZGVudGlhbCA9IHtcbiAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgIHZhbHVlOiBjcmVkZW50aWFsVmFsdWUsXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgcGF5ZWVJRDogPHN0cmluZz50aGlzLnBheWVlSWQsXG4gICAgICBjcmVkZW50aWFsczogW3NlbGVjdGlvbl0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlVmVyaWZpY2F0aW9uUmVzcG9uc2UocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5Pikge1xuICAgIGlmICh0aGlzLmlzU2VsZWN0QWNjb3VudFJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5TZWxlY3RBY2NvdW50cywgcmVzcG9uc2UsICdhY2NvdW50c1Jlc3BvbnNlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNhbGxiYWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZUVycm9yKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY2FuY2VsRW5yb2xtZW50KCk6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPGFueT4+IHtcbiAgICByZXR1cm4gdGhpcy5wYXl2ZXJpc0RhdGEuZGVsZXRlQmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50KHRoaXMuX3BheWxvYWQpO1xuICB9XG5cbiAgb25TdWJtaXRQYXl2ZXJpc0ViaWxsQWNjb3VudFNlbGVjdGlvbihhY2NvdW50U2VsZWN0ZWRJbmRleDogbnVtYmVyKSB7XG4gICAgY29uc3QgYWNjb3VudFNlbGVjdGVkID0gdGhpcy5hY2NvdW50cyA/IHRoaXMuYWNjb3VudHNbYWNjb3VudFNlbGVjdGVkSW5kZXhdIDogdW5kZWZpbmVkO1xuICAgIHRoaXMuX3BheWxvYWQgPSB7XG4gICAgICBwYXllZUlEOiA8c3RyaW5nPnRoaXMuX3BheWVlSWQsXG4gICAgICBhY2NvdW50OiBhY2NvdW50U2VsZWN0ZWQsXG4gICAgICBjcmVkZW50aWFsczogW10sXG4gICAgfTtcbiAgICB0aGlzLnN1Ym1pdFBheXZlcmlzUmVxdWVzdCh0aGlzLl9wYXlsb2FkKS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVBY2NvdW50c1Jlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQWNjb3VudHNSZXNwb25zZShyZXNwb25zZTogSHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+KSB7XG4gICAgaWYgKHRoaXMuaXNDYWxsYmFja1Jlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQ2FsbGJhY2tSZXNwb25zZShyZXNwb25zZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzU3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5TdWNjZXNzLCByZXNwb25zZSwgJ3N1Y2Nlc3NSZXNwb25zZScpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZUVycm9yKHVuZGVmaW5lZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVDYWxsYmFja1Jlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pIHtcbiAgICBjb25zdCBjYWxsYmFja1RpbWUgPSBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnYm9keS5jYWxsQmFja1RpbWUnLCByZXNwb25zZSkgfHwgMDtcbiAgICBjb25zdCBjYWxsYmFja1RpbWVJbk1zID0gTWF0aC5tYXgobmV3IERhdGUoY2FsbGJhY2tUaW1lKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSwgdGhpcy5fTUlOX0NBTExCQUNLX1RJTUUpO1xuICAgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMub25Jbml0aWFsaXplRW5yb2xtZW50KCk7XG4gICAgfSwgY2FsbGJhY2tUaW1lSW5Ncyk7XG4gICAgdGhpcy5fY29tcG9uZW50U3RhdGUgPSBQYXl2ZXJpc0Vucm9sbWVudENvbXBvbmVudFN0YXRlLkNhbGxiYWNrO1xuICAgIHRoaXMud2lkZ2V0U3RhdGVTb3VyY2UubmV4dCgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgY2FuY2VsQ2FsbGJhY2soKSB7XG4gICAgaWYgKHRoaXMudGltZXIpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFN0YXRlKFxuICAgIHN0YXRlOiBQYXl2ZXJpc0Vucm9sbWVudFN0YXRlLFxuICAgIHJlc3BvbnNlPzogSHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+IHwgdW5kZWZpbmVkLFxuICAgIHJlc3BvbnNlVG9TZXQ/OiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICkge1xuICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHN0YXRlO1xuICAgIHRoaXMuX2NvbXBvbmVudFN0YXRlID0gUGF5dmVyaXNFbnJvbG1lbnRDb21wb25lbnRTdGF0ZS5SZWFkeTtcbiAgICBpZiAocmVzcG9uc2VUb1NldCkge1xuICAgICAgdGhpcy5fcmVzcG9uc2VzW3Jlc3BvbnNlVG9TZXRdID0gVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHknLCByZXNwb25zZSk7XG4gICAgfVxuICAgIHRoaXMud2lkZ2V0U3RhdGVTb3VyY2UubmV4dCgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvcjogYW55KSB7XG4gICAgdGhpcy5fZXJyb3JTdGF0ZSA9IFV0aWxpdGllcy5jaGVja0ZvclByb3BlcnR5KFsnZXJyb3InLCAnZXJyb3JzJywgMCwgJ2tleSddLCBlcnJvcik7XG4gICAgaWYgKHRoaXMuX2Vycm9yU3RhdGUgPT09ICdiaWxscGF5LmFwaS5pbnZhbGlkQ3JlZGVudGlhbHMnKSB7XG4gICAgICB0aGlzLl91c2VySW5wdXRGYWlsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5fY29tcG9uZW50U3RhdGUgPSBQYXl2ZXJpc0Vucm9sbWVudENvbXBvbmVudFN0YXRlLlJlYWR5O1xuICAgICAgdGhpcy53aWRnZXRTdGF0ZVNvdXJjZS5uZXh0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZS5FcnJvclN0YXRlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzQ3JlZGVudGlhbHNSZXNwb25zZShyZXNwb25zZTogSHR0cFJlc3BvbnNlPEJpbGxQYXlQYXl2ZXJpc0ViaWxsc0Vucm9sbWVudFBvc3RSZXNwb25zZUJvZHk+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhKFxuICAgICAgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgJiYgVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHkuYXV0aGVudGljYXRpb24uY3JlZGVudGlhbHMubGVuZ3RoJywgcmVzcG9uc2UpID4gMFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGlzQmlsbGVyc1Jlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgJiYgVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHkuYmlsbGVycy5sZW5ndGgnLCByZXNwb25zZSkgPiAwKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNDYWxsYmFja1Jlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICBjb25zdCBhY2NvdW50cyA9IFV0aWxpdGllcy5jaGVja0ZvclByb3BlcnR5KCdib2R5LmFjY291bnRzJywgcmVzcG9uc2UpO1xuICAgIHJldHVybiAhIShcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwICYmXG4gICAgICAoIWFjY291bnRzIHx8IGFjY291bnRzLmxlbmd0aCA9PT0gMCkgJiZcbiAgICAgIFV0aWxpdGllcy5jaGVja0ZvclByb3BlcnR5KCdib2R5LmNhbGxCYWNrUmVxdWlyZWQnLCByZXNwb25zZSkgJiZcbiAgICAgIFV0aWxpdGllcy5jaGVja0ZvclByb3BlcnR5KCdib2R5LmNhbGxCYWNrVGltZScsIHJlc3BvbnNlKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGlzU2VsZWN0QWNjb3VudFJlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgJiYgVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHkuYWNjb3VudHMubGVuZ3RoJywgcmVzcG9uc2UpID49IDEpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc090cFNlbGVjdFJlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEoXG4gICAgICByZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJlxuICAgICAgVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHkuYXV0aGVudGljYXRpb24uc2VjdXJpdHlDaGFsbGVuZ2Uub25lVGltZVBhc3Njb2RlJywgcmVzcG9uc2UpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5Pik6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIShcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwICYmXG4gICAgICBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnYm9keS5hdXRoZW50aWNhdGlvbi5zZWN1cml0eUNoYWxsZW5nZS5jYXB0Y2hhJywgcmVzcG9uc2UpICYmXG4gICAgICBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnYm9keS5hdXRoZW50aWNhdGlvbi5jcmVkZW50aWFscycsIHJlc3BvbnNlKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGlzU3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8QmlsbFBheVBheXZlcmlzRWJpbGxzRW5yb2xtZW50UG9zdFJlc3BvbnNlQm9keT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgJiYgVXRpbGl0aWVzLmNoZWNrRm9yUHJvcGVydHkoJ2JvZHkucGF5ZWVJRCcsIHJlc3BvbnNlKSk7XG4gIH1cblxuICBwcml2YXRlIGdldExhYmVsRnJvbVJlc3BvbnNlKFxuICAgIHJlc3BvbnNlOiBCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5IHwgdW5kZWZpbmVkLFxuICApOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eShbJ2F1dGhlbnRpY2F0aW9uJywgJ2NyZWRlbnRpYWxzJywgMCwgJ2xhYmVsJ10sIHJlc3BvbnNlKTtcbiAgfVxuXG4gIHNldCBwYXllZUlkKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9wYXllZUlkID0gdmFsdWU7XG4gIH1cblxuICBjcmVkZW50aWFsc1Jlc3BvbnNlID0gKHZhbHVlOiBCaWxsUGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRQb3N0UmVzcG9uc2VCb2R5IHwgdW5kZWZpbmVkKSA9PiB7XG4gICAgdGhpcy5fcmVzcG9uc2VzLmNyZWRlbnRpYWxzUmVzcG9uc2UgPSB2YWx1ZTtcbiAgfTtcbiAgZ2V0IHBheWVlSWQoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fcGF5ZWVJZDtcbiAgfVxuXG4gIGdldCBjdXJyZW50U3RhdGUoKTogUGF5dmVyaXNFbnJvbG1lbnRTdGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRTdGF0ZTtcbiAgfVxuXG4gIGdldCBlcnJvclN0YXRlKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX2Vycm9yU3RhdGU7XG4gIH1cblxuICBnZXQgY29tcG9uZW50U3RhdGUoKTogUGF5dmVyaXNFbnJvbG1lbnRDb21wb25lbnRTdGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudFN0YXRlO1xuICB9XG5cbiAgc2V0IGNvbXBvbmVudFN0YXRlKHZhbHVlOiBQYXl2ZXJpc0Vucm9sbWVudENvbXBvbmVudFN0YXRlKSB7XG4gICAgdGhpcy5fY29tcG9uZW50U3RhdGUgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCB1c2VySW5wdXRGYWlsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3VzZXJJbnB1dEZhaWxlZDtcbiAgfVxuXG4gIGdldCBsb2dpbkNyZWRlbnRpYWxzQXJyYXkoKTogRWJpbGxDcmVkZW50aWFsW10gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnY3JlZGVudGlhbHNSZXNwb25zZS5hdXRoZW50aWNhdGlvbi5jcmVkZW50aWFscycsIHRoaXMuX3Jlc3BvbnNlcykgfHwgW107XG4gIH1cblxuICBnZXQgbWZhQXJyYXkoKTogRWJpbGxDcmVkZW50aWFsW10gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnbWZhUmVzcG9uc2UuYXV0aGVudGljYXRpb24uY3JlZGVudGlhbHMnLCB0aGlzLl9yZXNwb25zZXMpIHx8IFtdO1xuICB9XG5cbiAgZ2V0IGJpbGxlcnMoKTogRWJpbGxCaWxsZXJbXSB7XG4gICAgcmV0dXJuIFV0aWxpdGllcy5jaGVja0ZvclByb3BlcnR5KCdiaWxsZXJzUmVzcG9uc2UuYmlsbGVycycsIHRoaXMuX3Jlc3BvbnNlcykgfHwgW107XG4gIH1cblxuICBnZXQgYWNjb3VudHMoKTogRWJpbGxBY2NvdW50W10ge1xuICAgIHJldHVybiBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eSgnYWNjb3VudHNSZXNwb25zZS5hY2NvdW50cycsIHRoaXMuX3Jlc3BvbnNlcykgfHwgW107XG4gIH1cblxuICBnZXQgb3RwVHJhbnNwb3J0TWV0aG9kU2VsZWN0ZWQoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fb3RwVHJhbnNwb3J0TWV0aG9kU2VsZWN0ZWQ7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRm9yUHJvcGVydHlXcmFwcGVyKHByb3BlcnR5QnJhbmNoOiBzdHJpbmcpOiBhbnkgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBVdGlsaXRpZXMuY2hlY2tGb3JQcm9wZXJ0eShwcm9wZXJ0eUJyYW5jaCwgdGhpcy5fcmVzcG9uc2VzKTtcbiAgfVxuXG4gIGdldCBvdHBUcmFuc3BvcnRzKCk6IE90cERlbGl2ZXJ5TWV0aG9kW10gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNoZWNrRm9yUHJvcGVydHlXcmFwcGVyKFxuICAgICAgJ290cFRyYW5zcG9ydFJlc3BvbnNlLmF1dGhlbnRpY2F0aW9uLnNlY3VyaXR5Q2hhbGxlbmdlLm9uZVRpbWVQYXNzY29kZS5kZWxpdmVyeU1ldGhvZHMnLFxuICAgICk7XG4gIH1cblxuICBnZXQgY2FwdGNoYUltYWdlU3JjKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuY2hlY2tGb3JQcm9wZXJ0eVdyYXBwZXIoJ2NhcHRjaGFSZXNwb25zZS5hdXRoZW50aWNhdGlvbi5zZWN1cml0eUNoYWxsZW5nZS5jYXB0Y2hhLmltYWdlJyk7XG4gIH1cblxuICBnZXQgY2FwdGNoYUltYWdlVHlwZSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNoZWNrRm9yUHJvcGVydHlXcmFwcGVyKCdjYXB0Y2hhUmVzcG9uc2UuYXV0aGVudGljYXRpb24uc2VjdXJpdHlDaGFsbGVuZ2UuY2FwdGNoYS5taW1lVHlwZScpO1xuICB9XG59XG4iXX0=