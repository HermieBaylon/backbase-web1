import { Component, ViewChild } from '@angular/core';
import { BehaviorSubject, Observable, Subject } from 'rxjs';
import { takeUntil, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../../services/manage-payees-navigation.service";
import * as i2 from "@angular/router";
import * as i3 from "../../services/manage-payees-journey-config.service";
import * as i4 from "../../services/billpay-payee-summary-widget.service";
import * as i5 from "@backbase/ui-ang/notification";
import * as i6 from "@backbase/ui-ang/icon";
import * as i7 from "@backbase/ui-ang/header";
import * as i8 from "../../components/payee-summary/billpay-payee-stepper/billpay-payee-stepper.component";
import * as i9 from "../../components/payee-summary/billpay-payee-information/billpay-payee-information.component";
import * as i10 from "@backbase/billpay-journeys-common";
import * as i11 from "@backbase/ui-ang/loading-indicator";
import * as i12 from "@backbase/ui-ang/empty-state";
import * as i13 from "@backbase/ui-ang/button";
import * as i14 from "@angular/common";
export class PayeeSummaryViewComponent {
    /** @internal */
    constructor(routerService, route, config, payeeSummaryService, notificationService, cdRef) {
        this.routerService = routerService;
        this.route = route;
        this.config = config;
        this.payeeSummaryService = payeeSummaryService;
        this.notificationService = notificationService;
        this.cdRef = cdRef;
        this.selectedDeletePayeeSource = new BehaviorSubject(undefined);
        this.destroy$ = new Subject();
        this.payees$ = new Observable();
        this.isDeleteModalOpened = false;
        this.isNavigateModalOpened = false;
        this.payeeIndex = 0;
        this.notificationMessageTemplate = '';
        this.notificationHeaderTemplate = '';
        this.navigationExtras = { relativeTo: this.route.parent };
    }
    gotoPayeeList() {
        this.routerService.navigateToPayeeList(this.navigationExtras);
    }
    gotoAddPayee() {
        this.routerService.navigateToSearch(this.navigationExtras);
    }
    gotoOneOffPayment(id) {
        this.routerService.navigateToOneOffPayment(id);
    }
    gotoEditManual(id) {
        this.routerService.navigateToEditManualPayeeForm(id, this.navigationExtras);
    }
    gotoEditElectronic(id) {
        this.routerService.navigateToEditElectronicPayeeForm(id, this.navigationExtras);
    }
    gotoPaymentsList() {
        this.routerService.navigateToPendingPayments();
    }
    ngOnInit() {
        const id = this.route.snapshot.params['payeeID'] || undefined;
        this.payees$ = this.payeeSummaryService.getPayees().pipe(tap(data => this.setPayee(data, id)), tap(data => (this.payeeSummaries = data)));
    }
    setPayee(payeeSummaries, id) {
        if (!payeeSummaries || payeeSummaries.length === 0) {
            return;
        }
        else if (id === undefined) {
            this.payeeSummary = payeeSummaries[0];
        }
        else {
            const payeeIndex = payeeSummaries.findIndex(payee => payee.id === id);
            if (payeeIndex > 0) {
                this.payeeIndex = payeeIndex;
                this.payeeSummary = payeeSummaries[payeeIndex];
            }
            else {
                this.payeeSummary = payeeSummaries[0];
            }
        }
        if (!this.payeeSummary.electronic) {
            this.payeeSummaryService
                .getFullSummary(this.payeeSummary.id)
                .pipe(takeUntil(this.destroy$))
                .subscribe(payee => {
                this.fullManualPayeeSummary = payee;
                this.cdRef.detectChanges();
            });
        }
    }
    handleEditPayee() {
        if (this.payeeSummary && this.payeeSummary.electronic) {
            this.gotoEditElectronic(this.payeeSummary.id);
        }
        else if (this.payeeSummary && !this.payeeSummary.electronic) {
            this.gotoEditManual(this.payeeSummary.id);
        }
    }
    onNavigateToPayments(resolve) {
        if (resolve) {
            this.gotoPaymentsList();
        }
        this.closeNavigateModal();
    }
    selectedDeletePayee() {
        return this.selectedDeletePayeeSource.asObservable();
    }
    handleDeletePayee() {
        this.payeeSummary && !this.payeeSummary.nextPayment ? this.openDeleteModal() : this.openNavigateModal();
        this.selectedDeletePayeeSource.next(this.payeeSummary);
    }
    openNavigateModal() {
        this.isNavigateModalOpened = true;
    }
    closeNavigateModal() {
        this.isNavigateModalOpened = false;
    }
    openDeleteModal() {
        this.isDeleteModalOpened = true;
    }
    closeDeleteModal() {
        this.isDeleteModalOpened = false;
    }
    onDeletePayee(resolve) {
        this.closeDeleteModal();
        if (resolve && this.payeeSummary) {
            this.payeeSummaryService
                .deletePayee(this.payeeSummary.id, this.payeeSummary.electronic)
                .pipe(takeUntil(this.destroy$))
                .subscribe(() => {
                this.deletionNotify();
            });
            this.gotoPayeeList();
        }
    }
    deletionNotify() {
        this.notificationService.showNotification({
            header: this.notificationHeaderTemplate,
            message: this.notificationMessageTemplate,
            modifier: 'success',
            ttl: this.dismissTimeoutValue,
        });
    }
    get dismissTimeoutValue() {
        if (this.config.notificationDismissTime === undefined) {
            throw new Error('Dismiss timeout value not found');
        }
        return this.config.notificationDismissTime;
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    updatePayee() {
        if (this.payeeSummaries) {
            this.payeeSummary = this.payeeSummaries[this.payeeIndex];
            if (this.payeeSummary && !this.payeeSummary.electronic) {
                this.payeeSummaryService
                    .getFullSummary(this.payeeSummary.id)
                    .pipe(takeUntil(this.destroy$))
                    .subscribe(payee => {
                    this.fullManualPayeeSummary = payee;
                    this.cdRef.detectChanges();
                });
            }
            else {
                this.fullManualPayeeSummary = undefined;
                this.cdRef.detectChanges();
            }
        }
    }
    nextPayee() {
        ++this.payeeIndex;
        this.updatePayee();
    }
    previousPayee() {
        --this.payeeIndex;
        this.updatePayee();
    }
    get currentLoadingState() {
        return this.payeeSummaryService.payeesSummaryLoadingState;
    }
}
PayeeSummaryViewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: PayeeSummaryViewComponent, deps: [{ token: i1.ManagePayeesNavigationService }, { token: i2.ActivatedRoute }, { token: i3.ManagePayeesJourneyConfigService }, { token: i4.BillpayPayeeSummaryWidgetService }, { token: i5.NotificationService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
PayeeSummaryViewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: PayeeSummaryViewComponent, selector: "bb-billpay-payee-details-view", viewQueries: [{ propertyName: "notificationMessageTemplate", first: true, predicate: ["notificationMessage"], descendants: true }, { propertyName: "notificationHeaderTemplate", first: true, predicate: ["notificationHeader"], descendants: true }], ngImport: i0, template: "<div class=\"bb-block bb-block--lg\">\n  <button bbButton color=\"link\" class=\"bb-block bb-block--md pl-0\" (click)=\"gotoPayeeList()\">\n    <bb-icon-ui name=\"arrow-back\" size=\"md\"></bb-icon-ui>\n    <span i18n=\"button label|Back button@@billpay-payees-journey.payee-summary.back\">Back to Payee List</span>\n  </button>\n  <bb-header-ui headingType=\"h1\" [heading]=\"'Payee summary'\" i18n-heading=\"@@billpay-payees-journey.add-payee\">\n  </bb-header-ui>\n</div>\n\n<ng-template #notificationMessage>\n  <div>\n    <div>\n      <span\n        i18n=\"\n          delete payee notification message|Payee delete confirmation success notification\n          message@@billpay-payee-summary.delete-payee-confirm.notification.message\"\n        >The payee\n        {{ payeeSummary.nickName ? payeeSummary.nickName + ' (' + payeeSummary.name + ')' : payeeSummary.name }} has\n        been deleted successfully</span\n      >\n    </div>\n  </div>\n</ng-template>\n\n <ng-container *ngIf=\"payees$ | async as allPayees\">\n  <ng-container *ngIf=\"payeeSummary; else emptyState\">\n    <div class=\"card card-lg\">\n      <div class=\"card-body\">\n        <div class=\"bb-block bb-block--md\">\n          <bb-billpay-payee-stepper\n            [index]=\"payeeIndex\"\n            [size]=\"allPayees.length\"\n            (nextPayee)=\"nextPayee()\"\n            (previousPayee)=\"previousPayee()\"\n          >\n          </bb-billpay-payee-stepper>\n        </div>\n        <div class=\"bb-block bb-block--lg\">\n          <bb-header-ui\n            headingType=\"h2\"\n            *ngIf=\"payeeSummary.nickName || payeeSummary.name\"\n            data-role=\"full-summary-payee-name-primary\"\n            heading=\"{{ payeeSummary.nickName || payeeSummary.name }}\"\n          >\n          </bb-header-ui>\n          <div\n            class=\"bb-highlight\"\n            *ngIf=\"payeeSummary.nickName && payeeSummary.name\"\n            data-role=\"full-summary-payee-name-secondary\"\n          >\n            {{ payeeSummary.name }}\n          </div>\n        </div>\n\n        <bb-billpay-payee-information\n          [payeeSummary]=\"payeeSummary\"\n          [fullPayee]=\"fullManualPayeeSummary\"\n          (editPayee)=\"handleEditPayee()\"\n          (deletePayee)=\"handleDeletePayee()\"\n        >\n        </bb-billpay-payee-information>\n\n        <div class=\"bb-button-bar bb-button-bar--reverse\">\n          <button\n            bbButton\n            (click)=\"gotoOneOffPayment(payeeSummary)\"\n            data-role=\"make-payment-from-summary-payee-button\"\n            color=\"primary\"\n            class=\"bb-button-bar__button\"\n            i18n=\"\n              Make a payment button|Text for the make a payment vie full summary\n              button@@bb-billpay-view-payee-full-summary.button.make-payment\"\n          >\n            Make a payment\n          </button>\n        </div>\n\n        <bb-billpay-payee-delete-modal\n          *ngIf=\"isDeleteModalOpened\"\n          (resolve)=\"onDeletePayee($event)\"\n        ></bb-billpay-payee-delete-modal>\n\n        <bb-billpay-payee-navigate-modal\n          *ngIf=\"isNavigateModalOpened\"\n          (resolve)=\"onNavigateToPayments($event)\"\n        ></bb-billpay-payee-navigate-modal>\n      </div>\n    </div>\n  </ng-container>\n</ng-container> \n\n<ng-container *ngIf=\"currentLoadingState | async as currentLoadingState\">\n  <ng-container *ngIf=\"currentLoadingState === 'loading'\">\n    <div class=\"card card-lg\">\n      <div class=\"card-body\">\n        <bb-loading-indicator-ui loaderSize=\"lg\"> </bb-loading-indicator-ui>\n      </div>\n    </div>\n  </ng-container>\n\n  <ng-container *ngIf=\"currentLoadingState === 'error'\">\n    <div class=\"card card-lg\">\n      <div class=\"card-body\">\n        <bb-empty-state-ui\n          data-role=\"error-state\"\n          iconSize=\"xxl\"\n          iconModifier=\"error-outline\"\n          subtitle=\"Try to reload the page or contact support\"\n          i18n-subtitle=\"\n            Try to reload the page or contact support|Payee Summary error loading\n            subtitle@@bb-billpay-payee-summary-widget-ang.loading.subtitle\"\n          title=\"Could not fetch payee details\"\n          i18n-title=\"\n            Could not fetch payee details|Payee Summary error loading\n            title@@bb-billpay-payee-summary-widget-ang.loading.title\"\n        >\n        </bb-empty-state-ui>\n      </div>\n    </div>\n  </ng-container>\n</ng-container>\n\n<ng-template #emptyState>\n  <div class=\"card card-lg\">\n    <div class=\"card-body bb-state-container\">\n      <bb-empty-state-ui\n        data-role=\"empty-state\"\n        iconSize=\"xxl\"\n        iconModifier=\"assignment-ind\"\n        subtitle=\"Add a payee to make a bill payment\"\n        i18n-subtitle=\"\n          Add a payee to make a bill payment|Payee Summary no payees\n          subtitle@@bb-billpay-payee-summary-widget-ang.bb-empty-state-ui.subtitle\"\n        title=\"No payees\"\n        i18n-title=\"\n          No payees state text|Payee Summary no payees\n          title@@bb-billpay-payee-summary-widget-ang.bb-empty-state-ui.title\"\n      >\n      </bb-empty-state-ui>\n      <div class=\"bb-state-container__footer\">\n        <button\n          bbButton\n          data-role=\"empty-state-add-payee-btn\"\n          (click)=\"gotoAddPayee()\"\n          i18n=\"\n            Add a payee|Payee Summary add payee\n            button@@bb-billpay-payee-summary-widget-ang.bb-empty-state-ui.button.add-payee\"\n        >\n          Add a payee\n        </button>\n      </div>\n    </div>\n  </div>\n</ng-template>\n\n<ng-template #notificationHeader>\n  <div>\n    <span\n      i18n=\"\n        delete payee notification header|Payee delete confirmation success notification\n        header@@billpay-payee-summary.confirm.notification.header\"\n      >Payee deleted</span\n    >\n  </div>\n</ng-template>\n", components: [{ type: i6.IconComponent, selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }, { type: i7.HeaderComponent, selector: "bb-header-ui", inputs: ["headingClasses", "headingType", "heading"] }, { type: i8.BillpayPayeeStepperComponent, selector: "bb-billpay-payee-stepper", inputs: ["index", "size"], outputs: ["nextPayee", "previousPayee"] }, { type: i9.BillpayPayeeInformationComponent, selector: "bb-billpay-payee-information", inputs: ["payeeSummary", "fullPayee"], outputs: ["editPayee", "deletePayee"] }, { type: i10.ӨBillpayPayeeDeleteModalComponent, selector: "bb-billpay-payee-delete-modal", outputs: ["resolve"] }, { type: i10.ӨBillpayPayeeNavigateModalComponent, selector: "bb-billpay-payee-navigate-modal", outputs: ["resolve"] }, { type: i11.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i12.EmptyStateComponent, selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }], directives: [{ type: i13.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i14.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i14.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: PayeeSummaryViewComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-billpay-payee-details-view',
                    templateUrl: './billpay-payee-summary-view.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.ManagePayeesNavigationService }, { type: i2.ActivatedRoute }, { type: i3.ManagePayeesJourneyConfigService }, { type: i4.BillpayPayeeSummaryWidgetService }, { type: i5.NotificationService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { notificationMessageTemplate: [{
                type: ViewChild,
                args: ['notificationMessage']
            }], notificationHeaderTemplate: [{
                type: ViewChild,
                args: ['notificationHeader']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbHBheS1wYXllZS1zdW1tYXJ5LXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9tYW5hZ2UtcGF5ZWVzLWpvdXJuZXkvc3JjL3ZpZXdzL2JpbGxwYXktcGF5ZWUtc3VtbWFyeS9iaWxscGF5LXBheWVlLXN1bW1hcnktdmlldy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wYXllZXMtam91cm5leS9zcmMvdmlld3MvYmlsbHBheS1wYXllZS1zdW1tYXJ5L2JpbGxwYXktcGF5ZWUtc3VtbWFyeS12aWV3LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBcUIsU0FBUyxFQUFrQyxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFeEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVELE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXaEQsTUFBTSxPQUFPLHlCQUF5QjtJQWNwQyxnQkFBZ0I7SUFDaEIsWUFDbUIsYUFBNEMsRUFDNUMsS0FBcUIsRUFDckIsTUFBd0MsRUFDeEMsbUJBQXFELEVBQ3JELG1CQUF3QyxFQUN4QyxLQUF3QjtRQUx4QixrQkFBYSxHQUFiLGFBQWEsQ0FBK0I7UUFDNUMsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsV0FBTSxHQUFOLE1BQU0sQ0FBa0M7UUFDeEMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFrQztRQUNyRCx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBbkIxQiw4QkFBeUIsR0FBRyxJQUFJLGVBQWUsQ0FBMkIsU0FBUyxDQUFDLENBQUM7UUFDckYsYUFBUSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDaEQsWUFBTyxHQUErQixJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQ3ZELHdCQUFtQixHQUFHLEtBQUssQ0FBQztRQUM1QiwwQkFBcUIsR0FBRyxLQUFLLENBQUM7UUFJOUIsZUFBVSxHQUFHLENBQUMsQ0FBQztRQUNtQixnQ0FBMkIsR0FBOEIsRUFBRSxDQUFDO1FBQzdELCtCQUEwQixHQUE4QixFQUFFLENBQUM7UUFXMUYsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDNUQsQ0FBQztJQUVELGFBQWE7UUFDWCxJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFDRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBQ0QsaUJBQWlCLENBQUMsRUFBVTtRQUMxQixJQUFJLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFDTyxjQUFjLENBQUMsRUFBVTtRQUMvQixJQUFJLENBQUMsYUFBYSxDQUFDLDZCQUE2QixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUM5RSxDQUFDO0lBQ08sa0JBQWtCLENBQUMsRUFBVTtRQUNuQyxJQUFJLENBQUMsYUFBYSxDQUFDLGlDQUFpQyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBQ08sZ0JBQWdCO1FBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMseUJBQXlCLEVBQUUsQ0FBQztJQUNqRCxDQUFDO0lBRUQsUUFBUTtRQUNOLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxTQUFTLENBQUM7UUFDOUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSSxDQUN0RCxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUNwQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FDMUMsQ0FBQztJQUNKLENBQUM7SUFFTyxRQUFRLENBQUMsY0FBOEIsRUFBRSxFQUFzQjtRQUNyRSxJQUFJLENBQUMsY0FBYyxJQUFJLGNBQWMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ2xELE9BQU87U0FDUjthQUFNLElBQUksRUFBRSxLQUFLLFNBQVMsRUFBRTtZQUMzQixJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN2QzthQUFNO1lBQ0wsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDdEUsSUFBSSxVQUFVLEdBQUcsQ0FBQyxFQUFFO2dCQUNsQixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLFlBQVksR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDaEQ7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLFlBQVksR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDdkM7U0FDRjtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRTtZQUNqQyxJQUFJLENBQUMsbUJBQW1CO2lCQUNyQixjQUFjLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUM5QixTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxLQUFLLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDN0IsQ0FBQyxDQUFDLENBQUM7U0FDTjtJQUNILENBQUM7SUFFRCxlQUFlO1FBQ2IsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFO1lBQ3JELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQy9DO2FBQU0sSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUU7WUFDN0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztJQUVELG9CQUFvQixDQUFDLE9BQWdCO1FBQ25DLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7U0FDekI7UUFDRCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRUQsbUJBQW1CO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLHlCQUF5QixDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3ZELENBQUM7SUFFRCxpQkFBaUI7UUFDZixJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDeEcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO0lBQ3BDLENBQUM7SUFFTyxrQkFBa0I7UUFDeEIsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEtBQUssQ0FBQztJQUNyQyxDQUFDO0lBRU8sZUFBZTtRQUNyQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0lBQ2xDLENBQUM7SUFFTyxnQkFBZ0I7UUFDdEIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztJQUNuQyxDQUFDO0lBRUQsYUFBYSxDQUFDLE9BQWdCO1FBQzVCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBRXhCLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDaEMsSUFBSSxDQUFDLG1CQUFtQjtpQkFDckIsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO2lCQUMvRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDOUIsU0FBUyxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDeEIsQ0FBQyxDQUFDLENBQUM7WUFDTCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDdEI7SUFDSCxDQUFDO0lBRU8sY0FBYztRQUNwQixJQUFJLENBQUMsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUM7WUFDeEMsTUFBTSxFQUFFLElBQUksQ0FBQywwQkFBMEI7WUFDdkMsT0FBTyxFQUFFLElBQUksQ0FBQywyQkFBMkI7WUFDekMsUUFBUSxFQUFFLFNBQVM7WUFDbkIsR0FBRyxFQUFFLElBQUksQ0FBQyxtQkFBbUI7U0FDOUIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELElBQVksbUJBQW1CO1FBQzdCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyx1QkFBdUIsS0FBSyxTQUFTLEVBQUU7WUFDckQsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1NBQ3BEO1FBQ0QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDO0lBQzdDLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFTyxXQUFXO1FBQ2pCLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3pELElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFO2dCQUN0RCxJQUFJLENBQUMsbUJBQW1CO3FCQUNyQixjQUFjLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7cUJBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO3FCQUM5QixTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQ2pCLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxLQUFLLENBQUM7b0JBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzdCLENBQUMsQ0FBQyxDQUFDO2FBQ047aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLHNCQUFzQixHQUFHLFNBQVMsQ0FBQztnQkFDeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQzthQUM1QjtTQUNGO0lBQ0gsQ0FBQztJQUVELFNBQVM7UUFDUCxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDbEIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxhQUFhO1FBQ1gsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBRUQsSUFBSSxtQkFBbUI7UUFDckIsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMseUJBQXlCLENBQUM7SUFDNUQsQ0FBQzs7dUhBdkxVLHlCQUF5QjsyR0FBekIseUJBQXlCLDRUQ2R0QyxvMExBcUtBOzRGRHZKYSx5QkFBeUI7a0JBSnJDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLCtCQUErQjtvQkFDekMsV0FBVyxFQUFFLDZDQUE2QztpQkFDM0Q7aVRBWW1DLDJCQUEyQjtzQkFBNUQsU0FBUzt1QkFBQyxxQkFBcUI7Z0JBQ0MsMEJBQTBCO3NCQUExRCxTQUFTO3VCQUFDLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIE9uRGVzdHJveSwgT25Jbml0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgTmF2aWdhdGlvbkV4dHJhcyB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUGF5ZWUsIFBheWVlU3VtbWFyeSB9IGZyb20gJ0BiYWNrYmFzZS9kYXRhLWFuZy9iaWxscGF5JztcbmltcG9ydCB7IEJpbGxwYXlQYXllZVN1bW1hcnlXaWRnZXRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYmlsbHBheS1wYXllZS1zdW1tYXJ5LXdpZGdldC5zZXJ2aWNlJztcbmltcG9ydCB7IE1hbmFnZVBheWVlc0pvdXJuZXlDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbWFuYWdlLXBheWVlcy1qb3VybmV5LWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IE1hbmFnZVBheWVlc05hdmlnYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbWFuYWdlLXBheWVlcy1uYXZpZ2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS91aS1hbmcvbm90aWZpY2F0aW9uJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItYmlsbHBheS1wYXllZS1kZXRhaWxzLXZpZXcnLFxuICB0ZW1wbGF0ZVVybDogJy4vYmlsbHBheS1wYXllZS1zdW1tYXJ5LXZpZXcuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBQYXllZVN1bW1hcnlWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIHJlYWRvbmx5IG5hdmlnYXRpb25FeHRyYXM6IE5hdmlnYXRpb25FeHRyYXM7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2VsZWN0ZWREZWxldGVQYXllZVNvdXJjZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8UGF5ZWVTdW1tYXJ5IHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcGF5ZWVzJDogT2JzZXJ2YWJsZTxQYXllZVN1bW1hcnlbXT4gPSBuZXcgT2JzZXJ2YWJsZSgpO1xuICBpc0RlbGV0ZU1vZGFsT3BlbmVkID0gZmFsc2U7XG4gIGlzTmF2aWdhdGVNb2RhbE9wZW5lZCA9IGZhbHNlO1xuICBwcml2YXRlIHBheWVlU3VtbWFyaWVzITogUGF5ZWVTdW1tYXJ5W107XG4gIHBheWVlU3VtbWFyeSE6IFBheWVlU3VtbWFyeTtcbiAgZnVsbE1hbnVhbFBheWVlU3VtbWFyeT86IFBheWVlO1xuICBwYXllZUluZGV4ID0gMDtcbiAgQFZpZXdDaGlsZCgnbm90aWZpY2F0aW9uTWVzc2FnZScpIG5vdGlmaWNhdGlvbk1lc3NhZ2VUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHN0cmluZyA9ICcnO1xuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25IZWFkZXInKSBub3RpZmljYXRpb25IZWFkZXJUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHN0cmluZyA9ICcnO1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZXJTZXJ2aWNlOiBNYW5hZ2VQYXllZXNOYXZpZ2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogTWFuYWdlUGF5ZWVzSm91cm5leUNvbmZpZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXllZVN1bW1hcnlTZXJ2aWNlOiBCaWxscGF5UGF5ZWVTdW1tYXJ5V2lkZ2V0U2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBjZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICkge1xuICAgIHRoaXMubmF2aWdhdGlvbkV4dHJhcyA9IHsgcmVsYXRpdmVUbzogdGhpcy5yb3V0ZS5wYXJlbnQgfTtcbiAgfVxuXG4gIGdvdG9QYXllZUxpc3QoKSB7XG4gICAgdGhpcy5yb3V0ZXJTZXJ2aWNlLm5hdmlnYXRlVG9QYXllZUxpc3QodGhpcy5uYXZpZ2F0aW9uRXh0cmFzKTtcbiAgfVxuICBnb3RvQWRkUGF5ZWUoKSB7XG4gICAgdGhpcy5yb3V0ZXJTZXJ2aWNlLm5hdmlnYXRlVG9TZWFyY2godGhpcy5uYXZpZ2F0aW9uRXh0cmFzKTtcbiAgfVxuICBnb3RvT25lT2ZmUGF5bWVudChpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5yb3V0ZXJTZXJ2aWNlLm5hdmlnYXRlVG9PbmVPZmZQYXltZW50KGlkKTtcbiAgfVxuICBwcml2YXRlIGdvdG9FZGl0TWFudWFsKGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJvdXRlclNlcnZpY2UubmF2aWdhdGVUb0VkaXRNYW51YWxQYXllZUZvcm0oaWQsIHRoaXMubmF2aWdhdGlvbkV4dHJhcyk7XG4gIH1cbiAgcHJpdmF0ZSBnb3RvRWRpdEVsZWN0cm9uaWMoaWQ6IHN0cmluZykge1xuICAgIHRoaXMucm91dGVyU2VydmljZS5uYXZpZ2F0ZVRvRWRpdEVsZWN0cm9uaWNQYXllZUZvcm0oaWQsIHRoaXMubmF2aWdhdGlvbkV4dHJhcyk7XG4gIH1cbiAgcHJpdmF0ZSBnb3RvUGF5bWVudHNMaXN0KCkge1xuICAgIHRoaXMucm91dGVyU2VydmljZS5uYXZpZ2F0ZVRvUGVuZGluZ1BheW1lbnRzKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBpZCA9IHRoaXMucm91dGUuc25hcHNob3QucGFyYW1zWydwYXllZUlEJ10gfHwgdW5kZWZpbmVkO1xuICAgIHRoaXMucGF5ZWVzJCA9IHRoaXMucGF5ZWVTdW1tYXJ5U2VydmljZS5nZXRQYXllZXMoKS5waXBlKFxuICAgICAgdGFwKGRhdGEgPT4gdGhpcy5zZXRQYXllZShkYXRhLCBpZCkpLFxuICAgICAgdGFwKGRhdGEgPT4gKHRoaXMucGF5ZWVTdW1tYXJpZXMgPSBkYXRhKSksXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UGF5ZWUocGF5ZWVTdW1tYXJpZXM6IFBheWVlU3VtbWFyeVtdLCBpZDogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFwYXllZVN1bW1hcmllcyB8fCBwYXllZVN1bW1hcmllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMucGF5ZWVTdW1tYXJ5ID0gcGF5ZWVTdW1tYXJpZXNbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBheWVlSW5kZXggPSBwYXllZVN1bW1hcmllcy5maW5kSW5kZXgocGF5ZWUgPT4gcGF5ZWUuaWQgPT09IGlkKTtcbiAgICAgIGlmIChwYXllZUluZGV4ID4gMCkge1xuICAgICAgICB0aGlzLnBheWVlSW5kZXggPSBwYXllZUluZGV4O1xuICAgICAgICB0aGlzLnBheWVlU3VtbWFyeSA9IHBheWVlU3VtbWFyaWVzW3BheWVlSW5kZXhdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wYXllZVN1bW1hcnkgPSBwYXllZVN1bW1hcmllc1swXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF0aGlzLnBheWVlU3VtbWFyeS5lbGVjdHJvbmljKSB7XG4gICAgICB0aGlzLnBheWVlU3VtbWFyeVNlcnZpY2VcbiAgICAgICAgLmdldEZ1bGxTdW1tYXJ5KHRoaXMucGF5ZWVTdW1tYXJ5LmlkKVxuICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAgIC5zdWJzY3JpYmUocGF5ZWUgPT4ge1xuICAgICAgICAgIHRoaXMuZnVsbE1hbnVhbFBheWVlU3VtbWFyeSA9IHBheWVlO1xuICAgICAgICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVFZGl0UGF5ZWUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucGF5ZWVTdW1tYXJ5ICYmIHRoaXMucGF5ZWVTdW1tYXJ5LmVsZWN0cm9uaWMpIHtcbiAgICAgIHRoaXMuZ290b0VkaXRFbGVjdHJvbmljKHRoaXMucGF5ZWVTdW1tYXJ5LmlkKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucGF5ZWVTdW1tYXJ5ICYmICF0aGlzLnBheWVlU3VtbWFyeS5lbGVjdHJvbmljKSB7XG4gICAgICB0aGlzLmdvdG9FZGl0TWFudWFsKHRoaXMucGF5ZWVTdW1tYXJ5LmlkKTtcbiAgICB9XG4gIH1cblxuICBvbk5hdmlnYXRlVG9QYXltZW50cyhyZXNvbHZlOiBib29sZWFuKSB7XG4gICAgaWYgKHJlc29sdmUpIHtcbiAgICAgIHRoaXMuZ290b1BheW1lbnRzTGlzdCgpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlTmF2aWdhdGVNb2RhbCgpO1xuICB9XG5cbiAgc2VsZWN0ZWREZWxldGVQYXllZSgpOiBPYnNlcnZhYmxlPFBheWVlU3VtbWFyeSB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkRGVsZXRlUGF5ZWVTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBoYW5kbGVEZWxldGVQYXllZSgpOiB2b2lkIHtcbiAgICB0aGlzLnBheWVlU3VtbWFyeSAmJiAhdGhpcy5wYXllZVN1bW1hcnkubmV4dFBheW1lbnQgPyB0aGlzLm9wZW5EZWxldGVNb2RhbCgpIDogdGhpcy5vcGVuTmF2aWdhdGVNb2RhbCgpO1xuICAgIHRoaXMuc2VsZWN0ZWREZWxldGVQYXllZVNvdXJjZS5uZXh0KHRoaXMucGF5ZWVTdW1tYXJ5KTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbk5hdmlnYXRlTW9kYWwoKSB7XG4gICAgdGhpcy5pc05hdmlnYXRlTW9kYWxPcGVuZWQgPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBjbG9zZU5hdmlnYXRlTW9kYWwoKSB7XG4gICAgdGhpcy5pc05hdmlnYXRlTW9kYWxPcGVuZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgb3BlbkRlbGV0ZU1vZGFsKCkge1xuICAgIHRoaXMuaXNEZWxldGVNb2RhbE9wZW5lZCA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlRGVsZXRlTW9kYWwoKSB7XG4gICAgdGhpcy5pc0RlbGV0ZU1vZGFsT3BlbmVkID0gZmFsc2U7XG4gIH1cblxuICBvbkRlbGV0ZVBheWVlKHJlc29sdmU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmNsb3NlRGVsZXRlTW9kYWwoKTtcblxuICAgIGlmIChyZXNvbHZlICYmIHRoaXMucGF5ZWVTdW1tYXJ5KSB7XG4gICAgICB0aGlzLnBheWVlU3VtbWFyeVNlcnZpY2VcbiAgICAgICAgLmRlbGV0ZVBheWVlKHRoaXMucGF5ZWVTdW1tYXJ5LmlkLCB0aGlzLnBheWVlU3VtbWFyeS5lbGVjdHJvbmljKVxuICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZGVsZXRpb25Ob3RpZnkoKTtcbiAgICAgICAgfSk7XG4gICAgICB0aGlzLmdvdG9QYXllZUxpc3QoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRlbGV0aW9uTm90aWZ5KCkge1xuICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgIGhlYWRlcjogdGhpcy5ub3RpZmljYXRpb25IZWFkZXJUZW1wbGF0ZSxcbiAgICAgIG1lc3NhZ2U6IHRoaXMubm90aWZpY2F0aW9uTWVzc2FnZVRlbXBsYXRlLFxuICAgICAgbW9kaWZpZXI6ICdzdWNjZXNzJyxcbiAgICAgIHR0bDogdGhpcy5kaXNtaXNzVGltZW91dFZhbHVlLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgZGlzbWlzc1RpbWVvdXRWYWx1ZSgpOiBudW1iZXIge1xuICAgIGlmICh0aGlzLmNvbmZpZy5ub3RpZmljYXRpb25EaXNtaXNzVGltZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Rpc21pc3MgdGltZW91dCB2YWx1ZSBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQYXllZSgpIHtcbiAgICBpZiAodGhpcy5wYXllZVN1bW1hcmllcykge1xuICAgICAgdGhpcy5wYXllZVN1bW1hcnkgPSB0aGlzLnBheWVlU3VtbWFyaWVzW3RoaXMucGF5ZWVJbmRleF07XG4gICAgICBpZiAodGhpcy5wYXllZVN1bW1hcnkgJiYgIXRoaXMucGF5ZWVTdW1tYXJ5LmVsZWN0cm9uaWMpIHtcbiAgICAgICAgdGhpcy5wYXllZVN1bW1hcnlTZXJ2aWNlXG4gICAgICAgICAgLmdldEZ1bGxTdW1tYXJ5KHRoaXMucGF5ZWVTdW1tYXJ5LmlkKVxuICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgICAgICAuc3Vic2NyaWJlKHBheWVlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZnVsbE1hbnVhbFBheWVlU3VtbWFyeSA9IHBheWVlO1xuICAgICAgICAgICAgdGhpcy5jZFJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmZ1bGxNYW51YWxQYXllZVN1bW1hcnkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5leHRQYXllZSgpIHtcbiAgICArK3RoaXMucGF5ZWVJbmRleDtcbiAgICB0aGlzLnVwZGF0ZVBheWVlKCk7XG4gIH1cblxuICBwcmV2aW91c1BheWVlKCkge1xuICAgIC0tdGhpcy5wYXllZUluZGV4O1xuICAgIHRoaXMudXBkYXRlUGF5ZWUoKTtcbiAgfVxuXG4gIGdldCBjdXJyZW50TG9hZGluZ1N0YXRlKCkge1xuICAgIHJldHVybiB0aGlzLnBheWVlU3VtbWFyeVNlcnZpY2UucGF5ZWVzU3VtbWFyeUxvYWRpbmdTdGF0ZTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS1sZ1wiPlxuICA8YnV0dG9uIGJiQnV0dG9uIGNvbG9yPVwibGlua1wiIGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLW1kIHBsLTBcIiAoY2xpY2spPVwiZ290b1BheWVlTGlzdCgpXCI+XG4gICAgPGJiLWljb24tdWkgbmFtZT1cImFycm93LWJhY2tcIiBzaXplPVwibWRcIj48L2JiLWljb24tdWk+XG4gICAgPHNwYW4gaTE4bj1cImJ1dHRvbiBsYWJlbHxCYWNrIGJ1dHRvbkBAYmlsbHBheS1wYXllZXMtam91cm5leS5wYXllZS1zdW1tYXJ5LmJhY2tcIj5CYWNrIHRvIFBheWVlIExpc3Q8L3NwYW4+XG4gIDwvYnV0dG9uPlxuICA8YmItaGVhZGVyLXVpIGhlYWRpbmdUeXBlPVwiaDFcIiBbaGVhZGluZ109XCInUGF5ZWUgc3VtbWFyeSdcIiBpMThuLWhlYWRpbmc9XCJAQGJpbGxwYXktcGF5ZWVzLWpvdXJuZXkuYWRkLXBheWVlXCI+XG4gIDwvYmItaGVhZGVyLXVpPlxuPC9kaXY+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uTWVzc2FnZT5cbiAgPGRpdj5cbiAgICA8ZGl2PlxuICAgICAgPHNwYW5cbiAgICAgICAgaTE4bj1cIlxuICAgICAgICAgIGRlbGV0ZSBwYXllZSBub3RpZmljYXRpb24gbWVzc2FnZXxQYXllZSBkZWxldGUgY29uZmlybWF0aW9uIHN1Y2Nlc3Mgbm90aWZpY2F0aW9uXG4gICAgICAgICAgbWVzc2FnZUBAYmlsbHBheS1wYXllZS1zdW1tYXJ5LmRlbGV0ZS1wYXllZS1jb25maXJtLm5vdGlmaWNhdGlvbi5tZXNzYWdlXCJcbiAgICAgICAgPlRoZSBwYXllZVxuICAgICAgICB7eyBwYXllZVN1bW1hcnkubmlja05hbWUgPyBwYXllZVN1bW1hcnkubmlja05hbWUgKyAnICgnICsgcGF5ZWVTdW1tYXJ5Lm5hbWUgKyAnKScgOiBwYXllZVN1bW1hcnkubmFtZSB9fSBoYXNcbiAgICAgICAgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseTwvc3BhblxuICAgICAgPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbiA8bmctY29udGFpbmVyICpuZ0lmPVwicGF5ZWVzJCB8IGFzeW5jIGFzIGFsbFBheWVlc1wiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwicGF5ZWVTdW1tYXJ5OyBlbHNlIGVtcHR5U3RhdGVcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZCBjYXJkLWxnXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ib2R5XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0tbWRcIj5cbiAgICAgICAgICA8YmItYmlsbHBheS1wYXllZS1zdGVwcGVyXG4gICAgICAgICAgICBbaW5kZXhdPVwicGF5ZWVJbmRleFwiXG4gICAgICAgICAgICBbc2l6ZV09XCJhbGxQYXllZXMubGVuZ3RoXCJcbiAgICAgICAgICAgIChuZXh0UGF5ZWUpPVwibmV4dFBheWVlKClcIlxuICAgICAgICAgICAgKHByZXZpb3VzUGF5ZWUpPVwicHJldmlvdXNQYXllZSgpXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgPC9iYi1iaWxscGF5LXBheWVlLXN0ZXBwZXI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLWxnXCI+XG4gICAgICAgICAgPGJiLWhlYWRlci11aVxuICAgICAgICAgICAgaGVhZGluZ1R5cGU9XCJoMlwiXG4gICAgICAgICAgICAqbmdJZj1cInBheWVlU3VtbWFyeS5uaWNrTmFtZSB8fCBwYXllZVN1bW1hcnkubmFtZVwiXG4gICAgICAgICAgICBkYXRhLXJvbGU9XCJmdWxsLXN1bW1hcnktcGF5ZWUtbmFtZS1wcmltYXJ5XCJcbiAgICAgICAgICAgIGhlYWRpbmc9XCJ7eyBwYXllZVN1bW1hcnkubmlja05hbWUgfHwgcGF5ZWVTdW1tYXJ5Lm5hbWUgfX1cIlxuICAgICAgICAgID5cbiAgICAgICAgICA8L2JiLWhlYWRlci11aT5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzcz1cImJiLWhpZ2hsaWdodFwiXG4gICAgICAgICAgICAqbmdJZj1cInBheWVlU3VtbWFyeS5uaWNrTmFtZSAmJiBwYXllZVN1bW1hcnkubmFtZVwiXG4gICAgICAgICAgICBkYXRhLXJvbGU9XCJmdWxsLXN1bW1hcnktcGF5ZWUtbmFtZS1zZWNvbmRhcnlcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt7IHBheWVlU3VtbWFyeS5uYW1lIH19XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxiYi1iaWxscGF5LXBheWVlLWluZm9ybWF0aW9uXG4gICAgICAgICAgW3BheWVlU3VtbWFyeV09XCJwYXllZVN1bW1hcnlcIlxuICAgICAgICAgIFtmdWxsUGF5ZWVdPVwiZnVsbE1hbnVhbFBheWVlU3VtbWFyeVwiXG4gICAgICAgICAgKGVkaXRQYXllZSk9XCJoYW5kbGVFZGl0UGF5ZWUoKVwiXG4gICAgICAgICAgKGRlbGV0ZVBheWVlKT1cImhhbmRsZURlbGV0ZVBheWVlKClcIlxuICAgICAgICA+XG4gICAgICAgIDwvYmItYmlsbHBheS1wYXllZS1pbmZvcm1hdGlvbj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYnV0dG9uLWJhciBiYi1idXR0b24tYmFyLS1yZXZlcnNlXCI+XG4gICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgYmJCdXR0b25cbiAgICAgICAgICAgIChjbGljayk9XCJnb3RvT25lT2ZmUGF5bWVudChwYXllZVN1bW1hcnkpXCJcbiAgICAgICAgICAgIGRhdGEtcm9sZT1cIm1ha2UtcGF5bWVudC1mcm9tLXN1bW1hcnktcGF5ZWUtYnV0dG9uXCJcbiAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICBjbGFzcz1cImJiLWJ1dHRvbi1iYXJfX2J1dHRvblwiXG4gICAgICAgICAgICBpMThuPVwiXG4gICAgICAgICAgICAgIE1ha2UgYSBwYXltZW50IGJ1dHRvbnxUZXh0IGZvciB0aGUgbWFrZSBhIHBheW1lbnQgdmllIGZ1bGwgc3VtbWFyeVxuICAgICAgICAgICAgICBidXR0b25AQGJiLWJpbGxwYXktdmlldy1wYXllZS1mdWxsLXN1bW1hcnkuYnV0dG9uLm1ha2UtcGF5bWVudFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgTWFrZSBhIHBheW1lbnRcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGJiLWJpbGxwYXktcGF5ZWUtZGVsZXRlLW1vZGFsXG4gICAgICAgICAgKm5nSWY9XCJpc0RlbGV0ZU1vZGFsT3BlbmVkXCJcbiAgICAgICAgICAocmVzb2x2ZSk9XCJvbkRlbGV0ZVBheWVlKCRldmVudClcIlxuICAgICAgICA+PC9iYi1iaWxscGF5LXBheWVlLWRlbGV0ZS1tb2RhbD5cblxuICAgICAgICA8YmItYmlsbHBheS1wYXllZS1uYXZpZ2F0ZS1tb2RhbFxuICAgICAgICAgICpuZ0lmPVwiaXNOYXZpZ2F0ZU1vZGFsT3BlbmVkXCJcbiAgICAgICAgICAocmVzb2x2ZSk9XCJvbk5hdmlnYXRlVG9QYXltZW50cygkZXZlbnQpXCJcbiAgICAgICAgPjwvYmItYmlsbHBheS1wYXllZS1uYXZpZ2F0ZS1tb2RhbD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctY29udGFpbmVyPiBcblxuPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1cnJlbnRMb2FkaW5nU3RhdGUgfCBhc3luYyBhcyBjdXJyZW50TG9hZGluZ1N0YXRlXCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJjdXJyZW50TG9hZGluZ1N0YXRlID09PSAnbG9hZGluZydcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZCBjYXJkLWxnXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ib2R5XCI+XG4gICAgICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aSBsb2FkZXJTaXplPVwibGdcIj4gPC9iYi1sb2FkaW5nLWluZGljYXRvci11aT5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cblxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiY3VycmVudExvYWRpbmdTdGF0ZSA9PT0gJ2Vycm9yJ1wiPlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkIGNhcmQtbGdcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHlcIj5cbiAgICAgICAgPGJiLWVtcHR5LXN0YXRlLXVpXG4gICAgICAgICAgZGF0YS1yb2xlPVwiZXJyb3Itc3RhdGVcIlxuICAgICAgICAgIGljb25TaXplPVwieHhsXCJcbiAgICAgICAgICBpY29uTW9kaWZpZXI9XCJlcnJvci1vdXRsaW5lXCJcbiAgICAgICAgICBzdWJ0aXRsZT1cIlRyeSB0byByZWxvYWQgdGhlIHBhZ2Ugb3IgY29udGFjdCBzdXBwb3J0XCJcbiAgICAgICAgICBpMThuLXN1YnRpdGxlPVwiXG4gICAgICAgICAgICBUcnkgdG8gcmVsb2FkIHRoZSBwYWdlIG9yIGNvbnRhY3Qgc3VwcG9ydHxQYXllZSBTdW1tYXJ5IGVycm9yIGxvYWRpbmdcbiAgICAgICAgICAgIHN1YnRpdGxlQEBiYi1iaWxscGF5LXBheWVlLXN1bW1hcnktd2lkZ2V0LWFuZy5sb2FkaW5nLnN1YnRpdGxlXCJcbiAgICAgICAgICB0aXRsZT1cIkNvdWxkIG5vdCBmZXRjaCBwYXllZSBkZXRhaWxzXCJcbiAgICAgICAgICBpMThuLXRpdGxlPVwiXG4gICAgICAgICAgICBDb3VsZCBub3QgZmV0Y2ggcGF5ZWUgZGV0YWlsc3xQYXllZSBTdW1tYXJ5IGVycm9yIGxvYWRpbmdcbiAgICAgICAgICAgIHRpdGxlQEBiYi1iaWxscGF5LXBheWVlLXN1bW1hcnktd2lkZ2V0LWFuZy5sb2FkaW5nLnRpdGxlXCJcbiAgICAgICAgPlxuICAgICAgICA8L2JiLWVtcHR5LXN0YXRlLXVpPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy10ZW1wbGF0ZSAjZW1wdHlTdGF0ZT5cbiAgPGRpdiBjbGFzcz1cImNhcmQgY2FyZC1sZ1wiPlxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHkgYmItc3RhdGUtY29udGFpbmVyXCI+XG4gICAgICA8YmItZW1wdHktc3RhdGUtdWlcbiAgICAgICAgZGF0YS1yb2xlPVwiZW1wdHktc3RhdGVcIlxuICAgICAgICBpY29uU2l6ZT1cInh4bFwiXG4gICAgICAgIGljb25Nb2RpZmllcj1cImFzc2lnbm1lbnQtaW5kXCJcbiAgICAgICAgc3VidGl0bGU9XCJBZGQgYSBwYXllZSB0byBtYWtlIGEgYmlsbCBwYXltZW50XCJcbiAgICAgICAgaTE4bi1zdWJ0aXRsZT1cIlxuICAgICAgICAgIEFkZCBhIHBheWVlIHRvIG1ha2UgYSBiaWxsIHBheW1lbnR8UGF5ZWUgU3VtbWFyeSBubyBwYXllZXNcbiAgICAgICAgICBzdWJ0aXRsZUBAYmItYmlsbHBheS1wYXllZS1zdW1tYXJ5LXdpZGdldC1hbmcuYmItZW1wdHktc3RhdGUtdWkuc3VidGl0bGVcIlxuICAgICAgICB0aXRsZT1cIk5vIHBheWVlc1wiXG4gICAgICAgIGkxOG4tdGl0bGU9XCJcbiAgICAgICAgICBObyBwYXllZXMgc3RhdGUgdGV4dHxQYXllZSBTdW1tYXJ5IG5vIHBheWVlc1xuICAgICAgICAgIHRpdGxlQEBiYi1iaWxscGF5LXBheWVlLXN1bW1hcnktd2lkZ2V0LWFuZy5iYi1lbXB0eS1zdGF0ZS11aS50aXRsZVwiXG4gICAgICA+XG4gICAgICA8L2JiLWVtcHR5LXN0YXRlLXVpPlxuICAgICAgPGRpdiBjbGFzcz1cImJiLXN0YXRlLWNvbnRhaW5lcl9fZm9vdGVyXCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICBiYkJ1dHRvblxuICAgICAgICAgIGRhdGEtcm9sZT1cImVtcHR5LXN0YXRlLWFkZC1wYXllZS1idG5cIlxuICAgICAgICAgIChjbGljayk9XCJnb3RvQWRkUGF5ZWUoKVwiXG4gICAgICAgICAgaTE4bj1cIlxuICAgICAgICAgICAgQWRkIGEgcGF5ZWV8UGF5ZWUgU3VtbWFyeSBhZGQgcGF5ZWVcbiAgICAgICAgICAgIGJ1dHRvbkBAYmItYmlsbHBheS1wYXllZS1zdW1tYXJ5LXdpZGdldC1hbmcuYmItZW1wdHktc3RhdGUtdWkuYnV0dG9uLmFkZC1wYXllZVwiXG4gICAgICAgID5cbiAgICAgICAgICBBZGQgYSBwYXllZVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uSGVhZGVyPlxuICA8ZGl2PlxuICAgIDxzcGFuXG4gICAgICBpMThuPVwiXG4gICAgICAgIGRlbGV0ZSBwYXllZSBub3RpZmljYXRpb24gaGVhZGVyfFBheWVlIGRlbGV0ZSBjb25maXJtYXRpb24gc3VjY2VzcyBub3RpZmljYXRpb25cbiAgICAgICAgaGVhZGVyQEBiaWxscGF5LXBheWVlLXN1bW1hcnkuY29uZmlybS5ub3RpZmljYXRpb24uaGVhZGVyXCJcbiAgICAgID5QYXllZSBkZWxldGVkPC9zcGFuXG4gICAgPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=