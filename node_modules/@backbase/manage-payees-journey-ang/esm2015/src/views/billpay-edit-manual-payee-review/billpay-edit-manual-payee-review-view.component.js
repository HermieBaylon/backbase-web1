import { Component, ViewChild, HostListener } from '@angular/core';
import { BehaviorSubject, Subject, of } from 'rxjs';
import { filter, switchMap, take, takeUntil, map, tap } from 'rxjs/operators';
import { BillpayDiscardChangesModalService, } from '@backbase/billpay-journeys-common';
import * as i0 from "@angular/core";
import * as i1 from "../../services/manage-payees-journey-config.service";
import * as i2 from "../../services/manage-payees-navigation.service";
import * as i3 from "../../services/billpay-manage-payee-state.service";
import * as i4 from "../../services/billpay-manage-payee-data.service";
import * as i5 from "@backbase/ui-ang/notification";
import * as i6 from "@angular/router";
import * as i7 from "@backbase/billpay-journeys-common";
import * as i8 from "../../components/add-payee/billpay-manual-payee-review/billpay-manual-payee-review.component";
import * as i9 from "../../components/add-payee/billpay-cancel-edit-payee-modal/billpay-cancel-edit-payee-modal.component";
import * as i10 from "@angular/common";
import * as i11 from "@backbase/ui-ang/button";
export class EditManualPayeeReviewViewComponent {
    /** @internal */
    constructor(config, router, stateService, dataService, notificationService, route, discardModalService) {
        this.config = config;
        this.router = router;
        this.stateService = stateService;
        this.dataService = dataService;
        this.notificationService = notificationService;
        this.route = route;
        this.discardModalService = discardModalService;
        this.notificationHeaderTemplate = '';
        this.notificationMessageTemplate = '';
        this.payeeSubmit$ = new BehaviorSubject(undefined);
        this.destroy$ = new Subject();
        this.id$ = this.route.paramMap.pipe(take(1), map(params => params.get('id') || ''));
    }
    ngOnInit() {
        this.stateService.manualPayeeFormState.pipe(take(1)).subscribe(payee => {
            this.payee = payee;
            if (!this.payee) {
                this.navigateToForm();
            }
        });
        this.payeeSubmit$
            .pipe(takeUntil(this.destroy$), filter(Boolean))
            .subscribe(payee => this.onSubmitPayee(payee));
    }
    get isDiscardModalOpen() {
        return this.discardModalService.isDiscardModalOpen;
    }
    get dismissTimeout() {
        if (this.config.notificationDismissTime === undefined) {
            throw new Error('Dismiss timeout value not found');
        }
        return this.config.notificationDismissTime;
    }
    onWindowUnload($event) {
        if (!this.isDiscardModalOpen) {
            $event.returnValue = true;
        }
    }
    openModal() {
        return this.payeeSubmit$.pipe(switchMap(payee => (payee ? of(true) : this.discardModalService.openModal())), tap(isResolved => isResolved && this.stateService.resetManualPayee()));
    }
    onModalResolve(resolvedWith) {
        this.discardModalService.onModalResolve(resolvedWith);
        if (resolvedWith) {
            this.router.navigateToPayeeList();
        }
    }
    submitPayee(payee) {
        this.payeeSubmit$.next(payee);
    }
    navigateBack() {
        this.navigateToForm();
    }
    cancel() {
        this.router.navigateToPayeeList();
    }
    navigateToForm() {
        this.id$.subscribe(id => this.router.navigateToEditManualPayeeForm(id));
    }
    onSubmitPayee(payee) {
        this.id$.pipe(switchMap(id => this.dataService.updateManualPayee(id, payee))).subscribe(() => {
            this.router.navigateToPayeeList();
            this.notificationService.showNotification({
                header: this.notificationHeaderTemplate,
                message: this.notificationMessageTemplate,
                modifier: 'success',
                ttl: this.dismissTimeout,
            });
        }, () => {
            this.notificationService.showNotification({
                header: $localize `:@@billpay.edit-manuel-payee.error-notification.header:Something went wrong`,
                message: $localize `:@@billpay.edit-manuel-payee.error-notification.message:We were unable to proceed. Please try again.`,
                modifier: 'error',
                ttl: this.dismissTimeout,
            });
        });
    }
}
EditManualPayeeReviewViewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: EditManualPayeeReviewViewComponent, deps: [{ token: i1.ManagePayeesJourneyConfigService }, { token: i2.ManagePayeesNavigationService }, { token: i3.BillpayManagePayeeStateService }, { token: i4.BillpayManagePayeeDataService }, { token: i5.NotificationService }, { token: i6.ActivatedRoute }, { token: i7.BillpayDiscardChangesModalService }], target: i0.ɵɵFactoryTarget.Component });
EditManualPayeeReviewViewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: EditManualPayeeReviewViewComponent, selector: "ng-component", host: { listeners: { "window:beforeunload": "onWindowUnload($event)" } }, providers: [BillpayDiscardChangesModalService], viewQueries: [{ propertyName: "notificationHeaderTemplate", first: true, predicate: ["notificationHeader"], descendants: true }, { propertyName: "notificationMessageTemplate", first: true, predicate: ["notificationMessage"], descendants: true }], ngImport: i0, template: "<div class=\"card card-lg\" *ngIf=\"payee\">\n  <section class=\"card-body\">\n    <bb-billpay-manual-payee-review [payeeFormState]=\"payee\"> </bb-billpay-manual-payee-review>\n    <div class=\"bb-button-bar bb-button-bar--reverse\">\n      <button\n        bbButton\n        data-role=\"save-payee-button\"\n        i18n=\"Label for button|Manual payee continue button@@billpay-edit-manual-payee-review.save-payee\"\n        (click)=\"submitPayee(payee)\"\n        class=\"bb-button-bar__button\"\n      >\n        Confirm payee details\n      </button>\n      <button\n        bbButton\n        data-role=\"back-button\"\n        i18n=\"Label for button|Find a different payee button@@billpay-edit-manual-payee-review.edit-payee\"\n        (click)=\"navigateBack()\"\n        class=\"bb-button-bar__button\"\n        color=\"secondary\"\n      >\n        Edit payee details\n      </button>\n      <button\n        bbButton\n        data-role=\"cancel-button\"\n        color=\"link\"\n        class=\"bb-button-bar__button bb-button-bar__button--across\"\n        (click)=\"cancel()\"\n        i18n=\"Cancel edit|Label for a button that cancels form changes@@billpay-edit-manual-payee-review.cancel\"\n      >\n        Cancel\n      </button>\n    </div>\n  </section>\n</div>\n<bb-billpay-cancel-edit-payee-modal\n  *ngIf=\"isDiscardModalOpen\"\n  (resolve)=\"onModalResolve($event)\"\n></bb-billpay-cancel-edit-payee-modal>\n\n<ng-template #notificationMessage>\n  <ng-container>\n    <span\n      data-role=\"notification-message\"\n      i18n=\"Payee notification message|Payee edited notification@@billpay-edit-manual-payee-review.notification.message\"\n      >The payee \u2018{{ (payee.nickName && payee.nickName + ' (' + payee.name + ')') || payee.name }}\u2018 has been changed\n      successfully</span\n    >\n  </ng-container>\n</ng-template>\n\n<ng-template #notificationHeader>\n  <span\n    i18n=\"\n      Payee notification header|Payee edited notification header@@billpay-edit-manual-payee-review.notification.header\"\n    >Payee edited</span\n  >\n</ng-template>\n", components: [{ type: i8.BillpayManualPayeeReviewComponent, selector: "bb-billpay-manual-payee-review", inputs: ["payeeFormState"] }, { type: i9.BillpayCancelEditPayeeModalComponent, selector: "bb-billpay-cancel-edit-payee-modal", outputs: ["resolve"] }], directives: [{ type: i10.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i11.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: EditManualPayeeReviewViewComponent, decorators: [{
            type: Component,
            args: [{
                    templateUrl: './billpay-edit-manual-payee-review-view.component.html',
                    providers: [BillpayDiscardChangesModalService],
                }]
        }], ctorParameters: function () { return [{ type: i1.ManagePayeesJourneyConfigService }, { type: i2.ManagePayeesNavigationService }, { type: i3.BillpayManagePayeeStateService }, { type: i4.BillpayManagePayeeDataService }, { type: i5.NotificationService }, { type: i6.ActivatedRoute }, { type: i7.BillpayDiscardChangesModalService }]; }, propDecorators: { notificationHeaderTemplate: [{
                type: ViewChild,
                args: ['notificationHeader']
            }], notificationMessageTemplate: [{
                type: ViewChild,
                args: ['notificationMessage']
            }], onWindowUnload: [{
                type: HostListener,
                args: ['window:beforeunload', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXctdmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wYXllZXMtam91cm5leS9zcmMvdmlld3MvYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXcvYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXctdmlldy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21hbmFnZS1wYXllZXMtam91cm5leS9zcmMvdmlld3MvYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXcvYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXctdmlldy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUF1QixTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhGLE9BQU8sRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5RSxPQUFPLEVBQ0wsaUNBQWlDLEdBRWxDLE1BQU0sbUNBQW1DLENBQUM7Ozs7Ozs7Ozs7Ozs7QUFXM0MsTUFBTSxPQUFPLGtDQUFrQztJQVk3QyxnQkFBZ0I7SUFDaEIsWUFDVyxNQUF3QyxFQUNoQyxNQUFxQyxFQUNyQyxZQUE0QyxFQUM1QyxXQUEwQyxFQUMxQyxtQkFBd0MsRUFDeEMsS0FBcUIsRUFDckIsbUJBQXNEO1FBTjlELFdBQU0sR0FBTixNQUFNLENBQWtDO1FBQ2hDLFdBQU0sR0FBTixNQUFNLENBQStCO1FBQ3JDLGlCQUFZLEdBQVosWUFBWSxDQUFnQztRQUM1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QVM7bUJBQUM7b0JBQ1QsV0FBVyxFQUFFLHdEQUF3RDtvQkFDckUsU0FBUyxFQUFFLENBQUMsaUNBQWlDLENBQUM7aUJBQy9DOzJXQUVrQywwQkFBMEI7c0JBQTFELFNBQVM7dUJBQUMsb0JBQW9CO2dCQUNHLDJCQUEyQjtzQkFBNUQsU0FBUzt1QkFBQyxxQkFBcUI7Z0JBNkNoQyxjQUFjO3NCQURiLFlBQVk7dUJBQUMscUJBQXFCLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYW5hZ2VQYXllZXNKb3VybmV5Q29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL21hbmFnZS1wYXllZXMtam91cm5leS1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIHN3aXRjaE1hcCwgdGFrZSwgdGFrZVVudGlsLCBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIEJpbGxwYXlEaXNjYXJkQ2hhbmdlc01vZGFsU2VydmljZSxcbiAgQmlsbHBheURpc2NhcmRDaGFuZ2VzRm9ybUNvbXBvbmVudCxcbn0gZnJvbSAnQGJhY2tiYXNlL2JpbGxwYXktam91cm5leXMtY29tbW9uJztcbmltcG9ydCB7IE1hbnVhbFBheWVlRm9ybVN0YXRlIH0gZnJvbSAnLi4vLi4vbW9kZWwnO1xuaW1wb3J0IHsgTWFuYWdlUGF5ZWVzTmF2aWdhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9tYW5hZ2UtcGF5ZWVzLW5hdmlnYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBCaWxscGF5TWFuYWdlUGF5ZWVTdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9iaWxscGF5LW1hbmFnZS1wYXllZS1zdGF0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IEJpbGxwYXlNYW5hZ2VQYXllZURhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYmlsbHBheS1tYW5hZ2UtcGF5ZWUtZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL25vdGlmaWNhdGlvbic7XG5cbkBDb21wb25lbnQoe1xuICB0ZW1wbGF0ZVVybDogJy4vYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXctdmlldy5jb21wb25lbnQuaHRtbCcsXG4gIHByb3ZpZGVyczogW0JpbGxwYXlEaXNjYXJkQ2hhbmdlc01vZGFsU2VydmljZV0sXG59KVxuZXhwb3J0IGNsYXNzIEVkaXRNYW51YWxQYXllZVJldmlld1ZpZXdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEJpbGxwYXlEaXNjYXJkQ2hhbmdlc0Zvcm1Db21wb25lbnQge1xuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25IZWFkZXInKSBub3RpZmljYXRpb25IZWFkZXJUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHN0cmluZyA9ICcnO1xuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25NZXNzYWdlJykgbm90aWZpY2F0aW9uTWVzc2FnZVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+IHwgc3RyaW5nID0gJyc7XG5cbiAgcGF5ZWU/OiBNYW51YWxQYXllZUZvcm1TdGF0ZTtcbiAgcHJpdmF0ZSByZWFkb25seSBwYXllZVN1Ym1pdCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PE1hbnVhbFBheWVlRm9ybVN0YXRlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBpZCQgPSB0aGlzLnJvdXRlLnBhcmFtTWFwLnBpcGUoXG4gICAgdGFrZSgxKSxcbiAgICBtYXAocGFyYW1zID0+IHBhcmFtcy5nZXQoJ2lkJykgfHwgJycpLFxuICApO1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcmVhZG9ubHkgY29uZmlnOiBNYW5hZ2VQYXllZXNKb3VybmV5Q29uZmlnU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvdXRlcjogTWFuYWdlUGF5ZWVzTmF2aWdhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBzdGF0ZVNlcnZpY2U6IEJpbGxwYXlNYW5hZ2VQYXllZVN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhdGFTZXJ2aWNlOiBCaWxscGF5TWFuYWdlUGF5ZWVEYXRhU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSByZWFkb25seSBkaXNjYXJkTW9kYWxTZXJ2aWNlOiBCaWxscGF5RGlzY2FyZENoYW5nZXNNb2RhbFNlcnZpY2UsXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnN0YXRlU2VydmljZS5tYW51YWxQYXllZUZvcm1TdGF0ZS5waXBlKHRha2UoMSkpLnN1YnNjcmliZShwYXllZSA9PiB7XG4gICAgICB0aGlzLnBheWVlID0gcGF5ZWU7XG4gICAgICBpZiAoIXRoaXMucGF5ZWUpIHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0ZVRvRm9ybSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMucGF5ZWVTdWJtaXQkXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCksIGZpbHRlcihCb29sZWFuKSlcbiAgICAgIC5zdWJzY3JpYmUocGF5ZWUgPT4gdGhpcy5vblN1Ym1pdFBheWVlKHBheWVlIGFzIE1hbnVhbFBheWVlRm9ybVN0YXRlKSk7XG4gIH1cblxuICBnZXQgaXNEaXNjYXJkTW9kYWxPcGVuKCkge1xuICAgIHJldHVybiB0aGlzLmRpc2NhcmRNb2RhbFNlcnZpY2UuaXNEaXNjYXJkTW9kYWxPcGVuO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgZGlzbWlzc1RpbWVvdXQoKTogbnVtYmVyIHtcbiAgICBpZiAodGhpcy5jb25maWcubm90aWZpY2F0aW9uRGlzbWlzc1RpbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEaXNtaXNzIHRpbWVvdXQgdmFsdWUgbm90IGZvdW5kJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5ub3RpZmljYXRpb25EaXNtaXNzVGltZTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpiZWZvcmV1bmxvYWQnLCBbJyRldmVudCddKVxuICBvbldpbmRvd1VubG9hZCgkZXZlbnQ6IEJlZm9yZVVubG9hZEV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmlzRGlzY2FyZE1vZGFsT3Blbikge1xuICAgICAgJGV2ZW50LnJldHVyblZhbHVlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBvcGVuTW9kYWwoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMucGF5ZWVTdWJtaXQkLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAocGF5ZWUgPT4gKHBheWVlID8gb2YodHJ1ZSkgOiB0aGlzLmRpc2NhcmRNb2RhbFNlcnZpY2Uub3Blbk1vZGFsKCkpKSxcbiAgICAgIHRhcChpc1Jlc29sdmVkID0+IGlzUmVzb2x2ZWQgJiYgdGhpcy5zdGF0ZVNlcnZpY2UucmVzZXRNYW51YWxQYXllZSgpKSxcbiAgICApO1xuICB9XG5cbiAgb25Nb2RhbFJlc29sdmUocmVzb2x2ZWRXaXRoOiBib29sZWFuKSB7XG4gICAgdGhpcy5kaXNjYXJkTW9kYWxTZXJ2aWNlLm9uTW9kYWxSZXNvbHZlKHJlc29sdmVkV2l0aCk7XG4gICAgaWYgKHJlc29sdmVkV2l0aCkge1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUb1BheWVlTGlzdCgpO1xuICAgIH1cbiAgfVxuXG4gIHN1Ym1pdFBheWVlKHBheWVlOiBNYW51YWxQYXllZUZvcm1TdGF0ZSkge1xuICAgIHRoaXMucGF5ZWVTdWJtaXQkLm5leHQocGF5ZWUpO1xuICB9XG5cbiAgbmF2aWdhdGVCYWNrKCkge1xuICAgIHRoaXMubmF2aWdhdGVUb0Zvcm0oKTtcbiAgfVxuXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvUGF5ZWVMaXN0KCk7XG4gIH1cblxuICBwcml2YXRlIG5hdmlnYXRlVG9Gb3JtKCkge1xuICAgIHRoaXMuaWQkLnN1YnNjcmliZShpZCA9PiB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvRWRpdE1hbnVhbFBheWVlRm9ybShpZCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvblN1Ym1pdFBheWVlKHBheWVlOiBNYW51YWxQYXllZUZvcm1TdGF0ZSkge1xuICAgIHRoaXMuaWQkLnBpcGUoc3dpdGNoTWFwKGlkID0+IHRoaXMuZGF0YVNlcnZpY2UudXBkYXRlTWFudWFsUGF5ZWUoaWQsIHBheWVlKSkpLnN1YnNjcmliZShcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUb1BheWVlTGlzdCgpO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2Uuc2hvd05vdGlmaWNhdGlvbih7XG4gICAgICAgICAgaGVhZGVyOiB0aGlzLm5vdGlmaWNhdGlvbkhlYWRlclRlbXBsYXRlLFxuICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubm90aWZpY2F0aW9uTWVzc2FnZVRlbXBsYXRlLFxuICAgICAgICAgIG1vZGlmaWVyOiAnc3VjY2VzcycsXG4gICAgICAgICAgdHRsOiB0aGlzLmRpc21pc3NUaW1lb3V0LFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgICAgICBoZWFkZXI6ICRsb2NhbGl6ZWA6QEBiaWxscGF5LmVkaXQtbWFudWVsLXBheWVlLmVycm9yLW5vdGlmaWNhdGlvbi5oZWFkZXI6U29tZXRoaW5nIHdlbnQgd3JvbmdgLFxuICAgICAgICAgIG1lc3NhZ2U6ICRsb2NhbGl6ZWA6QEBiaWxscGF5LmVkaXQtbWFudWVsLXBheWVlLmVycm9yLW5vdGlmaWNhdGlvbi5tZXNzYWdlOldlIHdlcmUgdW5hYmxlIHRvIHByb2NlZWQuIFBsZWFzZSB0cnkgYWdhaW4uYCxcbiAgICAgICAgICBtb2RpZmllcjogJ2Vycm9yJyxcbiAgICAgICAgICB0dGw6IHRoaXMuZGlzbWlzc1RpbWVvdXQsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICApO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY2FyZCBjYXJkLWxnXCIgKm5nSWY9XCJwYXllZVwiPlxuICA8c2VjdGlvbiBjbGFzcz1cImNhcmQtYm9keVwiPlxuICAgIDxiYi1iaWxscGF5LW1hbnVhbC1wYXllZS1yZXZpZXcgW3BheWVlRm9ybVN0YXRlXT1cInBheWVlXCI+IDwvYmItYmlsbHBheS1tYW51YWwtcGF5ZWUtcmV2aWV3PlxuICAgIDxkaXYgY2xhc3M9XCJiYi1idXR0b24tYmFyIGJiLWJ1dHRvbi1iYXItLXJldmVyc2VcIj5cbiAgICAgIDxidXR0b25cbiAgICAgICAgYmJCdXR0b25cbiAgICAgICAgZGF0YS1yb2xlPVwic2F2ZS1wYXllZS1idXR0b25cIlxuICAgICAgICBpMThuPVwiTGFiZWwgZm9yIGJ1dHRvbnxNYW51YWwgcGF5ZWUgY29udGludWUgYnV0dG9uQEBiaWxscGF5LWVkaXQtbWFudWFsLXBheWVlLXJldmlldy5zYXZlLXBheWVlXCJcbiAgICAgICAgKGNsaWNrKT1cInN1Ym1pdFBheWVlKHBheWVlKVwiXG4gICAgICAgIGNsYXNzPVwiYmItYnV0dG9uLWJhcl9fYnV0dG9uXCJcbiAgICAgID5cbiAgICAgICAgQ29uZmlybSBwYXllZSBkZXRhaWxzXG4gICAgICA8L2J1dHRvbj5cbiAgICAgIDxidXR0b25cbiAgICAgICAgYmJCdXR0b25cbiAgICAgICAgZGF0YS1yb2xlPVwiYmFjay1idXR0b25cIlxuICAgICAgICBpMThuPVwiTGFiZWwgZm9yIGJ1dHRvbnxGaW5kIGEgZGlmZmVyZW50IHBheWVlIGJ1dHRvbkBAYmlsbHBheS1lZGl0LW1hbnVhbC1wYXllZS1yZXZpZXcuZWRpdC1wYXllZVwiXG4gICAgICAgIChjbGljayk9XCJuYXZpZ2F0ZUJhY2soKVwiXG4gICAgICAgIGNsYXNzPVwiYmItYnV0dG9uLWJhcl9fYnV0dG9uXCJcbiAgICAgICAgY29sb3I9XCJzZWNvbmRhcnlcIlxuICAgICAgPlxuICAgICAgICBFZGl0IHBheWVlIGRldGFpbHNcbiAgICAgIDwvYnV0dG9uPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBiYkJ1dHRvblxuICAgICAgICBkYXRhLXJvbGU9XCJjYW5jZWwtYnV0dG9uXCJcbiAgICAgICAgY29sb3I9XCJsaW5rXCJcbiAgICAgICAgY2xhc3M9XCJiYi1idXR0b24tYmFyX19idXR0b24gYmItYnV0dG9uLWJhcl9fYnV0dG9uLS1hY3Jvc3NcIlxuICAgICAgICAoY2xpY2spPVwiY2FuY2VsKClcIlxuICAgICAgICBpMThuPVwiQ2FuY2VsIGVkaXR8TGFiZWwgZm9yIGEgYnV0dG9uIHRoYXQgY2FuY2VscyBmb3JtIGNoYW5nZXNAQGJpbGxwYXktZWRpdC1tYW51YWwtcGF5ZWUtcmV2aWV3LmNhbmNlbFwiXG4gICAgICA+XG4gICAgICAgIENhbmNlbFxuICAgICAgPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvc2VjdGlvbj5cbjwvZGl2PlxuPGJiLWJpbGxwYXktY2FuY2VsLWVkaXQtcGF5ZWUtbW9kYWxcbiAgKm5nSWY9XCJpc0Rpc2NhcmRNb2RhbE9wZW5cIlxuICAocmVzb2x2ZSk9XCJvbk1vZGFsUmVzb2x2ZSgkZXZlbnQpXCJcbj48L2JiLWJpbGxwYXktY2FuY2VsLWVkaXQtcGF5ZWUtbW9kYWw+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uTWVzc2FnZT5cbiAgPG5nLWNvbnRhaW5lcj5cbiAgICA8c3BhblxuICAgICAgZGF0YS1yb2xlPVwibm90aWZpY2F0aW9uLW1lc3NhZ2VcIlxuICAgICAgaTE4bj1cIlBheWVlIG5vdGlmaWNhdGlvbiBtZXNzYWdlfFBheWVlIGVkaXRlZCBub3RpZmljYXRpb25AQGJpbGxwYXktZWRpdC1tYW51YWwtcGF5ZWUtcmV2aWV3Lm5vdGlmaWNhdGlvbi5tZXNzYWdlXCJcbiAgICAgID5UaGUgcGF5ZWUg4oCYe3sgKHBheWVlLm5pY2tOYW1lICYmIHBheWVlLm5pY2tOYW1lICsgJyAoJyArIHBheWVlLm5hbWUgKyAnKScpIHx8IHBheWVlLm5hbWUgfX3igJggaGFzIGJlZW4gY2hhbmdlZFxuICAgICAgc3VjY2Vzc2Z1bGx5PC9zcGFuXG4gICAgPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uSGVhZGVyPlxuICA8c3BhblxuICAgIGkxOG49XCJcbiAgICAgIFBheWVlIG5vdGlmaWNhdGlvbiBoZWFkZXJ8UGF5ZWUgZWRpdGVkIG5vdGlmaWNhdGlvbiBoZWFkZXJAQGJpbGxwYXktZWRpdC1tYW51YWwtcGF5ZWUtcmV2aWV3Lm5vdGlmaWNhdGlvbi5oZWFkZXJcIlxuICAgID5QYXllZSBlZGl0ZWQ8L3NwYW5cbiAgPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==