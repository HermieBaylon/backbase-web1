import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormGroup, FormControl, Validators } from '@angular/forms';
import { PayverisEnrolmentComponentState } from '../../../model';
import { take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "@backbase/ui-ang/loading-indicator";
import * as i3 from "@backbase/ui-ang/alert";
import * as i4 from "@backbase/ui-ang/input-text";
import * as i5 from "@backbase/ui-ang/input-validation-message";
import * as i6 from "../billpay-payveris-ebills-enrolment-cancel-modal/billpay-payveris-ebills-enrolment-cancel-modal.component";
import * as i7 from "@angular/common";
import * as i8 from "@angular/forms";
import * as i9 from "@backbase/ui-ang/button";
export class BillpayPayverisEbillsEnrolmentCaptchaComponent {
    /** @internal */
    constructor(sanitizer) {
        this.sanitizer = sanitizer;
        this.imageSrcRaw = '';
        this.submitted = false;
        this.cancelModalOpen = false;
        this._captchaFailed = false;
        this.captchaRecentlyFailed = false;
        this.ComponentStates = PayverisEnrolmentComponentState;
        /**
         * The current state of the component. Controls loaded elements.
         */
        this.componentState = PayverisEnrolmentComponentState.Undefined;
        this.returnToPayeeList = new EventEmitter();
        this.captchaEntry = new EventEmitter();
        this.captchaForm = new FormGroup({
            captcha: new FormControl('', Validators.required),
        });
    }
    set captchaFailed(hasFailed) {
        this._captchaFailed = hasFailed;
        this.captchaRecentlyFailed = hasFailed;
        if (hasFailed) {
            this.captchaForm.controls['captcha'].markAsDirty();
            this.captchaForm.controls['captcha'].markAsTouched();
            this.captchaForm.controls['captcha'].setValue('');
            this.captchaForm.controls['captcha'].valueChanges.pipe(take(1)).subscribe(() => {
                this.captchaRecentlyFailed = false;
            });
        }
    }
    ngOnInit() {
        const imageType = this.captchaImageType || '';
        const imageSrc = this.captchaImageSrc || '';
        this.imageSrcRaw = `data:${imageType};base64,${imageSrc}`;
        this.imageSrcData = this.sanitizer.bypassSecurityTrustResourceUrl(this.imageSrcRaw);
    }
    /**
     * @return _captchaFailed. Displays elements for a failed submission. Invalidates captcha form.
     */
    get captchaFailed() {
        return this._captchaFailed;
    }
    onCaptchaSubmit() {
        this.submitted = true;
        if (this.captchaForm.valid) {
            this.captchaEntry.emit(this.captchaForm.value);
        }
    }
    onModalResolve(operationCancelled) {
        this.cancelModalOpen = false;
        if (operationCancelled) {
            this.handleReturnToPayeeList();
        }
    }
    handleReturnToPayeeList() {
        this.returnToPayeeList.emit();
    }
}
BillpayPayverisEbillsEnrolmentCaptchaComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPayverisEbillsEnrolmentCaptchaComponent, deps: [{ token: i1.DomSanitizer }], target: i0.ɵɵFactoryTarget.Component });
BillpayPayverisEbillsEnrolmentCaptchaComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: BillpayPayverisEbillsEnrolmentCaptchaComponent, selector: "bb-billpay-payveris-ebills-enrolment-captcha", inputs: { payeeName: "payeeName", captchaImageType: "captchaImageType", captchaImageSrc: "captchaImageSrc", componentState: "componentState", captchaFailed: "captchaFailed" }, outputs: { returnToPayeeList: "returnToPayeeList", captchaEntry: "captchaEntry" }, ngImport: i0, template: "<ng-container [ngSwitch]=\"componentState\">\n  <ng-container *ngSwitchCase=\"ComponentStates.Checking\">\n    <bb-loading-indicator-ui\n      text=\"Checking text...\"\n      i18n-text=\"\n        Ebill Payveris Enrolment Widget checking captcha text\n        text@@bb-billpay-ebills-payveris-enrolment-captcha-ang.checking-captcha-text.text\"\n      loaderSize=\"lg\"\n    ></bb-loading-indicator-ui>\n  </ng-container>\n\n  <ng-container *ngSwitchCase=\"ComponentStates.Callback\">\n    <bb-loading-indicator-ui\n      text=\"eBill enrolment is taking a little longer than usual, please be patient...\"\n      i18n-text=\"\n        Ebill Payveris Enrolment Widget taking longer than usual\n        text@@bb-billpay-ebills-payveris-enrolment-widget-ang.captcha-call-back.text\"\n      loaderSize=\"lg\"\n      data-role=\"payveris-callback-info\"\n    ></bb-loading-indicator-ui>\n  </ng-container>\n\n  <ng-container *ngSwitchCase=\"ComponentStates.Ready\">\n    <bb-alert-ui\n      *ngIf=\"captchaFailed\"\n      title=\"The text you provided is incorrect. Please try again.\"\n      i18n-title=\"\n        Captcha failed alert|Text for captcha failed\n        alert@@bb-billpay-payveris-ebills-enrolment-captcha.captcha-failed-alert\"\n      data-role=\"payveris-payee-captcha-warning\"\n    >\n    </bb-alert-ui>\n\n    <div\n      class=\"bb-block bb-block--lg\"\n      i18n=\"\n        captcha prompt|captcha prompt for payveris ebill enrolment captcha form\n        @@bb-billpay-payveris-ebills-enrolment-captcha.note.captcha-prompt\"\n    >\n      Type the characters you see in this image.\n    </div>\n\n    <div class=\"bb-block bb-block--lg\">\n      <img\n        role=\"img\"\n        aria-label=\"Captcha image\"\n        i18n-aria-label=\"Captcha image aria-label@@bb-billpay-payveris-ebills-enrolment-captcha.img.captcha-img\"\n        [src]=\"imageSrcData\"\n        alt=\"Captcha image for payee.\"\n        i18n-alt=\"\n          Catcha image|Catcha image for payveris ebill enrolment captcha form\n          @@bb-billpay-payveris-ebills-enrolment-captcha.image.captcha-image\"\n      />\n    </div>\n\n    <form [formGroup]=\"captchaForm\" (ngSubmit)=\"onCaptchaSubmit()\">\n      <div class=\"bb-block bb-block--xl\">\n        <bb-input-text-ui\n          class=\"bb-form-field bb-form-field--xs\"\n          name=\"captcha\"\n          i18n-label=\"\n            captcha label|Label for captcha on payveris ebill captcha form\n            @@bb-billpay-payveris-ebills-enrolment-captcha.label.captcha-label\"\n          label=\"Type characters\"\n          data-role=\"payveris-payee-captcha-input\"\n          [required]=\"true\"\n          [maxLength]=\"255\"\n          formControlName=\"captcha\"\n          [autofocus]=\"true\"\n          ngDefaultControl\n        >\n        </bb-input-text-ui>\n\n        <bb-input-validation-message-ui\n          *ngIf=\"captchaForm.controls['captcha'].invalid && captchaRecentlyFailed; else submitCaptcha\"\n          [showErrors]=\"true\"\n        >\n          <span\n            i18n=\"\n              Incorrect captcha warning|Validity warning for captcha on payveris ebill enrolment captcha\n              form@@bb-billpay-payveris-ebills-enrolment-captcha.warning.captcha-incorrect\"\n          >\n            Incorrect captcha entered\n          </span>\n        </bb-input-validation-message-ui>\n\n        <ng-template #submitCaptcha>\n          <bb-input-validation-message-ui [showErrors]=\"submitted && captchaForm.controls['captcha'].invalid\">\n            <span\n              data-role=\"payveris-payee-captcha-blank-warning\"\n              i18n=\"\n                Empty captcha warning|Empty warning for captcha on payveris ebill enrolment captcha\n                form@@bb-billpay-payveris-ebills-enrolment-captcha.warning.captcha-empty\"\n            >\n              Please enter the captcha text shown\n            </span>\n          </bb-input-validation-message-ui>\n        </ng-template>\n      </div>\n\n      <div class=\"bb-button-bar bb-button-bar--reverse\">\n        <button\n          bbButton\n          class=\"bb-button-bar__button\"\n          type=\"submit\"\n          data-role=\"payveris-payee-captcha-continue\"\n          i18n=\"\n            Continue enrolment|Continue enrolment button on payveris ebill enrolment captcha form\n            @@bb-billpay-payveris-ebills-enrolment-captcha.button.continue-enrolment\"\n        >\n          Continue\n        </button>\n\n        <button\n          bbButton\n          class=\"bb-button-bar__button\"\n          color=\"link\"\n          (click)=\"cancelModalOpen = true\"\n          i18n=\"\n            Cancel enrolment|Cancel enrolment button on payveris ebill enrolment captcha form\n            @@bb-billpay-payveris-ebills-enrolment-captcha.button.cancel-enrolment\"\n        >\n          Cancel\n        </button>\n      </div>\n    </form>\n  </ng-container>\n</ng-container>\n\n<bb-billpay-payveris-ebills-enrolment-cancel-modal *ngIf=\"cancelModalOpen\" (resolve)=\"onModalResolve($event)\">\n</bb-billpay-payveris-ebills-enrolment-cancel-modal>\n", components: [{ type: i2.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i3.AlertComponent, selector: "bb-alert-ui", inputs: ["modifier", "dismissible", "title", "message"], outputs: ["close"] }, { type: i4.InputTextComponent, selector: "bb-input-text-ui", inputs: ["placeholder", "maxLength", "minLength", "autocomplete", "readonly", "mask", "maskValidator", "showCharCounter"], outputs: ["valueChange"] }, { type: i5.InputValidationMessageComponent, selector: "bb-input-validation-message-ui", inputs: ["showErrors", "messageId"] }, { type: i6.BillpayPayverisEbillsEnrolmentCancelModalComponent, selector: "bb-billpay-payveris-ebills-enrolment-cancel-modal", outputs: ["resolve"] }], directives: [{ type: i7.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { type: i7.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i8.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i8.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i8.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i8.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i8.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i8.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i8.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i9.ButtonDirective, selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: BillpayPayverisEbillsEnrolmentCaptchaComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-billpay-payveris-ebills-enrolment-captcha',
                    templateUrl: './billpay-payveris-ebills-enrolment-captcha.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.DomSanitizer }]; }, propDecorators: { payeeName: [{
                type: Input
            }], captchaImageType: [{
                type: Input
            }], captchaImageSrc: [{
                type: Input
            }], componentState: [{
                type: Input
            }], captchaFailed: [{
                type: Input
            }], returnToPayeeList: [{
                type: Output
            }], captchaEntry: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9tYW5hZ2UtcGF5ZWVzLWpvdXJuZXkvc3JjL2NvbXBvbmVudHMvcGF5dmVyaXMtZWJpbGxzLWVucm9sbG1lbnQvYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEvYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9tYW5hZ2UtcGF5ZWVzLWpvdXJuZXkvc3JjL2NvbXBvbmVudHMvcGF5dmVyaXMtZWJpbGxzLWVucm9sbG1lbnQvYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEvYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUvRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRSxPQUFPLEVBQW1CLCtCQUErQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7OztBQU10QyxNQUFNLE9BQU8sOENBQThDO0lBNkN6RCxnQkFBZ0I7SUFDaEIsWUFBNkIsU0FBdUI7UUFBdkIsY0FBUyxHQUFULFNBQVMsQ0FBYztRQTdDcEQsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFFakIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixvQkFBZSxHQUFHLEtB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QkFBekIsS0FBSztnQkFZSSxpQkFBaUI7c0JBQTFCLE1BQU07Z0JBQ0csWUFBWTtzQkFBckIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERvbVNhbml0aXplciwgU2FmZVJlc291cmNlVXJsIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgUGF5dmVyaXNDYXB0Y2hhLCBQYXl2ZXJpc0Vucm9sbWVudENvbXBvbmVudFN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWwnO1xuaW1wb3J0IHsgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEnLFxuICB0ZW1wbGF0ZVVybDogJy4vYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBCaWxscGF5UGF5dmVyaXNFYmlsbHNFbnJvbG1lbnRDYXB0Y2hhQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgaW1hZ2VTcmNSYXcgPSAnJztcbiAgaW1hZ2VTcmNEYXRhOiBTYWZlUmVzb3VyY2VVcmwgfCB1bmRlZmluZWQ7XG4gIHN1Ym1pdHRlZCA9IGZhbHNlO1xuICBjYW5jZWxNb2RhbE9wZW4gPSBmYWxzZTtcbiAgX2NhcHRjaGFGYWlsZWQgPSBmYWxzZTtcbiAgY2FwdGNoYVJlY2VudGx5RmFpbGVkID0gZmFsc2U7XG4gIHJlYWRvbmx5IENvbXBvbmVudFN0YXRlcyA9IFBheXZlcmlzRW5yb2xtZW50Q29tcG9uZW50U3RhdGU7XG5cbiAgLyoqXG4gICAqIE5hbWUgb2YgdGhlIHBheWVlLlxuICAgKi9cbiAgQElucHV0KCkgcGF5ZWVOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIC8qKlxuICAgKiBJbWFnZSB0eXBlIG9mIHRoZSBjYXB0Y2hhLlxuICAgKi9cbiAgQElucHV0KCkgY2FwdGNoYUltYWdlVHlwZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogSW1hZ2Ugc291cmNlIG9mIHRoZSBjYXB0Y2hhLlxuICAgKi9cbiAgQElucHV0KCkgY2FwdGNoYUltYWdlU3JjOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgY29tcG9uZW50LiBDb250cm9scyBsb2FkZWQgZWxlbWVudHMuXG4gICAqL1xuICBASW5wdXQoKSBjb21wb25lbnRTdGF0ZSA9IFBheXZlcmlzRW5yb2xtZW50Q29tcG9uZW50U3RhdGUuVW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgpIHNldCBjYXB0Y2hhRmFpbGVkKGhhc0ZhaWxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuX2NhcHRjaGFGYWlsZWQgPSBoYXNGYWlsZWQ7XG4gICAgdGhpcy5jYXB0Y2hhUmVjZW50bHlGYWlsZWQgPSBoYXNGYWlsZWQ7XG4gICAgaWYgKGhhc0ZhaWxlZCkge1xuICAgICAgdGhpcy5jYXB0Y2hhRm9ybS5jb250cm9sc1snY2FwdGNoYSddLm1hcmtBc0RpcnR5KCk7XG4gICAgICB0aGlzLmNhcHRjaGFGb3JtLmNvbnRyb2xzWydjYXB0Y2hhJ10ubWFya0FzVG91Y2hlZCgpO1xuICAgICAgdGhpcy5jYXB0Y2hhRm9ybS5jb250cm9sc1snY2FwdGNoYSddLnNldFZhbHVlKCcnKTtcbiAgICAgIHRoaXMuY2FwdGNoYUZvcm0uY29udHJvbHNbJ2NhcHRjaGEnXS52YWx1ZUNoYW5nZXMucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLmNhcHRjaGFSZWNlbnRseUZhaWxlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIEBPdXRwdXQoKSByZXR1cm5Ub1BheWVlTGlzdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGNhcHRjaGFFbnRyeSA9IG5ldyBFdmVudEVtaXR0ZXI8UGF5dmVyaXNDYXB0Y2hhPigpO1xuXG4gIGNhcHRjaGFGb3JtID0gbmV3IEZvcm1Hcm91cCh7XG4gICAgY2FwdGNoYTogbmV3IEZvcm1Db250cm9sKCcnLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgfSk7XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHNhbml0aXplcjogRG9tU2FuaXRpemVyKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IGltYWdlVHlwZSA9IHRoaXMuY2FwdGNoYUltYWdlVHlwZSB8fCAnJztcbiAgICBjb25zdCBpbWFnZVNyYyA9IHRoaXMuY2FwdGNoYUltYWdlU3JjIHx8ICcnO1xuICAgIHRoaXMuaW1hZ2VTcmNSYXcgPSBgZGF0YToke2ltYWdlVHlwZX07YmFzZTY0LCR7aW1hZ2VTcmN9YDtcbiAgICB0aGlzLmltYWdlU3JjRGF0YSA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RSZXNvdXJjZVVybCh0aGlzLmltYWdlU3JjUmF3KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIF9jYXB0Y2hhRmFpbGVkLiBEaXNwbGF5cyBlbGVtZW50cyBmb3IgYSBmYWlsZWQgc3VibWlzc2lvbi4gSW52YWxpZGF0ZXMgY2FwdGNoYSBmb3JtLlxuICAgKi9cbiAgZ2V0IGNhcHRjaGFGYWlsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2NhcHRjaGFGYWlsZWQ7XG4gIH1cblxuICBvbkNhcHRjaGFTdWJtaXQoKSB7XG4gICAgdGhpcy5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgIGlmICh0aGlzLmNhcHRjaGFGb3JtLnZhbGlkKSB7XG4gICAgICB0aGlzLmNhcHRjaGFFbnRyeS5lbWl0KHRoaXMuY2FwdGNoYUZvcm0udmFsdWUgYXMgUGF5dmVyaXNDYXB0Y2hhKTtcbiAgICB9XG4gIH1cblxuICBvbk1vZGFsUmVzb2x2ZShvcGVyYXRpb25DYW5jZWxsZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmNhbmNlbE1vZGFsT3BlbiA9IGZhbHNlO1xuICAgIGlmIChvcGVyYXRpb25DYW5jZWxsZWQpIHtcbiAgICAgIHRoaXMuaGFuZGxlUmV0dXJuVG9QYXllZUxpc3QoKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVSZXR1cm5Ub1BheWVlTGlzdCgpIHtcbiAgICB0aGlzLnJldHVyblRvUGF5ZWVMaXN0LmVtaXQoKTtcbiAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciBbbmdTd2l0Y2hdPVwiY29tcG9uZW50U3RhdGVcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiQ29tcG9uZW50U3RhdGVzLkNoZWNraW5nXCI+XG4gICAgPGJiLWxvYWRpbmctaW5kaWNhdG9yLXVpXG4gICAgICB0ZXh0PVwiQ2hlY2tpbmcgdGV4dC4uLlwiXG4gICAgICBpMThuLXRleHQ9XCJcbiAgICAgICAgRWJpbGwgUGF5dmVyaXMgRW5yb2xtZW50IFdpZGdldCBjaGVja2luZyBjYXB0Y2hhIHRleHRcbiAgICAgICAgdGV4dEBAYmItYmlsbHBheS1lYmlsbHMtcGF5dmVyaXMtZW5yb2xtZW50LWNhcHRjaGEtYW5nLmNoZWNraW5nLWNhcHRjaGEtdGV4dC50ZXh0XCJcbiAgICAgIGxvYWRlclNpemU9XCJsZ1wiXG4gICAgPjwvYmItbG9hZGluZy1pbmRpY2F0b3ItdWk+XG4gIDwvbmctY29udGFpbmVyPlxuXG4gIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cIkNvbXBvbmVudFN0YXRlcy5DYWxsYmFja1wiPlxuICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aVxuICAgICAgdGV4dD1cImVCaWxsIGVucm9sbWVudCBpcyB0YWtpbmcgYSBsaXR0bGUgbG9uZ2VyIHRoYW4gdXN1YWwsIHBsZWFzZSBiZSBwYXRpZW50Li4uXCJcbiAgICAgIGkxOG4tdGV4dD1cIlxuICAgICAgICBFYmlsbCBQYXl2ZXJpcyBFbnJvbG1lbnQgV2lkZ2V0IHRha2luZyBsb25nZXIgdGhhbiB1c3VhbFxuICAgICAgICB0ZXh0QEBiYi1iaWxscGF5LWViaWxscy1wYXl2ZXJpcy1lbnJvbG1lbnQtd2lkZ2V0LWFuZy5jYXB0Y2hhLWNhbGwtYmFjay50ZXh0XCJcbiAgICAgIGxvYWRlclNpemU9XCJsZ1wiXG4gICAgICBkYXRhLXJvbGU9XCJwYXl2ZXJpcy1jYWxsYmFjay1pbmZvXCJcbiAgICA+PC9iYi1sb2FkaW5nLWluZGljYXRvci11aT5cbiAgPC9uZy1jb250YWluZXI+XG5cbiAgPG5nLWNvbnRhaW5lciAqbmdTd2l0Y2hDYXNlPVwiQ29tcG9uZW50U3RhdGVzLlJlYWR5XCI+XG4gICAgPGJiLWFsZXJ0LXVpXG4gICAgICAqbmdJZj1cImNhcHRjaGFGYWlsZWRcIlxuICAgICAgdGl0bGU9XCJUaGUgdGV4dCB5b3UgcHJvdmlkZWQgaXMgaW5jb3JyZWN0LiBQbGVhc2UgdHJ5IGFnYWluLlwiXG4gICAgICBpMThuLXRpdGxlPVwiXG4gICAgICAgIENhcHRjaGEgZmFpbGVkIGFsZXJ0fFRleHQgZm9yIGNhcHRjaGEgZmFpbGVkXG4gICAgICAgIGFsZXJ0QEBiYi1iaWxscGF5LXBheXZlcmlzLWViaWxscy1lbnJvbG1lbnQtY2FwdGNoYS5jYXB0Y2hhLWZhaWxlZC1hbGVydFwiXG4gICAgICBkYXRhLXJvbGU9XCJwYXl2ZXJpcy1wYXllZS1jYXB0Y2hhLXdhcm5pbmdcIlxuICAgID5cbiAgICA8L2JiLWFsZXJ0LXVpPlxuXG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0tbGdcIlxuICAgICAgaTE4bj1cIlxuICAgICAgICBjYXB0Y2hhIHByb21wdHxjYXB0Y2hhIHByb21wdCBmb3IgcGF5dmVyaXMgZWJpbGwgZW5yb2xtZW50IGNhcHRjaGEgZm9ybVxuICAgICAgICBAQGJiLWJpbGxwYXktcGF5dmVyaXMtZWJpbGxzLWVucm9sbWVudC1jYXB0Y2hhLm5vdGUuY2FwdGNoYS1wcm9tcHRcIlxuICAgID5cbiAgICAgIFR5cGUgdGhlIGNoYXJhY3RlcnMgeW91IHNlZSBpbiB0aGlzIGltYWdlLlxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS1sZ1wiPlxuICAgICAgPGltZ1xuICAgICAgICByb2xlPVwiaW1nXCJcbiAgICAgICAgYXJpYS1sYWJlbD1cIkNhcHRjaGEgaW1hZ2VcIlxuICAgICAgICBpMThuLWFyaWEtbGFiZWw9XCJDYXB0Y2hhIGltYWdlIGFyaWEtbGFiZWxAQGJiLWJpbGxwYXktcGF5dmVyaXMtZWJpbGxzLWVucm9sbWVudC1jYXB0Y2hhLmltZy5jYXB0Y2hhLWltZ1wiXG4gICAgICAgIFtzcmNdPVwiaW1hZ2VTcmNEYXRhXCJcbiAgICAgICAgYWx0PVwiQ2FwdGNoYSBpbWFnZSBmb3IgcGF5ZWUuXCJcbiAgICAgICAgaTE4bi1hbHQ9XCJcbiAgICAgICAgICBDYXRjaGEgaW1hZ2V8Q2F0Y2hhIGltYWdlIGZvciBwYXl2ZXJpcyBlYmlsbCBlbnJvbG1lbnQgY2FwdGNoYSBmb3JtXG4gICAgICAgICAgQEBiYi1iaWxscGF5LXBheXZlcmlzLWViaWxscy1lbnJvbG1lbnQtY2FwdGNoYS5pbWFnZS5jYXB0Y2hhLWltYWdlXCJcbiAgICAgIC8+XG4gICAgPC9kaXY+XG5cbiAgICA8Zm9ybSBbZm9ybUdyb3VwXT1cImNhcHRjaGFGb3JtXCIgKG5nU3VibWl0KT1cIm9uQ2FwdGNoYVN1Ym1pdCgpXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLXhsXCI+XG4gICAgICAgIDxiYi1pbnB1dC10ZXh0LXVpXG4gICAgICAgICAgY2xhc3M9XCJiYi1mb3JtLWZpZWxkIGJiLWZvcm0tZmllbGQtLXhzXCJcbiAgICAgICAgICBuYW1lPVwiY2FwdGNoYVwiXG4gICAgICAgICAgaTE4bi1sYWJlbD1cIlxuICAgICAgICAgICAgY2FwdGNoYSBsYWJlbHxMYWJlbCBmb3IgY2FwdGNoYSBvbiBwYXl2ZXJpcyBlYmlsbCBjYXB0Y2hhIGZvcm1cbiAgICAgICAgICAgIEBAYmItYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEubGFiZWwuY2FwdGNoYS1sYWJlbFwiXG4gICAgICAgICAgbGFiZWw9XCJUeXBlIGNoYXJhY3RlcnNcIlxuICAgICAgICAgIGRhdGEtcm9sZT1cInBheXZlcmlzLXBheWVlLWNhcHRjaGEtaW5wdXRcIlxuICAgICAgICAgIFtyZXF1aXJlZF09XCJ0cnVlXCJcbiAgICAgICAgICBbbWF4TGVuZ3RoXT1cIjI1NVwiXG4gICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwiY2FwdGNoYVwiXG4gICAgICAgICAgW2F1dG9mb2N1c109XCJ0cnVlXCJcbiAgICAgICAgICBuZ0RlZmF1bHRDb250cm9sXG4gICAgICAgID5cbiAgICAgICAgPC9iYi1pbnB1dC10ZXh0LXVpPlxuXG4gICAgICAgIDxiYi1pbnB1dC12YWxpZGF0aW9uLW1lc3NhZ2UtdWlcbiAgICAgICAgICAqbmdJZj1cImNhcHRjaGFGb3JtLmNvbnRyb2xzWydjYXB0Y2hhJ10uaW52YWxpZCAmJiBjYXB0Y2hhUmVjZW50bHlGYWlsZWQ7IGVsc2Ugc3VibWl0Q2FwdGNoYVwiXG4gICAgICAgICAgW3Nob3dFcnJvcnNdPVwidHJ1ZVwiXG4gICAgICAgID5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgaTE4bj1cIlxuICAgICAgICAgICAgICBJbmNvcnJlY3QgY2FwdGNoYSB3YXJuaW5nfFZhbGlkaXR5IHdhcm5pbmcgZm9yIGNhcHRjaGEgb24gcGF5dmVyaXMgZWJpbGwgZW5yb2xtZW50IGNhcHRjaGFcbiAgICAgICAgICAgICAgZm9ybUBAYmItYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEud2FybmluZy5jYXB0Y2hhLWluY29ycmVjdFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgSW5jb3JyZWN0IGNhcHRjaGEgZW50ZXJlZFxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9iYi1pbnB1dC12YWxpZGF0aW9uLW1lc3NhZ2UtdWk+XG5cbiAgICAgICAgPG5nLXRlbXBsYXRlICNzdWJtaXRDYXB0Y2hhPlxuICAgICAgICAgIDxiYi1pbnB1dC12YWxpZGF0aW9uLW1lc3NhZ2UtdWkgW3Nob3dFcnJvcnNdPVwic3VibWl0dGVkICYmIGNhcHRjaGFGb3JtLmNvbnRyb2xzWydjYXB0Y2hhJ10uaW52YWxpZFwiPlxuICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgZGF0YS1yb2xlPVwicGF5dmVyaXMtcGF5ZWUtY2FwdGNoYS1ibGFuay13YXJuaW5nXCJcbiAgICAgICAgICAgICAgaTE4bj1cIlxuICAgICAgICAgICAgICAgIEVtcHR5IGNhcHRjaGEgd2FybmluZ3xFbXB0eSB3YXJuaW5nIGZvciBjYXB0Y2hhIG9uIHBheXZlcmlzIGViaWxsIGVucm9sbWVudCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgZm9ybUBAYmItYmlsbHBheS1wYXl2ZXJpcy1lYmlsbHMtZW5yb2xtZW50LWNhcHRjaGEud2FybmluZy5jYXB0Y2hhLWVtcHR5XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgUGxlYXNlIGVudGVyIHRoZSBjYXB0Y2hhIHRleHQgc2hvd25cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8L2JiLWlucHV0LXZhbGlkYXRpb24tbWVzc2FnZS11aT5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiYmItYnV0dG9uLWJhciBiYi1idXR0b24tYmFyLS1yZXZlcnNlXCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICBiYkJ1dHRvblxuICAgICAgICAgIGNsYXNzPVwiYmItYnV0dG9uLWJhcl9fYnV0dG9uXCJcbiAgICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgICBkYXRhLXJvbGU9XCJwYXl2ZXJpcy1wYXllZS1jYXB0Y2hhLWNvbnRpbnVlXCJcbiAgICAgICAgICBpMThuPVwiXG4gICAgICAgICAgICBDb250aW51ZSBlbnJvbG1lbnR8Q29udGludWUgZW5yb2xtZW50IGJ1dHRvbiBvbiBwYXl2ZXJpcyBlYmlsbCBlbnJvbG1lbnQgY2FwdGNoYSBmb3JtXG4gICAgICAgICAgICBAQGJiLWJpbGxwYXktcGF5dmVyaXMtZWJpbGxzLWVucm9sbWVudC1jYXB0Y2hhLmJ1dHRvbi5jb250aW51ZS1lbnJvbG1lbnRcIlxuICAgICAgICA+XG4gICAgICAgICAgQ29udGludWVcbiAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgY2xhc3M9XCJiYi1idXR0b24tYmFyX19idXR0b25cIlxuICAgICAgICAgIGNvbG9yPVwibGlua1wiXG4gICAgICAgICAgKGNsaWNrKT1cImNhbmNlbE1vZGFsT3BlbiA9IHRydWVcIlxuICAgICAgICAgIGkxOG49XCJcbiAgICAgICAgICAgIENhbmNlbCBlbnJvbG1lbnR8Q2FuY2VsIGVucm9sbWVudCBidXR0b24gb24gcGF5dmVyaXMgZWJpbGwgZW5yb2xtZW50IGNhcHRjaGEgZm9ybVxuICAgICAgICAgICAgQEBiYi1iaWxscGF5LXBheXZlcmlzLWViaWxscy1lbnJvbG1lbnQtY2FwdGNoYS5idXR0b24uY2FuY2VsLWVucm9sbWVudFwiXG4gICAgICAgID5cbiAgICAgICAgICBDYW5jZWxcbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Zvcm0+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG5cbjxiYi1iaWxscGF5LXBheXZlcmlzLWViaWxscy1lbnJvbG1lbnQtY2FuY2VsLW1vZGFsICpuZ0lmPVwiY2FuY2VsTW9kYWxPcGVuXCIgKHJlc29sdmUpPVwib25Nb2RhbFJlc29sdmUoJGV2ZW50KVwiPlxuPC9iYi1iaWxscGF5LXBheXZlcmlzLWViaWxscy1lbnJvbG1lbnQtY2FuY2VsLW1vZGFsPlxuIl19