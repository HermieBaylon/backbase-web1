import { __decorate, __param } from "tslib";
import { BehaviorSubject, combineLatest, of } from 'rxjs';
import { map } from 'rxjs/operators';
import { AccountStatementsPostRequest } from '@backbase/data-ang/account-statements';
import { secondsToMilliseconds } from '../helpers/mappers';
import { modelItemToBoolean, toInteger } from '../helpers/utils';
import { Optional } from '@angular/core';
export const DEFAULT_NOTIFICATION_DISMISS_TIME = 5;
export const DEFAULT_PAGE_SIZE = 24;
export const widgetPropertyNames = {
    /* eslint-disable @typescript-eslint/naming-convention */
    PAGE_SIZE: 'bb.accountStatement.pageSize',
    SORTING_ORDER: 'bb.accountStatement.sortingOrder',
    SORTING_DIRECTION: 'bb.accountStatement.sortingDirection',
    RELATIVE_DATE_LIMIT: 'bb.accountStatement.relativeDateLimit',
    ABSOLUTE_DATE_LIMIT: 'bb.accountStatement.absoluteDateLimit',
    NOTIFICATION_DISMISS_TIME: 'notificationDismissTime',
    SHOW_CATEGORY: 'bb.accountStatement.showCategory',
    /* eslint-enable @typescript-eslint/naming-convention */
};
let AccountStatementBasePropertiesService = class AccountStatementBasePropertiesService {
    constructor(itemModel) {
        this.itemModel = itemModel;
        /* eslint-disable @typescript-eslint/member-ordering */
        this.pageSize$$ = new BehaviorSubject(undefined);
        this.sortingOrder$$ = new BehaviorSubject(undefined);
        this.sortingDirection$$ = new BehaviorSubject(undefined);
        this.relativeDateLimit$$ = new BehaviorSubject(undefined);
        this.absoluteDateLimit$$ = new BehaviorSubject(undefined);
        this.paginationType$$ = new BehaviorSubject(undefined);
        this.notificationDismissTime$$ = new BehaviorSubject(undefined);
        this.showCategory$$ = new BehaviorSubject(undefined);
        this.pageSize$ = this.getWidgetProperty$(this.pageSize$$, this.pageSizeIM$);
        this.sortingOrder$ = this.getWidgetProperty$(this.sortingOrder$$, this.sortingOrderIM$);
        this.sortingDirection$ = this.getWidgetProperty$(this.sortingDirection$$, this.sortingDirectionIM$);
        this.relativeDateLimit$ = this.getWidgetProperty$(this.relativeDateLimit$$, this.relativeDateLimitIM$);
        this.absoluteDateLimit$ = this.getWidgetProperty$(this.absoluteDateLimit$$, this.absoluteDateLimitIM$);
        this.paginationType$ = this.getWidgetProperty$(this.paginationType$$, this.getPaginationTypeIM$());
        this.notificationDismissTime$ = this.getWidgetProperty$(this.notificationDismissTime$$, this.notificationDismissTimePropertyIM$).pipe(map(secondsToMilliseconds));
        this.showCategory$ = this.getWidgetProperty$(this.showCategory$$, this.showCategoryIM$);
    }
    /* eslint-enable @typescript-eslint/member-ordering */
    setPaginationType(value) {
        this.paginationType$$.next(value);
    }
    setPageSize(value) {
        this.pageSize$$.next(value);
    }
    setSortingOrder(value) {
        this.sortingOrder$$.next(value);
    }
    setSortingDirection(value) {
        this.sortingDirection$$.next(value);
    }
    setNotificationDismissTime(value) {
        this.notificationDismissTime$$.next(value);
    }
    setRelativeDateLimit(value) {
        this.relativeDateLimit$$.next(value);
    }
    setAbsoluteDateLimit(value) {
        this.absoluteDateLimit$$.next(value);
    }
    setShowCategory(value) {
        this.showCategory$$.next(value);
    }
    getWidgetProperty$(property$, propertyIM$) {
        return combineLatest([property$, propertyIM$]).pipe(map(([value, valueIM]) => (value === undefined ? valueIM : value)));
    }
    get pageSizeIM$() {
        var _a;
        const defaultValue = DEFAULT_PAGE_SIZE;
        return (((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.PAGE_SIZE, defaultValue).pipe(map(toInteger))) || of(defaultValue));
    }
    get sortingOrderIM$() {
        var _a;
        const defaultValue = 'date';
        return ((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.SORTING_ORDER, defaultValue)) || of(defaultValue);
    }
    get sortingDirectionIM$() {
        var _a;
        const defaultValue = AccountStatementsPostRequest.DirectionEnum.DESC;
        return ((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.SORTING_DIRECTION, defaultValue)) || of(defaultValue);
    }
    get relativeDateLimitIM$() {
        var _a;
        const defaultValue = 0;
        return (((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.RELATIVE_DATE_LIMIT, defaultValue).pipe(map(toInteger))) ||
            of(defaultValue));
    }
    get absoluteDateLimitIM$() {
        var _a;
        const defaultValue = '';
        return ((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.ABSOLUTE_DATE_LIMIT, defaultValue)) || of(defaultValue);
    }
    get notificationDismissTimePropertyIM$() {
        var _a;
        const defaultValue = DEFAULT_NOTIFICATION_DISMISS_TIME;
        return (((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.NOTIFICATION_DISMISS_TIME, defaultValue).pipe(map(Number), map(num => (isNaN(num) ? DEFAULT_NOTIFICATION_DISMISS_TIME : num)))) || of(defaultValue));
    }
    get showCategoryIM$() {
        var _a;
        const defaultValue = true;
        return (((_a = this.itemModel) === null || _a === void 0 ? void 0 : _a.property(widgetPropertyNames.SHOW_CATEGORY, defaultValue).pipe(map(modelItemToBoolean))) ||
            of(defaultValue));
    }
};
AccountStatementBasePropertiesService = __decorate([
    __param(0, Optional())
], AccountStatementBasePropertiesService);
export { AccountStatementBasePropertiesService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudC1zdGF0ZW1lbnQtYmFzZS1wcm9wZXJ0aWVzLXNlcnZpY2UubW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FjY291bnQtc3RhdGVtZW50LWNvbW1vbi1hbmcvc3JjL21vZGVscy9hY2NvdW50LXN0YXRlbWVudC1iYXNlLXByb3BlcnRpZXMtc2VydmljZS5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxHQUFHLEVBQU8sTUFBTSxnQkFBZ0IsQ0FBQztBQUcxQyxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUVyRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUczRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6QyxNQUFNLENBQUMsTUFBTSxpQ0FBaUMsR0FBRyxDQUFDLENBQUM7QUFDbkQsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBRXBDLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHO0lBQ2pDLHlEQUF5RDtJQUN6RCxTQUFTLEVBQUUsOEJBQThCO0lBQ3pDLGFBQWEsRUFBRSxrQ0FBa0M7SUFDakQsaUJBQWlCLEVBQUUsc0NBQXNDO0lBQ3pELG1CQUFtQixFQUFFLHVDQUF1QztJQUM1RCxtQkFBbUIsRUFBRSx1Q0FBdUM7SUFDNUQseUJBQXlCLEVBQUUseUJBQXlCO0lBQ3BELGFBQWEsRUFBRSxrQ0FBa0M7SUFDakQsd0RBQXdEO0NBQ3pELENBQUM7QUFFRixJQUFzQixxQ0FBcUMsR0FBM0QsTUFBc0IscUNBQXFDO0lBV3pELFlBQXFELFNBQW9CO1FBQXBCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFWekUsdURBQXVEO1FBQ3RDLGVBQVUsR0FBRyxJQUFJLGVBQWUsQ0FBcUIsU0FBUyxDQUFDLENBQUM7UUFDaEUsbUJBQWMsR0FBRyxJQUFJLGVBQWUsQ0FBcUIsU0FBUyxDQUFDLENBQUM7UUFDcEUsdUJBQWtCLEdBQUcsSUFBSSxlQUFlLENBQTRCLFNBQVMsQ0FBQyxDQUFDO1FBQy9FLHdCQUFtQixHQUFHLElBQUksZUFBZSxDQUFxQixTQUFTLENBQUMsQ0FBQztRQUN6RSx3QkFBbUIsR0FBRyxJQUFJLGVBQWUsQ0FBcUIsU0FBUyxDQUFDLENBQUM7UUFDekUscUJBQWdCLEdBQUcsSUFBSSxlQUFlLENBQTZCLFNBQVMsQ0FBQyxDQUFDO1FBQzlFLDhCQUF5QixHQUFHLElBQUksZUFBZSxDQUFxQixTQUFTLENBQUMsQ0FBQztRQUMvRSxtQkFBYyxHQUFHLElBQUksZUFBZSxDQUFzQixTQUFTLENBQUMsQ0FBQztRQUk3RSxjQUFTLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZFLGtCQUFhLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ25GLHNCQUFpQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDL0YsdUJBQWtCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUNsRyx1QkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ2xHLG9CQUFlLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO1FBQzlGLDZCQUF3QixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FDekQsSUFBSSxDQUFDLHlCQUF5QixFQUM5QixJQUFJLENBQUMsa0NBQWtDLENBQ3hDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7UUFDMUIsa0JBQWEsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFaaEIsQ0FBQztJQWE3RSxzREFBc0Q7SUFFdEQsaUJBQWlCLENBQUMsS0FBaUM7UUFDakQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQXlCO1FBQ25DLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxlQUFlLENBQUMsS0FBeUI7UUFDdkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELG1CQUFtQixDQUFDLEtBQWdDO1FBQ2xELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELDBCQUEwQixDQUFDLEtBQXlCO1FBQ2xELElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELG9CQUFvQixDQUFDLEtBQXlCO1FBQzVDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELG9CQUFvQixDQUFDLEtBQXlCO1FBQzVDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELGVBQWUsQ0FBQyxLQUEwQjtRQUN4QyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRVMsa0JBQWtCLENBQUksU0FBb0MsRUFBRSxXQUEwQjtRQUM5RixPQUFPLGFBQWEsQ0FBQyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDakQsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUNuRSxDQUFDO0lBQ0osQ0FBQztJQUlELElBQVksV0FBVzs7UUFDckIsTUFBTSxZQUFZLEdBQUcsaUJBQWlCLENBQUM7UUFDdkMsT0FBTyxDQUNMLENBQUEsTUFBQSxJQUFJLENBQUMsU0FBUywwQ0FBRSxRQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUksRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUMvRyxDQUFDO0lBQ0osQ0FBQztJQUVELElBQVksZUFBZTs7UUFDekIsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDO1FBQzVCLE9BQU8sQ0FBQSxNQUFBLElBQUksQ0FBQyxTQUFTLDBDQUFFLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLEtBQUksRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3ZHLENBQUM7SUFFRCxJQUFZLG1CQUFtQjs7UUFDN0IsTUFBTSxZQUFZLEdBQUcsNEJBQTRCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQztRQUNyRSxPQUFPLENBQUEsTUFBQSxJQUFJLENBQUMsU0FBUywwQ0FBRSxRQUFRLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsWUFBWSxDQUFDLEtBQUksRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzNHLENBQUM7SUFFRCxJQUFZLG9CQUFvQjs7UUFDOUIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sQ0FDTCxDQUFBLE1BQUEsSUFBSSxDQUFDLFNBQVMsMENBQUUsUUFBUSxDQUFDLG1CQUFtQixDQUFDLG1CQUFtQixFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3BHLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FDakIsQ0FBQztJQUNKLENBQUM7SUFFRCxJQUFZLG9CQUFvQjs7UUFDOUIsTUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ3hCLE9BQU8sQ0FBQSxNQUFBLElBQUksQ0FBQyxTQUFTLDBDQUFFLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsRUFBRSxZQUFZLENBQUMsS0FBSSxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0csQ0FBQztJQUVELElBQVksa0NBQWtDOztRQUM1QyxNQUFNLFlBQVksR0FBRyxpQ0FBaUMsQ0FBQztRQUN2RCxPQUFPLENBQ0wsQ0FBQSxNQUFBLElBQUksQ0FBQyxTQUFTLDBDQUFFLFFBQVEsQ0FBUyxtQkFBbUIsQ0FBQyx5QkFBeUIsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUNoRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQ1gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGlDQUFpQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUNuRSxLQUFJLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FDdEIsQ0FBQztJQUNKLENBQUM7SUFFRCxJQUFZLGVBQWU7O1FBQ3pCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQztRQUMxQixPQUFPLENBQ0wsQ0FBQSxNQUFBLElBQUksQ0FBQyxTQUFTLDBDQUFFLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLEVBQUUsWUFBWSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN2RyxFQUFFLENBQUMsWUFBWSxDQUFDLENBQ2pCLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTtBQWpIcUIscUNBQXFDO0lBV2xDLFdBQUEsUUFBUSxFQUFFLENBQUE7R0FYYixxQ0FBcUMsQ0FpSDFEO1NBakhxQixxQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgSXRlbU1vZGVsIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgQWNjb3VudFN0YXRlbWVudHNQb3N0UmVxdWVzdCB9IGZyb20gJ0BiYWNrYmFzZS9kYXRhLWFuZy9hY2NvdW50LXN0YXRlbWVudHMnO1xuXG5pbXBvcnQgeyBzZWNvbmRzVG9NaWxsaXNlY29uZHMgfSBmcm9tICcuLi9oZWxwZXJzL21hcHBlcnMnO1xuaW1wb3J0IHsgUGFnaW5hdGlvblR5cGUgfSBmcm9tICcuL3BhZ2luYXRpb24tdHlwZS5tb2RlbCc7XG5pbXBvcnQgeyBTb3J0RGlyZWN0aW9uIH0gZnJvbSAnLi9zb3J0LWRpcmVjdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBtb2RlbEl0ZW1Ub0Jvb2xlYW4sIHRvSW50ZWdlciB9IGZyb20gJy4uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfTk9USUZJQ0FUSU9OX0RJU01JU1NfVElNRSA9IDU7XG5leHBvcnQgY29uc3QgREVGQVVMVF9QQUdFX1NJWkUgPSAyNDtcblxuZXhwb3J0IGNvbnN0IHdpZGdldFByb3BlcnR5TmFtZXMgPSB7XG4gIC8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvbiAqL1xuICBQQUdFX1NJWkU6ICdiYi5hY2NvdW50U3RhdGVtZW50LnBhZ2VTaXplJyxcbiAgU09SVElOR19PUkRFUjogJ2JiLmFjY291bnRTdGF0ZW1lbnQuc29ydGluZ09yZGVyJyxcbiAgU09SVElOR19ESVJFQ1RJT046ICdiYi5hY2NvdW50U3RhdGVtZW50LnNvcnRpbmdEaXJlY3Rpb24nLFxuICBSRUxBVElWRV9EQVRFX0xJTUlUOiAnYmIuYWNjb3VudFN0YXRlbWVudC5yZWxhdGl2ZURhdGVMaW1pdCcsXG4gIEFCU09MVVRFX0RBVEVfTElNSVQ6ICdiYi5hY2NvdW50U3RhdGVtZW50LmFic29sdXRlRGF0ZUxpbWl0JyxcbiAgTk9USUZJQ0FUSU9OX0RJU01JU1NfVElNRTogJ25vdGlmaWNhdGlvbkRpc21pc3NUaW1lJyxcbiAgU0hPV19DQVRFR09SWTogJ2JiLmFjY291bnRTdGF0ZW1lbnQuc2hvd0NhdGVnb3J5JyxcbiAgLyogZXNsaW50LWVuYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb24gKi9cbn07XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBY2NvdW50U3RhdGVtZW50QmFzZVByb3BlcnRpZXNTZXJ2aWNlIHtcbiAgLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L21lbWJlci1vcmRlcmluZyAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHBhZ2VTaXplJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBzb3J0aW5nT3JkZXIkJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHNvcnRpbmdEaXJlY3Rpb24kJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8U29ydERpcmVjdGlvbiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSByZWxhdGl2ZURhdGVMaW1pdCQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxudW1iZXIgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgYWJzb2x1dGVEYXRlTGltaXQkJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHBhZ2luYXRpb25UeXBlJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFBhZ2luYXRpb25UeXBlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvbkRpc21pc3NUaW1lJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBzaG93Q2F0ZWdvcnkkJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJvdGVjdGVkIHJlYWRvbmx5IGl0ZW1Nb2RlbDogSXRlbU1vZGVsKSB7fVxuXG4gIHJlYWRvbmx5IHBhZ2VTaXplJCA9IHRoaXMuZ2V0V2lkZ2V0UHJvcGVydHkkKHRoaXMucGFnZVNpemUkJCwgdGhpcy5wYWdlU2l6ZUlNJCk7XG4gIHJlYWRvbmx5IHNvcnRpbmdPcmRlciQgPSB0aGlzLmdldFdpZGdldFByb3BlcnR5JCh0aGlzLnNvcnRpbmdPcmRlciQkLCB0aGlzLnNvcnRpbmdPcmRlcklNJCk7XG4gIHJlYWRvbmx5IHNvcnRpbmdEaXJlY3Rpb24kID0gdGhpcy5nZXRXaWRnZXRQcm9wZXJ0eSQodGhpcy5zb3J0aW5nRGlyZWN0aW9uJCQsIHRoaXMuc29ydGluZ0RpcmVjdGlvbklNJCk7XG4gIHJlYWRvbmx5IHJlbGF0aXZlRGF0ZUxpbWl0JCA9IHRoaXMuZ2V0V2lkZ2V0UHJvcGVydHkkKHRoaXMucmVsYXRpdmVEYXRlTGltaXQkJCwgdGhpcy5yZWxhdGl2ZURhdGVMaW1pdElNJCk7XG4gIHJlYWRvbmx5IGFic29sdXRlRGF0ZUxpbWl0JCA9IHRoaXMuZ2V0V2lkZ2V0UHJvcGVydHkkKHRoaXMuYWJzb2x1dGVEYXRlTGltaXQkJCwgdGhpcy5hYnNvbHV0ZURhdGVMaW1pdElNJCk7XG4gIHJlYWRvbmx5IHBhZ2luYXRpb25UeXBlJCA9IHRoaXMuZ2V0V2lkZ2V0UHJvcGVydHkkKHRoaXMucGFnaW5hdGlvblR5cGUkJCwgdGhpcy5nZXRQYWdpbmF0aW9uVHlwZUlNJCgpKTtcbiAgcmVhZG9ubHkgbm90aWZpY2F0aW9uRGlzbWlzc1RpbWUkID0gdGhpcy5nZXRXaWRnZXRQcm9wZXJ0eSQoXG4gICAgdGhpcy5ub3RpZmljYXRpb25EaXNtaXNzVGltZSQkLFxuICAgIHRoaXMubm90aWZpY2F0aW9uRGlzbWlzc1RpbWVQcm9wZXJ0eUlNJCxcbiAgKS5waXBlKG1hcChzZWNvbmRzVG9NaWxsaXNlY29uZHMpKTtcbiAgcmVhZG9ubHkgc2hvd0NhdGVnb3J5JCA9IHRoaXMuZ2V0V2lkZ2V0UHJvcGVydHkkKHRoaXMuc2hvd0NhdGVnb3J5JCQsIHRoaXMuc2hvd0NhdGVnb3J5SU0kKTtcbiAgLyogZXNsaW50LWVuYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbWVtYmVyLW9yZGVyaW5nICovXG5cbiAgc2V0UGFnaW5hdGlvblR5cGUodmFsdWU6IFBhZ2luYXRpb25UeXBlIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgdGhpcy5wYWdpbmF0aW9uVHlwZSQkLm5leHQodmFsdWUpO1xuICB9XG5cbiAgc2V0UGFnZVNpemUodmFsdWU6IG51bWJlciB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIHRoaXMucGFnZVNpemUkJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIHNldFNvcnRpbmdPcmRlcih2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgdGhpcy5zb3J0aW5nT3JkZXIkJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIHNldFNvcnRpbmdEaXJlY3Rpb24odmFsdWU6IFNvcnREaXJlY3Rpb24gfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLnNvcnRpbmdEaXJlY3Rpb24kJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIHNldE5vdGlmaWNhdGlvbkRpc21pc3NUaW1lKHZhbHVlOiBudW1iZXIgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lJCQubmV4dCh2YWx1ZSk7XG4gIH1cblxuICBzZXRSZWxhdGl2ZURhdGVMaW1pdCh2YWx1ZTogbnVtYmVyIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgdGhpcy5yZWxhdGl2ZURhdGVMaW1pdCQkLm5leHQodmFsdWUpO1xuICB9XG5cbiAgc2V0QWJzb2x1dGVEYXRlTGltaXQodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIHRoaXMuYWJzb2x1dGVEYXRlTGltaXQkJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIHNldFNob3dDYXRlZ29yeSh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIHRoaXMuc2hvd0NhdGVnb3J5JCQubmV4dCh2YWx1ZSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0V2lkZ2V0UHJvcGVydHkkPFQ+KHByb3BlcnR5JDogT2JzZXJ2YWJsZTxUIHwgdW5kZWZpbmVkPiwgcHJvcGVydHlJTSQ6IE9ic2VydmFibGU8VD4pOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChbcHJvcGVydHkkLCBwcm9wZXJ0eUlNJF0pLnBpcGUoXG4gICAgICBtYXAoKFt2YWx1ZSwgdmFsdWVJTV0pID0+ICh2YWx1ZSA9PT0gdW5kZWZpbmVkID8gdmFsdWVJTSA6IHZhbHVlKSksXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBnZXRQYWdpbmF0aW9uVHlwZUlNJCgpOiBPYnNlcnZhYmxlPFBhZ2luYXRpb25UeXBlPjtcblxuICBwcml2YXRlIGdldCBwYWdlU2l6ZUlNJCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IERFRkFVTFRfUEFHRV9TSVpFO1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLml0ZW1Nb2RlbD8ucHJvcGVydHkod2lkZ2V0UHJvcGVydHlOYW1lcy5QQUdFX1NJWkUsIGRlZmF1bHRWYWx1ZSkucGlwZShtYXAodG9JbnRlZ2VyKSkgfHwgb2YoZGVmYXVsdFZhbHVlKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCBzb3J0aW5nT3JkZXJJTSQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSAnZGF0ZSc7XG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsPy5wcm9wZXJ0eSh3aWRnZXRQcm9wZXJ0eU5hbWVzLlNPUlRJTkdfT1JERVIsIGRlZmF1bHRWYWx1ZSkgfHwgb2YoZGVmYXVsdFZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IHNvcnRpbmdEaXJlY3Rpb25JTSQoKTogT2JzZXJ2YWJsZTxTb3J0RGlyZWN0aW9uPiB7XG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gQWNjb3VudFN0YXRlbWVudHNQb3N0UmVxdWVzdC5EaXJlY3Rpb25FbnVtLkRFU0M7XG4gICAgcmV0dXJuIHRoaXMuaXRlbU1vZGVsPy5wcm9wZXJ0eSh3aWRnZXRQcm9wZXJ0eU5hbWVzLlNPUlRJTkdfRElSRUNUSU9OLCBkZWZhdWx0VmFsdWUpIHx8IG9mKGRlZmF1bHRWYWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGdldCByZWxhdGl2ZURhdGVMaW1pdElNJCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IDA7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuaXRlbU1vZGVsPy5wcm9wZXJ0eSh3aWRnZXRQcm9wZXJ0eU5hbWVzLlJFTEFUSVZFX0RBVEVfTElNSVQsIGRlZmF1bHRWYWx1ZSkucGlwZShtYXAodG9JbnRlZ2VyKSkgfHxcbiAgICAgIG9mKGRlZmF1bHRWYWx1ZSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgYWJzb2x1dGVEYXRlTGltaXRJTSQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSAnJztcbiAgICByZXR1cm4gdGhpcy5pdGVtTW9kZWw/LnByb3BlcnR5KHdpZGdldFByb3BlcnR5TmFtZXMuQUJTT0xVVEVfREFURV9MSU1JVCwgZGVmYXVsdFZhbHVlKSB8fCBvZihkZWZhdWx0VmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgbm90aWZpY2F0aW9uRGlzbWlzc1RpbWVQcm9wZXJ0eUlNJCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IERFRkFVTFRfTk9USUZJQ0FUSU9OX0RJU01JU1NfVElNRTtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5pdGVtTW9kZWw/LnByb3BlcnR5PG51bWJlcj4od2lkZ2V0UHJvcGVydHlOYW1lcy5OT1RJRklDQVRJT05fRElTTUlTU19USU1FLCBkZWZhdWx0VmFsdWUpLnBpcGUoXG4gICAgICAgIG1hcChOdW1iZXIpLFxuICAgICAgICBtYXAobnVtID0+IChpc05hTihudW0pID8gREVGQVVMVF9OT1RJRklDQVRJT05fRElTTUlTU19USU1FIDogbnVtKSksXG4gICAgICApIHx8IG9mKGRlZmF1bHRWYWx1ZSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgc2hvd0NhdGVnb3J5SU0kKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRydWU7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuaXRlbU1vZGVsPy5wcm9wZXJ0eSh3aWRnZXRQcm9wZXJ0eU5hbWVzLlNIT1dfQ0FURUdPUlksIGRlZmF1bHRWYWx1ZSkucGlwZShtYXAobW9kZWxJdGVtVG9Cb29sZWFuKSkgfHxcbiAgICAgIG9mKGRlZmF1bHRWYWx1ZSlcbiAgICApO1xuICB9XG59XG4iXX0=