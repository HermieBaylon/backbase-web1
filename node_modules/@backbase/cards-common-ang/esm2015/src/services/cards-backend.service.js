import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';
import { defaultReplacementStatusMapping, defaultStatusMapping, defaultLockStatusMapping, defaultReplacementReasonMapping, defaultDeliveryStepStatusMapping, defaultLimitChannelMapping, } from '../constants';
import { CardsBackendError } from '../model/cards-backend-error.model';
import { PaymentCardLockStatus, PaymentCardReplacementStatus } from '../model/payment-card.model';
import { PaymentCardDeliveryStepStatus } from '../model/payment-card-delivery-status.model';
import * as i0 from "@angular/core";
/**
 * InjectionToken for overriding the default `PaymentCardStatusMapping` used to map backend
 * `status` values to internal status values.
 */
export const StatusMappingConfigToken = new InjectionToken('statusMapping injection token');
/**
 * InjectionToken for overriding the default `PaymentCardReplacementStatusMapping` used to map
 * backend `replacementStatus` values to internal replacement status values.
 */
export const ReplacementStatusMappingConfigToken = new InjectionToken('replacementStatusMapping injection token');
/**
 * InjectionToken for overriding the default `PaymentCardReplacementReasonMapping` used to map
 * internal replacement reason values to backend `replacementReason` values.
 */
export const ReplacementReasonMappingConfigToken = new InjectionToken('replacementReasonMapping injection token');
/**
 * InjectionToken for overriding the default `limitChannelMappingConfigToken` used to map
 * internal limit channels to backend values.
 */
export const LimitChannelMappingConfigToken = new InjectionToken('limitChannelMapping injection token');
/**
 * InjectionToken for overriding the default `CardsBackendDestinations` used to retrieve
 * countries from either a content-manager or database or any other third party.
 */
export const DestinationsServiceConfigToken = new InjectionToken('coutriesService injection token');
/**
 * @inner
 * @param maskedNumber - Number as returned in the http response
 * @returns Number
 *
 * @description
 * Process number provided by backend, removing whitespace.
 */
function processNumber(maskedNumber) {
    return maskedNumber.replace(/\s/g, '');
}
/**
 * @inner
 * @param status - Status as returned in the http response
 * @param statusMapping - Mapping of http response value to model
 * @returns Mapped payment card status, of the passed status if it cannot be mapped
 *
 * @description
 * Process status provided by backend.
 */
function processStatus(status, statusMapping) {
    if (statusMapping.hasOwnProperty(status)) {
        return statusMapping[status];
    }
    else {
        return status;
    }
}
function processLimitChannel(limitChannel = '', limitChannelMapping) {
    if (limitChannelMapping.hasOwnProperty(limitChannel)) {
        return limitChannelMapping[limitChannel];
    }
    else {
        return { name: limitChannel, description: '' };
    }
}
/**
 * @inner
 * @param replacementStatus - Replacement status as returned in the http response
 * @param replacementStatusMapping - Mapping of http response value to model
 * @returns Mapped payment card replacement status, or
 * `PaymentCardReplacementStatus.NotUnderReplacement` if the passed status is empty, or the passed
 * status if it cannot be mapped
 *
 * @description
 * Process replacement status provided by backend.
 */
function processReplacementStatus(replacementStatus, replacementStatusMapping) {
    if (typeof replacementStatus === 'undefined') {
        return PaymentCardReplacementStatus.NotUnderReplacement;
    }
    else if (replacementStatusMapping.hasOwnProperty(replacementStatus)) {
        return replacementStatusMapping[replacementStatus];
    }
    else {
        return replacementStatus;
    }
}
/**
 * @inner
 * @param lockStatus - Lock status as returned in the http response
 * @param lockStatusMapping - Mapping of http response value to model
 * @returns Payment card lock status
 *
 * @description
 * Process lock status provided by backend.
 */
function processLockStatus(lockStatus, lockStatusMapping) {
    if (lockStatus && lockStatusMapping.hasOwnProperty(lockStatus)) {
        return lockStatusMapping[lockStatus];
    }
    else {
        return PaymentCardLockStatus.Unlocked;
    }
}
/**
 * @inner
 * @param replacementReason - Replacement reason
 * @param replacementReasonMapping - Mapping of model to http POST value
 * @returns Mapped payment card replacement reason, or the passed replacement reason if it cannot
 * be mapped
 *
 * @description
 * Process replacement reason into value to pass to backend.
 */
function processReplacementReason(replacementReason, replacementReasonMapping) {
    if (replacementReasonMapping.hasOwnProperty(replacementReason)) {
        return replacementReasonMapping[replacementReason];
    }
    else {
        return replacementReason;
    }
}
/**
 * @inner
 * @param deliveryStepStatus - delivery transit step status as returned in the http response
 * @returns Delivery transit step status
 *
 * @description
 * Process delivery transit step status provided by backend.
 */
function processDeliveryStepStatus(deliveryStepStatus) {
    if (deliveryStepStatus && defaultDeliveryStepStatusMapping.hasOwnProperty(deliveryStepStatus)) {
        return defaultDeliveryStepStatusMapping[deliveryStepStatus];
    }
    else {
        return PaymentCardDeliveryStepStatus.Pending;
    }
}
/**
 * @inner
 * @param deliveryStep - delivery transit step object as returned in the http response
 * @returns Delivery transit step
 *
 * @description
 * Process delivery transit step provided by backend.
 */
function processDeliveryStep(deliveryStep) {
    return Object.assign({ name: deliveryStep.name, status: processDeliveryStepStatus(deliveryStep.status) }, (deliveryStep.stepDateTime ? { stepDateTime: new Date(deliveryStep.stepDateTime) } : {}));
}
/**
 * @inner
 * @param delivery - delivery object as returned in the http response
 * @returns Delivery status
 *
 * @description
 * Process delivery status provided by backend.
 */
function processDeliveryStatus(delivery) {
    return {
        transitSteps: delivery.transitSteps.map(processDeliveryStep),
    };
}
/**
 * @inner
 * @param yearMonth - expiration date as returned in the http response
 * @returns Date
 *
 * @description
 * Process expiration date provided by backend.
 */
function processExpirationDate(yearMonth) {
    return new Date(Number(yearMonth.year), Number(yearMonth.month) - 1);
}
/**
 * @name CardsBackendService
 *
 * @description
 * Utility functions for processing data returned by the backend.
 */
export class CardsBackendService {
    /* eslint-disable */
    constructor(statusMapping, replacementStatusMapping, replacementReasonMapping, limitChannelMapping) {
        /**
         * @name CardsBackendService#itemToModel
         * @param item - Item as returned in the http response
         * @returns Payment card
         *
         * @description
         * Process payment card provided by backend.
         */
        // eslint-disable-next-line
        this.itemToModel = (item) => (Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({ id: item.id, name: (item.holder && item.holder.name) || '', number: processNumber(item.maskedNumber), vendor: item.brand, type: item.type, status: processStatus(item.status, this.statusMapping), replacementStatus: processReplacementStatus(item.replacement && item.replacement.status, this.replacementStatusMapping), lockStatus: processLockStatus(item.lockStatus, this.lockStatusMapping), expirationDate: processExpirationDate(item.expiryDate || { year: '', month: '' }), cardName: item.name || '' }, (item.delivery ? { deliveryStatus: processDeliveryStatus(item.delivery) } : {})), (item.subType ? { subType: item.subType } : {})), (item.currency ? { currency: item.currency } : {})), (item.additions ? { additions: item.additions } : {})), (item.limits
            ? {
                limits: item.limits.map((limit) => (Object.assign(Object.assign({}, limit), { channel: processLimitChannel(limit.channel, this.limitChannelMapping) }))),
            }
            : {})));
        this.travelNoticeToModel = (item, paymentCards) => ({
            id: item.id,
            cards: item.cardIds
                .map((cardId) => paymentCards.find((card) => card.id === cardId))
                .filter((card) => card !== undefined),
            departureDate: new Date(item.departureDate),
            arrivalDate: new Date(item.arrivalDate),
            destinations: item.destinations,
            contact: item.contact,
        });
        /**
         * @name CardsBackendService#getLockStatusUpdate
         * @param lockStatus - New lock status
         * @returns Update object to pass to `postCardsLockStatusRecordById` data module function
         *
         * @description
         * Make lock status update object to pass to backend.
         */
        this.getLockStatusUpdate = (lockStatus) => ({
            lockStatus: lockStatus === PaymentCardLockStatus.Unlocked ? 'UNLOCKED' : 'LOCKED',
        });
        /**
         * @name CardsBackendService#getReplacementUpdate
         * @param replacementReason - Reason for the replacement
         * @returns Update object to pass to `postCardsReplacementRecordById` data module function
         *
         * @description
         * Make replacement update object to pass to backend.
         */
        this.getReplacementUpdate = (replacementReason) => ({
            replacementReason: processReplacementReason(replacementReason, this.replacementReasonMapping),
        });
        this.statusMapping = Object.assign(Object.assign({}, defaultStatusMapping), statusMapping);
        this.replacementStatusMapping = Object.assign(Object.assign({}, defaultReplacementStatusMapping), replacementStatusMapping);
        this.lockStatusMapping = Object.assign({}, defaultLockStatusMapping);
        this.replacementReasonMapping = Object.assign(Object.assign({}, defaultReplacementReasonMapping), replacementReasonMapping);
        this.limitChannelMapping = Object.assign(Object.assign({}, defaultLimitChannelMapping), limitChannelMapping);
    }
    /**
     * @name CardsBackendService#itemListToModel
     * @param items - List of card items as returned in the http response
     * @returns Array of payment cards
     *
     * @description
     * Process data returned by the backend.
     */
    itemListToModel(items) {
        return (items || []).map(this.itemToModel);
    }
    /**
     * @name CardsBackendService#parseError
     * @param error - The error response
     * @returns An object containing a user-friendly error message
     *
     * @description
     * Parse an HttpErrorResponse and return a CardsBackendError object that can be used to display a
     * user-friendly error message.
     */
    parseError(error) {
        return CardsBackendError.fromHttpErrorsResponse(error);
    }
}
CardsBackendService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CardsBackendService, deps: [{ token: StatusMappingConfigToken, optional: true }, { token: ReplacementStatusMappingConfigToken, optional: true }, { token: ReplacementReasonMappingConfigToken, optional: true }, { token: LimitChannelMappingConfigToken, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
CardsBackendService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CardsBackendService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CardsBackendService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [StatusMappingConfigToken]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [ReplacementStatusMappingConfigToken]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [ReplacementReasonMappingConfigToken]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [LimitChannelMappingConfigToken]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZHMtYmFja2VuZC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jYXJkcy1jb21tb24tYW5nL3NyYy9zZXJ2aWNlcy9jYXJkcy1iYWNrZW5kLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQWE3RSxPQUFPLEVBQ0wsK0JBQStCLEVBQy9CLG9CQUFvQixFQUNwQix3QkFBd0IsRUFDeEIsK0JBQStCLEVBQy9CLGdDQUFnQyxFQUNoQywwQkFBMEIsR0FDM0IsTUFBTSxjQUFjLENBQUM7QUFDdEIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDdkUsT0FBTyxFQUFlLHFCQUFxQixFQUFFLDRCQUE0QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFTL0csT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sNkNBQTZDLENBQUM7O0FBRzVGOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHLElBQUksY0FBYyxDQUEyQiwrQkFBK0IsQ0FBQyxDQUFDO0FBRXRIOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHLElBQUksY0FBYyxDQUNuRSwwQ0FBMEMsQ0FDM0MsQ0FBQztBQUVGOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHLElBQUksY0FBYyxDQUNuRSwwQ0FBMEMsQ0FDM0MsQ0FBQztBQUVGOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHLElBQUksY0FBYyxDQUM5RCxxQ0FBcUMsQ0FDdEMsQ0FBQztBQUVGOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHLElBQUksY0FBYyxDQUM5RCxpQ0FBaUMsQ0FDbEMsQ0FBQztBQUVG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T0FPRztJQUNILGVBQWUsQ0FBQyxLQUEwQjtRQUN4QyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQTBFRDs7Ozs7Ozs7T0FRRztJQUNILFVBQVUsQ0FBQyxLQUF3QjtRQUNqQyxPQUFPLGlCQUFpQixDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pELENBQUM7O2lIQXRHVSxtQkFBbUIsa0JBMEdwQix3QkFBd0IsNkJBR3hCLG1DQUFtQyw2QkFHbkMsbUNBQW1DLDZCQUduQyw4QkFBOEI7cUhBbkg3QixtQkFBbUI7NEZBQW5CLG1CQUFtQjtrQkFEL0IsVUFBVTs7MEJBMEdOLFFBQVE7OzBCQUNSLE1BQU07MkJBQUMsd0JBQXdCOzswQkFFL0IsUUFBUTs7MEJBQ1IsTUFBTTsyQkFBQyxtQ0FBbUM7OzBCQUUxQyxRQUFROzswQkFDUixNQUFNOzJCQUFDLG1DQUFtQzs7MEJBRTFDLFFBQVE7OzBCQUNSLE1BQU07MkJBQUMsOEJBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtcbiAgQ2FyZEl0ZW0sXG4gIFllYXJNb250aCxcbiAgRGVsaXZlcnksXG4gIERlbGl2ZXJ5VHJhbnNpdFN0ZXAsXG4gIFRyYXZlbE5vdGljZSxcbiAgRGVzdGluYXRpb24sXG4gIENvbnRhY3QsXG4gIExvY2tTdGF0dXNQb3N0LFxufSBmcm9tICdAYmFja2Jhc2UvZGF0YS1hbmcvY2FyZHMnO1xuXG5pbXBvcnQge1xuICBkZWZhdWx0UmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nLFxuICBkZWZhdWx0U3RhdHVzTWFwcGluZyxcbiAgZGVmYXVsdExvY2tTdGF0dXNNYXBwaW5nLFxuICBkZWZhdWx0UmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nLFxuICBkZWZhdWx0RGVsaXZlcnlTdGVwU3RhdHVzTWFwcGluZyxcbiAgZGVmYXVsdExpbWl0Q2hhbm5lbE1hcHBpbmcsXG59IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBDYXJkc0JhY2tlbmRFcnJvciB9IGZyb20gJy4uL21vZGVsL2NhcmRzLWJhY2tlbmQtZXJyb3IubW9kZWwnO1xuaW1wb3J0IHsgUGF5bWVudENhcmQsIFBheW1lbnRDYXJkTG9ja1N0YXR1cywgUGF5bWVudENhcmRSZXBsYWNlbWVudFN0YXR1cyB9IGZyb20gJy4uL21vZGVsL3BheW1lbnQtY2FyZC5tb2RlbCc7XG5pbXBvcnQgeyBQYXltZW50Q2FyZExvY2tTdGF0dXNNYXBwaW5nIH0gZnJvbSAnLi4vbW9kZWwvcGF5bWVudC1jYXJkLWxvY2stc3RhdHVzLW1hcHBpbmcubW9kZWwnO1xuaW1wb3J0IHsgUGF5bWVudENhcmRSZXBsYWNlbWVudFN0YXR1c01hcHBpbmcgfSBmcm9tICcuLi9tb2RlbC9wYXltZW50LWNhcmQtcmVwbGFjZW1lbnQtc3RhdHVzLW1hcHBpbmcubW9kZWwnO1xuaW1wb3J0IHsgUGF5bWVudENhcmRTdGF0dXNNYXBwaW5nIH0gZnJvbSAnLi4vbW9kZWwvcGF5bWVudC1jYXJkLXN0YXR1cy1tYXBwaW5nLm1vZGVsJztcbmltcG9ydCB7IFBheW1lbnRDYXJkTGltaXRDaGFubmVsTWFwcGluZyB9IGZyb20gJy4uL21vZGVsL3BheW1lbnQtY2FyZC1saW1pdC1jaGFubmVsLW1hcHBpbmcnO1xuaW1wb3J0IHtcbiAgUGF5bWVudENhcmRSZXBsYWNlbWVudFJlYXNvbixcbiAgUGF5bWVudENhcmRSZXBsYWNlbWVudFJlYXNvbk1hcHBpbmcsXG59IGZyb20gJy4uL21vZGVsL3BheW1lbnQtY2FyZC1yZXBsYWNlbWVudC1yZWFzb24ubW9kZWwnO1xuaW1wb3J0IHsgUGF5bWVudENhcmREZWxpdmVyeVN0ZXBTdGF0dXMgfSBmcm9tICcuLi9tb2RlbC9wYXltZW50LWNhcmQtZGVsaXZlcnktc3RhdHVzLm1vZGVsJztcbmltcG9ydCB7IENhcmRzQmFja2VuZERlc3RpbmF0aW9ucyB9IGZyb20gJy4uL21vZGVsL2NhcmRzLWJhY2tlbmQtZGVzdGluYXRpb24ubW9kZWwnO1xudHlwZSBDYXJkSXRlbUxpc3QgPSBDYXJkSXRlbVtdO1xuLyoqXG4gKiBJbmplY3Rpb25Ub2tlbiBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdCBgUGF5bWVudENhcmRTdGF0dXNNYXBwaW5nYCB1c2VkIHRvIG1hcCBiYWNrZW5kXG4gKiBgc3RhdHVzYCB2YWx1ZXMgdG8gaW50ZXJuYWwgc3RhdHVzIHZhbHVlcy5cbiAqL1xuZXhwb3J0IGNvbnN0IFN0YXR1c01hcHBpbmdDb25maWdUb2tlbiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxQYXltZW50Q2FyZFN0YXR1c01hcHBpbmc+KCdzdGF0dXNNYXBwaW5nIGluamVjdGlvbiB0b2tlbicpO1xuXG4vKipcbiAqIEluamVjdGlvblRva2VuIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0IGBQYXltZW50Q2FyZFJlcGxhY2VtZW50U3RhdHVzTWFwcGluZ2AgdXNlZCB0byBtYXBcbiAqIGJhY2tlbmQgYHJlcGxhY2VtZW50U3RhdHVzYCB2YWx1ZXMgdG8gaW50ZXJuYWwgcmVwbGFjZW1lbnQgc3RhdHVzIHZhbHVlcy5cbiAqL1xuZXhwb3J0IGNvbnN0IFJlcGxhY2VtZW50U3RhdHVzTWFwcGluZ0NvbmZpZ1Rva2VuID0gbmV3IEluamVjdGlvblRva2VuPFBheW1lbnRDYXJkUmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nPihcbiAgJ3JlcGxhY2VtZW50U3RhdHVzTWFwcGluZyBpbmplY3Rpb24gdG9rZW4nLFxuKTtcblxuLyoqXG4gKiBJbmplY3Rpb25Ub2tlbiBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdCBgUGF5bWVudENhcmRSZXBsYWNlbWVudFJlYXNvbk1hcHBpbmdgIHVzZWQgdG8gbWFwXG4gKiBpbnRlcm5hbCByZXBsYWNlbWVudCByZWFzb24gdmFsdWVzIHRvIGJhY2tlbmQgYHJlcGxhY2VtZW50UmVhc29uYCB2YWx1ZXMuXG4gKi9cbmV4cG9ydCBjb25zdCBSZXBsYWNlbWVudFJlYXNvbk1hcHBpbmdDb25maWdUb2tlbiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxQYXltZW50Q2FyZFJlcGxhY2VtZW50UmVhc29uTWFwcGluZz4oXG4gICdyZXBsYWNlbWVudFJlYXNvbk1hcHBpbmcgaW5qZWN0aW9uIHRva2VuJyxcbik7XG5cbi8qKlxuICogSW5qZWN0aW9uVG9rZW4gZm9yIG92ZXJyaWRpbmcgdGhlIGRlZmF1bHQgYGxpbWl0Q2hhbm5lbE1hcHBpbmdDb25maWdUb2tlbmAgdXNlZCB0byBtYXBcbiAqIGludGVybmFsIGxpbWl0IGNoYW5uZWxzIHRvIGJhY2tlbmQgdmFsdWVzLlxuICovXG5leHBvcnQgY29uc3QgTGltaXRDaGFubmVsTWFwcGluZ0NvbmZpZ1Rva2VuID0gbmV3IEluamVjdGlvblRva2VuPFBheW1lbnRDYXJkTGltaXRDaGFubmVsTWFwcGluZz4oXG4gICdsaW1pdENoYW5uZWxNYXBwaW5nIGluamVjdGlvbiB0b2tlbicsXG4pO1xuXG4vKipcbiAqIEluamVjdGlvblRva2VuIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0IGBDYXJkc0JhY2tlbmREZXN0aW5hdGlvbnNgIHVzZWQgdG8gcmV0cmlldmVcbiAqIGNvdW50cmllcyBmcm9tIGVpdGhlciBhIGNvbnRlbnQtbWFuYWdlciBvciBkYXRhYmFzZSBvciBhbnkgb3RoZXIgdGhpcmQgcGFydHkuXG4gKi9cbmV4cG9ydCBjb25zdCBEZXN0aW5hdGlvbnNTZXJ2aWNlQ29uZmlnVG9rZW4gPSBuZXcgSW5qZWN0aW9uVG9rZW48Q2FyZHNCYWNrZW5kRGVzdGluYXRpb25zPihcbiAgJ2NvdXRyaWVzU2VydmljZSBpbmplY3Rpb24gdG9rZW4nLFxuKTtcblxuLyoqXG4gKiBAaW5uZXJcbiAqIEBwYXJhbSBtYXNrZWROdW1iZXIgLSBOdW1iZXIgYXMgcmV0dXJuZWQgaW4gdGhlIGh0dHAgcmVzcG9uc2VcbiAqIEByZXR1cm5zIE51bWJlclxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJvY2VzcyBudW1iZXIgcHJvdmlkZWQgYnkgYmFja2VuZCwgcmVtb3Zpbmcgd2hpdGVzcGFjZS5cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc051bWJlcihtYXNrZWROdW1iZXI6IHN0cmluZykge1xuICByZXR1cm4gbWFza2VkTnVtYmVyLnJlcGxhY2UoL1xccy9nLCAnJyk7XG59XG5cbi8qKlxuICogQGlubmVyXG4gKiBAcGFyYW0gc3RhdHVzIC0gU3RhdHVzIGFzIHJldHVybmVkIGluIHRoZSBodHRwIHJlc3BvbnNlXG4gKiBAcGFyYW0gc3RhdHVzTWFwcGluZyAtIE1hcHBpbmcgb2YgaHR0cCByZXNwb25zZSB2YWx1ZSB0byBtb2RlbFxuICogQHJldHVybnMgTWFwcGVkIHBheW1lbnQgY2FyZCBzdGF0dXMsIG9mIHRoZSBwYXNzZWQgc3RhdHVzIGlmIGl0IGNhbm5vdCBiZSBtYXBwZWRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByb2Nlc3Mgc3RhdHVzIHByb3ZpZGVkIGJ5IGJhY2tlbmQuXG4gKi9cbmZ1bmN0aW9uIHByb2Nlc3NTdGF0dXMoc3RhdHVzOiBzdHJpbmcsIHN0YXR1c01hcHBpbmc6IFBheW1lbnRDYXJkU3RhdHVzTWFwcGluZykge1xuICBpZiAoc3RhdHVzTWFwcGluZy5oYXNPd25Qcm9wZXJ0eShzdGF0dXMpKSB7XG4gICAgcmV0dXJuIHN0YXR1c01hcHBpbmdbc3RhdHVzXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NMaW1pdENoYW5uZWwobGltaXRDaGFubmVsOiBzdHJpbmcgPSAnJywgbGltaXRDaGFubmVsTWFwcGluZzogUGF5bWVudENhcmRMaW1pdENoYW5uZWxNYXBwaW5nKSB7XG4gIGlmIChsaW1pdENoYW5uZWxNYXBwaW5nLmhhc093blByb3BlcnR5KGxpbWl0Q2hhbm5lbCkpIHtcbiAgICByZXR1cm4gbGltaXRDaGFubmVsTWFwcGluZ1tsaW1pdENoYW5uZWxdO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB7IG5hbWU6IGxpbWl0Q2hhbm5lbCwgZGVzY3JpcHRpb246ICcnIH07XG4gIH1cbn1cblxuLyoqXG4gKiBAaW5uZXJcbiAqIEBwYXJhbSByZXBsYWNlbWVudFN0YXR1cyAtIFJlcGxhY2VtZW50IHN0YXR1cyBhcyByZXR1cm5lZCBpbiB0aGUgaHR0cCByZXNwb25zZVxuICogQHBhcmFtIHJlcGxhY2VtZW50U3RhdHVzTWFwcGluZyAtIE1hcHBpbmcgb2YgaHR0cCByZXNwb25zZSB2YWx1ZSB0byBtb2RlbFxuICogQHJldHVybnMgTWFwcGVkIHBheW1lbnQgY2FyZCByZXBsYWNlbWVudCBzdGF0dXMsIG9yXG4gKiBgUGF5bWVudENhcmRSZXBsYWNlbWVudFN0YXR1cy5Ob3RVbmRlclJlcGxhY2VtZW50YCBpZiB0aGUgcGFzc2VkIHN0YXR1cyBpcyBlbXB0eSwgb3IgdGhlIHBhc3NlZFxuICogc3RhdHVzIGlmIGl0IGNhbm5vdCBiZSBtYXBwZWRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByb2Nlc3MgcmVwbGFjZW1lbnQgc3RhdHVzIHByb3ZpZGVkIGJ5IGJhY2tlbmQuXG4gKi9cbmZ1bmN0aW9uIHByb2Nlc3NSZXBsYWNlbWVudFN0YXR1cyhcbiAgcmVwbGFjZW1lbnRTdGF0dXM6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgcmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nOiBQYXltZW50Q2FyZFJlcGxhY2VtZW50U3RhdHVzTWFwcGluZyxcbikge1xuICBpZiAodHlwZW9mIHJlcGxhY2VtZW50U3RhdHVzID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiBQYXltZW50Q2FyZFJlcGxhY2VtZW50U3RhdHVzLk5vdFVuZGVyUmVwbGFjZW1lbnQ7XG4gIH0gZWxzZSBpZiAocmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nLmhhc093blByb3BlcnR5KHJlcGxhY2VtZW50U3RhdHVzKSkge1xuICAgIHJldHVybiByZXBsYWNlbWVudFN0YXR1c01hcHBpbmdbcmVwbGFjZW1lbnRTdGF0dXNdO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXBsYWNlbWVudFN0YXR1cztcbiAgfVxufVxuXG4vKipcbiAqIEBpbm5lclxuICogQHBhcmFtIGxvY2tTdGF0dXMgLSBMb2NrIHN0YXR1cyBhcyByZXR1cm5lZCBpbiB0aGUgaHR0cCByZXNwb25zZVxuICogQHBhcmFtIGxvY2tTdGF0dXNNYXBwaW5nIC0gTWFwcGluZyBvZiBodHRwIHJlc3BvbnNlIHZhbHVlIHRvIG1vZGVsXG4gKiBAcmV0dXJucyBQYXltZW50IGNhcmQgbG9jayBzdGF0dXNcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByb2Nlc3MgbG9jayBzdGF0dXMgcHJvdmlkZWQgYnkgYmFja2VuZC5cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc0xvY2tTdGF0dXMobG9ja1N0YXR1czogc3RyaW5nIHwgdW5kZWZpbmVkLCBsb2NrU3RhdHVzTWFwcGluZzogUGF5bWVudENhcmRMb2NrU3RhdHVzTWFwcGluZykge1xuICBpZiAobG9ja1N0YXR1cyAmJiBsb2NrU3RhdHVzTWFwcGluZy5oYXNPd25Qcm9wZXJ0eShsb2NrU3RhdHVzKSkge1xuICAgIHJldHVybiBsb2NrU3RhdHVzTWFwcGluZ1tsb2NrU3RhdHVzXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gUGF5bWVudENhcmRMb2NrU3RhdHVzLlVubG9ja2VkO1xuICB9XG59XG5cbi8qKlxuICogQGlubmVyXG4gKiBAcGFyYW0gcmVwbGFjZW1lbnRSZWFzb24gLSBSZXBsYWNlbWVudCByZWFzb25cbiAqIEBwYXJhbSByZXBsYWNlbWVudFJlYXNvbk1hcHBpbmcgLSBNYXBwaW5nIG9mIG1vZGVsIHRvIGh0dHAgUE9TVCB2YWx1ZVxuICogQHJldHVybnMgTWFwcGVkIHBheW1lbnQgY2FyZCByZXBsYWNlbWVudCByZWFzb24sIG9yIHRoZSBwYXNzZWQgcmVwbGFjZW1lbnQgcmVhc29uIGlmIGl0IGNhbm5vdFxuICogYmUgbWFwcGVkXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm9jZXNzIHJlcGxhY2VtZW50IHJlYXNvbiBpbnRvIHZhbHVlIHRvIHBhc3MgdG8gYmFja2VuZC5cbiAqL1xuZnVuY3Rpb24gcHJvY2Vzc1JlcGxhY2VtZW50UmVhc29uKFxuICByZXBsYWNlbWVudFJlYXNvbjogUGF5bWVudENhcmRSZXBsYWNlbWVudFJlYXNvbiB8IHN0cmluZyxcbiAgcmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nOiBQYXltZW50Q2FyZFJlcGxhY2VtZW50UmVhc29uTWFwcGluZyxcbikge1xuICBpZiAocmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nLmhhc093blByb3BlcnR5KHJlcGxhY2VtZW50UmVhc29uKSkge1xuICAgIHJldHVybiByZXBsYWNlbWVudFJlYXNvbk1hcHBpbmdbcmVwbGFjZW1lbnRSZWFzb25dO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXBsYWNlbWVudFJlYXNvbjtcbiAgfVxufVxuXG4vKipcbiAqIEBpbm5lclxuICogQHBhcmFtIGRlbGl2ZXJ5U3RlcFN0YXR1cyAtIGRlbGl2ZXJ5IHRyYW5zaXQgc3RlcCBzdGF0dXMgYXMgcmV0dXJuZWQgaW4gdGhlIGh0dHAgcmVzcG9uc2VcbiAqIEByZXR1cm5zIERlbGl2ZXJ5IHRyYW5zaXQgc3RlcCBzdGF0dXNcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByb2Nlc3MgZGVsaXZlcnkgdHJhbnNpdCBzdGVwIHN0YXR1cyBwcm92aWRlZCBieSBiYWNrZW5kLlxuICovXG5mdW5jdGlvbiBwcm9jZXNzRGVsaXZlcnlTdGVwU3RhdHVzKGRlbGl2ZXJ5U3RlcFN0YXR1czogc3RyaW5nKSB7XG4gIGlmIChkZWxpdmVyeVN0ZXBTdGF0dXMgJiYgZGVmYXVsdERlbGl2ZXJ5U3RlcFN0YXR1c01hcHBpbmcuaGFzT3duUHJvcGVydHkoZGVsaXZlcnlTdGVwU3RhdHVzKSkge1xuICAgIHJldHVybiBkZWZhdWx0RGVsaXZlcnlTdGVwU3RhdHVzTWFwcGluZ1tkZWxpdmVyeVN0ZXBTdGF0dXNdO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBQYXltZW50Q2FyZERlbGl2ZXJ5U3RlcFN0YXR1cy5QZW5kaW5nO1xuICB9XG59XG5cbi8qKlxuICogQGlubmVyXG4gKiBAcGFyYW0gZGVsaXZlcnlTdGVwIC0gZGVsaXZlcnkgdHJhbnNpdCBzdGVwIG9iamVjdCBhcyByZXR1cm5lZCBpbiB0aGUgaHR0cCByZXNwb25zZVxuICogQHJldHVybnMgRGVsaXZlcnkgdHJhbnNpdCBzdGVwXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm9jZXNzIGRlbGl2ZXJ5IHRyYW5zaXQgc3RlcCBwcm92aWRlZCBieSBiYWNrZW5kLlxuICovXG5mdW5jdGlvbiBwcm9jZXNzRGVsaXZlcnlTdGVwKGRlbGl2ZXJ5U3RlcDogRGVsaXZlcnlUcmFuc2l0U3RlcCkge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IGRlbGl2ZXJ5U3RlcC5uYW1lLFxuICAgIHN0YXR1czogcHJvY2Vzc0RlbGl2ZXJ5U3RlcFN0YXR1cyhkZWxpdmVyeVN0ZXAuc3RhdHVzKSxcbiAgICAuLi4oZGVsaXZlcnlTdGVwLnN0ZXBEYXRlVGltZSA/IHsgc3RlcERhdGVUaW1lOiBuZXcgRGF0ZShkZWxpdmVyeVN0ZXAuc3RlcERhdGVUaW1lKSB9IDoge30pLFxuICB9O1xufVxuXG4vKipcbiAqIEBpbm5lclxuICogQHBhcmFtIGRlbGl2ZXJ5IC0gZGVsaXZlcnkgb2JqZWN0IGFzIHJldHVybmVkIGluIHRoZSBodHRwIHJlc3BvbnNlXG4gKiBAcmV0dXJucyBEZWxpdmVyeSBzdGF0dXNcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByb2Nlc3MgZGVsaXZlcnkgc3RhdHVzIHByb3ZpZGVkIGJ5IGJhY2tlbmQuXG4gKi9cbmZ1bmN0aW9uIHByb2Nlc3NEZWxpdmVyeVN0YXR1cyhkZWxpdmVyeTogRGVsaXZlcnkpIHtcbiAgcmV0dXJuIHtcbiAgICB0cmFuc2l0U3RlcHM6IGRlbGl2ZXJ5LnRyYW5zaXRTdGVwcy5tYXAocHJvY2Vzc0RlbGl2ZXJ5U3RlcCksXG4gIH07XG59XG5cbi8qKlxuICogQGlubmVyXG4gKiBAcGFyYW0geWVhck1vbnRoIC0gZXhwaXJhdGlvbiBkYXRlIGFzIHJldHVybmVkIGluIHRoZSBodHRwIHJlc3BvbnNlXG4gKiBAcmV0dXJucyBEYXRlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm9jZXNzIGV4cGlyYXRpb24gZGF0ZSBwcm92aWRlZCBieSBiYWNrZW5kLlxuICovXG5mdW5jdGlvbiBwcm9jZXNzRXhwaXJhdGlvbkRhdGUoeWVhck1vbnRoOiBZZWFyTW9udGgpIHtcbiAgcmV0dXJuIG5ldyBEYXRlKE51bWJlcih5ZWFyTW9udGgueWVhciksIE51bWJlcih5ZWFyTW9udGgubW9udGgpIC0gMSk7XG59XG5cbi8qKlxuICogQG5hbWUgQ2FyZHNCYWNrZW5kU2VydmljZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIHByb2Nlc3NpbmcgZGF0YSByZXR1cm5lZCBieSB0aGUgYmFja2VuZC5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENhcmRzQmFja2VuZFNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IHN0YXR1c01hcHBpbmc6IFBheW1lbnRDYXJkU3RhdHVzTWFwcGluZztcbiAgcHJpdmF0ZSByZWFkb25seSByZXBsYWNlbWVudFN0YXR1c01hcHBpbmc6IFBheW1lbnRDYXJkUmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGxvY2tTdGF0dXNNYXBwaW5nOiBQYXltZW50Q2FyZExvY2tTdGF0dXNNYXBwaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlcGxhY2VtZW50UmVhc29uTWFwcGluZzogUGF5bWVudENhcmRSZXBsYWNlbWVudFJlYXNvbk1hcHBpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgbGltaXRDaGFubmVsTWFwcGluZzogUGF5bWVudENhcmRMaW1pdENoYW5uZWxNYXBwaW5nO1xuXG4gIC8qKlxuICAgKiBAbmFtZSBDYXJkc0JhY2tlbmRTZXJ2aWNlI2l0ZW1MaXN0VG9Nb2RlbFxuICAgKiBAcGFyYW0gaXRlbXMgLSBMaXN0IG9mIGNhcmQgaXRlbXMgYXMgcmV0dXJuZWQgaW4gdGhlIGh0dHAgcmVzcG9uc2VcbiAgICogQHJldHVybnMgQXJyYXkgb2YgcGF5bWVudCBjYXJkc1xuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUHJvY2VzcyBkYXRhIHJldHVybmVkIGJ5IHRoZSBiYWNrZW5kLlxuICAgKi9cbiAgaXRlbUxpc3RUb01vZGVsKGl0ZW1zOiBDYXJkSXRlbUxpc3QgfCBudWxsKTogQXJyYXk8UGF5bWVudENhcmQ+IHtcbiAgICByZXR1cm4gKGl0ZW1zIHx8IFtdKS5tYXAodGhpcy5pdGVtVG9Nb2RlbCk7XG4gIH1cblxuICAvKipcbiAgICogQG5hbWUgQ2FyZHNCYWNrZW5kU2VydmljZSNpdGVtVG9Nb2RlbFxuICAgKiBAcGFyYW0gaXRlbSAtIEl0ZW0gYXMgcmV0dXJuZWQgaW4gdGhlIGh0dHAgcmVzcG9uc2VcbiAgICogQHJldHVybnMgUGF5bWVudCBjYXJkXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBQcm9jZXNzIHBheW1lbnQgY2FyZCBwcm92aWRlZCBieSBiYWNrZW5kLlxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIGl0ZW1Ub01vZGVsID0gKGl0ZW06IENhcmRJdGVtKTogUGF5bWVudENhcmQgPT4gKHtcbiAgICBpZDogaXRlbS5pZCxcbiAgICBuYW1lOiAoaXRlbS5ob2xkZXIgJiYgaXRlbS5ob2xkZXIubmFtZSkgfHwgJycsXG4gICAgbnVtYmVyOiBwcm9jZXNzTnVtYmVyKGl0ZW0ubWFza2VkTnVtYmVyKSxcbiAgICB2ZW5kb3I6IGl0ZW0uYnJhbmQsXG4gICAgdHlwZTogaXRlbS50eXBlLFxuICAgIHN0YXR1czogcHJvY2Vzc1N0YXR1cyhpdGVtLnN0YXR1cywgdGhpcy5zdGF0dXNNYXBwaW5nKSxcbiAgICByZXBsYWNlbWVudFN0YXR1czogcHJvY2Vzc1JlcGxhY2VtZW50U3RhdHVzKFxuICAgICAgaXRlbS5yZXBsYWNlbWVudCAmJiBpdGVtLnJlcGxhY2VtZW50LnN0YXR1cyxcbiAgICAgIHRoaXMucmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nLFxuICAgICksXG4gICAgbG9ja1N0YXR1czogcHJvY2Vzc0xvY2tTdGF0dXMoaXRlbS5sb2NrU3RhdHVzLCB0aGlzLmxvY2tTdGF0dXNNYXBwaW5nKSxcbiAgICBleHBpcmF0aW9uRGF0ZTogcHJvY2Vzc0V4cGlyYXRpb25EYXRlKGl0ZW0uZXhwaXJ5RGF0ZSB8fCB7IHllYXI6ICcnLCBtb250aDogJycgfSksXG4gICAgY2FyZE5hbWU6IGl0ZW0ubmFtZSB8fCAnJyxcbiAgICAuLi4oaXRlbS5kZWxpdmVyeSA/IHsgZGVsaXZlcnlTdGF0dXM6IHByb2Nlc3NEZWxpdmVyeVN0YXR1cyhpdGVtLmRlbGl2ZXJ5KSB9IDoge30pLFxuICAgIC4uLihpdGVtLnN1YlR5cGUgPyB7IHN1YlR5cGU6IGl0ZW0uc3ViVHlwZSB9IDoge30pLFxuICAgIC4uLihpdGVtLmN1cnJlbmN5ID8geyBjdXJyZW5jeTogaXRlbS5jdXJyZW5jeSB9IDoge30pLFxuICAgIC4uLihpdGVtLmFkZGl0aW9ucyA/IHsgYWRkaXRpb25zOiBpdGVtLmFkZGl0aW9ucyB9IDoge30pLFxuICAgIC4uLihpdGVtLmxpbWl0c1xuICAgICAgPyB7XG4gICAgICAgICAgbGltaXRzOiBpdGVtLmxpbWl0cy5tYXAoKGxpbWl0KSA9PiAoe1xuICAgICAgICAgICAgLi4ubGltaXQsXG4gICAgICAgICAgICBjaGFubmVsOiBwcm9jZXNzTGltaXRDaGFubmVsKGxpbWl0LmNoYW5uZWwsIHRoaXMubGltaXRDaGFubmVsTWFwcGluZyksXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9XG4gICAgICA6IHt9KSxcbiAgfSk7XG5cbiAgdHJhdmVsTm90aWNlVG9Nb2RlbCA9IChpdGVtOiBUcmF2ZWxOb3RpY2UsIHBheW1lbnRDYXJkczogUGF5bWVudENhcmRbXSkgPT4gKHtcbiAgICBpZDogaXRlbS5pZCxcbiAgICBjYXJkczogaXRlbS5jYXJkSWRzXG4gICAgICAubWFwKChjYXJkSWQpID0+IHBheW1lbnRDYXJkcy5maW5kKChjYXJkKSA9PiBjYXJkLmlkID09PSBjYXJkSWQpKVxuICAgICAgLmZpbHRlcigoY2FyZCkgPT4gY2FyZCAhPT0gdW5kZWZpbmVkKSBhcyBBcnJheTxQYXltZW50Q2FyZD4sXG4gICAgZGVwYXJ0dXJlRGF0ZTogbmV3IERhdGUoaXRlbS5kZXBhcnR1cmVEYXRlKSxcbiAgICBhcnJpdmFsRGF0ZTogbmV3IERhdGUoaXRlbS5hcnJpdmFsRGF0ZSksXG4gICAgZGVzdGluYXRpb25zOiBpdGVtLmRlc3RpbmF0aW9ucyBhcyBEZXN0aW5hdGlvbltdLFxuICAgIGNvbnRhY3Q6IGl0ZW0uY29udGFjdCBhcyBDb250YWN0LFxuICB9KTtcblxuICAvKipcbiAgICogQG5hbWUgQ2FyZHNCYWNrZW5kU2VydmljZSNnZXRMb2NrU3RhdHVzVXBkYXRlXG4gICAqIEBwYXJhbSBsb2NrU3RhdHVzIC0gTmV3IGxvY2sgc3RhdHVzXG4gICAqIEByZXR1cm5zIFVwZGF0ZSBvYmplY3QgdG8gcGFzcyB0byBgcG9zdENhcmRzTG9ja1N0YXR1c1JlY29yZEJ5SWRgIGRhdGEgbW9kdWxlIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBNYWtlIGxvY2sgc3RhdHVzIHVwZGF0ZSBvYmplY3QgdG8gcGFzcyB0byBiYWNrZW5kLlxuICAgKi9cbiAgZ2V0TG9ja1N0YXR1c1VwZGF0ZSA9IChsb2NrU3RhdHVzOiBQYXltZW50Q2FyZExvY2tTdGF0dXMpOiBMb2NrU3RhdHVzUG9zdCA9PiAoe1xuICAgIGxvY2tTdGF0dXM6IGxvY2tTdGF0dXMgPT09IFBheW1lbnRDYXJkTG9ja1N0YXR1cy5VbmxvY2tlZCA/ICdVTkxPQ0tFRCcgOiAnTE9DS0VEJyxcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBuYW1lIENhcmRzQmFja2VuZFNlcnZpY2UjZ2V0UmVwbGFjZW1lbnRVcGRhdGVcbiAgICogQHBhcmFtIHJlcGxhY2VtZW50UmVhc29uIC0gUmVhc29uIGZvciB0aGUgcmVwbGFjZW1lbnRcbiAgICogQHJldHVybnMgVXBkYXRlIG9iamVjdCB0byBwYXNzIHRvIGBwb3N0Q2FyZHNSZXBsYWNlbWVudFJlY29yZEJ5SWRgIGRhdGEgbW9kdWxlIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBNYWtlIHJlcGxhY2VtZW50IHVwZGF0ZSBvYmplY3QgdG8gcGFzcyB0byBiYWNrZW5kLlxuICAgKi9cbiAgZ2V0UmVwbGFjZW1lbnRVcGRhdGUgPSAocmVwbGFjZW1lbnRSZWFzb246IFBheW1lbnRDYXJkUmVwbGFjZW1lbnRSZWFzb24gfCBzdHJpbmcpID0+ICh7XG4gICAgcmVwbGFjZW1lbnRSZWFzb246IHByb2Nlc3NSZXBsYWNlbWVudFJlYXNvbihyZXBsYWNlbWVudFJlYXNvbiwgdGhpcy5yZXBsYWNlbWVudFJlYXNvbk1hcHBpbmcpLFxuICB9KTtcblxuICAvKipcbiAgICogQG5hbWUgQ2FyZHNCYWNrZW5kU2VydmljZSNwYXJzZUVycm9yXG4gICAqIEBwYXJhbSBlcnJvciAtIFRoZSBlcnJvciByZXNwb25zZVxuICAgKiBAcmV0dXJucyBBbiBvYmplY3QgY29udGFpbmluZyBhIHVzZXItZnJpZW5kbHkgZXJyb3IgbWVzc2FnZVxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUGFyc2UgYW4gSHR0cEVycm9yUmVzcG9uc2UgYW5kIHJldHVybiBhIENhcmRzQmFja2VuZEVycm9yIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGRpc3BsYXkgYVxuICAgKiB1c2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2UuXG4gICAqL1xuICBwYXJzZUVycm9yKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSk6IENhcmRzQmFja2VuZEVycm9yW10ge1xuICAgIHJldHVybiBDYXJkc0JhY2tlbmRFcnJvci5mcm9tSHR0cEVycm9yc1Jlc3BvbnNlKGVycm9yKTtcbiAgfVxuICAvKiBlc2xpbnQtZGlzYWJsZSAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoU3RhdHVzTWFwcGluZ0NvbmZpZ1Rva2VuKVxuICAgIHN0YXR1c01hcHBpbmc6IFBheW1lbnRDYXJkU3RhdHVzTWFwcGluZyB8IHVuZGVmaW5lZCxcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoUmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nQ29uZmlnVG9rZW4pXG4gICAgcmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nOiBQYXltZW50Q2FyZFJlcGxhY2VtZW50U3RhdHVzTWFwcGluZyB8IHVuZGVmaW5lZCxcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoUmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nQ29uZmlnVG9rZW4pXG4gICAgcmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nOiBQYXltZW50Q2FyZFJlcGxhY2VtZW50UmVhc29uTWFwcGluZyB8IHVuZGVmaW5lZCxcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoTGltaXRDaGFubmVsTWFwcGluZ0NvbmZpZ1Rva2VuKVxuICAgIGxpbWl0Q2hhbm5lbE1hcHBpbmc6IFBheW1lbnRDYXJkTGltaXRDaGFubmVsTWFwcGluZyB8IHVuZGVmaW5lZCxcbiAgKSB7XG4gICAgdGhpcy5zdGF0dXNNYXBwaW5nID0geyAuLi5kZWZhdWx0U3RhdHVzTWFwcGluZywgLi4uc3RhdHVzTWFwcGluZyB9O1xuICAgIHRoaXMucmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nID0geyAuLi5kZWZhdWx0UmVwbGFjZW1lbnRTdGF0dXNNYXBwaW5nLCAuLi5yZXBsYWNlbWVudFN0YXR1c01hcHBpbmcgfTtcbiAgICB0aGlzLmxvY2tTdGF0dXNNYXBwaW5nID0geyAuLi5kZWZhdWx0TG9ja1N0YXR1c01hcHBpbmcgfTtcbiAgICB0aGlzLnJlcGxhY2VtZW50UmVhc29uTWFwcGluZyA9IHsgLi4uZGVmYXVsdFJlcGxhY2VtZW50UmVhc29uTWFwcGluZywgLi4ucmVwbGFjZW1lbnRSZWFzb25NYXBwaW5nIH07XG4gICAgdGhpcy5saW1pdENoYW5uZWxNYXBwaW5nID0geyAuLi5kZWZhdWx0TGltaXRDaGFubmVsTWFwcGluZywgLi4ubGltaXRDaGFubmVsTWFwcGluZyB9O1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgKi9cbn1cbiJdfQ==