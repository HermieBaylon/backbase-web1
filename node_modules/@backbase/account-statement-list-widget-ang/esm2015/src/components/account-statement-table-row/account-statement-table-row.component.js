import { ChangeDetectionStrategy, Component, Directive, Input, ViewChild } from '@angular/core';
import { mimeTypeExtensions, } from '@backbase/account-statement-common-ang';
import { BbTemplate } from '@backbase/foundation-ang/core';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/account-statement-common-ang";
import * as i2 from "@backbase/ui-ang/notification";
import * as i3 from "@angular/common";
import * as i4 from "@backbase/ui-ang/date-pipe";
export class AccountStatementTableRowComponent {
    constructor(dataService, notificationsService) {
        this.dataService = dataService;
        this.notificationsService = notificationsService;
        /**
         * Whether Description content is presented for specific row in the account statement list table
         */
        this.showDescription = true;
        /**
         * Whether Category content is presented for specific row in the account statement list table
         */
        this.showCategory = true;
        /**
         * Time of displaying notification after download failure in milliseconds.
         */
        this.notificationDismissTimeProperty = 0;
        /**
         * Table row id.
         * Used in creating unique ids for preview and download text for a11y
         */
        this.accountStatementTableRowId = AccountStatementTableRowComponent._id++;
        this.mimeTypeExtensions = mimeTypeExtensions;
        this.documentPDFhref = '';
        this.hostRef = this;
    }
    /**
     * Setter for each account statement item that will be presented in table row
     */
    set item(value) {
        if (value) {
            this.documentPDF = value.documents.find(document => document.contentType === 'application/pdf');
            this.documentPDFhref = (this.documentPDF && this.getDocumentLink(this.documentPDF)) || '';
            this.itemValue = Object.assign(Object.assign({}, value), { documents: value.documents.map(document => (Object.assign(Object.assign({}, document), { url: this.getDocumentLink(document) }))) });
        }
    }
    get item() {
        return this.itemValue;
    }
    onDownloadFailure() {
        this.notificationsService.showNotification({
            header: this.downloadFailureNotificationHeader,
            message: '',
            modifier: 'error',
            ttl: this.notificationDismissTimeProperty,
        });
    }
    getDocumentLink(document) {
        return document.url || this.dataService.getAccountStatementDownloadUrl(document.uid || '');
    }
}
AccountStatementTableRowComponent._id = 0;
AccountStatementTableRowComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementTableRowComponent, deps: [{ token: i1.AccountStatementDataService }, { token: i2.NotificationService }], target: i0.ɵɵFactoryTarget.Component });
AccountStatementTableRowComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: AccountStatementTableRowComponent, selector: "tr[bb-account-statement-table-row]", inputs: { showDescription: "showDescription", showCategory: "showCategory", notificationDismissTimeProperty: "notificationDismissTimeProperty", item: "item" }, viewQueries: [{ propertyName: "downloadFailureNotificationHeader", first: true, predicate: ["downloadFailureNotificationHeader"], descendants: true }], ngImport: i0, template: "<ng-container bbAccountStatementTableRowCustomizable [bbHostRef]=\"hostRef\"></ng-container>\n\n<ng-template bbAccountStatementTableRowCustomizable let-host>\n  <div class=\"d-md-none bb-stack bb-stack--align-top\">\n    <td class=\"bb-stack__item\">\n      <div\n        class=\"bb-block bb-block--xs bb-text-semi-bold\"\n        i18n=\"Book date|Account statement table head title@@accountStatement.table.head.date.title\"\n      >\n        Book date\n      </div>\n      <div>{{ host.item.date | bbDate: 'shortDate' }}</div>\n    </td>\n\n    <bb-account-statement-view-online\n      class=\"bb-stack__item bb-stack__item--push-right\"\n      *ngIf=\"host.documentPDF\"\n      [href]=\"host.documentPDFhref\"\n      describedByElementId=\"describe-preview-by-{{ host.accountStatementTableRowId }}\"\n    ></bb-account-statement-view-online>\n\n    <bb-account-statement-downloads\n      class=\"bb-stack__item\"\n      [ngClass]=\"{ 'bb-stack__item--push-right': !host.documentPDF }\"\n      [documents]=\"host.item.documents\"\n      [mimeTypeExtensions]=\"host.mimeTypeExtensions\"\n      (downloadFailure)=\"host.onDownloadFailure()\"\n      describedByElementId=\"describe-download-by-{{ host.accountStatementTableRowId }}\"\n    ></bb-account-statement-downloads>\n  </div>\n  <td\n    class=\"d-md-table-cell d-none\"\n    [attr.colspan]=\"host.showCategory || host.showDescription ? null : 3\"\n    data-role=\"date-td\"\n  >\n    {{ host.item.date | bbDate: 'shortDate' }}\n  </td>\n  <!--If showDescription is false, it should colspan up to the description-->\n  <td *ngIf=\"host.showCategory\" [attr.colspan]=\"host.showDescription ? null : 2\" data-role=\"category-td\">\n    <div\n      class=\"bb-block bb-block--xs bb-text-semi-bold d-md-none\"\n      i18n=\"\u0421ategory|Account statement table head title@@accountStatement.table.head.category.title\"\n    >\n      Category\n    </div>\n    <div data-role=\"category-content\">{{ host.item.category }}</div>\n  </td>\n  <!--If showCategory is false, it should colspan including category-->\n  <td *ngIf=\"host.showDescription\" [attr.colspan]=\"host.showCategory ? null : 2\" data-role=\"description-td\">\n    <div\n      class=\"bb-block bb-block--xs bb-text-semi-bold d-md-none\"\n      i18n=\"Description|Account statement table head title@@accountStatement.table.row.description.title\"\n      data-role=\"description-label\"\n    >\n      Description\n    </div>\n    <div data-role=\"description-content\">{{ host.item.description }}</div>\n  </td>\n\n  <td class=\"d-md-table-cell d-none bb-text-align-center\">\n    <span\n      *ngIf=\"host.documentPDF\"\n      id=\"describe-preview-by-{{ host.accountStatementTableRowId }}\"\n      class=\"sr-only\"\n      i18n=\"Preview for|describing preview text for screen reader@@account-statement-list.preview-button.description\"\n    >\n      Preview for\n      <ng-container *ngTemplateOutlet=\"screenReaderDescription\"></ng-container>\n    </span>\n    <bb-account-statement-view-online\n      *ngIf=\"host.documentPDF\"\n      [href]=\"host.documentPDFhref\"\n      describedByElementId=\"describe-preview-by-{{ host.accountStatementTableRowId }}\"\n    ></bb-account-statement-view-online>\n  </td>\n\n  <td class=\"d-md-table-cell d-none bb-text-align-center\">\n    <span\n      i18n=\"Download for|describing download text for screen reader@@account-statement-list.download-button.description\"\n      id=\"describe-download-by-{{ host.accountStatementTableRowId }}\"\n      class=\"sr-only\"\n    >\n      {host.item.documents?.length, plural, =1 {Download\n      {{ host.mimeTypeExtensions[host.item.documents[0]?.contentType] }}} other {Show download actions} } for\n      <ng-container *ngTemplateOutlet=\"screenReaderDescription\"></ng-container>\n    </span>\n    <bb-account-statement-downloads\n      [documents]=\"host.item.documents\"\n      [mimeTypeExtensions]=\"host.mimeTypeExtensions\"\n      (downloadFailure)=\"host.onDownloadFailure()\"\n      describedByElementId=\"describe-download-by-{{ host.accountStatementTableRowId }}\"\n    ></bb-account-statement-downloads>\n  </td>\n  <ng-template #screenReaderDescription>\n    <span\n      i18n=\"\n        Category, description and book date for screen reader|describing what text is read by screen reader for download\n        or preview buttons @@account-statement-list.actions.description\"\n    >\n      {host.showCategory.toString(), select, true { 'category ' {{ host.item.category }} }} {(host.showCategory &&\n      host.showDescription).toString(), select, true { 'with description ' {{ host.item.description }} }}\n      {(!host.showCategory && host.showDescription).toString(), select, true { 'description'\n      {{ host.item.description }} }} {(host.showCategory || host.showDescription).toString(), select, true {'and'}} book\n      date {{ host.item.date | bbDate: 'fullDate' }}\n    </span>\n  </ng-template>\n</ng-template>\n\n<ng-template #downloadFailureNotificationHeader>\n  <ng-container bbAccountStatementDownloadFailureNotificationHeaderCustomizable [bbHostRef]=\"this\"> </ng-container>\n\n  <ng-template bbAccountStatementDownloadFailureNotificationHeaderCustomizable>\n    <span i18n=\"Failed to download statement@@account-statement-table-row.error-notification.header\"\n      >The statement cannot be downloaded now, please try again later</span\n    >\n  </ng-template>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i1.ӨAccountStatementViewOnlineComponent; }), selector: "bb-account-statement-view-online", inputs: ["href", "describedByElementId"] }, { type: i0.forwardRef(function () { return i1.ӨAccountStatementDownloadsComponent; }), selector: "bb-account-statement-downloads", inputs: ["documents", "mimeTypeExtensions", "describedByElementId", "tooltipPlacement"], outputs: ["downloadFailure"] }], directives: [{ type: i0.forwardRef(function () { return AccountStatementTableRowCustomizableDirective; }), selector: "[bbAccountStatementTableRowCustomizable]" }, { type: i0.forwardRef(function () { return i3.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return i3.NgClass; }), selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i0.forwardRef(function () { return i3.NgTemplateOutlet; }), selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i0.forwardRef(function () { return AccountStatementDownloadFailureNotificationHeaderCustomizableDirective; }), selector: "[bbAccountStatementDownloadFailureNotificationHeaderCustomizable]" }], pipes: { "bbDate": i0.forwardRef(function () { return i4.BbDatePipe; }) }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementTableRowComponent, decorators: [{
            type: Component,
            args: [{
                    // eslint-disable-next-line @angular-eslint/component-selector
                    selector: 'tr[bb-account-statement-table-row]',
                    templateUrl: './account-statement-table-row.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.AccountStatementDataService }, { type: i2.NotificationService }]; }, propDecorators: { showDescription: [{
                type: Input
            }], showCategory: [{
                type: Input
            }], notificationDismissTimeProperty: [{
                type: Input
            }], downloadFailureNotificationHeader: [{
                type: ViewChild,
                args: ['downloadFailureNotificationHeader']
            }], item: [{
                type: Input
            }] } });
export class AccountStatementTableRowCustomizableDirective extends BbTemplate {
}
AccountStatementTableRowCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementTableRowCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
AccountStatementTableRowCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.15", type: AccountStatementTableRowCustomizableDirective, selector: "[bbAccountStatementTableRowCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementTableRowCustomizableDirective, decorators: [{
            type: Directive,
            args: [{ selector: '[bbAccountStatementTableRowCustomizable]' }]
        }] });
export class AccountStatementDownloadFailureNotificationHeaderCustomizableDirective extends BbTemplate {
}
AccountStatementDownloadFailureNotificationHeaderCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementDownloadFailureNotificationHeaderCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
AccountStatementDownloadFailureNotificationHeaderCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.15", type: AccountStatementDownloadFailureNotificationHeaderCustomizableDirective, selector: "[bbAccountStatementDownloadFailureNotificationHeaderCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementDownloadFailureNotificationHeaderCustomizableDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[bbAccountStatementDownloadFailureNotificationHeaderCustomizable]',
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudC1zdGF0ZW1lbnQtdGFibGUtcm93LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYWNjb3VudC1zdGF0ZW1lbnQtbGlzdC13aWRnZXQtYW5nL3NyYy9jb21wb25lbnRzL2FjY291bnQtc3RhdGVtZW50LXRhYmxlLXJvdy9hY2NvdW50LXN0YXRlbWVudC10YWJsZS1yb3cuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hY2NvdW50LXN0YXRlbWVudC1saXN0LXdpZGdldC1hbmcvc3JjL2NvbXBvbmVudHMvYWNjb3VudC1zdGF0ZW1lbnQtdGFibGUtcm93L2FjY291bnQtc3RhdGVtZW50LXRhYmxlLXJvdy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTdHLE9BQU8sRUFFTCxrQkFBa0IsR0FFbkIsTUFBTSx3Q0FBd0MsQ0FBQztBQUdoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0JBQStCLENBQUM7Ozs7OztBQVMzRCxNQUFNLE9BQU8saUNBQWlDO0lBd0Q1QyxZQUNtQixXQUF3QyxFQUN4QyxvQkFBeUM7UUFEekMsZ0JBQVcsR0FBWCxXQUFXLENBQTZCO1FBQ3hDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBcUI7UUF2RDVEOztXQUVHO1FBQ00sb0JBQWUsR0FBbUIsSUFBSSxDQUFDO1FBRWhEOztXQUVHO1FBQ00saUJBQVksR0FBbUIsSUFBSSxDQUFDO1FBRTdDOztXQUVHO1FBQ00sb0NBQStCLEdBQUcsQ0FBQyxDQUFDO1FBSTdDOzs7V0FHRztRQUNNLCtCQUEwQixHQUFHLGlDQUFpQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRXJFLHVCQUFrQixHQUF1QixrQkFBa0IsQ0FBQztRQXlCckUsb0JBQWUsR0FBRyxFQUFFLENBQUM7UUFDWixZQUFPLEdBQUcsSUFBSSxDQUFDO0lBT3JCLENBQUM7SUEvQko7O09BRUc7SUFDSCxJQUNJLElBQUksQ0FBQyxLQUFtQztRQUMxQyxJQUFJLEtBQUssRUFBRTtZQUNULElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxLQUFLLGlCQUFpQixDQUFDLENBQUM7WUFDaEcsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDMUYsSUFBSSxDQUFDLFNBQVMsbUNBQ1QsS0FBSyxLQUNSLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLGlDQUN0QyxRQUFRLEtBQ1gsR0FBRyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQ25DLENBQUMsR0FDSixDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ04sT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hCLENBQUM7SUFhRCxpQkFBaUI7UUFDZixJQUFJLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUM7WUFDekMsTUFBTSxFQUFFLElBQUksQ0FBQyxpQ0FBaUM7WUFDOUMsT0FBTyxFQUFFLEVBQUU7WUFDWCxRQUFRLEVBQUUsT0FBTztZQUNqQixHQUFHLEVBQUUsSUFBSSxDQUFDLCtCQUErQjtTQUMxQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sZUFBZSxDQUFDLFFBQWtDO1FBQ3hELE9BQU8sUUFBUSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLDhCQUE4QixDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLENBQUM7SUFDN0YsQ0FBQzs7QUF2RWMscUNBQUcsR0FBRyxDQUFDLENBQUM7K0hBRFosaUNBQWlDO21IQUFqQyxpQ0FBaUMsa1lDbEI5QywweUtBcUhBLHNmRHZCYSw2Q0FBNkMsa2ZBUTdDLHNFQUFzRTs0RkFwRnRFLGlDQUFpQztrQkFON0MsU0FBUzttQkFBQztvQkFDVCw4REFBOEQ7b0JBQzlELFFBQVEsRUFBRSxvQ0FBb0M7b0JBQzlDLFdBQVcsRUFBRSw4Q0FBOEM7b0JBQzNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDtvSkFPVSxlQUFlO3NCQUF2QixLQUFLO2dCQUtHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBS0csK0JBQStCO3NCQUF2QyxLQUFLO2dCQUUwQyxpQ0FBaUM7c0JBQWhGLFNBQVM7dUJBQUMsbUNBQW1DO2dCQWMxQyxJQUFJO3NCQURQLEtBQUs7O0FBNkNSLE1BQU0sT0FBTyw2Q0FBOEMsU0FBUSxVQUdsRTs7MklBSFksNkNBQTZDOytIQUE3Qyw2Q0FBNkM7NEZBQTdDLDZDQUE2QztrQkFEekQsU0FBUzttQkFBQyxFQUFFLFFBQVEsRUFBRSwwQ0FBMEMsRUFBRTs7QUFTbkUsTUFBTSxPQUFPLHNFQUF1RSxTQUFRLFVBRzNGOztvS0FIWSxzRUFBc0U7d0pBQXRFLHNFQUFzRTs0RkFBdEUsc0VBQXNFO2tCQUhsRixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxtRUFBbUU7aUJBQzlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgRGlyZWN0aXZlLCBJbnB1dCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICBBY2NvdW50U3RhdGVtZW50RGF0YVNlcnZpY2UsXG4gIG1pbWVUeXBlRXh0ZW5zaW9ucyxcbiAgTWltZVR5cGVFeHRlbnNpb25zLFxufSBmcm9tICdAYmFja2Jhc2UvYWNjb3VudC1zdGF0ZW1lbnQtY29tbW9uLWFuZyc7XG5pbXBvcnQgeyBBY2NvdW50U3RhdGVtZW50LCBBY2NvdW50U3RhdGVtZW50RG9jdW1lbnQgfSBmcm9tICdAYmFja2Jhc2UvZGF0YS1hbmcvYWNjb3VudC1zdGF0ZW1lbnRzJztcblxuaW1wb3J0IHsgQmJUZW1wbGF0ZSB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9jb3JlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL25vdGlmaWNhdGlvbic7XG5cbkBDb21wb25lbnQoe1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ3RyW2JiLWFjY291bnQtc3RhdGVtZW50LXRhYmxlLXJvd10nLFxuICB0ZW1wbGF0ZVVybDogJy4vYWNjb3VudC1zdGF0ZW1lbnQtdGFibGUtcm93LmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEFjY291bnRTdGF0ZW1lbnRUYWJsZVJvd0NvbXBvbmVudCB7XG4gIHByaXZhdGUgc3RhdGljIF9pZCA9IDA7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgRGVzY3JpcHRpb24gY29udGVudCBpcyBwcmVzZW50ZWQgZm9yIHNwZWNpZmljIHJvdyBpbiB0aGUgYWNjb3VudCBzdGF0ZW1lbnQgbGlzdCB0YWJsZVxuICAgKi9cbiAgQElucHV0KCkgc2hvd0Rlc2NyaXB0aW9uOiBib29sZWFuIHwgbnVsbCA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgQ2F0ZWdvcnkgY29udGVudCBpcyBwcmVzZW50ZWQgZm9yIHNwZWNpZmljIHJvdyBpbiB0aGUgYWNjb3VudCBzdGF0ZW1lbnQgbGlzdCB0YWJsZVxuICAgKi9cbiAgQElucHV0KCkgc2hvd0NhdGVnb3J5OiBib29sZWFuIHwgbnVsbCA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFRpbWUgb2YgZGlzcGxheWluZyBub3RpZmljYXRpb24gYWZ0ZXIgZG93bmxvYWQgZmFpbHVyZSBpbiBtaWxsaXNlY29uZHMuXG4gICAqL1xuICBASW5wdXQoKSBub3RpZmljYXRpb25EaXNtaXNzVGltZVByb3BlcnR5ID0gMDtcblxuICBAVmlld0NoaWxkKCdkb3dubG9hZEZhaWx1cmVOb3RpZmljYXRpb25IZWFkZXInKSBkb3dubG9hZEZhaWx1cmVOb3RpZmljYXRpb25IZWFkZXIhOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKlxuICAgKiBUYWJsZSByb3cgaWQuXG4gICAqIFVzZWQgaW4gY3JlYXRpbmcgdW5pcXVlIGlkcyBmb3IgcHJldmlldyBhbmQgZG93bmxvYWQgdGV4dCBmb3IgYTExeVxuICAgKi9cbiAgcmVhZG9ubHkgYWNjb3VudFN0YXRlbWVudFRhYmxlUm93SWQgPSBBY2NvdW50U3RhdGVtZW50VGFibGVSb3dDb21wb25lbnQuX2lkKys7XG5cbiAgcmVhZG9ubHkgbWltZVR5cGVFeHRlbnNpb25zOiBNaW1lVHlwZUV4dGVuc2lvbnMgPSBtaW1lVHlwZUV4dGVuc2lvbnM7XG5cbiAgLyoqXG4gICAqIFNldHRlciBmb3IgZWFjaCBhY2NvdW50IHN0YXRlbWVudCBpdGVtIHRoYXQgd2lsbCBiZSBwcmVzZW50ZWQgaW4gdGFibGUgcm93XG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgaXRlbSh2YWx1ZTogQWNjb3VudFN0YXRlbWVudCB8IHVuZGVmaW5lZCkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5kb2N1bWVudFBERiA9IHZhbHVlLmRvY3VtZW50cy5maW5kKGRvY3VtZW50ID0+IGRvY3VtZW50LmNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgICB0aGlzLmRvY3VtZW50UERGaHJlZiA9ICh0aGlzLmRvY3VtZW50UERGICYmIHRoaXMuZ2V0RG9jdW1lbnRMaW5rKHRoaXMuZG9jdW1lbnRQREYpKSB8fCAnJztcbiAgICAgIHRoaXMuaXRlbVZhbHVlID0ge1xuICAgICAgICAuLi52YWx1ZSxcbiAgICAgICAgZG9jdW1lbnRzOiB2YWx1ZS5kb2N1bWVudHMubWFwKGRvY3VtZW50ID0+ICh7XG4gICAgICAgICAgLi4uZG9jdW1lbnQsXG4gICAgICAgICAgdXJsOiB0aGlzLmdldERvY3VtZW50TGluayhkb2N1bWVudCksXG4gICAgICAgIH0pKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgZ2V0IGl0ZW0oKTogQWNjb3VudFN0YXRlbWVudCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbVZhbHVlO1xuICB9XG5cbiAgZG9jdW1lbnRQREY6IEFjY291bnRTdGF0ZW1lbnREb2N1bWVudCB8IHVuZGVmaW5lZDtcbiAgZG9jdW1lbnRQREZocmVmID0gJyc7XG4gIHJlYWRvbmx5IGhvc3RSZWYgPSB0aGlzO1xuXG4gIHByaXZhdGUgaXRlbVZhbHVlOiBBY2NvdW50U3RhdGVtZW50IHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGF0YVNlcnZpY2U6IEFjY291bnRTdGF0ZW1lbnREYXRhU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvbnNTZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLFxuICApIHt9XG5cbiAgb25Eb3dubG9hZEZhaWx1cmUoKSB7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgIGhlYWRlcjogdGhpcy5kb3dubG9hZEZhaWx1cmVOb3RpZmljYXRpb25IZWFkZXIsXG4gICAgICBtZXNzYWdlOiAnJyxcbiAgICAgIG1vZGlmaWVyOiAnZXJyb3InLFxuICAgICAgdHRsOiB0aGlzLm5vdGlmaWNhdGlvbkRpc21pc3NUaW1lUHJvcGVydHksXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldERvY3VtZW50TGluayhkb2N1bWVudDogQWNjb3VudFN0YXRlbWVudERvY3VtZW50KTogc3RyaW5nIHtcbiAgICByZXR1cm4gZG9jdW1lbnQudXJsIHx8IHRoaXMuZGF0YVNlcnZpY2UuZ2V0QWNjb3VudFN0YXRlbWVudERvd25sb2FkVXJsKGRvY3VtZW50LnVpZCB8fCAnJyk7XG4gIH1cbn1cblxuQERpcmVjdGl2ZSh7IHNlbGVjdG9yOiAnW2JiQWNjb3VudFN0YXRlbWVudFRhYmxlUm93Q3VzdG9taXphYmxlXScgfSlcbmV4cG9ydCBjbGFzcyBBY2NvdW50U3RhdGVtZW50VGFibGVSb3dDdXN0b21pemFibGVEaXJlY3RpdmUgZXh0ZW5kcyBCYlRlbXBsYXRlPFxuICBBY2NvdW50U3RhdGVtZW50VGFibGVSb3dDb21wb25lbnQsXG4gIHZvaWRcbj4ge31cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2JiQWNjb3VudFN0YXRlbWVudERvd25sb2FkRmFpbHVyZU5vdGlmaWNhdGlvbkhlYWRlckN1c3RvbWl6YWJsZV0nLFxufSlcbmV4cG9ydCBjbGFzcyBBY2NvdW50U3RhdGVtZW50RG93bmxvYWRGYWlsdXJlTm90aWZpY2F0aW9uSGVhZGVyQ3VzdG9taXphYmxlRGlyZWN0aXZlIGV4dGVuZHMgQmJUZW1wbGF0ZTxcbiAgQWNjb3VudFN0YXRlbWVudFRhYmxlUm93Q29tcG9uZW50LFxuICB2b2lkXG4+IHt9XG4iLCI8bmctY29udGFpbmVyIGJiQWNjb3VudFN0YXRlbWVudFRhYmxlUm93Q3VzdG9taXphYmxlIFtiYkhvc3RSZWZdPVwiaG9zdFJlZlwiPjwvbmctY29udGFpbmVyPlxuXG48bmctdGVtcGxhdGUgYmJBY2NvdW50U3RhdGVtZW50VGFibGVSb3dDdXN0b21pemFibGUgbGV0LWhvc3Q+XG4gIDxkaXYgY2xhc3M9XCJkLW1kLW5vbmUgYmItc3RhY2sgYmItc3RhY2stLWFsaWduLXRvcFwiPlxuICAgIDx0ZCBjbGFzcz1cImJiLXN0YWNrX19pdGVtXCI+XG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLXhzIGJiLXRleHQtc2VtaS1ib2xkXCJcbiAgICAgICAgaTE4bj1cIkJvb2sgZGF0ZXxBY2NvdW50IHN0YXRlbWVudCB0YWJsZSBoZWFkIHRpdGxlQEBhY2NvdW50U3RhdGVtZW50LnRhYmxlLmhlYWQuZGF0ZS50aXRsZVwiXG4gICAgICA+XG4gICAgICAgIEJvb2sgZGF0ZVxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2Pnt7IGhvc3QuaXRlbS5kYXRlIHwgYmJEYXRlOiAnc2hvcnREYXRlJyB9fTwvZGl2PlxuICAgIDwvdGQ+XG5cbiAgICA8YmItYWNjb3VudC1zdGF0ZW1lbnQtdmlldy1vbmxpbmVcbiAgICAgIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW0gYmItc3RhY2tfX2l0ZW0tLXB1c2gtcmlnaHRcIlxuICAgICAgKm5nSWY9XCJob3N0LmRvY3VtZW50UERGXCJcbiAgICAgIFtocmVmXT1cImhvc3QuZG9jdW1lbnRQREZocmVmXCJcbiAgICAgIGRlc2NyaWJlZEJ5RWxlbWVudElkPVwiZGVzY3JpYmUtcHJldmlldy1ieS17eyBob3N0LmFjY291bnRTdGF0ZW1lbnRUYWJsZVJvd0lkIH19XCJcbiAgICA+PC9iYi1hY2NvdW50LXN0YXRlbWVudC12aWV3LW9ubGluZT5cblxuICAgIDxiYi1hY2NvdW50LXN0YXRlbWVudC1kb3dubG9hZHNcbiAgICAgIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW1cIlxuICAgICAgW25nQ2xhc3NdPVwieyAnYmItc3RhY2tfX2l0ZW0tLXB1c2gtcmlnaHQnOiAhaG9zdC5kb2N1bWVudFBERiB9XCJcbiAgICAgIFtkb2N1bWVudHNdPVwiaG9zdC5pdGVtLmRvY3VtZW50c1wiXG4gICAgICBbbWltZVR5cGVFeHRlbnNpb25zXT1cImhvc3QubWltZVR5cGVFeHRlbnNpb25zXCJcbiAgICAgIChkb3dubG9hZEZhaWx1cmUpPVwiaG9zdC5vbkRvd25sb2FkRmFpbHVyZSgpXCJcbiAgICAgIGRlc2NyaWJlZEJ5RWxlbWVudElkPVwiZGVzY3JpYmUtZG93bmxvYWQtYnkte3sgaG9zdC5hY2NvdW50U3RhdGVtZW50VGFibGVSb3dJZCB9fVwiXG4gICAgPjwvYmItYWNjb3VudC1zdGF0ZW1lbnQtZG93bmxvYWRzPlxuICA8L2Rpdj5cbiAgPHRkXG4gICAgY2xhc3M9XCJkLW1kLXRhYmxlLWNlbGwgZC1ub25lXCJcbiAgICBbYXR0ci5jb2xzcGFuXT1cImhvc3Quc2hvd0NhdGVnb3J5IHx8IGhvc3Quc2hvd0Rlc2NyaXB0aW9uID8gbnVsbCA6IDNcIlxuICAgIGRhdGEtcm9sZT1cImRhdGUtdGRcIlxuICA+XG4gICAge3sgaG9zdC5pdGVtLmRhdGUgfCBiYkRhdGU6ICdzaG9ydERhdGUnIH19XG4gIDwvdGQ+XG4gIDwhLS1JZiBzaG93RGVzY3JpcHRpb24gaXMgZmFsc2UsIGl0IHNob3VsZCBjb2xzcGFuIHVwIHRvIHRoZSBkZXNjcmlwdGlvbi0tPlxuICA8dGQgKm5nSWY9XCJob3N0LnNob3dDYXRlZ29yeVwiIFthdHRyLmNvbHNwYW5dPVwiaG9zdC5zaG93RGVzY3JpcHRpb24gPyBudWxsIDogMlwiIGRhdGEtcm9sZT1cImNhdGVnb3J5LXRkXCI+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0teHMgYmItdGV4dC1zZW1pLWJvbGQgZC1tZC1ub25lXCJcbiAgICAgIGkxOG49XCLQoWF0ZWdvcnl8QWNjb3VudCBzdGF0ZW1lbnQgdGFibGUgaGVhZCB0aXRsZUBAYWNjb3VudFN0YXRlbWVudC50YWJsZS5oZWFkLmNhdGVnb3J5LnRpdGxlXCJcbiAgICA+XG4gICAgICBDYXRlZ29yeVxuICAgIDwvZGl2PlxuICAgIDxkaXYgZGF0YS1yb2xlPVwiY2F0ZWdvcnktY29udGVudFwiPnt7IGhvc3QuaXRlbS5jYXRlZ29yeSB9fTwvZGl2PlxuICA8L3RkPlxuICA8IS0tSWYgc2hvd0NhdGVnb3J5IGlzIGZhbHNlLCBpdCBzaG91bGQgY29sc3BhbiBpbmNsdWRpbmcgY2F0ZWdvcnktLT5cbiAgPHRkICpuZ0lmPVwiaG9zdC5zaG93RGVzY3JpcHRpb25cIiBbYXR0ci5jb2xzcGFuXT1cImhvc3Quc2hvd0NhdGVnb3J5ID8gbnVsbCA6IDJcIiBkYXRhLXJvbGU9XCJkZXNjcmlwdGlvbi10ZFwiPlxuICAgIDxkaXZcbiAgICAgIGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLXhzIGJiLXRleHQtc2VtaS1ib2xkIGQtbWQtbm9uZVwiXG4gICAgICBpMThuPVwiRGVzY3JpcHRpb258QWNjb3VudCBzdGF0ZW1lbnQgdGFibGUgaGVhZCB0aXRsZUBAYWNjb3VudFN0YXRlbWVudC50YWJsZS5yb3cuZGVzY3JpcHRpb24udGl0bGVcIlxuICAgICAgZGF0YS1yb2xlPVwiZGVzY3JpcHRpb24tbGFiZWxcIlxuICAgID5cbiAgICAgIERlc2NyaXB0aW9uXG4gICAgPC9kaXY+XG4gICAgPGRpdiBkYXRhLXJvbGU9XCJkZXNjcmlwdGlvbi1jb250ZW50XCI+e3sgaG9zdC5pdGVtLmRlc2NyaXB0aW9uIH19PC9kaXY+XG4gIDwvdGQ+XG5cbiAgPHRkIGNsYXNzPVwiZC1tZC10YWJsZS1jZWxsIGQtbm9uZSBiYi10ZXh0LWFsaWduLWNlbnRlclwiPlxuICAgIDxzcGFuXG4gICAgICAqbmdJZj1cImhvc3QuZG9jdW1lbnRQREZcIlxuICAgICAgaWQ9XCJkZXNjcmliZS1wcmV2aWV3LWJ5LXt7IGhvc3QuYWNjb3VudFN0YXRlbWVudFRhYmxlUm93SWQgfX1cIlxuICAgICAgY2xhc3M9XCJzci1vbmx5XCJcbiAgICAgIGkxOG49XCJQcmV2aWV3IGZvcnxkZXNjcmliaW5nIHByZXZpZXcgdGV4dCBmb3Igc2NyZWVuIHJlYWRlckBAYWNjb3VudC1zdGF0ZW1lbnQtbGlzdC5wcmV2aWV3LWJ1dHRvbi5kZXNjcmlwdGlvblwiXG4gICAgPlxuICAgICAgUHJldmlldyBmb3JcbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJzY3JlZW5SZWFkZXJEZXNjcmlwdGlvblwiPjwvbmctY29udGFpbmVyPlxuICAgIDwvc3Bhbj5cbiAgICA8YmItYWNjb3VudC1zdGF0ZW1lbnQtdmlldy1vbmxpbmVcbiAgICAgICpuZ0lmPVwiaG9zdC5kb2N1bWVudFBERlwiXG4gICAgICBbaHJlZl09XCJob3N0LmRvY3VtZW50UERGaHJlZlwiXG4gICAgICBkZXNjcmliZWRCeUVsZW1lbnRJZD1cImRlc2NyaWJlLXByZXZpZXctYnkte3sgaG9zdC5hY2NvdW50U3RhdGVtZW50VGFibGVSb3dJZCB9fVwiXG4gICAgPjwvYmItYWNjb3VudC1zdGF0ZW1lbnQtdmlldy1vbmxpbmU+XG4gIDwvdGQ+XG5cbiAgPHRkIGNsYXNzPVwiZC1tZC10YWJsZS1jZWxsIGQtbm9uZSBiYi10ZXh0LWFsaWduLWNlbnRlclwiPlxuICAgIDxzcGFuXG4gICAgICBpMThuPVwiRG93bmxvYWQgZm9yfGRlc2NyaWJpbmcgZG93bmxvYWQgdGV4dCBmb3Igc2NyZWVuIHJlYWRlckBAYWNjb3VudC1zdGF0ZW1lbnQtbGlzdC5kb3dubG9hZC1idXR0b24uZGVzY3JpcHRpb25cIlxuICAgICAgaWQ9XCJkZXNjcmliZS1kb3dubG9hZC1ieS17eyBob3N0LmFjY291bnRTdGF0ZW1lbnRUYWJsZVJvd0lkIH19XCJcbiAgICAgIGNsYXNzPVwic3Itb25seVwiXG4gICAgPlxuICAgICAge2hvc3QuaXRlbS5kb2N1bWVudHM/Lmxlbmd0aCwgcGx1cmFsLCA9MSB7RG93bmxvYWRcbiAgICAgIHt7IGhvc3QubWltZVR5cGVFeHRlbnNpb25zW2hvc3QuaXRlbS5kb2N1bWVudHNbMF0/LmNvbnRlbnRUeXBlXSB9fX0gb3RoZXIge1Nob3cgZG93bmxvYWQgYWN0aW9uc30gfSBmb3JcbiAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJzY3JlZW5SZWFkZXJEZXNjcmlwdGlvblwiPjwvbmctY29udGFpbmVyPlxuICAgIDwvc3Bhbj5cbiAgICA8YmItYWNjb3VudC1zdGF0ZW1lbnQtZG93bmxvYWRzXG4gICAgICBbZG9jdW1lbnRzXT1cImhvc3QuaXRlbS5kb2N1bWVudHNcIlxuICAgICAgW21pbWVUeXBlRXh0ZW5zaW9uc109XCJob3N0Lm1pbWVUeXBlRXh0ZW5zaW9uc1wiXG4gICAgICAoZG93bmxvYWRGYWlsdXJlKT1cImhvc3Qub25Eb3dubG9hZEZhaWx1cmUoKVwiXG4gICAgICBkZXNjcmliZWRCeUVsZW1lbnRJZD1cImRlc2NyaWJlLWRvd25sb2FkLWJ5LXt7IGhvc3QuYWNjb3VudFN0YXRlbWVudFRhYmxlUm93SWQgfX1cIlxuICAgID48L2JiLWFjY291bnQtc3RhdGVtZW50LWRvd25sb2Fkcz5cbiAgPC90ZD5cbiAgPG5nLXRlbXBsYXRlICNzY3JlZW5SZWFkZXJEZXNjcmlwdGlvbj5cbiAgICA8c3BhblxuICAgICAgaTE4bj1cIlxuICAgICAgICBDYXRlZ29yeSwgZGVzY3JpcHRpb24gYW5kIGJvb2sgZGF0ZSBmb3Igc2NyZWVuIHJlYWRlcnxkZXNjcmliaW5nIHdoYXQgdGV4dCBpcyByZWFkIGJ5IHNjcmVlbiByZWFkZXIgZm9yIGRvd25sb2FkXG4gICAgICAgIG9yIHByZXZpZXcgYnV0dG9ucyBAQGFjY291bnQtc3RhdGVtZW50LWxpc3QuYWN0aW9ucy5kZXNjcmlwdGlvblwiXG4gICAgPlxuICAgICAge2hvc3Quc2hvd0NhdGVnb3J5LnRvU3RyaW5nKCksIHNlbGVjdCwgdHJ1ZSB7ICdjYXRlZ29yeSAnIHt7IGhvc3QuaXRlbS5jYXRlZ29yeSB9fSB9fSB7KGhvc3Quc2hvd0NhdGVnb3J5ICYmXG4gICAgICBob3N0LnNob3dEZXNjcmlwdGlvbikudG9TdHJpbmcoKSwgc2VsZWN0LCB0cnVlIHsgJ3dpdGggZGVzY3JpcHRpb24gJyB7eyBob3N0Lml0ZW0uZGVzY3JpcHRpb24gfX0gfX1cbiAgICAgIHsoIWhvc3Quc2hvd0NhdGVnb3J5ICYmIGhvc3Quc2hvd0Rlc2NyaXB0aW9uKS50b1N0cmluZygpLCBzZWxlY3QsIHRydWUgeyAnZGVzY3JpcHRpb24nXG4gICAgICB7eyBob3N0Lml0ZW0uZGVzY3JpcHRpb24gfX0gfX0geyhob3N0LnNob3dDYXRlZ29yeSB8fCBob3N0LnNob3dEZXNjcmlwdGlvbikudG9TdHJpbmcoKSwgc2VsZWN0LCB0cnVlIHsnYW5kJ319IGJvb2tcbiAgICAgIGRhdGUge3sgaG9zdC5pdGVtLmRhdGUgfCBiYkRhdGU6ICdmdWxsRGF0ZScgfX1cbiAgICA8L3NwYW4+XG4gIDwvbmctdGVtcGxhdGU+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI2Rvd25sb2FkRmFpbHVyZU5vdGlmaWNhdGlvbkhlYWRlcj5cbiAgPG5nLWNvbnRhaW5lciBiYkFjY291bnRTdGF0ZW1lbnREb3dubG9hZEZhaWx1cmVOb3RpZmljYXRpb25IZWFkZXJDdXN0b21pemFibGUgW2JiSG9zdFJlZl09XCJ0aGlzXCI+IDwvbmctY29udGFpbmVyPlxuXG4gIDxuZy10ZW1wbGF0ZSBiYkFjY291bnRTdGF0ZW1lbnREb3dubG9hZEZhaWx1cmVOb3RpZmljYXRpb25IZWFkZXJDdXN0b21pemFibGU+XG4gICAgPHNwYW4gaTE4bj1cIkZhaWxlZCB0byBkb3dubG9hZCBzdGF0ZW1lbnRAQGFjY291bnQtc3RhdGVtZW50LXRhYmxlLXJvdy5lcnJvci1ub3RpZmljYXRpb24uaGVhZGVyXCJcbiAgICAgID5UaGUgc3RhdGVtZW50IGNhbm5vdCBiZSBkb3dubG9hZGVkIG5vdywgcGxlYXNlIHRyeSBhZ2FpbiBsYXRlcjwvc3BhblxuICAgID5cbiAgPC9uZy10ZW1wbGF0ZT5cbjwvbmctdGVtcGxhdGU+XG4iXX0=