import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';
import { DEFAULT_UI_LEVELS_CONFIG, DEFAULT_UI_PERMISSIONS_CONFIG } from '../constants';
import { AuthorizedPermissionLevel, } from '../model/authorized-users.model';
import { LevelsMappingConfigImplementation } from './default-level-mapping-config.service';
import { first, switchMap, catchError } from 'rxjs/operators';
import { of } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@backbase/foundation-ang/core";
export const levelsMappingConfigToken = new InjectionToken('level injection token');
export class UsersUIService {
    constructor(
    // eslint-disable-next-line
    levelsConfig, http, assetsService) {
        var _a, _b, _c, _d, _e;
        this.levelsConfig = levelsConfig;
        this.http = http;
        this.assetsService = assetsService;
        this.authorizedPermissionLevel = [
            AuthorizedPermissionLevel.VIEW_ONLY,
            AuthorizedPermissionLevel.MONEY_MOVEMENT,
            AuthorizedPermissionLevel.FULL_ACCESS,
        ];
        this.getURIFromTxtAssetID = (assetId) => `${assetId}.txt`;
        // eslint-disable-next-line @typescript-eslint/member-ordering
        this.resolveTxtAsset = this.assetsService.createAssetsResolver({
            widgetName: 'bb-authorized-users-journey-ang',
            getURIFromAssetID: this.getURIFromTxtAssetID,
        });
        this.fetchFile = (fileLocation) => {
            return this.http.get(fileLocation, { responseType: 'text' });
        };
        this.statusMapping = ((_a = this === null || this === void 0 ? void 0 : this.levelsConfig) === null || _a === void 0 ? void 0 : _a.mappings)
            ? this.levelsConfig.mappings
            : new LevelsMappingConfigImplementation();
        const mapLevels = (value, index) => (Object.assign(Object.assign({}, value), { level: this.authorizedPermissionLevel[index], validate() {
                return this.level !== AuthorizedPermissionLevel.FULL_ACCESS;
            } }));
        this.uiLevelsConfig = ((_c = (_b = this === null || this === void 0 ? void 0 : this.levelsConfig) === null || _b === void 0 ? void 0 : _b.uiConfig) === null || _c === void 0 ? void 0 : _c.levels)
            ? this.levelsConfig.uiConfig.levels.map(mapLevels)
            : DEFAULT_UI_LEVELS_CONFIG.levels.map(mapLevels);
        this.uiPermissionsConfig = ((_e = (_d = this === null || this === void 0 ? void 0 : this.levelsConfig) === null || _d === void 0 ? void 0 : _d.uiConfig) === null || _e === void 0 ? void 0 : _e.permissions)
            ? { permissions: this.levelsConfig.uiConfig.permissions }
            : DEFAULT_UI_PERMISSIONS_CONFIG;
    }
    get uiLevelsConfigValue() {
        return this.uiLevelsConfig;
    }
    get uiPermissionsConfigValue() {
        return this.uiPermissionsConfig;
    }
    get statusMappingValue() {
        return this.statusMapping;
    }
    get termsConditionsUrl() {
        return this.resolveTxtAsset('terms-and-conditions');
    }
    termsConditionsContent() {
        return this.termsConditionsUrl.pipe(first(), switchMap(this.fetchFile), catchError(() => {
            console.warn('No terms and conditions file was found');
            return of('');
        }));
    }
}
UsersUIService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: UsersUIService, deps: [{ token: levelsMappingConfigToken, optional: true }, { token: i1.HttpClient }, { token: i2.AssetsService }], target: i0.ɵɵFactoryTarget.Injectable });
UsersUIService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: UsersUIService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: UsersUIService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [levelsMappingConfigToken]
                }, {
                    type: Optional
                }] }, { type: i1.HttpClient }, { type: i2.AssetsService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcnMtdWkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYXV0aG9yaXplZC11c2Vycy1qb3VybmV5L3NyYy9jb21tb24vc2VydmljZXMvdXNlcnMtdWkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN2RixPQUFPLEVBQ0wseUJBQXlCLEdBTzFCLE1BQU0saUNBQWlDLENBQUM7QUFDekMsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDM0YsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztBQUd0QyxNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLGNBQWMsQ0FBc0IsdUJBQXVCLENBQUMsQ0FBQztBQUV6RyxNQUFNLE9BQU8sY0FBYztJQStDekI7SUFDRSwyQkFBMkI7SUFHbkIsWUFBb0UsRUFDM0QsSUFBZ0IsRUFDaEIsYUFBNEI7O1FBRnJDLGlCQUFZLEdBQVosWUFBWSxDQUF3RDtRQUMzRCxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBakQ5Qiw4QkFBeUIsR0FBRztZQUMzQyx5QkFBeUIsQ0FBQyxTQUFTO1lBQ25DLHlCQUF5QixDQUFDLGNBQWM7WUFDeEMseUJBQXlCLENBQUMsV0FBVztTQUN0QyxDQUFDO1FBQ2UseUJBQW9CLEdBQUcsQ0FBQyxPQUFlLEVBQUUsRUFBRSxDQUFDLEdBQUcsT0FBTyxNQUFNLENBQUM7UUFDOUUsOERBQThEO1FBQzdDLG9CQUFlLEdBQW1CLElBQUksQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUM7WUFDekYsVUFBVSxFQUFFLGlDQUFpQztZQUM3QyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsb0JBQW9CO1NBQzdDLENBQUMsQ0FBQztRQWtCSyxjQUFTLEdBQUcsQ0FBQyxZQUFvQixFQUFFLEVBQUU7WUFDM0MsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUM7UUFxQkEsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFBLE1BQUEsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLFlBQVksMENBQUUsUUFBUTtZQUMvQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRO1lBQzVCLENBQUMsQ0FBQyxJQUFJLGlDQUFpQyxFQUFFLENBQUM7UUFFNUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxLQUFtQyxFQUFFLEtBQWEsRUFBc0MsRUFBRSxDQUFDLGlDQUN6RyxLQUFLLEtBQ1IsS0FBSyxFQUFFLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsRUFDNUMsUUFBUTtnQkFDTixPQUFPLElBQUksQ0FBQyxLQUFLLEtBQUsseUJBQXlCLENBQUMsV0FBVyxDQUFDO1lBQzlELENBQUMsSUFDRCxDQUFDO1FBRUgsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFBLE1BQUEsTUFBQSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsWUFBWSwwQ0FBRSxRQUFRLDBDQUFFLE1BQU07WUFDeEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO1lBQ2xELENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxDQUFBLE1BQUEsTUFBQSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsWUFBWSwwQ0FBRSxRQUFRLDBDQUFFLFdBQVc7WUFDbEUsQ0FBQyxDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRTtZQUN6RCxDQUFDLENBQUMsNkJBQTZCLENBQUM7SUFDcEMsQ0FBQztJQXpERCxJQUFJLG1CQUFtQjtRQUNyQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUVELElBQUksd0JBQXdCO1FBQzFCLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQ2xDLENBQUM7SUFFRCxJQUFJLGtCQUFrQjtRQUNwQixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDNUIsQ0FBQztJQUVELElBQVksa0JBQWtCO1FBQzVCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFNRCxzQkFBc0I7UUFDcEIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUNqQyxLQUFLLEVBQUUsRUFDUCxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUN6QixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1lBQ3ZELE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOzs0R0E3Q1UsY0FBYyxrQkFpRGYsd0JBQXdCO2dIQWpEdkIsY0FBYzs0RkFBZCxjQUFjO2tCQUQxQixVQUFVOzswQkFrRE4sTUFBTTsyQkFBQyx3QkFBd0I7OzBCQUMvQixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERFRkFVTFRfVUlfTEVWRUxTX0NPTkZJRywgREVGQVVMVF9VSV9QRVJNSVNTSU9OU19DT05GSUcgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgQXV0aG9yaXplZFBlcm1pc3Npb25MZXZlbCxcbiAgTGV2ZWxzQ29uZmlnLFxuICBMZXZlbHNNYXBwaW5nQ29uZmlnLFxuICBMZXZlbFVJQ29uZmlnLFxuICBMZXZlbFVJQ29uZmlnSGVhZGVyLFxuICBQZXJtaXNzaW9uVUlDb25maWcsXG4gIFNhZmVUeXBlQXJyYXksXG59IGZyb20gJy4uL21vZGVsL2F1dGhvcml6ZWQtdXNlcnMubW9kZWwnO1xuaW1wb3J0IHsgTGV2ZWxzTWFwcGluZ0NvbmZpZ0ltcGxlbWVudGF0aW9uIH0gZnJvbSAnLi9kZWZhdWx0LWxldmVsLW1hcHBpbmctY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgZmlyc3QsIHN3aXRjaE1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQXNzZXRzUmVzb2x2ZXIsIEFzc2V0c1NlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvY29yZSc7XG5leHBvcnQgY29uc3QgbGV2ZWxzTWFwcGluZ0NvbmZpZ1Rva2VuID0gbmV3IEluamVjdGlvblRva2VuPExldmVsc01hcHBpbmdDb25maWc+KCdsZXZlbCBpbmplY3Rpb24gdG9rZW4nKTtcbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBVc2Vyc1VJU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhdHVzTWFwcGluZzogTGV2ZWxzTWFwcGluZ0NvbmZpZztcbiAgcHJpdmF0ZSByZWFkb25seSB1aUxldmVsc0NvbmZpZzogQXJyYXk8TGV2ZWxVSUNvbmZpZ0hlYWRlcjxTYWZlVHlwZUFycmF5Pj4gfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgcmVhZG9ubHkgdWlQZXJtaXNzaW9uc0NvbmZpZzogUGVybWlzc2lvblVJQ29uZmlnPFNhZmVUeXBlQXJyYXk+IHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHJlYWRvbmx5IGF1dGhvcml6ZWRQZXJtaXNzaW9uTGV2ZWwgPSBbXG4gICAgQXV0aG9yaXplZFBlcm1pc3Npb25MZXZlbC5WSUVXX09OTFksXG4gICAgQXV0aG9yaXplZFBlcm1pc3Npb25MZXZlbC5NT05FWV9NT1ZFTUVOVCxcbiAgICBBdXRob3JpemVkUGVybWlzc2lvbkxldmVsLkZVTExfQUNDRVNTLFxuICBdO1xuICBwcml2YXRlIHJlYWRvbmx5IGdldFVSSUZyb21UeHRBc3NldElEID0gKGFzc2V0SWQ6IHN0cmluZykgPT4gYCR7YXNzZXRJZH0udHh0YDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9tZW1iZXItb3JkZXJpbmdcbiAgcHJpdmF0ZSByZWFkb25seSByZXNvbHZlVHh0QXNzZXQ6IEFzc2V0c1Jlc29sdmVyID0gdGhpcy5hc3NldHNTZXJ2aWNlLmNyZWF0ZUFzc2V0c1Jlc29sdmVyKHtcbiAgICB3aWRnZXROYW1lOiAnYmItYXV0aG9yaXplZC11c2Vycy1qb3VybmV5LWFuZycsXG4gICAgZ2V0VVJJRnJvbUFzc2V0SUQ6IHRoaXMuZ2V0VVJJRnJvbVR4dEFzc2V0SUQsXG4gIH0pO1xuXG4gIGdldCB1aUxldmVsc0NvbmZpZ1ZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnVpTGV2ZWxzQ29uZmlnO1xuICB9XG5cbiAgZ2V0IHVpUGVybWlzc2lvbnNDb25maWdWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy51aVBlcm1pc3Npb25zQ29uZmlnO1xuICB9XG5cbiAgZ2V0IHN0YXR1c01hcHBpbmdWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0dXNNYXBwaW5nO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgdGVybXNDb25kaXRpb25zVXJsKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMucmVzb2x2ZVR4dEFzc2V0KCd0ZXJtcy1hbmQtY29uZGl0aW9ucycpO1xuICB9XG5cbiAgcHJpdmF0ZSBmZXRjaEZpbGUgPSAoZmlsZUxvY2F0aW9uOiBzdHJpbmcpID0+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChmaWxlTG9jYXRpb24sIHsgcmVzcG9uc2VUeXBlOiAndGV4dCcgfSk7XG4gIH07XG5cbiAgdGVybXNDb25kaXRpb25zQ29udGVudCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLnRlcm1zQ29uZGl0aW9uc1VybC5waXBlKFxuICAgICAgZmlyc3QoKSxcbiAgICAgIHN3aXRjaE1hcCh0aGlzLmZldGNoRmlsZSksXG4gICAgICBjYXRjaEVycm9yKCgpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKCdObyB0ZXJtcyBhbmQgY29uZGl0aW9ucyBmaWxlIHdhcyBmb3VuZCcpO1xuICAgICAgICByZXR1cm4gb2YoJycpO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgIEBJbmplY3QobGV2ZWxzTWFwcGluZ0NvbmZpZ1Rva2VuKVxuICAgIEBPcHRpb25hbCgpXG4gICAgcHJpdmF0ZSBsZXZlbHNDb25maWc6IExldmVsc0NvbmZpZzxTYWZlVHlwZUFycmF5LCBTYWZlVHlwZUFycmF5PiB8IHVuZGVmaW5lZCxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSByZWFkb25seSBhc3NldHNTZXJ2aWNlOiBBc3NldHNTZXJ2aWNlLFxuICApIHtcbiAgICB0aGlzLnN0YXR1c01hcHBpbmcgPSB0aGlzPy5sZXZlbHNDb25maWc/Lm1hcHBpbmdzXG4gICAgICA/IHRoaXMubGV2ZWxzQ29uZmlnLm1hcHBpbmdzXG4gICAgICA6IG5ldyBMZXZlbHNNYXBwaW5nQ29uZmlnSW1wbGVtZW50YXRpb24oKTtcblxuICAgIGNvbnN0IG1hcExldmVscyA9ICh2YWx1ZTogTGV2ZWxVSUNvbmZpZzxTYWZlVHlwZUFycmF5PiwgaW5kZXg6IG51bWJlcik6IExldmVsVUlDb25maWdIZWFkZXI8U2FmZVR5cGVBcnJheT4gPT4gKHtcbiAgICAgIC4uLnZhbHVlLFxuICAgICAgbGV2ZWw6IHRoaXMuYXV0aG9yaXplZFBlcm1pc3Npb25MZXZlbFtpbmRleF0sXG4gICAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGV2ZWwgIT09IEF1dGhvcml6ZWRQZXJtaXNzaW9uTGV2ZWwuRlVMTF9BQ0NFU1M7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy51aUxldmVsc0NvbmZpZyA9IHRoaXM/LmxldmVsc0NvbmZpZz8udWlDb25maWc/LmxldmVsc1xuICAgICAgPyB0aGlzLmxldmVsc0NvbmZpZy51aUNvbmZpZy5sZXZlbHMubWFwKG1hcExldmVscylcbiAgICAgIDogREVGQVVMVF9VSV9MRVZFTFNfQ09ORklHLmxldmVscy5tYXAobWFwTGV2ZWxzKTtcbiAgICB0aGlzLnVpUGVybWlzc2lvbnNDb25maWcgPSB0aGlzPy5sZXZlbHNDb25maWc/LnVpQ29uZmlnPy5wZXJtaXNzaW9uc1xuICAgICAgPyB7IHBlcm1pc3Npb25zOiB0aGlzLmxldmVsc0NvbmZpZy51aUNvbmZpZy5wZXJtaXNzaW9ucyB9XG4gICAgICA6IERFRkFVTFRfVUlfUEVSTUlTU0lPTlNfQ09ORklHO1xuICB9XG59XG4iXX0=