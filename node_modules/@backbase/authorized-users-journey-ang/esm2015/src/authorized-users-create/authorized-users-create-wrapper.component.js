import { Component, Output, EventEmitter, Input } from '@angular/core';
import { BehaviorSubject, ReplaySubject, merge, of, combineLatest } from 'rxjs';
import { catchError, map, switchMap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../common/services/user-data.service";
import * as i2 from "../common/services/users-ui.service";
import * as i3 from "@backbase/foundation-ang/core";
import * as i4 from "./components/authorized-users-stepper/authorized-users-stepper.component";
import * as i5 from "./components/authorized-users-stepper/authorized-users-edit-stepper.component";
import * as i6 from "./components/authorized-users-create-container/authorized-users-create-container.component";
import * as i7 from "./components/authorized-users-user-details/authorized-users-user-details.component";
import * as i8 from "./components/authorized-users-accounts/authorized-users-accounts.component";
import * as i9 from "./components/authorized-users-permissions/authorized-users-permissions.component";
import * as i10 from "./components/authorized-users-confirmation/authorized-users-confirmation.component";
import * as i11 from "./components/authorized-users-confirmation-complete/authorized-users-confirmation-complete.component";
import * as i12 from "./components/authorized-users-cancel-creation/authorized-users-cancel-creation.component";
import * as i13 from "@backbase/ui-ang/loading-indicator";
import * as i14 from "@backbase/ui-ang/empty-state";
import * as i15 from "@angular/common";
import * as i16 from "./components/authorized-users-create-common/authorized-users-step-handler.directive";
export var AuthorizedUserPermissionControlType;
(function (AuthorizedUserPermissionControlType) {
    AuthorizedUserPermissionControlType["INDIVIDUAL_CONTROL"] = "individual-control";
    AuthorizedUserPermissionControlType["ALL_AT_ONCE"] = "all-at-once";
})(AuthorizedUserPermissionControlType || (AuthorizedUserPermissionControlType = {}));
export class AuthorizedUsersCreateWrapperComponent {
    constructor(userService, usersUIService, assetsService, cd) {
        this.userService = userService;
        this.usersUIService = usersUIService;
        this.assetsService = assetsService;
        this.cd = cd;
        this.currentStep = 1;
        this.isAborting = false;
        this.succeedStatus = '';
        this.isFailure = false;
        this.isSaving = false;
        this.showAuthorizedUsers = new EventEmitter();
        this.currentUserStore = new BehaviorSubject({});
        this.changesStore = new BehaviorSubject({});
        this.selectedEditUserStore = new ReplaySubject();
        this.authorizedUser = this.currentUserStore.asObservable();
        this.enableAccountLevelFullAccessPermissionSubject = new BehaviorSubject(undefined);
        this.getURIFromSvgAssetID = (assetId) => `${assetId}.svg`;
        // eslint-disable-next-line @typescript-eslint/member-ordering
        this.resolveSvgAsset = this.assetsService.createAssetsResolver({
            widgetName: 'bb-authorized-users-journey-ang',
            getURIFromAssetID: this.getURIFromSvgAssetID,
        });
        this.goToAuthorizedUsersList = () => {
            this.showAuthorizedUsers.emit();
        };
        this.levelsConfig = this.usersUIService.uiLevelsConfigValue;
        this.permissionsConfig = this.usersUIService.uiPermissionsConfigValue;
        merge(this.changesStore, this.selectedEditUserStore).subscribe(this.currentUserStore);
    }
    set enableAccountLevelFullAccessPermissionValue(value) {
        this.enableAccountLevelFullAccessPermissionSubject.next(value);
    }
    get imageSucceedUrl() {
        return this.resolveSvgAsset('succeed');
    }
    get editMode() {
        return this.selectedUser !== undefined;
    }
    setCurrentUserValue(value) {
        this.changesStore.next(Object.assign(Object.assign({}, this.currentUserStore.value), value));
    }
    goToStep(value) {
        this.currentStep = value;
    }
    getAllAccounts() {
        return this.userService.getAllArrangements().pipe(catchError(this.handleAccountError));
    }
    handleAccountError() {
        return of({ items: [] });
    }
    handleUserError() {
        return of({ items: [] });
    }
    next(authorizedUser) {
        this.setCurrentUserValue(authorizedUser);
        this.goToStep(this.currentStep + 1);
    }
    back() {
        this.goToStep(this.currentStep - 1);
    }
    saveOnly(authorizedUser) {
        this.setCurrentUserValue(authorizedUser);
    }
    setAbortingDialog(value) {
        this.isAborting = value;
    }
    setSucceedDialogStatus(value) {
        this.succeedStatus = value;
    }
    finish(authorizedUser) {
        this.isSaving = true;
        const onCreateSuccess = () => {
            this.setSucceedDialogStatus('create');
            this.isSaving = false;
            this.cd.markForCheck();
        };
        const onEditSuccess = () => {
            this.setSucceedDialogStatus('edit');
            this.isSaving = false;
            this.cd.markForCheck();
        };
        const onError = () => {
            this.isFailure = true;
            this.isSaving = false;
            this.cd.markForCheck();
        };
        if (this.editMode) {
            this.userService
                .updateAuthorizedUser(this.selectedUser, authorizedUser.permissions)
                .subscribe(onEditSuccess, onError);
        }
        else {
            this.userService.addAuthorizedUser(authorizedUser).subscribe(onCreateSuccess, onError);
        }
    }
    ngOnInit() {
        if (this.editMode) {
            this.userService
                .retrieveAuthorizedUser()
                .pipe(catchError(this.handleUserError), map((data) => data.items.find((item) => item.id === this.selectedUser)))
                .subscribe(this.selectedEditUserStore);
            this.accounts = this.selectedEditUserStore.pipe(switchMap((data) => (data ? this.getAllAccounts() : this.handleAccountError())));
        }
        else {
            this.accounts = this.getAllAccounts();
        }
        this.termsConditionsContent = this.usersUIService.termsConditionsContent();
        this.loadingData = combineLatest([this.accounts, this.termsConditionsContent]).pipe(map(([accounts, termsAndConditions]) => ({
            accounts,
            termsAndConditions,
        })));
    }
    get enableAccountLevelFullAccessPermission() {
        return this.enableAccountLevelFullAccessPermissionSubject.asObservable().pipe(map((data) => {
            return data === AuthorizedUserPermissionControlType.INDIVIDUAL_CONTROL;
        }));
    }
}
AuthorizedUsersCreateWrapperComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: AuthorizedUsersCreateWrapperComponent, deps: [{ token: i1.UserDataService }, { token: i2.UsersUIService }, { token: i3.AssetsService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
AuthorizedUsersCreateWrapperComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: AuthorizedUsersCreateWrapperComponent, selector: "bb-authorized-users-create-wrapper", inputs: { selectedUser: "selectedUser", enableAccountLevelFullAccessPermissionValue: ["enableAccountLevelFullAccessPermission", "enableAccountLevelFullAccessPermissionValue"] }, outputs: { showAuthorizedUsers: "showAuthorizedUsers" }, ngImport: i0, template: "<ng-container *ngIf=\"loadingData | async as data; else loadingState\">\n  <ng-container *ngIf=\"data.accounts?.items?.length > 0 && data.termsAndConditions; else errorState\">\n    <div class=\"bb-block bb-block--lg\">\n      <div class=\"row bb-stack bb-stack--center\">\n        <ng-container *ngIf=\"!editMode; else editModeStepper\">\n          <bb-authorized-users-stepper\n            class= \"col-12 col-md-10 col-lg-8\"\n            [currentStep]=\"currentStep\"\n          ></bb-authorized-users-stepper>\n        </ng-container>\n      </div>\n    </div>\n    \n    <ng-template #editModeStepper>\n      <bb-authorized-users-edit-stepper \n        class= \"col-12 col-md-10\"\n        [currentStep]=\"currentStep\"\n      ></bb-authorized-users-edit-stepper>\n    </ng-template>\n    \n    <bb-authorized-users-create-container>\n      <bb-authorized-users-user-details \n        *bbAuthorizedUsersStepHandler=\"!editMode ? currentStep : -1\"\n        [authorizedUser]=\"authorizedUser | async\"\n        [isFirstStep]=\"true\"\n        (next)=\"next($event)\"\n        (back)=\"back()\"\n        (cancel)=\"setAbortingDialog(true)\"\n      ></bb-authorized-users-user-details>\n      <bb-authorized-users-accounts \n        *bbAuthorizedUsersStepHandler=\"currentStep\" \n        [authorizedUser]=\"authorizedUser | async\"\n        [accounts]=\"data.accounts.items\"\n        [isFirstStep]=\"editMode\"\n        (next)=\"next($event)\"\n        (back)=\"back()\"\n        (saveOnly)=\"saveOnly($event)\"\n        (cancel)=\"setAbortingDialog(true)\"\n      ></bb-authorized-users-accounts>\n      <bb-authorized-users-permissions \n        *bbAuthorizedUsersStepHandler=\"currentStep\"\n        [authorizedUser]=\"authorizedUser | async\"\n        [enableAccountLevelFullAccessPermission]=\"enableAccountLevelFullAccessPermission | async\"\n        [accounts]=\"data.accounts.items\"\n        [levelsConfig]=\"levelsConfig\"\n        [permissionsConfig]=\"permissionsConfig\"\n        (next)=\"next($event)\"\n        (back)=\"back()\"\n        (saveOnly)=\"saveOnly($event)\"\n        (cancel)=\"setAbortingDialog(true)\"\n      ></bb-authorized-users-permissions>\n      <bb-authorized-users-confirmation \n        *bbAuthorizedUsersStepHandler=\"currentStep\"\n        [authorizedUser]=\"authorizedUser | async\"\n        [termsConditions]=\"data.termsAndConditions\"\n        [levelsConfig]=\"levelsConfig\"\n        [isSaving]=\"isSaving\"\n        [(showError)]=\"isFailure\"\n        (next)=\"finish($event)\"\n        (back)=\"back()\"\n        (cancel)=\"setAbortingDialog(true)\"\n      ></bb-authorized-users-confirmation>\n    </bb-authorized-users-create-container>\n  </ng-container>\n</ng-container>\n\n<bb-authorized-users-confirmation-complete\n  *ngIf=\"succeedStatus\"\n  [dialogOpen]=\"succeedStatus\"\n  [succeedStatus]=\"succeedStatus\"\n  [authorizedUser]=\"authorizedUser | async\"\n  [successImg]=\"imageSucceedUrl | async\"\n  (confirm)=\"goToAuthorizedUsersList()\"\n  (closed)=\"goToAuthorizedUsersList()\"\n></bb-authorized-users-confirmation-complete>\n\n<bb-authorized-users-cancel-creation\n  [dialogOpen]=\"isAborting\"\n  (confirm)=\"goToAuthorizedUsersList()\"\n  (closed)=\"setAbortingDialog(false)\"\n></bb-authorized-users-cancel-creation>\n\n<ng-template #loadingState>\n  <div class=\"card\">\n    <bb-loading-indicator-ui \n      loaderSize=\"lg\" \n      text=\"Loading...\"\n      i18n-text=\"Loading|Text for the loading indicator@@authorized.users.create.loading.indicator.text\"\n    ></bb-loading-indicator-ui>\n  </div>\n</ng-template>\n\n<ng-template #errorState>\n  <div class=\"card\">\n    <div class=\"card-body bb-state-container\">\n      <bb-empty-state-ui\n        iconModifier=\"error-outline\"\n        iconColor=\"dark\"\n        title=\"Something went wrong\"\n        i18n-title=\"Error state title@@authorized.users.create.errorState.title\"\n        subtitle=\"Try to reload the page or contact the system administrator.\"\n        i18n-subtitle=\"Error state message@@authorized.users.create.errorState.message\"\n      ></bb-empty-state-ui>\n    </div>\n  </div>\n</ng-template>", components: [{ type: i4.AuthorizedUsersStepperComponent, selector: "bb-authorized-users-stepper", inputs: ["currentStep"] }, { type: i5.AuthorizedUserEditStepperComponent, selector: "bb-authorized-users-edit-stepper", inputs: ["currentStep"] }, { type: i6.AuthorizedUsersCreateContainerComponent, selector: "bb-authorized-users-create-container" }, { type: i7.AuthorizedUsersUserDetailsComponent, selector: "bb-authorized-users-user-details" }, { type: i8.AuthorizedUsersAccountsComponent, selector: "bb-authorized-users-accounts", inputs: ["accounts"] }, { type: i9.AuthorizedUsersPermissionsComponent, selector: "bb-authorized-users-permissions", inputs: ["accounts"] }, { type: i10.AuthorizedUsersConfirmationComponent, selector: "bb-authorized-users-confirmation", inputs: ["showError", "isSaving", "termsConditions"], outputs: ["showErrorChange"] }, { type: i11.AuthorizedUsersConfirmationCompleteComponent, selector: "bb-authorized-users-confirmation-complete", inputs: ["authorizedUser", "successImg", "succeedStatus"] }, { type: i12.AuthorizedUsersCancelCreationComponent, selector: "bb-authorized-users-cancel-creation" }, { type: i13.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i14.EmptyStateComponent, selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }], directives: [{ type: i15.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i16.AuthorizedUserStepHandlerDirective, selector: "[bbAuthorizedUsersStepHandler]", inputs: ["bbAuthorizedUsersStepHandler"] }], pipes: { "async": i15.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: AuthorizedUsersCreateWrapperComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-authorized-users-create-wrapper',
                    templateUrl: 'authorized-users-create-wrapper.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.UserDataService }, { type: i2.UsersUIService }, { type: i3.AssetsService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { selectedUser: [{
                type: Input
            }], enableAccountLevelFullAccessPermissionValue: [{
                type: Input,
                args: ['enableAccountLevelFullAccessPermission']
            }], showAuthorizedUsers: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aG9yaXplZC11c2Vycy1jcmVhdGUtd3JhcHBlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2F1dGhvcml6ZWQtdXNlcnMtam91cm5leS9zcmMvYXV0aG9yaXplZC11c2Vycy1jcmVhdGUvYXV0aG9yaXplZC11c2Vycy1jcmVhdGUtd3JhcHBlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2F1dGhvcml6ZWQtdXNlcnMtam91cm5leS9zcmMvYXV0aG9yaXplZC11c2Vycy1jcmVhdGUvYXV0aG9yaXplZC11c2Vycy1jcmVhdGUtd3JhcHBlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQWMsZUFBZSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RixPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0I1RCxNQUFNLENBQU4sSUFBWSxtQ0FHWDtBQUhELFdBQVksbUNBQW1DO0lBQzdDLGdGQUF5QyxDQUFBO0lBQ3pDLGtFQUEyQixDQUFBO0FBQzdCLENBQUMsRUFIVyxtQ0FBbUMsS0FBbkMsbUNBQW1DLFFBRzlDO0FBTUQsTUFBTSxPQUFPLHFDQUFxQztJQXVKaEQsWUFDbUIsV0FBNEIsRUFDNUIsY0FBOEIsRUFDOUIsYUFBNEIsRUFDNUIsRUFBcUI7UUFIckIsZ0JBQVcsR0FBWCxXQUFXLENBQWlCO1FBQzVCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQTFKeEMsZ0JBQVcsR0FBRyxDQUFDLENBQUM7UUFDaEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFXUCx3QkFBbUIsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBR2pELHFCQUFnQixHQUE0QyxJQUFJLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwRixpQkFBWSxHQUE0QyxJQUFJLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRiwwQkFBcUIsR0FBMEMsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQUUzRixtQkFBYyxHQUF1QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDMUYsa0RBQTZDLEdBQUcsSUFBSSxlQUFlLENBQXFCLFNBQVMsQ0FBQyxDQUFDO1FBRWxGLHlCQUFvQixHQUFHLENBQUMsT0FBZSxFQUFFLEVBQUUsQ0FBQyxHQUFHLE9BQU8sTUFBTSxDQUFDO1FBRTlFLDhEQUE4RDtRQUM3QyxvQkFBZSxHQUFtQixJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDO1lBQ3pGLFVBQVUsRUFBRSxpQ0FBaUM7WUFDN0MsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLG9CQUFvQjtTQUM3QyxDQUFDLENBQUM7UUFVSCw0QkFBdUIsR0FBRyxHQUFHLEVBQUU7WUFDN0IsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2xDLENBQUMsQ0FBQztRQWlIQSxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUM7UUFDNUQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUM7UUFDdEUsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3hGLENBQUM7SUFwSkQsSUFBcUQsMkNBQTJDLENBQUMsS0FBYTtRQUM1RyxJQUFJLENBQUMsNkNBQTZDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFvQkQsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsWUFBWSxLQUFLLFNBQVMsQ0FBQztJQUN6QyxDQUFDO0lBTU8sbUJBQW1CLENBQUMsS0FBNkI7UUFDdkQsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLGlDQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEdBQUssS0FBSyxFQUFHLENBQUM7SUFDdkUsQ0FBQztJQUVPLFFBQVEsQ0FBQyxLQUFhO1FBQzVCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0lBQzNCLENBQUM7SUFFTyxjQUFjO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztJQUN6RixDQUFDO0lBRU8sa0JBQWtCO1FBQ3hCLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVPLGVBQWU7UUFDckIsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsSUFBSSxDQUFDLGNBQXNDO1FBQ3pDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELElBQUk7UUFDRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFFBQVEsQ0FBQyxjQUFzQztRQUM3QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVELGlCQUFpQixDQUFDLEtBQWM7UUFDOUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVELHNCQUFzQixDQUFDLEtBQWE7UUFDbEMsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFDN0IsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFzQztRQUMzQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixNQUFNLGVBQWUsR0FBRyxHQUFHLEVBQUU7WUFDM0IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDO1FBRUYsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwQyxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUN0QixJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3pCLENBQUMsQ0FBQztRQUVGLE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRTtZQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztZQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUN0QixJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3pCLENBQUMsQ0FBQztRQUVGLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixJQUFJLENBQUMsV0FBVztpQkFDYixvQkFBb0IsQ0FBQyxJQUFJLENBQUMsWUFBYSxFQUFFLGNBQWMsQ0FBQyxXQUFZLENBQUM7aUJBQ3JFLFNBQVMsQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDdEM7YUFBTTtZQUNMLElBQUksQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLENBQUMsU0FBUyxDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUN4RjtJQUNILENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxXQUFXO2lCQUNiLHNCQUFzQixFQUFFO2lCQUN4QixJQUFJLENBQ0gsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsRUFDaEMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FDeEU7aUJBQ0EsU0FBUyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBRXpDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FDN0MsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLENBQ2hGLENBQUM7U0FDSDthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkM7UUFFRCxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBRTNFLElBQUksQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDakYsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsa0JBQWtCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUN2QyxRQUFRO1lBQ1Isa0JBQWtCO1NBQ25CLENBQUMsQ0FBQyxDQUNKLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxzQ0FBc0M7UUFDeEMsT0FBTyxJQUFJLENBQUMsNkNBQTZDLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUMzRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNYLE9BQU8sSUFBSSxLQUFLLG1DQUFtQyxDQUFDLGtCQUFrQixDQUFDO1FBQ3pFLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOzttSUFySlUscUNBQXFDO3VIQUFyQyxxQ0FBcUMscVRDN0JsRCwraklBeUdjOzRGRDVFRCxxQ0FBcUM7a0JBSmpELFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLG9DQUFvQztvQkFDOUMsV0FBVyxFQUFFLGdEQUFnRDtpQkFDOUQ7K0xBV1UsWUFBWTtzQkFBcEIsS0FBSztnQkFFK0MsMkNBQTJDO3NCQUEvRixLQUFLO3VCQUFDLHdDQUF3QztnQkFJckMsbUJBQW1CO3NCQUE1QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCwgUmVwbGF5U3ViamVjdCwgbWVyZ2UsIG9mLCBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEFzc2V0c1Jlc29sdmVyLCBBc3NldHNTZXJ2aWNlIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgQWNjb3VudExpc3QgfSBmcm9tICcuLi9jb21tb24vbW9kZWwvYWNjb3VudC1saXN0Lm1vZGVsJztcbmltcG9ydCB7XG4gIEF1dGhvcml6ZWRVc2Vyc0xpc3QsXG4gIExldmVsVUlDb25maWdIZWFkZXIsXG4gIFBhcnRpYWxBdXRob3JpemVkVXNlcnMsXG4gIFBlcm1pc3Npb25VSUNvbmZpZyxcbiAgU2FmZVR5cGVBcnJheSxcbn0gZnJvbSAnLi4vY29tbW9uL21vZGVsL2F1dGhvcml6ZWQtdXNlcnMubW9kZWwnO1xuaW1wb3J0IHsgVXNlckRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3NlcnZpY2VzL3VzZXItZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJzVUlTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3NlcnZpY2VzL3VzZXJzLXVpLnNlcnZpY2UnO1xuXG5pbnRlcmZhY2UgTG9hZGluZ0RhdGEge1xuICBhY2NvdW50czogQWNjb3VudExpc3Q7XG4gIHRlcm1zQW5kQ29uZGl0aW9uczogc3RyaW5nO1xufVxuXG5leHBvcnQgZW51bSBBdXRob3JpemVkVXNlclBlcm1pc3Npb25Db250cm9sVHlwZSB7XG4gIElORElWSURVQUxfQ09OVFJPTCA9ICdpbmRpdmlkdWFsLWNvbnRyb2wnLFxuICBBTExfQVRfT05DRSA9ICdhbGwtYXQtb25jZScsXG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JiLWF1dGhvcml6ZWQtdXNlcnMtY3JlYXRlLXdyYXBwZXInLFxuICB0ZW1wbGF0ZVVybDogJ2F1dGhvcml6ZWQtdXNlcnMtY3JlYXRlLXdyYXBwZXIuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBBdXRob3JpemVkVXNlcnNDcmVhdGVXcmFwcGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgY3VycmVudFN0ZXAgPSAxO1xuICBpc0Fib3J0aW5nID0gZmFsc2U7XG4gIHN1Y2NlZWRTdGF0dXMgPSAnJztcbiAgaXNGYWlsdXJlID0gZmFsc2U7XG4gIGlzU2F2aW5nID0gZmFsc2U7XG4gIGxldmVsc0NvbmZpZzogQXJyYXk8TGV2ZWxVSUNvbmZpZ0hlYWRlcjxTYWZlVHlwZUFycmF5Pj4gfCB1bmRlZmluZWQ7XG4gIHBlcm1pc3Npb25zQ29uZmlnOiBQZXJtaXNzaW9uVUlDb25maWc8U2FmZVR5cGVBcnJheT4gfCB1bmRlZmluZWQ7XG4gIGxvYWRpbmdEYXRhOiBPYnNlcnZhYmxlPExvYWRpbmdEYXRhPiB8IHVuZGVmaW5lZDtcblxuICBASW5wdXQoKSBzZWxlY3RlZFVzZXI6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBASW5wdXQoJ2VuYWJsZUFjY291bnRMZXZlbEZ1bGxBY2Nlc3NQZXJtaXNzaW9uJykgc2V0IGVuYWJsZUFjY291bnRMZXZlbEZ1bGxBY2Nlc3NQZXJtaXNzaW9uVmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuZW5hYmxlQWNjb3VudExldmVsRnVsbEFjY2Vzc1Blcm1pc3Npb25TdWJqZWN0Lm5leHQodmFsdWUpO1xuICB9XG5cbiAgQE91dHB1dCgpIHNob3dBdXRob3JpemVkVXNlcnMgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gIHByaXZhdGUgdGVybXNDb25kaXRpb25zQ29udGVudDogT2JzZXJ2YWJsZTxzdHJpbmc+IHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGFjY291bnRzOiBPYnNlcnZhYmxlPEFjY291bnRMaXN0PiB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBjdXJyZW50VXNlclN0b3JlOiBCZWhhdmlvclN1YmplY3Q8UGFydGlhbEF1dGhvcml6ZWRVc2Vycz4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHt9KTtcbiAgcHJpdmF0ZSBjaGFuZ2VzU3RvcmU6IEJlaGF2aW9yU3ViamVjdDxQYXJ0aWFsQXV0aG9yaXplZFVzZXJzPiA9IG5ldyBCZWhhdmlvclN1YmplY3Qoe30pO1xuICBwcml2YXRlIHNlbGVjdGVkRWRpdFVzZXJTdG9yZTogUmVwbGF5U3ViamVjdDxQYXJ0aWFsQXV0aG9yaXplZFVzZXJzPiA9IG5ldyBSZXBsYXlTdWJqZWN0KCk7XG5cbiAgYXV0aG9yaXplZFVzZXI6IE9ic2VydmFibGU8UGFydGlhbEF1dGhvcml6ZWRVc2Vycz4gPSB0aGlzLmN1cnJlbnRVc2VyU3RvcmUuYXNPYnNlcnZhYmxlKCk7XG4gIGVuYWJsZUFjY291bnRMZXZlbEZ1bGxBY2Nlc3NQZXJtaXNzaW9uU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgZ2V0VVJJRnJvbVN2Z0Fzc2V0SUQgPSAoYXNzZXRJZDogc3RyaW5nKSA9PiBgJHthc3NldElkfS5zdmdgO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbWVtYmVyLW9yZGVyaW5nXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVzb2x2ZVN2Z0Fzc2V0OiBBc3NldHNSZXNvbHZlciA9IHRoaXMuYXNzZXRzU2VydmljZS5jcmVhdGVBc3NldHNSZXNvbHZlcih7XG4gICAgd2lkZ2V0TmFtZTogJ2JiLWF1dGhvcml6ZWQtdXNlcnMtam91cm5leS1hbmcnLFxuICAgIGdldFVSSUZyb21Bc3NldElEOiB0aGlzLmdldFVSSUZyb21TdmdBc3NldElELFxuICB9KTtcblxuICBnZXQgaW1hZ2VTdWNjZWVkVXJsKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMucmVzb2x2ZVN2Z0Fzc2V0KCdzdWNjZWVkJyk7XG4gIH1cblxuICBnZXQgZWRpdE1vZGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRVc2VyICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBnb1RvQXV0aG9yaXplZFVzZXJzTGlzdCA9ICgpID0+IHtcbiAgICB0aGlzLnNob3dBdXRob3JpemVkVXNlcnMuZW1pdCgpO1xuICB9O1xuXG4gIHByaXZhdGUgc2V0Q3VycmVudFVzZXJWYWx1ZSh2YWx1ZTogUGFydGlhbEF1dGhvcml6ZWRVc2Vycykge1xuICAgIHRoaXMuY2hhbmdlc1N0b3JlLm5leHQoeyAuLi50aGlzLmN1cnJlbnRVc2VyU3RvcmUudmFsdWUsIC4uLnZhbHVlIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnb1RvU3RlcCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5jdXJyZW50U3RlcCA9IHZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBbGxBY2NvdW50cygpIHtcbiAgICByZXR1cm4gdGhpcy51c2VyU2VydmljZS5nZXRBbGxBcnJhbmdlbWVudHMoKS5waXBlKGNhdGNoRXJyb3IodGhpcy5oYW5kbGVBY2NvdW50RXJyb3IpKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQWNjb3VudEVycm9yKCk6IE9ic2VydmFibGU8QWNjb3VudExpc3Q+IHtcbiAgICByZXR1cm4gb2YoeyBpdGVtczogW10gfSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVVzZXJFcnJvcigpOiBPYnNlcnZhYmxlPEF1dGhvcml6ZWRVc2Vyc0xpc3Q+IHtcbiAgICByZXR1cm4gb2YoeyBpdGVtczogW10gfSk7XG4gIH1cblxuICBuZXh0KGF1dGhvcml6ZWRVc2VyOiBQYXJ0aWFsQXV0aG9yaXplZFVzZXJzKSB7XG4gICAgdGhpcy5zZXRDdXJyZW50VXNlclZhbHVlKGF1dGhvcml6ZWRVc2VyKTtcbiAgICB0aGlzLmdvVG9TdGVwKHRoaXMuY3VycmVudFN0ZXAgKyAxKTtcbiAgfVxuXG4gIGJhY2soKSB7XG4gICAgdGhpcy5nb1RvU3RlcCh0aGlzLmN1cnJlbnRTdGVwIC0gMSk7XG4gIH1cblxuICBzYXZlT25seShhdXRob3JpemVkVXNlcjogUGFydGlhbEF1dGhvcml6ZWRVc2Vycykge1xuICAgIHRoaXMuc2V0Q3VycmVudFVzZXJWYWx1ZShhdXRob3JpemVkVXNlcik7XG4gIH1cblxuICBzZXRBYm9ydGluZ0RpYWxvZyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuaXNBYm9ydGluZyA9IHZhbHVlO1xuICB9XG5cbiAgc2V0U3VjY2VlZERpYWxvZ1N0YXR1cyh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5zdWNjZWVkU3RhdHVzID0gdmFsdWU7XG4gIH1cblxuICBmaW5pc2goYXV0aG9yaXplZFVzZXI6IFBhcnRpYWxBdXRob3JpemVkVXNlcnMpIHtcbiAgICB0aGlzLmlzU2F2aW5nID0gdHJ1ZTtcbiAgICBjb25zdCBvbkNyZWF0ZVN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICB0aGlzLnNldFN1Y2NlZWREaWFsb2dTdGF0dXMoJ2NyZWF0ZScpO1xuICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25FZGl0U3VjY2VzcyA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3VjY2VlZERpYWxvZ1N0YXR1cygnZWRpdCcpO1xuICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25FcnJvciA9ICgpID0+IHtcbiAgICAgIHRoaXMuaXNGYWlsdXJlID0gdHJ1ZTtcbiAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfTtcblxuICAgIGlmICh0aGlzLmVkaXRNb2RlKSB7XG4gICAgICB0aGlzLnVzZXJTZXJ2aWNlXG4gICAgICAgIC51cGRhdGVBdXRob3JpemVkVXNlcih0aGlzLnNlbGVjdGVkVXNlciEsIGF1dGhvcml6ZWRVc2VyLnBlcm1pc3Npb25zISlcbiAgICAgICAgLnN1YnNjcmliZShvbkVkaXRTdWNjZXNzLCBvbkVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51c2VyU2VydmljZS5hZGRBdXRob3JpemVkVXNlcihhdXRob3JpemVkVXNlcikuc3Vic2NyaWJlKG9uQ3JlYXRlU3VjY2Vzcywgb25FcnJvcik7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMuZWRpdE1vZGUpIHtcbiAgICAgIHRoaXMudXNlclNlcnZpY2VcbiAgICAgICAgLnJldHJpZXZlQXV0aG9yaXplZFVzZXIoKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlVXNlckVycm9yKSxcbiAgICAgICAgICBtYXAoKGRhdGEpID0+IGRhdGEuaXRlbXMuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gdGhpcy5zZWxlY3RlZFVzZXIpKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKHRoaXMuc2VsZWN0ZWRFZGl0VXNlclN0b3JlKTtcblxuICAgICAgdGhpcy5hY2NvdW50cyA9IHRoaXMuc2VsZWN0ZWRFZGl0VXNlclN0b3JlLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gKGRhdGEgPyB0aGlzLmdldEFsbEFjY291bnRzKCkgOiB0aGlzLmhhbmRsZUFjY291bnRFcnJvcigpKSksXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFjY291bnRzID0gdGhpcy5nZXRBbGxBY2NvdW50cygpO1xuICAgIH1cblxuICAgIHRoaXMudGVybXNDb25kaXRpb25zQ29udGVudCA9IHRoaXMudXNlcnNVSVNlcnZpY2UudGVybXNDb25kaXRpb25zQ29udGVudCgpO1xuXG4gICAgdGhpcy5sb2FkaW5nRGF0YSA9IGNvbWJpbmVMYXRlc3QoW3RoaXMuYWNjb3VudHMsIHRoaXMudGVybXNDb25kaXRpb25zQ29udGVudF0pLnBpcGUoXG4gICAgICBtYXAoKFthY2NvdW50cywgdGVybXNBbmRDb25kaXRpb25zXSkgPT4gKHtcbiAgICAgICAgYWNjb3VudHMsXG4gICAgICAgIHRlcm1zQW5kQ29uZGl0aW9ucyxcbiAgICAgIH0pKSxcbiAgICApO1xuICB9XG5cbiAgZ2V0IGVuYWJsZUFjY291bnRMZXZlbEZ1bGxBY2Nlc3NQZXJtaXNzaW9uKCk6IE9ic2VydmFibGU8Ym9vbGVhbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLmVuYWJsZUFjY291bnRMZXZlbEZ1bGxBY2Nlc3NQZXJtaXNzaW9uU3ViamVjdC5hc09ic2VydmFibGUoKS5waXBlKFxuICAgICAgbWFwKChkYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiBkYXRhID09PSBBdXRob3JpemVkVXNlclBlcm1pc3Npb25Db250cm9sVHlwZS5JTkRJVklEVUFMX0NPTlRST0w7XG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSB1c2VyU2VydmljZTogVXNlckRhdGFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdXNlcnNVSVNlcnZpY2U6IFVzZXJzVUlTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgYXNzZXRzU2VydmljZTogQXNzZXRzU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgKSB7XG4gICAgdGhpcy5sZXZlbHNDb25maWcgPSB0aGlzLnVzZXJzVUlTZXJ2aWNlLnVpTGV2ZWxzQ29uZmlnVmFsdWU7XG4gICAgdGhpcy5wZXJtaXNzaW9uc0NvbmZpZyA9IHRoaXMudXNlcnNVSVNlcnZpY2UudWlQZXJtaXNzaW9uc0NvbmZpZ1ZhbHVlO1xuICAgIG1lcmdlKHRoaXMuY2hhbmdlc1N0b3JlLCB0aGlzLnNlbGVjdGVkRWRpdFVzZXJTdG9yZSkuc3Vic2NyaWJlKHRoaXMuY3VycmVudFVzZXJTdG9yZSk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJsb2FkaW5nRGF0YSB8IGFzeW5jIGFzIGRhdGE7IGVsc2UgbG9hZGluZ1N0YXRlXCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJkYXRhLmFjY291bnRzPy5pdGVtcz8ubGVuZ3RoID4gMCAmJiBkYXRhLnRlcm1zQW5kQ29uZGl0aW9uczsgZWxzZSBlcnJvclN0YXRlXCI+XG4gICAgPGRpdiBjbGFzcz1cImJiLWJsb2NrIGJiLWJsb2NrLS1sZ1wiPlxuICAgICAgPGRpdiBjbGFzcz1cInJvdyBiYi1zdGFjayBiYi1zdGFjay0tY2VudGVyXCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhZWRpdE1vZGU7IGVsc2UgZWRpdE1vZGVTdGVwcGVyXCI+XG4gICAgICAgICAgPGJiLWF1dGhvcml6ZWQtdXNlcnMtc3RlcHBlclxuICAgICAgICAgICAgY2xhc3M9IFwiY29sLTEyIGNvbC1tZC0xMCBjb2wtbGctOFwiXG4gICAgICAgICAgICBbY3VycmVudFN0ZXBdPVwiY3VycmVudFN0ZXBcIlxuICAgICAgICAgID48L2JiLWF1dGhvcml6ZWQtdXNlcnMtc3RlcHBlcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBcbiAgICA8bmctdGVtcGxhdGUgI2VkaXRNb2RlU3RlcHBlcj5cbiAgICAgIDxiYi1hdXRob3JpemVkLXVzZXJzLWVkaXQtc3RlcHBlciBcbiAgICAgICAgY2xhc3M9IFwiY29sLTEyIGNvbC1tZC0xMFwiXG4gICAgICAgIFtjdXJyZW50U3RlcF09XCJjdXJyZW50U3RlcFwiXG4gICAgICA+PC9iYi1hdXRob3JpemVkLXVzZXJzLWVkaXQtc3RlcHBlcj5cbiAgICA8L25nLXRlbXBsYXRlPlxuICAgIFxuICAgIDxiYi1hdXRob3JpemVkLXVzZXJzLWNyZWF0ZS1jb250YWluZXI+XG4gICAgICA8YmItYXV0aG9yaXplZC11c2Vycy11c2VyLWRldGFpbHMgXG4gICAgICAgICpiYkF1dGhvcml6ZWRVc2Vyc1N0ZXBIYW5kbGVyPVwiIWVkaXRNb2RlID8gY3VycmVudFN0ZXAgOiAtMVwiXG4gICAgICAgIFthdXRob3JpemVkVXNlcl09XCJhdXRob3JpemVkVXNlciB8IGFzeW5jXCJcbiAgICAgICAgW2lzRmlyc3RTdGVwXT1cInRydWVcIlxuICAgICAgICAobmV4dCk9XCJuZXh0KCRldmVudClcIlxuICAgICAgICAoYmFjayk9XCJiYWNrKClcIlxuICAgICAgICAoY2FuY2VsKT1cInNldEFib3J0aW5nRGlhbG9nKHRydWUpXCJcbiAgICAgID48L2JiLWF1dGhvcml6ZWQtdXNlcnMtdXNlci1kZXRhaWxzPlxuICAgICAgPGJiLWF1dGhvcml6ZWQtdXNlcnMtYWNjb3VudHMgXG4gICAgICAgICpiYkF1dGhvcml6ZWRVc2Vyc1N0ZXBIYW5kbGVyPVwiY3VycmVudFN0ZXBcIiBcbiAgICAgICAgW2F1dGhvcml6ZWRVc2VyXT1cImF1dGhvcml6ZWRVc2VyIHwgYXN5bmNcIlxuICAgICAgICBbYWNjb3VudHNdPVwiZGF0YS5hY2NvdW50cy5pdGVtc1wiXG4gICAgICAgIFtpc0ZpcnN0U3RlcF09XCJlZGl0TW9kZVwiXG4gICAgICAgIChuZXh0KT1cIm5leHQoJGV2ZW50KVwiXG4gICAgICAgIChiYWNrKT1cImJhY2soKVwiXG4gICAgICAgIChzYXZlT25seSk9XCJzYXZlT25seSgkZXZlbnQpXCJcbiAgICAgICAgKGNhbmNlbCk9XCJzZXRBYm9ydGluZ0RpYWxvZyh0cnVlKVwiXG4gICAgICA+PC9iYi1hdXRob3JpemVkLXVzZXJzLWFjY291bnRzPlxuICAgICAgPGJiLWF1dGhvcml6ZWQtdXNlcnMtcGVybWlzc2lvbnMgXG4gICAgICAgICpiYkF1dGhvcml6ZWRVc2Vyc1N0ZXBIYW5kbGVyPVwiY3VycmVudFN0ZXBcIlxuICAgICAgICBbYXV0aG9yaXplZFVzZXJdPVwiYXV0aG9yaXplZFVzZXIgfCBhc3luY1wiXG4gICAgICAgIFtlbmFibGVBY2NvdW50TGV2ZWxGdWxsQWNjZXNzUGVybWlzc2lvbl09XCJlbmFibGVBY2NvdW50TGV2ZWxGdWxsQWNjZXNzUGVybWlzc2lvbiB8IGFzeW5jXCJcbiAgICAgICAgW2FjY291bnRzXT1cImRhdGEuYWNjb3VudHMuaXRlbXNcIlxuICAgICAgICBbbGV2ZWxzQ29uZmlnXT1cImxldmVsc0NvbmZpZ1wiXG4gICAgICAgIFtwZXJtaXNzaW9uc0NvbmZpZ109XCJwZXJtaXNzaW9uc0NvbmZpZ1wiXG4gICAgICAgIChuZXh0KT1cIm5leHQoJGV2ZW50KVwiXG4gICAgICAgIChiYWNrKT1cImJhY2soKVwiXG4gICAgICAgIChzYXZlT25seSk9XCJzYXZlT25seSgkZXZlbnQpXCJcbiAgICAgICAgKGNhbmNlbCk9XCJzZXRBYm9ydGluZ0RpYWxvZyh0cnVlKVwiXG4gICAgICA+PC9iYi1hdXRob3JpemVkLXVzZXJzLXBlcm1pc3Npb25zPlxuICAgICAgPGJiLWF1dGhvcml6ZWQtdXNlcnMtY29uZmlybWF0aW9uIFxuICAgICAgICAqYmJBdXRob3JpemVkVXNlcnNTdGVwSGFuZGxlcj1cImN1cnJlbnRTdGVwXCJcbiAgICAgICAgW2F1dGhvcml6ZWRVc2VyXT1cImF1dGhvcml6ZWRVc2VyIHwgYXN5bmNcIlxuICAgICAgICBbdGVybXNDb25kaXRpb25zXT1cImRhdGEudGVybXNBbmRDb25kaXRpb25zXCJcbiAgICAgICAgW2xldmVsc0NvbmZpZ109XCJsZXZlbHNDb25maWdcIlxuICAgICAgICBbaXNTYXZpbmddPVwiaXNTYXZpbmdcIlxuICAgICAgICBbKHNob3dFcnJvcildPVwiaXNGYWlsdXJlXCJcbiAgICAgICAgKG5leHQpPVwiZmluaXNoKCRldmVudClcIlxuICAgICAgICAoYmFjayk9XCJiYWNrKClcIlxuICAgICAgICAoY2FuY2VsKT1cInNldEFib3J0aW5nRGlhbG9nKHRydWUpXCJcbiAgICAgID48L2JiLWF1dGhvcml6ZWQtdXNlcnMtY29uZmlybWF0aW9uPlxuICAgIDwvYmItYXV0aG9yaXplZC11c2Vycy1jcmVhdGUtY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctY29udGFpbmVyPlxuXG48YmItYXV0aG9yaXplZC11c2Vycy1jb25maXJtYXRpb24tY29tcGxldGVcbiAgKm5nSWY9XCJzdWNjZWVkU3RhdHVzXCJcbiAgW2RpYWxvZ09wZW5dPVwic3VjY2VlZFN0YXR1c1wiXG4gIFtzdWNjZWVkU3RhdHVzXT1cInN1Y2NlZWRTdGF0dXNcIlxuICBbYXV0aG9yaXplZFVzZXJdPVwiYXV0aG9yaXplZFVzZXIgfCBhc3luY1wiXG4gIFtzdWNjZXNzSW1nXT1cImltYWdlU3VjY2VlZFVybCB8IGFzeW5jXCJcbiAgKGNvbmZpcm0pPVwiZ29Ub0F1dGhvcml6ZWRVc2Vyc0xpc3QoKVwiXG4gIChjbG9zZWQpPVwiZ29Ub0F1dGhvcml6ZWRVc2Vyc0xpc3QoKVwiXG4+PC9iYi1hdXRob3JpemVkLXVzZXJzLWNvbmZpcm1hdGlvbi1jb21wbGV0ZT5cblxuPGJiLWF1dGhvcml6ZWQtdXNlcnMtY2FuY2VsLWNyZWF0aW9uXG4gIFtkaWFsb2dPcGVuXT1cImlzQWJvcnRpbmdcIlxuICAoY29uZmlybSk9XCJnb1RvQXV0aG9yaXplZFVzZXJzTGlzdCgpXCJcbiAgKGNsb3NlZCk9XCJzZXRBYm9ydGluZ0RpYWxvZyhmYWxzZSlcIlxuPjwvYmItYXV0aG9yaXplZC11c2Vycy1jYW5jZWwtY3JlYXRpb24+XG5cbjxuZy10ZW1wbGF0ZSAjbG9hZGluZ1N0YXRlPlxuICA8ZGl2IGNsYXNzPVwiY2FyZFwiPlxuICAgIDxiYi1sb2FkaW5nLWluZGljYXRvci11aSBcbiAgICAgIGxvYWRlclNpemU9XCJsZ1wiIFxuICAgICAgdGV4dD1cIkxvYWRpbmcuLi5cIlxuICAgICAgaTE4bi10ZXh0PVwiTG9hZGluZ3xUZXh0IGZvciB0aGUgbG9hZGluZyBpbmRpY2F0b3JAQGF1dGhvcml6ZWQudXNlcnMuY3JlYXRlLmxvYWRpbmcuaW5kaWNhdG9yLnRleHRcIlxuICAgID48L2JiLWxvYWRpbmctaW5kaWNhdG9yLXVpPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZXJyb3JTdGF0ZT5cbiAgPGRpdiBjbGFzcz1cImNhcmRcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ib2R5IGJiLXN0YXRlLWNvbnRhaW5lclwiPlxuICAgICAgPGJiLWVtcHR5LXN0YXRlLXVpXG4gICAgICAgIGljb25Nb2RpZmllcj1cImVycm9yLW91dGxpbmVcIlxuICAgICAgICBpY29uQ29sb3I9XCJkYXJrXCJcbiAgICAgICAgdGl0bGU9XCJTb21ldGhpbmcgd2VudCB3cm9uZ1wiXG4gICAgICAgIGkxOG4tdGl0bGU9XCJFcnJvciBzdGF0ZSB0aXRsZUBAYXV0aG9yaXplZC51c2Vycy5jcmVhdGUuZXJyb3JTdGF0ZS50aXRsZVwiXG4gICAgICAgIHN1YnRpdGxlPVwiVHJ5IHRvIHJlbG9hZCB0aGUgcGFnZSBvciBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvci5cIlxuICAgICAgICBpMThuLXN1YnRpdGxlPVwiRXJyb3Igc3RhdGUgbWVzc2FnZUBAYXV0aG9yaXplZC51c2Vycy5jcmVhdGUuZXJyb3JTdGF0ZS5tZXNzYWdlXCJcbiAgICAgID48L2JiLWVtcHR5LXN0YXRlLXVpPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+Il19