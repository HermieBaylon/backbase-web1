{"version":3,"file":"job-role-detail-modal.component.js","sourceRoot":"","sources":["../../../../../../libs/accessgroup-ui/src/lib/job-role-detail-modal/job-role-detail-modal.component.ts","../../../../../../libs/accessgroup-ui/src/lib/job-role-detail-modal/job-role-detail-modal.component.html"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY,EAAE,KAAK,EAAa,MAAM,EAAE,MAAM,eAAe,CAAC;AAE7F,OAAO,EAAE,OAAO,EAAE,EAAE,EAAE,eAAe,EAAc,KAAK,EAAE,MAAM,MAAM,CAAC;AACvE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAEjG,OAAO,EAAE,UAAU,EAAE,MAAM,+BAA+B,CAAC;AAC3D,OAAO,EAIL,4BAA4B,GAC7B,MAAM,kCAAkC,CAAC;AAE1C,OAAO,EAAE,wBAAwB,EAAE,MAAM,uCAAuC,CAAC;AACjF,OAAO,EAAE,yCAAyC,EAAE,MAAM,4DAA4D,CAAC;;;;;;;;;;;;;;;AAMvH,MAAM,OAAO,2BAA2B;IA6DtC,YACmB,YAAuD,EACvD,wBAAkD;QADlD,iBAAY,GAAZ,YAAY,CAA2C;QACvD,6BAAwB,GAAxB,wBAAwB,CAA0B;QAlDrE;;;WAGG;QACM,sBAAiB,GAAG,KAAK,CAAC;QAE3B,yBAAoB,GAAG,IAAI,eAAe,CAAqB,SAAS,CAAC,CAAC;QAElF;;;WAGG;QACH,4DAA4D;QAClD,UAAK,GAAuB,IAAI,YAAY,EAAQ,CAAC;QAE/D;;WAEG;QACc,aAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;QAE1C;;WAEG;QACM,8BAAyB,GAAwC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CACtG,MAAM,CAAC,CAAC,CAAC,EAAe,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAC/B,SAAS,CAAC,CAAC,EAAU,EAAE,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,oBAAoB,CAAC,EAAE,CAAC,CAAC,EACjF,GAAG,CAAC,CAAC,oBAAgD,EAAE,EAAE,CACvD,4BAA4B,CAAC,IAAI,CAAC,aAA8B,EAAE,oBAAoB,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAChH,EACD,GAAG,CAAC,CAAC,iBAAqC,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC,EACpG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CACzB,CAAC;QAEF;;WAEG;QACM,qCAAgC,GAAwB,KAAK,CACpE,IAAI,CAAC,yBAAyB,CAAC,IAAI,CACjC,KAAK,CAAC,KAAK,CAAC,EACZ,UAAU,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAC5B,CACF,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;QAExB;;WAEG;QACM,mCAA8B,GAAG,IAAI,CAAC,wBAAwB,CAAC,uBAAuB,CAAC;IAK7F,CAAC;IA1DJ;;OAEG;IACH,IAAa,kBAAkB,CAAC,EAAU;QACxC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACrC,CAAC;IAuDD;;;OAGG;IACH,YAAY,CAAC,MAAe;QAC1B,IAAI,CAAC,MAAM,EAAE;YACX,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;SACnB;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;IACvB,CAAC;;4IA9EU,2BAA2B;gIAA3B,2BAA2B,2NCpBxC,q3LAuIA,y5DD/Ba,uCAAuC;4FApFvC,2BAA2B;kBAJvC,SAAS;mBAAC;oBACT,QAAQ,EAAE,0BAA0B;oBACpC,WAAW,EAAE,sCAAsC;iBACpD;uKAKU,aAAa;sBAArB,KAAK;gBAKO,kBAAkB;sBAA9B,KAAK;gBAQG,iBAAiB;sBAAzB,KAAK;gBASI,KAAK;sBAAd,MAAM;;AA0DT,MAAM,OAAO,uCAAwC,SAAQ,UAO5D;;wJAPY,uCAAuC;4IAAvC,uCAAuC;4FAAvC,uCAAuC;kBAHnD,SAAS;mBAAC;oBACT,QAAQ,EAAE,oCAAoC;iBAC/C","sourcesContent":["import { Component, Directive, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { Subject, of, BehaviorSubject, Observable, merge } from 'rxjs';\nimport { takeUntil, catchError, map, switchMap, filter, mapTo, startWith } from 'rxjs/operators';\n\nimport { BbTemplate } from '@backbase/foundation-ang/core';\nimport {\n  BusinessFunction,\n  BusinessFunctionGroup,\n  FunctionGroup,\n  getExtendedBusinessFunctions,\n} from '@backbase/accessgroup-common-ang';\nimport { FunctionsGetResponseBody, FunctionGroupItem } from '@backbase/data-ang/accesscontrol';\nimport { BusinessFunctionsService } from './services/business-functions.service';\nimport { JobRoleDetailBusinessFunctionGroupService } from './services/job-role-detail-business-function-group.service';\n\n@Component({\n  selector: 'bb-job-role-detail-modal',\n  templateUrl: 'job-role-detail-modal.component.html',\n})\nexport class JobRoleDetailModalComponent implements OnDestroy {\n  /**\n   * Information about Job Role\n   */\n  @Input() jobRoleDetail!: FunctionGroupItem;\n\n  /**\n   * Setter for serviceAgreement Id\n   */\n  @Input() set serviceAgreementId(id: string) {\n    this._serviceAgreementId$.next(id);\n  }\n\n  /**\n   * Filter hook\n   * @default false\n   */\n  @Input() filterHookEnabled = false;\n\n  private _serviceAgreementId$ = new BehaviorSubject<string | undefined>(undefined);\n\n  /**\n   * Close modal window event.\n   * Propagate event when modal window should be closed.\n   */\n  // eslint-disable-next-line @angular-eslint/no-output-native\n  @Output() close: EventEmitter<void> = new EventEmitter<void>();\n\n  /**\n   * Unsubscribe stream\n   */\n  private readonly destroy$ = new Subject();\n\n  /**\n   * Stream of Grouped business functions\n   */\n  readonly groupedBusinessFunctions$: Observable<BusinessFunctionGroup[]> = this._serviceAgreementId$.pipe(\n    filter((x): x is string => !!x),\n    switchMap((id: string) => this.businessFunctionsService.getBusinessFunctions(id)),\n    map((allBusinessFunctions: FunctionsGetResponseBody[]) =>\n      getExtendedBusinessFunctions(this.jobRoleDetail as FunctionGroup, allBusinessFunctions, this.filterHookEnabled),\n    ),\n    map((businessFunctions: BusinessFunction[]) => this.groupService.convertToGroups(businessFunctions)),\n    takeUntil(this.destroy$),\n  );\n\n  /**\n   * Stream of loading state for Grouped business functions\n   */\n  readonly groupedBusinessFunctionsLoading$: Observable<boolean> = merge(\n    this.groupedBusinessFunctions$.pipe(\n      mapTo(false),\n      catchError(() => of(false)),\n    ),\n  ).pipe(startWith(true));\n\n  /**\n   * Stream of error state for Grouped business functions\n   */\n  readonly groupedBusinessFunctionsError$ = this.businessFunctionsService.businessFunctionsError$;\n\n  constructor(\n    private readonly groupService: JobRoleDetailBusinessFunctionGroupService,\n    private readonly businessFunctionsService: BusinessFunctionsService,\n  ) {}\n\n  /**\n   * OpenChange modal window event handler.\n   * @param isOpen - boolean\n   */\n  onOpenChange(isOpen: boolean): void {\n    if (!isOpen) {\n      this.close.emit();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n  }\n}\n\n@Directive({\n  selector: '[bbJobRoleDetailModalCustomizable]',\n})\nexport class JobRoleDetailModalCustomizableDirective extends BbTemplate<\n  JobRoleDetailModalComponent,\n  {\n    groupedBusinessFunctions: BusinessFunctionGroup[] | null;\n    groupedBusinessFunctionsLoading: boolean | null;\n    groupedBusinessFunctionsError: HttpErrorResponse | undefined | null;\n  }\n> {}\n","<ng-container\n  bbJobRoleDetailModalCustomizable\n  [bbHostRef]=\"this\"\n  [bbTemplateContext]=\"{\n    groupedBusinessFunctions: groupedBusinessFunctions$ | async,\n    groupedBusinessFunctionsLoading: groupedBusinessFunctionsLoading$ | async,\n    groupedBusinessFunctionsError: groupedBusinessFunctionsError$ | async\n  }\"></ng-container>\n\n<ng-template\n  bbJobRoleDetailModalCustomizable\n  let-hostRef\n  let-groupedBusinessFunctions=\"context.groupedBusinessFunctions\"\n  let-groupedBusinessFunctionsLoading=\"context.groupedBusinessFunctionsLoading\"\n  let-groupedBusinessFunctionsError=\"context.groupedBusinessFunctionsError\">\n  <bb-modal-ui\n    data-role=\"job-role-modal\"\n    [isOpen]=\"true\"\n    [modalOptions]=\"{\n      backdrop: 'static',\n      centered: true,\n      size: 'lg'\n    }\"\n    (isOpenChange)=\"hostRef.onOpenChange($event)\">\n    <bb-modal-header-ui>\n      <ng-template bbCustomModalHeader>\n        <div class=\"bb-stack\">\n          <div class=\"bb-stack__item\">\n            <bb-header-ui\n              [heading]=\"hostRef.jobRoleDetail.name\"\n              headingType=\"h2\"\n              data-role=\"job-role-modal-header-title\"></bb-header-ui>\n            <div data-role=\"job-role-modal-header-description\" class=\"bb-text-support\">\n              {{ hostRef.jobRoleDetail.description }}\n            </div>\n          </div>\n          <div class=\"bb-stack__item bb-stack__item--push-right bb-stack__item--align-top\">\n            <button\n              (click)=\"hostRef.onOpenChange(false)\"\n              bbButton\n              class=\"bb-stack__item-sm\"\n              color=\"unstyled\"\n              aria-label=\"Close dialog\"\n              i18n-aria-label=\"Close modal button in header@@job-role-detail-modal.header.close-btn.aria-label\"\n              data-role=\"job-role-modal-header-close-btn\">\n              <bb-icon-ui color=\"muted\" name=\"clear\"></bb-icon-ui>\n            </button>\n          </div>\n        </div>\n      </ng-template>\n    </bb-modal-header-ui>\n\n    <bb-modal-body-ui>\n      <ng-template bbCustomModalBody>\n        <ng-container *ngIf=\"!groupedBusinessFunctionsLoading; else loadingTemplate\">\n          <ng-container *ngIf=\"!groupedBusinessFunctionsError; else errorTemplate\">\n            <ng-container *ngIf=\"groupedBusinessFunctions && groupedBusinessFunctions.length; else emptyStateTemplate\">\n              <div\n                *ngFor=\"let group of groupedBusinessFunctions\"\n                data-role=\"job-role-modal-grouped-bf\"\n                class=\"bb-block bb-block--xl\"\n                [attr.data-test-id]=\"group.groupKey\">\n                <bb-business-function-group-name\n                  [groupKey]=\"group.groupKey\"\n                  class=\"bb-highlight\"\n                  data-role=\"job-role-modal-grouped-bf-title\"></bb-business-function-group-name>\n\n                <hr />\n\n                <div class=\"row bb-block bb-block--md\">\n                  <div class=\"col-5\"></div>\n                  <div class=\"col\">\n                    <bb-business-function-privileges-name\n                      class=\"d-flex bb-text-support bb-subtitle\"\n                      [hideExecute]=\"true\"\n                      data-role=\"job-role-modal-business-function-privileges-name\"></bb-business-function-privileges-name>\n                  </div>\n                </div>\n\n                <div\n                  *ngFor=\"let bf of group.businessFunctions; first as isFirst; last as isLast\"\n                  class=\"row align-items-center\"\n                  data-role=\"job-role-modal-bf-item\">\n                  <bb-business-function-name\n                    [businessFunction]=\"bf\"\n                    class=\"col-5 bb-text-default\"\n                    data-role=\"job-role-modal-bf-name\"></bb-business-function-name>\n\n                  <div class=\"col\">\n                    <bb-job-role-detail-privilege-indicator-list\n                      class=\"d-flex\"\n                      [businessFunction]=\"bf\"\n                      [first]=\"isFirst\"\n                      [last]=\"isLast\"\n                      data-role=\"job-role-modal-privilege-indicator-list\"></bb-job-role-detail-privilege-indicator-list>\n                  </div>\n                </div>\n              </div>\n            </ng-container>\n          </ng-container>\n        </ng-container>\n\n        <ng-template #loadingTemplate>\n          <div class=\"bb-state-container\" data-role=\"job-role-modal-loading-state-tmp\">\n            <bb-loading-indicator-ui></bb-loading-indicator-ui>\n          </div>\n        </ng-template>\n\n        <ng-template #errorTemplate>\n          <div class=\"bb-state-container\" data-role=\"job-role-modal-error-state-tmp\">\n            <bb-empty-state-ui\n              title=\"Failed to load business functions\"\n              i18n-title=\"Error status message title@@job-role-detail-modal.state.error.title\"\n              subtitle=\"Try to reload the page.<br> All data will be lost after reload.\"\n              i18n-subtitle=\"Error status message subtitle@@job-role-detail-modal.state.error.subtitle\"\n              iconSize=\"xxl\"\n              iconModifier=\"error-outline\"\n              iconColor=\"muted\">\n            </bb-empty-state-ui>\n          </div>\n        </ng-template>\n\n        <ng-template #emptyStateTemplate>\n          <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"job-role-modal-empty-state-tmp\">\n            <bb-empty-state-ui\n              iconSize=\"xxl\"\n              iconModifier=\"help-outline\"\n              title=\"No business function assigned to this job role.\"\n              i18n-title=\"Empty state title message@@job-role-detail-modal.state.empty.subtitle\"></bb-empty-state-ui>\n          </div>\n        </ng-template>\n      </ng-template>\n    </bb-modal-body-ui>\n  </bb-modal-ui>\n</ng-template>\n"]}