{"version":3,"file":"payee-group-detail-modal.component.js","sourceRoot":"","sources":["../../../../../../libs/accessgroup-ui/src/lib/payee-group-detail-modal/payee-group-detail-modal.component.ts","../../../../../../libs/accessgroup-ui/src/lib/payee-group-detail-modal/payee-group-detail-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Directive, ChangeDetectionStrategy, Input, Output, EventEmitter } from '@angular/core';\nimport { BbTemplate } from '@backbase/foundation-ang/core';\nimport { BehaviorSubject, combineLatest, merge, Observable, of, ReplaySubject } from 'rxjs';\nimport { auditTime, catchError, map, mapTo, shareReplay, switchMap } from 'rxjs/operators';\nimport {\n  getRouteParams,\n  ServiceAgreementWithParticipants,\n  UserPermissionsDataGroupDetailsService,\n} from '@backbase/accessgroup-common-ang';\nimport { ActivatedRoute } from '@angular/router';\nconst PAYEE_GROUP_DETAILS_ERROR = 'PAYEE_GROUP_DETAILS_ERROR';\n@Component({\n  selector: 'bb-payee-group-detail-modal',\n  templateUrl: './payee-group-detail-modal.component.html',\n  providers: [],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PayeeGroupDetailModalComponent {\n  /**\n   * Component context\n   */\n  readonly hostRef: PayeeGroupDetailModalComponent = this;\n\n  itemsPerPage = 10;\n\n  /**\n   * Flag to show modal\n   */\n  @Input() isOpen = false;\n\n  /**\n   * Payee group name\n   */\n  @Input() payeeGroupName = '';\n  @Input() targetSaId = '';\n\n  /**\n   * Setter for payee Ids\n   */\n  @Input() set payeeIds(val: Array<string> | undefined) {\n    if (val) {\n      this.selectedPayeeGroupSubject.next(val);\n      this.selectedPayeeGroupPayeesCurrentPageSubject.next(0);\n      this.selectedPayeeGroupPayeesSearchQuerySubject.next('');\n    }\n  }\n\n  /**\n   * Event emitter that emits on cancel button click\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  private readonly selectedPayeeGroupPayeesCurrentPageSubject = new BehaviorSubject<number>(0);\n  readonly selectedPayeeGroupPayeesCurrentPage$ = this.selectedPayeeGroupPayeesCurrentPageSubject.asObservable();\n\n  private readonly selectedPayeeGroupPayeesSearchQuerySubject = new BehaviorSubject<string>('');\n  readonly selectedPayeeGroupPayeesSearchQuery$ = this.selectedPayeeGroupPayeesSearchQuerySubject.asObservable();\n\n  private readonly selectedPayeeGroupSubject = new ReplaySubject<any>();\n  readonly selectedPayeeGroup$ = this.selectedPayeeGroupSubject.asObservable();\n\n  readonly serviceAgreement$: Observable<ServiceAgreementWithParticipants> = getRouteParams(\n    this.activeRoute,\n    'serviceAgreementId',\n  ).pipe(\n    switchMap((id: string | null) => {\n      let idSa = id;\n      if (this.targetSaId && !id) {\n        idSa = this.targetSaId;\n      }\n      return idSa\n        ? this.dataGroupDetailsService.getServiceAgreement(idSa)\n        : this.dataGroupDetailsService.serviceAgreementFromContext;\n    }),\n    shareReplay(1),\n  );\n\n  readonly selectedPayeeGroupDetails$: Observable<any> = combineLatest([\n    this.selectedPayeeGroup$,\n    this.selectedPayeeGroupPayeesCurrentPage$,\n    this.selectedPayeeGroupPayeesSearchQuery$,\n    this.serviceAgreement$,\n  ]).pipe(\n    auditTime(100),\n    switchMap(([items, from, query, serviceAgreement]) => {\n      if (items.length) {\n        return this.dataGroupDetailsService\n          .getPayeeGroupContacts(items, { from, query, targetSaId: serviceAgreement.serviceAgreement.id })\n          .pipe(\n            map(payees => ({\n              data: payees.data,\n              totalCount: payees.totalCount,\n            })),\n            catchError(() => {\n              return of(PAYEE_GROUP_DETAILS_ERROR);\n            }),\n          );\n      }\n      return of();\n    }),\n    shareReplay(1),\n  );\n\n  readonly selectedPayeeGroupError$: Observable<boolean> = this.selectedPayeeGroupDetails$.pipe(\n    map((data: any) => data === PAYEE_GROUP_DETAILS_ERROR),\n  );\n\n  readonly loadingSelectedPayee$ = merge(\n    this.selectedPayeeGroupSubject.pipe(mapTo(true)),\n    this.selectedPayeeGroupPayeesCurrentPageSubject.pipe(mapTo(true)),\n    this.selectedPayeeGroupPayeesSearchQuerySubject.pipe(mapTo(true)),\n    this.selectedPayeeGroupDetails$.pipe(mapTo(false)),\n  );\n\n  constructor(\n    private dataGroupDetailsService: UserPermissionsDataGroupDetailsService,\n    private readonly activeRoute: ActivatedRoute,\n  ) {}\n\n  onCancel() {\n    this.cancel.emit();\n  }\n\n  pageChange(page: number) {\n    this.selectedPayeeGroupPayeesCurrentPageSubject.next(page);\n  }\n\n  searchSubmit(query: string) {\n    this.selectedPayeeGroupPayeesCurrentPageSubject.next(0);\n    this.selectedPayeeGroupPayeesSearchQuerySubject.next(query);\n  }\n}\n\n@Directive({\n  selector: '[bbPayeeGroupDetailModalCustomizable]',\n})\nexport class PayeeGroupDetailModalCustomizableDirective extends BbTemplate<\n  PayeeGroupDetailModalComponent,\n  {\n    selectedPayeeGroupDetails: null;\n    loadingSelectedPayee: boolean | null;\n    selectedPayeeGroupPayeesCurrentPage: number | null;\n    selectedPayeeGroupError: boolean | null;\n    selectedPayeeGroup: null;\n  }\n> {}\n","<ng-container\n  bbPayeeGroupDetailModalCustomizable\n  [bbHostRef]=\"hostRef\"\n  [bbTemplateContext]=\"{\n    selectedPayeeGroupDetails: selectedPayeeGroupDetails$ | async,\n    loadingSelectedPayee: loadingSelectedPayee$ | async,\n    selectedPayeeGroupPayeesCurrentPage: selectedPayeeGroupPayeesCurrentPage$ | async,\n    selectedPayeeGroupError: selectedPayeeGroupError$ | async,\n    selectedPayeeGroup: selectedPayeeGroup$ | async\n  }\">\n</ng-container>\n\n<ng-template\n  bbPayeeGroupDetailModalCustomizable\n  let-hostRef\n  let-selectedPayeeGroupDetails=\"context.selectedPayeeGroupDetails\"\n  let-loadingSelectedPayee=\"context.loadingSelectedPayee\"\n  let-selectedPayeeGroupPayeesCurrentPage=\"context.selectedPayeeGroupPayeesCurrentPage\"\n  let-selectedPayeeGroupError=\"context.selectedPayeeGroupError\"\n  let-selectedPayeeGroup=\"context.selectedPayeeGroup\">\n  <bb-modal-ui [isOpen]=\"hostRef.isOpen\" (cancel)=\"hostRef.onCancel()\" data-role=\"payee-group-detail-modal\">\n    <bb-modal-header-ui\n      title=\"Detail for {{ hostRef.payeeGroupName }}\"\n      i18n-title=\"Title of payee group modal detail@payee-group-detail-modal.title\"\n      data-role=\"payee-modal-title\"></bb-modal-header-ui>\n    <bb-modal-body-ui>\n      <ng-template bbCustomModalBody>\n        <ng-container *ngIf=\"!selectedPayeeGroupError; else errorTemplate\">\n          <ng-container *ngIf=\"selectedPayeeGroup && selectedPayeeGroup.length; else empty\">\n            <div data-role=\"payee-group-modal-detail\">\n              <bb-search-box-ui\n                *ngIf=\"hostRef.isOpen\"\n                size=\"md\"\n                placeholder=\"Search\"\n                i18n-placeholder=\"Search placeholder@@payee-group-detail-modal.search.placeholder\"\n                [showClear]=\"true\"\n                [showSearch]=\"true\"\n                (clear)=\"hostRef.searchSubmit('')\"\n                (submit)=\"hostRef.searchSubmit($event)\"\n                data-role=\"payee-group-table-search\"></bb-search-box-ui>\n              <ng-container *ngIf=\"selectedPayeeGroupDetails && !loadingSelectedPayee; else loadingTemplate\">\n                <ng-container *ngIf=\"selectedPayeeGroupDetails.data.length; else empty\">\n                  <div class=\"bb-inline-stack\">\n                    <span\n                      class=\"bb-inline-stack__item bb-subheader bb-subheader--regular bb-text-bold\"\n                      i18n=\"Table header name@@payee-group-detail-modal.row.header.name\"\n                      >Name</span\n                    >\n                  </div>\n                  <hr />\n                  <div *ngFor=\"let payee of selectedPayeeGroupDetails.data\">\n                    <bb-payee-group-table-row data-role=\"payee-item\" [payee]=\"payee\"></bb-payee-group-table-row>\n                    <hr />\n                  </div>\n                  <bb-pagination-ui\n                    data-role=\"payee-group-table-pagination\"\n                    [page]=\"selectedPayeeGroupPayeesCurrentPage\"\n                    [boundaryLinks]=\"true\"\n                    [directionLinks]=\"true\"\n                    [totalItems]=\"selectedPayeeGroupDetails.totalCount\"\n                    [itemsPerPage]=\"itemsPerPage\"\n                    (pageChange)=\"hostRef.pageChange($event)\"></bb-pagination-ui>\n                </ng-container>\n              </ng-container>\n            </div>\n          </ng-container>\n        </ng-container>\n      </ng-template>\n    </bb-modal-body-ui>\n    <bb-modal-footer-ui>\n      <ng-template bbCustomModalFooter>\n        <div class=\"bb-button-bar\">\n          <button\n            bbButton\n            color=\"secondary\"\n            class=\"bb-button-bar__button\"\n            (click)=\"hostRef.onCancel()\"\n            i18n=\"Cancel button@payee-group-detail-modal.cancel-btn\"\n            data-role=\"payee-group-modal-detail-cancel-btn\">\n            Cancel\n          </button>\n        </div>\n      </ng-template>\n    </bb-modal-footer-ui>\n  </bb-modal-ui>\n</ng-template>\n\n<ng-template #loadingTemplate>\n  <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"payee-detail-loading\">\n    <bb-loading-indicator-ui></bb-loading-indicator-ui>\n  </div>\n</ng-template>\n\n<ng-template #errorTemplate>\n  <bb-empty-state-ui\n    data-role=\"general-error-state\"\n    title=\"Unknown Error\"\n    i18n-title=\"Title for error state for payee group errors@@payee-group-detail-modal.unknown.title\"\n    subtitle=\"Try to reload the page or contact the system<br> administrator.\"\n    i18n-subtitle=\"Message for error state for payee group errors@@payee-group-detail-modal.unknown.subtitle\"\n    iconSize=\"xxl\"\n    iconModifier=\"error-outline\"></bb-empty-state-ui>\n</ng-template>\n\n<ng-template #empty>\n  <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"payee-group-table-empty-state\">\n    <bb-empty-state-ui\n      iconSize=\"xxl\"\n      iconModifier=\"info\"\n      title=\"No payees found\"\n      i18n-title=\"Label for empty list of payees@@payee-group-detail-modal.empty.title\"\n      subtitle=\"You don't have any payees to be displayed.\"\n      i18n-subtitle=\"Payees empty state message@@payee-group-detail-modal.empty.subtitle\"></bb-empty-state-ui>\n  </div>\n</ng-template>\n"]}