{"version":3,"file":"account-group-detail-modal.component.js","sourceRoot":"","sources":["../../../../../../libs/accessgroup-ui/src/lib/account-group-detail-modal/account-group-detail-modal.component.ts","../../../../../../libs/accessgroup-ui/src/lib/account-group-detail-modal/account-group-detail-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Directive, ChangeDetectionStrategy, Input, Output, EventEmitter } from '@angular/core';\nimport { BbTemplate } from '@backbase/foundation-ang/core';\nimport { BehaviorSubject, combineLatest, merge, Observable, of, ReplaySubject } from 'rxjs';\nimport { auditTime, catchError, map, mapTo, shareReplay, switchMap } from 'rxjs/operators';\nimport {\n  getRouteParams,\n  ServiceAgreementWithParticipants,\n  UserPermissionsDataGroupDetailsService,\n} from '@backbase/accessgroup-common-ang';\nimport { ServiceAgreementParticipantsGetResponseBody } from '@backbase/data-ang/accesscontrol';\nimport { ActivatedRoute } from '@angular/router';\n\nconst ACCOUNT_GROUP_DETAILS_ERROR = 'ACCOUNT_GROUP_DETAILS_ERROR';\n\n@Component({\n  selector: 'bb-account-group-detail-modal',\n  templateUrl: './account-group-detail-modal.component.html',\n  providers: [],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AccountGroupDetailModalComponent {\n  /**\n   * Component context\n   */\n  readonly hostRef: AccountGroupDetailModalComponent = this;\n\n  itemsPerPage = 10;\n\n  /**\n   * Flag to show modal\n   */\n  @Input() isOpen = false;\n\n  @Input() targetSaId = '';\n\n  /**\n   * Account group name\n   */\n  @Input() accountGroupName = '';\n\n  @Input() legalEntityIds = [];\n\n  /**\n   * Setter for account Ids\n   */\n  @Input() set accountIds(val: Array<string> | undefined) {\n    if (val) {\n      this.selectedAccountGroupSubject.next(val);\n      this.selectedAccountGroupAccountsCurrentPageSubject.next(0);\n      this.selectedAccountGroupAccountsSearchQuerySubject.next('');\n    }\n  }\n\n  /**\n   * Event emitter that emits on cancel button click\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  readonly serviceAgreement$: Observable<ServiceAgreementWithParticipants> = getRouteParams(\n    this.activeRoute,\n    'serviceAgreementId',\n  ).pipe(\n    switchMap((id: string | null) => {\n      let idSa = id;\n      if (this.targetSaId && !id) {\n        idSa = this.targetSaId;\n      }\n      return idSa\n        ? this.dataGroupDetailsService.getServiceAgreement(idSa)\n        : this.dataGroupDetailsService.serviceAgreementFromContext;\n    }),\n    shareReplay(1),\n  );\n\n  private readonly selectedAccountGroupAccountsCurrentPageSubject = new BehaviorSubject<number>(0);\n  readonly selectedAccountGroupAccountsCurrentPage$ =\n    this.selectedAccountGroupAccountsCurrentPageSubject.asObservable();\n\n  private readonly selectedAccountGroupAccountsSearchQuerySubject = new BehaviorSubject<string>('');\n  readonly selectedAccountGroupAccountsSearchQuery$ =\n    this.selectedAccountGroupAccountsSearchQuerySubject.asObservable();\n\n  private readonly selectedAccountGroupSubject = new ReplaySubject<any>();\n  readonly selectedAccountGroup$ = this.selectedAccountGroupSubject.asObservable();\n\n  readonly selectedAccountGroupDetails$: Observable<any> = combineLatest([\n    this.selectedAccountGroup$,\n    this.selectedAccountGroupAccountsCurrentPage$,\n    this.selectedAccountGroupAccountsSearchQuery$,\n    this.serviceAgreement$,\n  ]).pipe(\n    auditTime(100),\n    switchMap(([items, from, searchQuery, serviceAgreement]) => {\n      let legalEntityIds: Array<string> = this.legalEntityIds;\n      if (serviceAgreement.participants) {\n        legalEntityIds = [];\n        serviceAgreement.participants.forEach((el: ServiceAgreementParticipantsGetResponseBody) => {\n          if (el.sharingAccounts) {\n            legalEntityIds.push(el.id);\n          }\n        });\n      }\n      if (items.length) {\n        return this.dataGroupDetailsService\n          .getAccountGroupItems({\n            items: items,\n            from: from,\n            size: this.itemsPerPage,\n            searchTerm: searchQuery,\n            legalEntityIds: legalEntityIds,\n          })\n          .pipe(\n            map(accounts => ({\n              data: accounts.items,\n              totalCount: accounts.totalCount,\n            })),\n            catchError(() => {\n              return of(ACCOUNT_GROUP_DETAILS_ERROR);\n            }),\n          );\n      }\n      return of();\n    }),\n    shareReplay(1),\n  );\n\n  readonly selectedAccountGroupError$: Observable<boolean> = this.selectedAccountGroupDetails$.pipe(\n    map((data: any) => data === ACCOUNT_GROUP_DETAILS_ERROR),\n  );\n\n  readonly loadingSelectedAccount$ = merge(\n    this.selectedAccountGroupSubject.pipe(mapTo(true)),\n    this.selectedAccountGroupAccountsCurrentPageSubject.pipe(mapTo(true)),\n    this.selectedAccountGroupAccountsSearchQuerySubject.pipe(mapTo(true)),\n    this.selectedAccountGroupDetails$.pipe(mapTo(false)),\n  );\n\n  constructor(\n    private dataGroupDetailsService: UserPermissionsDataGroupDetailsService,\n    private readonly activeRoute: ActivatedRoute,\n  ) {}\n\n  onCancel() {\n    this.cancel.emit();\n  }\n\n  pageChange(page: number) {\n    this.selectedAccountGroupAccountsCurrentPageSubject.next(page);\n  }\n\n  searchSubmit(query: string) {\n    this.selectedAccountGroupAccountsCurrentPageSubject.next(0);\n    this.selectedAccountGroupAccountsSearchQuerySubject.next(query);\n  }\n}\n\n@Directive({\n  selector: '[bbAccountGroupDetailModalCustomizable]',\n})\nexport class AccountGroupDetailModalCustomizableDirective extends BbTemplate<\n  AccountGroupDetailModalComponent,\n  {\n    selectedAccountGroupDetails: null;\n    loadingSelectedAccount: boolean | null;\n    selectedAccountGroupAccountsCurrentPage: number | null;\n    selectedAccountGroupError: boolean | null;\n    selectedAccountGroup: null;\n  }\n> {}\n","<ng-container\n  bbAccountGroupDetailModalCustomizable\n  [bbHostRef]=\"hostRef\"\n  [bbTemplateContext]=\"{\n    selectedAccountGroupDetails: selectedAccountGroupDetails$ | async,\n    loadingSelectedAccount: loadingSelectedAccount$ | async,\n    selectedAccountGroupAccountsCurrentPage: selectedAccountGroupAccountsCurrentPage$ | async,\n    selectedAccountGroupError: selectedAccountGroupError$ | async,\n    selectedAccountGroup: selectedAccountGroup$ | async\n  }\">\n</ng-container>\n\n<ng-template\n  bbAccountGroupDetailModalCustomizable\n  let-hostRef\n  let-selectedAccountGroupDetails=\"context.selectedAccountGroupDetails\"\n  let-loadingSelectedAccount=\"context.loadingSelectedAccount\"\n  let-selectedAccountGroupAccountsCurrentPage=\"context.selectedAccountGroupAccountsCurrentPage\"\n  let-selectedAccountGroupError=\"context.selectedAccountGroupError\"\n  let-selectedAccountGroup=\"context.selectedAccountGroup\">\n  <bb-modal-ui [isOpen]=\"hostRef.isOpen\" (cancel)=\"hostRef.onCancel()\" data-role=\"account-group-detail-modal\">\n    <bb-modal-header-ui\n      title=\"Detail for {{ hostRef.accountGroupName }}\"\n      i18n-title=\"Title of account group modal detail@account-group-detail-modal.title\"\n      data-role=\"account-modal-title\"></bb-modal-header-ui>\n    <bb-modal-body-ui>\n      <ng-template bbCustomModalBody>\n        <ng-container *ngIf=\"!selectedAccountGroupError; else errorTemplate\">\n          <ng-container *ngIf=\"selectedAccountGroup && selectedAccountGroup.length; else empty\">\n            <div data-role=\"account-group-modal-detail\">\n              <bb-search-box-ui\n                *ngIf=\"hostRef.isOpen\"\n                size=\"md\"\n                placeholder=\"Search\"\n                i18n-placeholder=\"Search placeholder@@account-group-detail-modal.search.placeholder\"\n                [showClear]=\"true\"\n                [showSearch]=\"true\"\n                (clear)=\"hostRef.searchSubmit('')\"\n                (submit)=\"hostRef.searchSubmit($event)\"\n                data-role=\"account-group-table-search\"></bb-search-box-ui>\n              <ng-container *ngIf=\"selectedAccountGroupDetails && !loadingSelectedAccount; else loadingTemplate\">\n                <ng-container *ngIf=\"selectedAccountGroupDetails.data.length; else empty\">\n                  <div class=\"row\">\n                    <div class=\"col-6\">\n                      <span\n                        class=\"bb-subheader bb-subheader--regular bb-text-bold\"\n                        i18n=\"Table header name@@account-group-detail-modal.row.header.name\"\n                        >Name</span\n                      >\n                    </div>\n                    <div class=\"col-4\">\n                      <span\n                        class=\"bb-subheader bb-subheader--regular bb-text-bold\"\n                        i18n=\"Table header name@@account-group-detail-modal.row.header.number\">\n                        Number\n                      </span>\n                    </div>\n\n                    <div class=\"col-2\">\n                      <span\n                        class=\"bb-subheader bb-subheader--regular bb-text-bold\"\n                        i18n=\"Table header name@@account-group-detail-modal.row.header.currency\">\n                        Currency\n                      </span>\n                    </div>\n                  </div>\n                  <hr />\n                  <div *ngFor=\"let account of selectedAccountGroupDetails.data\" data-role=\"account-item\">\n                    <div class=\"row\">\n                      <div class=\"col-6\">\n                        <div data-role=\"account-detail-name\">\n                          {{ account.displayName }}\n                        </div>\n                        <div class=\"bb-text-support text-small\" data-role=\"account-detail-type\">\n                          {{ account.productTypeName }}\n                        </div>\n                      </div>\n                      <div class=\"col-4\">\n                        <span class=\"text-small\" data-role=\"account-detail-number\">\n                          {{ account.IBAN || account.BBAN || account.productNumber || account.number }}\n                        </span>\n                      </div>\n\n                      <div class=\"col-2\">\n                        <span class=\"text-small\" data-role=\"account-detail-currency\">\n                          {{ account.currency }}\n                        </span>\n                      </div>\n                    </div>\n                    <hr />\n                  </div>\n\n                  <bb-pagination-ui\n                    data-role=\"account-group-table-pagination\"\n                    [page]=\"selectedAccountGroupAccountsCurrentPage\"\n                    [boundaryLinks]=\"true\"\n                    [directionLinks]=\"true\"\n                    [totalItems]=\"selectedAccountGroupDetails.totalCount\"\n                    [itemsPerPage]=\"itemsPerPage\"\n                    (pageChange)=\"hostRef.pageChange($event)\"></bb-pagination-ui>\n                </ng-container>\n              </ng-container>\n            </div>\n          </ng-container>\n        </ng-container>\n      </ng-template>\n    </bb-modal-body-ui>\n    <bb-modal-footer-ui>\n      <ng-template bbCustomModalFooter>\n        <div class=\"bb-button-bar\">\n          <button\n            bbButton\n            color=\"secondary\"\n            class=\"bb-button-bar__button\"\n            (click)=\"hostRef.onCancel()\"\n            i18n=\"Cancel button@account-group-detail-modal.cancel-btn\"\n            data-role=\"account-group-modal-detail-cancel-btn\">\n            Cancel\n          </button>\n        </div>\n      </ng-template>\n    </bb-modal-footer-ui>\n  </bb-modal-ui>\n</ng-template>\n\n<ng-template #loadingTemplate>\n  <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"account-detail-loading\">\n    <bb-loading-indicator-ui></bb-loading-indicator-ui>\n  </div>\n</ng-template>\n\n<ng-template #errorTemplate>\n  <bb-empty-state-ui\n    data-role=\"general-error-state\"\n    title=\"Unknown Error\"\n    i18n-title=\"Title for error state for account group errors@@account-group-detail-modal.unknown.title\"\n    subtitle=\"Try to reload the page or contact the system<br> administrator.\"\n    i18n-subtitle=\"Message for error state for account group errors@@account-group-detail-modal.unknown.subtitle\"\n    iconSize=\"xxl\"\n    iconModifier=\"error-outline\"></bb-empty-state-ui>\n</ng-template>\n\n<ng-template #empty>\n  <div class=\"bb-state-container bb-state-container--min-height\" data-role=\"account-group-table-empty-state\">\n    <bb-empty-state-ui\n      iconSize=\"xxl\"\n      iconModifier=\"info\"\n      title=\"No accounts found\"\n      i18n-title=\"Label for empty list of accounts@@account-group-detail-modal.empty.title\"\n      subtitle=\"You don't have any accounts to be displayed.\"\n      i18n-subtitle=\"Accounts empty state message@@account-group-detail-modal.empty.subtitle\"></bb-empty-state-ui>\n  </div>\n</ng-template>\n"]}