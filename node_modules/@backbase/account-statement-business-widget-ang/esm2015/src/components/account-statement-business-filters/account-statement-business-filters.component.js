import { Component, Directive, ViewChild } from '@angular/core';
import { BbTemplate } from '@backbase/foundation-ang/core';
import { filter, first, map, withLatestFrom } from 'rxjs/operators';
import { convertDateObjToDateStruct, CUSTOM_FILTER_PERIODS_VALUES, DatePeriods, } from '@backbase/account-statement-common-ang';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@backbase/account-statement-store-ang";
import * as i3 from "../../services/account-statement-business-properties.service";
import * as i4 from "@backbase/ui-ang/collapsible";
import * as i5 from "@backbase/ui-ang/icon";
import * as i6 from "@backbase/ui-ang/dropdown-single-select";
import * as i7 from "@backbase/ui-ang/input-datepicker";
import * as i8 from "@backbase/ui-ang/input-validation-message";
import * as i9 from "@backbase/ui-ang/dropdown-multi-select";
import * as i10 from "@backbase/ui-ang/button";
import * as i11 from "@angular/common";
export class AccountStatementBusinessFiltersComponent {
    constructor(fb, store, propertiesService) {
        this.fb = fb;
        this.store = store;
        this.propertiesService = propertiesService;
        this.filterDatePeriods = DatePeriods;
        this.areFiltersApplied$ = this.store.accountStatementsFilterParams$.pipe(map(filters => {
            const isDateRangeApplied = !!(filters.dateFrom && filters.dateTo);
            const isCategoryApplied = !!(filters.category && filters.category.length > 0);
            return isDateRangeApplied || isCategoryApplied;
        }));
        this.datePreferences$ = this.initializeDatePreferences;
        this.datePeriodsToDisplay$ = this.initializeFilterDatePeriods;
        this.categories$ = this.store.categories$;
        this.showCategory$ = this.propertiesService.showCategory$;
    }
    ngOnInit() {
        this.store.accountStatementsFilterParams$.pipe(first()).subscribe(params => {
            const { dateFrom: from, dateTo: to, category } = params;
            this.filterForm = this.fb.group({
                bookDate: from && to ? { from, to } : '',
                customFilterPeriods: params.datePeriod,
                categories: [category || []],
            });
        });
    }
    resetForm() {
        this.areFiltersApplied$
            .pipe(first(), filter(Boolean), withLatestFrom(this.propertiesService.pageSize$))
            .subscribe(([, size]) => {
            this.store.dispatchLoadAccountStatementsBusiness({
                paginationParams: {
                    size,
                    from: 0,
                },
                filterParams: {
                    dateFrom: undefined,
                    dateTo: undefined,
                    datePeriod: DatePeriods.AllTime,
                    category: undefined,
                },
            });
        });
        this.filterForm.reset({ customFilterPeriods: this.filterDatePeriods.AllTime });
        this.focusFilterButton();
    }
    focusFilterButton() {
        if (this.filterButton) {
            this.filterButton.nativeElement.focus();
        }
    }
    onSubmit() {
        const customFilterPeriodsFormField = this.filterForm.get('customFilterPeriods');
        const bookDateFormField = this.filterForm.controls.bookDate;
        if (customFilterPeriodsFormField && bookDateFormField.touched) {
            customFilterPeriodsFormField.reset();
        }
        this.applyFormData();
        this.focusFilterButton();
    }
    setCustomFilter() {
        const customFilterPeriodsFormField = this.filterForm.get('customFilterPeriods');
        const bookDateFormField = this.filterForm.get('bookDate');
        const selectedPeriod = customFilterPeriodsFormField && customFilterPeriodsFormField.value;
        const selectedPeriodDates = CUSTOM_FILTER_PERIODS_VALUES[selectedPeriod]();
        const from = selectedPeriodDates.from && selectedPeriodDates.from.toISOString();
        const to = selectedPeriodDates.to && selectedPeriodDates.to.toISOString();
        if (bookDateFormField) {
            const bookDateValue = from && to ? { from, to } : '';
            bookDateFormField.setValue(bookDateValue);
        }
        this.applyFormData();
    }
    applyFormData() {
        const bookDateControl = this.filterForm.get('bookDate');
        const selectedPeriodControl = this.filterForm.get('customFilterPeriods');
        const categoriesControl = this.filterForm.get('categories');
        const selectedPeriodControlValue = selectedPeriodControl && selectedPeriodControl.value;
        const categoriesValue = categoriesControl && categoriesControl.value;
        const { from: dateFrom, to: dateTo } = (bookDateControl && bookDateControl.value) || {};
        this.propertiesService.pageSize$.pipe(first()).subscribe(size => {
            this.store.dispatchLoadAccountStatementsBusiness({
                paginationParams: {
                    size,
                    from: 0,
                },
                filterParams: {
                    dateFrom,
                    dateTo: dateTo || dateFrom,
                    datePeriod: selectedPeriodControlValue || undefined,
                    category: categoriesValue || undefined,
                },
            });
        });
        this.filterForm.markAsPristine();
    }
    get initializeDatePreferences() {
        return this.store.accountStatementsWidgetPreferences$.pipe(map(preferences => ({
            minimalDate: convertDateObjToDateStruct(preferences.minimalDate),
            maximumDate: convertDateObjToDateStruct(preferences.maximumDate),
        })));
    }
    get initializeFilterDatePeriods() {
        return this.store.accountStatementsWidgetPreferences$.pipe(map(preferences => {
            const datePeriodValues = Object.values(DatePeriods);
            return datePeriodValues.filter((value) => {
                const periodValue = CUSTOM_FILTER_PERIODS_VALUES[value]();
                return periodValue.from >= preferences.minimalDate;
            });
        }));
    }
}
AccountStatementBusinessFiltersComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementBusinessFiltersComponent, deps: [{ token: i1.FormBuilder }, { token: i2.AccountStatementStoreModel }, { token: i3.AccountStatementBusinessPropertiesService }], target: i0.ɵɵFactoryTarget.Component });
AccountStatementBusinessFiltersComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: AccountStatementBusinessFiltersComponent, selector: "bb-account-statement-business-filters", viewQueries: [{ propertyName: "filterButton", first: true, predicate: ["filterButton"], descendants: true }], ngImport: i0, template: "<ng-container\n  bbAccountStatementBusinessFiltersCustomizable\n  [bbHostRef]=\"this\"\n  [bbTemplateContext]=\"{\n    areFiltersApplied: (areFiltersApplied$ | async)!,\n    datePreferences: (datePreferences$ | async)!,\n    datePeriodsToDisplay: (datePeriodsToDisplay$ | async)!,\n    showCategory: (showCategory$ | async)!,\n    categories: (categories$ | async)!,\n    filterForm: filterForm\n  }\"\n></ng-container>\n<ng-template\n  bbAccountStatementBusinessFiltersCustomizable\n  let-host\n  let-areFiltersApplied=\"context.areFiltersApplied\"\n  let-filterForm=\"context.filterForm\"\n  let-datePreferences=\"context.datePreferences\"\n  let-datePeriodsToDisplay=\"context.datePeriodsToDisplay\"\n  let-showCategory=\"context.showCategory\"\n  let-categories=\"context.categories\"\n>\n  <bb-collapsible-ui>\n    <form [formGroup]=\"filterForm\">\n      <ng-template bbCollapsibleHeader let-isOpen=\"isOpen\" let-toggle=\"toggle\">\n        <div class=\"bb-block bb-block--md\">\n          <div class=\"bb-stack bb-stack--wrap\">\n            <button\n              class=\"bb-stack__item bb-stack__item--spacing-lg bb-stack__item--push-left-sm-down bb-stack__break--sm-down bb-block bb-block--md-md-down\"\n              bbButton\n              #filterButton\n              data-role=\"collapsible-filter-btn\"\n              [color]=\"areFiltersApplied && !isOpen ? 'primary' : 'secondary'\"\n              [ngClass]=\"{ active: isOpen }\"\n              (click)=\"toggle()\"\n            >\n              <bb-icon-ui [cropped]=\"true\" name=\"filter\"></bb-icon-ui>\n              <span\n                *ngIf=\"areFiltersApplied; else filterButtonTextDefault\"\n                i18n=\"\n                  Filters applied|Filter form button filter\n                  label@@account-statement-business.filters.button.applied-label\"\n              >\n                Filters applied\n              </span>\n              <ng-template #filterButtonTextDefault>\n                <span\n                  i18n=\"Filter|Filter form button filter label@@account-statement-business.filters.button.filter-label\"\n                >\n                  Filter\n                </span>\n              </ng-template>\n            </button>\n\n            <bb-dropdown-single-select-ui\n              (change)=\"host.setCustomFilter()\"\n              class=\"bb-stack__item bb-stack__break--sm-down\"\n              formControlName=\"customFilterPeriods\"\n              [required]=\"false\"\n              [attr.data-role]=\"'dropdown-single-select'\"\n              placeholder=\"Custom\"\n              i18n-placeholder=\"Custom single select placeholder@@bb-dropdown-single-select.custom.placeholder\"\n            >\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.Today) !== -1\"\n                [value]=\"host.filterDatePeriods.Today\"\n                label=\"Today\"\n                i18n-label=\"Today option label@@bb-dropdown-single-select-option-ui.today.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.Yesterday) !== -1\"\n                [value]=\"host.filterDatePeriods.Yesterday\"\n                label=\"Yesterday\"\n                i18n-label=\"Yesterday option label@@bb-dropdown-single-select-option-ui.yesterday.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.ThisWeek) !== -1\"\n                [value]=\"host.filterDatePeriods.ThisWeek\"\n                label=\"This week\"\n                i18n-label=\"This week option label@@bb-dropdown-single-select-option-ui.this-week.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.LastWeek) !== -1\"\n                [value]=\"host.filterDatePeriods.LastWeek\"\n                label=\"Last week\"\n                i18n-label=\"Last week option label@@bb-dropdown-single-select-option-ui.last-week.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.ThisMonth) !== -1\"\n                [value]=\"host.filterDatePeriods.ThisMonth\"\n                label=\"This month\"\n                i18n-label=\"This month option label@@bb-dropdown-single-select-option-ui.this-month.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.LastMonth) !== -1\"\n                [value]=\"host.filterDatePeriods.LastMonth\"\n                label=\"Last month\"\n                i18n-label=\"Last month option label@@bb-dropdown-single-select-option-ui.last-month.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.ThisQuarter) !== -1\"\n                [value]=\"host.filterDatePeriods.ThisQuarter\"\n                label=\"This quarter\"\n                i18n-label=\"This quarter option label@@bb-dropdown-single-select-option-ui.this-quarter.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.LastQuarter) !== -1\"\n                [value]=\"host.filterDatePeriods.LastQuarter\"\n                label=\"Last quarter\"\n                i18n-label=\"Last quarter option label@@bb-dropdown-single-select-option-ui.last-quarter.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                *ngIf=\"datePeriodsToDisplay.indexOf(host.filterDatePeriods.ThisYear) !== -1\"\n                [value]=\"host.filterDatePeriods.ThisYear\"\n                label=\"This year\"\n                i18n-label=\"This year option label@@bb-dropdown-single-select-option-ui.this-year.label\"\n              ></bb-dropdown-single-select-option-ui>\n              <bb-dropdown-single-select-option-ui\n                [value]=\"host.filterDatePeriods.AllTime\"\n                label=\"All time\"\n                i18n-label=\"All time option label@@bb-dropdown-single-select-option-ui.all-time.label\"\n              ></bb-dropdown-single-select-option-ui>\n            </bb-dropdown-single-select-ui>\n          </div>\n        </div>\n      </ng-template>\n\n      <ng-template bbCollapsibleBody let-toggle=\"toggle\">\n        <div\n          class=\"card-body account-statements-filter__form-container account-statements-filter__form-container--no-container\"\n          data-role=\"filter-form\"\n        >\n          <div class=\"row\">\n            <div class=\"bb-block bb-block--md col-12 col-sm-6\">\n              <div class=\"account-statements-filter__date-field-wrapper\">\n                <bb-input-datepicker-ui\n                  i18n-label=\"\n                    Book date|Filter form book date label@@account-statement-business.filters.datepicker-label\"\n                  label=\"Date range\"\n                  labelClasses=\"form-label\"\n                  [rangeSelection]=\"true\"\n                  [minDate]=\"datePreferences.minimalDate\"\n                  [maxDate]=\"datePreferences.maximumDate\"\n                  aria-label=\"Book date\"\n                  i18n-aria-label=\"\n                    Book date filter aria label@@account-statement-business.filters.datepicker.aria-label\"\n                  [attr.aria-invalid]=\"filterForm.controls['bookDate'].hasError('invalidDateFormat')\"\n                  formControlName=\"bookDate\"\n                  data-role=\"book-date\"\n                ></bb-input-datepicker-ui>\n\n                <bb-input-validation-message-ui\n                  class=\"account-statements-filter__validation-message\"\n                  aria-live=\"polite\"\n                  [showErrors]=\"filterForm.controls['bookDate'].hasError('invalidDateFormat')\"\n                >\n                  <span\n                    i18n=\"\n                      Error invalid date format in book date\n                      range@@account-statement-business.filters.datepicker.error.invalid-date-format\"\n                    data-role=\"invalid-book-date-error-message\"\n                    >Invalid date format</span\n                  >\n                </bb-input-validation-message-ui>\n\n                <bb-input-validation-message-ui\n                  class=\"account-statements-filter__validation-message\"\n                  aria-live=\"polite\"\n                  [showErrors]=\"\n                    !host.filterForm.controls['bookDate'].hasError('invalidDateFormat') &&\n                    (host.filterForm.controls['bookDate'].hasError('dateGreaterThanMaxDate') ||\n                      host.filterForm.controls['bookDate'].hasError('dateLessThanMinDate'))\n                  \"\n                >\n                  <span\n                    i18n=\"\n                      Selected date range contains invalid dates\n                      range@@account-statement-business.filters.datepicker.error.dateLessThanMinDate\"\n                    data-role=\"invalid-book-date-limit-error-message\"\n                    >The selected dates include values outside the allowed date range. Please select a date interval in\n                    the permitted time frame.</span\n                  >\n                </bb-input-validation-message-ui>\n              </div>\n            </div>\n            <ng-container *ngIf=\"showCategory\">\n              <bb-dropdown-multi-select-ui\n                *ngIf=\"categories.length\"\n                [formControl]=\"host.filterForm.controls['categories']\"\n                class=\"bb-block bb-block--lg col-12 col-sm-6\"\n                data-role=\"categories-filter\"\n                placeholder=\"Select product category\"\n                i18n-placeholder=\"\n                  Category select placeholder|Category multiple\n                  select@@account-statement-business.filter.form.categories.placeholder\"\n                label=\"Category\"\n                i18n-label=\"\n                  Category label|Category multiple select@@account-statement-business.filter.form.categories.label\"\n              >\n                <bb-dropdown-multi-select-option-ui *ngFor=\"let option of categories\" [label]=\"option\" [value]=\"option\">\n                </bb-dropdown-multi-select-option-ui>\n              </bb-dropdown-multi-select-ui>\n            </ng-container>\n          </div>\n          <div class=\"bb-button-bar\">\n            <button\n              bbButton\n              type=\"submit\"\n              buttonSize=\"sm\"\n              class=\"bb-button-bar__button\"\n              data-role=\"apply\"\n              [disabled]=\"filterForm.pristine || filterForm.invalid\"\n              (click)=\"host.onSubmit(); toggle()\"\n              i18n=\"Apply|Filter form button apply label@@account-statement-business.filters.button.apply-label\"\n            >\n              Apply\n            </button>\n            <button\n              bbButton\n              color=\"secondary\"\n              buttonSize=\"sm\"\n              class=\"bb-button-bar__button\"\n              data-role=\"close\"\n              (click)=\"toggle(); host.focusFilterButton()\"\n              i18n=\"Close|Filter form button close label@@account-statement-business.filters.button.close-label\"\n            >\n              Close\n            </button>\n            <button\n              bbButton\n              color=\"link\"\n              buttonSize=\"sm\"\n              class=\"bb-button-bar__button\"\n              data-role=\"clear-all\"\n              *ngIf=\"filterForm.dirty || areFiltersApplied\"\n              (click)=\"host.resetForm()\"\n              i18n=\"Clear All|Filter form button clear label@@account-statement-business.filters.button.clear-label\"\n            >\n              Clear all\n            </button>\n          </div>\n        </div>\n      </ng-template>\n    </form>\n  </bb-collapsible-ui>\n</ng-template>\n", components: [{ type: i0.forwardRef(function () { return i4.CollapsibleComponent; }), selector: "bb-collapsible-ui", inputs: ["recreateBodyContent", "hasChevron", "isOpen"], outputs: ["isOpenChange"] }, { type: i0.forwardRef(function () { return i5.IconComponent; }), selector: "bb-icon-ui", inputs: ["name", "inverse", "size", "color", "animate", "aria-label", "cropped", "backgroundType"] }, { type: i0.forwardRef(function () { return i6.DropdownSingleSelectComponent; }), selector: "bb-dropdown-single-select-ui", inputs: ["placeholder", "defaultOptionAsPlaceholder", "options", "displayAttributePath", "iconName", "compareWithFn"] }, { type: i0.forwardRef(function () { return i6.DropdownSingleSelectOptionComponent; }), selector: "bb-dropdown-single-select-option-ui", inputs: ["value", "label"] }, { type: i0.forwardRef(function () { return i7.InputDatepickerComponent; }), selector: "bb-input-datepicker-ui", inputs: ["rangeSelection", "rangeSelectionSplit", "clickOpen", "focusOpen", "placement", "datepickerDescribedby", "ariaLabelForButton", "minDate", "maxDate", "markDisabled", "icon", "iconSize", "iconColor", "btnColor", "ariaLabel", "navigation", "autocomplete", "firstDayOfWeek", "displayMonths", "placeholder", "overrideDateFormat"], outputs: ["focusedDate"] }, { type: i0.forwardRef(function () { return i8.InputValidationMessageComponent; }), selector: "bb-input-validation-message-ui", inputs: ["showErrors", "messageId"] }, { type: i0.forwardRef(function () { return i9.DropdownMultiSelectComponent; }), selector: "bb-dropdown-multi-select-ui", inputs: ["dropdownHeaderText", "placeholder", "label", "filtering", "readonly"] }, { type: i0.forwardRef(function () { return i9.DropdownMultiSelectOptionComponent; }), selector: "bb-dropdown-multi-select-option-ui", inputs: ["id", "value", "label", "state"] }], directives: [{ type: i0.forwardRef(function () { return AccountStatementBusinessFiltersCustomizableDirective; }), selector: "[bbAccountStatementBusinessFiltersCustomizable]" }, { type: i0.forwardRef(function () { return i1.ɵNgNoValidate; }), selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i0.forwardRef(function () { return i1.NgControlStatusGroup; }), selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i0.forwardRef(function () { return i1.FormGroupDirective; }), selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i0.forwardRef(function () { return i4.CollapsibleHeaderDirective; }), selector: "ng-template[bbCollapsibleHeader]" }, { type: i0.forwardRef(function () { return i10.ButtonDirective; }), selector: "button[bbButton]", inputs: ["type", "color", "buttonSize", "block", "circle"] }, { type: i0.forwardRef(function () { return i11.NgClass; }), selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i0.forwardRef(function () { return i11.NgIf; }), selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i0.forwardRef(function () { return i1.NgControlStatus; }), selector: "[formControlName],[ngModel],[formControl]" }, { type: i0.forwardRef(function () { return i1.FormControlName; }), selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i0.forwardRef(function () { return i1.RequiredValidator; }), selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i0.forwardRef(function () { return i4.CollapsibleBodyDirective; }), selector: "ng-template[bbCollapsibleBody]" }, { type: i0.forwardRef(function () { return i7.MinDateValidatorDirective; }), selector: "bb-input-datepicker-ui[minDate]", inputs: ["minDate"] }, { type: i0.forwardRef(function () { return i7.MaxDateValidatorDirective; }), selector: "bb-input-datepicker-ui[maxDate]", inputs: ["maxDate"] }, { type: i0.forwardRef(function () { return i1.FormControlDirective; }), selector: "[formControl]", inputs: ["disabled", "formControl", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { type: i0.forwardRef(function () { return i11.NgForOf; }), selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], pipes: { "async": i0.forwardRef(function () { return i11.AsyncPipe; }) } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementBusinessFiltersComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-account-statement-business-filters',
                    templateUrl: './account-statement-business-filters.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }, { type: i2.AccountStatementStoreModel }, { type: i3.AccountStatementBusinessPropertiesService }]; }, propDecorators: { filterButton: [{
                type: ViewChild,
                args: ['filterButton']
            }] } });
export class AccountStatementBusinessFiltersCustomizableDirective extends BbTemplate {
}
AccountStatementBusinessFiltersCustomizableDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementBusinessFiltersCustomizableDirective, deps: null, target: i0.ɵɵFactoryTarget.Directive });
AccountStatementBusinessFiltersCustomizableDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.15", type: AccountStatementBusinessFiltersCustomizableDirective, selector: "[bbAccountStatementBusinessFiltersCustomizable]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: AccountStatementBusinessFiltersCustomizableDirective, decorators: [{
            type: Directive,
            args: [{ selector: '[bbAccountStatementBusinessFiltersCustomizable]' }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MtZmlsdGVycy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLXdpZGdldC1hbmcvc3JjL2NvbXBvbmVudHMvYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MtZmlsdGVycy9hY2NvdW50LXN0YXRlbWVudC1idXNpbmVzcy1maWx0ZXJzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3Mtd2lkZ2V0LWFuZy9zcmMvY29tcG9uZW50cy9hY2NvdW50LXN0YXRlbWVudC1idXNpbmVzcy1maWx0ZXJzL2FjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLWZpbHRlcnMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQXNCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdwRixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFM0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBFLE9BQU8sRUFFTCwwQkFBMEIsRUFDMUIsNEJBQTRCLEVBQzVCLFdBQVcsR0FDWixNQUFNLHdDQUF3QyxDQUFDOzs7Ozs7Ozs7Ozs7O0FBU2hELE1BQU0sT0FBTyx3Q0FBd0M7SUFzQm5ELFlBQ21CLEVBQWUsRUFDZixLQUFpQyxFQUNqQyxpQkFBNEQ7UUFGNUQsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQUNmLFVBQUssR0FBTCxLQUFLLENBQTRCO1FBQ2pDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMkM7UUF0QnRFLHNCQUFpQixHQUFHLFdBQVcsQ0FBQztRQUdoQyx1QkFBa0Is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QUMsV0FBVyxDQUFDLFdBQVcsQ0FBQztTQUNqRSxDQUFDLENBQUMsQ0FDSixDQUFDO0lBQ0osQ0FBQztJQUVELElBQVksMkJBQTJCO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxJQUFJLENBQ3hELEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUNoQixNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDcEQsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFrQixFQUFFLEVBQUU7Z0JBQ3BELE1BQU0sV0FBVyxHQUFHLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxFQUE4QixDQUFDO2dCQUN0RixPQUFPLFdBQVcsQ0FBQyxJQUFJLElBQUksV0FBVyxDQUFDLFdBQVcsQ0FBQztZQUNyRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDOztzSUE3SVUsd0NBQXdDOzBIQUF4Qyx3Q0FBd0MsMkxDckJyRCx1d1lBc1BBLDgxRERoRmEsb0RBQW9EOzRGQWpKcEQsd0NBQXdDO2tCQUpwRCxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSx1Q0FBdUM7b0JBQ2pELFdBQVcsRUFBRSxxREFBcUQ7aUJBQ25FO21NQUU0QixZQUFZO3NCQUF0QyxTQUFTO3VCQUFDLGNBQWM7O0FBZ0ozQixNQUFNLE9BQU8sb0RBQXFELFNBQVEsVUFVekU7O2tKQVZZLG9EQUFvRDtzSUFBcEQsb0RBQW9EOzRGQUFwRCxvREFBb0Q7a0JBRGhFLFNBQVM7bUJBQUMsRUFBRSxRQUFRLEVBQUUsaURBQWlELEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBBY2NvdW50U3RhdGVtZW50U3RvcmVNb2RlbCwgV2lkZ2V0UHJlZmVyZW5jZXMgfSBmcm9tICdAYmFja2Jhc2UvYWNjb3VudC1zdGF0ZW1lbnQtc3RvcmUtYW5nJztcbmltcG9ydCB7IEJiVGVtcGxhdGUgfSBmcm9tICdAYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIGZpcnN0LCBtYXAsIHdpdGhMYXRlc3RGcm9tIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQWNjb3VudFN0YXRlbWVudEJ1c2luZXNzUHJvcGVydGllc1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hY2NvdW50LXN0YXRlbWVudC1idXNpbmVzcy1wcm9wZXJ0aWVzLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgQ2F0ZWdvcmllcyxcbiAgY29udmVydERhdGVPYmpUb0RhdGVTdHJ1Y3QsXG4gIENVU1RPTV9GSUxURVJfUEVSSU9EU19WQUxVRVMsXG4gIERhdGVQZXJpb2RzLFxufSBmcm9tICdAYmFja2Jhc2UvYWNjb3VudC1zdGF0ZW1lbnQtY29tbW9uLWFuZyc7XG5pbXBvcnQgeyBOZ2JEYXRlU3RydWN0IH0gZnJvbSAnQG5nLWJvb3RzdHJhcC9uZy1ib290c3RyYXAnO1xuXG50eXBlIERhdGVQcmVmZXJlbmNlcyA9IFJlY29yZDxrZXlvZiBQaWNrPFdpZGdldFByZWZlcmVuY2VzLCAnbWluaW1hbERhdGUnIHwgJ21heGltdW1EYXRlJz4sIE5nYkRhdGVTdHJ1Y3Q+O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdiYi1hY2NvdW50LXN0YXRlbWVudC1idXNpbmVzcy1maWx0ZXJzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2FjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLWZpbHRlcnMuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NGaWx0ZXJzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQFZpZXdDaGlsZCgnZmlsdGVyQnV0dG9uJykgZmlsdGVyQnV0dG9uPzogRWxlbWVudFJlZjtcblxuICByZWFkb25seSBmaWx0ZXJEYXRlUGVyaW9kcyA9IERhdGVQZXJpb2RzO1xuXG4gIGZpbHRlckZvcm0hOiBGb3JtR3JvdXA7XG4gIHJlYWRvbmx5IGFyZUZpbHRlcnNBcHBsaWVkJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuc3RvcmUuYWNjb3VudFN0YXRlbWVudHNGaWx0ZXJQYXJhbXMkLnBpcGUoXG4gICAgbWFwKGZpbHRlcnMgPT4ge1xuICAgICAgY29uc3QgaXNEYXRlUmFuZ2VBcHBsaWVkID0gISEoZmlsdGVycy5kYXRlRnJvbSAmJiBmaWx0ZXJzLmRhdGVUbyk7XG4gICAgICBjb25zdCBpc0NhdGVnb3J5QXBwbGllZCA9ICEhKGZpbHRlcnMuY2F0ZWdvcnkgJiYgZmlsdGVycy5jYXRlZ29yeS5sZW5ndGggPiAwKTtcbiAgICAgIHJldHVybiBpc0RhdGVSYW5nZUFwcGxpZWQgfHwgaXNDYXRlZ29yeUFwcGxpZWQ7XG4gICAgfSksXG4gICk7XG5cbiAgcmVhZG9ubHkgZGF0ZVByZWZlcmVuY2VzJDogT2JzZXJ2YWJsZTxEYXRlUHJlZmVyZW5jZXM+ID0gdGhpcy5pbml0aWFsaXplRGF0ZVByZWZlcmVuY2VzO1xuXG4gIHJlYWRvbmx5IGRhdGVQZXJpb2RzVG9EaXNwbGF5JDogT2JzZXJ2YWJsZTxzdHJpbmdbXT4gPSB0aGlzLmluaXRpYWxpemVGaWx0ZXJEYXRlUGVyaW9kcztcblxuICByZWFkb25seSBjYXRlZ29yaWVzJDogT2JzZXJ2YWJsZTxDYXRlZ29yaWVzPiA9IHRoaXMuc3RvcmUuY2F0ZWdvcmllcyQ7XG5cbiAgcmVhZG9ubHkgc2hvd0NhdGVnb3J5JCA9IHRoaXMucHJvcGVydGllc1NlcnZpY2Uuc2hvd0NhdGVnb3J5JDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZiOiBGb3JtQnVpbGRlcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IHN0b3JlOiBBY2NvdW50U3RhdGVtZW50U3RvcmVNb2RlbCxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb3BlcnRpZXNTZXJ2aWNlOiBBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NQcm9wZXJ0aWVzU2VydmljZSxcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcmUuYWNjb3VudFN0YXRlbWVudHNGaWx0ZXJQYXJhbXMkLnBpcGUoZmlyc3QoKSkuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XG4gICAgICBjb25zdCB7IGRhdGVGcm9tOiBmcm9tLCBkYXRlVG86IHRvLCBjYXRlZ29yeSB9ID0gcGFyYW1zO1xuICAgICAgdGhpcy5maWx0ZXJGb3JtID0gdGhpcy5mYi5ncm91cCh7XG4gICAgICAgIGJvb2tEYXRlOiBmcm9tICYmIHRvID8geyBmcm9tLCB0byB9IDogJycsXG4gICAgICAgIGN1c3RvbUZpbHRlclBlcmlvZHM6IHBhcmFtcy5kYXRlUGVyaW9kLFxuICAgICAgICBjYXRlZ29yaWVzOiBbY2F0ZWdvcnkgfHwgW11dLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldEZvcm0oKSB7XG4gICAgdGhpcy5hcmVGaWx0ZXJzQXBwbGllZCRcbiAgICAgIC5waXBlKGZpcnN0KCksIGZpbHRlcihCb29sZWFuKSwgd2l0aExhdGVzdEZyb20odGhpcy5wcm9wZXJ0aWVzU2VydmljZS5wYWdlU2l6ZSQpKVxuICAgICAgLnN1YnNjcmliZSgoWywgc2l6ZV0pID0+IHtcbiAgICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaExvYWRBY2NvdW50U3RhdGVtZW50c0J1c2luZXNzKHtcbiAgICAgICAgICBwYWdpbmF0aW9uUGFyYW1zOiB7XG4gICAgICAgICAgICBzaXplLFxuICAgICAgICAgICAgZnJvbTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZpbHRlclBhcmFtczoge1xuICAgICAgICAgICAgZGF0ZUZyb206IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRhdGVUbzogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGF0ZVBlcmlvZDogRGF0ZVBlcmlvZHMuQWxsVGltZSxcbiAgICAgICAgICAgIGNhdGVnb3J5OiB1bmRlZmluZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuZmlsdGVyRm9ybS5yZXNldCh7IGN1c3RvbUZpbHRlclBlcmlvZHM6IHRoaXMuZmlsdGVyRGF0ZVBlcmlvZHMuQWxsVGltZSB9KTtcblxuICAgIHRoaXMuZm9jdXNGaWx0ZXJCdXR0b24oKTtcbiAgfVxuXG4gIGZvY3VzRmlsdGVyQnV0dG9uKCkge1xuICAgIGlmICh0aGlzLmZpbHRlckJ1dHRvbikge1xuICAgICAgdGhpcy5maWx0ZXJCdXR0b24ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIG9uU3VibWl0KCkge1xuICAgIGNvbnN0IGN1c3RvbUZpbHRlclBlcmlvZHNGb3JtRmllbGQgPSB0aGlzLmZpbHRlckZvcm0uZ2V0KCdjdXN0b21GaWx0ZXJQZXJpb2RzJyk7XG4gICAgY29uc3QgYm9va0RhdGVGb3JtRmllbGQgPSB0aGlzLmZpbHRlckZvcm0uY29udHJvbHMuYm9va0RhdGU7XG4gICAgaWYgKGN1c3RvbUZpbHRlclBlcmlvZHNGb3JtRmllbGQgJiYgYm9va0RhdGVGb3JtRmllbGQudG91Y2hlZCkge1xuICAgICAgY3VzdG9tRmlsdGVyUGVyaW9kc0Zvcm1GaWVsZC5yZXNldCgpO1xuICAgIH1cblxuICAgIHRoaXMuYXBwbHlGb3JtRGF0YSgpO1xuICAgIHRoaXMuZm9jdXNGaWx0ZXJCdXR0b24oKTtcbiAgfVxuXG4gIHNldEN1c3RvbUZpbHRlcigpIHtcbiAgICBjb25zdCBjdXN0b21GaWx0ZXJQZXJpb2RzRm9ybUZpZWxkID0gdGhpcy5maWx0ZXJGb3JtLmdldCgnY3VzdG9tRmlsdGVyUGVyaW9kcycpO1xuICAgIGNvbnN0IGJvb2tEYXRlRm9ybUZpZWxkID0gdGhpcy5maWx0ZXJGb3JtLmdldCgnYm9va0RhdGUnKTtcblxuICAgIGNvbnN0IHNlbGVjdGVkUGVyaW9kOiBEYXRlUGVyaW9kcyA9IGN1c3RvbUZpbHRlclBlcmlvZHNGb3JtRmllbGQgJiYgY3VzdG9tRmlsdGVyUGVyaW9kc0Zvcm1GaWVsZC52YWx1ZTtcbiAgICBjb25zdCBzZWxlY3RlZFBlcmlvZERhdGVzID0gQ1VTVE9NX0ZJTFRFUl9QRVJJT0RTX1ZBTFVFU1tzZWxlY3RlZFBlcmlvZF0oKTtcbiAgICBjb25zdCBmcm9tID0gc2VsZWN0ZWRQZXJpb2REYXRlcy5mcm9tICYmIHNlbGVjdGVkUGVyaW9kRGF0ZXMuZnJvbS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHRvID0gc2VsZWN0ZWRQZXJpb2REYXRlcy50byAmJiBzZWxlY3RlZFBlcmlvZERhdGVzLnRvLnRvSVNPU3RyaW5nKCk7XG5cbiAgICBpZiAoYm9va0RhdGVGb3JtRmllbGQpIHtcbiAgICAgIGNvbnN0IGJvb2tEYXRlVmFsdWUgPSBmcm9tICYmIHRvID8geyBmcm9tLCB0byB9IDogJyc7XG4gICAgICBib29rRGF0ZUZvcm1GaWVsZC5zZXRWYWx1ZShib29rRGF0ZVZhbHVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmFwcGx5Rm9ybURhdGEoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXBwbHlGb3JtRGF0YSgpIHtcbiAgICBjb25zdCBib29rRGF0ZUNvbnRyb2wgPSB0aGlzLmZpbHRlckZvcm0uZ2V0KCdib29rRGF0ZScpO1xuICAgIGNvbnN0IHNlbGVjdGVkUGVyaW9kQ29udHJvbCA9IHRoaXMuZmlsdGVyRm9ybS5nZXQoJ2N1c3RvbUZpbHRlclBlcmlvZHMnKTtcbiAgICBjb25zdCBjYXRlZ29yaWVzQ29udHJvbCA9IHRoaXMuZmlsdGVyRm9ybS5nZXQoJ2NhdGVnb3JpZXMnKTtcbiAgICBjb25zdCBzZWxlY3RlZFBlcmlvZENvbnRyb2xWYWx1ZSA9IHNlbGVjdGVkUGVyaW9kQ29udHJvbCAmJiBzZWxlY3RlZFBlcmlvZENvbnRyb2wudmFsdWU7XG4gICAgY29uc3QgY2F0ZWdvcmllc1ZhbHVlID0gY2F0ZWdvcmllc0NvbnRyb2wgJiYgY2F0ZWdvcmllc0NvbnRyb2wudmFsdWU7XG4gICAgY29uc3QgeyBmcm9tOiBkYXRlRnJvbSwgdG86IGRhdGVUbyB9ID0gKGJvb2tEYXRlQ29udHJvbCAmJiBib29rRGF0ZUNvbnRyb2wudmFsdWUpIHx8IHt9O1xuXG4gICAgdGhpcy5wcm9wZXJ0aWVzU2VydmljZS5wYWdlU2l6ZSQucGlwZShmaXJzdCgpKS5zdWJzY3JpYmUoc2l6ZSA9PiB7XG4gICAgICB0aGlzLnN0b3JlLmRpc3BhdGNoTG9hZEFjY291bnRTdGF0ZW1lbnRzQnVzaW5lc3Moe1xuICAgICAgICBwYWdpbmF0aW9uUGFyYW1zOiB7XG4gICAgICAgICAgc2l6ZSxcbiAgICAgICAgICBmcm9tOiAwLFxuICAgICAgICB9LFxuICAgICAgICBmaWx0ZXJQYXJhbXM6IHtcbiAgICAgICAgICBkYXRlRnJvbSxcbiAgICAgICAgICBkYXRlVG86IGRhdGVUbyB8fCBkYXRlRnJvbSxcbiAgICAgICAgICBkYXRlUGVyaW9kOiBzZWxlY3RlZFBlcmlvZENvbnRyb2xWYWx1ZSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3JpZXNWYWx1ZSB8fCB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMuZmlsdGVyRm9ybS5tYXJrQXNQcmlzdGluZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaW5pdGlhbGl6ZURhdGVQcmVmZXJlbmNlcygpOiBPYnNlcnZhYmxlPERhdGVQcmVmZXJlbmNlcz4ge1xuICAgIHJldHVybiB0aGlzLnN0b3JlLmFjY291bnRTdGF0ZW1lbnRzV2lkZ2V0UHJlZmVyZW5jZXMkLnBpcGUoXG4gICAgICBtYXAocHJlZmVyZW5jZXMgPT4gKHtcbiAgICAgICAgbWluaW1hbERhdGU6IGNvbnZlcnREYXRlT2JqVG9EYXRlU3RydWN0KHByZWZlcmVuY2VzLm1pbmltYWxEYXRlKSxcbiAgICAgICAgbWF4aW11bURhdGU6IGNvbnZlcnREYXRlT2JqVG9EYXRlU3RydWN0KHByZWZlcmVuY2VzLm1heGltdW1EYXRlKSxcbiAgICAgIH0pKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaW5pdGlhbGl6ZUZpbHRlckRhdGVQZXJpb2RzKCk6IE9ic2VydmFibGU8c3RyaW5nW10+IHtcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5hY2NvdW50U3RhdGVtZW50c1dpZGdldFByZWZlcmVuY2VzJC5waXBlKFxuICAgICAgbWFwKHByZWZlcmVuY2VzID0+IHtcbiAgICAgICAgY29uc3QgZGF0ZVBlcmlvZFZhbHVlcyA9IE9iamVjdC52YWx1ZXMoRGF0ZVBlcmlvZHMpO1xuICAgICAgICByZXR1cm4gZGF0ZVBlcmlvZFZhbHVlcy5maWx0ZXIoKHZhbHVlOiBEYXRlUGVyaW9kcykgPT4ge1xuICAgICAgICAgIGNvbnN0IHBlcmlvZFZhbHVlID0gQ1VTVE9NX0ZJTFRFUl9QRVJJT0RTX1ZBTFVFU1t2YWx1ZV0oKSBhcyB7IGZyb206IERhdGU7IHRvOiBEYXRlIH07XG4gICAgICAgICAgcmV0dXJuIHBlcmlvZFZhbHVlLmZyb20gPj0gcHJlZmVyZW5jZXMubWluaW1hbERhdGU7XG4gICAgICAgIH0pO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxufVxuXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbYmJBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NGaWx0ZXJzQ3VzdG9taXphYmxlXScgfSlcbmV4cG9ydCBjbGFzcyBBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NGaWx0ZXJzQ3VzdG9taXphYmxlRGlyZWN0aXZlIGV4dGVuZHMgQmJUZW1wbGF0ZTxcbiAgQWNjb3VudFN0YXRlbWVudEJ1c2luZXNzRmlsdGVyc0NvbXBvbmVudCxcbiAge1xuICAgIGFyZUZpbHRlcnNBcHBsaWVkOiBib29sZWFuO1xuICAgIGZpbHRlckZvcm06IEZvcm1Hcm91cDtcbiAgICBkYXRlUHJlZmVyZW5jZXM6IERhdGVQcmVmZXJlbmNlcztcbiAgICBkYXRlUGVyaW9kc1RvRGlzcGxheTogc3RyaW5nW107XG4gICAgY2F0ZWdvcmllczogQ2F0ZWdvcmllcztcbiAgICBzaG93Q2F0ZWdvcnk6IGJvb2xlYW47XG4gIH1cbj4ge31cbiIsIjxuZy1jb250YWluZXJcbiAgYmJBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NGaWx0ZXJzQ3VzdG9taXphYmxlXG4gIFtiYkhvc3RSZWZdPVwidGhpc1wiXG4gIFtiYlRlbXBsYXRlQ29udGV4dF09XCJ7XG4gICAgYXJlRmlsdGVyc0FwcGxpZWQ6IChhcmVGaWx0ZXJzQXBwbGllZCQgfCBhc3luYykhLFxuICAgIGRhdGVQcmVmZXJlbmNlczogKGRhdGVQcmVmZXJlbmNlcyQgfCBhc3luYykhLFxuICAgIGRhdGVQZXJpb2RzVG9EaXNwbGF5OiAoZGF0ZVBlcmlvZHNUb0Rpc3BsYXkkIHwgYXN5bmMpISxcbiAgICBzaG93Q2F0ZWdvcnk6IChzaG93Q2F0ZWdvcnkkIHwgYXN5bmMpISxcbiAgICBjYXRlZ29yaWVzOiAoY2F0ZWdvcmllcyQgfCBhc3luYykhLFxuICAgIGZpbHRlckZvcm06IGZpbHRlckZvcm1cbiAgfVwiXG4+PC9uZy1jb250YWluZXI+XG48bmctdGVtcGxhdGVcbiAgYmJBY2NvdW50U3RhdGVtZW50QnVzaW5lc3NGaWx0ZXJzQ3VzdG9taXphYmxlXG4gIGxldC1ob3N0XG4gIGxldC1hcmVGaWx0ZXJzQXBwbGllZD1cImNvbnRleHQuYXJlRmlsdGVyc0FwcGxpZWRcIlxuICBsZXQtZmlsdGVyRm9ybT1cImNvbnRleHQuZmlsdGVyRm9ybVwiXG4gIGxldC1kYXRlUHJlZmVyZW5jZXM9XCJjb250ZXh0LmRhdGVQcmVmZXJlbmNlc1wiXG4gIGxldC1kYXRlUGVyaW9kc1RvRGlzcGxheT1cImNvbnRleHQuZGF0ZVBlcmlvZHNUb0Rpc3BsYXlcIlxuICBsZXQtc2hvd0NhdGVnb3J5PVwiY29udGV4dC5zaG93Q2F0ZWdvcnlcIlxuICBsZXQtY2F0ZWdvcmllcz1cImNvbnRleHQuY2F0ZWdvcmllc1wiXG4+XG4gIDxiYi1jb2xsYXBzaWJsZS11aT5cbiAgICA8Zm9ybSBbZm9ybUdyb3VwXT1cImZpbHRlckZvcm1cIj5cbiAgICAgIDxuZy10ZW1wbGF0ZSBiYkNvbGxhcHNpYmxlSGVhZGVyIGxldC1pc09wZW49XCJpc09wZW5cIiBsZXQtdG9nZ2xlPVwidG9nZ2xlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0tbWRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmItc3RhY2sgYmItc3RhY2stLXdyYXBcIj5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgY2xhc3M9XCJiYi1zdGFja19faXRlbSBiYi1zdGFja19faXRlbS0tc3BhY2luZy1sZyBiYi1zdGFja19faXRlbS0tcHVzaC1sZWZ0LXNtLWRvd24gYmItc3RhY2tfX2JyZWFrLS1zbS1kb3duIGJiLWJsb2NrIGJiLWJsb2NrLS1tZC1tZC1kb3duXCJcbiAgICAgICAgICAgICAgYmJCdXR0b25cbiAgICAgICAgICAgICAgI2ZpbHRlckJ1dHRvblxuICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJjb2xsYXBzaWJsZS1maWx0ZXItYnRuXCJcbiAgICAgICAgICAgICAgW2NvbG9yXT1cImFyZUZpbHRlcnNBcHBsaWVkICYmICFpc09wZW4gPyAncHJpbWFyeScgOiAnc2Vjb25kYXJ5J1wiXG4gICAgICAgICAgICAgIFtuZ0NsYXNzXT1cInsgYWN0aXZlOiBpc09wZW4gfVwiXG4gICAgICAgICAgICAgIChjbGljayk9XCJ0b2dnbGUoKVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxiYi1pY29uLXVpIFtjcm9wcGVkXT1cInRydWVcIiBuYW1lPVwiZmlsdGVyXCI+PC9iYi1pY29uLXVpPlxuICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICpuZ0lmPVwiYXJlRmlsdGVyc0FwcGxpZWQ7IGVsc2UgZmlsdGVyQnV0dG9uVGV4dERlZmF1bHRcIlxuICAgICAgICAgICAgICAgIGkxOG49XCJcbiAgICAgICAgICAgICAgICAgIEZpbHRlcnMgYXBwbGllZHxGaWx0ZXIgZm9ybSBidXR0b24gZmlsdGVyXG4gICAgICAgICAgICAgICAgICBsYWJlbEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5idXR0b24uYXBwbGllZC1sYWJlbFwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICBGaWx0ZXJzIGFwcGxpZWRcbiAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgI2ZpbHRlckJ1dHRvblRleHREZWZhdWx0PlxuICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICBpMThuPVwiRmlsdGVyfEZpbHRlciBmb3JtIGJ1dHRvbiBmaWx0ZXIgbGFiZWxAQGFjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLmZpbHRlcnMuYnV0dG9uLmZpbHRlci1sYWJlbFwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgRmlsdGVyXG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgICAgIDxiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LXVpXG4gICAgICAgICAgICAgIChjaGFuZ2UpPVwiaG9zdC5zZXRDdXN0b21GaWx0ZXIoKVwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiYmItc3RhY2tfX2l0ZW0gYmItc3RhY2tfX2JyZWFrLS1zbS1kb3duXCJcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwiY3VzdG9tRmlsdGVyUGVyaW9kc1wiXG4gICAgICAgICAgICAgIFtyZXF1aXJlZF09XCJmYWxzZVwiXG4gICAgICAgICAgICAgIFthdHRyLmRhdGEtcm9sZV09XCInZHJvcGRvd24tc2luZ2xlLXNlbGVjdCdcIlxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIkN1c3RvbVwiXG4gICAgICAgICAgICAgIGkxOG4tcGxhY2Vob2xkZXI9XCJDdXN0b20gc2luZ2xlIHNlbGVjdCBwbGFjZWhvbGRlckBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC5jdXN0b20ucGxhY2Vob2xkZXJcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8YmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWlcbiAgICAgICAgICAgICAgICAqbmdJZj1cImRhdGVQZXJpb2RzVG9EaXNwbGF5LmluZGV4T2YoaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5Ub2RheSkgIT09IC0xXCJcbiAgICAgICAgICAgICAgICBbdmFsdWVdPVwiaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5Ub2RheVwiXG4gICAgICAgICAgICAgICAgbGFiZWw9XCJUb2RheVwiXG4gICAgICAgICAgICAgICAgaTE4bi1sYWJlbD1cIlRvZGF5IG9wdGlvbiBsYWJlbEBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWkudG9kYXkubGFiZWxcIlxuICAgICAgICAgICAgICA+PC9iYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aT5cbiAgICAgICAgICAgICAgPGJiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJkYXRlUGVyaW9kc1RvRGlzcGxheS5pbmRleE9mKGhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuWWVzdGVyZGF5KSAhPT0gLTFcIlxuICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJob3N0LmZpbHRlckRhdGVQZXJpb2RzLlllc3RlcmRheVwiXG4gICAgICAgICAgICAgICAgbGFiZWw9XCJZZXN0ZXJkYXlcIlxuICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJZZXN0ZXJkYXkgb3B0aW9uIGxhYmVsQEBiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aS55ZXN0ZXJkYXkubGFiZWxcIlxuICAgICAgICAgICAgICA+PC9iYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aT5cbiAgICAgICAgICAgICAgPGJiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJkYXRlUGVyaW9kc1RvRGlzcGxheS5pbmRleE9mKGhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuVGhpc1dlZWspICE9PSAtMVwiXG4gICAgICAgICAgICAgICAgW3ZhbHVlXT1cImhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuVGhpc1dlZWtcIlxuICAgICAgICAgICAgICAgIGxhYmVsPVwiVGhpcyB3ZWVrXCJcbiAgICAgICAgICAgICAgICBpMThuLWxhYmVsPVwiVGhpcyB3ZWVrIG9wdGlvbiBsYWJlbEBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWkudGhpcy13ZWVrLmxhYmVsXCJcbiAgICAgICAgICAgICAgPjwvYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWk+XG4gICAgICAgICAgICAgIDxiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aVxuICAgICAgICAgICAgICAgICpuZ0lmPVwiZGF0ZVBlcmlvZHNUb0Rpc3BsYXkuaW5kZXhPZihob3N0LmZpbHRlckRhdGVQZXJpb2RzLkxhc3RXZWVrKSAhPT0gLTFcIlxuICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJob3N0LmZpbHRlckRhdGVQZXJpb2RzLkxhc3RXZWVrXCJcbiAgICAgICAgICAgICAgICBsYWJlbD1cIkxhc3Qgd2Vla1wiXG4gICAgICAgICAgICAgICAgaTE4bi1sYWJlbD1cIkxhc3Qgd2VlayBvcHRpb24gbGFiZWxAQGJiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpLmxhc3Qtd2Vlay5sYWJlbFwiXG4gICAgICAgICAgICAgID48L2JiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpPlxuICAgICAgICAgICAgICA8YmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWlcbiAgICAgICAgICAgICAgICAqbmdJZj1cImRhdGVQZXJpb2RzVG9EaXNwbGF5LmluZGV4T2YoaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5UaGlzTW9udGgpICE9PSAtMVwiXG4gICAgICAgICAgICAgICAgW3ZhbHVlXT1cImhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuVGhpc01vbnRoXCJcbiAgICAgICAgICAgICAgICBsYWJlbD1cIlRoaXMgbW9udGhcIlxuICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJUaGlzIG1vbnRoIG9wdGlvbiBsYWJlbEBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWkudGhpcy1tb250aC5sYWJlbFwiXG4gICAgICAgICAgICAgID48L2JiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpPlxuICAgICAgICAgICAgICA8YmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWlcbiAgICAgICAgICAgICAgICAqbmdJZj1cImRhdGVQZXJpb2RzVG9EaXNwbGF5LmluZGV4T2YoaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5MYXN0TW9udGgpICE9PSAtMVwiXG4gICAgICAgICAgICAgICAgW3ZhbHVlXT1cImhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuTGFzdE1vbnRoXCJcbiAgICAgICAgICAgICAgICBsYWJlbD1cIkxhc3QgbW9udGhcIlxuICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJMYXN0IG1vbnRoIG9wdGlvbiBsYWJlbEBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWkubGFzdC1tb250aC5sYWJlbFwiXG4gICAgICAgICAgICAgID48L2JiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpPlxuICAgICAgICAgICAgICA8YmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWlcbiAgICAgICAgICAgICAgICAqbmdJZj1cImRhdGVQZXJpb2RzVG9EaXNwbGF5LmluZGV4T2YoaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5UaGlzUXVhcnRlcikgIT09IC0xXCJcbiAgICAgICAgICAgICAgICBbdmFsdWVdPVwiaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5UaGlzUXVhcnRlclwiXG4gICAgICAgICAgICAgICAgbGFiZWw9XCJUaGlzIHF1YXJ0ZXJcIlxuICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJUaGlzIHF1YXJ0ZXIgb3B0aW9uIGxhYmVsQEBiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aS50aGlzLXF1YXJ0ZXIubGFiZWxcIlxuICAgICAgICAgICAgICA+PC9iYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aT5cbiAgICAgICAgICAgICAgPGJiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJkYXRlUGVyaW9kc1RvRGlzcGxheS5pbmRleE9mKGhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuTGFzdFF1YXJ0ZXIpICE9PSAtMVwiXG4gICAgICAgICAgICAgICAgW3ZhbHVlXT1cImhvc3QuZmlsdGVyRGF0ZVBlcmlvZHMuTGFzdFF1YXJ0ZXJcIlxuICAgICAgICAgICAgICAgIGxhYmVsPVwiTGFzdCBxdWFydGVyXCJcbiAgICAgICAgICAgICAgICBpMThuLWxhYmVsPVwiTGFzdCBxdWFydGVyIG9wdGlvbiBsYWJlbEBAYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWkubGFzdC1xdWFydGVyLmxhYmVsXCJcbiAgICAgICAgICAgICAgPjwvYmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWk+XG4gICAgICAgICAgICAgIDxiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aVxuICAgICAgICAgICAgICAgICpuZ0lmPVwiZGF0ZVBlcmlvZHNUb0Rpc3BsYXkuaW5kZXhPZihob3N0LmZpbHRlckRhdGVQZXJpb2RzLlRoaXNZZWFyKSAhPT0gLTFcIlxuICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJob3N0LmZpbHRlckRhdGVQZXJpb2RzLlRoaXNZZWFyXCJcbiAgICAgICAgICAgICAgICBsYWJlbD1cIlRoaXMgeWVhclwiXG4gICAgICAgICAgICAgICAgaTE4bi1sYWJlbD1cIlRoaXMgeWVhciBvcHRpb24gbGFiZWxAQGJiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpLnRoaXMteWVhci5sYWJlbFwiXG4gICAgICAgICAgICAgID48L2JiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpPlxuICAgICAgICAgICAgICA8YmItZHJvcGRvd24tc2luZ2xlLXNlbGVjdC1vcHRpb24tdWlcbiAgICAgICAgICAgICAgICBbdmFsdWVdPVwiaG9zdC5maWx0ZXJEYXRlUGVyaW9kcy5BbGxUaW1lXCJcbiAgICAgICAgICAgICAgICBsYWJlbD1cIkFsbCB0aW1lXCJcbiAgICAgICAgICAgICAgICBpMThuLWxhYmVsPVwiQWxsIHRpbWUgb3B0aW9uIGxhYmVsQEBiYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LW9wdGlvbi11aS5hbGwtdGltZS5sYWJlbFwiXG4gICAgICAgICAgICAgID48L2JiLWRyb3Bkb3duLXNpbmdsZS1zZWxlY3Qtb3B0aW9uLXVpPlxuICAgICAgICAgICAgPC9iYi1kcm9wZG93bi1zaW5nbGUtc2VsZWN0LXVpPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbmctdGVtcGxhdGU+XG5cbiAgICAgIDxuZy10ZW1wbGF0ZSBiYkNvbGxhcHNpYmxlQm9keSBsZXQtdG9nZ2xlPVwidG9nZ2xlXCI+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cImNhcmQtYm9keSBhY2NvdW50LXN0YXRlbWVudHMtZmlsdGVyX19mb3JtLWNvbnRhaW5lciBhY2NvdW50LXN0YXRlbWVudHMtZmlsdGVyX19mb3JtLWNvbnRhaW5lci0tbm8tY29udGFpbmVyXCJcbiAgICAgICAgICBkYXRhLXJvbGU9XCJmaWx0ZXItZm9ybVwiXG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYmxvY2sgYmItYmxvY2stLW1kIGNvbC0xMiBjb2wtc20tNlwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWNjb3VudC1zdGF0ZW1lbnRzLWZpbHRlcl9fZGF0ZS1maWVsZC13cmFwcGVyXCI+XG4gICAgICAgICAgICAgICAgPGJiLWlucHV0LWRhdGVwaWNrZXItdWlcbiAgICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJcbiAgICAgICAgICAgICAgICAgICAgQm9vayBkYXRlfEZpbHRlciBmb3JtIGJvb2sgZGF0ZSBsYWJlbEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5kYXRlcGlja2VyLWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgIGxhYmVsPVwiRGF0ZSByYW5nZVwiXG4gICAgICAgICAgICAgICAgICBsYWJlbENsYXNzZXM9XCJmb3JtLWxhYmVsXCJcbiAgICAgICAgICAgICAgICAgIFtyYW5nZVNlbGVjdGlvbl09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgICAgIFttaW5EYXRlXT1cImRhdGVQcmVmZXJlbmNlcy5taW5pbWFsRGF0ZVwiXG4gICAgICAgICAgICAgICAgICBbbWF4RGF0ZV09XCJkYXRlUHJlZmVyZW5jZXMubWF4aW11bURhdGVcIlxuICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIkJvb2sgZGF0ZVwiXG4gICAgICAgICAgICAgICAgICBpMThuLWFyaWEtbGFiZWw9XCJcbiAgICAgICAgICAgICAgICAgICAgQm9vayBkYXRlIGZpbHRlciBhcmlhIGxhYmVsQEBhY2NvdW50LXN0YXRlbWVudC1idXNpbmVzcy5maWx0ZXJzLmRhdGVwaWNrZXIuYXJpYS1sYWJlbFwiXG4gICAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVwiZmlsdGVyRm9ybS5jb250cm9sc1snYm9va0RhdGUnXS5oYXNFcnJvcignaW52YWxpZERhdGVGb3JtYXQnKVwiXG4gICAgICAgICAgICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJib29rRGF0ZVwiXG4gICAgICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJib29rLWRhdGVcIlxuICAgICAgICAgICAgICAgID48L2JiLWlucHV0LWRhdGVwaWNrZXItdWk+XG5cbiAgICAgICAgICAgICAgICA8YmItaW5wdXQtdmFsaWRhdGlvbi1tZXNzYWdlLXVpXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cImFjY291bnQtc3RhdGVtZW50cy1maWx0ZXJfX3ZhbGlkYXRpb24tbWVzc2FnZVwiXG4gICAgICAgICAgICAgICAgICBhcmlhLWxpdmU9XCJwb2xpdGVcIlxuICAgICAgICAgICAgICAgICAgW3Nob3dFcnJvcnNdPVwiZmlsdGVyRm9ybS5jb250cm9sc1snYm9va0RhdGUnXS5oYXNFcnJvcignaW52YWxpZERhdGVGb3JtYXQnKVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgaTE4bj1cIlxuICAgICAgICAgICAgICAgICAgICAgIEVycm9yIGludmFsaWQgZGF0ZSBmb3JtYXQgaW4gYm9vayBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgcmFuZ2VAQGFjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLmZpbHRlcnMuZGF0ZXBpY2tlci5lcnJvci5pbnZhbGlkLWRhdGUtZm9ybWF0XCJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS1yb2xlPVwiaW52YWxpZC1ib29rLWRhdGUtZXJyb3ItbWVzc2FnZVwiXG4gICAgICAgICAgICAgICAgICAgID5JbnZhbGlkIGRhdGUgZm9ybWF0PC9zcGFuXG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPC9iYi1pbnB1dC12YWxpZGF0aW9uLW1lc3NhZ2UtdWk+XG5cbiAgICAgICAgICAgICAgICA8YmItaW5wdXQtdmFsaWRhdGlvbi1tZXNzYWdlLXVpXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cImFjY291bnQtc3RhdGVtZW50cy1maWx0ZXJfX3ZhbGlkYXRpb24tbWVzc2FnZVwiXG4gICAgICAgICAgICAgICAgICBhcmlhLWxpdmU9XCJwb2xpdGVcIlxuICAgICAgICAgICAgICAgICAgW3Nob3dFcnJvcnNdPVwiXG4gICAgICAgICAgICAgICAgICAgICFob3N0LmZpbHRlckZvcm0uY29udHJvbHNbJ2Jvb2tEYXRlJ10uaGFzRXJyb3IoJ2ludmFsaWREYXRlRm9ybWF0JykgJiZcbiAgICAgICAgICAgICAgICAgICAgKGhvc3QuZmlsdGVyRm9ybS5jb250cm9sc1snYm9va0RhdGUnXS5oYXNFcnJvcignZGF0ZUdyZWF0ZXJUaGFuTWF4RGF0ZScpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgaG9zdC5maWx0ZXJGb3JtLmNvbnRyb2xzWydib29rRGF0ZSddLmhhc0Vycm9yKCdkYXRlTGVzc1RoYW5NaW5EYXRlJykpXG4gICAgICAgICAgICAgICAgICBcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgIGkxOG49XCJcbiAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZCBkYXRlIHJhbmdlIGNvbnRhaW5zIGludmFsaWQgZGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgICByYW5nZUBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5kYXRlcGlja2VyLmVycm9yLmRhdGVMZXNzVGhhbk1pbkRhdGVcIlxuICAgICAgICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJpbnZhbGlkLWJvb2stZGF0ZS1saW1pdC1lcnJvci1tZXNzYWdlXCJcbiAgICAgICAgICAgICAgICAgICAgPlRoZSBzZWxlY3RlZCBkYXRlcyBpbmNsdWRlIHZhbHVlcyBvdXRzaWRlIHRoZSBhbGxvd2VkIGRhdGUgcmFuZ2UuIFBsZWFzZSBzZWxlY3QgYSBkYXRlIGludGVydmFsIGluXG4gICAgICAgICAgICAgICAgICAgIHRoZSBwZXJtaXR0ZWQgdGltZSBmcmFtZS48L3NwYW5cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8L2JiLWlucHV0LXZhbGlkYXRpb24tbWVzc2FnZS11aT5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJzaG93Q2F0ZWdvcnlcIj5cbiAgICAgICAgICAgICAgPGJiLWRyb3Bkb3duLW11bHRpLXNlbGVjdC11aVxuICAgICAgICAgICAgICAgICpuZ0lmPVwiY2F0ZWdvcmllcy5sZW5ndGhcIlxuICAgICAgICAgICAgICAgIFtmb3JtQ29udHJvbF09XCJob3N0LmZpbHRlckZvcm0uY29udHJvbHNbJ2NhdGVnb3JpZXMnXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJiYi1ibG9jayBiYi1ibG9jay0tbGcgY29sLTEyIGNvbC1zbS02XCJcbiAgICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJjYXRlZ29yaWVzLWZpbHRlclwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZWxlY3QgcHJvZHVjdCBjYXRlZ29yeVwiXG4gICAgICAgICAgICAgICAgaTE4bi1wbGFjZWhvbGRlcj1cIlxuICAgICAgICAgICAgICAgICAgQ2F0ZWdvcnkgc2VsZWN0IHBsYWNlaG9sZGVyfENhdGVnb3J5IG11bHRpcGxlXG4gICAgICAgICAgICAgICAgICBzZWxlY3RAQGFjY291bnQtc3RhdGVtZW50LWJ1c2luZXNzLmZpbHRlci5mb3JtLmNhdGVnb3JpZXMucGxhY2Vob2xkZXJcIlxuICAgICAgICAgICAgICAgIGxhYmVsPVwiQ2F0ZWdvcnlcIlxuICAgICAgICAgICAgICAgIGkxOG4tbGFiZWw9XCJcbiAgICAgICAgICAgICAgICAgIENhdGVnb3J5IGxhYmVsfENhdGVnb3J5IG11bHRpcGxlIHNlbGVjdEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVyLmZvcm0uY2F0ZWdvcmllcy5sYWJlbFwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8YmItZHJvcGRvd24tbXVsdGktc2VsZWN0LW9wdGlvbi11aSAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGNhdGVnb3JpZXNcIiBbbGFiZWxdPVwib3B0aW9uXCIgW3ZhbHVlXT1cIm9wdGlvblwiPlxuICAgICAgICAgICAgICAgIDwvYmItZHJvcGRvd24tbXVsdGktc2VsZWN0LW9wdGlvbi11aT5cbiAgICAgICAgICAgICAgPC9iYi1kcm9wZG93bi1tdWx0aS1zZWxlY3QtdWk+XG4gICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYmItYnV0dG9uLWJhclwiPlxuICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICBiYkJ1dHRvblxuICAgICAgICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgICAgICAgYnV0dG9uU2l6ZT1cInNtXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJiYi1idXR0b24tYmFyX19idXR0b25cIlxuICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJhcHBseVwiXG4gICAgICAgICAgICAgIFtkaXNhYmxlZF09XCJmaWx0ZXJGb3JtLnByaXN0aW5lIHx8IGZpbHRlckZvcm0uaW52YWxpZFwiXG4gICAgICAgICAgICAgIChjbGljayk9XCJob3N0Lm9uU3VibWl0KCk7IHRvZ2dsZSgpXCJcbiAgICAgICAgICAgICAgaTE4bj1cIkFwcGx5fEZpbHRlciBmb3JtIGJ1dHRvbiBhcHBseSBsYWJlbEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5idXR0b24uYXBwbHktbGFiZWxcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBBcHBseVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgICAgIGNvbG9yPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgYnV0dG9uU2l6ZT1cInNtXCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJiYi1idXR0b24tYmFyX19idXR0b25cIlxuICAgICAgICAgICAgICBkYXRhLXJvbGU9XCJjbG9zZVwiXG4gICAgICAgICAgICAgIChjbGljayk9XCJ0b2dnbGUoKTsgaG9zdC5mb2N1c0ZpbHRlckJ1dHRvbigpXCJcbiAgICAgICAgICAgICAgaTE4bj1cIkNsb3NlfEZpbHRlciBmb3JtIGJ1dHRvbiBjbG9zZSBsYWJlbEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5idXR0b24uY2xvc2UtbGFiZWxcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBDbG9zZVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIGJiQnV0dG9uXG4gICAgICAgICAgICAgIGNvbG9yPVwibGlua1wiXG4gICAgICAgICAgICAgIGJ1dHRvblNpemU9XCJzbVwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiYmItYnV0dG9uLWJhcl9fYnV0dG9uXCJcbiAgICAgICAgICAgICAgZGF0YS1yb2xlPVwiY2xlYXItYWxsXCJcbiAgICAgICAgICAgICAgKm5nSWY9XCJmaWx0ZXJGb3JtLmRpcnR5IHx8IGFyZUZpbHRlcnNBcHBsaWVkXCJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cImhvc3QucmVzZXRGb3JtKClcIlxuICAgICAgICAgICAgICBpMThuPVwiQ2xlYXIgQWxsfEZpbHRlciBmb3JtIGJ1dHRvbiBjbGVhciBsYWJlbEBAYWNjb3VudC1zdGF0ZW1lbnQtYnVzaW5lc3MuZmlsdGVycy5idXR0b24uY2xlYXItbGFiZWxcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBDbGVhciBhbGxcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPC9mb3JtPlxuICA8L2JiLWNvbGxhcHNpYmxlLXVpPlxuPC9uZy10ZW1wbGF0ZT5cbiJdfQ==