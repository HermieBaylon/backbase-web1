import { InjectionToken } from '@angular/core';
import { wrapAuthEvents } from '../auth-events';
import { websdkServiceFactory } from '../providers';
/**
 * @deprecated Will be removed in v7.0.0
 */
export const HTTP_INTERCEPTORS = new InjectionToken('web-sdk-http-interceptors');
/**
 * @deprecated Will be removed in v7.0.0
 */
export const REFRESH = new InjectionToken('web-sdk-refresh');
/**
 * @deprecated Will be removed in v7.0.0
 */
export const NAVIGATION = new InjectionToken('web-sdk-navigation');
/**
 * @deprecated Will be removed in v7.0.0
 */
export const PORTAL_CONTENT = new InjectionToken('web-sdk-portal-content');
/**
 * @deprecated Will be removed in v7.0.0
 */
export const AUTH_EVENTS = new InjectionToken('Web SDK auth event streams');
/**
 *
 * @deprecated Will be removed in v7.0.0
 *
 * @description
 * Token to get instance of LoginService.
 * Example of the use case: to implement custom login widget.
 *
 * @example
 * constructor(@Inject(LOGIN) private loginService: LoginService) {}
 */
export const LOGIN = new InjectionToken('web-sdk-login');
/**
 *
 * @deprecated Will be removed in v7.0.0
 * @description
 * Token to get instance of LogoutService.
 * Examples of the use cases: to implement custom logout widget or to logout user based on some custom logic.
 *
 * @example
 * constructor(@Inject(LOGOUT) private logoutService: LogoutService) {}
 */
export const LOGOUT = new InjectionToken('web-sdk-logout');
/**
 * @deprecated Will be removed in v7.0.0
 * @description
 * Token to get instance of SessionService.
 * Examples of the use cases:
 * - to register custom countdown to show modal before session is over
 * - to refresh session.
 *
 * @example
 * constructor(@Inject(SESSION) private sessionService: SessionService) {}.
 */
export const SESSION = new InjectionToken('web-sdk-session');
/**
 * @deprecated Will be removed in v7.0.0
 * @description
 * Token to get instance of ReauthenticateService.
 * Examples of the use cases:
 * - to reauthenticate a user.
 *
 * @example
 * constructor(@Inject(REAUTHENTICATE) private reauthenticateService: ReauthenticateService) {}.
 */
export const REAUTHENTICATE = new InjectionToken('web-sdk-reauthenticate');
/**
 * This returns a BackbaseAuth, but with the `keysToCheck` as required, not optional.
 */
function getAuth(serviceName, keysToCheck, externalServices, optionalKeys) {
    const auth = websdkServiceFactory(externalServices, 'auth');
    if (!auth) {
        throw new Error('Authentication Service is not available.');
    }
    keysToCheck.forEach((key) => {
        if (!auth[key] && !(optionalKeys === null || optionalKeys === void 0 ? void 0 : optionalKeys.includes(key))) {
            throw new Error(`'${serviceName}' Service cannot be injected because '${key}' is not available in authentication '${auth.config.kind}' strategy.`);
        }
    });
    return auth; // this is guaranteed by the above checks
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function loginFactory(webSdkServiceMap) {
    const auth = getAuth('Login', ['login'], webSdkServiceMap);
    return {
        login: auth.login,
    };
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function logoutFactory(webSdkServiceMap) {
    const auth = getAuth('Logout', ['logout', 'goToLoginPage'], webSdkServiceMap);
    return {
        logout: auth.logout,
        goToLoginPage: auth.goToLoginPage,
    };
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function sessionFactory(webSdkServiceMap) {
    const auth = getAuth('Session', ['register', 'refresh', 'timeToLive', 'isImpersonated'], webSdkServiceMap, [
        'isImpersonated',
    ]);
    return {
        registerCountdown: auth.register,
        refresh: auth.refresh,
        timeToLive: auth.timeToLive,
        isImpersonated: auth.isImpersonated ? auth.isImpersonated() : false,
    };
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function reauthenticateFactory(webSdkServiceMap) {
    const auth = getAuth('Reauthenticate', ['reauthenticate'], webSdkServiceMap);
    return {
        reauthenticate: auth.reauthenticate,
    };
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function getAuthEvents(webSdkServices) {
    if (!webSdkServices.auth || !webSdkServices.eventBus) {
        throw new Error('Unable to listen to auth events');
    }
    // @todo: remove 'as any' when web-sdk updates BackbaseAuth
    return wrapAuthEvents(webSdkServices.auth(), webSdkServices.eventBus());
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function refreshFactory(webSdkServiceMap) {
    return websdkServiceFactory(webSdkServiceMap, 'refresh');
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function httpInterceptorsFactory(webSdkServiceMap) {
    return websdkServiceFactory(webSdkServiceMap, 'httpInterceptors');
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function setConditionsFactory(webSdkServiceMap) {
    return websdkServiceFactory(webSdkServiceMap, 'conditions');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZXJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvd2ViLXNkay9zcmMvZGVwcmVjYXRlZC9wcm92aWRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQWdCL0MsT0FBTyxFQUFjLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVELE9BQU8sRUFBRSxvQkFBb0IsRUFBb0IsTUFBTSxjQUFjLENBQUM7QUFFdEU7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLGNBQWMsQ0FBbUIsMkJBQTJCLENBQUMsQ0FBQztBQUVuRzs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxJQUFJLGNBQWMsQ0FBVSxpQkFBaUIsQ0FBQyxDQUFDO0FBRXRFOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLElBQUksY0FBYyxDQUFhLG9CQUFvQixDQUFDLENBQUM7QUFFL0U7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQWdCLHdCQUF3QixDQUFDLENBQUM7QUFFMUY7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUcsSUFBSSxjQUFjLENBQWEsNEJBQTRCLENBQUMsQ0FBQztBQW1DeEY7Ozs7Ozs7Ozs7R0FVRztBQUNILE1BQU0sQ0FBQyxNQUFNLEtBQUssR0FBRyxJQUFJLGNBQWMsQ0FBZSxlQUFlLENBQUMsQ0FBQztBQUV2RTs7Ozs7Ozs7O0dBU0c7QUFDSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxjQUFjLENBQWdCLGdCQUFnQixDQUFDLENBQUM7QUFDMUU7Ozs7Ozs7Ozs7R0FVRztBQUNILE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxJQUFJLGNBQWMs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LENBQUMsY0FBYyxDQUFDLElBQUksRUFBUyxFQUFFLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0FBQ2pGLENBQUM7QUFDRDs7R0FFRztBQUNILE1BQU0sVUFBVSxjQUFjLENBQUMsZ0JBQW1DO0lBQ2hFLE9BQU8sb0JBQW9CLENBQUMsZ0JBQWdCLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDM0QsQ0FBQztBQUNEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLHVCQUF1QixDQUFDLGdCQUFtQztJQUN6RSxPQUFPLG9CQUFvQixDQUFDLGdCQUFnQixFQUFFLGtCQUFrQixDQUFDLENBQUM7QUFDcEUsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxnQkFBbUM7SUFFbkMsT0FBTyxvQkFBb0IsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUM5RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEJhY2tiYXNlQXV0aCxcbiAgQ291bnRkb3duLFxuICBHb1RvTG9naW5QYWdlLFxuICBIdHRwSW50ZXJjZXB0b3JzLFxuICBMb2dpbixcbiAgTG9nb3V0LFxuICBOYXZpZ2F0aW9uLFxuICBQb3J0YWxDb250ZW50LFxuICBQcm9wZXJ0eVJlc29sdmVyLFxuICBSZWF1dGhlbnRpY2F0ZSxcbiAgUmVmcmVzaCxcbiAgUmVmcmVzaFNlc3Npb24sXG4gIFRpbWVUb0xpdmUsXG59IGZyb20gJ0BiYWNrYmFzZS9saWItYmItcGFnZS1ib290c3RyYXAtY2RuJztcbmltcG9ydCB7IEF1dGhFdmVudHMsIHdyYXBBdXRoRXZlbnRzIH0gZnJvbSAnLi4vYXV0aC1ldmVudHMnO1xuaW1wb3J0IHsgd2Vic2RrU2VydmljZUZhY3RvcnksIFdlYlNka1NlcnZpY2VNYXAgfSBmcm9tICcuLi9wcm92aWRlcnMnO1xuXG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGNvbnN0IEhUVFBfSU5URVJDRVBUT1JTID0gbmV3IEluamVjdGlvblRva2VuPEh0dHBJbnRlcmNlcHRvcnM+KCd3ZWItc2RrLWh0dHAtaW50ZXJjZXB0b3JzJyk7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgY29uc3QgUkVGUkVTSCA9IG5ldyBJbmplY3Rpb25Ub2tlbjxSZWZyZXNoPignd2ViLXNkay1yZWZyZXNoJyk7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgY29uc3QgTkFWSUdBVElPTiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxOYXZpZ2F0aW9uPignd2ViLXNkay1uYXZpZ2F0aW9uJyk7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgY29uc3QgUE9SVEFMX0NPTlRFTlQgPSBuZXcgSW5qZWN0aW9uVG9rZW48UG9ydGFsQ29udGVudD4oJ3dlYi1zZGstcG9ydGFsLWNvbnRlbnQnKTtcblxuLyoqXG4gKiBAZGVwcmVjYXRlZCBXaWxsIGJlIHJlbW92ZWQgaW4gdjcuMC4wXG4gKi9cbmV4cG9ydCBjb25zdCBBVVRIX0VWRU5UUyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxBdXRoRXZlbnRzPignV2ViIFNESyBhdXRoIGV2ZW50IHN0cmVhbXMnKTtcblxuLyoqXG4gKiBAZGVwcmVjYXRlZCBXaWxsIGJlIHJlbW92ZWQgaW4gdjcuMC4wXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTG9naW5TZXJ2aWNlIHtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBtZXRob2QgdG8gbG9naW5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJuYW1lXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB1c2VyIGlzIGxvZ2dlZCBpblxuICAgKi9cbiAgbG9naW46IExvZ2luO1xufVxuXG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMb2dvdXRTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBtZXRob2QgdG8gbG9nb3V0XG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVyaSB1cmwgZm9yIHJlZGlyZWN0aW5nIHRvIGFmdGVyIGxvZ291dCBpcyBkb25lXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgdGhhdCBpcyByZXNvbHZlZCB3aGVuIGxvZ291dCBpcyBkb25lXG4gICAqL1xuICBsb2dvdXQ6IExvZ291dDtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBtZXRob2QgdG8gcmVkaXJlY3QgdG8gbG9naW4gcGFnZSBzZXQgaW4gYXV0aCBjb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVyaSBwYXJhbWV0ZXIgdXNlZCBieSBoeWJyaWQgYXV0aGVudGljYXRpb24uXG4gICAqICAgICAgICAgICAgICAgICAgSXQgaXMgcGFzc2VkIHRvIEtleWNsb2FrIHNvIHdoZW4gdXNlciBnZXRzIGF1dGhlbnRpY2F0ZWQgb24gSUFNIHNlcnZlcixcbiAgICogICAgICAgICAgICAgICAgICB0aGF0IHNlcnZlciByZWRpcmVjdHMgdG8gdGhpcyByZWRpcmVjdFVyaS5cbiAgICogICAgICAgICAgICAgICAgICBVc3VhbGx5IHJlZGlyZWN0VXJpIGlzIHRoZSB1cmwgb2YgdGhlIHBhZ2UgdXNlciBpcyByZWRpcmVjdGVkIGZyb20sIG9yIGxhbmRpbmcgcGFnZSBvZiB0aGUgcG9ydGFsLlxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgZ29Ub0xvZ2luUGFnZTogR29Ub0xvZ2luUGFnZTtcbn1cbi8qKlxuICpcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFRva2VuIHRvIGdldCBpbnN0YW5jZSBvZiBMb2dpblNlcnZpY2UuXG4gKiBFeGFtcGxlIG9mIHRoZSB1c2UgY2FzZTogdG8gaW1wbGVtZW50IGN1c3RvbSBsb2dpbiB3aWRnZXQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0cnVjdG9yKEBJbmplY3QoTE9HSU4pIHByaXZhdGUgbG9naW5TZXJ2aWNlOiBMb2dpblNlcnZpY2UpIHt9XG4gKi9cbmV4cG9ydCBjb25zdCBMT0dJTiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxMb2dpblNlcnZpY2U+KCd3ZWItc2RrLWxvZ2luJyk7XG5cbi8qKlxuICpcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqIEBkZXNjcmlwdGlvblxuICogVG9rZW4gdG8gZ2V0IGluc3RhbmNlIG9mIExvZ291dFNlcnZpY2UuXG4gKiBFeGFtcGxlcyBvZiB0aGUgdXNlIGNhc2VzOiB0byBpbXBsZW1lbnQgY3VzdG9tIGxvZ291dCB3aWRnZXQgb3IgdG8gbG9nb3V0IHVzZXIgYmFzZWQgb24gc29tZSBjdXN0b20gbG9naWMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGNvbnN0cnVjdG9yKEBJbmplY3QoTE9HT1VUKSBwcml2YXRlIGxvZ291dFNlcnZpY2U6IExvZ291dFNlcnZpY2UpIHt9XG4gKi9cbmV4cG9ydCBjb25zdCBMT0dPVVQgPSBuZXcgSW5qZWN0aW9uVG9rZW48TG9nb3V0U2VydmljZT4oJ3dlYi1zZGstbG9nb3V0Jyk7XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqIEBkZXNjcmlwdGlvblxuICogVG9rZW4gdG8gZ2V0IGluc3RhbmNlIG9mIFNlc3Npb25TZXJ2aWNlLlxuICogRXhhbXBsZXMgb2YgdGhlIHVzZSBjYXNlczpcbiAqIC0gdG8gcmVnaXN0ZXIgY3VzdG9tIGNvdW50ZG93biB0byBzaG93IG1vZGFsIGJlZm9yZSBzZXNzaW9uIGlzIG92ZXJcbiAqIC0gdG8gcmVmcmVzaCBzZXNzaW9uLlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdHJ1Y3RvcihASW5qZWN0KFNFU1NJT04pIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFNlc3Npb25TZXJ2aWNlKSB7fS5cbiAqL1xuZXhwb3J0IGNvbnN0IFNFU1NJT04gPSBuZXcgSW5qZWN0aW9uVG9rZW48U2Vzc2lvblNlcnZpY2U+KCd3ZWItc2RrLXNlc3Npb24nKTtcbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICogQGRlc2NyaXB0aW9uXG4gKiBUb2tlbiB0byBnZXQgaW5zdGFuY2Ugb2YgUmVhdXRoZW50aWNhdGVTZXJ2aWNlLlxuICogRXhhbXBsZXMgb2YgdGhlIHVzZSBjYXNlczpcbiAqIC0gdG8gcmVhdXRoZW50aWNhdGUgYSB1c2VyLlxuICpcbiAqIEBleGFtcGxlXG4gKiBjb25zdHJ1Y3RvcihASW5qZWN0KFJFQVVUSEVOVElDQVRFKSBwcml2YXRlIHJlYXV0aGVudGljYXRlU2VydmljZTogUmVhdXRoZW50aWNhdGVTZXJ2aWNlKSB7fS5cbiAqL1xuZXhwb3J0IGNvbnN0IFJFQVVUSEVOVElDQVRFID0gbmV3IEluamVjdGlvblRva2VuPFJlYXV0aGVudGljYXRlU2VydmljZT4oJ3dlYi1zZGstcmVhdXRoZW50aWNhdGUnKTtcblxuZXhwb3J0IHR5cGUgQ291bnRkb3duUmVnaXN0ZXIgPSAoY291bnRkb3duOiBDb3VudGRvd24pID0+ICgpID0+IHZvaWQ7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICogQGRlc2NyaXB0aW9uXG4gKiBUb2tlbiB0byBnZXQgbGVhbi1jbGllbnQgc2VydmljZXMgbWFwIGRpcmVjdGx5LlxuICogVXNlZCBpbnRlcm5hbGx5IGJ5IGZvdW5kYXRpb24tYW5nIHRvIHJlZ2lzdGVyIGxlYW4tY2xpZW50IHNlcnZpY2VzIGludG8gdGhlIGFuZ3VsYXIgYXBwLlxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVhdXRoZW50aWNhdGVTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBtZXRob2QgdG8gcmVhdXRoZW50aWNhdGUgYSB1c2VyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzY29wZSBpZGVudGlmaWVzIHRoZSByZXNvdXJjZSBvciBwZXJtaXNzaW9uIHRoYXQgdGhlIHVzZXIgaXMgY29uc2VudGluZyB0by5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFjclZhbHVlcyBhIHNwYWNlLWRlbGltaXRlZCBsaXN0IG9mIGFjY2VwdGFibGUgbGV2ZWxzIG9mIGFzc3VyYW5jZS5cbiAgICogICAgICAgICAgICAgICAgICBDYW4gYmUgdXNlZCBieSB0aGUgSWRQIHRvIHN0ZWVyIHRoZSBhdXRoZW50aWNhdGlvbiBmbG93LlxuICAgKiBAcGFyYW0ge1JlYXV0aENvbmZpZ30gW3JlYXV0aENvbmZpZ10gQSBjb25maWd1cmF0aW9uIGFsbG93aW5nIHRoZSBwYXNzaW5nIG9mIG9wdGlvbmFsIHBhcmFtZXRlcnMuXG4gICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAqL1xuICByZWF1dGhlbnRpY2F0ZTogUmVhdXRoZW50aWNhdGU7XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICogQGRlc2NyaXB0aW9uXG4gKiBTZXJ2aWNlIHRvIHJlZ2lzdGVyIGN1c3RvbSBjb3VudGRvd24gY2FsbGJhY2tzLCB0byByZWZyZXNoIHNlc3Npb24sIHRvIGdldCB0aW1lIHRvIGxpdmUgb2YgdGhlIHNlc3Npb24uXG4gKlxuICogQGV4YW1wbGVcbiAqIGV4cG9ydCBjbGFzcyBDb3VudGRvd25TZXJ2aWNlIHtcbiAqICAgY29uc3RydWN0b3IoXG4gKiAgICAgQEluamVjdChTRVNTSU9OKSBwcml2YXRlIHNlc3Npb25TZXJ2aWNlOiBTZXNzaW9uU2VydmljZSxcbiAqICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogTW9kYWxTZXJ2aWNlLFxuICogICApIHtcbiAqICAgICB0aGlzLnJlZ2lzdGVyQ291bnRkb3duKCk7XG4gKiAgIH1cbiAqXG4gKiAgIHByaXZhdGUgcmVnaXN0ZXJDb3VudGRvd24oKSB7XG4gKiAgICAgdGhpcy5zZXNzaW9uU2VydmljZS5yZWdpc3RlckNvdW50ZG93bih7XG4gKiAgICAgICBzdGFydDogKCkgPT4ge1xuICogICAgICAgICB0aGlzLm1vZGFsU2VydmljZS5vcGVuKHtcbiAqICAgICAgICAgICBoZWFkZXI6ICdTZXNzaW9uIG5vdGlmaWNhdGlvbicsXG4gKiAgICAgICAgICAgbWVzc2FnZTogJ1lvdXIgc2Vzc2lvbiB3aWxsIGV4cGlyZSBzb29uJyxcbiAqICAgICAgICAgICBva0hhbmRsZXI6ICgpID0+IHRoaXMuc2Vzc2lvblNlcnZpY2UucmVmcmVzaCgpXG4gKiAgICAgICAgIH0pO1xuICogICAgICAgfSxcbiAqICAgICAgIGVuZDogKCkgPT4ge1xuICogICAgICAgICB0aGlzLm1vZGFsU2VydmljZS5vcGVuKCdzZXNzaW9uJywge1xuICogICAgICAgICAgIGhlYWRlcjogJ1Nlc3Npb24gbm90aWZpY2F0aW9uJyxcbiAqICAgICAgICAgICBxdWVzdGlvbjogJ1lvdXIgc2Vzc2lvbiBpcyBleHBpcmVkISBEbyB5b3Ugd2FudCB0byBsb2cgaW4/JyxcbiAqICAgICAgICAgICBva0hhbmRsZXI6ICgpID0+IHRoaXMuc2Vzc2lvblNlcnZpY2UucmVmcmVzaCgpLFxuICogICAgICAgICB9KTtcbiAqICAgICAgIH0sXG4gKiAgICAgICByZXNldDogKCkgPT4ge1xuICogICAgICAgICB0aGlzLm1vZGFsU2VydmljZS5jbG9zZSgpO1xuICogICAgICAgfSxcbiAqICAgICAgIGR1cmF0aW9uOiAyMCwgLy9zZWNvbmRzXG4gKiAgICAgfSk7XG4gKiAgIH1cbiAqIH1cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uU2VydmljZSB7XG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmVmcmVzaGVzIHNlc3Npb25cbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2hlbiBzZXNzaW9uIGlzIHJlZnJlc2hlZFxuICAgKi9cbiAgcmVmcmVzaDogUmVmcmVzaFNlc3Npb247XG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmVnaXN0ZXJzIGNvdW50ZG93biBjYWxsYmFja3MuXG4gICAqIEBwYXJhbSB7Q291bnRkb3dufSBjb3VudGRvd25cbiAgICovXG4gIHJlZ2lzdGVyQ291bnRkb3duOiBDb3VudGRvd25SZWdpc3RlcjtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBSZXR1cm5zIHRpbWUgdG8gbGl2ZSBvZiB0aGUgc2Vzc2lvblxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IHRpbWUgdG8gbGl2ZSBvZiB0aGUgc2Vzc2lvbiAoc2Vjb25kcylcbiAgICovXG4gIHRpbWVUb0xpdmU6IFRpbWVUb0xpdmU7XG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gV2hldGhlciB0aGUgdXNlciBpcyBiZWluZyBpbXBlcnNvbmF0ZWRcbiAgICovXG4gIGlzSW1wZXJzb25hdGVkOiBib29sZWFuO1xufVxuXG4vKipcbiAqIFRoaXMgcmV0dXJucyBhIEJhY2tiYXNlQXV0aCwgYnV0IHdpdGggdGhlIGBrZXlzVG9DaGVja2AgYXMgcmVxdWlyZWQsIG5vdCBvcHRpb25hbC5cbiAqL1xuZnVuY3Rpb24gZ2V0QXV0aDxLIGV4dGVuZHMga2V5b2YgQmFja2Jhc2VBdXRoLCBUIGV4dGVuZHMgUmVxdWlyZWQ8UGljazxCYWNrYmFzZUF1dGgsIEs+Pj4oXG4gIHNlcnZpY2VOYW1lOiBzdHJpbmcsXG4gIGtleXNUb0NoZWNrOiBBcnJheTxLPixcbiAgZXh0ZXJuYWxTZXJ2aWNlcz86IFdlYlNka1NlcnZpY2VNYXAsXG4gIG9wdGlvbmFsS2V5cz86IEFycmF5PEs+LFxuKTogVCB7XG4gIGNvbnN0IGF1dGggPSB3ZWJzZGtTZXJ2aWNlRmFjdG9yeShleHRlcm5hbFNlcnZpY2VzLCAnYXV0aCcpO1xuICBpZiAoIWF1dGgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIFNlcnZpY2UgaXMgbm90IGF2YWlsYWJsZS4nKTtcbiAgfVxuICBrZXlzVG9DaGVjay5mb3JFYWNoKChrZXk6IEspID0+IHtcbiAgICBpZiAoIWF1dGhba2V5XSAmJiAhb3B0aW9uYWxLZXlzPy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGAnJHtzZXJ2aWNlTmFtZX0nIFNlcnZpY2UgY2Fubm90IGJlIGluamVjdGVkIGJlY2F1c2UgJyR7a2V5fScgaXMgbm90IGF2YWlsYWJsZSBpbiBhdXRoZW50aWNhdGlvbiAnJHthdXRoLmNvbmZpZy5raW5kfScgc3RyYXRlZ3kuYCxcbiAgICAgICk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIChhdXRoIGFzIHVua25vd24pIGFzIFQ7IC8vIHRoaXMgaXMgZ3VhcmFudGVlZCBieSB0aGUgYWJvdmUgY2hlY2tzXG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ2luRmFjdG9yeSh3ZWJTZGtTZXJ2aWNlTWFwPzogV2ViU2RrU2VydmljZU1hcCk6IExvZ2luU2VydmljZSB7XG4gIGNvbnN0IGF1dGggPSBnZXRBdXRoKCdMb2dpbicsIFsnbG9naW4nXSwgd2ViU2RrU2VydmljZU1hcCk7XG4gIHJldHVybiB7XG4gICAgbG9naW46IGF1dGgubG9naW4sXG4gIH07XG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ291dEZhY3Rvcnkod2ViU2RrU2VydmljZU1hcD86IFdlYlNka1NlcnZpY2VNYXApOiBMb2dvdXRTZXJ2aWNlIHtcbiAgY29uc3QgYXV0aCA9IGdldEF1dGgoJ0xvZ291dCcsIFsnbG9nb3V0JywgJ2dvVG9Mb2dpblBhZ2UnXSwgd2ViU2RrU2VydmljZU1hcCk7XG4gIHJldHVybiB7XG4gICAgbG9nb3V0OiBhdXRoLmxvZ291dCxcbiAgICBnb1RvTG9naW5QYWdlOiBhdXRoLmdvVG9Mb2dpblBhZ2UsXG4gIH07XG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlc3Npb25GYWN0b3J5KHdlYlNka1NlcnZpY2VNYXA/OiBXZWJTZGtTZXJ2aWNlTWFwKTogU2Vzc2lvblNlcnZpY2Uge1xuICBjb25zdCBhdXRoID0gZ2V0QXV0aCgnU2Vzc2lvbicsIFsncmVnaXN0ZXInLCAncmVmcmVzaCcsICd0aW1lVG9MaXZlJywgJ2lzSW1wZXJzb25hdGVkJ10sIHdlYlNka1NlcnZpY2VNYXAsIFtcbiAgICAnaXNJbXBlcnNvbmF0ZWQnLFxuICBdKTtcbiAgcmV0dXJuIHtcbiAgICByZWdpc3RlckNvdW50ZG93bjogYXV0aC5yZWdpc3RlcixcbiAgICByZWZyZXNoOiBhdXRoLnJlZnJlc2gsXG4gICAgdGltZVRvTGl2ZTogYXV0aC50aW1lVG9MaXZlLFxuICAgIGlzSW1wZXJzb25hdGVkOiBhdXRoLmlzSW1wZXJzb25hdGVkID8gYXV0aC5pc0ltcGVyc29uYXRlZCgpIDogZmFsc2UsXG4gIH07XG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYXV0aGVudGljYXRlRmFjdG9yeSh3ZWJTZGtTZXJ2aWNlTWFwPzogV2ViU2RrU2VydmljZU1hcCk6IFJlYXV0aGVudGljYXRlU2VydmljZSB7XG4gIGNvbnN0IGF1dGggPSBnZXRBdXRoKCdSZWF1dGhlbnRpY2F0ZScsIFsncmVhdXRoZW50aWNhdGUnXSwgd2ViU2RrU2VydmljZU1hcCk7XG4gIHJldHVybiB7XG4gICAgcmVhdXRoZW50aWNhdGU6IGF1dGgucmVhdXRoZW50aWNhdGUsXG4gIH07XG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEF1dGhFdmVudHMod2ViU2RrU2VydmljZXM6IFdlYlNka1NlcnZpY2VNYXApOiBBdXRoRXZlbnRzIHtcbiAgaWYgKCF3ZWJTZGtTZXJ2aWNlcy5hdXRoIHx8ICF3ZWJTZGtTZXJ2aWNlcy5ldmVudEJ1cykge1xuICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGxpc3RlbiB0byBhdXRoIGV2ZW50cycpO1xuICB9XG4gIC8vIEB0b2RvOiByZW1vdmUgJ2FzIGFueScgd2hlbiB3ZWItc2RrIHVwZGF0ZXMgQmFja2Jhc2VBdXRoXG4gIHJldHVybiB3cmFwQXV0aEV2ZW50cyh3ZWJTZGtTZXJ2aWNlcy5hdXRoKCkgYXMgYW55LCB3ZWJTZGtTZXJ2aWNlcy5ldmVudEJ1cygpKTtcbn1cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVmcmVzaEZhY3Rvcnkod2ViU2RrU2VydmljZU1hcD86IFdlYlNka1NlcnZpY2VNYXApOiBSZWZyZXNoIHwgdW5kZWZpbmVkIHtcbiAgcmV0dXJuIHdlYnNka1NlcnZpY2VGYWN0b3J5KHdlYlNka1NlcnZpY2VNYXAsICdyZWZyZXNoJyk7XG59XG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGh0dHBJbnRlcmNlcHRvcnNGYWN0b3J5KHdlYlNka1NlcnZpY2VNYXA/OiBXZWJTZGtTZXJ2aWNlTWFwKTogSHR0cEludGVyY2VwdG9ycyB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB3ZWJzZGtTZXJ2aWNlRmFjdG9yeSh3ZWJTZGtTZXJ2aWNlTWFwLCAnaHR0cEludGVyY2VwdG9ycycpO1xufVxuXG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmRpdGlvbnNGYWN0b3J5KFxuICB3ZWJTZGtTZXJ2aWNlTWFwPzogV2ViU2RrU2VydmljZU1hcCxcbik6IFBpY2s8UHJvcGVydHlSZXNvbHZlciwgJ3Jlc29sdmVFbnRpdGxlbWVudHMnPiB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB3ZWJzZGtTZXJ2aWNlRmFjdG9yeSh3ZWJTZGtTZXJ2aWNlTWFwLCAnY29uZGl0aW9ucycpO1xufVxuIl19