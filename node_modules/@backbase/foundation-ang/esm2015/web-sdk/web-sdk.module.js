import { Inject, InjectionToken, LOCALE_ID, NgModule, Optional, SkipSelf } from '@angular/core';
import { AuthKind, initialise } from '@backbase/lib-bb-page-bootstrap-cdn';
import { navigationFactory, portalContentFactory, PUBSUB, SET_LOCALE, WEBSDK_SERVICE_MAP, } from './providers';
import { PubSubService } from './pub-sub.service';
import { getPageConfig, PAGE_CONFIG } from './page-config';
import { EntitlementsModule } from '@backbase/foundation-ang/entitlements';
import { AUTH_EVENTS, getAuthEvents, HTTP_INTERCEPTORS, httpInterceptorsFactory, LOGIN, loginFactory, LOGOUT, logoutFactory, NAVIGATION, PORTAL_CONTENT, REAUTHENTICATE, reauthenticateFactory, REFRESH, refreshFactory, SESSION, sessionFactory, } from './deprecated/providers';
import { SetLocaleService } from './set-locale.service';
/**
 * @deprecated Will be removed in v7.0.0
 */
export const WEBSDK_CONFIG = new InjectionToken('web sdk config');
/**
 * @deprecated Will be removed in v7.0.0
 */
export function setLocaleFactory(setLocale) {
    const setLocale$ = setLocale;
    return setLocale$.setLocaleLegacy;
}
/**
 * @deprecated Will be removed in v7.0.0
 */
export function bootstrapWebsdkService(config, locale) {
    const locales = config.locales || [locale];
    if (!locales.includes(locale)) {
        locales.push(locale);
    }
    const rawConfig = Object.assign(Object.assign({ apiRoot: config.apiRoot || '/api', locale, staticResourcesRoot: '/' }, config), { locales: locales.join(','), auth: Object.assign(Object.assign({ authUrl: '/auth', clientId: 'bb-web-client', realm: 'backbase', scope: 'openid' }, config.auth), { kind: AuthKind.Hybrid, loginPageUrl: '', landingPageUrl: '' }) });
    const { pageConfig, pubsub, navigation, portalContent, auth, httpInterceptors, itemRefresher, setLocale, conditions, } = initialise(rawConfig);
    return {
        pageConfig: () => pageConfig,
        navigation: () => navigation,
        eventBus: () => pubsub,
        portalContent: () => portalContent,
        auth: () => auth,
        httpInterceptors: () => httpInterceptors,
        refresh: () => itemRefresher.refresh,
        setLocale: () => setLocale,
        conditions: () => conditions,
    };
}
export class WebSdkModule {
    constructor(config, parentModule) {
        if (parentModule) {
            throw new TypeError(`WebSdkModule is imported twice. It should only be imported in the AppModule`);
        }
        if (!config) {
            throw new Error('WebSdkModule must be imported with WebSdkModule.forRoot(...)');
        }
    }
    /**
     * Add the `WebSdkModule` to your application's `AppModule` to embed the
     * web-sdk services into your application. This allows you to deploy your
     * application outside of an Experience, without the Lean Page.
     *
     * Note: Any services created via `environment.bootstrap.services` will
     * overwrite the services from this module.
     *
     * This module provides all the services from `WebSdkApiAng`.
     *
     * Importing this module will automatically enable the hybrid auth flow.
     *
     * @usageNotes
     *
     * ```
     * NgModule({
     *  declarations: [AppComponent],
     *  imports: [
     *    ...
     *    WebSdkModule.forRoot(),
     *  ],
     *  bootstrap: [AppComponent],
     * })
     * export class AppModule {}
     * ```
     */
    static forRoot(config = {}) {
        return {
            ngModule: WebSdkModule,
            providers: [
                {
                    provide: WEBSDK_CONFIG,
                    useValue: config,
                },
                {
                    provide: WEBSDK_SERVICE_MAP,
                    useFactory: bootstrapWebsdkService,
                    deps: [WEBSDK_CONFIG, LOCALE_ID],
                },
                {
                    provide: PAGE_CONFIG,
                    useFactory: getPageConfig,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: NAVIGATION,
                    useFactory: navigationFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: PORTAL_CONTENT,
                    useFactory: portalContentFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: LOGIN,
                    useFactory: loginFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: LOGOUT,
                    useFactory: logoutFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: SESSION,
                    useFactory: sessionFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: REAUTHENTICATE,
                    useFactory: reauthenticateFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: HTTP_INTERCEPTORS,
                    useFactory: httpInterceptorsFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: REFRESH,
                    useFactory: refreshFactory,
                    deps: [WEBSDK_SERVICE_MAP],
                },
                {
                    provide: AUTH_EVENTS,
                    useFactory: getAuthEvents,
                    deps: [WEBSDK_SERVICE_MAP],
                },
            ],
        };
    }
}
WebSdkModule.decorators = [
    { type: NgModule, args: [{
                imports: [EntitlementsModule],
                providers: [
                    { provide: PUBSUB, useExisting: PubSubService },
                    {
                        provide: SET_LOCALE,
                        deps: [SetLocaleService],
                        useFactory: setLocaleFactory,
                    },
                ],
            },] }
];
WebSdkModule.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [WEBSDK_CONFIG,] }] },
    { type: WebSdkModule, decorators: [{ type: Optional }, { type: SkipSelf }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNkay5tb2R1bGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9iYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy93ZWItc2RrL3NyYy93ZWItc2RrLm1vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEcsT0FBTyxFQUFFLFFBQVEsRUFBK0IsVUFBVSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDeEcsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixvQkFBb0IsRUFDcEIsTUFBTSxFQUNOLFVBQVUsRUFDVixrQkFBa0IsR0FFbkIsTUFBTSxhQUFhLENBQUM7QUFFckIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzNFLE9BQU8sRUFDTCxXQUFXLEVBQ1gsYUFBYSxFQUNiLGlCQUFpQixFQUNqQix1QkFBdUIsRUFDdkIsS0FBSyxFQUNMLFlBQVksRUFDWixNQUFNLEVBQ04sYUFBYSxFQUNiLFVBQVUsRUFDVixjQUFjLEVBQ2QsY0FBYyxFQUNkLHFCQUFxQixFQUNyQixPQUFPLEVBQ1AsY0FBYyxFQUNkLE9BQU8sRUFDUCxjQUFjLEdBQ2YsTUFBTSx3QkFBd0IsQ0FBQztBQUNoQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQVV4RDs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxJQUFJLGNBQWMsQ0FBZSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRWhGOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGdCQUFnQixD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RSxPQUFPLEVBQUUsVUFBVTt3QkFDbkIsSUFBSSxFQUFFLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3hCLFVBQVUsRUFBRSxnQkFBZ0I7cUJBQzdCO2lCQUNGO2FBQ0Y7Ozs0Q0FHSSxRQUFRLFlBQUksTUFBTSxTQUFDLGFBQWE7WUFDSyxZQUFZLHVCQUFqRCxRQUFRLFlBQUksUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTW9kdWxlV2l0aFByb3ZpZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3Rpb25Ub2tlbiwgTE9DQUxFX0lELCBOZ01vZHVsZSwgT3B0aW9uYWwsIFNraXBTZWxmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBdXRoS2luZCwgQ2RuUGFnZUNvbmZpZywgSHlicmlkQ29uZmlnLCBpbml0aWFsaXNlIH0gZnJvbSAnQGJhY2tiYXNlL2xpYi1iYi1wYWdlLWJvb3RzdHJhcC1jZG4nO1xuaW1wb3J0IHtcbiAgbmF2aWdhdGlvbkZhY3RvcnksXG4gIHBvcnRhbENvbnRlbnRGYWN0b3J5LFxuICBQVUJTVUIsXG4gIFNFVF9MT0NBTEUsXG4gIFdFQlNES19TRVJWSUNFX01BUCxcbiAgV2ViU2RrU2VydmljZU1hcCxcbn0gZnJvbSAnLi9wcm92aWRlcnMnO1xuXG5pbXBvcnQgeyBQdWJTdWJTZXJ2aWNlIH0gZnJvbSAnLi9wdWItc3ViLnNlcnZpY2UnO1xuaW1wb3J0IHsgZ2V0UGFnZUNvbmZpZywgUEFHRV9DT05GSUcgfSBmcm9tICcuL3BhZ2UtY29uZmlnJztcbmltcG9ydCB7IEVudGl0bGVtZW50c01vZHVsZSB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9lbnRpdGxlbWVudHMnO1xuaW1wb3J0IHtcbiAgQVVUSF9FVkVOVFMsXG4gIGdldEF1dGhFdmVudHMsXG4gIEhUVFBfSU5URVJDRVBUT1JTLFxuICBodHRwSW50ZXJjZXB0b3JzRmFjdG9yeSxcbiAgTE9HSU4sXG4gIGxvZ2luRmFjdG9yeSxcbiAgTE9HT1VULFxuICBsb2dvdXRGYWN0b3J5LFxuICBOQVZJR0FUSU9OLFxuICBQT1JUQUxfQ09OVEVOVCxcbiAgUkVBVVRIRU5USUNBVEUsXG4gIHJlYXV0aGVudGljYXRlRmFjdG9yeSxcbiAgUkVGUkVTSCxcbiAgcmVmcmVzaEZhY3RvcnksXG4gIFNFU1NJT04sXG4gIHNlc3Npb25GYWN0b3J5LFxufSBmcm9tICcuL2RlcHJlY2F0ZWQvcHJvdmlkZXJzJztcbmltcG9ydCB7IFNldExvY2FsZVNlcnZpY2UgfSBmcm9tICcuL3NldC1sb2NhbGUuc2VydmljZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2ViU2RrQ29uZmlnIHtcbiAgYXBpUm9vdD86IHN0cmluZztcbiAgc3RhdGljUmVzb3VyY2VzUm9vdD86IHN0cmluZztcbiAgYXV0aD86IE9taXQ8SHlicmlkQ29uZmlnLCAna2luZCcgfCAnbG9naW5QYWdlVXJsJyB8ICdsYW5kaW5nUGFnZVVybCc+O1xuICBsb2NhbGVzPzogQXJyYXk8c3RyaW5nPjtcbiAgZmVhdHVyZXM/OiBhbnk7XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgY29uc3QgV0VCU0RLX0NPTkZJRyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxXZWJTZGtDb25maWc+KCd3ZWIgc2RrIGNvbmZpZycpO1xuXG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldExvY2FsZUZhY3Rvcnkoc2V0TG9jYWxlOiBTZXRMb2NhbGVTZXJ2aWNlKSB7XG4gIGNvbnN0IHNldExvY2FsZSQgPSBzZXRMb2NhbGUgYXMgYW55O1xuICByZXR1cm4gc2V0TG9jYWxlJC5zZXRMb2NhbGVMZWdhY3k7XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgV2lsbCBiZSByZW1vdmVkIGluIHY3LjAuMFxuICovXG5leHBvcnQgZnVuY3Rpb24gYm9vdHN0cmFwV2Vic2RrU2VydmljZShjb25maWc6IFdlYlNka0NvbmZpZywgbG9jYWxlOiBzdHJpbmcpOiBXZWJTZGtTZXJ2aWNlTWFwIHtcbiAgY29uc3QgbG9jYWxlczogQXJyYXk8c3RyaW5nPiA9IGNvbmZpZy5sb2NhbGVzIHx8IFtsb2NhbGVdO1xuICBpZiAoIWxvY2FsZXMuaW5jbHVkZXMobG9jYWxlKSkge1xuICAgIGxvY2FsZXMucHVzaChsb2NhbGUpO1xuICB9XG4gIGNvbnN0IHJhd0NvbmZpZzogQ2RuUGFnZUNvbmZpZyA9IHtcbiAgICBhcGlSb290OiBjb25maWcuYXBpUm9vdCB8fCAnL2FwaScsXG4gICAgbG9jYWxlLFxuICAgIHN0YXRpY1Jlc291cmNlc1Jvb3Q6ICcvJyxcbiAgICAuLi5jb25maWcsXG4gICAgbG9jYWxlczogbG9jYWxlcy5qb2luKCcsJyksXG4gICAgYXV0aDoge1xuICAgICAgYXV0aFVybDogJy9hdXRoJyxcbiAgICAgIGNsaWVudElkOiAnYmItd2ViLWNsaWVudCcsXG4gICAgICByZWFsbTogJ2JhY2tiYXNlJyxcbiAgICAgIHNjb3BlOiAnb3BlbmlkJyxcbiAgICAgIC4uLmNvbmZpZy5hdXRoLFxuICAgICAga2luZDogQXV0aEtpbmQuSHlicmlkLFxuICAgICAgbG9naW5QYWdlVXJsOiAnJyxcbiAgICAgIGxhbmRpbmdQYWdlVXJsOiAnJyxcbiAgICB9IGFzIEh5YnJpZENvbmZpZyxcbiAgfTtcblxuICBjb25zdCB7XG4gICAgcGFnZUNvbmZpZyxcbiAgICBwdWJzdWIsXG4gICAgbmF2aWdhdGlvbixcbiAgICBwb3J0YWxDb250ZW50LFxuICAgIGF1dGgsXG4gICAgaHR0cEludGVyY2VwdG9ycyxcbiAgICBpdGVtUmVmcmVzaGVyLFxuICAgIHNldExvY2FsZSxcbiAgICBjb25kaXRpb25zLFxuICB9ID0gaW5pdGlhbGlzZShyYXdDb25maWcpO1xuXG4gIHJldHVybiB7XG4gICAgcGFnZUNvbmZpZzogKCkgPT4gcGFnZUNvbmZpZyxcbiAgICBuYXZpZ2F0aW9uOiAoKSA9PiBuYXZpZ2F0aW9uLFxuICAgIGV2ZW50QnVzOiAoKSA9PiBwdWJzdWIsXG4gICAgcG9ydGFsQ29udGVudDogKCkgPT4gcG9ydGFsQ29udGVudCxcbiAgICBhdXRoOiAoKSA9PiBhdXRoLFxuICAgIGh0dHBJbnRlcmNlcHRvcnM6ICgpID0+IGh0dHBJbnRlcmNlcHRvcnMsXG4gICAgcmVmcmVzaDogKCkgPT4gaXRlbVJlZnJlc2hlci5yZWZyZXNoLFxuICAgIHNldExvY2FsZTogKCkgPT4gc2V0TG9jYWxlLFxuICAgIGNvbmRpdGlvbnM6ICgpID0+IGNvbmRpdGlvbnMsXG4gIH07XG59XG5cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtFbnRpdGxlbWVudHNNb2R1bGVdLFxuICBwcm92aWRlcnM6IFtcbiAgICB7IHByb3ZpZGU6IFBVQlNVQiwgdXNlRXhpc3Rpbmc6IFB1YlN1YlNlcnZpY2UgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBTRVRfTE9DQUxFLFxuICAgICAgZGVwczogW1NldExvY2FsZVNlcnZpY2VdLFxuICAgICAgdXNlRmFjdG9yeTogc2V0TG9jYWxlRmFjdG9yeSxcbiAgICB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBXZWJTZGtNb2R1bGUge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFdFQlNES19DT05GSUcpIGNvbmZpZzogV2ViU2RrQ29uZmlnLFxuICAgIEBPcHRpb25hbCgpIEBTa2lwU2VsZigpIHBhcmVudE1vZHVsZTogV2ViU2RrTW9kdWxlLFxuICApIHtcbiAgICBpZiAocGFyZW50TW9kdWxlKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBXZWJTZGtNb2R1bGUgaXMgaW1wb3J0ZWQgdHdpY2UuIEl0IHNob3VsZCBvbmx5IGJlIGltcG9ydGVkIGluIHRoZSBBcHBNb2R1bGVgKTtcbiAgICB9XG5cbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdXZWJTZGtNb2R1bGUgbXVzdCBiZSBpbXBvcnRlZCB3aXRoIFdlYlNka01vZHVsZS5mb3JSb290KC4uLiknKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIHRoZSBgV2ViU2RrTW9kdWxlYCB0byB5b3VyIGFwcGxpY2F0aW9uJ3MgYEFwcE1vZHVsZWAgdG8gZW1iZWQgdGhlXG4gICAqIHdlYi1zZGsgc2VydmljZXMgaW50byB5b3VyIGFwcGxpY2F0aW9uLiBUaGlzIGFsbG93cyB5b3UgdG8gZGVwbG95IHlvdXJcbiAgICogYXBwbGljYXRpb24gb3V0c2lkZSBvZiBhbiBFeHBlcmllbmNlLCB3aXRob3V0IHRoZSBMZWFuIFBhZ2UuXG4gICAqXG4gICAqIE5vdGU6IEFueSBzZXJ2aWNlcyBjcmVhdGVkIHZpYSBgZW52aXJvbm1lbnQuYm9vdHN0cmFwLnNlcnZpY2VzYCB3aWxsXG4gICAqIG92ZXJ3cml0ZSB0aGUgc2VydmljZXMgZnJvbSB0aGlzIG1vZHVsZS5cbiAgICpcbiAgICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgYWxsIHRoZSBzZXJ2aWNlcyBmcm9tIGBXZWJTZGtBcGlBbmdgLlxuICAgKlxuICAgKiBJbXBvcnRpbmcgdGhpcyBtb2R1bGUgd2lsbCBhdXRvbWF0aWNhbGx5IGVuYWJsZSB0aGUgaHlicmlkIGF1dGggZmxvdy5cbiAgICpcbiAgICogQHVzYWdlTm90ZXNcbiAgICpcbiAgICogYGBgXG4gICAqIE5nTW9kdWxlKHtcbiAgICogIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sXG4gICAqICBpbXBvcnRzOiBbXG4gICAqICAgIC4uLlxuICAgKiAgICBXZWJTZGtNb2R1bGUuZm9yUm9vdCgpLFxuICAgKiAgXSxcbiAgICogIGJvb3RzdHJhcDogW0FwcENvbXBvbmVudF0sXG4gICAqIH0pXG4gICAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge31cbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgZm9yUm9vdChjb25maWc6IFdlYlNka0NvbmZpZyA9IHt9KTogTW9kdWxlV2l0aFByb3ZpZGVyczxXZWJTZGtNb2R1bGU+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbmdNb2R1bGU6IFdlYlNka01vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogV0VCU0RLX0NPTkZJRyxcbiAgICAgICAgICB1c2VWYWx1ZTogY29uZmlnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogV0VCU0RLX1NFUlZJQ0VfTUFQLFxuICAgICAgICAgIHVzZUZhY3Rvcnk6IGJvb3RzdHJhcFdlYnNka1NlcnZpY2UsXG4gICAgICAgICAgZGVwczogW1dFQlNES19DT05GSUcsIExPQ0FMRV9JRF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQQUdFX0NPTkZJRyxcbiAgICAgICAgICB1c2VGYWN0b3J5OiBnZXRQYWdlQ29uZmlnLFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogTkFWSUdBVElPTixcbiAgICAgICAgICB1c2VGYWN0b3J5OiBuYXZpZ2F0aW9uRmFjdG9yeSxcbiAgICAgICAgICBkZXBzOiBbV0VCU0RLX1NFUlZJQ0VfTUFQXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFBPUlRBTF9DT05URU5ULFxuICAgICAgICAgIHVzZUZhY3Rvcnk6IHBvcnRhbENvbnRlbnRGYWN0b3J5LFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogTE9HSU4sXG4gICAgICAgICAgdXNlRmFjdG9yeTogbG9naW5GYWN0b3J5LFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogTE9HT1VULFxuICAgICAgICAgIHVzZUZhY3Rvcnk6IGxvZ291dEZhY3RvcnksXG4gICAgICAgICAgZGVwczogW1dFQlNES19TRVJWSUNFX01BUF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBTRVNTSU9OLFxuICAgICAgICAgIHVzZUZhY3Rvcnk6IHNlc3Npb25GYWN0b3J5LFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUkVBVVRIRU5USUNBVEUsXG4gICAgICAgICAgdXNlRmFjdG9yeTogcmVhdXRoZW50aWNhdGVGYWN0b3J5LFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogSFRUUF9JTlRFUkNFUFRPUlMsXG4gICAgICAgICAgdXNlRmFjdG9yeTogaHR0cEludGVyY2VwdG9yc0ZhY3RvcnksXG4gICAgICAgICAgZGVwczogW1dFQlNES19TRVJWSUNFX01BUF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBSRUZSRVNILFxuICAgICAgICAgIHVzZUZhY3Rvcnk6IHJlZnJlc2hGYWN0b3J5LFxuICAgICAgICAgIGRlcHM6IFtXRUJTREtfU0VSVklDRV9NQVBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQVVUSF9FVkVOVFMsXG4gICAgICAgICAgdXNlRmFjdG9yeTogZ2V0QXV0aEV2ZW50cyxcbiAgICAgICAgICBkZXBzOiBbV0VCU0RLX1NFUlZJQ0VfTUFQXSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfTtcbiAgfVxufVxuIl19