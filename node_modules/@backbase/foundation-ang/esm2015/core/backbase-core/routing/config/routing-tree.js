import { PRIMARY_OUTLET } from '@angular/router';
import { OutletCollisionComponent } from '../components/outlet-collision.component';
import { flatMap } from '../../models/array';
import { OutletCollision } from './outlet-map';
export const isRoutable = (itemRoutes) => itemRoutes.outletName !== undefined;
const isAbsolute = (routePath) => routePath.startsWith('/');
const ɵ0 = isAbsolute;
const isMatchingRedirect = (redirectTo) => (route) => route.path !== undefined && route.path === redirectTo;
const ɵ1 = isMatchingRedirect;
/**
 * Applies an outlet name to a route
 * @param outlet
 * @param route
 * @param oldRoutes
 */
const namedOutletRoute = (outlet, route, oldRoutes) => {
    // Add outlet name
    let newRoute = route.component ? Object.assign(Object.assign({}, route), { outlet }) : route;
    // Convert redirects to duplicated routes (can't redirect to a named outlet easily).
    if (newRoute.redirectTo !== undefined && !isAbsolute(newRoute.redirectTo)) {
        // If it's not absolute, we try and make it a default route instead (no path)
        const routeTo = oldRoutes.find(isMatchingRedirect(newRoute.redirectTo));
        if (!routeTo) {
            // Coudn't find a route that they're redirecting too, so we remove the route, as it won't work.
            throw new Error(`Couldn't redirect to ${newRoute.redirectTo}`);
        }
        newRoute = Object.assign(Object.assign({}, routeTo), { // @fixme: child routes with empty path redirects won't actually do the redirect
            outlet, path: '' });
    }
    return newRoute;
};
const ɵ2 = namedOutletRoute;
const applyOutletName = (item, outlet, routes) => {
    if (outlet === PRIMARY_OUTLET) {
        return routes;
    }
    else if (outlet instanceof OutletCollision) {
        return [
            {
                path: '',
                component: OutletCollisionComponent,
                outlet: outlet.outletName,
                data: {
                    item: item.name,
                    collisionWith: outlet.collisionWith,
                },
            },
        ];
    }
    return routes.map((route, _, oldRoutes) => namedOutletRoute(`${outlet}`, route, oldRoutes));
};
const ɵ3 = applyOutletName;
const mapItemToRoutes = (outlets) => (item, children, childRoutes) => {
    const outletName = outlets.get(item.name);
    const routes = item.routingStrategy ? item.routingStrategy.getRoutes(item, children, childRoutes) : undefined;
    if (outletName === undefined || routes === undefined) {
        // Flatten non-routable items
        return {
            item: item.name,
            outletName: undefined,
            routes: flatMap(childRoute => childRoute.routes, childRoutes),
        };
    }
    return {
        item: item.name,
        routes: applyOutletName(item, outletName, routes),
        outletName,
    };
};
const ɵ4 = mapItemToRoutes;
/**
 * Create a tree of the components with routes. This is a direct map of the
 * component tree. Each node in the tree holds all routes for the nodes beneath
 * it. So the root node in the returned tree will hold all the routes for the
 * entire component tree.
 */
export const routingTree = (tree, outlets) => tree.map(mapItemToRoutes(outlets));
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGluZy10cmVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYmFja2Jhc2UvZm91bmRhdGlvbi1hbmcvY29yZS9zcmMvYmFja2Jhc2UtY29yZS9yb3V0aW5nL2NvbmZpZy9yb3V0aW5nLXRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQixjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNwRixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFN0MsT0FBTyxFQUFjLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQW1CM0QsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQUMsVUFBc0IsRUFBVyxFQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsS0FBSyxTQUFTLENBQUM7QUFFbkcsTUFBTSxVQUFVLEdBQUcsQ0FBQyxTQUFpQixFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUVwRSxNQUFNLGtCQUFrQixHQUFHLENBQUMsVUFBa0IsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFZLEVBQVcsRUFBRSxDQUMzRSxLQUFLLENBQUMsSUFBSSxLQUFLLFNBQVMsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQzs7QUFFeEQ7Ozs7O0dBS0c7QUFDSCxNQUFNLGdCQUFnQixHQUFHLENBQUMsTUFBYyxFQUFFLEtBQVksRUFBRSxTQUFpQixFQUFTLEVBQUU7SUFDbEYsa0JBQWtCO0lBQ2xCLElBQUksUUFBUSxHQUFVLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxpQ0FBTSxLQUFLLEtBQUUsTUFBTSxJQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFFckUsb0ZBQW9GO0lBQ3BGLElBQUksUUFBUSxDQUFDLFVBQVUsS0FBSyxTQUFTLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFO1FBQ3pFLDZFQUE2RTtRQUM3RSxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWiwrRkFBK0Y7WUFDL0YsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7U0FDaEU7UUFDRCxRQUFRLG1DQUNILE9BQU8sS0FBRSxnRkFBZ0Y7WUFDNUYsTUFBTSxFQUNOLElBQUksRUFBRSxFQUFFLEdBQ1QsQ0FBQztLQUNIO0lBRUQsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyxDQUFDOztBQUVGLE1BQU0sZUFBZSxHQUFHLENBQUMsSUFBa0IsRUFBRSxNQUFrQixFQUFFLE1BQWMsRUFBVSxFQUFFO0lBQ3pGLElBQUksTUFBTSxLQUFLLGNBQWMsRUFBRTtRQUM3QixPQUFPLE1BQU0sQ0FBQztLQUNmO1NBQU0sSUFBSSxNQUFNLFlBQVksZUFBZSxFQUFFO1FBQzVDLE9BQU87WUFDTDtnQkFDRSxJQUFJLEVBQUUsRUFBRTtnQkFDUixTQUFTLEVBQUUsd0JBQXdCO2dCQUNuQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVU7Z0JBQ3pCLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7b0JBQ2YsYUFBYSxFQUFFLE1BQU0sQ0FBQyxhQUFhO2lCQUNwQzthQUNGO1NBQ0YsQ0FBQztLQUNIO0lBRUQsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDOUYsQ0FBQyxDQUFDOztBQUVGLE1BQU0sZUFBZSxHQUFHLENBQUMsT0FBa0MsRUFBRSxFQUFFLENBQUMsQ0FDOUQsSUFBa0IsRUFDbEIsUUFBNkIsRUFDN0IsV0FBOEIsRUFDbEIsRUFBRTtJQUNkLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUU5RyxJQUFJLFVBQVUsS0FBSyxTQUFTLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUNwRCw2QkFBNkI7UUFDN0IsT0FBTztZQUNMLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLFVBQVUsRUFBRSxTQUFTO1lBQ3JCLE1BQU0sRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQztTQUM5RCxDQUFDO0tBQ0g7SUFDRCxPQUFPO1FBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1FBQ2YsTUFBTSxFQUFFLGVBQWUsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQztRQUNqRCxVQUFVO0tBQ1gsQ0FBQztBQUNKLENBQUMsQ0FBQzs7QUFFRjs7Ozs7R0FLRztBQUNILE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRyxDQUFDLElBQXdCLEVBQUUsT0FBa0MsRUFBc0IsRUFBRSxDQUM5RyxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVzLCBSb3V0ZSwgUFJJTUFSWV9PVVRMRVQgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgT3V0bGV0Q29sbGlzaW9uQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9vdXRsZXQtY29sbGlzaW9uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBmbGF0TWFwIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2FycmF5JztcbmltcG9ydCB7IFRyZWUgfSBmcm9tICcuLi8uLi9tb2RlbHMvdHJlZSc7XG5pbXBvcnQgeyBPdXRsZXROYW1lLCBPdXRsZXRDb2xsaXNpb24gfSBmcm9tICcuL291dGxldC1tYXAnO1xuaW1wb3J0IHsgUm91dGFibGVJdGVtIH0gZnJvbSAnLi9yb3V0YWJsZS1pdGVtLXRyZWUnO1xuaW1wb3J0IHsgSXRlbU5hbWUgfSBmcm9tICcuLi8uLi9tb2RlbHMvaXRlbS1tb2RlbCc7XG5cbmV4cG9ydCB0eXBlIENvbXBvbmVudFJvdXRlVHJlZSA9IFRyZWU8SXRlbVJvdXRlcz47XG5cbi8qKlxuICogQW4gSXRlbVJvdXRlIHJlcHJlc2VudHMgYSBub2RlIGluIGEgcm91dGluZyB0cmVlLCB0aGF0IGlzIGFcbiAqIGRpcmVjdCBtYXAgb2YgdGhlIENYUCB0cmVlLlxuICpcbiAqIFRoZSByb3V0ZXMgZm9yIGVhY2ggbm9kZSByZXByZXNlbnRzIHRoZSBlbnRpcmUgcm91dGUgdHJlZSBmcm9tXG4gKiB0aGlzIGl0ZW0gZG93biAodGhpcyBpdGVtJ3Mgcm91dGVzLCBtZXJnZWQgd2l0aCBjaGlsZCByb3V0ZXMpLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEl0ZW1Sb3V0ZXMge1xuICBpdGVtOiBJdGVtTmFtZTtcbiAgcm91dGVzOiBSb3V0ZXM7XG4gIG91dGxldE5hbWU/OiBPdXRsZXROYW1lO1xufVxuXG5leHBvcnQgY29uc3QgaXNSb3V0YWJsZSA9IChpdGVtUm91dGVzOiBJdGVtUm91dGVzKTogYm9vbGVhbiA9PiBpdGVtUm91dGVzLm91dGxldE5hbWUgIT09IHVuZGVmaW5lZDtcblxuY29uc3QgaXNBYnNvbHV0ZSA9IChyb3V0ZVBhdGg6IHN0cmluZykgPT4gcm91dGVQYXRoLnN0YXJ0c1dpdGgoJy8nKTtcblxuY29uc3QgaXNNYXRjaGluZ1JlZGlyZWN0ID0gKHJlZGlyZWN0VG86IHN0cmluZykgPT4gKHJvdXRlOiBSb3V0ZSk6IGJvb2xlYW4gPT5cbiAgcm91dGUucGF0aCAhPT0gdW5kZWZpbmVkICYmIHJvdXRlLnBhdGggPT09IHJlZGlyZWN0VG87XG5cbi8qKlxuICogQXBwbGllcyBhbiBvdXRsZXQgbmFtZSB0byBhIHJvdXRlXG4gKiBAcGFyYW0gb3V0bGV0XG4gKiBAcGFyYW0gcm91dGVcbiAqIEBwYXJhbSBvbGRSb3V0ZXNcbiAqL1xuY29uc3QgbmFtZWRPdXRsZXRSb3V0ZSA9IChvdXRsZXQ6IHN0cmluZywgcm91dGU6IFJvdXRlLCBvbGRSb3V0ZXM6IFJvdXRlcyk6IFJvdXRlID0+IHtcbiAgLy8gQWRkIG91dGxldCBuYW1lXG4gIGxldCBuZXdSb3V0ZTogUm91dGUgPSByb3V0ZS5jb21wb25lbnQgPyB7IC4uLnJvdXRlLCBvdXRsZXQgfSA6IHJvdXRlO1xuXG4gIC8vIENvbnZlcnQgcmVkaXJlY3RzIHRvIGR1cGxpY2F0ZWQgcm91dGVzIChjYW4ndCByZWRpcmVjdCB0byBhIG5hbWVkIG91dGxldCBlYXNpbHkpLlxuICBpZiAobmV3Um91dGUucmVkaXJlY3RUbyAhPT0gdW5kZWZpbmVkICYmICFpc0Fic29sdXRlKG5ld1JvdXRlLnJlZGlyZWN0VG8pKSB7XG4gICAgLy8gSWYgaXQncyBub3QgYWJzb2x1dGUsIHdlIHRyeSBhbmQgbWFrZSBpdCBhIGRlZmF1bHQgcm91dGUgaW5zdGVhZCAobm8gcGF0aClcbiAgICBjb25zdCByb3V0ZVRvID0gb2xkUm91dGVzLmZpbmQoaXNNYXRjaGluZ1JlZGlyZWN0KG5ld1JvdXRlLnJlZGlyZWN0VG8pKTtcbiAgICBpZiAoIXJvdXRlVG8pIHtcbiAgICAgIC8vIENvdWRuJ3QgZmluZCBhIHJvdXRlIHRoYXQgdGhleSdyZSByZWRpcmVjdGluZyB0b28sIHNvIHdlIHJlbW92ZSB0aGUgcm91dGUsIGFzIGl0IHdvbid0IHdvcmsuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkbid0IHJlZGlyZWN0IHRvICR7bmV3Um91dGUucmVkaXJlY3RUb31gKTtcbiAgICB9XG4gICAgbmV3Um91dGUgPSB7XG4gICAgICAuLi5yb3V0ZVRvLCAvLyBAZml4bWU6IGNoaWxkIHJvdXRlcyB3aXRoIGVtcHR5IHBhdGggcmVkaXJlY3RzIHdvbid0IGFjdHVhbGx5IGRvIHRoZSByZWRpcmVjdFxuICAgICAgb3V0bGV0LCAvLyAuLi4gdGhhdCBtZWFucyBhIG5hbWVkIGRlY2sgY29udGFpbmVyIHdpdGggYSByb3V0YWJsZSB3aWRnZXQsIHdvbid0IHNob3cgdGhhdFxuICAgICAgcGF0aDogJycsIC8vIC4uLiB3aWRnZXQncyBmaXJzdCByb3V0ZSBpZiBpdCdzIGEgcmVkaXJlY3RcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIG5ld1JvdXRlO1xufTtcblxuY29uc3QgYXBwbHlPdXRsZXROYW1lID0gKGl0ZW06IFJvdXRhYmxlSXRlbSwgb3V0bGV0OiBPdXRsZXROYW1lLCByb3V0ZXM6IFJvdXRlcyk6IFJvdXRlcyA9PiB7XG4gIGlmIChvdXRsZXQgPT09IFBSSU1BUllfT1VUTEVUKSB7XG4gICAgcmV0dXJuIHJvdXRlcztcbiAgfSBlbHNlIGlmIChvdXRsZXQgaW5zdGFuY2VvZiBPdXRsZXRDb2xsaXNpb24pIHtcbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBwYXRoOiAnJyxcbiAgICAgICAgY29tcG9uZW50OiBPdXRsZXRDb2xsaXNpb25Db21wb25lbnQsXG4gICAgICAgIG91dGxldDogb3V0bGV0Lm91dGxldE5hbWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpdGVtOiBpdGVtLm5hbWUsXG4gICAgICAgICAgY29sbGlzaW9uV2l0aDogb3V0bGV0LmNvbGxpc2lvbldpdGgsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF07XG4gIH1cblxuICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIF8sIG9sZFJvdXRlcykgPT4gbmFtZWRPdXRsZXRSb3V0ZShgJHtvdXRsZXR9YCwgcm91dGUsIG9sZFJvdXRlcykpO1xufTtcblxuY29uc3QgbWFwSXRlbVRvUm91dGVzID0gKG91dGxldHM6IE1hcDxJdGVtTmFtZSwgT3V0bGV0TmFtZT4pID0+IChcbiAgaXRlbTogUm91dGFibGVJdGVtLFxuICBjaGlsZHJlbjogQXJyYXk8Um91dGFibGVJdGVtPixcbiAgY2hpbGRSb3V0ZXM6IEFycmF5PEl0ZW1Sb3V0ZXM+LFxuKTogSXRlbVJvdXRlcyA9PiB7XG4gIGNvbnN0IG91dGxldE5hbWUgPSBvdXRsZXRzLmdldChpdGVtLm5hbWUpO1xuICBjb25zdCByb3V0ZXMgPSBpdGVtLnJvdXRpbmdTdHJhdGVneSA/IGl0ZW0ucm91dGluZ1N0cmF0ZWd5LmdldFJvdXRlcyhpdGVtLCBjaGlsZHJlbiwgY2hpbGRSb3V0ZXMpIDogdW5kZWZpbmVkO1xuXG4gIGlmIChvdXRsZXROYW1lID09PSB1bmRlZmluZWQgfHwgcm91dGVzID09PSB1bmRlZmluZWQpIHtcbiAgICAvLyBGbGF0dGVuIG5vbi1yb3V0YWJsZSBpdGVtc1xuICAgIHJldHVybiB7XG4gICAgICBpdGVtOiBpdGVtLm5hbWUsXG4gICAgICBvdXRsZXROYW1lOiB1bmRlZmluZWQsXG4gICAgICByb3V0ZXM6IGZsYXRNYXAoY2hpbGRSb3V0ZSA9PiBjaGlsZFJvdXRlLnJvdXRlcywgY2hpbGRSb3V0ZXMpLFxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpdGVtOiBpdGVtLm5hbWUsXG4gICAgcm91dGVzOiBhcHBseU91dGxldE5hbWUoaXRlbSwgb3V0bGV0TmFtZSwgcm91dGVzKSxcbiAgICBvdXRsZXROYW1lLFxuICB9O1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYSB0cmVlIG9mIHRoZSBjb21wb25lbnRzIHdpdGggcm91dGVzLiBUaGlzIGlzIGEgZGlyZWN0IG1hcCBvZiB0aGVcbiAqIGNvbXBvbmVudCB0cmVlLiBFYWNoIG5vZGUgaW4gdGhlIHRyZWUgaG9sZHMgYWxsIHJvdXRlcyBmb3IgdGhlIG5vZGVzIGJlbmVhdGhcbiAqIGl0LiBTbyB0aGUgcm9vdCBub2RlIGluIHRoZSByZXR1cm5lZCB0cmVlIHdpbGwgaG9sZCBhbGwgdGhlIHJvdXRlcyBmb3IgdGhlXG4gKiBlbnRpcmUgY29tcG9uZW50IHRyZWUuXG4gKi9cbmV4cG9ydCBjb25zdCByb3V0aW5nVHJlZSA9ICh0cmVlOiBUcmVlPFJvdXRhYmxlSXRlbT4sIG91dGxldHM6IE1hcDxJdGVtTmFtZSwgT3V0bGV0TmFtZT4pOiBDb21wb25lbnRSb3V0ZVRyZWUgPT5cbiAgdHJlZS5tYXAobWFwSXRlbVRvUm91dGVzKG91dGxldHMpKTtcbiJdfQ==