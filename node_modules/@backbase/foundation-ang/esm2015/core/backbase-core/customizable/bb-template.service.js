import { Input, Optional, TemplateRef, ViewContainerRef, Directive, } from '@angular/core';
import { TemplateRegistry } from './template-registry';
/**
 *
 * @deprecated Will be removed in v7.0.0
 *
 * @description
 * Every custom template directive should extend this class.
 * See 'How to make widget customizable'
 *
 * @usageNotes
 *
 * ### Example
 * ```
 * import { Component, Directive } from '@angular/core';
 * import { BbTemplate, ItemModel } from '@backbase/foundation-ang/core';
 *
 * @Component({
 *   selector: 'my-widget',
 *   template: `
 *   <li *ngFor="let item of pallete">
 *     My colors:
 *     <ng-container
 *       customItemTemplate
 *       [bbHostRef]="hostRef"
 *       [bbTemplateContext]="item"
 *     ></ng-container>
 *   </li>
 *
 *   <ng-template customItemTemplate let-hostRef let-item="context">
 *     Current name: {{ item.color }}
 *     Hex value: {{ hostRef.getHexColor(item.color) }}
 *   </ng-template>
 *   `,
 * })
 * export class MyWidgetComponent {
 *   readonly hostRef = this;
 *   readonly palette: Array<PaletteItem> = [{
 *     color: 'blue',
 *   }];
 *   readonly hexValues = {
 *     blue: '0000ff',
 *   };
 *
 *   constructor(private itemModel: ItemModel) {}
 *
 *   getHexColor(color: string): string | undefined {
 *     return this.hexValues[color];
 *   }
 * }
 *
 * type PaletteItem {
 *   color: string;
 * };
 *
 * @Directive({
 *   selector: '[customItemTemplate]',
 * })
 * export class customItemTemplate extends BbTemplate<MyWidgetComponent, PaletteItem> {}
 * ```
 */
/* eslint-disable @angular-eslint/directive-class-suffix */
export class BbTemplate {
    constructor(viewContainerRef, registry, templateRef) {
        this.viewContainerRef = viewContainerRef;
        this.registry = registry;
        this.templateRef = templateRef;
    }
    /**
     * @internal
     */
    ngOnInit() {
        this.checkContainerHasHostRef();
        this.checkNgTemplateIsNotUsedtoDefineSlot();
        if (this.isContainer) {
            this.waitTemplate();
        }
        else {
            this.registry.set(this.templateId(), this.templateRef);
        }
    }
    templateId() {
        return this.constructor;
    }
    checkContainerHasHostRef() {
        if (this.isContainer && this.bbHostRef === undefined) {
            throw new Error(`${this.constructor.name}: Missing required input [bbHostRef]`);
        }
    }
    checkNgTemplateIsNotUsedtoDefineSlot() {
        if (!this.isContainer && this.bbHostRef) {
            throw new Error(`${this.constructor.name}: [bbHostRef] should not be used in conjunction with <ng-template>. Use <ng-container> instead.`);
        }
    }
    /**
     * @internal
     */
    ngOnChanges(changes) {
        if (!this.customTemplateContext) {
            return;
        }
        if ('bbTemplateContext' in changes) {
            this.customTemplateContext.context = changes.bbTemplateContext.currentValue;
        }
    }
    waitTemplate() {
        const templateSubject = this.registry.get(this.templateId());
        this.templateSubscription = templateSubject.subscribe((tempalateRef) => {
            this.viewContainerRef.clear();
            this.customTemplateContext = this.createContext();
            const view = tempalateRef.createEmbeddedView(this.customTemplateContext);
            this.viewContainerRef.insert(view);
        });
    }
    /**
     * @internal
     */
    ngOnDestroy() {
        if (this.templateSubscription) {
            this.templateSubscription.unsubscribe();
        }
    }
    createContext() {
        if (this.bbHostRef === undefined) {
            throw new Error(`${this.constructor.name}: Missing required input [bbHostRef]`);
        }
        return {
            $implicit: this.bbHostRef,
            context: this.bbTemplateContext,
        };
    }
    get isContainer() {
        return !this.templateRef;
    }
}
BbTemplate.decorators = [
    { type: Directive, args: [{},] }
];
BbTemplate.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: TemplateRegistry },
    { type: TemplateRef, decorators: [{ type: Optional }] }
];
BbTemplate.propDecorators = {
    bbTemplateContext: [{ type: Input }],
    bbHostRef: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmItdGVtcGxhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2JhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUvc3JjL2JhY2tiYXNlLWNvcmUvY3VzdG9taXphYmxlL2JiLXRlbXBsYXRlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLEtBQUssRUFJTCxRQUFRLEVBRVIsV0FBVyxFQUNYLGdCQUFnQixFQUNoQixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFZdkQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EwREc7QUFDSCwyREFBMkQ7QUFFM0QsTUFBTSxPQUFnQixVQUFVO0lBZTlCLFlBQ21CLGdCQUFrQyxFQUNsQyxRQUEwQixFQUNkLFdBQWlFO1FBRjdFLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBa0I7UUFDZCxnQkFBVyxHQUFYLFdBQVcsQ0FBc0Q7SUFDN0YsQ0FBQztJQUVKOztPQUVHO0lBQ0gsUUFBUTtRQUNOLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxDQUFDO1FBRTVDLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDckI7YUFBTTtZQUNMLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFzQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQzdGO0lBQ0gsQ0FBQztJQUVPLFVBQVU7UUFDaEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7SUFFTyx3QkFBd0I7UUFDOUIsSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFO1lBQ3BELE1BQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksc0NBQXNDLENBQUMsQ0FBQztTQUNqRjtJQUNILENBQUM7SUFFTyxvQ0FBb0M7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUN2QyxNQUFNLElBQUksS0FBSyxDQUNiLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLGlHQUFpRyxDQUMxSCxDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtZQUMvQixPQUFPO1NBQ1I7UUFFRCxJQUFJLG1CQUFtQixJQUFJLE9BQU8sRUFBRTtZQUNsQyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUM7U0FDN0U7SUFDSCxDQUFDO0lBRU8sWUFBWTtRQUNsQixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBc0MsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFFbEcsSUFBSSxDQUFDLG9CQUFvQixHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQ25ELENBQUMsWUFBa0UsRUFBRSxFQUFFO1lBQ3JFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUU5QixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ2xELE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUN6RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFO1lBQzdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUN6QztJQUNILENBQUM7SUFFTyxhQUFhO1FBQ25CLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7WUFDaEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxzQ0FBc0MsQ0FBQyxDQUFDO1NBQ2pGO1FBRUQsT0FBTztZQUNMLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixPQUFPLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtTQUNoQyxDQUFDO0lBQ0osQ0FBQztJQUVELElBQVksV0FBVztRQUNyQixPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUMzQixDQUFDOzs7WUF2R0YsU0FBUyxTQUFDLEVBQUU7OztZQTdFWCxnQkFBZ0I7WUFLVCxnQkFBZ0I7WUFOdkIsV0FBVyx1QkFpR1IsUUFBUTs7O2dDQWRWLEtBQUs7d0JBS0wsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIERpcmVjdGl2ZSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVGVtcGxhdGVSZWdpc3RyeSB9IGZyb20gJy4vdGVtcGxhdGUtcmVnaXN0cnknO1xuXG4vKipcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDdXN0b21UZW1wbGF0ZUNvbnRleHQ8SG9zdCwgRXh0cmFDb250ZXh0PiB7XG4gIHJlYWRvbmx5ICRpbXBsaWNpdDogSG9zdDtcbiAgY29udGV4dDogRXh0cmFDb250ZXh0IHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgdHlwZSBDdXN0b21UZW1wbGF0ZVJlZjxIb3N0UmVmLCBDb250ZXh0PiA9IFRlbXBsYXRlUmVmPEN1c3RvbVRlbXBsYXRlQ29udGV4dDxIb3N0UmVmLCBDb250ZXh0Pj47XG5cbi8qKlxuICpcbiAqIEBkZXByZWNhdGVkIFdpbGwgYmUgcmVtb3ZlZCBpbiB2Ny4wLjBcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEV2ZXJ5IGN1c3RvbSB0ZW1wbGF0ZSBkaXJlY3RpdmUgc2hvdWxkIGV4dGVuZCB0aGlzIGNsYXNzLlxuICogU2VlICdIb3cgdG8gbWFrZSB3aWRnZXQgY3VzdG9taXphYmxlJ1xuICpcbiAqIEB1c2FnZU5vdGVzXG4gKlxuICogIyMjIEV4YW1wbGVcbiAqIGBgYFxuICogaW1wb3J0IHsgQ29tcG9uZW50LCBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbiAqIGltcG9ydCB7IEJiVGVtcGxhdGUsIEl0ZW1Nb2RlbCB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9jb3JlJztcbiAqXG4gKiBAQ29tcG9uZW50KHtcbiAqICAgc2VsZWN0b3I6ICdteS13aWRnZXQnLFxuICogICB0ZW1wbGF0ZTogYFxuICogICA8bGkgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcGFsbGV0ZVwiPlxuICogICAgIE15IGNvbG9yczpcbiAqICAgICA8bmctY29udGFpbmVyXG4gKiAgICAgICBjdXN0b21JdGVtVGVtcGxhdGVcbiAqICAgICAgIFtiYkhvc3RSZWZdPVwiaG9zdFJlZlwiXG4gKiAgICAgICBbYmJUZW1wbGF0ZUNvbnRleHRdPVwiaXRlbVwiXG4gKiAgICAgPjwvbmctY29udGFpbmVyPlxuICogICA8L2xpPlxuICpcbiAqICAgPG5nLXRlbXBsYXRlIGN1c3RvbUl0ZW1UZW1wbGF0ZSBsZXQtaG9zdFJlZiBsZXQtaXRlbT1cImNvbnRleHRcIj5cbiAqICAgICBDdXJyZW50IG5hbWU6IHt7IGl0ZW0uY29sb3IgfX1cbiAqICAgICBIZXggdmFsdWU6IHt7IGhvc3RSZWYuZ2V0SGV4Q29sb3IoaXRlbS5jb2xvcikgfX1cbiAqICAgPC9uZy10ZW1wbGF0ZT5cbiAqICAgYCxcbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgTXlXaWRnZXRDb21wb25lbnQge1xuICogICByZWFkb25seSBob3N0UmVmID0gdGhpcztcbiAqICAgcmVhZG9ubHkgcGFsZXR0ZTogQXJyYXk8UGFsZXR0ZUl0ZW0+ID0gW3tcbiAqICAgICBjb2xvcjogJ2JsdWUnLFxuICogICB9XTtcbiAqICAgcmVhZG9ubHkgaGV4VmFsdWVzID0ge1xuICogICAgIGJsdWU6ICcwMDAwZmYnLFxuICogICB9O1xuICpcbiAqICAgY29uc3RydWN0b3IocHJpdmF0ZSBpdGVtTW9kZWw6IEl0ZW1Nb2RlbCkge31cbiAqXG4gKiAgIGdldEhleENvbG9yKGNvbG9yOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICogICAgIHJldHVybiB0aGlzLmhleFZhbHVlc1tjb2xvcl07XG4gKiAgIH1cbiAqIH1cbiAqXG4gKiB0eXBlIFBhbGV0dGVJdGVtIHtcbiAqICAgY29sb3I6IHN0cmluZztcbiAqIH07XG4gKlxuICogQERpcmVjdGl2ZSh7XG4gKiAgIHNlbGVjdG9yOiAnW2N1c3RvbUl0ZW1UZW1wbGF0ZV0nLFxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBjdXN0b21JdGVtVGVtcGxhdGUgZXh0ZW5kcyBCYlRlbXBsYXRlPE15V2lkZ2V0Q29tcG9uZW50LCBQYWxldHRlSXRlbT4ge31cbiAqIGBgYFxuICovXG4vKiBlc2xpbnQtZGlzYWJsZSBAYW5ndWxhci1lc2xpbnQvZGlyZWN0aXZlLWNsYXNzLXN1ZmZpeCAqL1xuQERpcmVjdGl2ZSh7fSlcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYlRlbXBsYXRlPEhvc3RSZWYsIENvbnRleHQ+IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG4gIC8qKlxuICAgKiBDdXN0b20gY29udGV4dFxuICAgKi9cbiAgQElucHV0KCkgYmJUZW1wbGF0ZUNvbnRleHQ6IENvbnRleHQgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIENvbnRleHQgb2YgdGhlIGhvc3QgY29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBiYkhvc3RSZWY6IEhvc3RSZWYgfCB1bmRlZmluZWQ7XG5cbiAgcHJpdmF0ZSB0ZW1wbGF0ZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uIHwgdW5kZWZpbmVkO1xuXG4gIHByaXZhdGUgY3VzdG9tVGVtcGxhdGVDb250ZXh0OiBDdXN0b21UZW1wbGF0ZUNvbnRleHQ8SG9zdFJlZiwgQ29udGV4dD4gfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVnaXN0cnk6IFRlbXBsYXRlUmVnaXN0cnksXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSByZWFkb25seSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8Q3VzdG9tVGVtcGxhdGVDb250ZXh0PEhvc3RSZWYsIENvbnRleHQ+PixcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2hlY2tDb250YWluZXJIYXNIb3N0UmVmKCk7XG4gICAgdGhpcy5jaGVja05nVGVtcGxhdGVJc05vdFVzZWR0b0RlZmluZVNsb3QoKTtcblxuICAgIGlmICh0aGlzLmlzQ29udGFpbmVyKSB7XG4gICAgICB0aGlzLndhaXRUZW1wbGF0ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlZ2lzdHJ5LnNldDxDdXN0b21UZW1wbGF0ZVJlZjxIb3N0UmVmLCBDb250ZXh0Pj4odGhpcy50ZW1wbGF0ZUlkKCksIHRoaXMudGVtcGxhdGVSZWYpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdGVtcGxhdGVJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tDb250YWluZXJIYXNIb3N0UmVmKCkge1xuICAgIGlmICh0aGlzLmlzQ29udGFpbmVyICYmIHRoaXMuYmJIb3N0UmVmID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9OiBNaXNzaW5nIHJlcXVpcmVkIGlucHV0IFtiYkhvc3RSZWZdYCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja05nVGVtcGxhdGVJc05vdFVzZWR0b0RlZmluZVNsb3QoKSB7XG4gICAgaWYgKCF0aGlzLmlzQ29udGFpbmVyICYmIHRoaXMuYmJIb3N0UmVmKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGAke3RoaXMuY29uc3RydWN0b3IubmFtZX06IFtiYkhvc3RSZWZdIHNob3VsZCBub3QgYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIDxuZy10ZW1wbGF0ZT4uIFVzZSA8bmctY29udGFpbmVyPiBpbnN0ZWFkLmAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoIXRoaXMuY3VzdG9tVGVtcGxhdGVDb250ZXh0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCdiYlRlbXBsYXRlQ29udGV4dCcgaW4gY2hhbmdlcykge1xuICAgICAgdGhpcy5jdXN0b21UZW1wbGF0ZUNvbnRleHQuY29udGV4dCA9IGNoYW5nZXMuYmJUZW1wbGF0ZUNvbnRleHQuY3VycmVudFZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgd2FpdFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IHRlbXBsYXRlU3ViamVjdCA9IHRoaXMucmVnaXN0cnkuZ2V0PEN1c3RvbVRlbXBsYXRlUmVmPEhvc3RSZWYsIENvbnRleHQ+Pih0aGlzLnRlbXBsYXRlSWQoKSk7XG5cbiAgICB0aGlzLnRlbXBsYXRlU3Vic2NyaXB0aW9uID0gdGVtcGxhdGVTdWJqZWN0LnN1YnNjcmliZShcbiAgICAgICh0ZW1wYWxhdGVSZWY6IFRlbXBsYXRlUmVmPEN1c3RvbVRlbXBsYXRlQ29udGV4dDxIb3N0UmVmLCBDb250ZXh0Pj4pID0+IHtcbiAgICAgICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XG5cbiAgICAgICAgdGhpcy5jdXN0b21UZW1wbGF0ZUNvbnRleHQgPSB0aGlzLmNyZWF0ZUNvbnRleHQoKTtcbiAgICAgICAgY29uc3QgdmlldyA9IHRlbXBhbGF0ZVJlZi5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy5jdXN0b21UZW1wbGF0ZUNvbnRleHQpO1xuICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuaW5zZXJ0KHZpZXcpO1xuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMudGVtcGxhdGVTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudGVtcGxhdGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNvbnRleHQoKTogQ3VzdG9tVGVtcGxhdGVDb250ZXh0PEhvc3RSZWYsIENvbnRleHQ+IHtcbiAgICBpZiAodGhpcy5iYkhvc3RSZWYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX06IE1pc3NpbmcgcmVxdWlyZWQgaW5wdXQgW2JiSG9zdFJlZl1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgJGltcGxpY2l0OiB0aGlzLmJiSG9zdFJlZixcbiAgICAgIGNvbnRleHQ6IHRoaXMuYmJUZW1wbGF0ZUNvbnRleHQsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzQ29udGFpbmVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy50ZW1wbGF0ZVJlZjtcbiAgfVxufVxuIl19