/**
 * Configuration of a Widget Input or Output Pipeline
 */
export class CommunicationDefinition {
    /**
     * @param transport The transport identifier string
     * @param param A transport-specific param
     */
    constructor(
    /**
     * The transport identifier string
     */
    transport, 
    /**
     * A transport-specific param
     */
    param) {
        this.transport = transport;
        this.param = param;
    }
    /**
     * Determine if a `CommunicationDefinition` is equal to this one.
     *
     * @param other The other `CommunicationDefinition` to compare to
     */
    equals(other) {
        return this.transport === other.transport && this.param === other.param;
    }
}
export function human() {
    return {
        fromProperty(value) {
            const splitAt = value.indexOf(' ');
            if (splitAt === -1) {
                return undefined;
            }
            const transport = value.substr(0, splitAt);
            const param = value.substr(splitAt + 1);
            if (param.includes(' ')) {
                return undefined;
            }
            return new CommunicationDefinition(transport, param);
        },
        toProperty(definition) {
            if (definition.param.includes(' ')) {
                throw new Error('Human SerializerDeserializer cannot serialize CommunicationDefinition containing a space in the param');
            }
            return `${definition.transport} ${definition.param}`;
        },
    };
}
export function mangled() {
    return {
        fromProperty(value) {
            if (!value.startsWith(':0:')) {
                return undefined;
            }
            let blob;
            try {
                blob = atob(value.slice(':0:'.length));
            }
            catch (e) {
                // Not valid base64
                return undefined;
            }
            const splitAt = blob.indexOf(' ');
            const transport = blob.substr(0, splitAt);
            const param = blob.substr(splitAt + 1);
            return new CommunicationDefinition(transport, param);
        },
        toProperty(definition) {
            const mangledValue = btoa(`${definition.transport} ${definition.param}`);
            return `:0:${mangledValue}`;
        },
    };
}
function isValidStructure(blob) {
    if (typeof blob !== 'object' || blob === null || !('transport' in blob) || !('param' in blob)) {
        return false;
    }
    const structure = blob;
    return typeof structure.transport === 'string' && typeof structure.param === 'string';
}
export function mangledJson() {
    return {
        fromProperty(value) {
            if (!value.startsWith(':1:')) {
                return undefined;
            }
            let blob;
            try {
                blob = JSON.parse(value.slice(':1:'.length));
            }
            catch (e) {
                // Not valid JSON
                return undefined;
            }
            if (!isValidStructure(blob)) {
                return undefined;
            }
            return new CommunicationDefinition(blob.transport, blob.param);
        },
        toProperty(definition) {
            const json = JSON.stringify({ transport: definition.transport, param: definition.param });
            return `:1:${json}`;
        },
    };
}
function tryParse(inputValue, parsers, parse) {
    for (const parser of parsers) {
        const result = parse(parser, inputValue);
        if (result !== undefined) {
            return result;
        }
    }
    return undefined;
}
export function combined(parsers) {
    return {
        fromProperty(inputValue) {
            return tryParse(inputValue, parsers, (parser, value) => parser.fromProperty(value));
        },
        toProperty(definition) {
            const first = parsers[0];
            return first.toProperty(definition);
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyZGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvYmFja2Jhc2UvY29tbXVuaWNhdGlvbi1wcm9wZXJ0eS9zcmMvc2VyZGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBQ0gsTUFBTSxPQUFPLHVCQUF1QjtJQUNsQzs7O09BR0c7SUFDSDtJQUNFOztPQUVHO0lBQ00sU0FBaUI7SUFDMUI7O09BRUc7SUFDTSxLQUFhO1FBSmIsY0FBUyxHQUFULFNBQVMsQ0FBUTtRQUlqQixVQUFLLEdBQUwsS0FBSyxDQUFRO0lBQ3JCLENBQUM7SUFDSjs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLEtBQThCO1FBQ25DLE9BQU8sSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLEtBQUssQ0FBQztJQUMxRSxDQUFDO0NBQ0Y7QUFzQkQsTUFBTSxVQUFVLEtBQUs7SUFDbkIsT0FBTztRQUNMLFlBQVksQ0FBQyxLQUFhO1lBQ3hCLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkMsSUFBSSxPQUFPLEtBQUssQ0FBQyxDQUFDLEVBQUU7Z0JBQ2xCLE9BQU8sU0FBUyxDQUFDO2FBQ2xCO1lBQ0QsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDM0MsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDeEMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN2QixPQUFPLFNBQVMsQ0FBQzthQUNsQjtZQUNELE9BQU8sSUFBSSx1QkFBdUIsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkQsQ0FBQztRQUNELFVBQVUs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QUssRUFBRSxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMxRixPQUFPLE1BQU0sSUFBSSxFQUFFLENBQUM7UUFDdEIsQ0FBQztLQUNGLENBQUM7QUFDSixDQUFDO0FBRUQsU0FBUyxRQUFRLENBQ2YsVUFBa0IsRUFDbEIsT0FBc0IsRUFDdEIsS0FBdUQ7SUFFdkQsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7UUFDNUIsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN6QyxJQUFJLE1BQU0sS0FBSyxTQUFTLEVBQUU7WUFDeEIsT0FBTyxNQUFNLENBQUM7U0FDZjtLQUNGO0lBQ0QsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUMsT0FBc0M7SUFDN0QsT0FBTztRQUNMLFlBQVksQ0FBQyxVQUFrQjtZQUM3QixPQUFPLFFBQVEsQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLENBQUM7UUFDRCxVQUFVLENBQUMsVUFBbUM7WUFDNUMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLE9BQU8sS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0QyxDQUFDO0tBQ0YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbmZpZ3VyYXRpb24gb2YgYSBXaWRnZXQgSW5wdXQgb3IgT3V0cHV0IFBpcGVsaW5lXG4gKi9cbmV4cG9ydCBjbGFzcyBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbiB7XG4gIC8qKlxuICAgKiBAcGFyYW0gdHJhbnNwb3J0IFRoZSB0cmFuc3BvcnQgaWRlbnRpZmllciBzdHJpbmdcbiAgICogQHBhcmFtIHBhcmFtIEEgdHJhbnNwb3J0LXNwZWNpZmljIHBhcmFtXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgdHJhbnNwb3J0IGlkZW50aWZpZXIgc3RyaW5nXG4gICAgICovXG4gICAgcmVhZG9ubHkgdHJhbnNwb3J0OiBzdHJpbmcsXG4gICAgLyoqXG4gICAgICogQSB0cmFuc3BvcnQtc3BlY2lmaWMgcGFyYW1cbiAgICAgKi9cbiAgICByZWFkb25seSBwYXJhbTogc3RyaW5nLFxuICApIHt9XG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgaWYgYSBgQ29tbXVuaWNhdGlvbkRlZmluaXRpb25gIGlzIGVxdWFsIHRvIHRoaXMgb25lLlxuICAgKlxuICAgKiBAcGFyYW0gb3RoZXIgVGhlIG90aGVyIGBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbmAgdG8gY29tcGFyZSB0b1xuICAgKi9cbiAgZXF1YWxzKG90aGVyOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbikge1xuICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydCA9PT0gb3RoZXIudHJhbnNwb3J0ICYmIHRoaXMucGFyYW0gPT09IG90aGVyLnBhcmFtO1xuICB9XG59XG5cbi8qKlxuICogU2VyaWFsaXplL0Rlc2VyaWFsaXplIGEgV2lkZ2V0IENvbW11bmljYXRpb24gRGVmaW5pdGlvbiB0by9mcm9tIGEgdmFsdWUgc3VpdGFibGUgdG8gYmUgdXNlZCBpbiBhIFByb3BlcnR5IHN0cmluZ1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXIge1xuICAvKipcbiAgICogUGFyc2UgYSBQcm9wZXJ0eSBzdHJpbmcgdmFsdWUgaW50byBhIGBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbmAuIFRoaXMgbWF5IHJldHVybiBgdW5kZWZpbmVkYCBpZiB0aGUgZm9ybWF0IG9mIHRoZVxuICAgKiBQcm9wZXJ0eSBjYW5ub3QgYmUgaGFuZGxlZCBieSB0aGUgYFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXJgLlxuICAgKlxuICAgKiBAcGFyYW0gZGVmaW5pdGlvbiBUaGUgUHJvcGVydHkgc3RyaW5nIHZhbHVlIHRvIGF0dGVtcHQgdG8gcGFyc2VcbiAgICovXG4gIGZyb21Qcm9wZXJ0eShkZWZpbml0aW9uOiBzdHJpbmcpOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbiB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogU2VyaWFsaXplIGEgYENvbW11bmljYXRpb25EZWZpbml0aW9uYCBpbnRvIGEgUHJvcGVydHkgc3RyaW5nXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wZXJ0eVZhbHVlIFRoZSBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbiB0byBzZXJpYWxpemUgaW50byBhIFByb3BlcnR5IHN0cmluZ1xuICAgKi9cbiAgdG9Qcm9wZXJ0eShwcm9wZXJ0eVZhbHVlOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbik6IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGh1bWFuKCk6IFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXIge1xuICByZXR1cm4ge1xuICAgIGZyb21Qcm9wZXJ0eSh2YWx1ZTogc3RyaW5nKTogQ29tbXVuaWNhdGlvbkRlZmluaXRpb24gfCB1bmRlZmluZWQge1xuICAgICAgY29uc3Qgc3BsaXRBdCA9IHZhbHVlLmluZGV4T2YoJyAnKTtcbiAgICAgIGlmIChzcGxpdEF0ID09PSAtMSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgY29uc3QgdHJhbnNwb3J0ID0gdmFsdWUuc3Vic3RyKDAsIHNwbGl0QXQpO1xuICAgICAgY29uc3QgcGFyYW0gPSB2YWx1ZS5zdWJzdHIoc3BsaXRBdCArIDEpO1xuICAgICAgaWYgKHBhcmFtLmluY2x1ZGVzKCcgJykpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgQ29tbXVuaWNhdGlvbkRlZmluaXRpb24odHJhbnNwb3J0LCBwYXJhbSk7XG4gICAgfSxcbiAgICB0b1Byb3BlcnR5KGRlZmluaXRpb246IENvbW11bmljYXRpb25EZWZpbml0aW9uKTogc3RyaW5nIHtcbiAgICAgIGlmIChkZWZpbml0aW9uLnBhcmFtLmluY2x1ZGVzKCcgJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdIdW1hbiBTZXJpYWxpemVyRGVzZXJpYWxpemVyIGNhbm5vdCBzZXJpYWxpemUgQ29tbXVuaWNhdGlvbkRlZmluaXRpb24gY29udGFpbmluZyBhIHNwYWNlIGluIHRoZSBwYXJhbScsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYCR7ZGVmaW5pdGlvbi50cmFuc3BvcnR9ICR7ZGVmaW5pdGlvbi5wYXJhbX1gO1xuICAgIH0sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYW5nbGVkKCk6IFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXIge1xuICByZXR1cm4ge1xuICAgIGZyb21Qcm9wZXJ0eSh2YWx1ZTogc3RyaW5nKTogQ29tbXVuaWNhdGlvbkRlZmluaXRpb24gfCB1bmRlZmluZWQge1xuICAgICAgaWYgKCF2YWx1ZS5zdGFydHNXaXRoKCc6MDonKSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgbGV0IGJsb2I6IHN0cmluZztcbiAgICAgIHRyeSB7XG4gICAgICAgIGJsb2IgPSBhdG9iKHZhbHVlLnNsaWNlKCc6MDonLmxlbmd0aCkpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBOb3QgdmFsaWQgYmFzZTY0XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNwbGl0QXQgPSBibG9iLmluZGV4T2YoJyAnKTtcbiAgICAgIGNvbnN0IHRyYW5zcG9ydCA9IGJsb2Iuc3Vic3RyKDAsIHNwbGl0QXQpO1xuICAgICAgY29uc3QgcGFyYW0gPSBibG9iLnN1YnN0cihzcGxpdEF0ICsgMSk7XG4gICAgICByZXR1cm4gbmV3IENvbW11bmljYXRpb25EZWZpbml0aW9uKHRyYW5zcG9ydCwgcGFyYW0pO1xuICAgIH0sXG4gICAgdG9Qcm9wZXJ0eShkZWZpbml0aW9uOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbik6IHN0cmluZyB7XG4gICAgICBjb25zdCBtYW5nbGVkVmFsdWUgPSBidG9hKGAke2RlZmluaXRpb24udHJhbnNwb3J0fSAke2RlZmluaXRpb24ucGFyYW19YCk7XG4gICAgICByZXR1cm4gYDowOiR7bWFuZ2xlZFZhbHVlfWA7XG4gICAgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gaXNWYWxpZFN0cnVjdHVyZShibG9iOiB1bmtub3duKTogYmxvYiBpcyB7IHRyYW5zcG9ydDogc3RyaW5nOyBwYXJhbTogc3RyaW5nIH0ge1xuICBpZiAodHlwZW9mIGJsb2IgIT09ICdvYmplY3QnIHx8IGJsb2IgPT09IG51bGwgfHwgISgndHJhbnNwb3J0JyBpbiBibG9iKSB8fCAhKCdwYXJhbScgaW4gYmxvYikpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3Qgc3RydWN0dXJlID0gYmxvYiBhcyB7IHRyYW5zcG9ydDogdW5rbm93bjsgcGFyYW06IHVua25vd24gfTtcbiAgcmV0dXJuIHR5cGVvZiBzdHJ1Y3R1cmUudHJhbnNwb3J0ID09PSAnc3RyaW5nJyAmJiB0eXBlb2Ygc3RydWN0dXJlLnBhcmFtID09PSAnc3RyaW5nJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1hbmdsZWRKc29uKCk6IFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXIge1xuICByZXR1cm4ge1xuICAgIGZyb21Qcm9wZXJ0eSh2YWx1ZTogc3RyaW5nKTogQ29tbXVuaWNhdGlvbkRlZmluaXRpb24gfCB1bmRlZmluZWQge1xuICAgICAgaWYgKCF2YWx1ZS5zdGFydHNXaXRoKCc6MTonKSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgbGV0IGJsb2I6IHVua25vd247XG4gICAgICB0cnkge1xuICAgICAgICBibG9iID0gSlNPTi5wYXJzZSh2YWx1ZS5zbGljZSgnOjE6Jy5sZW5ndGgpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gTm90IHZhbGlkIEpTT05cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc1ZhbGlkU3RydWN0dXJlKGJsb2IpKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgQ29tbXVuaWNhdGlvbkRlZmluaXRpb24oYmxvYi50cmFuc3BvcnQsIGJsb2IucGFyYW0pO1xuICAgIH0sXG4gICAgdG9Qcm9wZXJ0eShkZWZpbml0aW9uOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbik6IHN0cmluZyB7XG4gICAgICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkoeyB0cmFuc3BvcnQ6IGRlZmluaXRpb24udHJhbnNwb3J0LCBwYXJhbTogZGVmaW5pdGlvbi5wYXJhbSB9KTtcbiAgICAgIHJldHVybiBgOjE6JHtqc29ufWA7XG4gICAgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gdHJ5UGFyc2U8UGFyc2VyLCBSPihcbiAgaW5wdXRWYWx1ZTogc3RyaW5nLFxuICBwYXJzZXJzOiBBcnJheTxQYXJzZXI+LFxuICBwYXJzZTogKHBhcnNlcjogUGFyc2VyLCB2YWx1ZTogc3RyaW5nKSA9PiBSIHwgdW5kZWZpbmVkLFxuKTogUiB8IHVuZGVmaW5lZCB7XG4gIGZvciAoY29uc3QgcGFyc2VyIG9mIHBhcnNlcnMpIHtcbiAgICBjb25zdCByZXN1bHQgPSBwYXJzZShwYXJzZXIsIGlucHV0VmFsdWUpO1xuICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbWJpbmVkKHBhcnNlcnM6IEFycmF5PFNlcmlhbGl6ZXJEZXNlcmlhbGl6ZXI+KTogU2VyaWFsaXplckRlc2VyaWFsaXplciB7XG4gIHJldHVybiB7XG4gICAgZnJvbVByb3BlcnR5KGlucHV0VmFsdWU6IHN0cmluZyk6IENvbW11bmljYXRpb25EZWZpbml0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICAgIHJldHVybiB0cnlQYXJzZShpbnB1dFZhbHVlLCBwYXJzZXJzLCAocGFyc2VyLCB2YWx1ZSkgPT4gcGFyc2VyLmZyb21Qcm9wZXJ0eSh2YWx1ZSkpO1xuICAgIH0sXG4gICAgdG9Qcm9wZXJ0eShkZWZpbml0aW9uOiBDb21tdW5pY2F0aW9uRGVmaW5pdGlvbik6IHN0cmluZyB7XG4gICAgICBjb25zdCBmaXJzdCA9IHBhcnNlcnNbMF07XG4gICAgICByZXR1cm4gZmlyc3QudG9Qcm9wZXJ0eShkZWZpbml0aW9uKTtcbiAgICB9LFxuICB9O1xufVxuIl19