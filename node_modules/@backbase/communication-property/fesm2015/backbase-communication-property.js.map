{"version":3,"file":"backbase-communication-property.js","sources":["../../../../projects/backbase/communication-property/src/serdes.ts","../../../../projects/backbase/communication-property/src/public-api.ts","../../../../projects/backbase/communication-property/src/backbase-communication-property.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Configuration of a Widget Input or Output Pipeline\n */\nexport class CommunicationDefinition {\n  /**\n   * @param transport The transport identifier string\n   * @param param A transport-specific param\n   */\n  constructor(\n    /**\n     * The transport identifier string\n     */\n    readonly transport: string,\n    /**\n     * A transport-specific param\n     */\n    readonly param: string,\n  ) {}\n  /**\n   * Determine if a `CommunicationDefinition` is equal to this one.\n   *\n   * @param other The other `CommunicationDefinition` to compare to\n   */\n  equals(other: CommunicationDefinition) {\n    return this.transport === other.transport && this.param === other.param;\n  }\n}\n\n/**\n * Serialize/Deserialize a Widget Communication Definition to/from a value suitable to be used in a Property string\n */\nexport interface SerializerDeserializer {\n  /**\n   * Parse a Property string value into a `CommunicationDefinition`. This may return `undefined` if the format of the\n   * Property cannot be handled by the `SerializerDeserializer`.\n   *\n   * @param definition The Property string value to attempt to parse\n   */\n  fromProperty(definition: string): CommunicationDefinition | undefined;\n\n  /**\n   * Serialize a `CommunicationDefinition` into a Property string\n   *\n   * @param propertyValue The CommunicationDefinition to serialize into a Property string\n   */\n  toProperty(propertyValue: CommunicationDefinition): string;\n}\n\nexport function human(): SerializerDeserializer {\n  return {\n    fromProperty(value: string): CommunicationDefinition | undefined {\n      const splitAt = value.indexOf(' ');\n      if (splitAt === -1) {\n        return undefined;\n      }\n      const transport = value.substr(0, splitAt);\n      const param = value.substr(splitAt + 1);\n      if (param.includes(' ')) {\n        return undefined;\n      }\n      return new CommunicationDefinition(transport, param);\n    },\n    toProperty(definition: CommunicationDefinition): string {\n      if (definition.param.includes(' ')) {\n        throw new Error(\n          'Human SerializerDeserializer cannot serialize CommunicationDefinition containing a space in the param',\n        );\n      }\n      return `${definition.transport} ${definition.param}`;\n    },\n  };\n}\n\nexport function mangled(): SerializerDeserializer {\n  return {\n    fromProperty(value: string): CommunicationDefinition | undefined {\n      if (!value.startsWith(':0:')) {\n        return undefined;\n      }\n      let blob: string;\n      try {\n        blob = atob(value.slice(':0:'.length));\n      } catch (e) {\n        // Not valid base64\n        return undefined;\n      }\n\n      const splitAt = blob.indexOf(' ');\n      const transport = blob.substr(0, splitAt);\n      const param = blob.substr(splitAt + 1);\n      return new CommunicationDefinition(transport, param);\n    },\n    toProperty(definition: CommunicationDefinition): string {\n      const mangledValue = btoa(`${definition.transport} ${definition.param}`);\n      return `:0:${mangledValue}`;\n    },\n  };\n}\n\nfunction isValidStructure(blob: unknown): blob is { transport: string; param: string } {\n  if (typeof blob !== 'object' || blob === null || !('transport' in blob) || !('param' in blob)) {\n    return false;\n  }\n  const structure = blob as { transport: unknown; param: unknown };\n  return typeof structure.transport === 'string' && typeof structure.param === 'string';\n}\n\nexport function mangledJson(): SerializerDeserializer {\n  return {\n    fromProperty(value: string): CommunicationDefinition | undefined {\n      if (!value.startsWith(':1:')) {\n        return undefined;\n      }\n      let blob: unknown;\n      try {\n        blob = JSON.parse(value.slice(':1:'.length));\n      } catch (e) {\n        // Not valid JSON\n        return undefined;\n      }\n\n      if (!isValidStructure(blob)) {\n        return undefined;\n      }\n\n      return new CommunicationDefinition(blob.transport, blob.param);\n    },\n    toProperty(definition: CommunicationDefinition): string {\n      const json = JSON.stringify({ transport: definition.transport, param: definition.param });\n      return `:1:${json}`;\n    },\n  };\n}\n\nfunction tryParse<Parser, R>(\n  inputValue: string,\n  parsers: Array<Parser>,\n  parse: (parser: Parser, value: string) => R | undefined,\n): R | undefined {\n  for (const parser of parsers) {\n    const result = parse(parser, inputValue);\n    if (result !== undefined) {\n      return result;\n    }\n  }\n  return undefined;\n}\n\nexport function combined(parsers: Array<SerializerDeserializer>): SerializerDeserializer {\n  return {\n    fromProperty(inputValue: string): CommunicationDefinition | undefined {\n      return tryParse(inputValue, parsers, (parser, value) => parser.fromProperty(value));\n    },\n    toProperty(definition: CommunicationDefinition): string {\n      const first = parsers[0];\n      return first.toProperty(definition);\n    },\n  };\n}\n","import { combined, human, mangled, mangledJson, SerializerDeserializer } from './serdes';\n\nexport { CommunicationDefinition, SerializerDeserializer } from './serdes';\n\n/**\n * Pre-configured `SerializerDeserializer`\n *\n * This `SerializerDeserializer` will attempt to Deserialize Property falling back to older methods\n * for backwards compatibility. Serialization will be performed using the newest method available.\n */\nexport const serializerDeserializer: SerializerDeserializer = combined([mangledJson(), mangled(), human()]);\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {combined as ɵd,human as ɵa,mangled as ɵb,mangledJson as ɵc} from './serdes';"]}