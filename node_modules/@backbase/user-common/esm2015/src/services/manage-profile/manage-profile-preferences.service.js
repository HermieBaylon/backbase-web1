import { Injectable, Optional } from '@angular/core';
import { combineLatest, of } from 'rxjs';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/foundation-ang/core";
const defaultProperties = {
    notificationDismissTime: 3,
    enablePhoneNumberFormatter: true,
    phoneNumberCountryCode: 'CA',
    phoneNumberDebounceTime: 1,
    lockUnlockUserAccountCommentRequired: false,
    emailAddressTypes: [''],
    postalAddressTypes: [''],
    phoneNumberTypes: [''],
    maxEmailAddresses: 3,
    maxPhoneNumbers: 3,
    maxPostalAddresses: 3,
    legalEntityDebounceTime: 1,
    usernameDebounceTime: 1,
    requiredUserActionsDebounceTime: 1,
    legalEntityResponseSize: 5,
    showWidgetHeader: true,
};
export class ManageProfilePreferencesService {
    constructor(model) {
        this.model = model;
    }
    getPhoneNumberInputPreferences() {
        return combineLatest([
            this.getPhoneNumberDebounceTimePreference(),
            this.getPhoneNumberCountryCodePreference(),
            this.getPhoneNumberFormatPreference(),
        ]).pipe(map(([debounceTime, countryCode, enablePhoneNumberFormatter]) => ({
            debounceTime,
            countryCode,
            enablePhoneNumberFormatter,
        })));
    }
    getPhoneNumberDebounceTimePreference() {
        return this.model
            ? this.model.property('phoneNumberDebounceTime', defaultProperties.phoneNumberDebounceTime)
            : of(defaultProperties.phoneNumberDebounceTime);
    }
    getPhoneNumberCountryCodePreference() {
        return this.model ? this.model.property('phoneNumberCountryCode', 'CA') : of('CA');
    }
    getPhoneNumberFormatPreference() {
        return this.model
            ? this.model
                .property('enablePhoneNumberFormatter', JSON.stringify(defaultProperties.enablePhoneNumberFormatter))
                .pipe(map((value) => value === 'true'))
            : of(defaultProperties.enablePhoneNumberFormatter);
    }
    getNotificationDismissTimePreference() {
        return this.model
            ? this.model.property('notificationDismissTime', defaultProperties.notificationDismissTime)
            : of(defaultProperties.notificationDismissTime);
    }
    getLockUnlockAccountCommentRequiredPreference() {
        return this.model
            ? this.model.property('lockUnlockUserAccountCommentRequired', defaultProperties.lockUnlockUserAccountCommentRequired)
            : of(defaultProperties.lockUnlockUserAccountCommentRequired);
    }
    getWidgetPreferences() {
        const preferenceObservables = [
            this.getEmailAddressTypePreferences(),
            this.getPostalAddressTypePreferences(),
            this.getPhoneNumberTypePreferences(),
            this.getMaxEmailAddressesPreference(),
            this.getMaxPhoneNumbersPreference(),
            this.getMaxPostalAddressesPreference(),
            this.getShowWidgetHeaderPreference(),
        ];
        return combineLatest(preferenceObservables).pipe(map(([emailAddressTypes, postalAddressTypes, phoneNumberTypes, maxEmailAddresses, maxPhoneNumbers, maxPostalAddresses, showWidgetHeader,]) => ({
            emailAddressTypes,
            postalAddressTypes,
            phoneNumberTypes,
            maxEmailAddresses,
            maxPhoneNumbers,
            maxPostalAddresses,
            showWidgetHeader,
        })));
    }
    getEmailAddressTypePreferences() {
        return this.getModelToSeparatedStringArray('emailAddressTypes');
    }
    getPostalAddressTypePreferences() {
        return this.getModelToSeparatedStringArray('postalAddressTypes');
    }
    getPhoneNumberTypePreferences() {
        return this.getModelToSeparatedStringArray('phoneNumberTypes');
    }
    getModelToSeparatedStringArray(modelName) {
        return this.model
            ? this.model.property(modelName, '').pipe(map(this.convertCommaSeparatedStringToStringArray))
            : of(defaultProperties[modelName]);
    }
    convertCommaSeparatedStringToStringArray(value) {
        return value ? value.split(',').map((arrayItem) => arrayItem.trim()) : [];
    }
    getMaxEmailAddressesPreference() {
        return this.model
            ? this.model.property('maxEmailAddresses', defaultProperties.maxEmailAddresses)
            : of(defaultProperties.maxEmailAddresses);
    }
    getMaxPhoneNumbersPreference() {
        return this.model
            ? this.model.property('maxPhoneNumbers', defaultProperties.maxPhoneNumbers)
            : of(defaultProperties.maxPhoneNumbers);
    }
    getMaxPostalAddressesPreference() {
        return this.model
            ? this.model.property('maxPostalAddresses', defaultProperties.maxPostalAddresses)
            : of(defaultProperties.maxPostalAddresses);
    }
    getLegalEntityDebouncePreference() {
        return this.model
            ? this.model.property('legalEntityDebounceTime', defaultProperties.legalEntityDebounceTime)
            : of(defaultProperties.legalEntityDebounceTime);
    }
    getUsernameDebouncePreference() {
        return this.model
            ? this.model.property('usernameDebounceTime', defaultProperties.usernameDebounceTime)
            : of(defaultProperties.usernameDebounceTime);
    }
    getRequiredUserActionsDebouncePreference() {
        return this.model
            ? this.model.property('requiredUserActionsDebounceTime', defaultProperties.requiredUserActionsDebounceTime)
            : of(defaultProperties.requiredUserActionsDebounceTime);
    }
    getLegalEntityResponseSizePreference() {
        return this.model
            ? this.model.property('legalEntityResponseSize', defaultProperties.legalEntityResponseSize)
            : of(defaultProperties.legalEntityResponseSize);
    }
    getShowWidgetHeaderPreference() {
        return this.model
            ? this.model
                .property('showWidgetHeader', JSON.stringify(defaultProperties.showWidgetHeader))
                .pipe(map((value) => !!value && value !== 'false'))
            : of(defaultProperties.showWidgetHeader);
    }
}
ManageProfilePreferencesService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: ManageProfilePreferencesService, deps: [{ token: i1.ItemModel, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
ManageProfilePreferencesService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: ManageProfilePreferencesService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: ManageProfilePreferencesService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.ItemModel, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlLXByb2ZpbGUtcHJlZmVyZW5jZXMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvdXNlci1jb21tb24vc3JjL3NlcnZpY2VzL21hbmFnZS1wcm9maWxlL21hbmFnZS1wcm9maWxlLXByZWZlcmVuY2VzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHckQsT0FBTyxFQUFFLGFBQWEsRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7QUFxQnJDLE1BQU0saUJBQWlCLEdBQXNCO0lBQzNDLHVCQUF1QixFQUFFLENBQUM7SUFDMUIsMEJBQTBCLEVBQUUsSUFBSTtJQUNoQyxzQkFBc0IsRUFBRSxJQUFJO0lBQzVCLHVCQUF1QixFQUFFLENBQUM7SUFDMUIsb0NBQW9DLEVBQUUsS0FBSztJQUMzQyxpQkFBaUIsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUN2QixrQkFBa0IsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUN4QixnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUN0QixpQkFBaUIsRUFBRSxDQUFDO0lBQ3BCLGVBQWUsRUFBRSxDQUFDO0lBQ2xCLGtCQUFrQixFQUFFLENBQUM7SUFDckIsdUJBQXVCLEVBQUUsQ0FBQztJQUMxQixvQkFBb0IsRUFBRSxDQUFDO0lBQ3ZCLCtCQUErQixFQUFFLENBQUM7SUFDbEMsdUJBQXVCLEVBQUUsQ0FBQztJQUMxQixnQkFBZ0IsRUFBRSxJQUFJO0NBQ3ZCLENBQUM7QUFtQkYsTUFBTSxPQUFPLCtCQUErQjtJQUMxQyxZQUF5QyxLQUFpQjtRQUFqQixVQUFLLEdBQUwsS0FBSyxDQUFZO0lBQUcsQ0FBQztJQUU5RCw4QkFBOEI7UUFDNUIsT0FBTyxhQUFh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SUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQVMseUJBQXlCLEVBQUUsaUJBQWlCLENBQUMsdUJBQXVCLENBQUM7WUFDbkcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCw2QkFBNkI7UUFDM0IsT0FBTyxJQUFJLENBQUMsS0FBSztZQUNmLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSztpQkFDUCxRQUFRLENBQVMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2lCQUN4RixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLEtBQUssS0FBSyxPQUFPLENBQUMsQ0FBQztZQUN2RCxDQUFDLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDN0MsQ0FBQzs7NkhBL0pVLCtCQUErQjtpSUFBL0IsK0JBQStCOzRGQUEvQiwrQkFBK0I7a0JBRDNDLFVBQVU7OzBCQUVJLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSXRlbU1vZGVsIH0gZnJvbSAnQGJhY2tiYXNlL2ZvdW5kYXRpb24tYW5nL2NvcmUnO1xuaW1wb3J0IHsgQ291bnRyeUNvZGUgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL3Bob25lLW51bWJlci1mb3JtYXQtcGlwZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERlZmF1bHRQcm9wZXJ0aWVzIHtcbiAgbm90aWZpY2F0aW9uRGlzbWlzc1RpbWU6IG51bWJlcjtcbiAgZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXI6IGJvb2xlYW47XG4gIHBob25lTnVtYmVyQ291bnRyeUNvZGU6IENvdW50cnlDb2RlO1xuICBwaG9uZU51bWJlckRlYm91bmNlVGltZTogbnVtYmVyO1xuICBsb2NrVW5sb2NrVXNlckFjY291bnRDb21tZW50UmVxdWlyZWQ6IGJvb2xlYW47XG4gIGVtYWlsQWRkcmVzc1R5cGVzOiBBcnJheTxzdHJpbmc+O1xuICBwb3N0YWxBZGRyZXNzVHlwZXM6IEFycmF5PHN0cmluZz47XG4gIHBob25lTnVtYmVyVHlwZXM6IEFycmF5PHN0cmluZz47XG4gIG1heEVtYWlsQWRkcmVzc2VzOiBudW1iZXI7XG4gIG1heFBob25lTnVtYmVyczogbnVtYmVyO1xuICBtYXhQb3N0YWxBZGRyZXNzZXM6IG51bWJlcjtcbiAgbGVnYWxFbnRpdHlEZWJvdW5jZVRpbWU6IG51bWJlcjtcbiAgdXNlcm5hbWVEZWJvdW5jZVRpbWU6IG51bWJlcjtcbiAgcmVxdWlyZWRVc2VyQWN0aW9uc0RlYm91bmNlVGltZTogbnVtYmVyO1xuICBsZWdhbEVudGl0eVJlc3BvbnNlU2l6ZTogbnVtYmVyO1xuICBzaG93V2lkZ2V0SGVhZGVyOiBib29sZWFuO1xufVxuXG5jb25zdCBkZWZhdWx0UHJvcGVydGllczogRGVmYXVsdFByb3BlcnRpZXMgPSB7XG4gIG5vdGlmaWNhdGlvbkRpc21pc3NUaW1lOiAzLFxuICBlbmFibGVQaG9uZU51bWJlckZvcm1hdHRlcjogdHJ1ZSxcbiAgcGhvbmVOdW1iZXJDb3VudHJ5Q29kZTogJ0NBJyxcbiAgcGhvbmVOdW1iZXJEZWJvdW5jZVRpbWU6IDEsXG4gIGxvY2tVbmxvY2tVc2VyQWNjb3VudENvbW1lbnRSZXF1aXJlZDogZmFsc2UsXG4gIGVtYWlsQWRkcmVzc1R5cGVzOiBbJyddLFxuICBwb3N0YWxBZGRyZXNzVHlwZXM6IFsnJ10sXG4gIHBob25lTnVtYmVyVHlwZXM6IFsnJ10sXG4gIG1heEVtYWlsQWRkcmVzc2VzOiAzLFxuICBtYXhQaG9uZU51bWJlcnM6IDMsXG4gIG1heFBvc3RhbEFkZHJlc3NlczogMyxcbiAgbGVnYWxFbnRpdHlEZWJvdW5jZVRpbWU6IDEsXG4gIHVzZXJuYW1lRGVib3VuY2VUaW1lOiAxLFxuICByZXF1aXJlZFVzZXJBY3Rpb25zRGVib3VuY2VUaW1lOiAxLFxuICBsZWdhbEVudGl0eVJlc3BvbnNlU2l6ZTogNSxcbiAgc2hvd1dpZGdldEhlYWRlcjogdHJ1ZSxcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2lkZ2V0UHJlZmVyZW5jZXMge1xuICBlbWFpbEFkZHJlc3NUeXBlczogQXJyYXk8c3RyaW5nPjtcbiAgcG9zdGFsQWRkcmVzc1R5cGVzOiBBcnJheTxzdHJpbmc+O1xuICBwaG9uZU51bWJlclR5cGVzOiBBcnJheTxzdHJpbmc+O1xuICBtYXhFbWFpbEFkZHJlc3NlczogbnVtYmVyO1xuICBtYXhQaG9uZU51bWJlcnM6IG51bWJlcjtcbiAgbWF4UG9zdGFsQWRkcmVzc2VzOiBudW1iZXI7XG4gIHNob3dXaWRnZXRIZWFkZXI6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGhvbmVOdW1iZXJJbnB1dFByZWZlcmVuY2VzIHtcbiAgZGVib3VuY2VUaW1lOiBudW1iZXI7XG4gIGNvdW50cnlDb2RlOiBDb3VudHJ5Q29kZTtcbiAgZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXI/OiBib29sZWFuO1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWFuYWdlUHJvZmlsZVByZWZlcmVuY2VzU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgcmVhZG9ubHkgbW9kZWw/OiBJdGVtTW9kZWwpIHt9XG5cbiAgZ2V0UGhvbmVOdW1iZXJJbnB1dFByZWZlcmVuY2VzKCk6IE9ic2VydmFibGU8UGhvbmVOdW1iZXJJbnB1dFByZWZlcmVuY2VzPiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy5nZXRQaG9uZU51bWJlckRlYm91bmNlVGltZVByZWZlcmVuY2UoKSxcbiAgICAgIHRoaXMuZ2V0UGhvbmVOdW1iZXJDb3VudHJ5Q29kZVByZWZlcmVuY2UoKSxcbiAgICAgIHRoaXMuZ2V0UGhvbmVOdW1iZXJGb3JtYXRQcmVmZXJlbmNlKCksXG4gICAgXSkucGlwZShcbiAgICAgIG1hcCgoW2RlYm91bmNlVGltZSwgY291bnRyeUNvZGUsIGVuYWJsZVBob25lTnVtYmVyRm9ybWF0dGVyXTogW251bWJlciwgQ291bnRyeUNvZGUsIGJvb2xlYW5dKSA9PiAoe1xuICAgICAgICBkZWJvdW5jZVRpbWUsXG4gICAgICAgIGNvdW50cnlDb2RlLFxuICAgICAgICBlbmFibGVQaG9uZU51bWJlckZvcm1hdHRlcixcbiAgICAgIH0pKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQaG9uZU51bWJlckRlYm91bmNlVGltZVByZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFxuICAgICAgPyB0aGlzLm1vZGVsLnByb3BlcnR5PG51bWJlcj4oJ3Bob25lTnVtYmVyRGVib3VuY2VUaW1lJywgZGVmYXVsdFByb3BlcnRpZXMucGhvbmVOdW1iZXJEZWJvdW5jZVRpbWUpXG4gICAgICA6IG9mKGRlZmF1bHRQcm9wZXJ0aWVzLnBob25lTnVtYmVyRGVib3VuY2VUaW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGhvbmVOdW1iZXJDb3VudHJ5Q29kZVByZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxDb3VudHJ5Q29kZT4ge1xuICAgIHJldHVybiB0aGlzLm1vZGVsID8gdGhpcy5tb2RlbC5wcm9wZXJ0eTxDb3VudHJ5Q29kZT4oJ3Bob25lTnVtYmVyQ291bnRyeUNvZGUnLCAnQ0EnKSA6IG9mKCdDQScpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQaG9uZU51bWJlckZvcm1hdFByZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbFxuICAgICAgICAgIC5wcm9wZXJ0eTxzdHJpbmc+KCdlbmFibGVQaG9uZU51bWJlckZvcm1hdHRlcicsIEpTT04uc3RyaW5naWZ5KGRlZmF1bHRQcm9wZXJ0aWVzLmVuYWJsZVBob25lTnVtYmVyRm9ybWF0dGVyKSlcbiAgICAgICAgICAucGlwZShtYXAoKHZhbHVlKSA9PiB2YWx1ZSA9PT0gJ3RydWUnKSlcbiAgICAgIDogb2YoZGVmYXVsdFByb3BlcnRpZXMuZW5hYmxlUGhvbmVOdW1iZXJGb3JtYXR0ZXIpO1xuICB9XG5cbiAgZ2V0Tm90aWZpY2F0aW9uRGlzbWlzc1RpbWVQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbC5wcm9wZXJ0eSgnbm90aWZpY2F0aW9uRGlzbWlzc1RpbWUnLCBkZWZhdWx0UHJvcGVydGllcy5ub3RpZmljYXRpb25EaXNtaXNzVGltZSlcbiAgICAgIDogb2YoZGVmYXVsdFByb3BlcnRpZXMubm90aWZpY2F0aW9uRGlzbWlzc1RpbWUpO1xuICB9XG5cbiAgZ2V0TG9ja1VubG9ja0FjY291bnRDb21tZW50UmVxdWlyZWRQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLm1vZGVsXG4gICAgICA/IHRoaXMubW9kZWwucHJvcGVydHk8Ym9vbGVhbj4oXG4gICAgICAgICAgJ2xvY2tVbmxvY2tVc2VyQWNjb3VudENvbW1lbnRSZXF1aXJlZCcsXG4gICAgICAgICAgZGVmYXVsdFByb3BlcnRpZXMubG9ja1VubG9ja1VzZXJBY2NvdW50Q29tbWVudFJlcXVpcmVkLFxuICAgICAgICApXG4gICAgICA6IG9mKGRlZmF1bHRQcm9wZXJ0aWVzLmxvY2tVbmxvY2tVc2VyQWNjb3VudENvbW1lbnRSZXF1aXJlZCk7XG4gIH1cblxuICBnZXRXaWRnZXRQcmVmZXJlbmNlcygpOiBPYnNlcnZhYmxlPFdpZGdldFByZWZlcmVuY2VzPiB7XG4gICAgY29uc3QgcHJlZmVyZW5jZU9ic2VydmFibGVzOiBPYnNlcnZhYmxlPGFueT5bXSA9IFtcbiAgICAgIHRoaXMuZ2V0RW1haWxBZGRyZXNzVHlwZVByZWZlcmVuY2VzKCksXG4gICAgICB0aGlzLmdldFBvc3RhbEFkZHJlc3NUeXBlUHJlZmVyZW5jZXMoKSxcbiAgICAgIHRoaXMuZ2V0UGhvbmVOdW1iZXJUeXBlUHJlZmVyZW5jZXMoKSxcbiAgICAgIHRoaXMuZ2V0TWF4RW1haWxBZGRyZXNzZXNQcmVmZXJlbmNlKCksXG4gICAgICB0aGlzLmdldE1heFBob25lTnVtYmVyc1ByZWZlcmVuY2UoKSxcbiAgICAgIHRoaXMuZ2V0TWF4UG9zdGFsQWRkcmVzc2VzUHJlZmVyZW5jZSgpLFxuICAgICAgdGhpcy5nZXRTaG93V2lkZ2V0SGVhZGVyUHJlZmVyZW5jZSgpLFxuICAgIF07XG5cbiAgICByZXR1cm4gY29tYmluZUxhdGVzdChwcmVmZXJlbmNlT2JzZXJ2YWJsZXMpLnBpcGUoXG4gICAgICBtYXAoXG4gICAgICAgIChbXG4gICAgICAgICAgZW1haWxBZGRyZXNzVHlwZXMsXG4gICAgICAgICAgcG9zdGFsQWRkcmVzc1R5cGVzLFxuICAgICAgICAgIHBob25lTnVtYmVyVHlwZXMsXG4gICAgICAgICAgbWF4RW1haWxBZGRyZXNzZXMsXG4gICAgICAgICAgbWF4UGhvbmVOdW1iZXJzLFxuICAgICAgICAgIG1heFBvc3RhbEFkZHJlc3NlcyxcbiAgICAgICAgICBzaG93V2lkZ2V0SGVhZGVyLFxuICAgICAgICBdOiBhbnlbXSkgPT4gKHtcbiAgICAgICAgICBlbWFpbEFkZHJlc3NUeXBlcyxcbiAgICAgICAgICBwb3N0YWxBZGRyZXNzVHlwZXMsXG4gICAgICAgICAgcGhvbmVOdW1iZXJUeXBlcyxcbiAgICAgICAgICBtYXhFbWFpbEFkZHJlc3NlcyxcbiAgICAgICAgICBtYXhQaG9uZU51bWJlcnMsXG4gICAgICAgICAgbWF4UG9zdGFsQWRkcmVzc2VzLFxuICAgICAgICAgIHNob3dXaWRnZXRIZWFkZXIsXG4gICAgICAgIH0pLFxuICAgICAgKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFbWFpbEFkZHJlc3NUeXBlUHJlZmVyZW5jZXMoKTogT2JzZXJ2YWJsZTxBcnJheTxzdHJpbmc+PiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TW9kZWxUb1NlcGFyYXRlZFN0cmluZ0FycmF5KCdlbWFpbEFkZHJlc3NUeXBlcycpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQb3N0YWxBZGRyZXNzVHlwZVByZWZlcmVuY2VzKCk6IE9ic2VydmFibGU8QXJyYXk8c3RyaW5nPj4ge1xuICAgIHJldHVybiB0aGlzLmdldE1vZGVsVG9TZXBhcmF0ZWRTdHJpbmdBcnJheSgncG9zdGFsQWRkcmVzc1R5cGVzJyk7XG4gIH1cblxuICBwcml2YXRlIGdldFBob25lTnVtYmVyVHlwZVByZWZlcmVuY2VzKCk6IE9ic2VydmFibGU8QXJyYXk8c3RyaW5nPj4ge1xuICAgIHJldHVybiB0aGlzLmdldE1vZGVsVG9TZXBhcmF0ZWRTdHJpbmdBcnJheSgncGhvbmVOdW1iZXJUeXBlcycpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNb2RlbFRvU2VwYXJhdGVkU3RyaW5nQXJyYXkoXG4gICAgbW9kZWxOYW1lOiAnZW1haWxBZGRyZXNzVHlwZXMnIHwgJ3Bvc3RhbEFkZHJlc3NUeXBlcycgfCAncGhvbmVOdW1iZXJUeXBlcycsXG4gICk6IE9ic2VydmFibGU8QXJyYXk8c3RyaW5nPj4ge1xuICAgIHJldHVybiB0aGlzLm1vZGVsXG4gICAgICA/IHRoaXMubW9kZWwucHJvcGVydHk8c3RyaW5nPihtb2RlbE5hbWUsICcnKS5waXBlKG1hcCh0aGlzLmNvbnZlcnRDb21tYVNlcGFyYXRlZFN0cmluZ1RvU3RyaW5nQXJyYXkpKVxuICAgICAgOiBvZihkZWZhdWx0UHJvcGVydGllc1ttb2RlbE5hbWVdKTtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydENvbW1hU2VwYXJhdGVkU3RyaW5nVG9TdHJpbmdBcnJheSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlID8gdmFsdWUuc3BsaXQoJywnKS5tYXAoKGFycmF5SXRlbSkgPT4gYXJyYXlJdGVtLnRyaW0oKSkgOiBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWF4RW1haWxBZGRyZXNzZXNQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbC5wcm9wZXJ0eTxudW1iZXI+KCdtYXhFbWFpbEFkZHJlc3NlcycsIGRlZmF1bHRQcm9wZXJ0aWVzLm1heEVtYWlsQWRkcmVzc2VzKVxuICAgICAgOiBvZihkZWZhdWx0UHJvcGVydGllcy5tYXhFbWFpbEFkZHJlc3Nlcyk7XG4gIH1cblxuICBwcml2YXRlIGdldE1heFBob25lTnVtYmVyc1ByZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFxuICAgICAgPyB0aGlzLm1vZGVsLnByb3BlcnR5PG51bWJlcj4oJ21heFBob25lTnVtYmVycycsIGRlZmF1bHRQcm9wZXJ0aWVzLm1heFBob25lTnVtYmVycylcbiAgICAgIDogb2YoZGVmYXVsdFByb3BlcnRpZXMubWF4UGhvbmVOdW1iZXJzKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWF4UG9zdGFsQWRkcmVzc2VzUHJlZmVyZW5jZSgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLm1vZGVsXG4gICAgICA/IHRoaXMubW9kZWwucHJvcGVydHk8bnVtYmVyPignbWF4UG9zdGFsQWRkcmVzc2VzJywgZGVmYXVsdFByb3BlcnRpZXMubWF4UG9zdGFsQWRkcmVzc2VzKVxuICAgICAgOiBvZihkZWZhdWx0UHJvcGVydGllcy5tYXhQb3N0YWxBZGRyZXNzZXMpO1xuICB9XG5cbiAgZ2V0TGVnYWxFbnRpdHlEZWJvdW5jZVByZWZlcmVuY2UoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFxuICAgICAgPyB0aGlzLm1vZGVsLnByb3BlcnR5PG51bWJlcj4oJ2xlZ2FsRW50aXR5RGVib3VuY2VUaW1lJywgZGVmYXVsdFByb3BlcnRpZXMubGVnYWxFbnRpdHlEZWJvdW5jZVRpbWUpXG4gICAgICA6IG9mKGRlZmF1bHRQcm9wZXJ0aWVzLmxlZ2FsRW50aXR5RGVib3VuY2VUaW1lKTtcbiAgfVxuXG4gIGdldFVzZXJuYW1lRGVib3VuY2VQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbC5wcm9wZXJ0eTxudW1iZXI+KCd1c2VybmFtZURlYm91bmNlVGltZScsIGRlZmF1bHRQcm9wZXJ0aWVzLnVzZXJuYW1lRGVib3VuY2VUaW1lKVxuICAgICAgOiBvZihkZWZhdWx0UHJvcGVydGllcy51c2VybmFtZURlYm91bmNlVGltZSk7XG4gIH1cblxuICBnZXRSZXF1aXJlZFVzZXJBY3Rpb25zRGVib3VuY2VQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbC5wcm9wZXJ0eTxudW1iZXI+KFxuICAgICAgICAgICdyZXF1aXJlZFVzZXJBY3Rpb25zRGVib3VuY2VUaW1lJyxcbiAgICAgICAgICBkZWZhdWx0UHJvcGVydGllcy5yZXF1aXJlZFVzZXJBY3Rpb25zRGVib3VuY2VUaW1lLFxuICAgICAgICApXG4gICAgICA6IG9mKGRlZmF1bHRQcm9wZXJ0aWVzLnJlcXVpcmVkVXNlckFjdGlvbnNEZWJvdW5jZVRpbWUpO1xuICB9XG5cbiAgZ2V0TGVnYWxFbnRpdHlSZXNwb25zZVNpemVQcmVmZXJlbmNlKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWxcbiAgICAgID8gdGhpcy5tb2RlbC5wcm9wZXJ0eTxudW1iZXI+KCdsZWdhbEVudGl0eVJlc3BvbnNlU2l6ZScsIGRlZmF1bHRQcm9wZXJ0aWVzLmxlZ2FsRW50aXR5UmVzcG9uc2VTaXplKVxuICAgICAgOiBvZihkZWZhdWx0UHJvcGVydGllcy5sZWdhbEVudGl0eVJlc3BvbnNlU2l6ZSk7XG4gIH1cblxuICBnZXRTaG93V2lkZ2V0SGVhZGVyUHJlZmVyZW5jZSgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbFxuICAgICAgPyB0aGlzLm1vZGVsXG4gICAgICAgICAgLnByb3BlcnR5PHN0cmluZz4oJ3Nob3dXaWRnZXRIZWFkZXInLCBKU09OLnN0cmluZ2lmeShkZWZhdWx0UHJvcGVydGllcy5zaG93V2lkZ2V0SGVhZGVyKSlcbiAgICAgICAgICAucGlwZShtYXAoKHZhbHVlKSA9PiAhIXZhbHVlICYmIHZhbHVlICE9PSAnZmFsc2UnKSlcbiAgICAgIDogb2YoZGVmYXVsdFByb3BlcnRpZXMuc2hvd1dpZGdldEhlYWRlcik7XG4gIH1cbn1cbiJdfQ==