import { HTTP_INTERCEPTORS, HttpErrorResponse, HttpResponse, } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { of } from 'rxjs';
import { delay, map, tap } from 'rxjs/operators';
import { unhandledError } from './error-responses';
import { actionItemsToResponse, generateId } from './helpers';
export const ACCOUNT_IDS_ERRORS = {
    // 2nd account from top
    '1cdb2224-8926-4b4d-a99f-1c9dfbbb4692': unhandledError,
};
export class ActionsInterceptor {
    constructor() {
        this.actionsGetErrorCode = parseInt(localStorage.getItem('actionsGetErrorCode') || '', 10);
    }
    intercept(req, next) {
        if (localStorage.getItem('enableMocks') !== 'true') {
            return next.handle(req);
        }
        // empty response in mocks data module causes error
        // PUT for /action-recipes, excluding /action-recipes/batch
        if (req.url.match(/\/action-recipes\/(?!batch).*$/) && req.method === 'PUT') {
            const response = new HttpResponse({
                status: 202,
            });
            return of(response).pipe(delay(500), tap(() => console.log('CUSTOM INTERCEPTOR:', req, response)));
        }
        if (req.url.match(/\/action-recipes\/batch$/) && req.method === 'PUT') {
            return next.handle(req).pipe(map((event) => {
                var _a, _b, _c;
                if (event instanceof HttpResponse) {
                    if (!req.body || !req.body.actionRecipes)
                        return event;
                    const recipe = req.body.actionRecipes[0];
                    if (ACCOUNT_IDS_ERRORS[recipe.arrangementId]) {
                        const errorResponse = ACCOUNT_IDS_ERRORS[recipe.arrangementId];
                        console.log('[ACTIONS INTERCEPTOR]', req, errorResponse);
                        throw errorResponse;
                    }
                    const response = event.clone({
                        body: {
                            actionRecipes: [
                                Object.assign(Object.assign({ id: generateId() }, recipe), { actions: actionItemsToResponse(recipe.actions), recurrence: {
                                        daysOfWeek: (_a = recipe === null || recipe === void 0 ? void 0 : recipe.recurrence) === null || _a === void 0 ? void 0 : _a.daysOfWeek,
                                        hoursOfDay: (_c = (_b = recipe === null || recipe === void 0 ? void 0 : recipe.recurrence) === null || _b === void 0 ? void 0 : _b.hoursOfDay) === null || _c === void 0 ? void 0 : _c.map((hour) => Number(hour)).sort((a, b) => a - b),
                                    } }),
                            ],
                        },
                    });
                    console.log('[ACTIONS INTERCEPTOR]', req, response);
                    return response;
                }
                return event;
            }));
        }
        if (req.url.match(/\/action-recipes$/) && req.method === 'GET') {
            return next.handle(req).pipe(map((event) => {
                if (this.actionsGetErrorCode) {
                    const errorResponse = new HttpErrorResponse({
                        status: this.actionsGetErrorCode,
                    });
                    console.log('[ACTIONS INTERCEPTOR]', req, errorResponse);
                    throw errorResponse;
                }
                return event;
            }));
        }
        return next.handle(req);
    }
}
ActionsInterceptor.decorators = [
    { type: Injectable }
];
export const ActionsMocksProvider = {
    provide: HTTP_INTERCEPTORS,
    useClass: ActionsInterceptor,
    multi: true,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9ucy1pbnRlcmNlcHRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvYWN0aW9ucy1tb2Nrcy1wcm92aWRlci1hbmcvc3JjL2FjdGlvbnMtaW50ZXJjZXB0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixpQkFBaUIsRUFLakIsWUFBWSxHQUNiLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRTlELE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUF5QztJQUN0RSx1QkFBdUI7SUFDdkIsc0NBQXNDLEVBQUUsY0FBYztDQUN2RCxDQUFDO0FBR0YsTUFBTSxPQUFPLGtCQUFrQjtJQUQvQjtRQUVtQix3QkFBbUIsR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQWtGekcsQ0FBQztJQWhGQyxTQUFTLENBQUMsR0FBcUIsRUFBRSxJQUFpQjtRQUNoRCxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEtBQUssTUFBTSxFQUFFO1lBQ2xELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUN6QjtRQUVELG1EQUFtRDtRQUNuRCwyREFBMkQ7UUFDM0QsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxn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R0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO29CQUN6RCxNQUFNLGFBQWEsQ0FBQztpQkFDckI7Z0JBRUQsT0FBTyxLQUFLLENBQUM7WUFDZixDQUFDLENBQUMsQ0FDSCxDQUFDO1NBQ0g7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQzs7O1lBbkZGLFVBQVU7O0FBc0ZYLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFhO0lBQzVDLE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsUUFBUSxFQUFFLGtCQUFrQjtJQUM1QixLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBIVFRQX0lOVEVSQ0VQVE9SUyxcbiAgSHR0cEVycm9yUmVzcG9uc2UsXG4gIEh0dHBFdmVudCxcbiAgSHR0cEhhbmRsZXIsXG4gIEh0dHBJbnRlcmNlcHRvcixcbiAgSHR0cFJlcXVlc3QsXG4gIEh0dHBSZXNwb25zZSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgUHJvdmlkZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyB1bmhhbmRsZWRFcnJvciB9IGZyb20gJy4vZXJyb3ItcmVzcG9uc2VzJztcbmltcG9ydCB7IGFjdGlvbkl0ZW1zVG9SZXNwb25zZSwgZ2VuZXJhdGVJZCB9IGZyb20gJy4vaGVscGVycyc7XG5cbmV4cG9ydCBjb25zdCBBQ0NPVU5UX0lEU19FUlJPUlM6IHsgW2tleTogc3RyaW5nXTogSHR0cEVycm9yUmVzcG9uc2UgfSA9IHtcbiAgLy8gMm5kIGFjY291bnQgZnJvbSB0b3BcbiAgJzFjZGIyMjI0LTg5MjYtNGI0ZC1hOTlmLTFjOWRmYmJiNDY5Mic6IHVuaGFuZGxlZEVycm9yLFxufTtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEFjdGlvbnNJbnRlcmNlcHRvciBpbXBsZW1lbnRzIEh0dHBJbnRlcmNlcHRvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgYWN0aW9uc0dldEVycm9yQ29kZSA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY3Rpb25zR2V0RXJyb3JDb2RlJykgfHwgJycsIDEwKTtcblxuICBpbnRlcmNlcHQocmVxOiBIdHRwUmVxdWVzdDxhbnk+LCBuZXh0OiBIdHRwSGFuZGxlcik6IE9ic2VydmFibGU8SHR0cEV2ZW50PGFueT4+IHtcbiAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2VuYWJsZU1vY2tzJykgIT09ICd0cnVlJykge1xuICAgICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcSk7XG4gICAgfVxuXG4gICAgLy8gZW1wdHkgcmVzcG9uc2UgaW4gbW9ja3MgZGF0YSBtb2R1bGUgY2F1c2VzIGVycm9yXG4gICAgLy8gUFVUIGZvciAvYWN0aW9uLXJlY2lwZXMsIGV4Y2x1ZGluZyAvYWN0aW9uLXJlY2lwZXMvYmF0Y2hcbiAgICBpZiAocmVxLnVybC5tYXRjaCgvXFwvYWN0aW9uLXJlY2lwZXNcXC8oPyFiYXRjaCkuKiQvKSAmJiByZXEubWV0aG9kID09PSAnUFVUJykge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgSHR0cFJlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzOiAyMDIsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIG9mKHJlc3BvbnNlKS5waXBlKFxuICAgICAgICBkZWxheSg1MDApLFxuICAgICAgICB0YXAoKCkgPT4gY29uc29sZS5sb2coJ0NVU1RPTSBJTlRFUkNFUFRPUjonLCByZXEsIHJlc3BvbnNlKSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChyZXEudXJsLm1hdGNoKC9cXC9hY3Rpb24tcmVjaXBlc1xcL2JhdGNoJC8pICYmIHJlcS5tZXRob2QgPT09ICdQVVQnKSB7XG4gICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxKS5waXBlKFxuICAgICAgICBtYXAoKGV2ZW50OiBIdHRwRXZlbnQ8YW55PikgPT4ge1xuICAgICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKCFyZXEuYm9keSB8fCAhcmVxLmJvZHkuYWN0aW9uUmVjaXBlcykgcmV0dXJuIGV2ZW50O1xuXG4gICAgICAgICAgICBjb25zdCByZWNpcGUgPSByZXEuYm9keS5hY3Rpb25SZWNpcGVzWzBdO1xuXG4gICAgICAgICAgICBpZiAoQUNDT1VOVF9JRFNfRVJST1JTW3JlY2lwZS5hcnJhbmdlbWVudElkXSkge1xuICAgICAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0gQUNDT1VOVF9JRFNfRVJST1JTW3JlY2lwZS5hcnJhbmdlbWVudElkXTtcblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0FDVElPTlMgSU5URVJDRVBUT1JdJywgcmVxLCBlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgdGhyb3cgZXJyb3JSZXNwb25zZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBldmVudC5jbG9uZSh7XG4gICAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25SZWNpcGVzOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBnZW5lcmF0ZUlkKCksXG4gICAgICAgICAgICAgICAgICAgIC4uLnJlY2lwZSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uczogYWN0aW9uSXRlbXNUb1Jlc3BvbnNlKHJlY2lwZS5hY3Rpb25zKSxcbiAgICAgICAgICAgICAgICAgICAgcmVjdXJyZW5jZToge1xuICAgICAgICAgICAgICAgICAgICAgIGRheXNPZldlZWs6IHJlY2lwZT8ucmVjdXJyZW5jZT8uZGF5c09mV2VlayxcbiAgICAgICAgICAgICAgICAgICAgICBob3Vyc09mRGF5OiByZWNpcGU/LnJlY3VycmVuY2U/LmhvdXJzT2ZEYXlcbiAgICAgICAgICAgICAgICAgICAgICAgID8ubWFwKChob3VyOiBzdHJpbmcpID0+IE51bWJlcihob3VyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gYSAtIGIpLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQUNUSU9OUyBJTlRFUkNFUFRPUl0nLCByZXEsIHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBldmVudDtcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChyZXEudXJsLm1hdGNoKC9cXC9hY3Rpb24tcmVjaXBlcyQvKSAmJiByZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcSkucGlwZShcbiAgICAgICAgbWFwKChldmVudDogSHR0cEV2ZW50PGFueT4pID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5hY3Rpb25zR2V0RXJyb3JDb2RlKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0gbmV3IEh0dHBFcnJvclJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLmFjdGlvbnNHZXRFcnJvckNvZGUsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tBQ1RJT05TIElOVEVSQ0VQVE9SXScsIHJlcSwgZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvclJlc3BvbnNlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBldmVudDtcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBuZXh0LmhhbmRsZShyZXEpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBBY3Rpb25zTW9ja3NQcm92aWRlcjogUHJvdmlkZXIgPSB7XG4gIHByb3ZpZGU6IEhUVFBfSU5URVJDRVBUT1JTLFxuICB1c2VDbGFzczogQWN0aW9uc0ludGVyY2VwdG9yLFxuICBtdWx0aTogdHJ1ZSxcbn07XG4iXX0=