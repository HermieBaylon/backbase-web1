import { Component, Inject, TemplateRef, ViewChild } from '@angular/core';
import { DestinationsServiceConfigToken, } from '@backbase/cards-common-ang';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@backbase/foundation-ang/core";
import * as i2 from "@backbase/cards-common-ang";
import * as i3 from "@backbase/ui-ang/notification";
import * as i4 from "../cards-travel-notice-container/cards-travel-notice-container.component";
import * as i5 from "@backbase/ui-ang/loading-indicator";
import * as i6 from "@backbase/ui-ang/empty-state";
import * as i7 from "@angular/common";
const notificationTtl = 5000;
export class CardsTravelNoticeWidgetComponent {
    constructor(assetsService, cardsService, notificationService, destinationsService, cd) {
        this.assetsService = assetsService;
        this.cardsService = cardsService;
        this.notificationService = notificationService;
        this.destinationsService = destinationsService;
        this.cd = cd;
        this.isLoading = true;
        this.config = {
            widgetName: 'bb-cards-travel-notice-widget-ang',
            getURIFromAssetID: (assetId) => `${assetId}-img.svg`,
        };
        this.resolveAsset = this.assetsService.createAssetsResolver(this.config);
    }
    get imageEmptyStateUrl() {
        return this.resolveAsset('travel-notice-empty-state');
    }
    ngOnInit() {
        this.loadTravelNotice();
        this.destinationList =
            this.destinationsService &&
                this.destinationsService.getDestinations().pipe(catchError((error) => {
                    this.error = error;
                    return of([]);
                }));
    }
    submitTravelNotice(travelNoticeItem) {
        this.isLoading = true;
        const submitTravelNoticeSuccess = () => {
            if (this.travelNoticeList) {
                this.loadTravelNotice();
                this.pushNotification(this.notificationOnCreate, 'success');
            }
        };
        this.cardsService.postTravelNotice(travelNoticeItem).subscribe(submitTravelNoticeSuccess);
    }
    onRemoveItem(travelNoticeItem) {
        this.isLoading = true;
        const deleteTravelNoticeSuccess = () => {
            if (this.travelNoticeList) {
                this.loadTravelNotice();
                this.pushNotification(this.notificationOnDelete, 'success');
            }
        };
        this.cardsService.deleteTravelNotice(travelNoticeItem).subscribe(deleteTravelNoticeSuccess);
    }
    loadTravelNotice() {
        this.cardsService
            .getTravelNotice()
            .pipe(catchError((error) => {
            this.error = error;
            return of({});
        }))
            .subscribe((item) => {
            this.travelNoticeList = item.travelNoticeList;
            this.paymentCards = item.paymentCards;
            this.isLoading = false;
            this.cd.detectChanges();
        });
    }
    pushNotification(header = '', modifier) {
        this.notificationService.showNotification({
            header,
            message: '',
            modifier,
            dismissible: true,
            ttl: notificationTtl,
        });
    }
}
CardsTravelNoticeWidgetComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CardsTravelNoticeWidgetComponent, deps: [{ token: i1.AssetsService }, { token: i2.CardsService }, { token: i3.NotificationService }, { token: DestinationsServiceConfigToken }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
CardsTravelNoticeWidgetComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.15", type: CardsTravelNoticeWidgetComponent, selector: "bb-cards-travel-notice-widget", viewQueries: [{ propertyName: "notificationOnCreate", first: true, predicate: ["notificationOnCreate"], descendants: true, read: TemplateRef, static: true }, { propertyName: "notificationOnDelete", first: true, predicate: ["notificationOnDelete"], descendants: true, read: TemplateRef, static: true }], ngImport: i0, template: "<ng-container *ngIf=\"!error; else errorState\">\n  <ng-container *ngIf=\"!isLoading; else loadingState\">\n    <bb-cards-travel-notice-container\n      [imageUrl]=\"(imageEmptyStateUrl | async) || undefined\"\n      [travelNoticeList]=\"travelNoticeList\"\n      [destinationList]=\"(destinationList | async) || undefined\"\n      [paymentCards]=\"paymentCards\"\n      (createTravelNotice)=\"submitTravelNotice($event)\"\n      (remove)=\"onRemoveItem($event)\"\n    ></bb-cards-travel-notice-container>\n  </ng-container>\n</ng-container>\n<ng-template #loadingState>\n  <bb-loading-indicator-ui loaderSize=\"lg\"></bb-loading-indicator-ui>\n</ng-template>\n\n<ng-template #errorState>\n  <bb-empty-state-ui\n    title=\"\"\n    [subtitle]=\"error?.message\"\n    iconModifier=\"error\"\n    iconSize=\"xxl\"\n    iconClasses=\"text-muted\"\n  ></bb-empty-state-ui>\n</ng-template>\n\n<ng-template #notificationOnCreate>\n  <span \n    i18n=\"Message for a notification displayed when a travel notice is created@@cards.create.travel.notice.success.notification\"\n  >\n    Travel notice successfully created!\n  </span>\n</ng-template>\n\n<ng-template #notificationOnDelete>\n  <span \n    i18n=\"Message for a notification displayed when a travel notice is deleted@@cards.delete.travel.notice.success.notification\"\n  >\n    Travel notice successfully deleted!  \n  </span>\n</ng-template>", components: [{ type: i4.CardsTravelNoticeContainerComponent, selector: "bb-cards-travel-notice-container", inputs: ["imageUrl", "travelNoticeList", "destinationList", "paymentCards"], outputs: ["createTravelNotice", "remove"] }, { type: i5.LoadingIndicatorComponent, selector: "bb-loading-indicator-ui", inputs: ["text", "loaderSize", "showDelay", "hasBackground", "inline"] }, { type: i6.EmptyStateComponent, selector: "bb-empty-state-ui", inputs: ["title", "subtitle", "showIcon", "iconClasses", "iconModifier", "iconSize", "iconColor"] }], directives: [{ type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i7.AsyncPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.15", ngImport: i0, type: CardsTravelNoticeWidgetComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'bb-cards-travel-notice-widget',
                    templateUrl: 'cards-travel-notice-widget.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.AssetsService }, { type: i2.CardsService }, { type: i3.NotificationService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DestinationsServiceConfigToken]
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { notificationOnCreate: [{
                type: ViewChild,
                args: ['notificationOnCreate', { read: TemplateRef, static: true }]
            }], notificationOnDelete: [{
                type: ViewChild,
                args: ['notificationOnDelete', { read: TemplateRef, static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jYXJkcy10cmF2ZWwtbm90aWNlLXdpZGdldC1hbmcvc3JjL2NvbXBvbmVudHMvY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQvY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jYXJkcy10cmF2ZWwtbm90aWNlLXdpZGdldC1hbmcvc3JjL2NvbXBvbmVudHMvY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQvY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFxQixTQUFTLEVBQUUsTUFBTSxFQUFVLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckcsT0FBTyxFQUtMLDhCQUE4QixHQUsvQixNQUFNLDRCQUE0QixDQUFDO0FBR3BDLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7QUFFNUMsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDO0FBUTdCLE1BQU0sT0FBTyxnQ0FBZ0M7SUFpRzNDLFlBQ21CLGFBQTRCLEVBQzVCLFlBQTBCLEVBQzFCLG1CQUF3QyxFQUNBLG1CQUF5RCxFQUMvRixFQUFxQjtRQUp2QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ0Esd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFzQztRQUMvRixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQTVGMUMsY0FBUyxHQUFHLElBQUksQ0FBQztR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akIsR0FBRyxFQUFFLGVBQWU7U0FDckIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7OEhBL0ZVLGdDQUFnQyw4R0FxR2pDLDhCQUE4QjtrSEFyRzdCLGdDQUFnQyw4S0FFQSxXQUFXLHFJQUdYLFdBQVcsMkNDOUJ4RCxvM0NBd0NjOzRGRGZELGdDQUFnQztrQkFKNUMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsK0JBQStCO29CQUN6QyxXQUFXLEVBQUUsMkNBQTJDO2lCQUN6RDs7MEJBc0dJLE1BQU07MkJBQUMsOEJBQThCOzRFQWxHeEMsb0JBQW9CO3NCQURuQixTQUFTO3VCQUFDLHNCQUFzQixFQUFFLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUl0RSxvQkFBb0I7c0JBRG5CLFNBQVM7dUJBQUMsc0JBQXNCLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBJbmplY3QsIE9uSW5pdCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQ2FyZHNCYWNrZW5kRGVzdGluYXRpb25zLFxuICBDYXJkc0JhY2tlbmRFcnJvcixcbiAgQ2FyZHNTZXJ2aWNlLFxuICBEZXN0aW5hdGlvbixcbiAgRGVzdGluYXRpb25zU2VydmljZUNvbmZpZ1Rva2VuLFxuICBGdWxsVHJhdmVsTm90aWNlTW9kZWwsXG4gIFBheW1lbnRDYXJkLFxuICBUcmF2ZWxOb3RpY2UsXG4gIFRyYXZlbE5vdGljZUxpc3QsXG59IGZyb20gJ0BiYWNrYmFzZS9jYXJkcy1jb21tb24tYW5nJztcbmltcG9ydCB7IEFzc2V0c1Jlc29sdmVyLCBBc3NldHNSZXNvbHZlckNvbmZpZywgQXNzZXRzU2VydmljZSB9IGZyb20gJ0BiYWNrYmFzZS9mb3VuZGF0aW9uLWFuZy9jb3JlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICdAYmFja2Jhc2UvdWktYW5nL25vdGlmaWNhdGlvbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuY29uc3Qgbm90aWZpY2F0aW9uVHRsID0gNTAwMDtcbnR5cGUgTm90aWZpY2F0aW9uTWVzc2FnZSA9IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT47XG50eXBlIE5vdGlmaWNhdGlvbk1vZGlmaWVyID0gJ3N1Y2Nlc3MnIHwgJ2luZm8nIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJyB8IHVuZGVmaW5lZDtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYmItY2FyZHMtdHJhdmVsLW5vdGljZS13aWRnZXQnLFxuICB0ZW1wbGF0ZVVybDogJ2NhcmRzLXRyYXZlbC1ub3RpY2Utd2lkZ2V0LmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgQ2FyZHNUcmF2ZWxOb3RpY2VXaWRnZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQFZpZXdDaGlsZCgnbm90aWZpY2F0aW9uT25DcmVhdGUnLCB7IHJlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgbm90aWZpY2F0aW9uT25DcmVhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCB1bmRlZmluZWQ7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBAVmlld0NoaWxkKCdub3RpZmljYXRpb25PbkRlbGV0ZScsIHsgcmVhZDogVGVtcGxhdGVSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuICBub3RpZmljYXRpb25PbkRlbGV0ZTogVGVtcGxhdGVSZWY8YW55PiB8IHVuZGVmaW5lZDtcblxuICB0cmF2ZWxOb3RpY2VMaXN0OiBUcmF2ZWxOb3RpY2VMaXN0IHwgdW5kZWZpbmVkO1xuICBwYXltZW50Q2FyZHM6IFBheW1lbnRDYXJkW10gfCB1bmRlZmluZWQ7XG4gIGlzTG9hZGluZyA9IHRydWU7XG4gIC8qKlxuICAgKiBFcnJvciBtZXNzYWdlIGluIGNhc2Ugc29tZXRoaW5nIHVuZXhwZWN0ZWQgb2NjdXJzLlxuICAgKi9cbiAgZXJyb3I6IENhcmRzQmFja2VuZEVycm9yIHwgdW5kZWZpbmVkO1xuXG4gIGRlc3RpbmF0aW9uTGlzdDogT2JzZXJ2YWJsZTxEZXN0aW5hdGlvbltdPiB8IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogQXNzZXRzUmVzb2x2ZXJDb25maWcgPSB7XG4gICAgd2lkZ2V0TmFtZTogJ2JiLWNhcmRzLXRyYXZlbC1ub3RpY2Utd2lkZ2V0LWFuZycsXG4gICAgZ2V0VVJJRnJvbUFzc2V0SUQ6IChhc3NldElkOiBzdHJpbmcpID0+IGAke2Fzc2V0SWR9LWltZy5zdmdgLFxuICB9O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVzb2x2ZUFzc2V0OiBBc3NldHNSZXNvbHZlciA9IHRoaXMuYXNzZXRzU2VydmljZS5jcmVhdGVBc3NldHNSZXNvbHZlcih0aGlzLmNvbmZpZyk7XG5cbiAgZ2V0IGltYWdlRW1wdHlTdGF0ZVVybCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXNvbHZlQXNzZXQoJ3RyYXZlbC1ub3RpY2UtZW1wdHktc3RhdGUnKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMubG9hZFRyYXZlbE5vdGljZSgpO1xuXG4gICAgdGhpcy5kZXN0aW5hdGlvbkxpc3QgPVxuICAgICAgdGhpcy5kZXN0aW5hdGlvbnNTZXJ2aWNlICYmXG4gICAgICB0aGlzLmRlc3RpbmF0aW9uc1NlcnZpY2UuZ2V0RGVzdGluYXRpb25zKCkucGlwZShcbiAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IENhcmRzQmFja2VuZEVycm9yKSA9PiB7XG4gICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuXG4gICAgICAgICAgcmV0dXJuIG9mKFtdKTtcbiAgICAgICAgfSksXG4gICAgICApO1xuICB9XG5cbiAgc3VibWl0VHJhdmVsTm90aWNlKHRyYXZlbE5vdGljZUl0ZW06IFRyYXZlbE5vdGljZSkge1xuICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgIGNvbnN0IHN1Ym1pdFRyYXZlbE5vdGljZVN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy50cmF2ZWxOb3RpY2VMaXN0KSB7XG4gICAgICAgIHRoaXMubG9hZFRyYXZlbE5vdGljZSgpO1xuICAgICAgICB0aGlzLnB1c2hOb3RpZmljYXRpb24odGhpcy5ub3RpZmljYXRpb25PbkNyZWF0ZSwgJ3N1Y2Nlc3MnKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5jYXJkc1NlcnZpY2UucG9zdFRyYXZlbE5vdGljZSh0cmF2ZWxOb3RpY2VJdGVtKS5zdWJzY3JpYmUoc3VibWl0VHJhdmVsTm90aWNlU3VjY2Vzcyk7XG4gIH1cblxuICBvblJlbW92ZUl0ZW0odHJhdmVsTm90aWNlSXRlbTogVHJhdmVsTm90aWNlKSB7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgY29uc3QgZGVsZXRlVHJhdmVsTm90aWNlU3VjY2VzcyA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnRyYXZlbE5vdGljZUxpc3QpIHtcbiAgICAgICAgdGhpcy5sb2FkVHJhdmVsTm90aWNlKCk7XG4gICAgICAgIHRoaXMucHVzaE5vdGlmaWNhdGlvbih0aGlzLm5vdGlmaWNhdGlvbk9uRGVsZXRlLCAnc3VjY2VzcycpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmNhcmRzU2VydmljZS5kZWxldGVUcmF2ZWxOb3RpY2UodHJhdmVsTm90aWNlSXRlbSkuc3Vic2NyaWJlKGRlbGV0ZVRyYXZlbE5vdGljZVN1Y2Nlc3MpO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkVHJhdmVsTm90aWNlKCkge1xuICAgIHRoaXMuY2FyZHNTZXJ2aWNlXG4gICAgICAuZ2V0VHJhdmVsTm90aWNlKClcbiAgICAgIC5waXBlKFxuICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogQ2FyZHNCYWNrZW5kRXJyb3IpID0+IHtcbiAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG5cbiAgICAgICAgICByZXR1cm4gb2Yoe30pO1xuICAgICAgICB9KSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKGl0ZW06IEZ1bGxUcmF2ZWxOb3RpY2VNb2RlbCkgPT4ge1xuICAgICAgICB0aGlzLnRyYXZlbE5vdGljZUxpc3QgPSBpdGVtLnRyYXZlbE5vdGljZUxpc3Q7XG4gICAgICAgIHRoaXMucGF5bWVudENhcmRzID0gaXRlbS5wYXltZW50Q2FyZHM7XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHB1c2hOb3RpZmljYXRpb24oaGVhZGVyOiBOb3RpZmljYXRpb25NZXNzYWdlID0gJycsIG1vZGlmaWVyOiBOb3RpZmljYXRpb25Nb2RpZmllcikge1xuICAgIHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zaG93Tm90aWZpY2F0aW9uKHtcbiAgICAgIGhlYWRlcixcbiAgICAgIG1lc3NhZ2U6ICcnLFxuICAgICAgbW9kaWZpZXIsXG4gICAgICBkaXNtaXNzaWJsZTogdHJ1ZSxcbiAgICAgIHR0bDogbm90aWZpY2F0aW9uVHRsLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBhc3NldHNTZXJ2aWNlOiBBc3NldHNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2FyZHNTZXJ2aWNlOiBDYXJkc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLFxuICAgIEBJbmplY3QoRGVzdGluYXRpb25zU2VydmljZUNvbmZpZ1Rva2VuKSBwcml2YXRlIHJlYWRvbmx5IGRlc3RpbmF0aW9uc1NlcnZpY2U6IENhcmRzQmFja2VuZERlc3RpbmF0aW9ucyB8IHVuZGVmaW5lZCxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICApIHt9XG59XG4iLCI8bmctY29udGFpbmVyICpuZ0lmPVwiIWVycm9yOyBlbHNlIGVycm9yU3RhdGVcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFpc0xvYWRpbmc7IGVsc2UgbG9hZGluZ1N0YXRlXCI+XG4gICAgPGJiLWNhcmRzLXRyYXZlbC1ub3RpY2UtY29udGFpbmVyXG4gICAgICBbaW1hZ2VVcmxdPVwiKGltYWdlRW1wdHlTdGF0ZVVybCB8IGFzeW5jKSB8fCB1bmRlZmluZWRcIlxuICAgICAgW3RyYXZlbE5vdGljZUxpc3RdPVwidHJhdmVsTm90aWNlTGlzdFwiXG4gICAgICBbZGVzdGluYXRpb25MaXN0XT1cIihkZXN0aW5hdGlvbkxpc3QgfCBhc3luYykgfHwgdW5kZWZpbmVkXCJcbiAgICAgIFtwYXltZW50Q2FyZHNdPVwicGF5bWVudENhcmRzXCJcbiAgICAgIChjcmVhdGVUcmF2ZWxOb3RpY2UpPVwic3VibWl0VHJhdmVsTm90aWNlKCRldmVudClcIlxuICAgICAgKHJlbW92ZSk9XCJvblJlbW92ZUl0ZW0oJGV2ZW50KVwiXG4gICAgPjwvYmItY2FyZHMtdHJhdmVsLW5vdGljZS1jb250YWluZXI+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG48bmctdGVtcGxhdGUgI2xvYWRpbmdTdGF0ZT5cbiAgPGJiLWxvYWRpbmctaW5kaWNhdG9yLXVpIGxvYWRlclNpemU9XCJsZ1wiPjwvYmItbG9hZGluZy1pbmRpY2F0b3ItdWk+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI2Vycm9yU3RhdGU+XG4gIDxiYi1lbXB0eS1zdGF0ZS11aVxuICAgIHRpdGxlPVwiXCJcbiAgICBbc3VidGl0bGVdPVwiZXJyb3I/Lm1lc3NhZ2VcIlxuICAgIGljb25Nb2RpZmllcj1cImVycm9yXCJcbiAgICBpY29uU2l6ZT1cInh4bFwiXG4gICAgaWNvbkNsYXNzZXM9XCJ0ZXh0LW11dGVkXCJcbiAgPjwvYmItZW1wdHktc3RhdGUtdWk+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI25vdGlmaWNhdGlvbk9uQ3JlYXRlPlxuICA8c3BhbiBcbiAgICBpMThuPVwiTWVzc2FnZSBmb3IgYSBub3RpZmljYXRpb24gZGlzcGxheWVkIHdoZW4gYSB0cmF2ZWwgbm90aWNlIGlzIGNyZWF0ZWRAQGNhcmRzLmNyZWF0ZS50cmF2ZWwubm90aWNlLnN1Y2Nlc3Mubm90aWZpY2F0aW9uXCJcbiAgPlxuICAgIFRyYXZlbCBub3RpY2Ugc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQhXG4gIDwvc3Bhbj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbm90aWZpY2F0aW9uT25EZWxldGU+XG4gIDxzcGFuIFxuICAgIGkxOG49XCJNZXNzYWdlIGZvciBhIG5vdGlmaWNhdGlvbiBkaXNwbGF5ZWQgd2hlbiBhIHRyYXZlbCBub3RpY2UgaXMgZGVsZXRlZEBAY2FyZHMuZGVsZXRlLnRyYXZlbC5ub3RpY2Uuc3VjY2Vzcy5ub3RpZmljYXRpb25cIlxuICA+XG4gICAgVHJhdmVsIG5vdGljZSBzdWNjZXNzZnVsbHkgZGVsZXRlZCEgIFxuICA8L3NwYW4+XG48L25nLXRlbXBsYXRlPiJdfQ==