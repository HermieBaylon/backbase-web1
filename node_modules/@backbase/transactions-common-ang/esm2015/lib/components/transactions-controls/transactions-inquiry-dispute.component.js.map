{"version":3,"file":"transactions-inquiry-dispute.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/widgets/transactions/transactions-common-ang/src/lib/components/transactions-controls/transactions-inquiry-dispute.component.ts","../../../../../../../../../libs/widgets/transactions/transactions-common-ang/src/lib/components/transactions-controls/transactions-inquiry-dispute.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport { AbstractControl, FormBuilder } from '@angular/forms';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { InquireAndDisputeFile, InquireAndDisputeTopics, MessageForm } from '../../model/messages.model';\nimport { TransactionsDetailsLoadingState } from '../../model/transactions-details.model';\n\n@Component({\n  selector: 'bb-transactions-inquiry-dispute',\n  templateUrl: 'transactions-inquiry-dispute.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TransactionsInquiryDisputeComponent implements OnInit, OnDestroy {\n  @Input() message: MessageForm | undefined;\n  @Input() enableDispute = false;\n  /**\n   * Whether the dispute & inquiry form is sending or not.\n   */\n  @Input() state = TransactionsDetailsLoadingState.notStarted;\n  @Input() inquireAndDisputeTopics: InquireAndDisputeTopics | undefined;\n\n  @Output() submitReport = new EventEmitter<MessageForm>();\n\n  @Output() cancelReport = new EventEmitter<void>();\n\n  @Output() messageChange = new EventEmitter<MessageForm>();\n\n  @Output() fileChange = new EventEmitter<File>();\n  @Output() fileRemoved = new EventEmitter<InquireAndDisputeFile>();\n\n  confirmationDialogActive = false;\n  labels = {\n    inquire: $localize`:Inquire tooltip@@transactions.dispute.inquire.inquireLabel:Inquire for more information`,\n    dispute: $localize`:Dispute tooltip@@transactions.dispute.inquire.disputeLabel:Dispute this transaction`,\n  };\n\n  readonly loadingStateEnum = TransactionsDetailsLoadingState;\n\n  private unsubscribeSubject = new Subject<void>();\n\n  transactionReportForm = this.fb.group({\n    topic: [{ value: '' }, this.topicRequired],\n    attachment: [undefined],\n    subject: [{ name: '' }],\n    body: [''],\n  });\n\n  private topicRequired(control: AbstractControl): Record<'required', string> | null {\n    return control.value?.value === '' ? { required: 'value is required' } : null;\n  }\n\n  private getControl(field: string): AbstractControl | undefined {\n    return this.transactionReportForm.controls[field];\n  }\n\n  private setFormValue(values: MessageForm) {\n    this.transactionReportForm.patchValue(\n      {\n        body: values.body,\n        attachments: values.attachments,\n      },\n      { emitEvent: false },\n    );\n  }\n\n  hasError(field: string, type: string) {\n    const control = this.getControl(field);\n\n    return control && control.errors && control.errors[type];\n  }\n\n  isInvalidControl(field: string): boolean {\n    const control = this.getControl(field);\n\n    return !!control && control.touched && control.invalid;\n  }\n\n  saveReport() {\n    if (this.transactionReportForm.valid) {\n      this.submitReport.emit(this.message);\n    } else {\n      this.transactionReportForm.markAllAsTouched();\n    }\n  }\n\n  closeReportForm() {\n    this.cancelReport.emit();\n    this.closeConfirmationDialog();\n  }\n\n  closeConfirmationDialog() {\n    this.confirmationDialogActive = false;\n  }\n\n  processLabel(label: string) {\n    const arr = label.split(' ');\n    const last = arr.splice(arr.length - 1, 1);\n\n    return [arr.join(' ') + ' ', ...last];\n  }\n\n  ngOnInit() {\n    if (this.message) {\n      this.setFormValue(this.message);\n    }\n\n    this.transactionReportForm.valueChanges.pipe(takeUntil(this.unsubscribeSubject)).subscribe({\n      next: (formValue) => {\n        this.messageChange.emit({ ...this.message, ...formValue });\n      },\n    });\n  }\n\n  uploadFile(input: HTMLInputElement) {\n    if (input.files && input.files[0]) {\n      const file: File = input.files[0];\n      this.fileChange.emit(file);\n      input.value = '';\n    }\n  }\n\n  removeAttachment(attachment: InquireAndDisputeFile) {\n    this.fileRemoved.emit(attachment);\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeSubject.next();\n    this.unsubscribeSubject.complete();\n  }\n\n  constructor(private readonly fb: FormBuilder) {}\n}\n","<div class=\"bb-transaction-list-item-detail-additional-info\">\n  <form [formGroup]=\"transactionReportForm\">\n    <div class=\"bb-block bb-block--lg\" bbAccessibilityKeyboard>\n      <h5\n        class=\"bb-transaction-list-item-detail-additional-info__title\"\n        data-role=\"dispute-inquiry-header\"\n        i18n=\"dispute and inquiry form header@@transactions.dispute.inquiry.header\"\n      >\n        Does this transaction seem suspicious or incorrect?\n      </h5>\n      <p\n        class=\"bb-text-support text-small\"\n        data-role=\"dispute-inquiry-subHeader\"\n        i18n=\"dispute and inquiry form subHeader@@transactions.dispute.inquiry.subHeader\"\n      >\n        It’s important to provide as much detail as possible for the bank employee to quickly and accurately review your\n        issue.\n      </p>\n    </div>\n\n    <div class=\"form-group bb-block bb-block--lg\">\n      <bb-input-radio-group-ui\n        aria-labelledby=\"'label-transaction-dispute'\"\n        [horizontal]=\"false\"\n        formControlName=\"topic\"\n        verticalAlign=\"top\"\n      >\n        <bb-input-radio-ui\n          value=\"dispute\"\n          [labelTemplate]=\"optionsLabel\"\n          labelTemplateContext=\"dispute\"\n          [disabled]=\"!enableDispute\"\n        ></bb-input-radio-ui>\n        <bb-input-radio-ui\n          value=\"inquire\"\n          [labelTemplate]=\"optionsLabel\"\n          labelTemplateContext=\"inquire\"\n        ></bb-input-radio-ui>\n      </bb-input-radio-group-ui>\n      <bb-input-validation-message-ui [showErrors]=\"isInvalidControl('topic')\">\n        <span\n          *ngIf=\"hasError('topic', 'required')\"\n          i18n=\"Error message if field is required@@transactions.dispute.errors.operationRequired\"\n        >\n          Required field\n        </span>\n      </bb-input-validation-message-ui>\n    </div>\n\n    <div class=\"form-group bb-block\" [ngClass]=\"{ 'bb-block--sm': isInvalidControl('body') }\">\n      <bb-rich-text-editor-ui\n        aria-label=\"Report body\"\n        formControlName=\"body\"\n        placeholder=\"Please tell us more about this transaction...\"\n        i18n-aria-label=\"label report body body@@transactions.dispute.inquiry.body.label\"\n        i18n-placeholder=\"Place holder for messages body@@transactions.dispute.inquiry.body.message\"\n        [readonly]=\"false\"\n        [required]=\"true\"\n      ></bb-rich-text-editor-ui>\n\n      <bb-input-validation-message-ui [showErrors]=\"isInvalidControl('body')\">\n        <span\n          *ngIf=\"hasError('body', 'required')\"\n          i18n=\"Error message if field is required@@transactions.dispute.errors.bodyRequired\"\n        >\n          Required field\n        </span>\n      </bb-input-validation-message-ui>\n    </div>\n\n    <div class=\"form-group bb-block bb-block--sm\">\n      <bb-input-file-ui\n        label=\"Default file input\"\n        data-role=\"attachment-file-input\"\n        [disabled]=\"state === loadingStateEnum.loading\"\n        (change)=\"uploadFile($any($event.target))\"\n      ></bb-input-file-ui>\n    </div>\n\n    <div class=\"row bb-inquire-dispute-attachments\" *ngIf=\"message?.attachments?.length\">\n      <div *ngFor=\"let attachment of message?.attachments\" class=\"col-md-6 bb-inquire-dispute-attachments__item\">\n        <div class=\"bb-block bb-block--md\">\n          <bb-file-attachment-ui\n            data-role=\"attachment-file\"\n            [name]=\"attachment.name\"\n            [size]=\"attachment.size\"\n            [fileContent]=\"attachment.content\"\n            [block]=\"true\"\n            [loading]=\"attachment.id === undefined\"\n            [deletable]=\"attachment.id !== undefined\"\n            (delete)=\"removeAttachment(attachment)\"\n          ></bb-file-attachment-ui>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"bb-block bb-block--xl bb-text-align-left\">\n      <ng-container *ngIf=\"state === loadingStateEnum.error\">\n        <bb-alert-ui\n          title=\"Couldn’t send your message\"\n          data-role=\"send-report-failed\"\n          message=\"Something went wrong. Please try again.\"\n          i18n-title=\"\n            Send report failed notification|Message for a notification displayed when sending transaction report request\n            has failed@@transactions.notification.error.send.title\"\n          i18n-message=\"Send report failed notification message@@transactions.notification.error.send.message\"\n        ></bb-alert-ui>\n      </ng-container>\n    </div>\n\n    <div class=\"bb-button-bar\">\n      <bb-load-button-ui\n        bbButton\n        color=\"primary\"\n        class=\"bb-button-bar__button\"\n        data-role=\"dispute-inquiry-send-button\"\n        [isLoading]=\"state === loadingStateEnum.loading\"\n        (click)=\"state !== loadingStateEnum.loading && saveReport()\"\n        i18n=\"Send button@@transactions.dispute.inquiry.button.send\"\n      >\n        Send\n      </bb-load-button-ui>\n      <button\n        *ngIf=\"state !== loadingStateEnum.loading\"\n        bbButton\n        type=\"button\"\n        color=\"secondary\"\n        data-role=\"dispute-inquiry-cancel-button\"\n        class=\"bb-button-bar__button\"\n        (click)=\"confirmationDialogActive = true\"\n        i18n=\"Cancel button@@transactions.dispute.inquiry.button.cancel\"\n      >\n        Cancel\n      </button>\n    </div>\n  </form>\n</div>\n\n<ng-template #disputeTipContent>\n  <div class=\"bb-text-align-left\">\n    <span i18n=\"Description inside a tooltip@@transactions.dispute.inquiry.tooltip.description\">\n      If this transaction is incorrect, you can raise a claim for a refund.\n    </span>\n  </div>\n</ng-template>\n\n<ng-template #inqueryTipContent>\n  <div class=\"bb-text-align-left\">\n    <span i18n=\"Description inside inquery tooltip@@transactions.dispute.inquiry.tooltip.description\">\n      If you are suspicious about this transaction, you can ask the bank to gather more information about it.\n    </span>\n  </div>\n</ng-template>\n\n<ng-template #optionsLabel let-context=\"labelTemplateContext\">\n  <ng-container *ngIf=\"context === 'dispute'\">\n    <span class=\"bb-input-radio-group__radio-label\">\n      {{ processLabel(labels.dispute)[0] }}\n    </span>\n    <span class=\"d-inline-block\">\n      <span class=\"bb-input-radio-group__radio-label\">\n        {{ processLabel(labels.dispute)[1] }}\n      </span>\n      <bb-icon-ui\n        class=\"bb-transactions-list-pending-header__tooltip bb-transactions-list-pending-header__tooltip--md-top\"\n        role=\"tooltip\"\n        name=\"info\"\n        size=\"md\"\n        [bbTooltip]=\"disputeTipContent\"\n        triggers=\"hover click\"\n        placement=\"right\"\n        bbAccessibilityKeyboard\n      ></bb-icon-ui>\n      <bb-icon-ui\n        class=\"bb-transactions-list-pending-header__tooltip bb-transactions-list-pending-header__tooltip--sm-bottom\"\n        role=\"tooltip\"\n        name=\"info\"\n        size=\"md\"\n        [bbTooltip]=\"disputeTipContent\"\n        triggers=\"hover click\"\n        placement=\"left\"\n        bbAccessibilityKeyboard\n      ></bb-icon-ui>\n      <span\n        class=\"sr-only\"\n        i18n=\"Description inside a tooltip@@transactions.dispute.inquiry.tooltip.hidden.description\"\n      >\n        If this transaction is incorrect, you can raise a claim for a refund.\n      </span>\n    </span>\n  </ng-container>\n\n  <ng-container *ngIf=\"context === 'inquire'\">\n    <span class=\"bb-input-radio-group__radio-label\">\n      {{ processLabel(labels.inquire)[0] }}\n    </span>\n    <span class=\"d-inline-block\">\n      <span class=\"bb-input-radio-group__radio-label\">\n        {{ processLabel(labels.inquire)[1] }}\n      </span>\n      <bb-icon-ui\n        class=\"bb-transactions-list-pending-header__tooltip bb-transactions-list-pending-header__tooltip--md-top\"\n        role=\"tooltip\"\n        name=\"info\"\n        size=\"md\"\n        [bbTooltip]=\"inqueryTipContent\"\n        triggers=\"hover click\"\n        placement=\"right\"\n        bbAccessibilityKeyboard\n      ></bb-icon-ui>\n      <bb-icon-ui\n        class=\"bb-transactions-list-pending-header__tooltip bb-transactions-list-pending-header__tooltip--sm-bottom\"\n        role=\"tooltip\"\n        name=\"info\"\n        size=\"md\"\n        [bbTooltip]=\"inqueryTipContent\"\n        triggers=\"hover click\"\n        placement=\"top\"\n        bbAccessibilityKeyboard\n      ></bb-icon-ui>\n      <span\n        class=\"sr-only\"\n        i18n=\"Description inside inquery tooltip@@transactions.dispute.inquiry.tooltip.hidden.description\"\n      >\n        If you are suspicious about this transaction, you can ask the bank to gather more information about it.\n      </span>\n    </span>\n  </ng-container>\n</ng-template>\n\n<!-- Cancel Dispute or Inquiry -->\n<bb-modal-ui [isOpen]=\"confirmationDialogActive\" (cancel)=\"closeConfirmationDialog()\">\n  <div class=\"modal-header\">\n    <h2\n      id=\"modal-basic-title\"\n      class=\"modal-title\"\n      data-role=\"discard-report-modal-header\"\n      i18n=\"Discard your report?|Discard report modal title@@transactions.dispute.inquiry.discard.report.modal.title\"\n    >\n      Discard your report?\n    </h2>\n  </div>\n\n  <div class=\"modal-body\">\n    <span\n      data-role=\"discard-report-modal-subHeader\"\n      i18n=\"All entered data will be lost.|Discard report info@@transactions.dispute.inquiry.discard.report.modal.info\"\n    >\n      All entered data will be lost.\n    </span>\n  </div>\n\n  <div class=\"modal-footer\">\n    <div class=\"bb-button-bar\">\n      <button\n        bbButton\n        color=\"danger\"\n        class=\"bb-button-bar__button\"\n        data-role=\"discard-report-modal-discard-button\"\n        (click)=\"closeReportForm()\"\n        i18n=\"Discard|Discard report button label@@transactions.dispute.inquiry.discard.report.modal.discard.button\"\n      >\n        Discard\n      </button>\n\n      <button\n        bbButton\n        color=\"secondary\"\n        class=\"bb-button-bar__button\"\n        data-role=\"discard-report-modal-cancel-button\"\n        (click)=\"closeConfirmationDialog()\"\n        i18n=\"Cancel|Cancel button label@@transactions.dispute.inquiry.discard.report.modal.cancel.button\"\n      >\n        Cancel\n      </button>\n    </div>\n  </div>\n</bb-modal-ui>\n"]}