{"version":3,"file":"document-viewer-container.component.js","sourceRoot":"","sources":["../../../../../../../../../../libs/widgets/transactions/transactions-common-ang/src/lib/components/document-viewer-ui/document-viewer-container/document-viewer-container.component.ts","../../../../../../../../../../libs/widgets/transactions/transactions-common-ang/src/lib/components/document-viewer-ui/document-viewer-container/document-viewer-container.component.html"],"names":[],"mappings":"AAAA,OAAO,EACL,uBAAuB,EACvB,SAAS,EACT,YAAY,EACZ,KAAK,EAEL,MAAM,EACN,UAAU,EACV,YAAY,EACZ,gBAAgB,EAChB,SAAS,GAEV,MAAM,eAAe,CAAC;AACvB,OAAO,EAGL,kBAAkB,EAClB,sBAAsB,GAGvB,MAAM,2CAA2C,CAAC;AACnD,OAAO,EAAc,aAAa,EAAE,aAAa,EAAE,KAAK,EAAE,eAAe,EAAE,OAAO,EAAE,MAAM,MAAM,CAAC;AACjG,OAAO,EAAE,UAAU,EAAE,oBAAoB,EAAE,QAAQ,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,EAAE,MAAM,gBAAgB,CAAC;;;;;;;;AAOxG,MAAM,OAAO,gCAAgC;IAwB3C,YAA6B,OAAmB;QAAnB,YAAO,GAAP,OAAO,CAAY;QAvBvC,oBAAe,GAAqB,EAAE,CAAC;QAKhD,2BAA2B;QACjB,UAAK,GAAG,IAAI,YAAY,EAAQ,CAAC;QAQlC,eAAU,GAAG,IAAI,eAAe,CAAC,KAAK,CAAC,CAAC;QACxC,iBAAY,GAAG,IAAI,eAAe,CAAC,KAAK,CAAC,CAAC;QAC1C,iBAAY,GAAG,kBAAkB,CAAC;QAC3C;;WAEG;QACc,0BAAqB,GAAG,IAAI,aAAa,CAAS,CAAC,CAAC,CAAC;QACrD,aAAQ,GAAG,IAAI,OAAO,EAAQ,CAAC;IAEG,CAAC;IAtBpD,IAAa,oBAAoB,CAAC,GAAW;QAC3C,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvC,CAAC;IAsBD,IAAI,eAAe;;QACjB,OAAO,CAAA,MAAA,MAAA,IAAI,CAAC,OAAO,0CAAE,SAAS,0CAAE,MAAM,KAAI,IAAI,CAAC;IACjD,CAAC;IAED,IAAI,WAAW;;QACb,OAAO,MAAA,IAAI,CAAC,OAAO,0CAAE,KAAK,CAAC;IAC7B,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,2BAA2B,EAAE,CAAC;QACnC,IAAI,CAAC,QAAQ,EAAE,CAAC;IAClB,CAAC;IAED,WAAW;QACT,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;IAC3B,CAAC;IAEwC,QAAQ;QAC/C,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;IACpB,CAAC;IAED,WAAW;QACT,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;IACpB,CAAC;IAED,UAAU,CAAC,GAAW;QACpB,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvC,CAAC;IAEO,2BAA2B;QACjC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CACjD,oBAAoB,EAAE,EACtB,GAAG,CAAC,GAAG,EAAE;YACP,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAChC,CAAC,CAAC,EACF,SAAS,CAAC,CAAC,GAAG,EAAE,EAAE,CAChB,aAAa,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,IAAI,CAChF,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,EACnB,QAAQ,CAAC,GAAG,EAAE;YACZ,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9B,CAAC,CAAC,CACH,CACF,EACD,UAAU,CAAC,CAAC,KAAK,EAAE,EAAE;YACnB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAE7B,MAAM,KAAK,CAAC;QACd,CAAC,CAAC,EACF,KAAK,EAAE,CACR,CAAC;QACF,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3G,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3G,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CACrD,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,CAAC,CACrE,CAAC;IACJ,CAAC;IAEO,QAAQ;QACd,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;IACrC,CAAC;;8HAvFU,gCAAgC;kHAAhC,gCAAgC,kXASS,gBAAgB,2CCtCtE,gmEA2DA;4FD9Ba,gCAAgC;kBAL5C,SAAS;mBAAC;oBACT,QAAQ,EAAE,8BAA8B;oBACxC,WAAW,EAAE,4CAA4C;oBACzD,eAAe,EAAE,uBAAuB,CAAC,MAAM;iBAChD;iGAEU,eAAe;sBAAvB,KAAK;gBACO,oBAAoB;sBAAhC,KAAK;gBAGG,OAAO;sBAAf,KAAK;gBAEI,KAAK;sBAAd,MAAM;gBAGE,aAAa;sBADrB,SAAS;uBAAC,iBAAiB,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,gBAAgB,EAAE;gBAmC7B,QAAQ;sBAAhD,YAAY;uBAAC,yBAAyB","sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ElementRef,\n  HostListener,\n  ViewContainerRef,\n  ViewChild,\n  OnDestroy,\n} from '@angular/core';\nimport {\n  DocumentRefSrc,\n  DocumentViewerOptions,\n  DocumentViewerType,\n  DOCUMENT_LOAD_DELAY_MS,\n  NavigationState,\n  Styles,\n} from '../../../model/UI/document-viewer-commons';\nimport { Observable, ReplaySubject, combineLatest, timer, BehaviorSubject, Subject } from 'rxjs';\nimport { catchError, distinctUntilChanged, finalize, map, share, switchMap, tap } from 'rxjs/operators';\n\n@Component({\n  selector: 'bb-document-viewer-container',\n  templateUrl: './document-viewer-container.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class DocumentViewerContainerComponent implements OnInit, OnDestroy {\n  @Input() documentRefSrcs: DocumentRefSrc[] = [];\n  @Input() set activeDocumentRefIdx(idx: number) {\n    this.activeDocumentRefIdx$.next(idx);\n  }\n  @Input() options?: DocumentViewerOptions;\n  // eslint-disable-next-line\n  @Output() close = new EventEmitter<void>();\n  // eslint-disable-next-line\n  @ViewChild('viewerContainer', { static: true, read: ViewContainerRef })\n  readonly viewContainer!: ViewContainerRef;\n  documentSrc$!: Observable<string>;\n  documentFilename$!: Observable<string>;\n  documentFiletype$!: Observable<DocumentViewerType>;\n  navigationState$!: Observable<NavigationState>;\n  readonly isLoading$ = new BehaviorSubject(false);\n  readonly isHttpError$ = new BehaviorSubject(false);\n  readonly documentType = DocumentViewerType;\n  /**\n   * Internal\n   */\n  private readonly activeDocumentRefIdx$ = new ReplaySubject<number>(1);\n  private readonly destroy$ = new Subject<void>();\n\n  constructor(private readonly elemRef: ElementRef) {}\n\n  get containerStyles(): { [klass: string]: any } | null {\n    return this.options?.container?.styles || null;\n  }\n\n  get viewerScale(): number | undefined {\n    return this.options?.scale;\n  }\n\n  ngOnInit() {\n    this.setDocumentRefChangeSources();\n    this.setFocus();\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  @HostListener('document:keydown.escape') onEscape() {\n    this.close.emit();\n  }\n\n  closeDialog() {\n    this.close.emit();\n  }\n\n  onNavigate(idx: number): void {\n    this.activeDocumentRefIdx$.next(idx);\n  }\n\n  private setDocumentRefChangeSources(): void {\n    this.documentSrc$ = this.activeDocumentRefIdx$.pipe(\n      distinctUntilChanged(),\n      tap(() => {\n        this.isLoading$.next(true);\n        this.isHttpError$.next(false);\n      }),\n      switchMap((idx) =>\n        combineLatest([this.documentRefSrcs[idx].src, timer(DOCUMENT_LOAD_DELAY_MS)]).pipe(\n          map(([src]) => src),\n          finalize(() => {\n            this.isLoading$.next(false);\n          }),\n        ),\n      ),\n      catchError((error) => {\n        this.isHttpError$.next(true);\n\n        throw error;\n      }),\n      share(),\n    );\n    this.documentFilename$ = this.activeDocumentRefIdx$.pipe(map((idx) => this.documentRefSrcs[idx].filename));\n    this.documentFiletype$ = this.activeDocumentRefIdx$.pipe(map((idx) => this.documentRefSrcs[idx].filetype));\n    this.navigationState$ = this.activeDocumentRefIdx$.pipe(\n      map((idx) => ({ currIdx: idx, total: this.documentRefSrcs.length })),\n    );\n  }\n\n  private setFocus(): void {\n    this.elemRef.nativeElement.focus();\n  }\n}\n","<div\n  class=\"bb-document-viewer-container show\"\n  role=\"dialog\"\n  aria-modal=\"true\"\n  tabindex=\"-1\"\n  [ngStyle]=\"containerStyles\"\n  cdkTrapFocus\n  cdkTrapFocusAutoCapture=\"true\"\n>\n  <div class=\"bb-document-viewer-container__wrapper\">\n    <bb-document-viewer-header\n      data-role=\"document-viewer-header\"\n      [filename]=\"(documentFilename$ | async)!\"\n      [source]=\"(documentSrc$ | async)!\"\n      [filetype]=\"(documentFiletype$ | async)!\"\n      [isLoading]=\"(isLoading$ | async)!\"\n      (close)=\"close.emit()\"\n    ></bb-document-viewer-header>\n\n    <ng-container *ngIf=\"documentSrc$ | async as source\">\n      <ng-container *ngIf=\"!(isLoading$ | async) && !(isHttpError$ | async)\">\n        <div\n          class=\"bb-document-viewer-container-image\"\n          *ngIf=\"documentFiletype$ | async as documentFiletype\"\n          (click)=\"closeDialog()\"\n        >\n          <bb-image-viewer\n            data-role=\"document-viewer-image\"\n            [source]=\"source\"\n            [navigationState]=\"(navigationState$ | async)!\"\n            (navigate)=\"onNavigate($event)\"\n          ></bb-image-viewer>\n        </div>\n      </ng-container>\n    </ng-container>\n\n    <bb-loading-indicator-ui\n      *ngIf=\"isLoading$ | async\"\n      class=\"bb-document-viewer-container__state\"\n      data-role=\"document-viewer-loading-state\"\n      loaderSize=\"lg\"\n    >\n    </bb-loading-indicator-ui>\n\n    <bb-empty-state-ui\n      *ngIf=\"!(isLoading$ | async) && (isHttpError$ | async)\"\n      data-role=\"document-viewer-error-state\"\n      class=\"bb-document-viewer-container__state\"\n      iconColor=\"white\"\n      iconModifier=\"error-outline\"\n      iconSize=\"xxl\"\n      title=\"Unknown Error\"\n      i18n-title=\"Unknown http error title@@document-viewer-component.uknown-error-title\"\n      subtitle=\"Try to reload the page or contact the system administrator\"\n      i18n-subtitle=\"\n        Try to reload the page or contact the system administrator@@document-viewer-component.uknown-error-subtitle\"\n    ></bb-empty-state-ui>\n  </div>\n</div>\n"]}