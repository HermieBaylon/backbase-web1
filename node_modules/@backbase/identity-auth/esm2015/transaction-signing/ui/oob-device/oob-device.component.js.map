{"version":3,"file":"oob-device.component.js","sourceRoot":"","sources":["../../../../../../../libs/identity-auth/transaction-signing/ui/oob-device/oob-device.component.ts","../../../../../../../libs/identity-auth/transaction-signing/ui/oob-device/oob-device.component.html"],"names":[],"mappings":"AAAA,OAAO,EAAE,uBAAuB,EAAE,SAAS,EAAE,YAAY,EAAE,KAAK,EAAU,MAAM,EAAE,MAAM,eAAe,CAAC;AAExG,OAAO,EAGL,gBAAgB,GAGjB,MAAM,YAAY,CAAC;;;;;;;;AAOpB,MAAM,OAAO,oCAAoC;IAkD/C,YAAoB,SAA2B;QAA3B,cAAS,GAAT,SAAS,CAAkB;QAjDrC,gBAAW,GAAG,IAAI,YAAY,EAAS,CAAC;QACxC,WAAM,GAAG,IAAI,YAAY,EAAQ,CAAC;QAClC,SAAI,GAAG,IAAI,YAAY,EAAQ,CAAC;QAChC,WAAM,GAAG,IAAI,YAAY,EAAQ,CAAC;QAwC5C,SAAI,GAAG,EAAE,CAAC;QAID,qBAAgB,GAAuB,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC;IAE5B,CAAC;IAxCnD,IAAI,IAAI;QACN,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;SAC1C;QACD,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,IACI,IAAI,CAAC,KAAyC;QAChD,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAE3B,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC;YAE5D,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,2BAA2B,CAAC;YAChF,IAAI,CAAC,aAAa,EAAE,CAAC;SACtB;QAED,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,KAAK,OAAO,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,eAAe,CAAC;SACnF;IACH,CAAC;IAED,IAAI,QAAQ;QACV,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE;YAC9B,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;SAClD;QACD,OAAO,IAAI,CAAC,oBAAoB,CAAC;IACnC,CAAC;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,4BAA4B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC;IAC5E,CAAC;IAUD,QAAQ;QACN,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;IACnB,CAAC;IAEO,aAAa;QACnB,IAAI,IAAI,CAAC,QAAQ,CAAC,iBAAiB,GAAG,CAAC,EAAE;YACvC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;SACvD;IACH,CAAC;;qJA5DU,oCAAoC;yIAApC,oCAAoC,4QCfjD,8vLA0JA;4FD3Ia,oCAAoC;kBALhD,SAAS;mBAAC;oBACT,QAAQ,EAAE,mCAAmC;oBAC7C,WAAW,EAAE,2BAA2B;oBACxC,eAAe,EAAE,uBAAuB,CAAC,MAAM;iBAChD;uGAEW,WAAW;sBAApB,MAAM;gBACG,MAAM;sBAAf,MAAM;gBACG,IAAI;sBAAb,MAAM;gBACG,MAAM;sBAAf,MAAM;gBAEE,KAAK;sBAAb,KAAK;gBAEG,4BAA4B;sBAApC,KAAK;gBAUF,IAAI;sBADP,KAAK","sourcesContent":["import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport {\n  ChallengeError,\n  ChallengeOobDeviceData,\n  CountdownService,\n  OobDeviceInfo,\n  OobNotificationInfo,\n} from '../../util';\n\n@Component({\n  selector: 'bb-transaction-signing-oob-device',\n  templateUrl: 'oob-device.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TransactionSigningOobDeviceComponent implements OnInit {\n  @Output() acceptError = new EventEmitter<Error>();\n  @Output() cancel = new EventEmitter<void>();\n  @Output() poll = new EventEmitter<void>();\n  @Output() resend = new EventEmitter<void>();\n\n  @Input() error: ChallengeError | undefined;\n\n  @Input() enableResendPushNotification!: boolean;\n\n  get data() {\n    if (!this.challengeData) {\n      throw new Error('No challenge data set');\n    }\n    return this.challengeData;\n  }\n\n  @Input()\n  set data(value: ChallengeOobDeviceData | undefined) {\n    this.challengeData = value;\n\n    if (this.challengeData) {\n      this.deviceInfo = this.challengeData.data.deviceInformation;\n\n      this.pushNotificationData = this.challengeData.data.pushNotificationInformation;\n      this.setResendTime();\n    }\n\n    if (this.deviceInfo) {\n      this.icon = this.deviceInfo.vendor === 'Apple' ? 'phone-iphone' : 'phone-android';\n    }\n  }\n\n  get pushData(): OobNotificationInfo {\n    if (!this.pushNotificationData) {\n      throw new Error('No push notification data set');\n    }\n    return this.pushNotificationData;\n  }\n\n  get pushFailure(): boolean {\n    return this.enableResendPushNotification && !this.pushData.sendSuccessful;\n  }\n\n  icon = '';\n  challengeData: ChallengeOobDeviceData | undefined;\n  deviceInfo: OobDeviceInfo | undefined;\n  private pushNotificationData: OobNotificationInfo | undefined;\n  readonly timeUntilResend$: Observable<number> = this.countdown.remainingTime$;\n\n  constructor(private countdown: CountdownService) {}\n\n  ngOnInit(): void {\n    this.poll.emit();\n  }\n\n  private setResendTime(): void {\n    if (this.pushData.nextResendSeconds > 0) {\n      this.countdown.start(this.pushData.nextResendSeconds);\n    }\n  }\n}\n","<bb-transaction-signing-error\n  *ngIf=\"error; else displayHoldingScreen\"\n  [error]=\"error\"\n  (closeModal)=\"acceptError.emit($event)\"\n>\n</bb-transaction-signing-error>\n\n<ng-template #displayHoldingScreen>\n  <bb-alert-ui\n    *ngIf=\"pushFailure\"\n    data-role=\"ts-oob-device-incorrect-alert\"\n    i18n-title=\"\n      Failure to send push notification for out of band device transaction\n      signing@@bb-transaction-signing-oob-device.alert.failure.title\"\n    title=\"Push notification failure\"\n  >\n    <span\n      i18n=\"\n        Incorrect attempts alert message for sms otp signing@@bb-transaction-signing-oob-device.alert.failure.message\"\n    >\n      Failure to send push notification. Please open your app to complete the transaction.\n    </span>\n  </bb-alert-ui>\n\n  <div class=\"bb-block bb-block--md\">\n    <div\n      data-role=\"oob-device-title\"\n      class=\"bb-highlight bb-block bb-block--md\"\n      i18n=\"Instruction for oob device signing@@bb-transaction-signing-oob-device.instruction.check-device-header\"\n    >\n      Check your device:\n    </div>\n    <div class=\"bb-stack\">\n      <bb-icon-ui class=\"bb-stack__item\" [name]=\"icon\" size=\"xl\" data-role=\"oob-device-icon\"></bb-icon-ui>\n      <div>\n        <div *ngIf=\"deviceInfo?.friendlyName; else defaultFriendlyName\" class=\"bb-stack__item bb-highlight\">\n          <span data-role=\"oob-device-friendly-name\">{{ deviceInfo?.friendlyName }}</span>\n        </div>\n        <div *ngIf=\"deviceInfo?.vendor && deviceInfo?.model; else defaultVendor\" class=\"bb-stack__item bb-text-support\">\n          <span data-role=\"oob-device-vendor-model\">{{ deviceInfo?.vendor }} {{ deviceInfo?.model }}</span>\n        </div>\n        <div class=\"bb-stack__item bb-text-support bb-subheader bb-subheader--regular\">\n          <span\n            data-role=\"oob-device-registered-date\"\n            i18n=\"Device registered date@@bb-transaction-signing-oob-device.registered-date\"\n          >\n            Registered on: {{ deviceInfo?.created | date: 'medium' }}</span\n          >\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div\n    class=\"bb-block bb-block--md\"\n    i18n=\"Instruction for oob device signing@@bb-transaction-signing-oob-device.instruction\"\n  >\n    <strong>Please sign this transaction through your banking app. When confirmed, this page will refresh.</strong>\n  </div>\n\n  <div class=\"bb-block bb-block--lg\">\n    <ng-container *ngIf=\"enableResendPushNotification\">\n      <hr />\n\n      <div class=\"bb-block bb-block--sm\">\n        <span\n          data-role=\"oob-no-notification-title\"\n          class=\"bb-highlight\"\n          i18n=\"No notification received@@bb-oob-notification-signing.resend.no-notification\"\n        >\n          Didn't receive the notification?\n        </span>\n      </div>\n\n      <ng-container *ngIf=\"pushData.resendAttemptsLeft > 0; else displayNoRemainingRequests\">\n        <ng-container *ngIf=\"timeUntilResend$ | async as time; else displayResendButton\">\n          <span\n            class=\"bb-subtitle bb-text-support bb-block bb-block--sm\"\n            i18n=\"Time before resend@@bb-oob-notification-signing.resend.time-before\"\n          >\n            Next resend available in {{ time }} {time, plural, =1 {second} other {seconds}}\n          </span>\n        </ng-container>\n\n        <ng-template #displayResendButton>\n          <div class=\"bb-block bb-block--sm\">\n            <button\n              bbButton\n              buttonSize=\"md\"\n              data-role=\"oob-device-resend\"\n              color=\"link-text\"\n              i18n=\"Resend OOB notification button@@bb-oob-notification-signing.resend\"\n              (click)=\"this.resend.emit()\"\n            >\n              Send another notification\n            </button>\n          </div>\n\n          <div class=\"bb-text-support\">\n            <span\n              [ngClass]=\"{ 'bb-text-danger': pushData.resendAttemptsLeft === 1 }\"\n              i18n=\"Message resend alert message for oob signin@@bb-oob-signing.alert.resend.message\"\n            >\n              You have {{ pushData.resendAttemptsLeft }} resend {pushData.resendAttemptsLeft, plural, =1 {attempt} other\n              {attempts}} left.\n            </span>\n          </div>\n        </ng-template>\n      </ng-container>\n\n      <ng-template #displayNoRemainingRequests>\n        <span\n          data-role=\"ts-oob-device-no-resend\"\n          class=\"bb-subtitle bb-text-danger\"\n          i18n=\"No device push notification resend attempts remaining@@bb-transaction-signing-oob-device.no-resend\"\n        >\n          You are out of resend attempts.\n        </span>\n      </ng-template>\n    </ng-container>\n  </div>\n\n  <hr />\n\n  <div class=\"bb-block bb-block--lg\">\n    <small i18n=\"Helper text for oob device signing@@bb-transaction-signing-oob-device.helper\">\n      Note: Navigation away from this modal will result in a cancellation of this transaction signing process.\n    </small>\n  </div>\n\n  <div class=\"bb-button-bar\">\n    <button\n      bbButton\n      data-role=\"oob-device-cancel\"\n      class=\"bb-button-bar__button\"\n      color=\"secondary\"\n      (click)=\"cancel.emit()\"\n      i18n=\"Cancel button@@bb-transaction-signing-oob-device.cancel\"\n    >\n      Cancel transaction\n    </button>\n  </div>\n\n  <ng-template\n    #defaultFriendlyName\n    i18n=\"Default friendly name@@bb-transaction-signing-oob-device.default-friendly-name\"\n  >\n    <span data-role=\"oob-device-friendly-name-default\">Unknown Device</span>\n  </ng-template>\n\n  <ng-template #defaultVendor i18n=\"Device vendor default text@@bb-transaction-signing-oob-device.default-vendor\">\n    <span data-role=\"oob-device-vendor-default\">Unknown</span>\n  </ng-template>\n</ng-template>\n"]}