import { Component, Input } from '@angular/core';
import { BehaviorSubject, Subject } from 'rxjs';
import { switchMap, takeUntil } from 'rxjs/operators';
import { snapshot } from '../../../utils/snapshot';
import { getPropertyValue } from '../../../utils/item-model-property';
import { modelItemToBoolean } from '../../../utils/type-helpers';
import * as i0 from "@angular/core";
import * as i1 from "./base-create-message-modal-properties.service";
import * as i2 from "../../../services/shared-methods/shared-methods.service";
export class BaseCreateMessageModalComponent {
    constructor(properties, shared) {
        this.properties = properties;
        this.shared = shared;
        /**
         * The unique ID HTML property for each component instance.
         */
        this.id = `base-create-message-modal-${BaseCreateMessageModalComponent.counter++}`;
        this.resetSubject = new Subject();
        /**
         * The stream with the form reset triggers.
         */
        this.resetStream = this.resetSubject.asObservable();
        this.hostRef = this;
        /**
         * The flag indicating if the modal is opened or closed.
         */
        this.modalOpened = false;
        /**
         * The modal options.
         */
        this.modalOptions = {
            size: 'md',
            beforeDismiss: () => {
                this.resetSubject.next();
                return false;
            },
        };
        this.maxAttachmentSize$$ = new BehaviorSubject(undefined);
        this.maxMailoutNameLength$$ = new BehaviorSubject(undefined);
        this.maxSubjectLength$$ = new BehaviorSubject(undefined);
        this.maxMessageLength$$ = new BehaviorSubject(undefined);
        this.modalHeader$$ = new BehaviorSubject(undefined);
        this.hideComposeButton$$ = new BehaviorSubject(undefined);
        this.createMessageOpenEventName$$ = new BehaviorSubject(undefined);
        this.createMessageClosedEventName$$ = new BehaviorSubject(undefined);
        this.destroy$ = new Subject();
        /**
         * The stream with the maximum name size.
         */
        this.maxMailoutNameLength = getPropertyValue(this.maxMailoutNameLength$$, this.properties.maxMailoutNameLength);
        /**
         * The stream with the maximum subject size.
         */
        this.maxSubjectLength = getPropertyValue(this.maxSubjectLength$$, this.properties.maxSubjectLength);
        /**
         * The stream with the maximum attachment size.
         */
        this.maxAttachmentSize = getPropertyValue(this.maxAttachmentSize$$, this.properties.maxAttachmentSize);
        /**
         * The stream with the maximum message length.
         */
        this.maxMessageLength = getPropertyValue(this.maxMessageLength$$, this.properties.maxMessageLength);
        /**
         * The stream with the modal header text.
         */
        this.modalHeader = getPropertyValue(this.modalHeader$$, this.properties.modalHeader);
        /**
         * The stream with a flag indicating if the Compose button is hidden.
         */
        this.hideComposeButton = getPropertyValue(this.hideComposeButton$$, this.properties.hideComposeButton);
        /**
         * Event published to open Create message modal
         */
        this.createMessageOpenEventName = getPropertyValue(this.createMessageOpenEventName$$, this.properties.createMessageOpenEventName);
        /**
         * Event published when Create message modal widget was closed
         */
        this.createMessageClosedEventName = getPropertyValue(this.createMessageClosedEventName$$, this.properties.createMessageClosedEventName);
        this.createMessageOpenEventName
            .pipe(switchMap(eventName => this.shared.eventBusFactory(eventName)), takeUntil(this.destroy$))
            .subscribe(obj => this.openModal(obj && obj.draftId));
    }
    /**
     * The stream with the maximum attachment size.
     */
    set maxAttachmentSizeValue(value) {
        this.maxAttachmentSize$$.next(String(value));
    }
    /**
     * The stream with the maximum name length.
     */
    set maxMailoutNameLengthValue(value) {
        this.maxMailoutNameLength$$.next(Number(value));
    }
    /**
     * The stream with the maximum subject length.
     */
    set maxSubjectLengthValue(value) {
        this.maxSubjectLength$$.next(Number(value));
    }
    /**
     * The stream with the maximum message length.
     */
    set maxMessageLengthValue(value) {
        this.maxMessageLength$$.next(Number(value));
    }
    /**
     * The stream with the modal header.
     */
    set modalHeaderValue(value) {
        this.modalHeader$$.next(value);
    }
    /**
     * The stream with a flag indicating if the Compose button is hidden.
     */
    set hideComposeButtonValue(value) {
        this.hideComposeButton$$.next(modelItemToBoolean(value));
    }
    /**
     * Event published to open Create message modal
     */
    set createMessageOpenEventNameValue(value) {
        this.createMessageOpenEventName$$.next(value);
    }
    /**
     * Event published when Create message modal widget was closed
     */
    set createMessageClosedEventNameValue(value) {
        this.createMessageClosedEventName$$.next(value);
    }
    /**
     * The method to open the modal.
     *
     * @param id
     */
    openModal(id) {
        this.modalOpened = true;
        this.draftId = id;
    }
    /**
     * The method to close the modal.
     */
    closeModal() {
        this.modalOpened = false;
        const eventName = snapshot(this.createMessageClosedEventName);
        this.shared.eventBusPublish(eventName, {});
        this.draftId = undefined;
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
}
BaseCreateMessageModalComponent.counter = 0;
BaseCreateMessageModalComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: BaseCreateMessageModalComponent, deps: [{ token: i1.BaseCreateMessageModalPropertiesService }, { token: i2.SharedMethodsService }], target: i0.ɵɵFactoryTarget.Component });
BaseCreateMessageModalComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.14", type: BaseCreateMessageModalComponent, selector: "ng-component", inputs: { maxAttachmentSizeValue: ["maxAttachmentSize", "maxAttachmentSizeValue"], maxMailoutNameLengthValue: ["maxMailoutNameLength", "maxMailoutNameLengthValue"], maxSubjectLengthValue: ["maxSubjectLength", "maxSubjectLengthValue"], maxMessageLengthValue: ["maxMessageLength", "maxMessageLengthValue"], modalHeaderValue: ["modalHeader", "modalHeaderValue"], hideComposeButtonValue: ["hideComposeButton", "hideComposeButtonValue"], createMessageOpenEventNameValue: ["createMessageOpenEventName", "createMessageOpenEventNameValue"], createMessageClosedEventNameValue: ["createMessageClosedEventName", "createMessageClosedEventNameValue"] }, ngImport: i0, template: '', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.14", ngImport: i0, type: BaseCreateMessageModalComponent, decorators: [{
            type: Component,
            args: [{
                    template: '',
                }]
        }], ctorParameters: function () { return [{ type: i1.BaseCreateMessageModalPropertiesService }, { type: i2.SharedMethodsService }]; }, propDecorators: { maxAttachmentSizeValue: [{
                type: Input,
                args: ['maxAttachmentSize']
            }], maxMailoutNameLengthValue: [{
                type: Input,
                args: ['maxMailoutNameLength']
            }], maxSubjectLengthValue: [{
                type: Input,
                args: ['maxSubjectLength']
            }], maxMessageLengthValue: [{
                type: Input,
                args: ['maxMessageLength']
            }], modalHeaderValue: [{
                type: Input,
                args: ['modalHeader']
            }], hideComposeButtonValue: [{
                type: Input,
                args: ['hideComposeButton']
            }], createMessageOpenEventNameValue: [{
                type: Input,
                args: ['createMessageOpenEventName']
            }], createMessageClosedEventNameValue: [{
                type: Input,
                args: ['createMessageClosedEventName']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1jcmVhdGUtbWVzc2FnZS1tb2RhbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL21lc3NhZ2VzLWNvbW1vbi9zcmMvY29tcG9uZW50cy9jcmVhdGUtbWVzc2FnZS9iYXNlLWNyZWF0ZS1tZXNzYWdlLW1vZGFsL2Jhc2UtY3JlYXRlLW1lc3NhZ2UtbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxlQUFlLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRzVELE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDOzs7O0FBS2pFLE1BQU0sT0FBTywrQkFBK0I7SUFxSzFDLFlBQXNCLFVBQW1ELEVBQVksTUFBNEI7UUFBM0YsZUFBVSxHQUFWLFVBQVUsQ0FBeUM7UUFBWSxXQUFNLEdBQU4sTUFBTSxDQUFzQjtRQWxLakg7O1dBRUc7UUFDTSxPQUFFLEdBQUcsNkJBQTZCLCtCQUErQixDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUM7UUFDdEUsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBYSxDQUFDO1FBRXpEOztXQUVHO1FBQ00sZ0JBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQy9DLFlBQU8sR0FBRyxJQUFJLENBQUM7UUErRHhCOztXQUVHO1FBQ0gsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFFcEI7O1dBRUc7UUFDSCxp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QyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBRXpCLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQVcsQ0FBQztRQUN4RSxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBMEIsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDO0lBQzNCLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzNCLENBQUM7O0FBck1NLHVDQUFPLEdBQUcsQ0FBQyxDQUFDOzZIQURSLCtCQUErQjtpSEFBL0IsK0JBQStCLHFyQkFGaEMsRUFBRTs0RkFFRCwrQkFBK0I7a0JBSDNDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLEVBQUU7aUJBQ2I7aUtBbUJpQyxzQkFBc0I7c0JBQXJELEtBQUs7dUJBQUMsbUJBQW1CO2dCQU9TLHlCQUF5QjtzQkFBM0QsS0FBSzt1QkFBQyxzQkFBc0I7Z0JBT0UscUJBQXFCO3NCQUFuRCxLQUFLO3VCQUFDLGtCQUFrQjtnQkFPTSxxQkFBcUI7c0JBQW5ELEtBQUs7dUJBQUMsa0JBQWtCO2dCQU9DLGdCQUFnQjtzQkFBekMsS0FBSzt1QkFBQyxhQUFhO2dCQU9ZLHNCQUFzQjtzQkFBckQsS0FBSzt1QkFBQyxtQkFBbUI7Z0JBT2UsK0JBQStCO3NCQUF2RSxLQUFLO3VCQUFDLDRCQUE0QjtnQkFPUSxpQ0FBaUM7c0JBQTNFLEtBQUs7dUJBQUMsOEJBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEJhc2VDcmVhdGVNZXNzYWdlTW9kYWxQcm9wZXJ0aWVzU2VydmljZSB9IGZyb20gJy4vYmFzZS1jcmVhdGUtbWVzc2FnZS1tb2RhbC1wcm9wZXJ0aWVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2hhcmVkTWV0aG9kc1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zaGFyZWQtbWV0aG9kcy9zaGFyZWQtbWV0aG9kcy5zZXJ2aWNlJztcbmltcG9ydCB7IHN3aXRjaE1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgc25hcHNob3QgfSBmcm9tICcuLi8uLi8uLi91dGlscy9zbmFwc2hvdCc7XG5pbXBvcnQgeyBnZXRQcm9wZXJ0eVZhbHVlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvaXRlbS1tb2RlbC1wcm9wZXJ0eSc7XG5pbXBvcnQgeyBtb2RlbEl0ZW1Ub0Jvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlLWhlbHBlcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgdGVtcGxhdGU6ICcnLFxufSlcbmV4cG9ydCBjbGFzcyBCYXNlQ3JlYXRlTWVzc2FnZU1vZGFsQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgc3RhdGljIGNvdW50ZXIgPSAwO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIElEIEhUTUwgcHJvcGVydHkgZm9yIGVhY2ggY29tcG9uZW50IGluc3RhbmNlLlxuICAgKi9cbiAgcmVhZG9ubHkgaWQgPSBgYmFzZS1jcmVhdGUtbWVzc2FnZS1tb2RhbC0ke0Jhc2VDcmVhdGVNZXNzYWdlTW9kYWxDb21wb25lbnQuY291bnRlcisrfWA7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVzZXRTdWJqZWN0ID0gbmV3IFN1YmplY3Q8dW5kZWZpbmVkPigpO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RyZWFtIHdpdGggdGhlIGZvcm0gcmVzZXQgdHJpZ2dlcnMuXG4gICAqL1xuICByZWFkb25seSByZXNldFN0cmVhbSA9IHRoaXMucmVzZXRTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuICByZWFkb25seSBob3N0UmVmID0gdGhpcztcblxuICAvKipcbiAgICogVGhlIHN0cmVhbSB3aXRoIHRoZSBtYXhpbXVtIGF0dGFjaG1lbnQgc2l6ZS5cbiAgICovXG4gIEBJbnB1dCgnbWF4QXR0YWNobWVudFNpemUnKSBzZXQgbWF4QXR0YWNobWVudFNpemVWYWx1ZSh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgdGhpcy5tYXhBdHRhY2htZW50U2l6ZSQkLm5leHQoU3RyaW5nKHZhbHVlKSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHN0cmVhbSB3aXRoIHRoZSBtYXhpbXVtIG5hbWUgbGVuZ3RoLlxuICAgKi9cbiAgQElucHV0KCdtYXhNYWlsb3V0TmFtZUxlbmd0aCcpIHNldCBtYXhNYWlsb3V0TmFtZUxlbmd0aFZhbHVlKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICB0aGlzLm1heE1haWxvdXROYW1lTGVuZ3RoJCQubmV4dChOdW1iZXIodmFsdWUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgc3RyZWFtIHdpdGggdGhlIG1heGltdW0gc3ViamVjdCBsZW5ndGguXG4gICAqL1xuICBASW5wdXQoJ21heFN1YmplY3RMZW5ndGgnKSBzZXQgbWF4U3ViamVjdExlbmd0aFZhbHVlKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICB0aGlzLm1heFN1YmplY3RMZW5ndGgkJC5uZXh0KE51bWJlcih2YWx1ZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCB0aGUgbWF4aW11bSBtZXNzYWdlIGxlbmd0aC5cbiAgICovXG4gIEBJbnB1dCgnbWF4TWVzc2FnZUxlbmd0aCcpIHNldCBtYXhNZXNzYWdlTGVuZ3RoVmFsdWUodmFsdWU6IHN0cmluZyB8IG51bWJlcikge1xuICAgIHRoaXMubWF4TWVzc2FnZUxlbmd0aCQkLm5leHQoTnVtYmVyKHZhbHVlKSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHN0cmVhbSB3aXRoIHRoZSBtb2RhbCBoZWFkZXIuXG4gICAqL1xuICBASW5wdXQoJ21vZGFsSGVhZGVyJykgc2V0IG1vZGFsSGVhZGVyVmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMubW9kYWxIZWFkZXIkJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgc3RyZWFtIHdpdGggYSBmbGFnIGluZGljYXRpbmcgaWYgdGhlIENvbXBvc2UgYnV0dG9uIGlzIGhpZGRlbi5cbiAgICovXG4gIEBJbnB1dCgnaGlkZUNvbXBvc2VCdXR0b24nKSBzZXQgaGlkZUNvbXBvc2VCdXR0b25WYWx1ZSh2YWx1ZTogc3RyaW5nIHwgYm9vbGVhbikge1xuICAgIHRoaXMuaGlkZUNvbXBvc2VCdXR0b24kJC5uZXh0KG1vZGVsSXRlbVRvQm9vbGVhbih2YWx1ZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV2ZW50IHB1Ymxpc2hlZCB0byBvcGVuIENyZWF0ZSBtZXNzYWdlIG1vZGFsXG4gICAqL1xuICBASW5wdXQoJ2NyZWF0ZU1lc3NhZ2VPcGVuRXZlbnROYW1lJykgc2V0IGNyZWF0ZU1lc3NhZ2VPcGVuRXZlbnROYW1lVmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuY3JlYXRlTWVzc2FnZU9wZW5FdmVudE5hbWUkJC5uZXh0KHZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFdmVudCBwdWJsaXNoZWQgd2hlbiBDcmVhdGUgbWVzc2FnZSBtb2RhbCB3aWRnZXQgd2FzIGNsb3NlZFxuICAgKi9cbiAgQElucHV0KCdjcmVhdGVNZXNzYWdlQ2xvc2VkRXZlbnROYW1lJykgc2V0IGNyZWF0ZU1lc3NhZ2VDbG9zZWRFdmVudE5hbWVWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jcmVhdGVNZXNzYWdlQ2xvc2VkRXZlbnROYW1lJCQubmV4dCh2YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGRyYWZ0IElELlxuICAgKi9cbiAgZHJhZnRJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBUaGUgZmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBtb2RhbCBpcyBvcGVuZWQgb3IgY2xvc2VkLlxuICAgKi9cbiAgbW9kYWxPcGVuZWQgPSBmYWxzZTtcblxuICAvKipcbiAgICogVGhlIG1vZGFsIG9wdGlvbnMuXG4gICAqL1xuICBtb2RhbE9wdGlvbnMgPSB7XG4gICAgc2l6ZTogJ21kJyxcbiAgICBiZWZvcmVEaXNtaXNzOiAoKSA9PiB7XG4gICAgICB0aGlzLnJlc2V0U3ViamVjdC5uZXh0KCk7XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICB9O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4QXR0YWNobWVudFNpemUkJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heE1haWxvdXROYW1lTGVuZ3RoJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhTdWJqZWN0TGVuZ3RoJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhNZXNzYWdlTGVuZ3RoJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlciB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RhbEhlYWRlciQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmcgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgaGlkZUNvbXBvc2VCdXR0b24kJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgcHJpdmF0ZSByZWFkb25seSBjcmVhdGVNZXNzYWdlT3BlbkV2ZW50TmFtZSQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmcgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgY3JlYXRlTWVzc2FnZUNsb3NlZEV2ZW50TmFtZSQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmcgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCB0aGUgbWF4aW11bSBuYW1lIHNpemUuXG4gICAqL1xuICByZWFkb25seSBtYXhNYWlsb3V0TmFtZUxlbmd0aDogT2JzZXJ2YWJsZTxudW1iZXI+ID0gZ2V0UHJvcGVydHlWYWx1ZShcbiAgICB0aGlzLm1heE1haWxvdXROYW1lTGVuZ3RoJCQsXG4gICAgdGhpcy5wcm9wZXJ0aWVzLm1heE1haWxvdXROYW1lTGVuZ3RoLFxuICApO1xuXG4gIC8qKlxuICAgKiBUaGUgc3RyZWFtIHdpdGggdGhlIG1heGltdW0gc3ViamVjdCBzaXplLlxuICAgKi9cbiAgcmVhZG9ubHkgbWF4U3ViamVjdExlbmd0aDogT2JzZXJ2YWJsZTxudW1iZXI+ID0gZ2V0UHJvcGVydHlWYWx1ZShcbiAgICB0aGlzLm1heFN1YmplY3RMZW5ndGgkJCxcbiAgICB0aGlzLnByb3BlcnRpZXMubWF4U3ViamVjdExlbmd0aCxcbiAgKTtcblxuICAvKipcbiAgICogVGhlIHN0cmVhbSB3aXRoIHRoZSBtYXhpbXVtIGF0dGFjaG1lbnQgc2l6ZS5cbiAgICovXG4gIHJlYWRvbmx5IG1heEF0dGFjaG1lbnRTaXplOiBPYnNlcnZhYmxlPHN0cmluZz4gPSBnZXRQcm9wZXJ0eVZhbHVlKFxuICAgIHRoaXMubWF4QXR0YWNobWVudFNpemUkJCxcbiAgICB0aGlzLnByb3BlcnRpZXMubWF4QXR0YWNobWVudFNpemUsXG4gICk7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCB0aGUgbWF4aW11bSBtZXNzYWdlIGxlbmd0aC5cbiAgICovXG4gIHJlYWRvbmx5IG1heE1lc3NhZ2VMZW5ndGg6IE9ic2VydmFibGU8bnVtYmVyPiA9IGdldFByb3BlcnR5VmFsdWUoXG4gICAgdGhpcy5tYXhNZXNzYWdlTGVuZ3RoJCQsXG4gICAgdGhpcy5wcm9wZXJ0aWVzLm1heE1lc3NhZ2VMZW5ndGgsXG4gICk7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCB0aGUgbW9kYWwgaGVhZGVyIHRleHQuXG4gICAqL1xuICByZWFkb25seSBtb2RhbEhlYWRlcjogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gZ2V0UHJvcGVydHlWYWx1ZSh0aGlzLm1vZGFsSGVhZGVyJCQsIHRoaXMucHJvcGVydGllcy5tb2RhbEhlYWRlcik7XG5cbiAgLyoqXG4gICAqIFRoZSBzdHJlYW0gd2l0aCBhIGZsYWcgaW5kaWNhdGluZyBpZiB0aGUgQ29tcG9zZSBidXR0b24gaXMgaGlkZGVuLlxuICAgKi9cbiAgcmVhZG9ubHkgaGlkZUNvbXBvc2VCdXR0b246IE9ic2VydmFibGU8Ym9vbGVhbj4gPSBnZXRQcm9wZXJ0eVZhbHVlKFxuICAgIHRoaXMuaGlkZUNvbXBvc2VCdXR0b24kJCxcbiAgICB0aGlzLnByb3BlcnRpZXMuaGlkZUNvbXBvc2VCdXR0b24sXG4gICk7XG5cbiAgLyoqXG4gICAqIEV2ZW50IHB1Ymxpc2hlZCB0byBvcGVuIENyZWF0ZSBtZXNzYWdlIG1vZGFsXG4gICAqL1xuICByZWFkb25seSBjcmVhdGVNZXNzYWdlT3BlbkV2ZW50TmFtZTogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gZ2V0UHJvcGVydHlWYWx1ZShcbiAgICB0aGlzLmNyZWF0ZU1lc3NhZ2VPcGVuRXZlbnROYW1lJCQsXG4gICAgdGhpcy5wcm9wZXJ0aWVzLmNyZWF0ZU1lc3NhZ2VPcGVuRXZlbnROYW1lLFxuICApO1xuXG4gIC8qKlxuICAgKiBFdmVudCBwdWJsaXNoZWQgd2hlbiBDcmVhdGUgbWVzc2FnZSBtb2RhbCB3aWRnZXQgd2FzIGNsb3NlZFxuICAgKi9cbiAgcmVhZG9ubHkgY3JlYXRlTWVzc2FnZUNsb3NlZEV2ZW50TmFtZTogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gZ2V0UHJvcGVydHlWYWx1ZShcbiAgICB0aGlzLmNyZWF0ZU1lc3NhZ2VDbG9zZWRFdmVudE5hbWUkJCxcbiAgICB0aGlzLnByb3BlcnRpZXMuY3JlYXRlTWVzc2FnZUNsb3NlZEV2ZW50TmFtZSxcbiAgKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcHJvcGVydGllczogQmFzZUNyZWF0ZU1lc3NhZ2VNb2RhbFByb3BlcnRpZXNTZXJ2aWNlLCBwcm90ZWN0ZWQgc2hhcmVkOiBTaGFyZWRNZXRob2RzU2VydmljZSkge1xuICAgIHRoaXMuY3JlYXRlTWVzc2FnZU9wZW5FdmVudE5hbWVcbiAgICAgIC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoZXZlbnROYW1lID0+IHRoaXMuc2hhcmVkLmV2ZW50QnVzRmFjdG9yeShldmVudE5hbWUpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShvYmogPT4gdGhpcy5vcGVuTW9kYWwob2JqICYmIG9iai5kcmFmdElkKSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG1ldGhvZCB0byBvcGVuIHRoZSBtb2RhbC5cbiAgICpcbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBvcGVuTW9kYWwoaWQ/OiBzdHJpbmcpIHtcbiAgICB0aGlzLm1vZGFsT3BlbmVkID0gdHJ1ZTtcbiAgICB0aGlzLmRyYWZ0SWQgPSBpZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbWV0aG9kIHRvIGNsb3NlIHRoZSBtb2RhbC5cbiAgICovXG4gIGNsb3NlTW9kYWwoKSB7XG4gICAgdGhpcy5tb2RhbE9wZW5lZCA9IGZhbHNlO1xuXG4gICAgY29uc3QgZXZlbnROYW1lID0gc25hcHNob3QodGhpcy5jcmVhdGVNZXNzYWdlQ2xvc2VkRXZlbnROYW1lKSBhcyBzdHJpbmc7XG4gICAgdGhpcy5zaGFyZWQuZXZlbnRCdXNQdWJsaXNoPFJlY29yZDxzdHJpbmcsIHVua25vd24+PihldmVudE5hbWUsIHt9KTtcbiAgICB0aGlzLmRyYWZ0SWQgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcbiAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gIH1cbn1cbiJdfQ==